var q5=Object.create;var Rv=Object.defineProperty;var Z5=Object.getOwnPropertyDescriptor;var J5=Object.getOwnPropertyNames;var Q5=Object.getPrototypeOf,tW=Object.prototype.hasOwnProperty;var eW=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),oP=(r,t)=>{for(var e in t)Rv(r,e,{get:t[e],enumerable:!0})},aP=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of J5(t))!tW.call(r,s)&&s!==e&&Rv(r,s,{get:()=>t[s],enumerable:!(i=Z5(t,s))||i.enumerable});return r};var iW=(r,t,e)=>(e=r!=null?q5(Q5(r)):{},aP(t||!r||!r.__esModule?Rv(e,"default",{value:r,enumerable:!0}):e,r)),rW=r=>aP(Rv({},"__esModule",{value:!0}),r);var hP=eW((aJ,MC)=>{"use strict";var sW=Object.prototype.hasOwnProperty,Pr="~";function Vm(){}Object.create&&(Vm.prototype=Object.create(null),new Vm().__proto__||(Pr=!1));function nW(r,t,e){this.fn=r,this.context=t,this.once=e||!1}function lP(r,t,e,i,s){if(typeof e!="function")throw new TypeError("The listener must be a function");var n=new nW(e,i||r,s),o=Pr?Pr+t:t;return r._events[o]?r._events[o].fn?r._events[o]=[r._events[o],n]:r._events[o].push(n):(r._events[o]=n,r._eventsCount++),r}function Lv(r,t){--r._eventsCount===0?r._events=new Vm:delete r._events[t]}function yr(){this._events=new Vm,this._eventsCount=0}yr.prototype.eventNames=function(){var t=[],e,i;if(this._eventsCount===0)return t;for(i in e=this._events)sW.call(e,i)&&t.push(Pr?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};yr.prototype.listeners=function(t){var e=Pr?Pr+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,n=i.length,o=new Array(n);s<n;s++)o[s]=i[s].fn;return o};yr.prototype.listenerCount=function(t){var e=Pr?Pr+t:t,i=this._events[e];return i?i.fn?1:i.length:0};yr.prototype.emit=function(t,e,i,s,n,o){var a=Pr?Pr+t:t;if(!this._events[a])return!1;var l=this._events[a],h=arguments.length,d,c;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,i),!0;case 4:return l.fn.call(l.context,e,i,s),!0;case 5:return l.fn.call(l.context,e,i,s,n),!0;case 6:return l.fn.call(l.context,e,i,s,n,o),!0}for(c=1,d=new Array(h-1);c<h;c++)d[c-1]=arguments[c];l.fn.apply(l.context,d)}else{var u=l.length,p;for(c=0;c<u;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,i);break;case 4:l[c].fn.call(l[c].context,e,i,s);break;default:if(!d)for(p=1,d=new Array(h-1);p<h;p++)d[p-1]=arguments[p];l[c].fn.apply(l[c].context,d)}}return!0};yr.prototype.on=function(t,e,i){return lP(this,t,e,i,!1)};yr.prototype.once=function(t,e,i){return lP(this,t,e,i,!0)};yr.prototype.removeListener=function(t,e,i,s){var n=Pr?Pr+t:t;if(!this._events[n])return this;if(!e)return Lv(this,n),this;var o=this._events[n];if(o.fn)o.fn===e&&(!s||o.once)&&(!i||o.context===i)&&Lv(this,n);else{for(var a=0,l=[],h=o.length;a<h;a++)(o[a].fn!==e||s&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[n]=l.length===1?l[0]:l:Lv(this,n)}return this};yr.prototype.removeAllListeners=function(t){var e;return t?(e=Pr?Pr+t:t,this._events[e]&&Lv(this,e)):(this._events=new Vm,this._eventsCount=0),this};yr.prototype.off=yr.prototype.removeListener;yr.prototype.addListener=yr.prototype.on;yr.prefixed=Pr;yr.EventEmitter=yr;typeof MC<"u"&&(MC.exports=yr)});var iJ={};oP(iJ,{VChart:()=>$i});module.exports=rW(iJ);var Bv=r=>r;var ze;(function(r){r["desktop-browser"]="desktop-browser",r["mobile-browser"]="mobile-browser",r.node="node",r.worker="worker",r.miniApp="miniApp",r.wx="wx",r.tt="tt",r.harmony="harmony",r["desktop-miniApp"]="desktop-miniApp",r.lynx="lynx"})(ze||(ze={}));var W;(function(r){r.cartesianAxis="cartesianAxis",r.cartesianBandAxis="cartesianAxis-band",r.cartesianLinearAxis="cartesianAxis-linear",r.cartesianTimeAxis="cartesianAxis-time",r.cartesianLogAxis="cartesianAxis-log",r.cartesianSymlogAxis="cartesianAxis-symlog",r.polarAxis="polarAxis",r.polarBandAxis="polarAxis-band",r.polarLinearAxis="polarAxis-linear",r.crosshair="crosshair",r.cartesianCrosshair="cartesianCrosshair",r.polarCrosshair="polarCrosshair",r.dataZoom="dataZoom",r.geoCoordinate="geoCoordinate",r.indicator="indicator",r.discreteLegend="discreteLegend",r.continuousLegend="continuousLegend",r.colorLegend="colorLegend",r.sizeLegend="sizeLegend",r.mapLabel="mapLabel",r.markLine="markLine",r.markArea="markArea",r.markPoint="markPoint",r.polarMarkLine="polarMarkLine",r.polarMarkArea="polarMarkArea",r.polarMarkPoint="polarMarkPoint",r.geoMarkPoint="geoMarkPoint",r.tooltip="tooltip",r.title="title",r.player="player",r.scrollBar="scrollBar",r.label="label",r.totalLabel="totalLabel",r.brush="brush",r.poptip="poptip",r.customMark="customMark"})(W||(W={}));var lr=iW(hP());var oW=(r,t)=>Object.prototype.toString.call(r)===`[object ${t}]`,Ps=oW;var aW=(r,t=!1)=>t?typeof r=="boolean":r===!0||r===!1||Ps(r,"Boolean"),te=aW;var lW=r=>typeof r=="function",V=lW;var hW=r=>r==null,T=hW;var dW=r=>r!=null,A=dW;var cW=r=>{let t=typeof r;return r!==null&&t==="object"||t==="function"},ct=cW;var uW=r=>typeof r=="object"&&r!==null,dP=uW;var pW=function(r){if(!dP(r)||!Ps(r,"Object"))return!1;if(Object.getPrototypeOf(r)===null)return!0;let t=r;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t},xi=pW;var mW=r=>r===void 0,He=mW;var gW=(r,t=!1)=>{let e=typeof r;return t?e==="string":e==="string"||Ps(r,"String")},Z=gW;var fW=r=>Array.isArray?Array.isArray(r):Ps(r,"Array"),H=fW;var _W=function(r){return r!==null&&typeof r!="function"&&Number.isFinite(r.length)},uh=_W;var vW=r=>Ps(r,"Date"),DC=vW;var yW=(r,t=!1)=>{let e=typeof r;return t?e==="number":e==="number"||Ps(r,"Number")},J=yW;var xW=r=>typeof r=="string"&&!isNaN(Number(r))&&!isNaN(parseFloat(r)),EC=xW;var bW=r=>J(r)&&Number.isFinite(r),K=bW;var SW=r=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(r),wC=SW;var AW=r=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(r),PC=AW;var CW=r=>({}).toString.call(r).replace(/^\[object /,"").replace(/]$/,""),cP=CW;var TW=Object.prototype,kW=function(r){let t=r&&r.constructor;return r===(typeof t=="function"&&t.prototype||TW)},uP=kW;var MW=Object.prototype.hasOwnProperty;function DW(r){if(T(r))return!0;if(uh(r))return!r.length;let t=cP(r);if(t==="Map"||t==="Set")return!r.size;if(uP(r))return!Object.keys(r).length;for(let e in r)if(MW.call(r,e))return!1;return!0}var st=DW;var EW=(r,t,e)=>{let i=Z(t)?t.split("."):t;for(let s=0;s<i.length;s++)r=r?r[i[s]]:void 0;return r===void 0?e:r},ft=EW;var wW=Object.prototype.hasOwnProperty,PW=(r,t)=>r!=null&&wW.call(r,t),zn=PW;function li(r,t,e){let i;if(!A(r)||typeof r!="object"||t&&t(r))return r;let s=H(r),n=r.length;i=s?new Array(n):typeof r=="object"?{}:te(r)||J(r)||Z(r)?r:DC(r)?new Date(+r):void 0;let o=s?void 0:Object.keys(Object(r)),a=-1;if(i)for(;++a<(o||r).length;){let l=o?o[a]:a,h=r[l];e&&e.includes(l.toString())?i[l]=h:i[l]=li(h,t,e)}return i}function jm(r,t,e=!1,i=!1){if(t){if(r===t)return;if(A(t)&&typeof t=="object"){let s=Object(t),n=[];for(let l in s)n.push(l);let{length:o}=n,a=-1;for(;o--;){let l=n[++a];!A(s[l])||typeof s[l]!="object"||i&&H(r[l])?pP(r,l,s[l]):RW(r,t,l,e,i)}}}}function RW(r,t,e,i=!1,s=!1){let n=r[e],o=t[e],a=t[e],l=!0;if(H(o)){if(i)a=[];else if(H(n))a=n;else if(uh(n)){a=new Array(n.length);let h=-1,d=n.length;for(;++h<d;)a[h]=n[h]}}else xi(o)?(a=n??{},typeof n!="function"&&typeof n=="object"||(a={})):l=!1;l&&jm(a,o,i,s),pP(r,e,a)}function pP(r,t,e){(e!==void 0&&!BW(r[t],e)||e===void 0&&!(t in r))&&(r[t]=e)}function BW(r,t){return r===t||Number.isNaN(r)&&Number.isNaN(t)}function G(r,...t){let e=-1,i=t.length;for(;++e<i;)jm(r,t[e],!0);return r}function xr(r,t){if(!r||!xi(r))return r;let e={};return Object.keys(r).forEach(i=>{let s=r[i],n=!1;t.forEach(o=>{(Z(o)&&o===i||o instanceof RegExp&&i.match(o))&&(n=!0)}),n||(e[i]=s)}),e}function mP(r){return Object.prototype.toString.call(r)}function gP(r){return Object.keys(r)}function Bt(r,t,e){if(r===t)return!0;if(typeof r!=typeof t||r==null||t==null)return!1;if(Number.isNaN(r)&&Number.isNaN(t))return!0;if(mP(r)!==mP(t))return!1;if(V(r))return!!e?.skipFunction;if(typeof r!="object")return!1;if(H(r)){if(r.length!==t.length)return!1;for(let n=r.length-1;n>=0;n--)if(!Bt(r[n],t[n],e))return!1;return!0}if(!xi(r))return!1;let i=gP(r),s=gP(t);if(i.length!==s.length)return!1;i.sort(),s.sort();for(let n=i.length-1;n>=0;n--)if(i[n]!=s[n])return!1;for(let n=i.length-1;n>=0;n--){let o=i[n];if(!Bt(r[o],t[o],e))return!1}return!0}function LW(r){if(!r)return[];if(Object.keys)return Object.keys(r);let t=[];for(let e in r)r.hasOwnProperty(e)&&t.push(e);return t}function IW(r,t,e){let i=LW(t);for(let s=0;s<i.length;s++){let n=i[s];(e?t[n]!=null:r[n]==null)&&(r[n]=t[n])}return r}function Ct(r,t,e=!0){if(r="prototype"in r?r.prototype:r,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){let i=Object.getOwnPropertyNames(t);for(let s=0;s<i.length;s++){let n=i[s];n!=="constructor"&&(e?t[n]!=null:r[n]==null)&&(r[n]=t[n])}}else IW(r,t,e)}function O(r){return A(r)?H(r)?r:[r]:[]}function It(r){if(uh(r))return r[r.length-1]}var Pe=(r,t)=>{var e;if(r.length===0)return;let i=r[0];for(let s=1;s<r.length;s++){let n=r[s];((e=t?.(n,i))!==null&&e!==void 0?e:n-i)>0&&(i=n)}return i},Ae=(r,t)=>{var e;if(r.length===0)return;let i=r[0];for(let s=1;s<r.length;s++){let n=r[s];((e=t?.(n,i))!==null&&e!==void 0?e:n-i)<0&&(i=n)}return i};function zm(r,t){if(!H(r)||!H(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function fP(r){return r&&H(r)?Array.from(new Set(O(r))):r}function _P(r,t=Math.random){let e,i,s=r.length;for(;s;)e=Math.floor(t()*s),i=r[--s],r[s]=r[e],r[e]=i;return r}function Iv(r){if(!H(r))return[r];let t=[];for(let e of r)t.push(...Iv(e));return t}function Gm(r,t,e){A(t)||(t=r,r=0),A(e)||(e=1);let i=-1,s=0|Math.max(0,Math.ceil((t-r)/e)),n=new Array(s);for(;++i<s;)n[i]=r+i*e;return n}function Fv(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function Gn(r){return Number(r)}function vP(r,t,e=Gn){let i=r.length;if(!i)return;if(t<=0||i<2)return e(r[0],0,r);if(t>=1)return e(r[i-1],i-1,r);let s=(i-1)*t,n=Math.floor(s),o=e(r[n],n,r);return o+(e(r[n+1],n+1,r)-o)*(s-n)}var FW=typeof console<"u";function Ov(r,t,e){let i=[t].concat([].slice.call(e));FW&&console[r].apply(console,i)}var Rr;(function(r){r[r.None=0]="None",r[r.Error=1]="Error",r[r.Warn=2]="Warn",r[r.Info=3]="Info",r[r.Debug=4]="Debug"})(Rr||(Rr={}));var Nt=class r{static getInstance(t,e){return r._instance&&J(t)?r._instance.level(t):r._instance||(r._instance=new r(t,e)),r._instance}static setInstance(t){return r._instance=t}static setInstanceLevel(t){r._instance?r._instance.level(t):r._instance=new r(t)}static clearInstance(){r._instance=null}constructor(t=Rr.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find(e=>e===t)||this._onErrorHandler.push(t)}removeErrorHandler(t){let e=this._onErrorHandler.findIndex(i=>i===t);e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach(e=>e(...t))}canLogInfo(){return this._level>=Rr.Info}canLogDebug(){return this._level>=Rr.Debug}canLogError(){return this._level>=Rr.Error}canLogWarn(){return this._level>=Rr.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=Rr.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):Ov((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=Rr.Warn&&Ov(this._method||"warn","WARN",t),this}info(...t){return this._level>=Rr.Info&&Ov(this._method||"log","INFO",t),this}debug(...t){return this._level>=Rr.Debug&&Ov(this._method||"log","DEBUG",t),this}};Nt._instance=null;function Um(r,t,e=0,i){for(T(i)&&(i=r.length);e<i;){let s=e+i>>>1;Fv(r[s],t)>0?i=s:e=s+1}return e}var Hv=(r,t)=>Nv(0,r.length,e=>t(r[e])),Nv=(r,t,e)=>{let i=r,s=t;for(;i<s;){let n=Math.floor((i+s)/2);e(n)>=0?s=n:i=n+1}return i};var RC=(r,t)=>{let e=r;return t!==!0&&(e=r.sort(Fv)),vP(e,.5)};function Re(r,t,e=1e-10,i=1e-10){let s=i,n=e*Math.max(r,t);return Math.abs(r-t)<=Math.max(s,n)}function us(r,t,e,i){return r>t&&!Re(r,t,e,i)}function Zr(r,t,e,i){return r<t&&!Re(r,t,e,i)}var wa=r=>{let t=null,e=null;return(...i)=>(t&&i.every((s,n)=>s===t[n])||(t=i,e=r(...i)),e)};var OW=function(r,t,e){return r<t?t:r>e?e:r},ee=OW;var HW=(r,t,e)=>{let[i,s]=r;s<i&&(i=r[1],s=r[0]);let n=s-i;return n>=e-t?[t,e]:(i=Math.min(Math.max(i,t),e-n),[i,i+n])},Un=HW;function sn(r,t){let e;return r>t&&(e=r,r=t,t=e),i=>Math.max(r,Math.min(t,i))}var Vv=!1;try{Vv=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch{Vv=!1}function NW(r,t,e){let i,s,n,o,a,l,h=0,d=!1,c=!1,u=!0,p=!t&&t!==0&&Vv;if(typeof r!="function")throw new TypeError("Expected a function");function m(y){let b=i,S=s;return i=s=void 0,h=y,o=r.apply(S,b),o}function g(y,b){return p?(cancelAnimationFrame(a),requestAnimationFrame(y)):setTimeout(y,b)}function f(y){let b=y-l;return l===void 0||b>=t||b<0||c&&y-h>=n}function _(){let y=Date.now();if(f(y))return v(y);a=g(_,function(b){let S=b-h,C=t-(b-l);return c?Math.min(C,n-S):C}(y))}function v(y){return a=void 0,u&&i?m(y):(i=s=void 0,o)}function x(...y){let b=Date.now(),S=f(b);if(i=y,s=this,l=b,S){if(a===void 0)return function(C){return h=C,a=g(_,t),d?m(C):o}(l);if(c)return a=g(_,t),m(l)}return a===void 0&&(a=g(_,t)),o}return t=+t||0,ct(e)&&(d=!!e.leading,c="maxWait"in e,c&&(n=Math.max(K(e.maxWait)?e.maxWait:0,t)),u="trailing"in e?!!e.trailing:u),x.cancel=function(){a!==void 0&&function(y){if(p)return cancelAnimationFrame(y);clearTimeout(y)}(a),h=0,i=l=s=a=void 0},x.flush=function(){return a===void 0?o:v(Date.now())},x.pending=function(){return a!==void 0},x}Vv=!1;var Zi=NW;function VW(r,t,e){let i=!0,s=!0;if(typeof r!="function")throw new TypeError("Expected a function");return ct(e)&&(i="leading"in e?!!e.leading:i,s="trailing"in e?!!e.trailing:s),Zi(r,t,{leading:i,trailing:s,maxWait:t})}var Hi=VW;function ph(r,t){return e=>r*(1-e)+t*e}function yP(r,t){return function(e){return Math.round(r*(1-e)+t*e)}}function xP(r,t){let e=r.valueOf(),i=t.valueOf(),s=new Date;return n=>(s.setTime(e*(1-n)+i*n),s)}var LC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BC=new RegExp(LC.source,"g");function jW(r){return function(){return r}}function zW(r){return function(t){return r(t)+""}}function bP(r,t){let e,i,s,n=LC.lastIndex=BC.lastIndex=0,o=-1,a=[],l=[];for(r+="",t+="";(e=LC.exec(r))&&(i=BC.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(e=e[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:ph(e,i)})),n=BC.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?zW(l[0].x):jW(t):(t=l.length,function(h){for(let d,c=0;c<t;++c)a[(d=l[c]).i]=d.x(h);return a.join("")})}function Wn(r){if(K(r))return r;let t=+r;return K(t)?t:0}var ge=Math.PI,br=ge/2,gi=2*ge;var vt=2*Math.PI,Dt=Math.abs,ae=Math.atan2,Ce=Math.cos,ri=Math.max,Ge=Math.min,ce=Math.sin,ar=Math.sqrt,mh=Math.pow;function SP(r){return r>1?0:r<-1?ge:Math.acos(r)}function IC(r){return r>=1?br:r<=-1?-br:Math.asin(r)}function FC(r,t,e,i,s){let n=e,o=i;return typeof r=="number"&&typeof e=="number"&&(n=(1-s)*r+s*e),typeof t=="number"&&typeof i=="number"&&(o=(1-s)*t+s*i),{x:n,y:o}}function Wm(r,t){return r[0]*t[1]-r[1]*t[0]}function AP(r,t){return Dt(r[0]-t[0])+Dt(r[1]-t[1])<1e-12}function CP(r,t=10){return Math.round(r*t)/t}function Yn(r){let t=r.toString().split(/[eE]/),e=(t[0].split(".")[1]||"").length-(+t[1]||0);return e>0?e:0}function Rs(r,t){return CP(r+t,10**Math.max(Yn(r),Yn(t)))}function gh(r,t){return CP(r-t,10**Math.max(Yn(r),Yn(t)))}var Xt=class r{constructor(t=0,e=0,i,s){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=s}clone(){return new r(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return J(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return J(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("\u6682\u4E0D\u652F\u6301")}div(t){throw new Error("\u6682\u4E0D\u652F\u6301")}},pe=class{static distancePP(t,e){return ar(mh(t.x-e.x,2)+mh(t.y-e.y,2))}static distanceNN(t,e,i,s){return ar(mh(t-i,2)+mh(e-s,2))}static distancePN(t,e,i){return ar(mh(e-t.x,2)+mh(i-t.y,2))}static pointAtPP(t,e,i){return new Xt((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}};function Ut(r){return r*(Math.PI/180)}function Xn(r){return 180*r/Math.PI}var GW=(r=0)=>{if(r<0)for(;r<-gi;)r+=gi;else if(r>0)for(;r>gi;)r-=gi;return r},TP=GW;function oe(r,t,e){return t?{x:r.x+t*Math.cos(e),y:r.y+t*Math.sin(e)}:{x:r.x,y:r.y}}function kP(r,t={x:0,y:0},e=0,i=2*Math.PI){let{x:s,y:n}=r,{x:o,y:a}=t,l=s-o,h=n-a,d=Math.sqrt(l*l+h*h);if(d===0)return{radius:0,angle:0};l/=d,h/=d;let c=Math.atan2(h,l);if(c<e)for(;c<=e;)c+=2*Math.PI;if(c>i)for(;c>=i;)c-=2*Math.PI;return{radius:d,angle:c}}function jv(r,t){return Math.atan2(t.y-r.y,t.x-r.x)}function Kn(r){for(;r<0;)r+=2*Math.PI;for(;r>=2*Math.PI;)r-=2*Math.PI;return r}function UW(r,t){let e=Math.abs(t-r);if(e>=2*Math.PI||2*Math.PI-e<1e-6)return[0,Math.PI/2,Math.PI,1.5*Math.PI];let i=Kn(Math.min(r,t)),s=i+e,n=[i,s],o=Math.floor(i/Math.PI)*Math.PI/2;for(;o<s;)o>i&&n.push(o),o+=Math.PI/2;return n}function MP(r,t,e,i){let{x:s,y:n}=t,o=UW(e,i),{width:a,height:l}=r,h=[];return o.forEach(d=>{let c=Math.sin(d),u=Math.cos(d);c===1?h.push(l-n):c===-1?h.push(n):u===1?h.push(a-s):u===-1?h.push(s):(c>0?h.push(Math.abs((l-n)/c)):h.push(Math.abs(n/c)),u>0?h.push(Math.abs((a-s)/u)):h.push(Math.abs(s/u)))}),Math.min.apply(null,h)}function zv(r){return(r=Kn(r))>0&&r<=Math.PI/2?2:r>Math.PI/2&&r<=Math.PI?3:r>Math.PI&&r<=3*Math.PI/2?4:1}function OC(r,t,e){r[0]=t[0]-e[0],r[1]=t[1]-e[1]}function VC(r,t,e,i){let s=r[0],n=t[0],o=e[0],a=i[0];return n<s&&([s,n]=[n,s]),a<o&&([a,o]=[o,a]),!(n<o||a<s)&&(s=r[1],n=t[1],o=e[1],a=i[1],n<s&&([s,n]=[n,s]),a<o&&([a,o]=[o,a]),!(n<o||a<s))}function wP(r,t,e,i){if(!VC(r,t,e,i))return!1;let s=[0,0],n=[0,0],o=[0,0];if(OC(s,t,r),OC(n,i,e),AP(s,n))return!0;OC(o,e,r);let a=Wm(o,n)/Wm(s,n);return a>=0&&a<=1&&[r[0]+s[0]*a,r[1]+s[1]*a]}function PP(r,t,e){if(r===null)return t;if(t===null)return r;let{x11:i,x12:s,y11:n,y12:o,x21:a,x22:l,y21:h,y22:d}=RP(r,t,e);return i>=l||s<=a||n>=d||o<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(i,a),y1:Math.max(n,h),x2:Math.min(s,l),y2:Math.min(o,d)}}var DP;(function(r){r[r.NONE=0]="NONE",r[r.BBOX1=1]="BBOX1",r[r.BBOX2=2]="BBOX2"})(DP||(DP={}));var RP=(r,t,e)=>{let i=r.x1,s=r.x2,n=r.y1,o=r.y2,a=t.x1,l=t.x2,h=t.y1,d=t.y2;return e&&(i>s&&([i,s]=[s,i]),n>o&&([n,o]=[o,n]),a>l&&([a,l]=[l,a]),h>d&&([h,d]=[d,h])),{x11:i,x12:s,y11:n,y12:o,x21:a,x22:l,y21:h,y22:d}};function jo(r,t,e){if(r&&t){if(!e)return!(r.x1>t.x2||r.x2<t.x1||r.y1>t.y2||r.y2<t.y1);let{x11:i,x12:s,y11:n,y12:o,x21:a,x22:l,y21:h,y22:d}=RP(r,t,!0);return!(i>l||s<a||n>d||o<h)}return!0}function ac(r,t,e){if(!t)return!0;if(!e)return r.x>=t.x1&&r.x<=t.x2&&r.y>=t.y1&&r.y<=t.y2;let i=t.x1,s=t.x2,n=t.y1,o=t.y2;return i>s&&([i,s]=[s,i]),n>o&&([n,o]=[o,n]),r.x>=i&&r.x<=s&&r.y>=n&&r.y<=o}function HC(r,t){return Math.abs(t[0]*r[0]+t[1]*r[1])}function Pa({x:r,y:t},e,i={x:0,y:0}){return{x:(r-i.x)*Math.cos(e)-(t-i.y)*Math.sin(e)+i.x,y:(r-i.x)*Math.sin(e)+(t-i.y)*Math.cos(e)+i.y}}function NC(r){return{x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2}}function EP(r,t){let e=t?Ut(r.angle):r.angle,i=NC(r);return[Pa({x:r.x1,y:r.y1},e,i),Pa({x:r.x2,y:r.y1},e,i),Pa({x:r.x2,y:r.y2},e,i),Pa({x:r.x1,y:r.y2},e,i)]}function Gv(r,t,e=!1){let i=EP(r,e),s=EP(t,e),n=(f,_)=>[_.x-f.x,_.y-f.y],o=n(NC(r),NC(t)),a=n(i[0],i[1]),l=n(i[1],i[2]),h=n(s[0],s[1]),d=n(s[1],s[2]),c=e?Ut(r.angle):r.angle,u=e?Ut(90-r.angle):r.angle+br,p=e?Ut(t.angle):t.angle,m=e?Ut(90-t.angle):t.angle+br;u>vt&&(u-=vt),m>vt&&(m-=vt);let g=(f,_,v,x)=>{let y=[Math.cos(_),Math.sin(_)];return f+(HC(y,v)+HC(y,x))/2>HC(y,o)};return g((r.x2-r.x1)/2,c,h,d)&&g((r.y2-r.y1)/2,u,h,d)&&g((t.x2-t.x1)/2,p,a,l)&&g((t.y2-t.y1)/2,m,a,l)}var Uv,Wv,Yv,Xv;function BP(r){return Uv=1/0,Wv=1/0,Yv=-1/0,Xv=-1/0,r.forEach(t=>{Uv>t.x&&(Uv=t.x),Yv<t.x&&(Yv=t.x),Wv>t.y&&(Wv=t.y),Xv<t.y&&(Xv=t.y)}),{x1:Uv,y1:Wv,x2:Yv,y2:Xv}}var WW=1e-8;function YW(r,t,e,i,s){for(let n=0,o=s[s.length-1];n<s.length;n++){let a=s[n];if(VC([r,t],[e,i],[a.x,a.y],[o.x,o.y]))return!0;o=a}return!1}function Ym(r,t,e){let i=0,s=r[0];if(!s)return!1;for(let o=1;o<r.length;o++){let a=r[o];i+=$n(s.x,s.y,a.x,a.y,t,e),s=a}let n=r[0];return LP(s.x,n.x)&&LP(s.y,n.y)||(i+=$n(s.x,s.y,n.x,n.y,t,e)),i!==0}function $n(r,t,e,i,s,n){if(n>t&&n>i||n<t&&n<i||i===t)return 0;let o=(n-t)/(i-t),a=i<t?1:-1;o!==1&&o!==0||(a=i<t?.5:-.5);let l=o*(e-r)+r;return l===s?1/0:l>s?a:0}function LP(r,t){return Math.abs(r-t)<WW}function jC(r,t){for(let e=0;e<t.length;e++)if(Ym(r,t[e].x,t[e].y)||e>0&&YW(t[e-1].x,t[e-1].y,t[e].x,t[e].y,r))return!0;return!1}var zC=r=>{let t=r.charCodeAt(0),e=r.length===2?r.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function fh(r,t={},e){e||(e=1);let{fontStyle:i=t.fontStyle,fontVariant:s=t.fontVariant,fontWeight:n=t.fontWeight,fontSize:o=t.fontSize,fontFamily:a=t.fontFamily}=r;return(i?i+" ":"")+(s?s+" ":"")+(n?n+" ":"")+o*e+"px "+(a||"sans-serif")}var ps=class r{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),A(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=A(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(T(this._canvas)&&(A(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),T(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&A(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),T(this._context)&&A(this._canvas)){let t=this._canvas.getContext("2d");A(t)&&(t.save(),t.font=fh(this.textSpec),this._contextSaved=!0,this._context=t)}return!T(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;let{defaultFontParams:s={}}=this._option,{fontStyle:n=s.fontStyle,fontVariant:o=s.fontVariant,fontWeight:a=(t=s.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=s.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=s.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:d,textAlign:c=d??"center",baseline:u,textBaseline:p=u??"middle",ellipsis:m,limit:g}=this._userSpec,{lineHeight:f=l}=this._userSpec;if(Z(f)&&f[f.length-1]==="%"){let _=Number.parseFloat(f.substring(0,f.length-1))/100;f=l*_}return{fontStyle:n,fontVariant:o,fontFamily:h,fontSize:l,fontWeight:a,textAlign:c,textBaseline:p,ellipsis:m,limit:g,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(T(t))return{width:0,height:0};if(T(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);let{fontFamily:e,fontSize:i,fontWeight:s,textAlign:n,textBaseline:o,ellipsis:a,limit:l,lineHeight:h}=this.textSpec,d;try{let c=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:s,textAlign:n,textBaseline:o,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});d={width:c.width(),height:c.height()}}catch{this._notSupportVRender=!0,d=this.measureWithNaiveCanvas(t)}return d}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);let i=this._context.measureText(t),{fontSize:s,lineHeight:n}=this.textSpec;return{width:i.width,height:(e=n)!==null&&e!==void 0?e:s,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){let e={width:0,height:0};for(let i=0;i<t.length;i++){let s=t[i],n=this._measureSpecialChar(s);T(n)&&r.NUMBERS_CHAR_SET.includes(s)&&(n=this._measureNumberChar()),T(n)&&["F","W"].includes(zC(s))&&(n=this._measureFullSizeChar()),T(n)&&(n=this._measureLetterChar()),e.width+=n.width,e.height=Math.max(e.height,n.height),!T(n.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=n.fontBoundingBoxAscent),!T(n.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=n.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;let i={width:0,height:0},{fontSize:s,lineHeight:n}=this.textSpec;for(let o=0;o<t.length;o++){let a=t[o],l=["F","W"].includes(zC(a))?1:.53;i.width+=l*s}return i.height=(e=n)!==null&&e!==void 0?e:s,i}_measureReduce(t,e){var i;let{fontSize:s,lineHeight:n}=this.textSpec,o={width:0,height:0};if(T(t))return o;if(H(t)){let a=t.filter(A).map(l=>l.toString());return a.length===0?o:a.length===1?e(a[0]):{width:a.reduce((l,h)=>Math.max(l,e(h).width),0),height:a.length*(((i=n)!==null&&i!==void 0?i:s)+1)+1}}return e(t.toString())}_measureNumberChar(){if(T(this._numberCharSize)){let t=this._standardMethod(r.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/r.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return T(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(r.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(T(this._letterCharSize)){let t=this._standardMethod(r.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/r.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return A(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){A(this._canvas)&&(this._canvas=null),A(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}};ps.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",ps.NUMBERS_CHAR_SET="0123456789",ps.FULL_SIZE_CHAR="\u5B57";var IP=(r,t)=>{let{x1:e,x2:i,y1:s,y2:n}=r,o=Math.abs(i-e),a=Math.abs(n-s),l=(e+i)/2,h=(s+n)/2,d=0,c=0;switch(t){case"top":case"inside-top":c=-.5;break;case"bottom":case"inside-bottom":c=.5;break;case"left":case"inside-left":d=-.5;break;case"right":case"inside-right":d=.5;break;case"top-right":d=.5,c=-.5;break;case"top-left":d=-.5,c=-.5;break;case"bottom-right":d=.5,c=.5;break;case"bottom-left":d=-.5,c=.5}return l+=d*o,h+=c*a,{x:l,y:h}};function Xm(r,t,e){let{x1:i,y1:s,x2:n,y2:o}=t;return e.onlyTranslate()?(r!==t&&r.setValue(t.x1,t.y1,t.x2,t.y2),r.translate(e.e,e.f),t):(r.clear(),r.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),r.add(e.a*n+e.c*s+e.e,e.b*n+e.d*s+e.f),r.add(e.a*n+e.c*o+e.e,e.b*n+e.d*o+e.f),r.add(e.a*i+e.c*o+e.e,e.b*i+e.d*o+e.f),t)}var Ye=class r{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new r(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,s=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=s,this}set(t=0,e=0,i=0,s=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),s<e?(this.y2=e,this.y1=s):(this.y1=e,this.y2=s),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return H(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){let s=this.rotatedPoints(t,e,i);return this.clear().add(s[0],s[1]).add(s[2],s[3]).add(s[4],s[5]).add(s[6],s[7])}scale(t=0,e=0,i=0,s=0){let n=this.scalePoints(t,e,i,s);return this.clear().add(n[0],n[1]).add(n[2],n[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Xm(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){let{x1:s,y1:n,x2:o,y2:a}=this,l=Math.cos(t),h=Math.sin(t),d=e-e*l+i*h,c=i-e*h-i*l;return[l*s-h*n+d,h*s+l*n+c,l*s-h*a+d,h*s+l*a+c,l*o-h*n+d,h*o+l*n+c,l*o-h*a+d,h*o+l*a+c]}scalePoints(t,e,i,s){let{x1:n,y1:o,x2:a,y2:l}=this;return[t*n+(1-t)*i,e*o+(1-e)*s,t*a+(1-t)*i,e*l+(1-e)*s]}},ie=class extends Ye{},Kv=class r extends Ye{constructor(t,e=0){var i;super(t),t&&(this.angle=(i=t.angle)!==null&&i!==void 0?i:e)}intersects(t){return Gv(this,t)}setValue(t=0,e=0,i=0,s=0,n=0){return super.setValue(t,e,i,s),this.angle=n,this}clone(){return new r(this)}};var Kt=class r{constructor(t=1,e=0,i=0,s=1,n=0,o=0){this.a=t,this.b=e,this.c=i,this.d=s,this.e=n,this.f=o}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,s,n,o){return!(this.e!==n||this.f!==o||this.a!==t||this.d!==s||this.b!==e||this.c!==i)}setValue(t,e,i,s,n,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.e=n,this.f=o,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){let t=this.a,e=this.b,i=this.c,s=this.d,n=this.e,o=this.f,a=new r,l=t*s-e*i;return a.a=s/l,a.b=-e/l,a.c=-i/l,a.d=t/l,a.e=(i*o-s*n)/l,a.f=-(t*o-e*n)/l,a}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=this.a*e+this.c*i,n=this.b*e+this.d*i,o=this.a*-i+this.c*e,a=this.b*-i+this.d*e;return this.a=s,this.b=n,this.c=o,this.d=a,this}rotateByCenter(t,e,i){let s=Math.cos(t),n=Math.sin(t),o=(1-s)*e+n*i,a=(1-s)*i-n*e,l=s*this.a-n*this.b,h=n*this.a+s*this.b,d=s*this.c-n*this.d,c=n*this.c+s*this.d,u=s*this.e-n*this.f+o,p=n*this.e+s*this.f+a;return this.a=l,this.b=h,this.c=d,this.d=c,this.e=u,this.f=p,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,s,n,o){return this.multiply(t,e,i,s,n,o),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){let{a:t,b:e,c:i,d:s,e:n,f:o}=this;return this.a=e,this.b=t,this.c=s,this.d=i,this.e=o,this.f=n,this}multiply(t,e,i,s,n,o){let a=this.a,l=this.b,h=this.c,d=this.d,c=a*t+h*e,u=l*t+d*e,p=a*i+h*s,m=l*i+d*s,g=a*n+h*o+this.e,f=l*n+d*o+this.f;return this.a=c,this.b=u,this.c=p,this.d=m,this.e=g,this.f=f,this}interpolate(t,e){let i=new r;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){let{a:i,b:s,c:n,d:o,e:a,f:l}=this,h=i*o-s*n,d=o/h,c=-s/h,u=-n/h,p=i/h,m=(n*l-o*a)/h,g=-(i*l-s*a)/h,{x:f,y:_}=t;e.x=f*d+_*u+m,e.y=f*c+_*p+g}onlyTranslate(t=1){return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new r(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){let t=this.a,e=this.b,i=this.c,s=this.d,n=t*s-e*i,o={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){let a=Math.sqrt(t*t+e*e);o.rotateDeg=e>0?Math.acos(t/a):-Math.acos(t/a),o.scaleX=a,o.scaleY=n/a,o.skewX=(t*i+e*s)/n,o.skewY=0}else if(i!==0||s!==0){let a=Math.sqrt(i*i+s*s);o.rotateDeg=Math.PI/2-(s>0?Math.acos(-i/a):-Math.acos(i/a)),o.scaleX=n/a,o.scaleY=a,o.skewX=0,o.skewY=(t*i+e*s)/n}return o.rotateDeg=Xn(o.rotateDeg),o}};function FP(r,t,e,i,s,n,o,a){let l=t.a,h=t.b,d=t.c,c=t.d,u=t.e,p=t.f,m=Ce(o),g=ce(o),f,_;a?(f=a[0],_=a[1]):(f=e,_=i);let v=f-e,x=_-i,y=l*m+d*g,b=h*m+c*g,S=d*m-l*g,C=c*m-h*g;r.a=s*y,r.b=s*b,r.c=n*S,r.d=n*C,r.e=u+l*f+d*_-y*v-S*x,r.f=p+h*f+c*_-b*v-C*x}var $v=class{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){let{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:s=this.L_TIME,R_COUNT:n=this.R_COUNT}=e;if(t.size<i)return 0;let o=0,a=h=>{o++,t.delete(h)},l=Date.now();return t.forEach((h,d)=>{if(h.timestamp.length<n)return a(d);let c=0;for(;l-h.timestamp[h.timestamp.length-1-c]<s&&(c++,!(c>=n)););if(c<n)return a(d);for(;l-h.timestamp[0]>s;)h.timestamp.shift()}),o}addLimitedTimestamp(t,e,i){let{R_TIMESTAMP_MAX_SIZE:s=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>s&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){let{L_TIME:i=this.L_TIME}=e,s=Date.now();t.forEach(n=>{for(;s-n.timestamp[0]>i;)n.timestamp.shift()})}clearItemTimestamp(t,e){let{L_TIME:i=this.L_TIME}=e,s=Date.now();for(;s-t.timestamp[0]>i;)t.timestamp.shift()}};var Ia={};oP(Ia,{Color:()=>Di,DEFAULT_COLORS:()=>La,RGB:()=>Ji,hexToRgb:()=>Km,hslToRgb:()=>Ra,interpolateRgb:()=>$W,rgbToHex:()=>WC,rgbToHsl:()=>Ba});function Ra(r,t,e){t/=100,e/=100;let i=(1-Math.abs(2*e-1))*t,s=i*(1-Math.abs(r/60%2-1)),n=e-i/2,o=0,a=0,l=0;return 0<=r&&r<60?(o=i,a=s,l=0):60<=r&&r<120?(o=s,a=i,l=0):120<=r&&r<180?(o=0,a=i,l=s):180<=r&&r<240?(o=0,a=s,l=i):240<=r&&r<300?(o=s,a=0,l=i):300<=r&&r<360&&(o=i,a=0,l=s),o=Math.round(255*(o+n)),a=Math.round(255*(a+n)),l=Math.round(255*(l+n)),{r:o,g:a,b:l}}function Ba(r,t,e){r/=255,t/=255,e/=255;let i=Math.min(r,t,e),s=Math.max(r,t,e),n=s-i,o=0,a=0,l=0;return o=n===0?0:s===r?(t-e)/n%6:s===t?(e-r)/n+2:(r-t)/n+4,o=Math.round(60*o),o<0&&(o+=360),l=(s+i)/2,a=n===0?0:n/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:o,s:a,l}}var XW=/^#([0-9a-f]{3,8})$/,OP={transparent:4294967040},La={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qv(r){return((r=Math.max(0,Math.min(255,Math.round(r)||0)))<16?"0":"")+r.toString(16)}function NP(r){return J(r)?new Ji(r>>16,r>>8&255,255&r,1):H(r)?new Ji(r[0],r[1],r[2]):new Ji(255,255,255)}function KW(r){return J(r)?new Ji(r>>>24,r>>>16&255,r>>>8&255,255&r):H(r)?new Ji(r[0],r[1],r[2],r[3]):new Ji(255,255,255,1)}function GC(r){return r<.04045?.0773993808*r:Math.pow(.9478672986*r+.0521327014,2.4)}function UC(r){return r<.0031308?12.92*r:1.055*Math.pow(r,.41666)-.055}var HP=(r,t)=>{let e=XW.exec(r);if(t||e){let i=parseInt(e[1],16),s=e[1].length;return s===3?new Ji((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):s===6?NP(i):s===8?new Ji(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}},Di=class r{static Brighter(t,e=1){return e===1?t:new r(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new r(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){let i=t instanceof r?t:new r(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(A(OP[t]))return KW(OP[t]);if(A(La[t]))return NP(La[t]);let e=`${t}`.trim().toLowerCase(),i=HP(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){let s=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Ji(parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10),parseFloat(s[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){let s=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),n=Ra(parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10));return new Ji(n.r,n.g,n.b,parseFloat(s[3]))}}constructor(t){let e=r.parseColorString(t);e?this.color=e:(console.warn(`Warn: \u4F20\u5165${t}\u65E0\u6CD5\u89E3\u6790\u4E3AColor`),this.color=new Ji(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){let{r:e,g:i,b:s}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(s*t))),this}add(t){let{r:e,g:i,b:s}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,s+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){let{r:e,g:i,b:s}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(s*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){let s=this.color.opacity,n=Ba(this.color.r,this.color.g,this.color.b),o=Ra(T(t)?n.h:ee(t,0,360),T(e)?n.s:e>=0&&e<=1?100*e:e,T(i)?n.l:i<=1&&i>=0?100*i:i);return this.color=new Ji(o.r,o.g,o.b,s),this}setRGB(t,e,i){return!T(t)&&(this.color.r=t),!T(e)&&(this.color.g=e),!T(i)&&(this.color.b=i),this}setHex(t){let e=`${t}`.trim().toLowerCase(),i=HP(e,!0);return i??this}setColorName(t){let e=La[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){let t=this.color.r/255,e=this.color.g/255,i=this.color.b/255,s,n,o;return s=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),n=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*n+.0722*o}clone(){return new r(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){let i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=GC(t.color.r),this.color.g=GC(t.color.g),this.color.b=GC(t.color.b),this}copyLinearToSRGB(t){return this.color.r=UC(t.color.r),this.color.g=UC(t.color.g),this.color.b=UC(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Ji=class{constructor(t,e,i,s){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),A(s)?this.opacity=isNaN(+s)?1:Math.max(0,Math.min(1,+s)):this.opacity=1}formatHex(){return`#${qv(this.r)+qv(this.g)+qv(this.b)+(this.opacity===1?"":qv(255*this.opacity))}`}formatRgb(){let t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){let t=this.opacity,{h:e,s:i,l:s}=Ba(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${s}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}};function Km(r){let t="",e="",i="",s=r[0]==="#"?1:0;for(let n=s;n<r.length;n++)r[n]!=="#"&&(n<s+2?t+=r[n]:n<s+4?e+=r[n]:n<s+6&&(i+=r[n]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}function WC(r,t,e){return Number((1<<24)+(r<<16)+(t<<8)+e).toString(16).slice(1)}function $W(r,t){let e=r.r,i=t.r,s=r.g,n=t.g,o=r.b,a=t.b,l=r.opacity,h=t.opacity;return d=>{let c=Math.round(e*(1-d)+i*d),u=Math.round(s*(1-d)+n*d),p=Math.round(o*(1-d)+a*d);return new Ji(c,u,p,l*(1-d)+h*d)}}function Ni(r){if(K(r))return[r,r,r,r];if(H(r)){let t=r.length;if(t===1){let e=r[0];return[e,e,e,e]}if(t===2){let[e,i]=r;return[e,i,e,i]}if(t===3){let[e,i,s]=r;return[e,i,s,i]}if(t===4)return r}if(ct(r)){let{top:t=0,right:e=0,bottom:i=0,left:s=0}=r;return[t,e,i,s]}return[0,0,0,0]}function $m(r,t=0,e=0){if(!r)return{width:t,height:e};let i;try{i=window?.getComputedStyle}catch{i=()=>({})}let s=i(r);if(/^(\d*\.?\d+)(px)$/.exec(s.width)){let n=parseFloat(s.width)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)||r.clientWidth-1,o=parseFloat(s.height)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)||r.clientHeight-1;return{width:n<=0?t:n,height:o<=0?e:o}}return{width:t,height:e}}function VP(r){let{x:t,y:e}=r.getBoundingClientRect();return{x:t,y:e}}var Br=63710088e-1,qW={centimeters:Br*100,centimetres:Br*100,degrees:Br/111325,feet:Br*3.28084,inches:Br*39.37,kilometers:Br/1e3,kilometres:Br/1e3,meters:Br,metres:Br,miles:Br/1609.344,millimeters:Br*1e3,millimetres:Br*1e3,nauticalmiles:Br/1852,radians:1,yards:Br*1.0936},Aet={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Br,yards:1.0936133};function jP(r,t){t===void 0&&(t="kilometers");var e=qW[t];if(!e)throw new Error(t+" units is invalid");return r/e}function ZW(r){return r.type==="Feature"?r.geometry:r}function zP(r,t){if(!r||!t)return!1;let e=ZW(t),i=e.type,s=t.bbox,n=e.coordinates;if(s&&ac(r,{x1:s[0],x2:s[1],y1:s[1],y2:s[3]},!0)===!0)return!1;i==="Polygon"&&(n=[n]);let o=!1;for(let a=0;a<n.length;++a)for(let l=0;l<n[a].length;++l)if(Ym(n[a][l].map(h=>({x:h[0],y:h[1]})),r.x,r.y))return o=!0,o;return o}function GP(r,t,e,i={}){let s=Ut(r[0]),n=Ut(r[1]),o=Ut(e),a=jP(t,i.units),l=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(o)),h=s+Math.atan2(Math.sin(o)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(l));return{x:Xn(h),y:Xn(l)}}var nn=class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}constructor(){this.locale_shortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.locale_periods=["AM","PM"],this.locale_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.locale_shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.numberRe=/^\s*\d+/,this.pads={"-":"",_:" ",0:"0"},this.requoteRe=/[\\^$*+?|[\]().{}]/g,this.locale_months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.formatShortWeekday=t=>this.locale_shortWeekdays[t.getDay()],this.formatWeekday=t=>this.locale_weekdays[t.getDay()],this.formatShortMonth=t=>this.locale_shortMonths[t.getMonth()],this.formatMonth=t=>this.locale_months[t.getMonth()],this.formatDayOfMonth=(t,e)=>this.pad(t.getDate(),e,2),this.formatHour24=(t,e)=>this.pad(t.getHours(),e,2),this.formatHour12=(t,e)=>this.pad(t.getHours()%12||12,e,2),this.formatMilliseconds=(t,e)=>this.pad(t.getMilliseconds(),e,3),this.formatMonthNumber=(t,e)=>this.pad(t.getMonth()+1,e,2),this.formatMinutes=(t,e)=>this.pad(t.getMinutes(),e,2),this.formatPeriod=t=>this.locale_periods[+(t.getHours()>=12)],this.formatSeconds=(t,e)=>this.pad(t.getSeconds(),e,2),this.formatFullYear=(t,e)=>this.pad(t.getFullYear()%1e4,e,4),this.formatUTCShortWeekday=t=>this.locale_shortWeekdays[t.getUTCDay()],this.formatUTCWeekday=t=>this.locale_weekdays[t.getUTCDay()],this.formatUTCShortMonth=t=>this.locale_shortMonths[t.getUTCMonth()],this.formatUTCMonth=t=>this.locale_months[t.getUTCMonth()],this.formatUTCDayOfMonth=(t,e)=>this.pad(t.getUTCDate(),e,2),this.formatUTCHour24=(t,e)=>this.pad(t.getUTCHours(),e,2),this.formatUTCHour12=(t,e)=>this.pad(t.getUTCHours()%12||12,e,2),this.formatUTCMilliseconds=(t,e)=>this.pad(t.getUTCMilliseconds(),e,3),this.formatUTCMonthNumber=(t,e)=>this.pad(t.getUTCMonth()+1,e,2),this.formatUTCMinutes=(t,e)=>this.pad(t.getUTCMinutes(),e,2),this.formatUTCPeriod=t=>this.locale_periods[+(t.getUTCHours()>=12)],this.formatUTCSeconds=(t,e)=>this.pad(t.getUTCSeconds(),e,2),this.formatUTCFullYear=(t,e)=>this.pad(t.getUTCFullYear()%1e4,e,4),this.formats={a:this.formatShortWeekday,A:this.formatWeekday,b:this.formatShortMonth,B:this.formatMonth,d:this.formatDayOfMonth,e:this.formatDayOfMonth,H:this.formatHour24,I:this.formatHour12,L:this.formatMilliseconds,m:this.formatMonthNumber,M:this.formatMinutes,p:this.formatPeriod,S:this.formatSeconds,Y:this.formatFullYear},this.utcFormats={a:this.formatUTCShortWeekday,A:this.formatUTCWeekday,b:this.formatUTCShortMonth,B:this.formatUTCMonth,d:this.formatUTCDayOfMonth,e:this.formatUTCDayOfMonth,H:this.formatUTCHour24,I:this.formatUTCHour12,L:this.formatUTCMilliseconds,m:this.formatUTCMonthNumber,M:this.formatUTCMinutes,p:this.formatUTCPeriod,S:this.formatUTCSeconds,Y:this.formatUTCFullYear},this.parseShortWeekday=(t,e,i)=>{let s=this.shortWeekdayRe.exec(e.slice(i));return s?(t.w=this.shortWeekdayLookup.get(s[0].toLowerCase()),i+s[0].length):-1},this.parseWeekday=(t,e,i)=>{let s=this.weekdayRe.exec(e.slice(i));return s?(t.w=this.weekdayLookup.get(s[0].toLowerCase()),i+s[0].length):-1},this.parseShortMonth=(t,e,i)=>{let s=this.shortMonthRe.exec(e.slice(i));return s?(t.m=this.shortMonthLookup.get(s[0].toLowerCase()),i+s[0].length):-1},this.parseMonth=(t,e,i)=>{let s=this.monthRe.exec(e.slice(i));return s?(t.m=this.monthLookup.get(s[0].toLowerCase()),i+s[0].length):-1},this.parseDayOfMonth=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+2));return s?(t.d=+s[0],i+s[0].length):-1},this.parseHour24=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+2));return s?(t.H=+s[0],i+s[0].length):-1},this.parseMilliseconds=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+3));return s?(t.L=+s[0],i+s[0].length):-1},this.parseMonthNumber=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+2));return s?(t.m=s-1,i+s[0].length):-1},this.parseMinutes=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+2));return s?(t.M=+s[0],i+s[0].length):-1},this.parsePeriod=(t,e,i)=>{let s=this.periodRe.exec(e.slice(i));return s?(t.p=this.periodLookup.get(s[0].toLowerCase()),i+s[0].length):-1},this.parseSeconds=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+2));return s?(t.S=+s[0],i+s[0].length):-1},this.parseFullYear=(t,e,i)=>{let s=this.numberRe.exec(e.slice(i,i+4));return s?(t.y=+s[0],i+s[0].length):-1},this.parses={a:this.parseShortWeekday,A:this.parseWeekday,b:this.parseShortMonth,B:this.parseMonth,d:this.parseDayOfMonth,e:this.parseDayOfMonth,H:this.parseHour24,I:this.parseHour24,L:this.parseMilliseconds,m:this.parseMonthNumber,M:this.parseMinutes,p:this.parsePeriod,S:this.parseSeconds,Y:this.parseFullYear},this.timeFormat=(t,e)=>this.newFormat(t,this.formats)(new Date(this.getFullTimeStamp(e))),this.timeUTCFormat=(t,e)=>this.newFormat(t,this.utcFormats)(new Date(this.getFullTimeStamp(e))),this.timeParse=(t,e)=>this.newParse(t,!1)(e+""),this.requoteF=this.requote.bind(this),this.periodRe=this.formatRe(this.locale_periods),this.periodLookup=this.formatLookup(this.locale_periods),this.weekdayRe=this.formatRe(this.locale_weekdays),this.weekdayLookup=this.formatLookup(this.locale_weekdays),this.shortWeekdayRe=this.formatRe(this.locale_shortWeekdays),this.shortWeekdayLookup=this.formatLookup(this.locale_shortWeekdays),this.monthRe=this.formatRe(this.locale_months),this.monthLookup=this.formatLookup(this.locale_months),this.shortMonthRe=this.formatRe(this.locale_shortMonths),this.shortMonthLookup=this.formatLookup(this.locale_shortMonths)}requote(t){return t.replace(this.requoteRe,"\\$&")}localDate(t){if(0<=t.y&&t.y<100){let e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}utcDate(t){if(0<=t.y&&t.y<100){let e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}newDate(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}formatRe(t){return new RegExp("^(?:"+t.map(this.requoteF).join("|")+")","i")}formatLookup(t){return new Map(t.map((e,i)=>[e.toLowerCase(),i]))}pad(t,e,i){let s=t<0?"-":"",n=(s?-t:t)+"",o=n.length;return s+(o<i?new Array(i-o+1).join(e)+n:n)}parseSpecifier(t,e,i,s){let n=0,o=e.length,a=i.length,l,h;for(;n<o;){if(s>=a)return-1;if(l=e.charCodeAt(n++),l===37){if(l=e.charAt(n++),h=this.parses[l in this.pads?e.charAt(n++):l],!h||(s=h(t,i,s))<0)return-1}else if(l!==i.charCodeAt(s++))return-1}return s}newParse(t,e){let i=this;return function(s){let n=i.newDate(1900,void 0,1);return i.parseSpecifier(n,t,s+="",0)!==s.length?null:"Q"in n?new Date(n.Q):"s"in n?new Date(1e3*n.s+("L"in n?n.L:0)):(e&&!("Z"in n)&&(n.Z=0),"p"in n&&(n.H=n.H%12+12*n.p),n.m===void 0&&(n.m="q"in n?n.q:0),"Z"in n?(n.H+=n.Z/100|0,n.M+=n.Z%100,i.utcDate(n)):i.localDate(n))}}newFormat(t,e){let i=this;return function(s){let n=[],o=-1,a=0,l=t.length,h,d,c;for(s instanceof Date||(s=new Date(+s));++o<l;)t.charCodeAt(o)===37&&(n.push(t.slice(a,o)),(d=i.pads[h=t.charAt(++o)])?h=t.charAt(++o):d=h==="e"?" ":"0",c=e[h],h=c(s,d),n.push(h),a=o+1);return n.push(t.slice(a,o)),n.join("")}}getFullTimeStamp(t){let e=parseInt(t+"",10);return String(e).length===10?1e3*e:e}};var YC=(r,t)=>{let{callback:e}=t;return e&&(r=r.filter(e)),r};function _h(){return new Jv}function Jv(){this.reset()}Jv.prototype={constructor:Jv,reset:function(){this.s=this.t=0},add:function(r){UP(Zv,r,this.t),UP(this,Zv.s,this.s),this.s?this.t+=Zv.t:this.s=Zv.t},valueOf:function(){return this.s}};var Zv=new Jv;function UP(r,t,e){var i=r.s=t+e,s=i-t,n=i-s;r.t=t-n+(e-s)}var Pt=1e-6,WP=1e-12,Gt=Math.PI,Xe=Gt/2,XC=Gt/4,Qi=Gt*2,Ei=180/Gt,Ne=Gt/180,re=Math.abs,Bs=Math.atan,hr=Math.atan2,Rt=Math.cos;var Qv=Math.exp;var vh=Math.log,ty=Math.pow,Et=Math.sin,Sr=Math.sign||function(r){return r>0?1:r<0?-1:0},si=Math.sqrt,lc=Math.tan;function ey(r){return r>1?0:r<-1?Gt:Math.acos(r)}function bi(r){return r>1?Xe:r<-1?-Xe:Math.asin(r)}function tr(){}function iy(r,t){r&&XP.hasOwnProperty(r.type)&&XP[r.type](r,t)}var YP={Feature:function(r,t){iy(r.geometry,t)},FeatureCollection:function(r,t){for(var e=r.features,i=-1,s=e.length;++i<s;)iy(e[i].geometry,t)}},XP={Sphere:function(r,t){t.sphere()},Point:function(r,t){r=r.coordinates,t.point(r[0],r[1],r[2])},MultiPoint:function(r,t){for(var e=r.coordinates,i=-1,s=e.length;++i<s;)r=e[i],t.point(r[0],r[1],r[2])},LineString:function(r,t){KC(r.coordinates,t,0)},MultiLineString:function(r,t){for(var e=r.coordinates,i=-1,s=e.length;++i<s;)KC(e[i],t,0)},Polygon:function(r,t){KP(r.coordinates,t)},MultiPolygon:function(r,t){for(var e=r.coordinates,i=-1,s=e.length;++i<s;)KP(e[i],t)},GeometryCollection:function(r,t){for(var e=r.geometries,i=-1,s=e.length;++i<s;)iy(e[i],t)}};function KC(r,t,e){var i=-1,s=r.length-e,n;for(t.lineStart();++i<s;)n=r[i],t.point(n[0],n[1],n[2]);t.lineEnd()}function KP(r,t){var e=-1,i=r.length;for(t.polygonStart();++e<i;)KC(r[e],t,1);t.polygonEnd()}function Fa(r,t){r&&YP.hasOwnProperty(r.type)?YP[r.type](r,t):iy(r,t)}function qm(r){return[hr(r[1],r[0]),bi(r[2])]}function qn(r){var t=r[0],e=r[1],i=Rt(e);return[i*Rt(t),i*Et(t),Et(e)]}function Zm(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function hc(r,t){return[r[1]*t[2]-r[2]*t[1],r[2]*t[0]-r[0]*t[2],r[0]*t[1]-r[1]*t[0]]}function ry(r,t){r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]}function Jm(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function Qm(r){var t=si(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=t,r[1]/=t,r[2]/=t}function tg(r,t){function e(i,s){return i=r(i,s),t(i[0],i[1])}return r.invert&&t.invert&&(e.invert=function(i,s){return i=t.invert(i,s),i&&r.invert(i[0],i[1])}),e}function $C(r,t){return[re(r)>Gt?r+Math.round(-r/Qi)*Qi:r,t]}$C.invert=$C;function qC(r,t,e){return(r%=Qi)?t||e?tg(qP(r),ZP(t,e)):qP(r):t||e?ZP(t,e):$C}function $P(r){return function(t,e){return t+=r,[t>Gt?t-Qi:t<-Gt?t+Qi:t,e]}}function qP(r){var t=$P(r);return t.invert=$P(-r),t}function ZP(r,t){var e=Rt(r),i=Et(r),s=Rt(t),n=Et(t);function o(a,l){var h=Rt(l),d=Rt(a)*h,c=Et(a)*h,u=Et(l),p=u*e+d*i;return[hr(c*s-p*n,d*e-u*i),bi(p*s+c*n)]}return o.invert=function(a,l){var h=Rt(l),d=Rt(a)*h,c=Et(a)*h,u=Et(l),p=u*s-c*n;return[hr(c*s+u*n,d*e+p*i),bi(p*e-d*i)]},o}function JP(r){r=qC(r[0]*Ne,r[1]*Ne,r.length>2?r[2]*Ne:0);function t(e){return e=r(e[0]*Ne,e[1]*Ne),e[0]*=Ei,e[1]*=Ei,e}return t.invert=function(e){return e=r.invert(e[0]*Ne,e[1]*Ne),e[0]*=Ei,e[1]*=Ei,e},t}function tR(r,t,e,i,s,n){if(e){var o=Rt(t),a=Et(t),l=i*e;s==null?(s=t+i*Qi,n=t-l/2):(s=QP(o,s),n=QP(o,n),(i>0?s<n:s>n)&&(s+=i*Qi));for(var h,d=s;i>0?d>n:d<n;d-=l)h=qm([o,-a*Rt(d),-a*Et(d)]),r.point(h[0],h[1])}}function QP(r,t){t=qn(t),t[0]-=r,Qm(t);var e=ey(-t[1]);return((-t[2]<0?-e:e)+Qi-Pt)%Qi}function sy(){var r=[],t;return{point:function(e,i,s){t.push([e,i,s])},lineStart:function(){r.push(t=[])},lineEnd:tr,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var e=r;return r=[],t=null,e}}}function dc(r,t){return re(r[0]-t[0])<Pt&&re(r[1]-t[1])<Pt}function ny(r,t,e,i){this.x=r,this.z=t,this.o=e,this.e=i,this.v=!1,this.n=this.p=null}function oy(r,t,e,i,s){var n=[],o=[],a,l;if(r.forEach(function(m){if(!((g=m.length-1)<=0)){var g,f=m[0],_=m[g],v;if(dc(f,_)){if(!f[2]&&!_[2]){for(s.lineStart(),a=0;a<g;++a)s.point((f=m[a])[0],f[1]);s.lineEnd();return}_[0]+=2*Pt}n.push(v=new ny(f,m,null,!0)),o.push(v.o=new ny(f,null,v,!1)),n.push(v=new ny(_,m,null,!1)),o.push(v.o=new ny(_,null,v,!0))}}),!!n.length){for(o.sort(t),eR(n),eR(o),a=0,l=o.length;a<l;++a)o[a].e=e=!e;for(var h=n[0],d,c;;){for(var u=h,p=!0;u.v;)if((u=u.n)===h)return;d=u.z,s.lineStart();do{if(u.v=u.o.v=!0,u.e){if(p)for(a=0,l=d.length;a<l;++a)s.point((c=d[a])[0],c[1]);else i(u.x,u.n.x,1,s);u=u.n}else{if(p)for(d=u.p.z,a=d.length-1;a>=0;--a)s.point((c=d[a])[0],c[1]);else i(u.x,u.p.x,-1,s);u=u.p}u=u.o,d=u.z,p=!p}while(!u.v);s.lineEnd()}}}function eR(r){if(t=r.length){for(var t,e=0,i=r[0],s;++e<t;)i.n=s=r[e],s.p=i,i=s;i.n=s=r[0],s.p=i}}var ZC=_h();function JC(r){return re(r[0])<=Gt?r[0]:Sr(r[0])*((re(r[0])+Gt)%Qi-Gt)}function iR(r,t){var e=JC(t),i=t[1],s=Et(i),n=[Et(e),-Rt(e),0],o=0,a=0;ZC.reset(),s===1?i=Xe+Pt:s===-1&&(i=-Xe-Pt);for(var l=0,h=r.length;l<h;++l)if(c=(d=r[l]).length)for(var d,c,u=d[c-1],p=JC(u),m=u[1]/2+XC,g=Et(m),f=Rt(m),_=0;_<c;++_,p=x,g=b,f=S,u=v){var v=d[_],x=JC(v),y=v[1]/2+XC,b=Et(y),S=Rt(y),C=x-p,k=C>=0?1:-1,M=k*C,E=M>Gt,D=g*b;if(ZC.add(hr(D*k*Et(M),f*S+D*Rt(M))),o+=E?C+k*Qi:C,E^p>=e^x>=e){var P=hc(qn(u),qn(v));Qm(P);var B=hc(n,P);Qm(B);var L=(E^C>=0?-1:1)*bi(B[2]);(i>L||i===L&&(P[0]||P[1]))&&(a+=E^C>=0?1:-1)}}return(o<-Pt||o<Pt&&ZC<-Pt)^a&1}function Oa(r,t){return r<t?-1:r>t?1:r>=t?0:NaN}function QC(r){return r.length===1&&(r=JW(r)),{left:function(t,e,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var n=i+s>>>1;r(t[n],e)<0?i=n+1:s=n}return i},right:function(t,e,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var n=i+s>>>1;r(t[n],e)>0?s=n:i=n+1}return i}}}function JW(r){return function(t,e){return Oa(r(t),e)}}var rR=QC(Oa),QW=rR.right,t4=rR.left;var sR=Array.prototype,i4=sR.slice,r4=sR.map;var Nit=Math.sqrt(50),Vit=Math.sqrt(10),jit=Math.sqrt(2);function eg(r){for(var t=r.length,e,i=-1,s=0,n,o;++i<t;)s+=r[i].length;for(n=new Array(s);--t>=0;)for(o=r[t],e=o.length;--e>=0;)n[--s]=o[e];return n}function ly(r,t,e,i){return function(s){var n=t(s),o=sy(),a=t(o),l=!1,h,d,c,u={point:p,lineStart:g,lineEnd:f,polygonStart:function(){u.point=_,u.lineStart=v,u.lineEnd=x,d=[],h=[]},polygonEnd:function(){u.point=p,u.lineStart=g,u.lineEnd=f,d=eg(d);var y=iR(h,i);d.length?(l||(s.polygonStart(),l=!0),oy(d,p4,y,e,s)):y&&(l||(s.polygonStart(),l=!0),s.lineStart(),e(null,null,1,s),s.lineEnd()),l&&(s.polygonEnd(),l=!1),d=h=null},sphere:function(){s.polygonStart(),s.lineStart(),e(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function p(y,b){r(y,b)&&s.point(y,b)}function m(y,b){n.point(y,b)}function g(){u.point=m,n.lineStart()}function f(){u.point=p,n.lineEnd()}function _(y,b){c.push([y,b]),a.point(y,b)}function v(){a.lineStart(),c=[]}function x(){_(c[0][0],c[0][1]),a.lineEnd();var y=a.clean(),b=o.result(),S,C=b.length,k,M,E;if(c.pop(),h.push(c),c=null,!!C){if(y&1){if(M=b[0],(k=M.length-1)>0){for(l||(s.polygonStart(),l=!0),s.lineStart(),S=0;S<k;++S)s.point((E=M[S])[0],E[1]);s.lineEnd()}return}C>1&&y&2&&b.push(b.pop().concat(b.shift())),d.push(b.filter(u4))}}return u}}function u4(r){return r.length>1}function p4(r,t){return((r=r.x)[0]<0?r[1]-Xe-Pt:Xe-r[1])-((t=t.x)[0]<0?t[1]-Xe-Pt:Xe-t[1])}var tT=ly(function(){return!0},m4,f4,[-Gt,-Xe]);function m4(r){var t=NaN,e=NaN,i=NaN,s;return{lineStart:function(){r.lineStart(),s=1},point:function(n,o){var a=n>0?Gt:-Gt,l=re(n-t);re(l-Gt)<Pt?(r.point(t,e=(e+o)/2>0?Xe:-Xe),r.point(i,e),r.lineEnd(),r.lineStart(),r.point(a,e),r.point(n,e),s=0):i!==a&&l>=Gt&&(re(t-i)<Pt&&(t-=i*Pt),re(n-a)<Pt&&(n-=a*Pt),e=g4(t,e,n,o),r.point(i,e),r.lineEnd(),r.lineStart(),r.point(a,e),s=0),r.point(t=n,e=o),i=a},lineEnd:function(){r.lineEnd(),t=e=NaN},clean:function(){return 2-s}}}function g4(r,t,e,i){var s,n,o=Et(r-e);return re(o)>Pt?Bs((Et(t)*(n=Rt(i))*Et(e)-Et(i)*(s=Rt(t))*Et(r))/(s*n*o)):(t+i)/2}function f4(r,t,e,i){var s;if(r==null)s=e*Xe,i.point(-Gt,s),i.point(0,s),i.point(Gt,s),i.point(Gt,0),i.point(Gt,-s),i.point(0,-s),i.point(-Gt,-s),i.point(-Gt,0),i.point(-Gt,s);else if(re(r[0]-t[0])>Pt){var n=r[0]<t[0]?Gt:-Gt;s=e*n/2,i.point(-n,s),i.point(0,s),i.point(n,s)}else i.point(t[0],t[1])}function oR(r){var t=Rt(r),e=6*Ne,i=t>0,s=re(t)>Pt;function n(d,c,u,p){tR(p,r,e,u,d,c)}function o(d,c){return Rt(d)*Rt(c)>t}function a(d){var c,u,p,m,g;return{lineStart:function(){m=p=!1,g=1},point:function(f,_){var v=[f,_],x,y=o(f,_),b=i?y?0:h(f,_):y?h(f+(f<0?Gt:-Gt),_):0;if(!c&&(m=p=y)&&d.lineStart(),y!==p&&(x=l(c,v),(!x||dc(c,x)||dc(v,x))&&(v[2]=1)),y!==p)g=0,y?(d.lineStart(),x=l(v,c),d.point(x[0],x[1])):(x=l(c,v),d.point(x[0],x[1],2),d.lineEnd()),c=x;else if(s&&c&&i^y){var S;!(b&u)&&(S=l(v,c,!0))&&(g=0,i?(d.lineStart(),d.point(S[0][0],S[0][1]),d.point(S[1][0],S[1][1]),d.lineEnd()):(d.point(S[1][0],S[1][1]),d.lineEnd(),d.lineStart(),d.point(S[0][0],S[0][1],3)))}y&&(!c||!dc(c,v))&&d.point(v[0],v[1]),c=v,p=y,u=b},lineEnd:function(){p&&d.lineEnd(),c=null},clean:function(){return g|(m&&p)<<1}}}function l(d,c,u){var p=qn(d),m=qn(c),g=[1,0,0],f=hc(p,m),_=Zm(f,f),v=f[0],x=_-v*v;if(!x)return!u&&d;var y=t*_/x,b=-t*v/x,S=hc(g,f),C=Jm(g,y),k=Jm(f,b);ry(C,k);var M=S,E=Zm(C,M),D=Zm(M,M),P=E*E-D*(Zm(C,C)-1);if(!(P<0)){var B=si(P),L=Jm(M,(-E-B)/D);if(ry(L,C),L=qm(L),!u)return L;var w=d[0],R=c[0],N=d[1],z=c[1],Y;R<w&&(Y=w,w=R,R=Y);var U=R-w,$=re(U-Gt)<Pt,ut=$||U<Pt;if(!$&&z<N&&(Y=N,N=z,z=Y),ut?$?N+z>0^L[1]<(re(L[0]-w)<Pt?N:z):N<=L[1]&&L[1]<=z:U>Gt^(w<=L[0]&&L[0]<=R)){var mt=Jm(M,(-E+B)/D);return ry(mt,C),[L,qm(mt)]}}}function h(d,c){var u=i?r:Gt-r,p=0;return d<-u?p|=1:d>u&&(p|=2),c<-u?p|=4:c>u&&(p|=8),p}return ly(o,a,n,i?[0,-r]:[-Gt,r-Gt])}function aR(r,t,e,i,s,n){var o=r[0],a=r[1],l=t[0],h=t[1],d=0,c=1,u=l-o,p=h-a,m;if(m=e-o,!(!u&&m>0)){if(m/=u,u<0){if(m<d)return;m<c&&(c=m)}else if(u>0){if(m>c)return;m>d&&(d=m)}if(m=s-o,!(!u&&m<0)){if(m/=u,u<0){if(m>c)return;m>d&&(d=m)}else if(u>0){if(m<d)return;m<c&&(c=m)}if(m=i-a,!(!p&&m>0)){if(m/=p,p<0){if(m<d)return;m<c&&(c=m)}else if(p>0){if(m>c)return;m>d&&(d=m)}if(m=n-a,!(!p&&m<0)){if(m/=p,p<0){if(m>c)return;m>d&&(d=m)}else if(p>0){if(m<d)return;m<c&&(c=m)}return d>0&&(r[0]=o+d*u,r[1]=a+d*p),c<1&&(t[0]=o+c*u,t[1]=a+c*p),!0}}}}}var ig=1e9,hy=-ig;function rg(r,t,e,i){function s(h,d){return r<=h&&h<=e&&t<=d&&d<=i}function n(h,d,c,u){var p=0,m=0;if(h==null||(p=o(h,c))!==(m=o(d,c))||l(h,d)<0^c>0)do u.point(p===0||p===3?r:e,p>1?i:t);while((p=(p+c+4)%4)!==m);else u.point(d[0],d[1])}function o(h,d){return re(h[0]-r)<Pt?d>0?0:3:re(h[0]-e)<Pt?d>0?2:1:re(h[1]-t)<Pt?d>0?1:0:d>0?3:2}function a(h,d){return l(h.x,d.x)}function l(h,d){var c=o(h,1),u=o(d,1);return c!==u?c-u:c===0?d[1]-h[1]:c===1?h[0]-d[0]:c===2?h[1]-d[1]:d[0]-h[0]}return function(h){var d=h,c=sy(),u,p,m,g,f,_,v,x,y,b,S,C={point:k,lineStart:P,lineEnd:B,polygonStart:E,polygonEnd:D};function k(w,R){s(w,R)&&d.point(w,R)}function M(){for(var w=0,R=0,N=p.length;R<N;++R)for(var z=p[R],Y=1,U=z.length,$=z[0],ut,mt,bt=$[0],Ot=$[1];Y<U;++Y)ut=bt,mt=Ot,$=z[Y],bt=$[0],Ot=$[1],mt<=i?Ot>i&&(bt-ut)*(i-mt)>(Ot-mt)*(r-ut)&&++w:Ot<=i&&(bt-ut)*(i-mt)<(Ot-mt)*(r-ut)&&--w;return w}function E(){d=c,u=[],p=[],S=!0}function D(){var w=M(),R=S&&w,N=(u=eg(u)).length;(R||N)&&(h.polygonStart(),R&&(h.lineStart(),n(null,null,1,h),h.lineEnd()),N&&oy(u,a,w,n,h),h.polygonEnd()),d=h,u=p=m=null}function P(){C.point=L,p&&p.push(m=[]),b=!0,y=!1,v=x=NaN}function B(){u&&(L(g,f),_&&y&&c.rejoin(),u.push(c.result())),C.point=k,y&&d.lineEnd()}function L(w,R){var N=s(w,R);if(p&&m.push([w,R]),b)g=w,f=R,_=N,b=!1,N&&(d.lineStart(),d.point(w,R));else if(N&&y)d.point(w,R);else{var z=[v=Math.max(hy,Math.min(ig,v)),x=Math.max(hy,Math.min(ig,x))],Y=[w=Math.max(hy,Math.min(ig,w)),R=Math.max(hy,Math.min(ig,R))];aR(z,Y,r,t,e,i)?(y||(d.lineStart(),d.point(z[0],z[1])),d.point(Y[0],Y[1]),N||d.lineEnd(),S=!1):N&&(d.lineStart(),d.point(w,R),S=!1)}v=w,x=R,y=N}return C}}function Ha(r){return r}var eT=_h(),iT=_h(),lR,hR,rT,sT,Na={point:tr,lineStart:tr,lineEnd:tr,polygonStart:function(){Na.lineStart=_4,Na.lineEnd=y4},polygonEnd:function(){Na.lineStart=Na.lineEnd=Na.point=tr,eT.add(re(iT)),iT.reset()},result:function(){var r=eT/2;return eT.reset(),r}};function _4(){Na.point=v4}function v4(r,t){Na.point=dR,lR=rT=r,hR=sT=t}function dR(r,t){iT.add(sT*r-rT*t),rT=r,sT=t}function y4(){dR(lR,hR)}var nT=Na;var cc=1/0,dy=cc,sg=-cc,cy=sg,x4={point:b4,lineStart:tr,lineEnd:tr,polygonStart:tr,polygonEnd:tr,result:function(){var r=[[cc,dy],[sg,cy]];return sg=cy=-(dy=cc=1/0),r}};function b4(r,t){r<cc&&(cc=r),r>sg&&(sg=r),t<dy&&(dy=t),t>cy&&(cy=t)}var uc=x4;var oT=0,aT=0,ng=0,uy=0,py=0,pc=0,lT=0,hT=0,og=0,pR,mR,Zn,Jn,on={point:yh,lineStart:cR,lineEnd:uR,polygonStart:function(){on.lineStart=C4,on.lineEnd=T4},polygonEnd:function(){on.point=yh,on.lineStart=cR,on.lineEnd=uR},result:function(){var r=og?[lT/og,hT/og]:pc?[uy/pc,py/pc]:ng?[oT/ng,aT/ng]:[NaN,NaN];return oT=aT=ng=uy=py=pc=lT=hT=og=0,r}};function yh(r,t){oT+=r,aT+=t,++ng}function cR(){on.point=S4}function S4(r,t){on.point=A4,yh(Zn=r,Jn=t)}function A4(r,t){var e=r-Zn,i=t-Jn,s=si(e*e+i*i);uy+=s*(Zn+r)/2,py+=s*(Jn+t)/2,pc+=s,yh(Zn=r,Jn=t)}function uR(){on.point=yh}function C4(){on.point=k4}function T4(){gR(pR,mR)}function k4(r,t){on.point=gR,yh(pR=Zn=r,mR=Jn=t)}function gR(r,t){var e=r-Zn,i=t-Jn,s=si(e*e+i*i);uy+=s*(Zn+r)/2,py+=s*(Jn+t)/2,pc+=s,s=Jn*r-Zn*t,lT+=s*(Zn+r),hT+=s*(Jn+t),og+=s*3,yh(Zn=r,Jn=t)}var dT=on;function my(r){this._context=r}my.prototype={_radius:4.5,pointRadius:function(r){return this._radius=r,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(r,t){switch(this._point){case 0:{this._context.moveTo(r,t),this._point=1;break}case 1:{this._context.lineTo(r,t);break}default:{this._context.moveTo(r+this._radius,t),this._context.arc(r,t,this._radius,0,Qi);break}}},result:tr};var uT=_h(),cT,fR,_R,ag,lg,gy={point:tr,lineStart:function(){gy.point=M4},lineEnd:function(){cT&&vR(fR,_R),gy.point=tr},polygonStart:function(){cT=!0},polygonEnd:function(){cT=null},result:function(){var r=+uT;return uT.reset(),r}};function M4(r,t){gy.point=vR,fR=ag=r,_R=lg=t}function vR(r,t){ag-=r,lg-=t,uT.add(si(ag*ag+lg*lg)),ag=r,lg=t}var pT=gy;function fy(){this._string=[]}fy.prototype={_radius:4.5,_circle:yR(4.5),pointRadius:function(r){return(r=+r)!==this._radius&&(this._radius=r,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(r,t){switch(this._point){case 0:{this._string.push("M",r,",",t),this._point=1;break}case 1:{this._string.push("L",r,",",t);break}default:{this._circle==null&&(this._circle=yR(this._radius)),this._string.push("M",r,",",t,this._circle);break}}},result:function(){if(this._string.length){var r=this._string.join("");return this._string=[],r}else return null}};function yR(r){return"m0,"+r+"a"+r+","+r+" 0 1,1 0,"+-2*r+"a"+r+","+r+" 0 1,1 0,"+2*r+"z"}function _y(r,t){var e=4.5,i,s;function n(o){return o&&(typeof e=="function"&&s.pointRadius(+e.apply(this,arguments)),Fa(o,i(s))),s.result()}return n.area=function(o){return Fa(o,i(nT)),nT.result()},n.measure=function(o){return Fa(o,i(pT)),pT.result()},n.bounds=function(o){return Fa(o,i(uc)),uc.result()},n.centroid=function(o){return Fa(o,i(dT)),dT.result()},n.projection=function(o){return arguments.length?(i=o==null?(r=null,Ha):(r=o).stream,n):r},n.context=function(o){return arguments.length?(s=o==null?(t=null,new fy):new my(t=o),typeof e!="function"&&s.pointRadius(e),n):t},n.pointRadius=function(o){return arguments.length?(e=typeof o=="function"?o:(s.pointRadius(+o),+o),n):e},n.projection(r).context(t)}function xh(r){return function(t){var e=new mT;for(var i in r)e[i]=r[i];return e.stream=t,e}}function mT(){}mT.prototype={constructor:mT,point:function(r,t){this.stream.point(r,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function gT(r,t,e){var i=r.clipExtent&&r.clipExtent();return r.scale(150).translate([0,0]),i!=null&&r.clipExtent(null),Fa(e,r.stream(uc)),t(uc.result()),i!=null&&r.clipExtent(i),r}function bh(r,t,e){return gT(r,function(i){var s=t[1][0]-t[0][0],n=t[1][1]-t[0][1],o=Math.min(s/(i[1][0]-i[0][0]),n/(i[1][1]-i[0][1])),a=+t[0][0]+(s-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(n-o*(i[1][1]+i[0][1]))/2;r.scale(150*o).translate([a,l])},e)}function mc(r,t,e){return bh(r,[[0,0],t],e)}function gc(r,t,e){return gT(r,function(i){var s=+t,n=s/(i[1][0]-i[0][0]),o=(s-n*(i[1][0]+i[0][0]))/2,a=-n*i[0][1];r.scale(150*n).translate([o,a])},e)}function fc(r,t,e){return gT(r,function(i){var s=+t,n=s/(i[1][1]-i[0][1]),o=-n*i[0][0],a=(s-n*(i[1][1]+i[0][1]))/2;r.scale(150*n).translate([o,a])},e)}var xR=16,D4=Rt(30*Ne);function fT(r,t){return+t?w4(r,t):E4(r)}function E4(r){return xh({point:function(t,e){t=r(t,e),this.stream.point(t[0],t[1])}})}function w4(r,t){function e(i,s,n,o,a,l,h,d,c,u,p,m,g,f){var _=h-i,v=d-s,x=_*_+v*v;if(x>4*t&&g--){var y=o+u,b=a+p,S=l+m,C=si(y*y+b*b+S*S),k=bi(S/=C),M=re(re(S)-1)<Pt||re(n-c)<Pt?(n+c)/2:hr(b,y),E=r(M,k),D=E[0],P=E[1],B=D-i,L=P-s,w=v*B-_*L;(w*w/x>t||re((_*B+v*L)/x-.5)>.3||o*u+a*p+l*m<D4)&&(e(i,s,n,o,a,l,D,P,M,y/=C,b/=C,S,g,f),f.point(D,P),e(D,P,M,y,b,S,h,d,c,u,p,m,g,f))}}return function(i){var s,n,o,a,l,h,d,c,u,p,m,g,f={point:_,lineStart:v,lineEnd:y,polygonStart:function(){i.polygonStart(),f.lineStart=b},polygonEnd:function(){i.polygonEnd(),f.lineStart=v}};function _(k,M){k=r(k,M),i.point(k[0],k[1])}function v(){c=NaN,f.point=x,i.lineStart()}function x(k,M){var E=qn([k,M]),D=r(k,M);e(c,u,d,p,m,g,c=D[0],u=D[1],d=k,p=E[0],m=E[1],g=E[2],xR,i),i.point(c,u)}function y(){f.point=_,i.lineEnd()}function b(){v(),f.point=S,f.lineEnd=C}function S(k,M){x(s=k,M),n=c,o=u,a=p,l=m,h=g,f.point=x}function C(){e(c,u,d,p,m,g,n,o,s,a,l,h,xR,i),f.lineEnd=y,y()}return f}}var P4=xh({point:function(r,t){this.stream.point(r*Ne,t*Ne)}});function R4(r){return xh({point:function(t,e){var i=r(t,e);return this.stream.point(i[0],i[1])}})}function B4(r,t,e,i,s){function n(o,a){return o*=i,a*=s,[t+r*o,e-r*a]}return n.invert=function(o,a){return[(o-t)/r*i,(e-a)/r*s]},n}function bR(r,t,e,i,s,n){var o=Rt(n),a=Et(n),l=o*r,h=a*r,d=o/r,c=a/r,u=(a*e-o*t)/r,p=(a*t+o*e)/r;function m(g,f){return g*=i,f*=s,[l*g-h*f+t,e-h*g-l*f]}return m.invert=function(g,f){return[i*(d*g-c*f+u),s*(p-c*g-d*f)]},m}function Ui(r){return _T(function(){return r})()}function _T(r){var t,e=150,i=480,s=250,n=0,o=0,a=0,l=0,h=0,d,c=0,u=1,p=1,m=null,g=tT,f=null,_,v,x,y=Ha,b=.5,S,C,k,M,E;function D(w){return k(w[0]*Ne,w[1]*Ne)}function P(w){return w=k.invert(w[0],w[1]),w&&[w[0]*Ei,w[1]*Ei]}D.stream=function(w){return M&&E===w?M:M=P4(R4(d)(g(S(y(E=w)))))},D.preclip=function(w){return arguments.length?(g=w,m=void 0,L()):g},D.postclip=function(w){return arguments.length?(y=w,f=_=v=x=null,L()):y},D.clipAngle=function(w){return arguments.length?(g=+w?oR(m=w*Ne):(m=null,tT),L()):m*Ei},D.clipExtent=function(w){return arguments.length?(y=w==null?(f=_=v=x=null,Ha):rg(f=+w[0][0],_=+w[0][1],v=+w[1][0],x=+w[1][1]),L()):f==null?null:[[f,_],[v,x]]},D.scale=function(w){return arguments.length?(e=+w,B()):e},D.translate=function(w){return arguments.length?(i=+w[0],s=+w[1],B()):[i,s]},D.center=function(w){return arguments.length?(n=w[0]%360*Ne,o=w[1]%360*Ne,B()):[n*Ei,o*Ei]},D.rotate=function(w){return arguments.length?(a=w[0]%360*Ne,l=w[1]%360*Ne,h=w.length>2?w[2]%360*Ne:0,B()):[a*Ei,l*Ei,h*Ei]},D.angle=function(w){return arguments.length?(c=w%360*Ne,B()):c*Ei},D.reflectX=function(w){return arguments.length?(u=w?-1:1,B()):u<0},D.reflectY=function(w){return arguments.length?(p=w?-1:1,B()):p<0},D.precision=function(w){return arguments.length?(S=fT(C,b=w*w),L()):si(b)},D.fitExtent=function(w,R){return bh(D,w,R)},D.fitSize=function(w,R){return mc(D,w,R)},D.fitWidth=function(w,R){return gc(D,w,R)},D.fitHeight=function(w,R){return fc(D,w,R)};function B(){var w=bR(e,0,0,u,p,c).apply(null,t(n,o)),R=(c?bR:B4)(e,i-w[0],s-w[1],u,p,c);return d=qC(a,l,h),C=tg(t,R),k=tg(d,C),S=fT(C,b),L()}function L(){return M=E=null,D}return function(){return t=r.apply(this,arguments),D.invert=t.invert&&P,B()}}function _c(r){var t=0,e=Gt/3,i=_T(r),s=i(t,e);return s.parallels=function(n){return arguments.length?i(t=n[0]*Ne,e=n[1]*Ne):[t*Ei,e*Ei]},s}function SR(r){var t=Rt(r);function e(i,s){return[i*t,Et(s)/t]}return e.invert=function(i,s){return[i/t,bi(s*t)]},e}function AR(r,t){var e=Et(r),i=(e+Et(t))/2;if(re(i)<Pt)return SR(r);var s=1+e*(2*i-e),n=si(s)/i;function o(a,l){var h=si(s-2*i*Et(l))/i;return[h*Et(a*=i),n-h*Rt(a)]}return o.invert=function(a,l){var h=n-l,d=hr(a,re(h))*Sr(h);return h*i<0&&(d-=Gt*Sr(a)*Sr(h)),[d/i,bi((s-(a*a+h*h)*i*i)/(2*i))]},o}function Va(){return _c(AR).scale(155.424).center([0,33.6442])}function hg(){return Va().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function L4(r){var t=r.length;return{point:function(e,i){for(var s=-1;++s<t;)r[s].point(e,i)},sphere:function(){for(var e=-1;++e<t;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<t;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<t;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<t;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<t;)r[e].polygonEnd()}}}function vT(){var r,t,e=hg(),i,s=Va().rotate([154,0]).center([-2,58.5]).parallels([55,65]),n,o=Va().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,h={point:function(u,p){l=[u,p]}};function d(u){var p=u[0],m=u[1];return l=null,i.point(p,m),l||(n.point(p,m),l)||(a.point(p,m),l)}d.invert=function(u){var p=e.scale(),m=e.translate(),g=(u[0]-m[0])/p,f=(u[1]-m[1])/p;return(f>=.12&&f<.234&&g>=-.425&&g<-.214?s:f>=.166&&f<.234&&g>=-.214&&g<-.115?o:e).invert(u)},d.stream=function(u){return r&&t===u?r:r=L4([e.stream(t=u),s.stream(u),o.stream(u)])},d.precision=function(u){return arguments.length?(e.precision(u),s.precision(u),o.precision(u),c()):e.precision()},d.scale=function(u){return arguments.length?(e.scale(u),s.scale(u*.35),o.scale(u),d.translate(e.translate())):e.scale()},d.translate=function(u){if(!arguments.length)return e.translate();var p=e.scale(),m=+u[0],g=+u[1];return i=e.translate(u).clipExtent([[m-.455*p,g-.238*p],[m+.455*p,g+.238*p]]).stream(h),n=s.translate([m-.307*p,g+.201*p]).clipExtent([[m-.425*p+Pt,g+.12*p+Pt],[m-.214*p-Pt,g+.234*p-Pt]]).stream(h),a=o.translate([m-.205*p,g+.212*p]).clipExtent([[m-.214*p+Pt,g+.166*p+Pt],[m-.115*p-Pt,g+.234*p-Pt]]).stream(h),c()},d.fitExtent=function(u,p){return bh(d,u,p)},d.fitSize=function(u,p){return mc(d,u,p)},d.fitWidth=function(u,p){return gc(d,u,p)},d.fitHeight=function(u,p){return fc(d,u,p)};function c(){return r=t=null,d}return d.scale(1070)}function vy(r){return function(t,e){var i=Rt(t),s=Rt(e),n=r(i*s);return[n*s*Et(t),n*Et(e)]}}function Qn(r){return function(t,e){var i=si(t*t+e*e),s=r(i),n=Et(s),o=Rt(s);return[hr(t*n,i*o),bi(i&&e*n/i)]}}var yT=vy(function(r){return si(2/(1+r))});yT.invert=Qn(function(r){return 2*bi(r/2)});function xT(){return Ui(yT).scale(124.75).clipAngle(180-.001)}var bT=vy(function(r){return(r=ey(r))&&r/Et(r)});bT.invert=Qn(function(r){return r});function ST(){return Ui(bT).scale(79.4188).clipAngle(180-.001)}function vc(r,t){return[r,vh(lc((Xe+t)/2))]}vc.invert=function(r,t){return[r,2*Bs(Qv(t))-Xe]};function AT(){return CT(vc).scale(961/Qi)}function CT(r){var t=Ui(r),e=t.center,i=t.scale,s=t.translate,n=t.clipExtent,o=null,a,l,h;t.scale=function(c){return arguments.length?(i(c),d()):i()},t.translate=function(c){return arguments.length?(s(c),d()):s()},t.center=function(c){return arguments.length?(e(c),d()):e()},t.clipExtent=function(c){return arguments.length?(c==null?o=a=l=h=null:(o=+c[0][0],a=+c[0][1],l=+c[1][0],h=+c[1][1]),d()):o==null?null:[[o,a],[l,h]]};function d(){var c=Gt*i(),u=t(JP(t.rotate()).invert([0,0]));return n(o==null?[[u[0]-c,u[1]-c],[u[0]+c,u[1]+c]]:r===vc?[[Math.max(u[0]-c,o),a],[Math.min(u[0]+c,l),h]]:[[o,Math.max(u[1]-c,a)],[l,Math.min(u[1]+c,h)]])}return d()}function yy(r){return lc((Xe+r)/2)}function CR(r,t){var e=Rt(r),i=r===t?Et(r):vh(e/Rt(t))/vh(yy(t)/yy(r)),s=e*ty(yy(r),i)/i;if(!i)return vc;function n(o,a){s>0?a<-Xe+Pt&&(a=-Xe+Pt):a>Xe-Pt&&(a=Xe-Pt);var l=s/ty(yy(a),i);return[l*Et(i*o),s-l*Rt(i*o)]}return n.invert=function(o,a){var l=s-a,h=Sr(i)*si(o*o+l*l),d=hr(o,re(l))*Sr(l);return l*i<0&&(d-=Gt*Sr(o)*Sr(l)),[d/i,2*Bs(ty(s/h,1/i))-Xe]},n}function TT(){return _c(CR).scale(109.5).parallels([30,30])}function yc(r,t){return[r,t]}yc.invert=yc;function kT(){return Ui(yc).scale(152.63)}function TR(r,t){var e=Rt(r),i=r===t?Et(r):(e-Rt(t))/(t-r),s=e/i+r;if(re(i)<Pt)return yc;function n(o,a){var l=s-a,h=i*o;return[l*Et(h),s-l*Rt(h)]}return n.invert=function(o,a){var l=s-a,h=hr(o,re(l))*Sr(l);return l*i<0&&(h-=Gt*Sr(o)*Sr(l)),[h/i,s-Sr(i)*si(o*o+l*l)]},n}function MT(){return _c(TR).scale(131.154).center([0,13.9389])}var dg=1.340264,cg=-.081106,ug=893e-6,pg=.003796,xy=si(3)/2,I4=12;function DT(r,t){var e=bi(xy*Et(t)),i=e*e,s=i*i*i;return[r*Rt(e)/(xy*(dg+3*cg*i+s*(7*ug+9*pg*i))),e*(dg+cg*i+s*(ug+pg*i))]}DT.invert=function(r,t){for(var e=t,i=e*e,s=i*i*i,n=0,o,a,l;n<I4&&(a=e*(dg+cg*i+s*(ug+pg*i))-t,l=dg+3*cg*i+s*(7*ug+9*pg*i),e-=o=a/l,i=e*e,s=i*i*i,!(re(o)<WP));++n);return[xy*r*(dg+3*cg*i+s*(7*ug+9*pg*i))/Rt(e),bi(Et(e)/xy)]};function ET(){return Ui(DT).scale(177.158)}function wT(r,t){var e=Rt(t),i=Rt(r)*e;return[e*Et(r)/i,Et(t)/i]}wT.invert=Qn(Bs);function PT(){return Ui(wT).scale(144.049).clipAngle(60)}function RT(){var r=1,t=0,e=0,i=1,s=1,n=0,o,a,l=null,h,d,c,u=1,p=1,m=xh({point:function(y,b){var S=x([y,b]);this.stream.point(S[0],S[1])}}),g=Ha,f,_;function v(){return u=r*i,p=r*s,f=_=null,x}function x(y){var b=y[0]*u,S=y[1]*p;if(n){var C=S*o-b*a;b=b*o+S*a,S=C}return[b+t,S+e]}return x.invert=function(y){var b=y[0]-t,S=y[1]-e;if(n){var C=S*o+b*a;b=b*o-S*a,S=C}return[b/u,S/p]},x.stream=function(y){return f&&_===y?f:f=m(g(_=y))},x.postclip=function(y){return arguments.length?(g=y,l=h=d=c=null,v()):g},x.clipExtent=function(y){return arguments.length?(g=y==null?(l=h=d=c=null,Ha):rg(l=+y[0][0],h=+y[0][1],d=+y[1][0],c=+y[1][1]),v()):l==null?null:[[l,h],[d,c]]},x.scale=function(y){return arguments.length?(r=+y,v()):r},x.translate=function(y){return arguments.length?(t=+y[0],e=+y[1],v()):[t,e]},x.angle=function(y){return arguments.length?(n=y%360*Ne,a=Et(n),o=Rt(n),v()):n*Ei},x.reflectX=function(y){return arguments.length?(i=y?-1:1,v()):i<0},x.reflectY=function(y){return arguments.length?(s=y?-1:1,v()):s<0},x.fitExtent=function(y,b){return bh(x,y,b)},x.fitSize=function(y,b){return mc(x,y,b)},x.fitWidth=function(y,b){return gc(x,y,b)},x.fitHeight=function(y,b){return fc(x,y,b)},x}function BT(r,t){var e=t*t,i=e*e;return[r*(.8707-.131979*e+i*(-.013791+i*(.003971*e-.001529*i))),t*(1.007226+e*(.015085+i*(-.044475+.028874*e-.005916*i)))]}BT.invert=function(r,t){var e=t,i=25,s;do{var n=e*e,o=n*n;e-=s=(e*(1.007226+n*(.015085+o*(-.044475+.028874*n-.005916*o)))-t)/(1.007226+n*(.015085*3+o*(-.044475*7+.028874*9*n-.005916*11*o)))}while(re(s)>Pt&&--i>0);return[r/(.8707+(n=e*e)*(-.131979+n*(-.013791+n*n*n*(.003971-.001529*n)))),e]};function LT(){return Ui(BT).scale(175.295)}function IT(r,t){return[Rt(t)*Et(r),Et(t)]}IT.invert=Qn(bi);function FT(){return Ui(IT).scale(249.5).clipAngle(90+Pt)}function OT(r,t){var e=Rt(t),i=1+Rt(r)*e;return[e*Et(r)/i,Et(t)/i]}OT.invert=Qn(function(r){return 2*Bs(r)});function HT(){return Ui(OT).scale(250).clipAngle(142)}function NT(r,t){return[vh(lc((Xe+t)/2)),-r]}NT.invert=function(r,t){return[-t,2*Bs(Qv(r))-Xe]};function VT(){var r=CT(NT),t=r.center,e=r.rotate;return r.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},r.rotate=function(i){return arguments.length?e([i[0],i[1],i.length>2?i[2]+90:90]):(i=e(),[i[0],i[1],i[2]-90])},e([0,0,90]).scale(159.155)}var kR=function(r,...t){return O4(li(r),...t)};function MR(r,t,e){let i=t[e];if(i===void 0)r[e]=null;else if(ct(i)){ct(r[e])||(r[e]={});for(let s in i)MR(r[e],i,s)}else r[e]=i}function F4(r,t){if(ct(t)&&r!==t)for(let e in t)MR(r,t,e)}function O4(r,...t){r||(r={});let e=-1,i=t.length;for(;++e<i;)F4(r,t[e]);return r}var xc;(function(r){r.DSV="dsv",r.TREE="tree",r.GEO="geo",r.BYTE="bytejson",r.HEX="hex",r.GRAPH="graph",r.TABLE="table",r.GEO_GRATICULE="geo-graticule"})(xc||(xc={}));var jT=(r,t)=>{let{fields:e,key:i,value:s,retains:n}=t,o=[];for(let a=0;a<r.length;a++)e.forEach(l=>{let h={};if(h[i]=l,h[s]=r[a][l],n)n.forEach(d=>{h[d]=r[a][d]});else for(let d in r[a])e.indexOf(d)===-1&&(h[d]=r[a][d]);o.push(h)});return o};var mg=(r,t)=>{var e,i;if(!t?.fields||r.length===0)return r;let s=t.fields,n=r[0],o={},a=[];for(let l in s)if(Object.prototype.hasOwnProperty.call(s,l)){let h=s[l];if(!h.type){let c=n;l in n||(c=(e=r.find(u=>l in u))!==null&&e!==void 0?e:n),h.type=typeof c[l]=="number"?"linear":"ordinal"}let d;if(typeof h.sortIndex=="number"&&(d={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},a.push(d)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},o[l]=h;let c={};h.domain.forEach((u,p)=>{c[u]=p,h._domainCache[u]=p}),d&&(d.sortIndex=c,d.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(o[l]=h)}return Object.keys(o).length>0&&(r=r.filter(l=>{for(let h in o){let d=o[h];if(d.type==="ordinal"){if(!(l[h]in d._domainCache))return!1}else if(d.domain[0]>l[h]||d.domain[1]<l[h])return!1}return!0})),a.sort((l,h)=>l.index-h.index),r.sort((l,h)=>H4(l,h,a)),r};function H4(r,t,e){for(let i=0;i<e.length;i++){let s=e[i],n=0;if(s.type==="ordinal"?(s.sortIndex[t[s.key]]===void 0&&(s.sortIndex[t[s.key]]=s.sortIndexCount++),s.sortIndex[r[s.key]]===void 0&&(s.sortIndex[r[s.key]]=s.sortIndexCount++),n=s.sortIndex[r[s.key]]-s.sortIndex[t[s.key]]):s.type==="linear"&&(n=r[s.key]-t[s.key]),s.sortReverse&&(n=-n),n!==0)return n}return 0}var DR={},zT={},GT=34,gg=10,UT=13;function wR(r){return new Function("d","return {"+r.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function N4(r,t){var e=wR(r);return function(i,s){return t(e(i),s,r)}}function ER(r){var t=Object.create(null),e=[];return r.forEach(function(i){for(var s in i)s in t||e.push(t[s]=s)}),e}function Jr(r,t){var e=r+"",i=e.length;return i<t?new Array(t-i+1).join(0)+e:e}function V4(r){return r<0?"-"+Jr(-r,6):r>9999?"+"+Jr(r,6):Jr(r,4)}function j4(r){var t=r.getUTCHours(),e=r.getUTCMinutes(),i=r.getUTCSeconds(),s=r.getUTCMilliseconds();return isNaN(r)?"Invalid Date":V4(r.getUTCFullYear(),4)+"-"+Jr(r.getUTCMonth()+1,2)+"-"+Jr(r.getUTCDate(),2)+(s?"T"+Jr(t,2)+":"+Jr(e,2)+":"+Jr(i,2)+"."+Jr(s,3)+"Z":i?"T"+Jr(t,2)+":"+Jr(e,2)+":"+Jr(i,2)+"Z":e||t?"T"+Jr(t,2)+":"+Jr(e,2)+"Z":"")}function Sh(r){var t=new RegExp('["'+r+`
\r]`),e=r.charCodeAt(0);function i(c,u){var p,m,g=s(c,function(f,_){if(p)return p(f,_-1);m=f,p=u?N4(f,u):wR(f)});return g.columns=m||[],g}function s(c,u){var p=[],m=c.length,g=0,f=0,_,v=m<=0,x=!1;c.charCodeAt(m-1)===gg&&--m,c.charCodeAt(m-1)===UT&&--m;function y(){if(v)return zT;if(x)return x=!1,DR;var S,C=g,k;if(c.charCodeAt(C)===GT){for(;g++<m&&c.charCodeAt(g)!==GT||c.charCodeAt(++g)===GT;);return(S=g)>=m?v=!0:(k=c.charCodeAt(g++))===gg?x=!0:k===UT&&(x=!0,c.charCodeAt(g)===gg&&++g),c.slice(C+1,S-1).replace(/""/g,'"')}for(;g<m;){if((k=c.charCodeAt(S=g++))===gg)x=!0;else if(k===UT)x=!0,c.charCodeAt(g)===gg&&++g;else if(k!==e)continue;return c.slice(C,S)}return v=!0,c.slice(C,m)}for(;(_=y())!==zT;){for(var b=[];_!==DR&&_!==zT;)b.push(_),_=y();u&&(b=u(b,f++))==null||p.push(b)}return p}function n(c,u){return c.map(function(p){return u.map(function(m){return d(p[m])}).join(r)})}function o(c,u){return u==null&&(u=ER(c)),[u.map(d).join(r)].concat(n(c,u)).join(`
`)}function a(c,u){return u==null&&(u=ER(c)),n(c,u).join(`
`)}function l(c){return c.map(h).join(`
`)}function h(c){return c.map(d).join(r)}function d(c){return c==null?"":c instanceof Date?j4(c):t.test(c+="")?'"'+c.replace(/"/g,'""')+'"':c}return{parse:i,parseRows:s,format:o,formatBody:a,formatRows:l,formatRow:h,formatValue:d}}var Ah=Sh(","),WT=Ah.parse,z4=Ah.parseRows,G4=Ah.format,U4=Ah.formatBody,W4=Ah.formatRows,Y4=Ah.formatRow,X4=Ah.formatValue;var Ch=Sh("	"),YT=Ch.parse,K4=Ch.parseRows,$4=Ch.format,q4=Ch.formatBody,Z4=Ch.formatRows,J4=Ch.formatRow,Q4=Ch.formatValue;var t8={delimiter:","},fg=(r,t={},e)=>{e.type=xc.DSV;let i=kR(t8,t),{delimiter:s}=i;if(!Z(s))throw new TypeError("Invalid delimiter: must be a string!");return Sh(s).parse(r)},_g=(r,t={},e)=>(e.type=xc.DSV,WT(r)),vg=(r,t={},e)=>(e.type=xc.DSV,YT(r));var zo=(r,t,e)=>{let i=!te(t?.dependencyUpdate)||t?.dependencyUpdate;if(!r||!H(r))throw new TypeError("Invalid data: must be DataView array!");return H(e.rawData)&&e.rawData.forEach(s=>{s.target&&(s.target.removeListener("change",e.reRunAllTransform),s.target.removeListener("markRunning",e.markRunning))}),i&&r.forEach(s=>{s.target.addListener("change",e.reRunAllTransform),s.target.addListener("markRunning",e.markRunning)}),r};var XT=0,e8=1e8;function by(r="dataset"){return XT>e8&&(XT=0),r+"_"+XT++}var Ar=class{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new lr.default,i=t?.name?t.name:by("dataset"),this.name=i,this._logger=(e=t?.logger)!==null&&e!==void 0?e:Nt.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${t} \u4E4B\u524D\u5DF2\u5B58\u5728\uFF0C\u8BF7\u91CD\u65B0\u547D\u540D`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} \u4E4B\u524D\u5DF2\u6CE8\u518C\uFF0C\u6267\u884C\u8986\u76D6\u903B\u8F91`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} \u4E4B\u524D\u5DF2\u6CE8\u518C\uFF0C\u6267\u884C\u8986\u76D6\u903B\u8F91`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let s=this._callMap.get(i);s||(s=()=>{t.some(n=>n.isRunning)||i()}),t.forEach(n=>{n.target.addListener(e,s)}),this._callMap.set(i,s)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){let s=this._callMap.get(i);s&&t.forEach(n=>{n.target.removeListener(e,s)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)})}multipleDataViewUpdateInRawData(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}};var KT="_data-view-diff-rank",St=class r{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new lr.default,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(s={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(n=>{this.executeTransform(n,{pushHistory:s.pushHistory,emitMessage:!1}),this.isLastTransform(n)&&this.diffLastData()}),this.isRunning=!1,s.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=e?.name?e.name:by("dataview"),this.name=i,e?.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(e?.fields)}parse(t,e,i=!1){var s;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);let n=this.cloneParseData(t,e);if(e?.type){let o=((s=this.dataSet.getParser(e.type))!==null&&s!==void 0?s:this.dataSet.getParser("bytejson"))(n,e.options,this);this.rawData=n,this.parserData=o,this.history&&this.historyData.push(n,o),this.latestData=o}else this.parserData=n,this.rawData=n,this.history&&this.historyData.push(n),this.latestData=n;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;let s=this.transformsArr.findIndex(n=>n.type===t.type);s>=0&&(i=!1,this.transformsArr[s].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){let s=this.isLastTransform(t);this.executeTransform(t),s&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((t,e)=>{var i,s;return((i=t.level)!==null&&i!==void 0?i:0)-((s=e.level)!==null&&s!==void 0?s:0)})}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){let{pushHistory:i,emitMessage:s}=e,n=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(n),this.latestData=n,s!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;let e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[KT]=e,this._diffMap.set(this._diffKeys.reduce((s,n)=>s+i[n],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(s=>{s[KT]=e,i=this._diffKeys.reduce((n,o)=>n+s[o],""),this._diffMap.get(i)?this.latestDataAUD.update.push(s):this.latestDataAUD.add.push(s),this._diffMap.set(i,s)}),this._diffMap.forEach((s,n)=>{s[KT]<e&&(this.latestDataAUD.del.push(s),this._diffMap.delete(n))})}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof r||e?.clone!==!0||(i=!0),i?li(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){let i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?G({},this._fields,t):t;let i=this.transformsArr.find(s=>s.type==="fields");!T(this._fields)&&T(i)?(this.dataSet.registerTransform("fields",mg),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}};var le=class r{static GenAutoIncrementId(){return r.auto_increment_id++}};le.auto_increment_id=0;var tt=class{constructor(t){this.id=le.GenAutoIncrementId(),this.registry=t}};var ja="named";var Sy="inject",Ay="multi_inject",Cy="inversify:tagged";var Ty="inversify:paramtypes";function i8(){return["inject","multi_inject","name","unmanaged","named","optional"]}var qat=i8();var za=class{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===ja?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}};var Go=function(r){var t,e;return function(i){let s=typeof Symbol=="function",n=s&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",o=Object.getPrototypeOf(Function),a=(typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL,Map),l=new WeakMap;function h(R,N,z,Y){if(!C(z))throw new TypeError;return v(R,N,z,Y)}function d(R,N,z){if(!C(N))throw new TypeError;return y(z)||(z=P(z)),m(R,N,z)}function c(R,N,z){if(!C(N))throw new TypeError;return y(z)||(z=P(z)),g(R,N,z)}function u(R,N,z){if(!C(N))throw new TypeError;return y(z)||(z=P(z)),f(R,N,z)}function p(R,N,z){let Y=l.get(R);if(y(Y)){if(!z)return;Y=new a,l.set(R,Y)}let U=Y.get(N);if(y(U)){if(!z)return;U=new a,Y.set(N,U)}return U}function m(R,N,z){if(g(R,N,z))return!0;let Y=w(N);return!b(Y)&&m(R,Y,z)}function g(R,N,z){let Y=p(N,z,!1);return!y(Y)&&E(Y.has(R))}function f(R,N,z){if(g(R,N,z))return _(R,N,z);let Y=w(N);return b(Y)?void 0:f(R,Y,z)}function _(R,N,z){let Y=p(N,z,!1);if(!y(Y))return Y.get(R)}function v(R,N,z,Y){p(z,Y,!0).set(R,N)}function x(R){if(R===null)return 1;switch(typeof R){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return R===null?1:6;default:return 6}}function y(R){return R===void 0}function b(R){return R===null}function S(R){return typeof R=="symbol"}function C(R){return typeof R=="object"?R!==null:typeof R=="function"}function k(R,N){switch(x(R)){case 0:case 1:case 2:case 3:case 4:case 5:return R}let z=N===3?"string":N===5?"number":"default",Y=L(R,n);if(Y!==void 0){let U=Y.call(R,z);if(C(U))throw new TypeError;return U}return M(R,z==="default"?"number":z)}function M(R,N){if(N==="string"){let z=R.toString;if(B(z)){let U=z.call(R);if(!C(U))return U}let Y=R.valueOf;if(B(Y)){let U=Y.call(R);if(!C(U))return U}}else{let z=R.valueOf;if(B(z)){let U=z.call(R);if(!C(U))return U}let Y=R.toString;if(B(Y)){let U=Y.call(R);if(!C(U))return U}}throw new TypeError}function E(R){return!!R}function D(R){return""+R}function P(R){let N=k(R,3);return S(N)?N:D(N)}function B(R){return typeof R=="function"}function L(R,N){let z=R[N];if(z!=null){if(!B(z))throw new TypeError;return z}}function w(R){let N=Object.getPrototypeOf(R);if(typeof R!="function"||R===o||N!==o)return N;let z=R.prototype,Y=z&&Object.getPrototypeOf(z);if(Y==null||Y===Object.prototype)return N;let U=Y.constructor;return typeof U!="function"||U===R?N:U}i("defineMetadata",h),i("hasMetadata",d),i("hasOwnMetadata",c),i("getMetadata",u)}((t=r,function(i,s){typeof t[i]!="function"&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:s}),e&&e(i,s)})),r}({});function s8(r,t,e,i){let s=[i],n={};Go.hasOwnMetadata(r,t)&&(n=Go.getMetadata(r,t));let o=n[e];o===void 0&&(o=[]),o.push(...s),n[e]=o,Go.defineMetadata(r,n,t)}function n8(r,t,e,i){s8(Cy,r,e.toString(),i)}function $T(r){return(t,e,i)=>{n8(t,e,i,r)}}function ky(r){return t=>(e,i,s)=>$T(new za(r,t))(e,i,s)}var lt=ky(Sy);var yg=ky(Ay);function q(){return function(r){return Go.defineMetadata(Ty,null,r),r}}function Zt(r){return $T(new za(ja,r))}var an={Singleton:"Singleton",Transient:"Transient"},ln={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};var My=class r{constructor(t,e){this.id=le.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=ln.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){let t=new r(this.serviceIdentifier,this.scope);return t.activated=t.scope===an.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}};var Dy=class{getConstructorMetadata(t){return{compilerGeneratedMetadata:Go.getMetadata(Ty,t),userGeneratedMetadata:Go.getMetadata(Cy,t)||{}}}getPropertiesMetadata(t){throw new Error("\u6682\u672A\u5B9E\u73B0")}};var o8=r=>t=>{let e=i=>{if(i==null)return!1;if(i.key===r&&i.value===t)return!0;if(i.constructorArgsMetadata==null)return!1;let s=i.constructorArgsMetadata;for(let n=0;n<s.length;n++)if(s[n].key===r&&s[n].value===t)return!0;return!1};return e.metaData=new za(r,t),e},PR=o8(ja);var Th=class{constructor(t){this._binding=t}inRequestScope(){throw new Error("\u6682\u672A\u5B9E\u73B0")}inSingletonScope(){return this._binding.scope=an.Singleton,this}inTransientScope(){return this._binding.scope=an.Transient,this}whenTargetNamed(t){return this._binding.constraint=PR(t),this}};var Ey=class{constructor(t){this._binding=t}to(t){return this._binding.type=ln.Instance,this._binding.implementationType=t,new Th(this._binding)}toSelf(){let t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=ln.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new Th(this._binding)}toConstantValue(t){return this._binding.type=ln.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=an.Singleton,new Th(this._binding)}toFactory(t){return this._binding.type=ln.Factory,this._binding.factory=t,this._binding.scope=an.Singleton,new Th(this._binding)}toService(t){this.toDynamicValue(e=>e.container.get(t))}};var xg=class{constructor(t){let e=t||{};e.defaultScope=e.defaultScope||an.Transient,this.options=e,this.id=le.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new Dy}load(t){let e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){let e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){let e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){let s=this._getNotAllArgs(t,!1,e,i);return this._get(s)}getNamed(t,e){return this.getTagged(t,ja,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){let e=this.options.defaultScope,i=new My(t,e),s=this._bindingDictionary.get(t)||[];return s.push(i),this._bindingDictionary.set(t,s),new Ey(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){let t=(o,a)=>{o._binding.moduleId=a},e=o=>a=>{let l=this.bind(a);return t(l,o),l},i=()=>o=>this.unbind(o),s=()=>o=>this.isBound(o),n=o=>a=>{let l=this.rebind(a);return t(l,o),l};return o=>({bindFunction:e(o),isboundFunction:s(),rebindFunction:n(o),unbindFunction:i(),unbindAsyncFunction:a=>null})}_getNotAllArgs(t,e,i,s){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:s}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){let e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter(i=>i.constraint(t)).forEach(i=>{e.push(this._resolveFromBinding(i))}),t.isMultiInject||e.length!==1?e:e[0]}_getChildRequest(t){let e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),s=Object.keys(i),n=[];for(let o=0;o<s.length;o++){let a=i[o],l={};a.forEach(p=>{l[p.key]=p.value});let h={inject:l[Sy],multiInject:l[Ay]},d=h.inject||h.multiInject,c={serviceIdentifier:d,constructorArgsMetadata:a},u=(this._bindingDictionary.get(d)||[]).filter(p=>p.constraint(c));if(u.length){let p={injectIdentifier:d,metadata:a,bindings:u};n.push(p)}}return n}_resolveFromBinding(t){let e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case ln.ConstantValue:case ln.Function:e=t.cache;break;case ln.Instance:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;let i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map(e=>e.bindings.length>1?e.bindings.map(i=>this._resolveFromBinding(i)):this._resolveFromBinding(e.bindings[0]))}_saveToScope(t,e){t.scope===an.Singleton&&(t.cache=e,t.activated=!0)}};var $t=Symbol("ContributionProvider"),wy=class{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}};function Me(r,t){r($t).toDynamicValue(({container:e})=>new wy(t,e)).inSingletonScope().whenTargetNamed(t)}function RR(r,t){r($t).toDynamicValue(({container:e})=>new wy(t,e)).whenTargetNamed(t)}var Py=class{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){let i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter(s=>!(s.name===i&&(!e||s.fn===e))))}_parseOptions(t,e,i){let s;if(typeof e=="string")s={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof s.name!="string"||s.name==="")throw new Error("Missing name for tap");return s=Object.assign({type:t,fn:i},s),s}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let s=this.taps.length;for(;s>0;){s--;let n=this.taps[s];this.taps[s+1]=n;let o=n.stage||0;if(e){if(e.has(n.name)){e.delete(n.name);continue}if(e.size>0)continue}if(!(o>i)){s++;break}}this.taps[s]=t}};var wi=class extends Py{call(...t){this.taps.map(e=>e.fn).forEach(e=>e(...t))}};var to=Symbol.for("EnvContribution"),Ga=Symbol.for("VGlobal"),BR="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol";var a8=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},l8=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},LR=function(r,t){return function(e,i){t(e,i,r)}},h8=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};var Ry=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(r){this._isImageAnonymous=r}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(r){this._env||this.setEnv("browser"),this.envContribution.supportEvent=r}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=r}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=r}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(r){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=r}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(r){this._env||this.setEnv("browser"),this.envContribution.applyStyles=r}constructor(r){this.contributions=r,this._isImageAnonymous=!0,this.id=le.GenAutoIncrementId(),this.hooks={onSetEnv:new wi(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(r){let t=[];if(this.contributions.getContributions().forEach(e=>{let i=e.configure(this,r);i&&i.then&&t.push(i)}),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(r,t){if(t&&t.force===!0||this._env!==r)return this.deactiveCurrentEnv(),this.activeEnv(r,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(r,t){let e=this._env;this._env=r;let i=this.bindContribution(t);if(i&&i.then)return i.then(()=>{this.envParams=t,this.hooks.onSetEnv.call(e,r,this)});this.envParams=t,this.hooks.onSetEnv.call(e,r,this)}setActiveEnvContribution(r){this.envContribution=r}createCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(r)}createOffscreenCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(r)}releaseCanvas(r){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(r)}addEventListener(r,t,e){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(r,t,e)}removeEventListener(r,t,e){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(r,t,e)}dispatchEvent(r){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(r)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(r){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(r):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(r,t){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(r,t):null}loadImage(r){return this._env||this.setEnv("browser"),this.envContribution.loadImage(r)}loadSvg(r){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(r)}loadJson(r){return this._env||this.setEnv("browser"),this.envContribution.loadJson(r)}loadArrayBuffer(r){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(r)}loadBlob(r){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(r)}loadFont(r,t,e){return h8(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(r,t,e)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(r){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(r)}removeDom(r){return this._env||this.setEnv("browser"),this.envContribution.removeDom(r)}createDom(r){return this._env||this.setEnv("browser"),this.envContribution.createDom(r)}updateDom(r,t){return this._env||this.setEnv("browser"),this.envContribution.updateDom(r,t)}getElementTop(r,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(r,t)}getElementLeft(r,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(r,t)}getElementTopLeft(r,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(r,t)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(r){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(r)}};Ry=a8([q(),LR(0,lt($t)),LR(0,Zt(to)),l8("design:paramtypes",[Object])],Ry);var IR;(function(r){r[r.W=1]="W",r[r.H=2]="H",r[r.WH=3]="WH"})(IR||(IR={}));var eo;(function(r){r[r.estimate=0]="estimate",r[r.actualBounding=1]="actualBounding",r[r.fontBounding=2]="fontBounding"})(eo||(eo={}));var d8=gi-1e-8,Ua=class{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,s,n,o){if(Math.abs(n-s)>d8)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let a,l,h,d,c=1/0,u=-1/0,p=1/0,m=-1/0;function g(f){h=i*Math.cos(f),d=i*Math.sin(f),h<c&&(c=h),h>u&&(u=h),d<p&&(p=d),d>m&&(m=d)}if(g(s),g(n),n!==s)if((s%=gi)<0&&(s+=gi),(n%=gi)<0&&(n+=gi),n<s&&(o=!o,a=s,s=n,n=a),o)for(n-=gi,a=s-s%br,l=0;l<4&&a>n;++l,a-=br)g(a);else for(a=s-s%br+br,l=0;l<4&&a<n;++l,a+=br)g(a);this.bounds.add(t+c,e+p),this.bounds.add(t+u,e+m)}arcTo(t,e,i,s,n){this.bounds.add(t,e)}bezierCurveTo(t,e,i,s,n,o){this.bounds.add(t,e),this.bounds.add(i,s),this.bounds.add(n,o)}closePath(){}ellipse(){throw new Error("\u4E0D\u652F\u6301ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,s){this.bounds.add(t,e),this.bounds.add(i,s)}rect(t,e,i,s){this.bounds.add(t,e),this.bounds.add(t+i,e+s)}clear(){this.bounds.clear()}release(...t){}};var By=class{constructor(){this._curves=[],this.bounds=new ie}get curves(){return this._curves}getCurveLengths(){return this._curves.map(t=>t.getLength())}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}};var c8=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,u8={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},qt={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8},qT,FR,Ly,OR,ZT,Iy;function HR(r){if(!r)return[];let t=r.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let e,i,s=[];for(let n=0,o=t.length;n<o;n++)if(qT=t[n],FR=qT.slice(1),Ly=qT[0],e=[Ly],i=FR.match(c8),i!==null){for(let a=0,l=i.length;a<l;a++)OR=i[a],ZT=parseFloat(OR),Number.isNaN(ZT)||e.push(ZT);if(Iy=u8[Ly],e.length-1>Iy){let a,l=Ly;for(let h=1,d=e.length;h<d;h+=Iy){a=[l];for(let c=h,u=h+Iy;c<u;c++)a.push(e[c]);s.push(a),l==="m"?l="l":l==="M"&&(l="L")}}else s.push(e)}else s.push(e);return s}var De;(function(r){r[r.NONE=0]="NONE",r[r.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",r[r.UPDATE_SHAPE=2]="UPDATE_SHAPE",r[r.CLEAR_SHAPE=253]="CLEAR_SHAPE",r[r.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",r[r.INIT=179]="INIT",r[r.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",r[r.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",r[r.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",r[r.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",r[r.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",r[r.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",r[r.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",r[r.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(De||(De={}));var io;(function(r){r[r.GLOBAL=1]="GLOBAL",r[r.LOCAL=16]="LOCAL",r[r.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",r[r.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(io||(io={}));var fi;(function(r){r[r.INIT=0]="INIT",r[r.DEFAULT=1]="DEFAULT",r[r.STATE=2]="STATE",r[r.ANIMATE_BIND=10]="ANIMATE_BIND",r[r.ANIMATE_PLAY=11]="ANIMATE_PLAY",r[r.ANIMATE_START=12]="ANIMATE_START",r[r.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",r[r.ANIMATE_END=14]="ANIMATE_END",r[r.TRANSLATE=20]="TRANSLATE",r[r.TRANSLATE_TO=21]="TRANSLATE_TO",r[r.SCALE=22]="SCALE",r[r.SCALE_TO=23]="SCALE_TO",r[r.ROTATE=24]="ROTATE",r[r.ROTATE_TO=25]="ROTATE_TO"})(fi||(fi={}));var er;(function(r){r[r.INITIAL=0]="INITIAL",r[r.RUNNING=1]="RUNNING",r[r.PAUSED=2]="PAUSED",r[r.END=3]="END"})(er||(er={}));var kh;(function(r){r[r.NORMAL=0]="NORMAL",r[r.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(kh||(kh={}));var Mh;(function(r){r.wait="wait",r.from="from",r.to="to",r.customAnimate="customAnimate"})(Mh||(Mh={}));var se;(function(r){r[r.ROW=1]="ROW",r[r.COLUMN=2]="COLUMN"})(se||(se={}));var Wa;(function(r){r[r.CubicBezierCurve=0]="CubicBezierCurve",r[r.QuadraticBezierCurve=1]="QuadraticBezierCurve",r[r.ArcCurve=2]="ArcCurve",r[r.LineCurve=3]="LineCurve",r[r.EllipseCurve=4]="EllipseCurve",r[r.MoveCurve=5]="MoveCurve"})(Wa||(Wa={}));var Ee;(function(r){r[r.beforeFillStroke=0]="beforeFillStroke",r[r.afterFillStroke=1]="afterFillStroke"})(Ee||(Ee={}));function p8(r,t,e,i,s,n,o,a,l){let h=Ut(o),d=Math.sin(h),c=Math.cos(h),u=c*(a-r)*.5+d*(l-t)*.5,p=c*(l-t)*.5-d*(a-r)*.5,m=u*u/((e=Math.abs(e))*e)+p*p/((i=Math.abs(i))*i);m>1&&(m=Math.sqrt(m),e*=m,i*=m);let g=c/e,f=d/e,_=-d/i,v=c/i,x=g*a+f*l,y=_*a+v*l,b=g*r+f*t,S=_*r+v*t,C=1/((b-x)*(b-x)+(S-y)*(S-y))-.25;C<0&&(C=0);let k=Math.sqrt(C);n===s&&(k=-k);let M=.5*(x+b)-k*(S-y),E=.5*(y+S)+k*(b-x),D=Math.atan2(y-E,x-M),P=Math.atan2(S-E,b-M)-D;P<0&&n===1?P+=gi:P>0&&n===0&&(P-=gi);let B=Math.ceil(Math.abs(P/(br+.001))),L=[];for(let w=0;w<B;++w){let R=D+w*P/B,N=D+(w+1)*P/B;L[w]=[M,E,R,N,e,i,d,c]}return L}function m8(r){let t=r[0],e=r[1],i=r[2],s=r[3],n=r[4],o=r[5],a=r[6],l=r[7],h=l*n,d=-a*o,c=a*n,u=l*o,p=Math.cos(i),m=Math.sin(i),g=Math.cos(s),f=Math.sin(s),_=.5*(s-i),v=Math.sin(.5*_),x=8/3*v*v/Math.sin(_),y=t+p-x*m,b=e+m+x*p,S=t+g,C=e+f,k=S+x*f,M=C-x*g;return[h*y+d*b,c*y+u*b,h*k+d*M,c*k+u*M,h*S+d*C,c*S+u*C]}function JT(r,t,e,i){let s=p8(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let n=0;n<s.length;++n){let o=m8(s[n]);r.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var QT=(r,t,e,i,s,n,o)=>{let a=Math.abs(e-t),l=a>.5*Math.PI?Math.ceil(2*a/Math.PI):1,h=(e-t)/l;for(let d=0;d<l;d++){let c=t+h*d,u=t+h*(d+1),p=4*Math.tan(Math.abs(h)/4)/3,m=u<c?-1:1,g=Math.cos(c),f=Math.sin(c),_=Math.cos(u),v=Math.sin(u),x=g*n+i,y=f*o+s,b=_*n+i,S=v*o+s,C=n*p*m,k=o*p*m;r.push(x-C*f,y+k*g,b+C*v,S-k*_,b,S)}};var g8=[(r,t,e,i,s,n,o)=>t.arc(r[1]*s+e,r[2]*n+i,r[3]*(s+n)/2,r[4],r[5],r[6],o),(r,t,e,i,s,n,o)=>t.arcTo(r[1]*s+e,r[2]*n+i,r[3]*s+e,r[4]*n+i,r[5]*(s+n)/2,o),(r,t,e,i,s,n,o)=>t.bezierCurveTo(r[1]*s+e,r[2]*n+i,r[3]*s+e,r[4]*n+i,r[5]*s+e,r[6]*n+i,o),(r,t,e,i)=>t.closePath(),(r,t,e,i,s,n)=>t.ellipse(r[1]*s+e,r[2]*n+i,r[3]*s,r[4]*n,r[5],r[6],r[7],r[8]),(r,t,e,i,s,n,o)=>t.lineTo(r[1]*s+e,r[2]*n+i,o),(r,t,e,i,s,n,o)=>t.moveTo(r[1]*s+e,r[2]*n+i,o),(r,t,e,i,s,n,o)=>t.quadraticCurveTo(r[1]*s+e,r[2]*n+i,r[3]*s+e,r[4]*n+i,o),(r,t,e,i,s,n,o)=>t.rect(r[1]*s+e,r[2]*n+i,r[3]*s,r[4]*n,o)];function Lr(r,t,e=0,i=0,s=1,n=1,o){for(let a=0;a<r.length;a++){let l=r[a];g8[l[0]](l,t,e,i,s,n,o)}}var Ya=class{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}};function jR(r,t){let e=0,i=r.length;for(let s=0;s<i;s++){let n=r[s],o=t[s],a=r[(s+1)%i],l=t[(s+1)%i];e+=pe.distanceNN(n,o,a,l)}return e/2}function zR(r,t,e,i,s){return jR([r.x,t.x,e.x,i.x],[r.y,t.y,e.y,i.y])}function NR(r,t,e,i,s){let n=1-s;return n*n*n*r+3*t*s*n*n+3*e*s*s*n+i*s*s*s}function tk(r,t,e,i,s){let n=NR(r.x,t.x,e.x,i.x,s),o=NR(r.y,t.y,e.y,i.y,s);return new Xt(n,o)}function VR(r,t,e,i){let s=1-i;return s*s*r+2*s*i*t+i*i*e}function Fy(r,t,e,i){let s=VR(r.x,t.x,e.x,i),n=VR(r.y,t.y,e.y,i);return new Xt(s,n)}function GR(r,t,e,i){return jR([r.x,t.x,e.x],[r.y,t.y,e.y])}var Dh=class extends Ya{constructor(t,e,i){super(),this.type=Wa.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(this.defined!==!1)return Fy(this.p0,this.p1,this.p2,t);throw new Error("defined\u4E3Afalse\u7684\u70B9\u4E0D\u80FDgetPointAt")}calcLength(){return this._validPoint()?GR(this.p0,this.p1,this.p2,0):60}calcProjLength(t){return t===se.ROW?Dt(this.p0.x-this.p2.x):t===se.COLUMN?Dt(this.p0.y-this.p2.y):0}getAngleAt(t){let e=ri(t-.01,0),i=Ge(t+.01,1),s=this.getPointAt(e),n=this.getPointAt(i);return ae(n.y-s.y,n.x-s.x)}draw(t,e,i,s,n,o){if(t.moveTo(this.p0.x*s+e,this.p0.y*n+i),o>=1)t.quadraticCurveTo(this.p1.x*s+e,this.p1.y*n+i,this.p2.x*s+e,this.p2.y*n+i);else if(o>0){let[a]=UR(this,o);t.quadraticCurveTo(a.p1.x*s+e,a.p1.y*n+i,a.p2.x*s+e,a.p2.y*n+i)}}getYAt(t){throw new Error("QuadraticBezierCurve\u6682\u4E0D\u652F\u6301getYAt")}includeX(t){throw new Error("QuadraticBezierCurve\u6682\u4E0D\u652F\u6301includeX")}};function Eh(r,t){let{p0:e,p1:i,p2:s,p3:n}=r,o=tk(e,i,s,n,t),a=pe.pointAtPP(e,i,t),l=pe.pointAtPP(i,s,t),h=pe.pointAtPP(s,n,t),d=pe.pointAtPP(a,l,t),c=pe.pointAtPP(l,h,t);return[new Xa(e,a,d,o),new Xa(o,c,h,n)]}function UR(r,t){let{p0:e,p1:i,p2:s}=r,n=Fy(e,i,s,t),o=pe.pointAtPP(e,i,t),a=pe.pointAtPP(i,s,t);return[new Dh(e,o,n),new Dh(n,a,s)]}var Xa=class extends Ya{constructor(t,e,i,s){super(),this.type=Wa.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=s}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return tk(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined\u4E3Afalse\u7684\u70B9\u4E0D\u80FDgetPointAt")}calcLength(){return this._validPoint()?zR(this.p0,this.p1,this.p2,this.p3,0):60}calcProjLength(t){return t===se.ROW?Dt(this.p0.x-this.p3.x):t===se.COLUMN?Dt(this.p0.y-this.p3.y):0}getAngleAt(t){let e=ri(t-.01,0),i=Ge(t+.01,1),s=this.getPointAt(e),n=this.getPointAt(i);return ae(n.y-s.y,n.x-s.x)}draw(t,e,i,s,n,o){if(t.moveTo(this.p0.x*s+e,this.p0.y*n+i),o>=1)t.bezierCurveTo(this.p1.x*s+e,this.p1.y*n+i,this.p2.x*s+e,this.p2.y*n+i,this.p3.x*s+e,this.p3.y*n+i);else if(o>0){let[a]=Eh(this,o);t.bezierCurveTo(a.p1.x*s+e,a.p1.y*n+i,a.p2.x*s+e,a.p2.y*n+i,a.p3.x*s+e,a.p3.y*n+i)}}includeX(t){let e=Ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=ri(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){let e=Ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(ri(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}};function ek(r,t){let{p0:e,p1:i}=r,s=pe.pointAtPP(e,i,t);return[new Ka(e,s),new Ka(s,i)]}var Ka=class extends Ya{constructor(t,e){super(),this.type=Wa.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return pe.pointAtPP(this.p0,this.p1,t);throw new Error("defined\u4E3Afalse\u7684\u70B9\u4E0D\u80FDgetPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=ae(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?pe.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===se.ROW?Dt(this.p0.x-this.p1.x):t===se.COLUMN?Dt(this.p0.y-this.p1.y):0}draw(t,e,i,s,n,o){if(t.moveTo(this.p0.x*s+e,this.p0.y*n+i),o>=1)t.lineTo(this.p1.x*s+e,this.p1.y*n+i);else if(o>0){let a=this.getPointAt(o);t.lineTo(a.x*s+e,a.y*n+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);let s=(t-e.x)/(i.x-e.x);return e.y+s*(i.y-e.y)}return 1/0}};var wh=class{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,s,n,o,a,l){let h=new Xa(new Xt(this._lastX,this._lastY),new Xt(t,e),new Xt(i,s),new Xt(n,o));h.originP1=this._lastOriginP,h.originP2=l,h.defined=a,this.curves.push(h),this._lastX=n,this._lastY=o,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;let t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext\u4E0D\u652F\u6301\u8C03\u7528ellipse")}lineTo(t,e,i,s){let n=this.addLinearCurve(t,e,i,this._lastOriginP,s);this.curves.push(n),this._lastX=t,this._lastY=e,this._lastOriginP=s}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,s){throw new Error("SegContext\u4E0D\u652F\u6301\u8C03\u7528quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,s,n){let o=new Ka(new Xt(this._lastX,this._lastY),new Xt(t,e));return o.originP1=s,o.originP2=n,o.defined=i,o}getPointAt(t){throw new Error("\u6682\u672A\u5B9E\u73B0")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===se.COLUMN){if(!this.curves.length)return 0;let s=this.curves[0],n=this.curves[this.curves.length-1],o=(e=n.p3)!==null&&e!==void 0?e:n.p1;return Dt(s.p0.y-o.y)}if(t===se.ROW){if(!this.curves.length)return 0;let s=this.curves[0],n=this.curves[this.curves.length-1],o=(i=n.p3)!==null&&i!==void 0?i:n.p1;return Dt(s.p0.x-o.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((s,n)=>s+n.getLength(),0)),this.length}},Oy=class extends wh{bezierCurveTo(t,e,i,s,n,o,a,l){return super.bezierCurveTo(e,t,s,i,o,n,a,l)}lineTo(t,e,i,s){return super.lineTo(e,t,i,s)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}};function ms(r,t,e=1){let i=!1;for(let s=0,n=t.length;s<=n;s++)s>=n===i&&((i=!i)?r.lineStart():r.lineEnd()),i&&r.point(t[s])}function hn(r,t,e){let i=t??(Dt(e[e.length-1].x-e[0].x)>Dt(e[e.length-1].y-e[0].y)?se.ROW:se.COLUMN);return r==="monotoneY"?new Oy(r,i):new wh(r,i)}var bg=class{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}};function Uo(r,t={}){let{direction:e,startPoint:i}=t;if(r.length<2-+!!i)return null;let s=hn("linear",e,r);return f8(new bg(s,i),r),s}function f8(r,t){return ms(r,t,1)}function WR(r,t,e,i,s){r.context.bezierCurveTo((2*r._x0+r._x1)/3,(2*r._y0+r._y1)/3,(r._x0+2*r._x1)/3,(r._y0+2*r._y1)/3,(r._x0+4*r._x1+t)/6,(r._y0+4*r._y1+e)/6,i,r.lastPoint1)}var ik=class{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&WR(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:WR(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function _8(r,t){return ms(r,t,2)}function YR(r,t={}){let{direction:e,startPoint:i}=t;if(r.length<2-+!!i)return null;if(r.length<3-+!!i)return Uo(r,t);let s=hn("basis",e,r);return _8(new ik(s,i),r),s}function XR(r){return r<0?-1:1}function KR(r,t,e){let i=r._x1-r._x0,s=t-r._x1,n=(r._y1-r._y0)/(i||Number(s<0&&-0)),o=(e-r._y1)/(s||Number(i<0&&-0)),a=(n*s+o*i)/(i+s);return(XR(n)+XR(o))*Math.min(Math.abs(n),Math.abs(o),.5*Math.abs(a))||0}function $R(r,t){let e=r._x1-r._x0;return e?(3*(r._y1-r._y0)/e-t)/2:t}function rk(r,t,e,i,s){let n=r._x0,o=r._y0,a=r._x1,l=r._y1,h=(a-n)/3;r.context.bezierCurveTo(n+h,o+h*t,a-h,l-h*e,a,l,i,r.lastPoint1)}var Hy=class{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:rk(this,this._t0,$R(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN,i=t.x,s=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,s,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,s,t);break;case 1:this._point=2;break;case 2:this._point=3,rk(this,$R(this,e=KR(this,i,s)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1,t);break;default:rk(this,this._t0,e=KR(this,i,s),this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=s,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}},sk=class extends Hy{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}};function v8(r,t){return ms(r,t,2)}function qR(r,t={}){let{direction:e,startPoint:i}=t;if(r.length<2-+!!i)return null;if(r.length<3-+!!i)return Uo(r,t);let s=hn("monotoneX",e,r);return v8(new Hy(s,i),r),s}function y8(r,t){return ms(r,t,2)}function ZR(r,t={}){let{direction:e,startPoint:i}=t;if(r.length<2-+!!i)return null;if(r.length<3-+!!i)return Uo(r,t);let s=hn("monotoneY",e,r);return y8(new sk(s,i),r),s}var nk=class{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){let e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t);else{let s=this._x*(1-this._t)+e*this._t;this._t===.5?this.context.lineTo(s,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(s,this._y,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(s,i,this._lastDefined!==!1&&t.defined!==!1,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function Ny(r,t,e={}){let{direction:i,startPoint:s}=e;if(r.length<2-+!!s)return null;let n=new wh("step",i??(Dt(r[r.length-1].x-r[0].x)>Dt(r[r.length-1].y-r[0].y)?se.ROW:se.COLUMN));return x8(new nk(n,t,s),r),n}function x8(r,t){return ms(r,t,1)}var ok=class extends bg{lineEnd(){this.context.closePath()}};function JR(r,t={}){let{direction:e,startPoint:i}=t;if(r.length<2-+!!i)return null;let s=hn("linear",e,r);return b8(new ok(s,i),r),s}function b8(r,t){return ms(r,t,1)}function lk(r,t,e,i,s){let n=r._x1,o=r._y1,a=r._x2,l=r._y2;if(r._l01_a>1e-12){let h=2*r._l01_2a+3*r._l01_a*r._l12_a+r._l12_2a,d=3*r._l01_a*(r._l01_a+r._l12_a);n=(n*h-r._x0*r._l12_2a+r._x2*r._l01_2a)/d,o=(o*h-r._y0*r._l12_2a+r._y2*r._l01_2a)/d}if(r._l23_a>1e-12){let h=2*r._l23_2a+3*r._l23_a*r._l12_a+r._l12_2a,d=3*r._l23_a*(r._l23_a+r._l12_a);a=(a*h+r._x1*r._l23_2a-t*r._l12_2a)/d,l=(l*h+r._y1*r._l23_2a-e*r._l12_2a)/d}r.context.bezierCurveTo(n,o,a,l,r._x2,r._y2,i,r.lastPoint1)}var ak=class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let{x:e,y:i}=t;if(this._point){let s=this._x2-e,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(s*s+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:lk(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function hk(r,t){return function(e,i,s={}){let{direction:n,startPoint:o}=s;if(e.length<2-+!!o)return null;if(e.length<3-+!!o)return Uo(e,s);let a=hn(r,n,e),l=new t(a,i,o);return ms(l,e,2),a}}var QR=hk("catmullRom",ak);var dk=class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){let{x:e,y:i}=t;if(this._point){let s=this._x2-e,n=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(s*s+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:lk(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}},tB=hk("catmullRomClosed",dk);var Sg=class{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){let i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new Ka(new Xt(this._lastX,this._lastY),new Xt(t,e))}quadraticCurveTo(t,e,i,s){let n=new Dh(new Xt(this._lastX,this._lastY),new Xt(t,e),new Xt(i,s));this.path.addCurve(n),this._lastX=i,this._lastY=s}bezierCurveTo(t,e,i,s,n,o){let a=new Xa(new Xt(this._lastX,this._lastY),new Xt(t,e),new Xt(i,s),new Xt(n,o));this.path.addCurve(a),this._lastX=n,this._lastY=o}arcTo(t,e,i,s,n){throw new Error("CurveContext\u4E0D\u652F\u6301\u8C03\u7528arcTo")}ellipse(t,e,i,s,n,o,a,l){throw new Error("CurveContext\u4E0D\u652F\u6301\u8C03\u7528ellipse")}rect(t,e,i,s){throw new Error("CurveContext\u4E0D\u652F\u6301\u8C03\u7528rect")}arc(t,e,i,s,n,o){throw new Error("CurveContext\u4E0D\u652F\u6301\u8C03\u7528arc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}};function ro(r,t,e){var i,s;switch(t){case"linear":default:return Uo(r,e);case"basis":return YR(r,e);case"monotoneX":return qR(r,e);case"monotoneY":return ZR(r,e);case"step":return Ny(r,.5,e);case"stepBefore":return Ny(r,0,e);case"stepAfter":return Ny(r,1,e);case"catmullRom":return QR(r,(i=e?.curveTension)!==null&&i!==void 0?i:.5,e);case"catmullRomClosed":return tB(r,(s=e?.curveTension)!==null&&s!==void 0?s:.5,e);case"linearClosed":return JR(r,e)}}var ne=class extends By{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new Ua(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([qt.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([qt.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,s){return this.commandList.push([qt.Q,t,e,i,s]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,s),this}bezierCurveTo(t,e,i,s,n,o){return this.commandList.push([qt.C,t,e,i,s,n,o]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,s,n,o),this}arcTo(t,e,i,s,n){return this.commandList.push([qt.AT,t,e,i,s,n]),this._ctx&&this._ctx.arcTo(t,e,i,s,n),this}ellipse(t,e,i,s,n,o,a,l){return this.commandList.push([qt.E,t,e,i,s,n,o,a,l]),this._ctx&&this._ctx.ellipse(t,e,i,s,n,o,a,l),this}rect(t,e,i,s){return this.commandList.push([qt.R,t,e,i,s]),this._ctx&&this._ctx.rect(t,e,i,s),this}arc(t,e,i,s,n,o){return this.commandList.push([qt.A,t,e,i,s,n,o]),this._ctx&&this._ctx.arc(t,e,i,s,n,o),this}closePath(){return this.commandList.push([qt.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){let t=new Sg(this);Lr(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){let i=[];i[qt.M]=s=>`M${s[1]} ${s[2]}`,i[qt.L]=s=>`L${s[1]} ${s[2]}`,i[qt.Q]=s=>`Q${s[1]} ${s[2]} ${s[3]} ${s[4]}`,i[qt.C]=s=>`C${s[1]} ${s[2]} ${s[3]} ${s[4]} ${s[5]} ${s[6]}`,i[qt.A]=s=>{let n=[];QT(n,s[4],s[5],s[1],s[2],s[3],s[3]);let o="";for(let a=0;a<n.length;a+=6)o+=`C${n[a]} ${n[a+1]} ${n[a+2]} ${n[a+3]} ${n[a+4]} ${n[a+5]}`;return o},i[qt.R]=s=>`M${s[1]} ${s[2]} h${s[3]} v${s[4]} H${s[1]}Z`,i[qt.Z]=s=>"Z",this.toStringCbList=i}let t=this.toStringCbList,e="";return this.commandList.forEach(i=>{e+=t[i[0]](i)}),e}fromString(t,e,i,s,n){this.clear();let o=HR(t);return this._runCommandStrList(o,e,i,s,n),this._updateBounds(),this}fromLine(t){let{points:e,curveType:i,clipRangeByDimension:s}=t.attribute;if(!e)return;let n=ro(e,i);s==="x"?this.direction=se.ROW:s==="y"?this.direction=se.COLUMN:s==="auto"&&(this.direction=n.direction),this._curves=n.curves}fromCustomPath2D(t,e,i,s,n){return this.clear(),this._runCommandList(t.commandList,e,i,s,n),this._updateBounds(),this}transform(t,e,i,s){let n=this.commandList;if(!this.transformCbList){let o=[];o[qt.M]=this.moveToTransform,o[qt.L]=this.lineToTransform,o[qt.Q]=this.quadraticCurveToTransform,o[qt.C]=this.bezierCurveToTransform,o[qt.AT]=this.arcToTransform,o[qt.E]=this.ellipseTransform,o[qt.R]=this.rectTransform,o[qt.A]=this.arcTransform,o[qt.Z]=this.closePathTransform,this.transformCbList=o}n.forEach(o=>{this.transformCbList[o[0]](o,t,e,i,s)}),this._updateBounds()}moveToTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i}lineToTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i}quadraticCurveToTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*s+e,t[4]=t[4]*n+i}bezierCurveToTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*s+e,t[4]=t[4]*n+i,t[5]=t[5]*s+e,t[6]=t[6]*n+i}arcToTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*s+e,t[4]=t[4]*n+i,t[5]=t[5]*(s+n)/2}ellipseTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*s,t[4]=t[4]*n}rectTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*s,t[4]=t[4]*n}arcTransform(t,e,i,s,n){t[1]=t[1]*s+e,t[2]=t[2]*n+i,t[3]=t[3]*(s+n)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,s=1,n=1){let o,a,l,h,d,c=null,u=0,p=0,m=0,g=0;for(let f=0,_=t.length;f<_;++f){switch(o=t[f],s===1&&n===1||(o=S8(o,s,n)),o[0]){case"l":u+=o[1],p+=o[2],this.lineTo(u+e,p+i);break;case"L":u=o[1],p=o[2],this.lineTo(u+e,p+i);break;case"h":u+=o[1],this.lineTo(u+e,p+i);break;case"H":u=o[1],this.lineTo(u+e,p+i);break;case"v":p+=o[1],this.lineTo(u+e,p+i);break;case"V":p=o[1],this.lineTo(u+e,p+i);break;case"m":u+=o[1],p+=o[2],this.moveTo(u+e,p+i);break;case"M":u=o[1],p=o[2],this.moveTo(u+e,p+i);break;case"c":a=u+o[5],l=p+o[6],m=u+o[3],g=p+o[4],this.bezierCurveTo(u+o[1]+e,p+o[2]+i,m+e,g+i,a+e,l+i),u=a,p=l;break;case"C":u=o[5],p=o[6],m=o[3],g=o[4],this.bezierCurveTo(o[1]+e,o[2]+i,m+e,g+i,u+e,p+i);break;case"s":a=u+o[3],l=p+o[4],c[0].match(/[CcSs]/)===null?(m=u,g=p):(m=2*u-m,g=2*p-g),h=u+o[1],d=p+o[2],this.bezierCurveTo(m+e,g+i,h+e,d+i,a+e,l+i),m=h,g=d,u=a,p=l;break;case"S":a=o[3],l=o[4],c[0].match(/[CcSs]/)===null?(m=u,g=p):(m=2*u-m,g=2*p-g),h=o[1],d=o[2],this.bezierCurveTo(m+e,g+i,h+e,d+i,a+e,l+i),m=h,g=d,u=a,p=l;break;case"q":a=u+o[3],l=p+o[4],m=u+o[1],g=p+o[2],this.quadraticCurveTo(m+e,g+i,a+e,l+i),u=a,p=l;break;case"Q":a=o[3],l=o[4],this.quadraticCurveTo(o[1]+e,o[2]+i,a+e,l+i),u=a,p=l,m=o[1],g=o[2];break;case"t":a=u+o[1],l=p+o[2],c[0].match(/[QqTt]/)===null?(m=u,g=p):c[0]==="t"?(m=2*u-h,g=2*p-d):c[0]==="q"&&(m=2*u-m,g=2*p-g),h=m,d=g,this.quadraticCurveTo(m+e,g+i,a+e,l+i),u=a,p=l,m=u+o[1],g=p+o[2];break;case"T":a=o[1],l=o[2],m=2*u-m,g=2*p-g,this.quadraticCurveTo(m+e,g+i,a+e,l+i),u=a,p=l;break;case"a":JT(this,u+e,p+i,[o[1],o[2],o[3],o[4],o[5],o[6]+u+e,o[7]+p+i]),u+=o[6],p+=o[7];break;case"A":JT(this,u+e,p+i,[o[1],o[2],o[3],o[4],o[5],o[6]+e,o[7]+i]),u=o[6],p=o[7];break;case"z":case"Z":this.closePath()}c=o}}_runCommandList(t,e=0,i=0,s=1,n=1){if(e!==0||i!==0||s!==1||n!==1)for(let o=0,a=t.length;o<a;++o){let l=t[o].slice();switch(l[0]){case qt.L:this.lineToTransform(l,e,i,s,n);break;case qt.M:this.moveToTransform(l,e,i,s,n);break;case qt.C:this.bezierCurveToTransform(l,e,i,s,n);break;case qt.Q:this.quadraticCurveToTransform(l,e,i,s,n);break;case qt.A:this.arcToTransform(l,e,i,s,n);break;case qt.E:this.ellipseTransform(l,e,i,s,n);break;case qt.R:this.rectTransform(l,e,i,s,n);break;case qt.AT:this.arcToTransform(l,e,i,s,n);break;case qt.Z:this.closePath()}}else this.commandList=t.map(o=>o.slice())}_updateBounds(){this.bounds.clear(),Lr(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===se.COLUMN){if(!this._curves.length)return 0;let t=this._curves[0],e=this._curves[this._curves.length-1];return Dt(t.p0.y-e.p1.y)}if(this.direction===se.ROW){if(!this._curves.length)return 0;let t=this._curves[0],e=this._curves[this._curves.length-1];return Dt(t.p0.x-e.p1.x)}return this._curves.reduce((t,e)=>t+e.getLength(),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){let i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let n=0;n<this._curves.length;n++){e=this._curves[n];let o=e.getLength(this.direction);if(i+o>=t)break;i+=o}let s=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(s),angle:e.getAngleAt(s)}}drawWithClipRange(t,e,i,s,n){this.tryBuildCurves();let o=this.getLength()*n,a=0;for(let l=0;l<this._curves.length;l++){let h=this._curves[l],d=h.getLength(this.direction);if(!(a+d<=o)){let c=1-(a+d-o)/d;h.draw(t,i,s,e,e,c);break}h.draw(t,i,s,e,e,1),a+=d}}},Ls=["l",0,0,0,0,0,0,0];function S8(r,t,e){let i=Ls[0]=r[0];if(i==="a"||i==="A")Ls[1]=t*r[1],Ls[2]=e*r[2],Ls[3]=r[3],Ls[4]=r[4],Ls[5]=r[5],Ls[6]=t*r[6],Ls[7]=e*r[7];else if(i==="h"||i==="H")Ls[1]=t*r[1];else if(i==="v"||i==="V")Ls[1]=e*r[1];else for(let s=1,n=r.length;s<n;++s)Ls[s]=(s%2==1?t:e)*r[s];return Ls}var A8={alignSelf:"auto"},Pi={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Kt},uk={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},ck={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},pk=Object.assign({outerBorder:Object.assign(Object.assign({},ck),{distance:0}),innerBorder:Object.assign(Object.assign({},ck),{distance:0})},ck),Ir={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"\u2026",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:eo.fontBounding,keepCenterInLine:!1},C8={pickStrokeBuffer:0},T8=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null},uk),pk),A8),C8),eB={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},k8={_debug_bounds:!1},Je=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null},k8),T8),Pi);var iB=Object.assign(Object.assign({},Je),{startAngle:0,endAngle:vt,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),rB=Object.assign(Object.assign(Object.assign({},Je),eB),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),sB=Object.assign(Object.assign({},Je),{radius:1,startAngle:0,endAngle:vt}),nB=Object.assign(Object.assign({},Je),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),oB=Object.assign(Object.assign({},Je),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),aB=Object.assign(Object.assign(Object.assign({},Je),eB),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),lB=Object.assign(Object.assign({},Je),{path:new ne,fillStrokeOrder:1,clipRange:1,customPath:()=>{Nt.getInstance().warn("\u7A7A\u51FD\u6570")}}),hB=Object.assign(Object.assign({},Je),{points:[],cornerRadius:0,closePath:!0}),dB=Object.assign(Object.assign({},Je),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"}),$ct=Object.assign(Object.assign({},Je),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"}),cB=Object.assign(Object.assign({},Je),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),Vy=Object.assign(Object.assign(Object.assign({},Je),Ir),{strokeBoundsBuffer:0,keepDirIn3d:!0}),dn=Object.assign(Object.assign(Object.assign({},Je),Ir),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),$a=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},Je),{fill:!0,cornerRadius:0,cornerType:"round"}),uB=Object.assign(Object.assign({},$a),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});var mk=class{},j=new mk;var M8=function(){let r={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},t="";function e(y){let b=new Error(t+": "+y);throw b.source=t,b}function i(){let y=p(s);return t.length>0&&e("Invalid input not EOF"),y}function s(){return n("linear",r.linearGradient,o)||n("radial",r.radialGradient,l)||n("conic",r.conicGradient,a)}function n(y,b,S){return function(C,k){let M=v(C);if(M){v(r.startCall)||e("Missing (");let E=k(M);return v(r.endCall)||e("Missing )"),E}}(b,function(C){let k=S();return k&&(v(r.comma)||e("Missing comma before color stops")),{type:y,orientation:k,colorStops:p(m)}})}function o(){return _("directional",r.sideOrCorner,1)||_("angular",r.angleValue,1)}function a(){return _("angular",r.fromAngleValue,1)}function l(){let y,b,S=h();return S&&(y=[],y.push(S),b=t,v(r.comma)&&(S=h(),S?y.push(S):t=b)),y}function h(){let y=function(){let b=_("shape",/^(circle)/i,0);return b&&(b.style=f()||d()),b}()||function(){let b=_("shape",/^(ellipse)/i,0);return b&&(b.style=g()||d()),b}();if(y)y.at=c();else{let b=d();if(b){y=b;let S=c();S&&(y.at=S)}else{let S=u();S&&(y={type:"default-radial",at:S})}}return y}function d(){return _("extent-keyword",r.extentKeywords,1)}function c(){if(_("position",/^at/,0)){let y=u();return y||e("Missing positioning value"),y}}function u(){let y={x:g(),y:g()};if(y.x||y.y)return{type:"position",value:y}}function p(y){let b=y(),S=[];if(b)for(S.push(b);v(r.comma);)b=y(),b?S.push(b):e("One extra comma");return S}function m(){let y=_("hex",r.hexColor,1)||_("rgba",r.rgbaColor,1)||_("rgb",r.rgbColor,1)||_("literal",r.literalColor,0);return y||e("Expected color definition"),y.length=g(),y}function g(){return _("%",r.percentageValue,1)||_("position-keyword",r.positionKeywords,1)||f()}function f(){return _("px",r.pixelValue,1)||_("em",r.emValue,1)}function _(y,b,S){let C=v(b);if(C)return{type:y,value:C[S]}}function v(y){let b=/^[\n\r\t\s]+/.exec(t);b&&x(b[0].length);let S=y.exec(t);return S&&x(S[0].length),S}function x(y){t=t.substr(y)}return function(y){return t=y.toString(),i()}}(),jy=class r{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(r.IsGradientStr(t))try{let e=M8(t)[0];if(e){if(e.type==="linear")return r.ParseLinear(e);if(e.type==="radial")return r.ParseRadial(e);if(e.type==="conic")return r.ParseConic(e)}}catch{return t}return t}static ParseConic(t){let{orientation:e,colorStops:i=[]}=t,s=ge/2,n=parseFloat(e.value)/180*ge-s;return{gradient:"conical",x:.5,y:.5,startAngle:n,endAngle:n+vt,stops:i.map(o=>({color:o.value,offset:parseFloat(o.length.value)/100}))}}static ParseRadial(t){let{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(t){let{orientation:e,colorStops:i=[]}=t,s=ge/2,n=e.type==="angular"?parseFloat(e.value)/180*ge:0;for(;n<0;)n+=vt;for(;n>=vt;)n-=vt;let o=0,a=0,l=0,h=0;return n<s?(o=0,a=1,l=Math.sin(n),h=a-Math.cos(n)):n<ge?(o=0,a=0,l=Math.cos(n-s),h=Math.sin(n-s)):n<ge+s?(o=1,a=0,l=o-Math.sin(n-ge),h=Math.cos(n-ge)):(o=1,l=o-Math.cos(n-s-ge),h-=Math.sin(n-s-ge)),{gradient:"linear",x0:o,y0:a,x1:l,y1:h,stops:i.map(d=>({color:d.value,offset:parseFloat(d.length.value)/100}))}}};function Vi(r,t,e){let i=t,{a:s,b:n,c:o,d:a}=r.currentMatrix,l=Math.sign(s)*Math.sqrt(s*s+n*n),h=Math.sign(a)*Math.sqrt(o*o+a*a);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function Ph(r,t,e,i=0,s=0){if(!t||t===!0)return"black";let n,o;if(H(t))for(let a=0;a<t.length&&(o=t[a],!o);a++);else o=t;if(o=jy.Parse(o),typeof o=="string")return o;if(e.AABBBounds&&(!e.attribute||e.attribute.scaleX!==0||e.attribute.scaleY!==0)){let a=e.AABBBounds,l=a.x2-a.x1,h=a.y2-a.y1,d=a.x1-i,c=a.y1-s;if(e.attribute){let{scaleX:u=1,scaleY:p=1}=e.attribute;l/=u,h/=p,d/=u,c/=p}o.gradient==="linear"?n=D8(r,o,d,c,l,h):o.gradient==="conical"?n=w8(r,o,d,c,l,h):o.gradient==="radial"&&(n=E8(r,o,d,c,l,h))}return n||"orange"}function D8(r,t,e,i,s,n){var o,a,l,h;let d=r.createLinearGradient(e+((o=t.x0)!==null&&o!==void 0?o:0)*s,i+((a=t.y0)!==null&&a!==void 0?a:0)*n,e+((l=t.x1)!==null&&l!==void 0?l:1)*s,i+((h=t.y1)!==null&&h!==void 0?h:0)*n);return t.stops.forEach(c=>{d.addColorStop(c.offset,c.color)}),d}function E8(r,t,e,i,s,n){var o,a,l,h,d,c;let u=r.createRadialGradient(e+((o=t.x0)!==null&&o!==void 0?o:.5)*s,i+((a=t.y0)!==null&&a!==void 0?a:.5)*n,Math.max(s,n)*((l=t.r0)!==null&&l!==void 0?l:0),e+((h=t.x1)!==null&&h!==void 0?h:.5)*s,i+((d=t.y1)!==null&&d!==void 0?d:.5)*n,Math.max(s,n)*((c=t.r1)!==null&&c!==void 0?c:.5));return t.stops.forEach(p=>{u.addColorStop(p.offset,p.color)}),u}function w8(r,t,e,i,s,n){var o,a;let l=r.createConicGradient(e+((o=t.x)!==null&&o!==void 0?o:0)*s,i+((a=t.y)!==null&&a!==void 0?a:0)*n,t.startAngle,t.endAngle);return t.stops.forEach(h=>{l.addColorStop(h.offset,h.color)}),l.GetPattern(s+e,n+i,void 0)}var bc={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},pB={fontSize:16,fontFamily:BR,fill:!0,stroke:!1,fontWeight:"normal",lineHeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",script:"normal"},out=String.fromCharCode(160),zy=/\w|\(|\)|-/,mB=/[.?!,;:/]/,gB=/\S/,fB=(r,t)=>{let e=t.fontSize||16;switch(t.script){case"super":case"sub":e*=.8}r.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:e,fontFamily:t.fontFamily})};function _B(r,t,e){let i=t&&t.fill||pB.fill;if(!i)return void(r.globalAlpha=0);let{fillOpacity:s=1,opacity:n=1}=t;r.globalAlpha=s*n,r.fillStyle=e?Ph(r,i,{AABBBounds:e}):i,fB(r,t)}function vB(r,t){let e=t&&t.stroke||pB.stroke;if(!e)return void(r.globalAlpha=0);let{strokeOpacity:i=1,opacity:s=1}=t;r.globalAlpha=i*s,r.lineWidth=t&&typeof t.lineWidth=="number"?t.lineWidth:1,r.strokeStyle=e,fB(r,t)}function Sc(r,t,e,i,s){if(!t||t<=0)return 0;let n=j.graphicUtil.textMeasure,o=i,a=r.slice(0,o),l=Math.floor(n.measureText(a,e).width),h=r.slice(0,o+1),d=Math.floor(n.measureText(h,e).width);for(;l>t||d<=t;){if(l>t?o--:o++,o>r.length){o=r.length;break}if(o<0){o=0;break}a=r.slice(0,o),l=Math.floor(n.measureText(a,e).width),h=r.slice(0,o+1),d=Math.floor(n.measureText(h,e).width)}return s&&(o=Ag(r,o)),o}function Ag(r,t,e=!1){let i=t;for(;zy.test(r[i-1])&&zy.test(r[i])||mB.test(r[i]);)if(i--,i<=0)return e?P8(r,t):t;return i}function P8(r,t){let e=t;for(;zy.test(r[e+1])&&zy.test(r[e])||mB.test(r[e]);)if(e++,e>=r.length)return e;return e+1}function Wo(r,t,e="actual"){let i=j.graphicUtil.textMeasure.measureText(r,t),s={ascent:0,height:0,descent:0,width:0},n=e==="actual"?i.actualBoundingBoxAscent:i.fontBoundingBoxAscent,o=e==="actual"?i.actualBoundingBoxDescent:i.fontBoundingBoxDescent;return typeof n!="number"||typeof o!="number"?(s.width=Math.floor(i.width),s.height=t.fontSize||0,s.ascent=s.height,s.descent=0):(s.width=Math.floor(i.width),s.height=Math.floor(n+o),s.ascent=Math.floor(n),s.descent=s.height-s.ascent),s}var R8=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Gy=class{configure(r,t){this.canvas=r.canvas,this.context=r.context,r.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(r,t,e){this.context.setTextStyleWithoutAlignBaseline(t);let i=this.context.measureText(r);return e?this.compatibleMetrics(i,t):i}_measureTextWithAlignBaseline(r,t,e){this.context.setTextStyle(t);let i=this.context.measureText(r);return e?this.compatibleMetrics(i,t):i}compatibleMetrics(r,t){if(r.actualBoundingBoxAscent==null||r.actualBoundingBoxDescent==null||r.fontBoundingBoxAscent==null||r.fontBoundingBoxDescent==null){r={width:r.width};let{ascent:e,descent:i}=this.measureTextBoundADscentEstimate(t);r.actualBoundingBoxAscent=e,r.actualBoundingBoxDescent=i,r.fontBoundingBoxAscent=e,r.fontBoundingBoxDescent=i}if(r.actualBoundingBoxLeft==null||r.actualBoundingBoxRight==null){r={width:r.width,actualBoundingBoxAscent:r.actualBoundingBoxAscent,actualBoundingBoxDescent:r.actualBoundingBoxDescent,fontBoundingBoxAscent:r.fontBoundingBoxAscent,fontBoundingBoxDescent:r.fontBoundingBoxDescent};let{left:e,right:i}=this.measureTextBoundLeftRightEstimate(t);r.actualBoundingBoxLeft=e,r.actualBoundingBoxRight=i}return r}estimate(r,{fontSize:t=Vy.fontSize}){let e=0,i=0;for(let s=0;s<r.length;s++)r.charCodeAt(s)<128?e++:i++;return{width:~~(.8*e*t+i*t),height:t}}measureTextWidth(r,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(r,t)).width:this.estimate(r,t).width}measureTextBoundsWidth(r,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(r,t)).width:this.estimate(r,t).width}measureTextBoundsLeftRight(r,t,e){return this.context?{left:(e=e??this._measureTextWithAlignBaseline(r,t,!0)).actualBoundingBoxLeft,right:e.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(t)}measureTextPixelHeight(r,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(r,t,!0),Math.abs(e.actualBoundingBoxAscent-e.actualBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:Ir.fontSize}measureTextPixelADscent(r,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(r,t,!0)).actualBoundingBoxAscent,descent:e.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundHieght(r,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(r,t,!0),Math.abs(e.fontBoundingBoxAscent-e.fontBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:Ir.fontSize}measureTextBoundADscent(r,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(r,t,!0)).fontBoundingBoxAscent,descent:e.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundADscentEstimate(r){var t;let e=(t=r.fontSize)!==null&&t!==void 0?t:Ir.fontSize;return{ascent:.79*e,descent:.21*e}}measureTextBoundLeftRightEstimate(r){var t;let e=(t=r.fontSize)!==null&&t!==void 0?t:Ir.fontSize,{textAlign:i}=r;return i==="center"?{left:e/2,right:e/2}:i==="right"||i==="end"?{left:e,right:0}:{left:0,right:e}}measureTextPixelADscentAndWidth(r,t,e){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:this.estimate(r,t).width});let i=this._measureTextWithoutAlignBaseline(r,t,!0);if(e===eo.actualBounding)return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width};if(e===eo.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:i.width});if(e===eo.fontBounding){let s=i.fontBoundingBoxAscent,n=i.fontBoundingBoxDescent;if(i.actualBoundingBoxDescent&&n<i.actualBoundingBoxDescent){let o=i.actualBoundingBoxDescent-n;n+=o,s-=o}else if(i.actualBoundingBoxAscent&&s<i.actualBoundingBoxAscent){let o=i.actualBoundingBoxAscent-s;s+=o,n-=o}return{ascent:s,descent:n,width:i.width}}return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width}}measureText(r,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(r)):this.estimate(r,t)}clipTextVertical(r,t,e,i){if(r.length===0)return{verticalList:r,width:0};let{fontSize:s=12}=t;r.forEach(l=>{l.width=l.direction===0?s:this.measureTextWidth(l.text,t)});let n=[],o=0,a=0;for(;a<r.length&&o+r[a].width<e;a++)o+=r[a].width,n.push(r[a]);if(r[a]&&r[a].text.length>1){let l=this._clipText(r[a].text,t,e-o,0,r[a].text.length-1,"end",!1);if(i&&l.str!==r[a].text){let h="",d=0;for(let p=0;p<a;p++){let m=r[p];h+=m.text,d+=m.text.length}h+=r[a].text;let c=d+l.str.length,u=Ag(h,c);u-=d,u!==l.str.length-1&&(l.str=l.str.substring(0,u),l.width=this.measureTextWidth(l.str,t))}n.push(Object.assign(Object.assign({},r[a]),{text:l.str,width:l.width})),o+=l.width}return{verticalList:n,width:o}}clipText(r,t,e,i,s){if(r.length===0)return{str:"",width:0};let n=this.measureTextWidth(r,t);if(n<=e)return{str:r,width:n};if(n=this.measureTextWidth(r[0],t),n>e)return{str:"",width:0};let o=this._clipText(r,t,e,0,r.length-1,"end",!1);if(i&&o.str!==r){let a=Ag(r,o.str.length,s);a!==o.str.length&&(a>o.str.length&&(o.wordBreaked=a,a=o.str.length),o.str=r.substring(0,a),o.width=this.measureTextWidth(o.str,t))}return o}_clipText(r,t,e,i,s,n,o){let a;if(n==="start")a=this._clipTextStart(r,t,e,i,s),o&&(a.result=o+a.str);else if(n==="middle"){let l=this._clipTextMiddle(r,t,e,"","",0,0,1);a={str:"none",width:l.width,result:l.left+o+l.right}}else a=this._clipTextEnd(r,t,e,i,s),o&&(a.result=a.str+o);return a}_clipTextEnd(r,t,e,i,s){if(i===s){Nt.getInstance().warn(`\u3010_clipTextEnd\u3011\u4E0D\u5E94\u8BE5\u8D70\u5230\u8FD9\u91CC${r}, ${i}, ${s}`);let h=r.substring(0,s+1);return{str:h,width:this.measureTextWidth(h,t)}}let n=Math.floor((i+s)/2),o=r.substring(0,n+1),a=this.measureTextWidth(o,t),l;if(a>e){if(o.length<=1)return{str:"",width:0};let h=r.substring(0,n);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextEnd(r,t,e,i,n)}if(a<e){if(n>=r.length-1)return{str:r,width:this.measureTextWidth(r,t)};let h=r.substring(0,n+2);return l=this.measureTextWidth(h,t),l>=e?{str:o,width:a}:this._clipTextEnd(r,t,e,n,s)}return{str:o,width:a}}_clipTextStart(r,t,e,i,s){let n=Math.ceil((i+s)/2),o=r.substring(n-1,r.length),a=this.measureTextWidth(o,t),l;if(a>e){if(o.length<=1)return{str:"",width:0};let h=r.substring(n,r.length);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextStart(r,t,e,n,r.length)}if(a<e){if(n<=0)return{str:r,width:this.measureTextWidth(r,t)};let h=r.substring(n-2,r.length);return l=this.measureTextWidth(h,t),l>=e?{str:o,width:a}:this._clipTextStart(r,t,e,i,n)}return{str:o,width:a}}_clipTextMiddle(r,t,e,i,s,n,o,a){let l=r.substring(0,a),h=this.measureTextWidth(l,t);if(h+o>e)return{left:i,right:s,width:n+o};let d=r.substring(r.length-a,r.length),c=this.measureTextWidth(d,t);return h+c>e?{left:l,right:s,width:h+o}:this._clipTextMiddle(r,t,e,l,d,h,c,a+1)}clipTextWithSuffixVertical(r,t,e,i,s,n){if(i==="")return this.clipTextVertical(r,t,e,s);if(r.length===0)return{verticalList:r,width:0};let o=this.clipTextVertical(r,t,e,s);if(o.verticalList.length===r.length&&o.verticalList[o.verticalList.length-1].width===r[r.length-1].width)return o;let a=this.measureTextWidth(i,t);if(a>e)return o;let l;if(e-=a,n==="start"){let h=this.revertVerticalList(r);l=this.clipTextVertical(h,t,e,s);let d=this.revertVerticalList(l.verticalList);d.unshift({text:i,direction:1,width:a}),l.verticalList=d}else if(n==="middle"){let h=this.clipTextVertical(r,t,e/2,s),d=this.revertVerticalList(r),c=this.clipTextVertical(d,t,e/2,s);h.verticalList.push({text:i,direction:1,width:a}),this.revertVerticalList(c.verticalList).forEach(u=>h.verticalList.push(u)),l={verticalList:h.verticalList,width:h.width+c.width}}else l=this.clipTextVertical(r,t,e,s),l.verticalList.push({text:i,direction:1,width:a});return l.width+=a,l}revertVerticalList(r){return r.reverse().map(t=>{let e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})})}clipTextWithSuffix(r,t,e,i,s,n,o=!1){if(i==="")return this.clipText(r,t,e,s);if(r.length===0)return{str:"",width:0};let a=this.measureTextWidth(r,t);if(!o&&a<=e)return{str:r,width:a};let l=this.measureTextWidth(i,t);if(l>e)return{str:"",width:0};if(o&&a+l<=e)return{str:r+i,width:a+l};e-=l;let h=this._clipText(r,t,e,0,r.length-1,n,i);if(s&&h.str!==r){let d=Ag(r,h.str.length);d!==h.str.length&&(h.result=r.substring(0,d),h.width=this.measureTextWidth(h.str,t))}else o&&h.str===r&&(h.result=r+i);return h.str=h.result,h.width+=l,h}};Gy=R8([q()],Gy);var B8=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Cg=Symbol.for("TextMeasureContribution"),Uy=class extends Gy{};Uy=B8([q()],Uy);var yt=new xg;var Wy=Symbol.for("CanvasFactory"),gk=Symbol.for("Context2dFactory");function kc(r){return yt.getNamed(Wy,j.global.env)(r)}var xB=1e-4,yB=Math.sqrt(3),Yy=1/3;function qa(r){return r>-kg&&r<kg}function bB(r){return r>kg||r<-kg}var so=[0,0],Fs=[0,0],Cc=[0,0];function Tc(r,t){return(r[0]-t[0])*(r[0]-t[0])+(r[1]-t[1])*(r[1]-t[1])}function cn(r,t,e,i){let s=1-i;return s*(s*r+2*i*t)+i*i*e}function un(r,t,e,i,s){let n=1-s;return n*n*(n*r+3*s*t)+s*s*(s*i+3*n*e)}function L8(r,t,e,i,s){let n=r-2*t+e,o=2*(t-r),a=r-i,l=0;if(qa(n)){if(bB(o)){let h=-a/o;h>=0&&h<=1&&(s[l++]=h)}}else{let h=o*o-4*n*a;if(qa(h)){let d=-o/(2*n);d>=0&&d<=1&&(s[l++]=d)}else if(h>0){let d=Math.sqrt(h),c=(-o+d)/(2*n),u=(-o-d)/(2*n);c>=0&&c<=1&&(s[l++]=c),u>=0&&u<=1&&(s[l++]=u)}}return l}function I8(r,t,e){let i=r+e-2*t;return i===0?.5:(r-t)/i}function F8(r,t,e,i,s,n,o,a,l){let h=0,d=.005,c=1/0;so[0]=o,so[1]=a;for(let u=0;u<1;u+=.05){Fs[0]=cn(r,e,s,u),Fs[1]=cn(t,i,n,u);let p=Tc(so,Fs);p<c&&(h=u,c=p)}c=1/0;for(let u=0;u<32&&!(d<xB);u++){let p=h-d,m=h+d;Fs[0]=cn(r,e,s,p),Fs[1]=cn(t,i,n,p);let g=Tc(Fs,so);if(p>=0&&g<c)h=p,c=g;else{Cc[0]=cn(r,e,s,m),Cc[1]=cn(t,i,n,m);let f=Tc(Cc,so);m<=1&&f<c?(h=m,c=f):d*=.5}}return l&&(l[0]=cn(r,e,s,h),l[1]=cn(t,i,n,h)),Math.sqrt(c)}function O8(r,t,e,i,s,n,o,a,l,h,d){let c,u,p,m,g=0,f=.005,_=1/0;so[0]=l,so[1]=h;for(let v=0;v<1;v+=.05)Fs[0]=un(r,e,s,o,v),Fs[1]=un(t,i,n,a,v),p=Tc(so,Fs),p<_&&(g=v,_=p);_=1/0;for(let v=0;v<32&&!(f<xB);v++)c=g-f,u=g+f,Fs[0]=un(r,e,s,o,c),Fs[1]=un(t,i,n,a,c),p=Tc(Fs,so),c>=0&&p<_?(g=c,_=p):(Cc[0]=un(r,e,s,o,u),Cc[1]=un(t,i,n,a,u),m=Tc(Cc,so),u<=1&&m<_?(g=u,_=m):f*=.5);return d&&(d[0]=un(r,e,s,o,g),d[1]=un(t,i,n,a,g)),Math.sqrt(_)}function Xy(r){return(r%=vt)<0&&(r+=vt),r}function H8(r,t,e,i,s,n,o,a,l){if(o===0)return!1;let h=o;return l>t+h&&l>i+h&&l>n+h||l<t-h&&l<i-h&&l<n-h||a>r+h&&a>e+h&&a>s+h||a<r-h&&a<e-h&&a<s-h?!1:F8(r,t,e,i,s,n,a,l,null)<=h/2}function N8(r,t,e,i,s,n,o,a,l,h,d){if(l===0)return!1;let c=l;return d>t+c&&d>i+c&&d>n+c&&d>a+c||d<t-c&&d<i-c&&d<n-c&&d<a-c||h>r+c&&h>e+c&&h>s+c&&h>o+c||h<r-c&&h<e-c&&h<s-c&&h<o-c?!1:O8(r,t,e,i,s,n,o,a,h,d,null)<=c/2}function V8(r,t,e,i,s,n,o,a,l){if(o===0)return!1;let h=o;a-=r,l-=t;let d=Math.sqrt(a*a+l*l);if(d-h>e||d+h<e)return!1;if(Math.abs(i-s)%vt<1e-4)return!0;if(n){let u=i;i=Xy(s),s=Xy(u)}else i=Xy(i),s=Xy(s);i>s&&(s+=vt);let c=Math.atan2(l,a);return c<0&&(c+=vt),c>=i&&c<=s||c+vt>=i&&c+vt<=s}function Ac(r,t,e,i,s,n,o){if(s===0)return!1;let a=s,l=s/2,h=0,d=r;if(o>t+l&&o>i+l||o<t-l&&o<i-l||n>r+l&&n>e+l||n<r-l&&n<e-l)return!1;if(r===e)return Math.abs(n-r)<=a/2;h=(t-i)/(r-e),d=(r*i-e*t)/(r-e);let c=h*n-o+d;return c*c/(h*h+1)<=a/2*a/2}var kg=1e-4;function j8(r,t,e,i,s,n){let o=i+3*(t-e)-r,a=3*(e-2*t+r),l=3*(t-r),h=r-s,d=a*a-3*o*l,c=a*l-9*o*h,u=l*l-3*a*h,p=0;if(qa(d)&&qa(c))if(qa(a))n[0]=0;else{let m=-l/a;m>=0&&m<=1&&(n[p++]=m)}else{let m=c*c-4*d*u;if(qa(m)){let g=c/d,f=-a/o+g,_=-g/2;f>=0&&f<=1&&(n[p++]=f),_>=0&&_<=1&&(n[p++]=_)}else if(m>0){let g=Math.sqrt(m),f=d*a+1.5*o*(-c+g),_=d*a+1.5*o*(-c-g);f=f<0?-Math.pow(-f,Yy):Math.pow(f,Yy),_=_<0?-Math.pow(-_,Yy):Math.pow(_,Yy);let v=(-a-(f+_))/(3*o);v>=0&&v<=1&&(n[p++]=v)}else{let g=(2*d*a-3*o*c)/(2*Math.sqrt(d*d*d)),f=Math.acos(g)/3,_=Math.sqrt(d),v=Math.cos(f),x=(-a-2*_*v)/(3*o),y=(-a+_*(v+yB*Math.sin(f)))/(3*o),b=(-a+_*(v-yB*Math.sin(f)))/(3*o);x>=0&&x<=1&&(n[p++]=x),y>=0&&y<=1&&(n[p++]=y),b>=0&&b<=1&&(n[p++]=b)}}return p}function z8(r,t,e,i,s){let n=6*e-12*t+6*r,o=9*t+3*i-3*r-9*e,a=3*t-3*r,l=0;if(qa(o)){if(bB(n)){let h=-a/n;h>=0&&h<=1&&(s[l++]=h)}}else{let h=n*n-4*o*a;if(qa(h))s[0]=-n/(2*o);else if(h>0){let d=Math.sqrt(h),c=(-n+d)/(2*o),u=(-n-d)/(2*o);c>=0&&c<=1&&(s[l++]=c),u>=0&&u<=1&&(s[l++]=u)}}return l}function G8(r,t){return Math.abs(r-t)<kg}var Fr=[-1,-1,-1],Is=[-1,-1];function U8(){let r=Is[0];Is[0]=Is[1],Is[1]=r}function W8(r,t,e,i,s,n,o,a,l,h){if(h>t&&h>i&&h>n&&h>a||h<t&&h<i&&h<n&&h<a)return 0;let d=j8(t,i,n,a,h,Fr);if(d===0)return 0;let c=0,u=-1,p=0,m=0;for(let g=0;g<d;g++){let f=Fr[g],_=f===0||f===1?.5:1;un(r,e,s,o,f)<l||(u<0&&(u=z8(t,i,n,a,Is),Is[1]<Is[0]&&u>1&&U8(),p=un(t,i,n,a,Is[0]),u>1&&(m=un(t,i,n,a,Is[1]))),u===2?f<Is[0]?c+=p<t?_:-_:f<Is[1]?c+=m<p?_:-_:c+=a<m?_:-_:f<Is[0]?c+=p<t?_:-_:c+=a<p?_:-_)}return c}function Y8(r,t,e,i,s,n,o,a){if(a>t&&a>i&&a>n||a<t&&a<i&&a<n)return 0;let l=L8(t,i,n,a,Fr);if(l===0)return 0;let h=I8(t,i,n);if(h>=0&&h<=1){let c=0,u=cn(t,i,n,h);for(let p=0;p<l;p++){let m=Fr[p]===0||Fr[p]===1?.5:1;cn(r,e,s,Fr[p])<o||(Fr[p]<h?c+=u<t?m:-m:c+=n<u?m:-m)}return c}let d=Fr[0]===0||Fr[0]===1?.5:1;return cn(r,e,s,Fr[0])<o?0:n<t?d:-d}function X8(r,t,e,i,s,n,o,a){if((a-=t)>e||a<-e)return 0;let l=Math.sqrt(e*e-a*a);Fr[0]=-l,Fr[1]=l;let h=Math.abs(i-s);if(h<1e-4)return 0;if(h>=vt-1e-4){i=0,s=vt;let c=n?1:-1;return o>=Fr[0]+r&&o<=Fr[1]+r?c:0}if(i>s){let c=i;i=s,s=c}i<0&&(i+=vt,s+=vt);let d=0;for(let c=0;c<2;c++){let u=Fr[c];if(u+r>o){let p=Math.atan2(a,u),m=n?1:-1;p<0&&(p=vt+p),(p>=i&&p<=s||p+vt>=i&&p+vt<=s)&&(p>ge/2&&p<1.5*ge&&(m=-m),d+=m)}}return d}function fk(r){return Math.round(r/ge*1e8)/1e8%2*ge}function K8(r,t){let e=fk(r[0]);e<0&&(e+=vt);let i=e-r[0],s=r[1];s+=i,!t&&s-e>=vt?s=e+vt:t&&e-s>=vt?s=e-vt:!t&&e>s?s=e+(vt-fk(e-s)):t&&e<s&&(s=e-(vt-fk(s-e))),r[0]=e,r[1]=s}var Tg=[0,0];function SB(r,t,e,i,s){let n=r,o=r.length,a,l,h=0,d=0,c=0,u=0,p=0;for(let m=0;m<o;m++){let g=n[m],f=m===0;g[0]===qt.M&&m>1&&(e||(h+=$n(d,c,u,p,i,s))),f&&(d=g[1],c=g[2],u=d,p=c);let _=g[0],v=g[1],x=g[2],y=g[3],b=g[4],S=g[5],C=g[6],k=b,M=S;Tg[0]=k,Tg[1]=M,K8(Tg,!!g[6]),k=Tg[0],M=Tg[1];let E=k,D=M-k,P=!!(1-(g[6]?0:1)),B=(i-v)*y/y+v;switch(_){case qt.M:u=v,p=x,d=u,c=p;break;case qt.L:if(e){if(Ac(d,c,v,x,t,i,s))return!0}else h+=$n(d,c,v,x,i,s)||0;d=v,c=x;break;case qt.C:if(e){if(N8(d,c,v,x,y,b,S,C,t,i,s))return!0}else h+=W8(d,c,v,x,y,b,S,C,i,s)||0;d=S,c=C;break;case qt.Q:if(e){if(H8(d,c,v,x,y,b,t,i,s))return!0}else h+=Y8(d,c,v,x,y,b,i,s)||0;d=y,c=b;break;case qt.A:if(a=Math.cos(E)*y+v,l=Math.sin(E)*y+x,f?(u=a,p=l):h+=$n(d,c,a,l,i,s),e){if(V8(v,x,y,E,E+D,P,t,B,s))return!0}else h+=X8(v,x,y,E,E+D,P,B,s);d=Math.cos(E+D)*y+v,c=Math.sin(E+D)*y+x;break;case qt.R:if(u=d=v,p=c=x,a=u+y,l=p+b,e){if(Ac(u,p,a,p,t,i,s)||Ac(a,p,a,l,t,i,s)||Ac(a,l,u,l,t,i,s)||Ac(u,l,u,p,t,i,s))return!0}else h+=$n(a,p,a,l,i,s),h+=$n(u,l,u,p,i,s);break;case qt.Z:if(e){if(Ac(d,c,u,p,t,i,s))return!0}else h+=$n(d,c,u,p,i,s);d=u,c=p}}return e||G8(c,p)||(h+=$n(d,c,u,p,i,s)||0),h!==0}function AB(r,t,e){return SB(r,0,!1,t,e)}function CB(r,t,e,i){return SB(r,t,!0,e,i)}var _k=class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){let i=kc(Object.assign({nativeCanvas:j.global.createCanvas(t)},t));return this.allocatedCanvas.push(i),i}let e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){let i={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},s=kc(Object.assign({nativeCanvas:j.global.createCanvas(i)},i));return this.allocatedCanvas.push(s),s}let e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},pn=new _k;var $8=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},q8=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Rh=Symbol.for("VWindow"),Bh=Symbol.for("WindowHandlerContribution"),Ky=class{get width(){if(this._handler){let r=this._handler.getWH();return this._width=r.width}return this._width}get height(){if(this._handler){let r=this._handler.getWH();return this._height=r.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new wi(["x","y","width","height"])},this.active=()=>{let r=this.global;!r.env||this.actived||(yt.getNamed(Bh,r.env).configure(this,r),this.actived=!0)},this._uid=le.GenAutoIncrementId(),this.global=j.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var r;return(r=this._handler.getStyle())!==null&&r!==void 0?r:{}}set style(r){this._handler.setStyle(r)}create(r){var t,e;this._handler.createWindow(r);let i=this._handler.getWH();this._width=i.width,this._height=i.height,r.viewBox?this.setViewBox(r.viewBox):r.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(t=r.width)!==null&&t!==void 0?t:this._width,y2:(e=r.height)!==null&&e!==void 0?e:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(r){this._handler=r}setDpr(r){return this._handler.setDpr(r)}resize(r,t){return this._handler.resizeWindow(r,t)}configure(){throw new Error("\u6682\u4E0D\u652F\u6301")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(r){return this._handler.getImageBuffer?this._handler.getImageBuffer(r):null}addEventListener(r,t,e){return this._handler.addEventListener(r,t,e)}removeEventListener(r,t,e){return this._handler.removeEventListener(r,t,e)}dispatchEvent(r){return this._handler.dispatchEvent(r)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(r){this._handler.clearViewBox(r)}setViewBox(r){this._handler.setViewBox(r)}setViewBoxTransform(r,t,e,i,s,n){this._handler.setViewBoxTransform(r,t,e,i,s,n)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(r,t){let e=this._handler.getViewBox(),i={x:r,y:t};return this._handler.getViewBoxTransform().transformPoint({x:r,y:t},i),i.x-=e.x1,i.y-=e.y1,i}hasSubView(){let r=this._handler.getViewBox();return!(r.x1===0&&r.y1===0&&Re(this.width,r.width())&&Re(this.height,r.height()))}isVisible(r){return this._handler.isVisible(r)}onVisibleChange(r){return this._handler.onVisibleChange(r)}getTopLeft(r){return this._handler.getTopLeft(r)}};Ky=$8([q(),q8("design:paramtypes",[])],Ky);var kB=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},MB=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},TB=function(r,t){return function(e,i){t(e,i,r)}},$y=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(r){this.contributions=r,this.configured=!1,this.global=j.global,this.global.hooks.onSetEnv.tap("graphic-util",(t,e,i)=>{this.configured=!1,this.configure(i,e)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(r,t){this.configured||(this.contributions.getContributions().forEach(e=>{e.configure(this,t)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){let r=pn.shareCanvas();this._canvas=r,this._context=r.getContext("2d")}}bindTextMeasure(r){this._textMeasure=r}measureText(r,t,e="native"){var i;this.configure(this.global,this.global.env);let s=this.global.measureTextMethod;this.global.measureTextMethod=e;let n={width:this._textMeasure.measureTextWidth(r,t),height:(i=t.fontSize)!==null&&i!==void 0?i:Ir.fontSize};return this.global.measureTextMethod=s,n}createTextMeasureInstance(r,t,e){return this.configure(this.global,this.global.env),new ps(Object.assign({defaultFontParams:{fontFamily:Ir.fontFamily,fontSize:Ir.fontSize},getCanvasForMeasure:e||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+ps.ALPHABET_CHAR_SET+ps.ALPHABET_CHAR_SET.toUpperCase()},t??{}),r)}drawGraphicToCanvas(r,t,e){if(!t.defaultLayer)return null;let i=yt.get(Rh),s=r.AABBBounds,n=s.width(),o=s.height(),a=-s.x1,l=-s.y1;i.create({viewBox:{x1:a,y1:l,x2:s.x2,y2:s.y2},width:n,height:o,canvas:e,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});let h=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(i,[r],{transMatrix:i.getViewBoxTransform(),viewBox:i.getViewBox(),stage:t,layer:t.defaultLayer,renderService:t.renderService,background:"transparent",clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=h;let d=i.getNativeHandler();return d.nativeCanvas?d.nativeCanvas:null}};$y=kB([q(),TB(0,lt($t)),TB(0,Zt(Cg)),MB("design:paramtypes",[Object])],$y);var Za;(function(r){r[r.transform=0]="transform",r[r.matrix=1]="matrix"})(Za||(Za={}));var Ri=new Kt,qy=class{constructor(){this.matrix=new Kt}init(r){return this.mode=Za.transform,this.originTransform=r,this.matrix.reset(),this}fromMatrix(r,t){return this.mode=Za.matrix,this.outSourceMatrix=r,this.outTargetMatrix=t,this}scaleMatrix(r,t,e){let i=this.outSourceMatrix;if(Ri.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){let{x:s,y:n}=e;this.outTargetMatrix.translate(s,n),this.outTargetMatrix.scale(r,t),this.outTargetMatrix.translate(-s,-n)}else this.outTargetMatrix.scale(r,t);return this.outTargetMatrix.multiply(Ri.a,Ri.b,Ri.c,Ri.d,Ri.e,Ri.f),this}rotateMatrix(r,t){let e=this.outSourceMatrix;if(Ri.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),t){let{x:i,y:s}=t;this.outTargetMatrix.translate(i,s),this.outTargetMatrix.rotate(r),this.outTargetMatrix.translate(-i,-s)}else this.outTargetMatrix.rotate(r);return this.outTargetMatrix.multiply(Ri.a,Ri.b,Ri.c,Ri.d,Ri.e,Ri.f),this}scale(r,t,e){return this.mode===Za.matrix?this.scaleMatrix(r,t,e):this}rotate(r,t){return this.mode===Za.matrix?this.rotateMatrix(r,t):this}translateMatrix(r,t){let e=this.outSourceMatrix;return Ri.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(r,t),this.outTargetMatrix.multiply(Ri.a,Ri.b,Ri.c,Ri.d,Ri.e,Ri.f),this}translate(r,t){return this.mode===Za.matrix?this.translateMatrix(r,t):this}simplify(r){return this.mode===Za.matrix?this.simplifyMatrix(r):this}simplifyMatrix(r){return this}};qy=kB([q(),MB("design:paramtypes",[])],qy);var Or={arc:iB,area:rB,circle:sB,line:aB,path:lB,symbol:cB,text:Vy,rect:dB,polygon:hB,richtext:dn,richtextIcon:uB,image:$a,group:nB,glyph:oB},vk=Object.keys(Or);function Z8(){return{arc:Object.assign({},Or.arc),area:Object.assign({},Or.area),circle:Object.assign({},Or.circle),line:Object.assign({},Or.line),path:Object.assign({},Or.path),symbol:Object.assign({},Or.symbol),text:Object.assign({},Or.text),rect:Object.assign({},Or.rect),polygon:Object.assign({},Or.polygon),richtext:Object.assign({},Or.richtext),richtextIcon:Object.assign({},Or.richtextIcon),image:Object.assign({},Or.image),group:Object.assign({},Or.group),glyph:Object.assign({},Or.glyph)}}function Zy(r,t){Object.keys(t).forEach(e=>{r[e]=t[e]})}var DB=Z8(),no=class{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},vk.forEach(t=>{this._defaultTheme[t]=Object.create(DB[t])}),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={},i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){let s=this.getParentWithTheme(t);if(s){let n=s.theme;(n.dirty||i)&&n.applyTheme(s,e,!0)}this.userTheme?this.doCombine(s&&s.theme.combinedTheme):(s?this.combinedTheme=s.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Nt.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0C\u8D70\u5230\u4E0D\u5E94\u8BE5\u8D70\u7684\u533A\u57DF\u91CC")),this.dirty=!1)}return this.combinedTheme}doCombine(t){let e=this.userTheme,i=this.combinedTheme;vk.forEach(s=>{let n=Object.create(DB[s]);t&&t[s]&&Zy(n,t[s]),i[s]&&Zy(n,i[s]),e[s]&&Zy(n,e[s]),this.combinedTheme[s]=n}),e.common&&vk.forEach(s=>{Zy(this.combinedTheme[s],e.common)}),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach(s=>{i[s]?Object.assign(i[s],t[s]):i[s]=Object.assign({},t[s])}):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren(e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))})}},EB=new no;function dt(r,t){return r.glyphHost?dt(r.glyphHost):t?(r.isContainer,t):J8(r)||r.attachedThemeGraphic&&dt(r.attachedThemeGraphic)||EB.getTheme()}function J8(r){let t;if(t=r.isContainer?r:r.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):EB.getTheme()}return null}var Q8=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})},Jy=class extends lr.default{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=le.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let i=this._lastChild,s=0;for(;i;){if(t(i,s++))return;i=i._prev}}else{let i=this._firstChild,s=0;for(;i;){if(t(i,s++))return;i=i._next}}}forEachChildrenAsync(t,e=!1){return Q8(this,void 0,void 0,function*(){if(e){let i=this._lastChild,s=0;for(;i;){let n=t(i,s++);if(n.then&&(n=yield n),n)return;i=i._prev}}else{let i=this._firstChild,s=0;for(;i;){let n=t(i,s++);if(n.then&&(n=yield n),n)return;i=i._next}}})}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("\u3010Node::appendChild\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20append\u4E3A\u5B50\u5143\u7D20");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return console.error("\u6682\u4E0D\u652F\u6301\u8BE5\u51FD\u6570"),t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertBefore\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertAfter\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Nt.getInstance().warn("insertIntoKeepIdx\u548CinsertInto\u6DF7\u7528\u53EF\u80FD\u4F1A\u5B58\u5728\u9519\u8BEF"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("\u3010Node::insertBefore\u3011\u4E0D\u80FD\u5C06\u7236\u8F88\u5143\u7D20insert\u4E3A\u5B50\u5143\u7D20");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let s=0;s<e;s++){if(!i)return null;s>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){let n=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,n)}let i;this._nodeList[e]=t;for(let n=e-1;n>=0&&(i=this._nodeList[n],!i);n--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;let s=this.insertInto(t,0);return this._ignoreWarn=!1,s}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){let e=this._nodeList.findIndex(i=>i===t);e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){let i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}find(t,e=!1){let i=null;return this.forEachChildren((s,n)=>!(s===this||!t(s,n))&&(i=s,!0)),e&&this.forEachChildren(s=>{if(s.isContainer){let n=s.find(t,!0);if(n)return i=n,!0}return!1}),i}findAll(t,e=!1){let i=[];return this.forEachChildren((s,n)=>{s!==this&&t(s,n)&&i.push(s)}),e&&this.forEachChildren(s=>{if(s.isContainer){let n=s.findAll(t,!0);n.length&&(i=i.concat(n))}}),i}getElementById(t){return this.find(e=>e.id===t,!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll(e=>e.name===t,!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll(e=>e.type===t,!0)}getChildByName(t,e=!1){return this.find(i=>i.name===t,e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t?.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){let t=[],e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("\u6682\u4E0D\u652F\u6301")}cloneTo(t){throw new Error("\u6682\u4E0D\u652F\u6301")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){let s=te(i,!0)&&i||ct(i)&&i.capture,n=ct(i)&&i.once,o=V(e)?void 0:e;return t=s?`${t}capture`:t,e=V(e)?e:e.handleEvent,n?super.once(t,e,o):super.on(t,e,o),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){let s=te(i,!0)&&i||ct(i)&&i.capture,n=V(e)?void 0:e;t=s?`${t}capture`:t,e=V(e)?e:e.handleEvent;let o=ct(i)&&i.once;return super.off(t,e,n,o),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return ct(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}};var Ja=class r{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=r.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){let e=this.pickParams.graphic;if(e.stage){let i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&V(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&V(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}};var Yo=class extends Ja{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,n,o,a,l,h,d,c,u,p,m,g){throw new Error("Method not implemented.")}};var Hr=class r extends Yo{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;let s=new r(this.manager);s.eventPhase=s.NONE,s.currentTarget=null,s.path=[],s.detailPath=[],s.target=null,s.nativeEvent=this.nativeEvent,s.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,s),(e=this.manager)===null||e===void 0||e.copyMouseData(this,s),(i=this.manager)===null||i===void 0||i.copyData(this,s),s.target=this.target,s.path=this.composedPath().slice();let n=this.composedDetailPath();return s.detailPath=n&&n.slice(),s.type=this.type,s}};var oo=class r extends Yo{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;let s=new r(this.manager);s.eventPhase=s.NONE,s.currentTarget=null,s.path=[],s.detailPath=[],s.target=null,s.nativeEvent=this.nativeEvent,s.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,s),(e=this.manager)===null||e===void 0||e.copyMouseData(this,s),(i=this.manager)===null||i===void 0||i.copyData(this,s),s.target=this.target,s.path=this.composedPath().slice();let n=this.composedDetailPath();return s.detailPath=n&&n.slice(),s.type=this.type,s}};oo.DOM_DELTA_PIXEL=0,oo.DOM_DELTA_LINE=1,oo.DOM_DELTA_PAGE=2;var ao=class extends Ja{constructor(t,e){super(),this.type=t,this.detail=e}};var Qy="*";var lo=typeof performance=="object"&&performance.now?performance:Date;function Qa(r){return r==="mouse"||r==="pen"}var tx=class{constructor(t,e){this.dispatch=new lr.default,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,s)=>{if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let n=this.createPointerEvent(i,i.type,s);if(this.dispatchEvent(n,"pointerdown"),n.pointerType==="touch")this.dispatchEvent(n,"touchstart");else if(Qa(n.pointerType)){let o=n.button===2;this.dispatchEvent(n,o?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=n.composedPath(),this.freeEvent(n)},this.onPointerMove=(i,s)=>{var n,o;if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let a=this.createPointerEvent(i,i.type,s),l=Qa(a.pointerType),h=this.trackingData(i.pointerId),d=this.findMountedTarget(h.overTargets);if(h.overTargets&&d&&d!==this.rootTarget&&d!==a.target){let c=i.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(i,c,d||void 0);if(this.dispatchEvent(u,"pointerout"),l&&this.dispatchEvent(u,"mouseout"),!a.composedPath().includes(d)){let p=this.createPointerEvent(i,"pointerleave",d||void 0);for(p.eventPhase=p.AT_TARGET;p.target&&!a.composedPath().includes(p.target);)p.currentTarget=p.target,this.notifyTarget(p),l&&this.notifyTarget(p,"mouseleave"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(u)}if(d!==a.target){let c=i.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(a,c);this.dispatchEvent(u,"pointerover"),l&&this.dispatchEvent(u,"mouseover");let p=d?.parent;for(;p&&p!==this.rootTarget.parent&&p!==a.target;)p=p.parent;if(!p||p===this.rootTarget.parent){let m=this.clonePointerEvent(a,"pointerenter");m.eventPhase=m.AT_TARGET;let g=m.target,f=new Set,_=d;for(;_&&_!==this.rootTarget;)f.add(_),_=_.parent;for(;g&&g!==d&&g!==this.rootTarget.parent;)f.has(g)||(m.currentTarget=g,this.notifyTarget(m),l&&this.notifyTarget(m,"mouseenter")),g=g.parent;this.freeEvent(m)}this.freeEvent(u)}this.dispatchEvent(a,"pointermove"),a.pointerType==="touch"&&this.dispatchEvent(a,"touchmove"),l&&(this.dispatchEvent(a,"mousemove"),this.cursorTarget=a.target,this.cursor=((o=(n=a.target)===null||n===void 0?void 0:n.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor()),h.overTargets=a.composedPath(),this.freeEvent(a)},this.onPointerOver=(i,s)=>{var n,o;if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let a=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,s),h=Qa(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((o=(n=l.target)===null||n===void 0?void 0:n.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor());let d=this.clonePointerEvent(l,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),h&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;a.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(d)},this.onPointerOut=(i,s)=>{if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let n=this.trackingData(i.pointerId);if(n.overTargets){let o=Qa(i.pointerType),a=this.findMountedTarget(n.overTargets),l=this.createPointerEvent(i,"pointerout",a||void 0);this.dispatchEvent(l),o&&this.dispatchEvent(l,"mouseout");let h=this.createPointerEvent(i,"pointerleave",a||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),o&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;n.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,s)=>{var n;if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let o=lo.now(),a=this.createPointerEvent(i,i.type,s);if(this.dispatchEvent(a,"pointerup"),a.pointerType==="touch")this.dispatchEvent(a,"touchend");else if(Qa(a.pointerType)){let c=a.button===2;this.dispatchEvent(a,c?"rightup":"mouseup")}let l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]),d=h;if(h&&!a.composedPath().includes(h)){let c=h;for(;c&&!a.composedPath().includes(c);){if(a.currentTarget=c,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch")this.notifyTarget(a,"touchendoutside");else if(Qa(a.pointerType)){let u=a.button===2;this.notifyTarget(a,u?"rightupoutside":"mouseupoutside")}c=c.parent}delete l.pressTargetsByButton[i.button],d=c}if(d){let c=this.clonePointerEvent(a,"click");c.target=d,c.path=[],c.detailPath=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:c.target,timeStamp:o});let u=l.clicksByButton[i.button];u.target===c.target&&o-u.timeStamp<((n=this._config.clickInterval)!==null&&n!==void 0?n:200)?++u.clickCount:u.clickCount=1,u.target=c.target,u.timeStamp=o,c.detail=u.clickCount,Qa(c.pointerType)?(this.dispatchEvent(c,"click"),u.clickCount===2&&this.dispatchEvent(c,"dblclick")):c.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(c,"tap"),u.clickCount===2&&this.dispatchEvent(c,"dbltap")),this.dispatchEvent(c,"pointertap"),this.freeEvent(c)}this.freeEvent(a)},this.onPointerUpOutside=(i,s)=>{if(!(i instanceof Hr))return void Nt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");let n=this.trackingData(i.pointerId),o=this.findMountedTarget(n.pressTargetsByButton[i.button]),a=this.createPointerEvent(i,i.type,s);if(o){let l=o;for(;l;)a.currentTarget=l,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch"?this.notifyTarget(a,"touchendoutside"):Qa(a.pointerType)&&this.notifyTarget(a,a.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete n.pressTargetsByButton[i.button]}this.freeEvent(a)},this.onWheel=(i,s)=>{if(!(i instanceof oo))return void Nt.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");let n=this.createWheelEvent(i,s);this.dispatchEvent(n),this.freeEvent(n)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,s)=>i.priority-s.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,s,n,o,a,l;if(!this.rootTarget)return;let h=this.mappingTable[t.type],d,c=`${t.canvasX}-${t.canvasY}`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[c]&&(!((s=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[c])===null||s===void 0)&&s.stage)&&((o=(n=this._prePointTargetCache)===null||n===void 0?void 0:n[c])===null||o===void 0?void 0:o.stage.renderCount)===((a=this._prePointTargetCache)===null||a===void 0?void 0:a.stageRenderCount)?d=this._prePointTargetCache[c]:(d=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[c]:d,stageRenderCount:(l=d?.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let u=0,p=h.length;u<p;u++)h[u].fn(t,d);else Nt.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;let i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,n=i.length-1;s<n;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){let e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=e??t.type;let i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var s,n;let o=this.allocateEvent(Hr);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=i||this.pickTarget((s=o.viewX)!==null&&s!==void 0?s:o.global.x,(n=o.viewY)!==null&&n!==void 0?n:o.global.y,o),typeof e=="string"&&(o.type=e),o}createWheelEvent(t,e){var i,s;let n=this.allocateEvent(oo);return this.copyWheelData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=e||this.pickTarget((i=n.viewX)!==null&&i!==void 0?i:n.global.x,(s=n.viewY)!==null&&s!==void 0?s:n.global.y,n),n}clonePointerEvent(t,e){let i=this.allocateEvent(Hr);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();let s=t.composedDetailPath();return i.detailPath=s&&s.slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Hr&&e instanceof Hr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Yo&&e instanceof Yo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{e[i].x=t[i].x,e[i].y=t[i].y}))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=lo.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);let i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");let i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){let i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].once&&t.currentTarget.removeEventListener(e,i[s].fn,{once:!0}),i[s].fn.call(i[s].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){let i=t.currentTarget._events[Qy];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let s=0,n=i.length;s<n&&!t.propagationImmediatelyStopped;s++)i[s].fn.call(i[s].context,t,e)}pickTarget(t,e,i){let s,n=this.rootTarget.pick(t,e);return s=n&&n.graphic?n.graphic:n&&n.group?n.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=n.params),s}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}};var wB={dispatchEvent(r){var t;if(!(r instanceof Ja))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=[],r.detailPath&&(r.detailPath=[]),r.target=this,(t=r?.manager)===null||t===void 0||t.dispatchEvent(r),!r.defaultPrevented},emit(r,t){return this.dispatchEvent(new ao(r,t))}};var tY={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ex=class{constructor(t){this.resolution=1,this.onPointerDown=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;let c=this.normalizeToPointerData(d);this.autoPreventDefault&&c[0].isNormalized&&(d.cancelable||!("cancelable"in d))&&d.preventDefault();for(let u=0,p=c.length;u<p;u++){let m=c[u],g=this.bootstrapEvent(this.rootPointerEvent,m);this.manager.mapEvent(g)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch"||this.isEventOutsideOfTargetElement(d))return;let c=this.normalizeToPointerData(d);for(let u=0,p=c.length;u<p;u++){let m=this.bootstrapEvent(this.rootPointerEvent,c[u]);this.manager.mapEvent(m)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;let c=this.isEventOutsideOfTargetViewPort(d)?"outside":"",u=this.normalizeToPointerData(d);for(let p=0,m=u.length;p<m;p++){let g=this.bootstrapEvent(this.rootPointerEvent,u[p]);g.type+=c,this.manager.mapEvent(g)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;let c=this.normalizeToPointerData(d);for(let u=0,p=c.length;u<p;u++){let m=this.bootstrapEvent(this.rootPointerEvent,c[u]);this.manager.mapEvent(m)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=d=>{let c=this.normalizeWheelEvent(d);this.manager.mapEvent(c)};let{targetElement:e,resolution:i,rootNode:s,global:n,autoPreventDefault:o=!1,clickInterval:a,supportsTouchEvents:l=n.supportsTouchEvents,supportsPointerEvents:h=n.supportsPointerEvents}=t;this.manager=new tx(s,{clickInterval:a,supportsTouchEvents:l}),this.globalObj=n,this.supportsPointerEvents=h,this.supportsTouchEvents=l,this.supportsMouseEvents=n.supportsMouseEvents,this.applyStyles=n.applyStyles,this.autoPreventDefault=o,this.eventsAdded=!1,this.rootPointerEvent=new Hr,this.rootWheelEvent=new oo,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");let{applyStyles:i,domElement:s}=this;if(this.currentCursor===t)return;this.currentCursor=t;let n=this.cursorStyles[t];n?typeof n=="string"&&i?s.style.cursor=n:typeof n=="function"?n(t):typeof n=="object"&&i&&Object.assign(s.style,n):i&&Z(t)&&!zn(this.cursorStyles,t)&&(s.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;let{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;let{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().removeEventListener("pointermove",this.onPointerMove,!0),t.getDocument().removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().removeEventListener("mousemove",this.onPointerMove,!0),t.getDocument().removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;let s=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(s)return s;let n=0,o=0;if(t.changedTouches){let l=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};n=l.clientX||0,o=l.clientY||0}else n=t.clientX||0,o=t.clientY||0;let a=this.domElement.getBoundingClientRect();return{x:n-a.left,y:o-a.top}}normalizeToPointerData(t){let e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,s=t.changedTouches.length;i<s;i++){let n=t.changedTouches[i];He(n.button)&&(n.button=0),He(n.buttons)&&(n.buttons=1),He(n.isPrimary)&&(n.isPrimary=t.touches.length===1&&t.type==="touchstart"),He(n.width)&&(n.width=n.radiusX||1),He(n.height)&&(n.height=n.radiusY||1),He(n.tiltX)&&(n.tiltX=0),He(n.tiltY)&&(n.tiltY=0),He(n.pointerType)&&(n.pointerType="touch"),He(n.pointerId)&&(n.pointerId=n.identifier||0),He(n.pressure)&&(n.pressure=n.force||.5),He(n.twist)&&(n.twist=0),He(n.tangentialPressure)&&(n.tangentialPressure=0),He(n.layerX)&&(n.layerX=n.offsetX=n.clientX),He(n.layerY)&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=t.type,e.push(n)}else if(this.globalObj.supportsMouseEvents&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof PointerEvent))e.push(t);else{let i=t;He(i.isPrimary)&&(i.isPrimary=!0),He(i.width)&&(i.width=1),He(i.height)&&(i.height=1),He(i.tiltX)&&(i.tiltX=0),He(i.tiltY)&&(i.tiltY=0),He(i.pointerType)&&(i.pointerType="mouse"),He(i.pointerId)&&(i.pointerId=1),He(i.pressure)&&(i.pressure=.5),He(i.twist)&&(i.twist=0),He(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){let e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;let{x:i,y:s}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=s,e.global.x=i,e.global.y=s,e.offset.x=i,e.offset.y=s;let{x:n,y:o}=this.mapToViewportPoint(e);return e.viewport.x=n,e.viewport.y=o,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);let{x:i,y:s}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=s,t.global.x=i,t.global.y=s,t.offset.x=i,t.offset.y=s;let{x:n,y:o}=this.mapToViewportPoint(t);return t.viewport.x=n,t.viewport.y=o,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=tY[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=lo.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){let e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),s=i.width(),n=i.height();return!(e.x<s&&e.y<n&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}};var Qr;(function(r){r[r.INITIAL=0]="INITIAL",r[r.RUNNING=1]="RUNNING",r[r.PAUSE=2]="PAUSE"})(Qr||(Qr={}));var Mc=class r{static Avaliable(){return!!j.global.getRequestAnimationFrame()}avaliable(){return r.Avaliable()}tick(t,e){j.global.getRequestAnimationFrame()(()=>{this.released||e(this)})}release(){this.released=!0}getTime(){return Date.now()}};var Mg=class r{static Avaliable(){return!0}avaliable(){return r.Avaliable()}tick(t,e){this.timerId=setTimeout(()=>{e(this)},t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}};var Dc=class extends lr.default{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(t=[]){super(),this.handleTick=(e,i)=>{let{once:s=!1}=i??{};this.ifCanStop()?this.stop():(this._handlerTick(),s||e.tick(this.interval,this.handleTick))},this._handlerTick=()=>{let e=this.tickerHandler.getTime(),i=0;this.lastFrameTime>=0&&(i=e-this.lastFrameTime),this.lastFrameTime=e,this.status===Qr.RUNNING&&(this.tickCounts++,this.timelines.forEach(s=>{s.tick(i)}),this.emit("tick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=Qr.INITIAL,j.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),j.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter(e=>e!==t)}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;let t=[{mode:"raf",cons:Mc},{mode:"timeout",cons:Mg}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new Mc;break;case"timeout":t=new Mg;break;default:Nt.getInstance().warn("\u975E\u6CD5\u7684\u8BA1\u65F6\u5668\u6A21\u5F0F"),t=new Mc}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,e=>{this.handleTick(e,{once:!0})})}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,e=>{this.handleTick(e,{once:!0})})}pause(){return this.status!==Qr.INITIAL&&(this.status=Qr.PAUSE,!0)}resume(){return this.status!==Qr.INITIAL&&(this.status=Qr.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((t,e)=>t+e.animateCount,0)===0))}start(t=!1){return this.status===Qr.RUNNING||!this.tickerHandler||!t&&(this.status===Qr.PAUSE||!this.timelines.length||this.timelines.reduce((e,i)=>e+i.animateCount,0)===0)?!1:(this.status=Qr.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=Qr.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit("afterTick")}trySyncTickStatus(){this.status===Qr.RUNNING&&this._handlerTick()}};var Wt=class r{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-r.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;let s=e/vt*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*vt/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;let s=e/vt*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-s)*vt/e)+1}}static getElasticInOut(t,e){return function(i){let s=e/vt*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-s)*vt/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-s)*vt/e)*.5+1}}static registerFunc(t,e){r[t]=e}};function eY(r,t){let e=1/t,i=1;for(;r>e;)r-=e,i*=-1;let s=i*r/e;return s>0?s:1+s}Wt.quadIn=Wt.getPowIn(2),Wt.quadOut=Wt.getPowOut(2),Wt.quadInOut=Wt.getPowInOut(2),Wt.cubicIn=Wt.getPowIn(3),Wt.cubicOut=Wt.getPowOut(3),Wt.cubicInOut=Wt.getPowInOut(3),Wt.quartIn=Wt.getPowIn(4),Wt.quartOut=Wt.getPowOut(4),Wt.quartInOut=Wt.getPowInOut(4),Wt.quintIn=Wt.getPowIn(5),Wt.quintOut=Wt.getPowOut(5),Wt.quintInOut=Wt.getPowInOut(5),Wt.backIn=Wt.getBackIn(1.7),Wt.backOut=Wt.getBackOut(1.7),Wt.backInOut=Wt.getBackInOut(1.7),Wt.elasticIn=Wt.getElasticIn(1,.3),Wt.elasticOut=Wt.getElasticOut(1,.3),Wt.elasticInOut=Wt.getElasticInOut(1,.3*1.5),Wt.easeInOutQuad=r=>(r/=.5)<1?.5*Math.pow(r,2):-.5*((r-=2)*r-2),Wt.easeOutElastic=r=>{let t=2*Math.PI/3;return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((10*r-.75)*t)+1},Wt.easeInOutElastic=r=>{let t=2*Math.PI/4.5;return r===0?0:r===1?1:r<.5?-Math.pow(2,20*r-10)*Math.sin((20*r-11.125)*t)/2:Math.pow(2,-20*r+10)*Math.sin((20*r-11.125)*t)/2+1};for(let r=0;r<10;r++)Wt[`flicker${r}`]=t=>eY(t,r);for(let r=2;r<10;r++)Wt[`aIn${r}`]=t=>r*t*t+(1-r)*t;var Ec=class{constructor(){this.id=le.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===er.END?this.removeAnimate(e):e.status===er.RUNNING||e.status===er.INITIAL?(this.animateCount++,e.advance(t)):e.status===er.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t,e=!0){t._onRemove&&t._onRemove.forEach(i=>i()),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}},Lh=new Ec;var Os=class{constructor(t,e,i,s,n){this.from=t,this.to=e,this.duration=i,this.easing=s,this.params=n,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;let e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},(t=this.step.prev.getLastProps())!==null&&t!==void 0?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(this.updateCount===0){this.onFirstRun();let s=this.step.getLastProps();Object.keys(s).forEach(n=>{this.subAnimate.animate.validAttr(n)&&(i[n]=s[n])})}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}},yk=class extends Os{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}},wc=class r{constructor(t=le.GenAutoIncrementId(),e=Lh,i){this.id=t,this.timeline=e||Lh,this.status=er.INITIAL,this.tailAnimate=new ix(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((t,e)=>t+e.totalDuration,0)}after(t){let e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach(i=>{e=ri(i.getDuration(),e)}),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){r.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t,e=r.mode){t&&e&kh.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:fi.ANIMATE_PLAY})}runCb(t){let e=new yk(()=>{t(this,e.step.prev)});return this.tailAnimate.play(e),this}customInterpolate(t,e,i,s,n,o){let a=r.interpolateMap.get(t)||r.interpolateMap.get("");return!!a&&a(t,e,i,s,n,o)}pause(){this.status===er.RUNNING&&(this.status=er.PAUSED)}resume(){this.status===er.PAUSED&&(this.status=er.RUNNING)}to(t,e,i,s){if(this.tailAnimate.to(t,e,i,s),this.target){let n=this.target.stage;n&&n.renderNextFrame()}return this}from(t,e,i,s){if(this.tailAnimate.from(t,e,i,s),this.target){let n=this.target.stage;n&&n.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){let e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){let t=new ix(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach(e=>this.preventAttr(e))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(e=>{e.bind(t)}),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===er.INITIAL&&(this.status=er.RUNNING,this._onStart&&this._onStart.forEach(e=>e())),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===er.RUNNING&&(this.status=er.END,this._onEnd&&this._onEnd.forEach(e=>e()))}setPosition(t){let e,i=0,s=this.rawPosition,n=this.subAnimates.reduce((a,l)=>a+l.totalDuration,0);t<0&&(t=0);let o=t>=n;if(o&&(t=n),t===s)return o;for(let a=0;a<this.subAnimates.length&&(e=this.subAnimates[a],!(i+e.totalDuration>=t));a++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),o}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=er.END}stop(t){t||this.target.onStop(),t==="start"?this.target.onStop(this.getStartProps()):t==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}};wc.mode=kh.NORMAL,wc.interpolateMap=new Map;var ix=class{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new rx(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(e==null||e<0)&&(e=0);let i=t.easing,s=typeof i=="string"?Wt[i]:i,n=this._addStep(e,null,s);return n.type=Mh.customAnimate,this._appendProps(t.getEndProps(),n,!1),this._appendCustomAnimate(t,n),this}to(t,e,i,s){(e==null||e<0)&&(e=0);let n=typeof i=="string"?Wt[i]:i,o=this._addStep(e,null,n);return o.type=Mh.to,this._appendProps(t,o,!!s&&s.tempProps),o.propKeys||(o.propKeys=Object.keys(o.props)),s&&s.noPreventAttrs||this.target.animates&&this.target.animates.forEach(a=>{a.id!==this.animate.id&&a.preventAttrs(o.propKeys)}),this}from(t,e,i,s){this.to(t,0,i,s);let n={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(o=>{n[o]=this.getLastPropByName(o,this.stepTail)}),this.to(n,e,i,s),this.stepTail.type=Mh.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return(t=this.stepHead)===null||t===void 0?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){let e=this._addStep(+t,null);e.type=Mh.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){let s=new rx(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(s),this.stepTail=s,s}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let s=e.prev,n=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach(a=>{e.props[a]===void 0&&(e.props[a]=this.target.getDefaultAttribute(a))});s.prev;)s.props&&(s.propKeys||(s.propKeys=Object.keys(s.props)),s.propKeys.forEach(a=>{n[a]===void 0&&(n[a]=s.props[a])})),e.propKeys=Object.keys(e.props),s=s.prev;let o=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(n)),e.propKeys.forEach(a=>{if(o[a]===void 0){let l=this.animate.getStartProps();o[a]=l[a]=this.target.getComputedAttribute(a)}}),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;let i=this.duration,s=this.loop,n=this.rawPosition,o,a,l=!1,h=(e=this._startAt)!==null&&e!==void 0?e:0;if(t<0&&(t=0),t<h)return this.rawPosition=t,!1;if(t-=h,i<=0&&(l=!0,i<0)||(o=Math.floor(t/i),a=t-o*i,l=t>=s*i+i,l&&(a=i,o=s,t=a*o+i),t===n))return l;let d=!this.reversed!=!(this.bounce&&o%2);return d&&(a=i-a),this._deltaPosition=a-this.position,this.position=a,this.rawPosition=t+h,this.updatePosition(l,d),l}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next,s=this.position,n=this.duration;if(this.target&&i){let o=i.next;for(;o&&o.position<=s;)i=o,o=i.next;let a=t?n===0?1:s/n:(s-i.position)/i.duration;i.easing&&(a=i.easing(a)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,a,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(l=>l(i,a))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let s=e.prev;for(;s&&s!==t;)s.customAnimate&&(s.customAnimate.onStart&&s.customAnimate.onStart(),s.customAnimate.onEnd&&s.customAnimate.onEnd()),s=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let s=e.next;for(;s&&s!==t;)s.customAnimate&&(s.customAnimate.onStart&&s.customAnimate.onStart(),s.customAnimate.onEnd&&s.customAnimate.onEnd()),s=s.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&i.props[t]!==void 0)return i.props[t];if(i.customAnimate){let s=i.customAnimate.getEndProps()[t];if(s!==void 0)return s}i=i.prev}return Nt.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0Cstep\u4E2D\u627E\u4E0D\u5230\u5C5E\u6027"),e.props[t]}updateTarget(t,e,i){t.props==null&&t.customAnimate==null||this.target.onStep(this,this.animate,t,e,i)}},rx=class{constructor(t,e,i,s){this.duration=e,this.position=t,this.props=i,this.easing=s}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}};var xk={duration:200,easing:"cubicOut"};var PB;(function(r){r[r.Top=1]="Top",r[r.Right=2]="Right",r[r.Bottom=4]="Bottom",r[r.Left=8]="Left",r[r.ALL=15]="ALL"})(PB||(PB={}));var Xo=[!1,!1,!1,!1],RB=r=>{var t;let e=!0;if(te(r,!0)){for(let i=0;i<4;i++)Xo[i]=r,e&&(e=!((t=Xo[i])!==null&&t!==void 0&&!t));e=r}else if(Array.isArray(r))for(let i=0;i<4;i++)Xo[i]=!!r[i],e&&(e=!!Xo[i]);else Xo[0]=!1,Xo[1]=!1,Xo[2]=!1,Xo[3]=!1;return{isFullStroke:e,stroke:Xo}},Dg=[0,0,0,0],Eg=r=>r?H(r)?r.length===0?0:r.length===1?r[0]:r.length===2?(Dg[0]=r[0],Dg[2]=r[0],Dg[1]=r[1],Dg[3]=r[1],Dg):r:r:0,Pc=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],sx=[1,2,3,0,1,2,3,0];function wg(r,t,e,i){for(;r>=vt;)r-=vt;for(;r<0;)r+=vt;for(;r>t;)t+=vt;Pc[0].x=e,Pc[1].y=e,Pc[2].x=-e,Pc[3].y=-e;let s=Math.ceil(r/br)%4,n=Math.ceil(t/br)%4;if(i.add(Ce(r)*e,ce(r)*e),i.add(Ce(t)*e,ce(t)*e),s!==n||t-r>ge){let o=!1;for(let a=0;a<sx.length;a++)if(o||s!==sx[a]){if(o&&n===sx[a])break;if(o){let l=Pc[sx[a]];i.add(l.x,l.y)}}else{o=!0;let l=Pc[s];i.add(l.x,l.y)}}}function bk(r,t,e){let{x:i,y:s}=FC(r.x,r.y,t.x,t.y,e),{x:n,y:o}=FC(r.x1,r.y1,t.x1,t.y1,e),a=new Xt(i,s,n,o);return a.defined=t.defined,a}function Rc(r,t,e){if(!r||!t)return[];Array.isArray(r)||(r=[r]),Array.isArray(t)||(t=[t]);let i=[];if(r.length>t.length){i=t.map(s=>{let n=new Xt(s.x,s.y,s.x1,s.y1);return n.defined=s.defined,n});for(let s=0;s<t.length;s++)i[s]=bk(r[s],t[s],e)}else{i=t.map(s=>{let n=new Xt(s.x,s.y,s.x1,s.y1);return n.defined=s.defined,n});for(let s=0;s<r.length;s++)i[s]=bk(r[s],t[s],e)}return i}function Pg(r,t){if(H(r)){let e;for(let i=0;i<r.length&&e===void 0;i++)e=r[i][t];return e}return r[t]}var nx=class r{constructor(t=r.TimeOut){this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),t(0)},this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((e,i)=>e+i,0)/this.durations.length,1e3/60),1e3/30)}};nx.TimeOut=1e3/60;var Bc=new nx,iY=(r,t)=>Z(r)&&r[r.length-1]==="%"?t*(Number.parseFloat(r.substring(0,r.length-1))/100):r,Ih=(r,t)=>{let e=iY(r,t);return isNaN(e)?e:Math.max(t,e)};var ox=class extends Os{constructor(t,e,i,s,n){super(t,e,i,s,n)}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var t,e,i,s,n,o,a,l;this.fromNumber=J((t=this.from)===null||t===void 0?void 0:t.text)?(e=this.from)===null||e===void 0?void 0:e.text:Number.parseFloat((i=this.from)===null||i===void 0?void 0:i.text),this.toNumber=J((s=this.to)===null||s===void 0?void 0:s.text)?(n=this.to)===null||n===void 0?void 0:n.text:Number.parseFloat((o=this.to)===null||o===void 0?void 0:o.text),Number.isFinite(this.toNumber)||(this.fromNumber=0),Number.isFinite(this.toNumber)||(this.valid=!1),this.valid!==!1&&(this.decimalLength=(l=(a=this.params)===null||a===void 0?void 0:a.fixed)!==null&&l!==void 0?l:Math.max(Yn(this.fromNumber),Yn(this.toNumber)))}onEnd(){}onUpdate(t,e,i){var s;this.valid!==!1&&(i.text=t?(s=this.to)===null||s===void 0?void 0:s.text:(this.fromNumber+(this.toNumber-this.fromNumber)*e).toFixed(this.decimalLength))}},BB;(function(r){r[r.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",r[r.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",r[r.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",r[r.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",r[r.STROKE=4]="STROKE"})(BB||(BB={}));var Sk=r=>{if(!r)return{x:0,y:0,width:0,height:0};let t=T(r.width)?r.x1-r.x:r.width,e=T(r.height)?r.y1-r.y:r.height,i=0,s=0;return t<0?(i=t,t=-t):Number.isNaN(t)&&(t=0),e<0?(s=e,e=-e):Number.isNaN(e)&&(e=0),{x:i,y:s,width:t,height:e}};var Cr;(function(r){r[r.Color255=0]="Color255",r[r.Color1=1]="Color1"})(Cr||(Cr={}));var Nr=class r{static Get(t,e=Cr.Color1,i=[0,0,0,1]){if(e===Cr.Color1){let o=r.store1[t];if(o)return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i;let a=Di.parseColorString(t);if(a){let l=[a.r/255,a.g/255,a.b/255,a.opacity];r.store1[t]=l,r.store255[t]=[a.r,a.g,a.b,a.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}let s=r.store255[t];if(s)return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i;let n=Di.parseColorString(t);return n&&(r.store1[t]=[n.r/255,n.g/255,n.b/255,n.opacity],r.store255[t]=[n.r,n.g,n.b,n.opacity],i[0]=n.r,i[1]=n.g,i[2]=n.b,i[3]=n.opacity),i}static Set(t,e,i){if(e===Cr.Color1){if(r.store1[t])return;r.store1[t]=i,r.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(r.store255[t])return;r.store255[t]=i,r.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}};Nr.store255={},Nr.store1={};function ax(r,t=!1){return Array.isArray(r)&&J(r[0])?t?`rgb(${Math.round(r[0])},${Math.round(r[1])},${Math.round(r[2])},${r[3].toFixed(2)})`:`rgb(${Math.round(r[0])},${Math.round(r[1])},${Math.round(r[2])})`:r}function $o(r,t,e,i,s){return Array.isArray(r)&&!J(r[0])||Array.isArray(t)&&!J(t[0])?new Array(4).fill(0).map((n,o)=>LB(H(r)?r[o]:r,H(t)?t[o]:t,e,i)):LB(r,t,e,i,s)}function LB(r,t,e,i,s){if(!r||!t)return r&&ax(r)||t&&ax(t)||!1;let n,o,a=!1,l=!1;if(Array.isArray(r)?n=r:typeof r=="string"?n=Nr.Get(r,Cr.Color255):a=!0,Array.isArray(t)?o=t:typeof t=="string"?o=Nr.Get(t,Cr.Color255):l=!0,a!==l){let h=a?r:t,d=a?t:r,c=Object.assign(Object.assign({},h),{stops:h.stops.map(u=>Object.assign(Object.assign({},u),{color:ax(d)}))});return a?$o(h,c,e,i,s):$o(c,h,e,i,s)}if(a){if(r.gradient===t.gradient){let h=r,d=t,c=h.stops,u=d.stops;if(c.length!==u.length)return!1;if(h.gradient==="linear")return sY(h,d,e);if(h.gradient==="radial")return nY(h,d,e);if(h.gradient==="conical")return oY(h,d,e)}return!1}return s&&s(n,o),ax(aY(n,o,e),i)}function sY(r,t,e){let i=r.stops,s=t.stops;return{gradient:"linear",x0:r.x0+(t.x0-r.x0)*e,x1:r.x1+(t.x1-r.x1)*e,y0:r.y0+(t.y0-r.y0)*e,y1:r.y1+(t.y1-r.y1)*e,stops:new Array(i.length).fill(0).map((n,o)=>({color:Ak(i[o].color,s[o].color,e),offset:i[o].offset+(s[o].offset-i[o].offset)*e}))}}function nY(r,t,e){let i=r.stops,s=t.stops;return{gradient:"radial",x0:r.x0+(t.x0-r.x0)*e,x1:r.x1+(t.x1-r.x1)*e,y0:r.y0+(t.y0-r.y0)*e,y1:r.y1+(t.y1-r.y1)*e,r0:r.r0+(t.r0-r.r0)*e,r1:r.r1+(t.r1-r.r1)*e,stops:new Array(i.length).fill(0).map((n,o)=>({color:Ak(i[o].color,s[o].color,e),offset:i[o].offset+(s[o].offset-i[o].offset)*e}))}}function oY(r,t,e){let i=r.stops,s=t.stops;return{gradient:"conical",startAngle:r.startAngle+(t.startAngle-r.startAngle)*e,endAngle:r.endAngle+(t.endAngle-r.endAngle)*e,x:r.x+(t.x-r.x)*e,y:r.y+(t.y-r.y)*e,stops:new Array(i.length).fill(0).map((n,o)=>({color:Ak(i[o].color,s[o].color,e),offset:i[o].offset+(s[o].offset-i[o].offset)*e}))}}function aY(r,t,e){return[r[0]+(t[0]-r[0])*e,r[1]+(t[1]-r[1])*e,r[2]+(t[2]-r[2])*e,r[3]+(t[3]-r[3])*e]}var Ko=[0,0,0,0],Rg=[0,0,0,0];function Ak(r,t,e){return Nr.Get(r,Cr.Color255,Ko),Nr.Get(t,Cr.Color255,Rg),`rgba(${Math.round(Ko[0]+(Rg[0]-Ko[0])*e)},${Math.round(Ko[1]+(Rg[1]-Ko[1])*e)},${Math.round(Ko[2]+(Rg[2]-Ko[2])*e)},${Ko[3]+(Rg[3]-Ko[3])*e})`}var lY={};Object.keys(La).forEach(r=>{let t=La[r];lY[r]=[t>>16&255,t>>8&255,255&t]});var lx=class extends Os{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:e}})}},hx=class extends Os{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:1-e}})}};var mn=class r{static GetImage(t,e){var i;let s=r.cache.get(t);s?s.loadState==="fail"?j.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):s.loadState==="init"||s.loadState==="loading"?(i=s.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,s.data):r.loadImage(t,e)}static GetSvg(t,e){var i;let s=r.cache.get(t);s?s.loadState==="fail"?j.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):s.loadState==="init"||s.loadState==="loading"?(i=s.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,s.data):(s={type:"image",loadState:"init"},r.cache.set(t,s),s.dataPromise=j.global.loadSvg(t),s.dataPromise?(s.waitingMark=[e],s.dataPromise.then(n=>{var o;s.loadState=n?.data?"success":"fail",s.data=n?.data,(o=s.waitingMark)===null||o===void 0||o.map((a,l)=>{n?.data?(s.loadState="success",s.data=n.data,a.imageLoadSuccess(t,n.data)):(s.loadState="fail",a.imageLoadFail(t))}),s.waitingMark&&(s.waitingMark=[])})):(s.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=r.cache.get(t);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then(s=>s.data):Promise.resolve(i.data):(i={type:e,loadState:"init"},r.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=j.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=j.global.loadBlob(t):e==="json"&&(i.dataPromise=j.global.loadJson(t)),i.dataPromise.then(s=>s.data))}static loading(){setTimeout(()=>{if(!r.isLoading&&r.toLoadAueue.length){r.isLoading=!0;let t=r.toLoadAueue.splice(0,10),e=[];t.forEach(i=>{let{url:s,marks:n}=i,o={type:"image",loadState:"init"};if(r.cache.set(s,o),o.dataPromise=j.global.loadImage(s),o.dataPromise){o.waitingMark=n;let a=o.dataPromise.then(l=>{var h;o.loadState=l?.data?"success":"fail",o.data=l?.data,(h=o.waitingMark)===null||h===void 0||h.map((d,c)=>{l?.data?(o.loadState="success",o.data=l.data,d.imageLoadSuccess(s,l.data)):(o.loadState="fail",d.imageLoadFail(s))}),o.waitingMark&&(o.waitingMark=[])});e.push(a)}else o.loadState="fail",n.forEach(a=>a.imageLoadFail(s))}),Promise.all(e).then(()=>{r.isLoading=!1,this.onLoadSuccessCb.forEach(i=>i()),r.loading()}).catch(i=>{console.error(i),r.isLoading=!1,this.onLoadSuccessCb.forEach(s=>s()),r.loading()})}},0)}static loadImage(t,e){let i=IB(t,r.toLoadAueue);if(i!==-1)return r.toLoadAueue[i].marks.push(e),void r.loading();r.toLoadAueue.push({url:t,marks:[e]}),r.loading()}static improveImageLoading(t){let e=IB(t,r.toLoadAueue);if(e!==-1){let i=r.toLoadAueue.splice(e,1);r.toLoadAueue.unshift(i[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}};function IB(r,t){for(let e=0;e<t.length;e++)if(t[e].url===r)return e;return-1}mn.cache=new Map,mn.isLoading=!1,mn.toLoadAueue=[],mn.onLoadSuccessCb=[];var Yt=class{bounds(t,e){if(J(t)){let i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}};function FB(r,t,e,i,s){return s?r.arc(e,i,t,0,gi,!1,s):r.arc(e,i,t,0,gi),!1}var Ck=class extends Yt{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,s,n){return FB(t,this.parseSize(e)/2,i,s,n)}drawOffset(t,e,i,s,n,o){return FB(t,this.parseSize(e)/2+n,i,s,o)}drawToSvgPath(t,e,i,s){let n=this.parseSize(t)/2;return`M ${e-n}, ${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}},OB=new Ck;function hY(r,t,e,i,s){return r.moveTo(-3*t+e,-t+i,s),r.lineTo(-t+e,-t+i,s),r.lineTo(-t+e,-3*t+i,s),r.lineTo(t+e,-3*t+i,s),r.lineTo(t+e,-t+i,s),r.lineTo(3*t+e,-t+i,s),r.lineTo(3*t+e,t+i,s),r.lineTo(t+e,t+i,s),r.lineTo(t+e,3*t+i,s),r.lineTo(-t+e,3*t+i,s),r.lineTo(-t+e,t+i,s),r.lineTo(-3*t+e,t+i,s),r.closePath(),!0}function dY(r,t,e,i,s,n){return r.moveTo(-3*t+e-s,-t+i-s,n),r.lineTo(-t+e-s,-t+i-s,n),r.lineTo(-t+e-s,-3*t+i-s,n),r.lineTo(t+e+s,-3*t+i-s,n),r.lineTo(t+e+s,-t+i-s,n),r.lineTo(3*t+e+s,-t+i-s,n),r.lineTo(3*t+e+s,t+i+s,n),r.lineTo(t+e+s,t+i+s,n),r.lineTo(t+e+s,3*t+i+s,n),r.lineTo(-t+e-s,3*t+i+s,n),r.lineTo(-t+e-s,t+i+s,n),r.lineTo(-3*t+e-s,t+i+s,n),r.closePath(),!0}var Tk=class extends Yt{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,s,n){return hY(t,this.parseSize(e)/6,i,s,n)}drawOffset(t,e,i,s,n,o){return dY(t,this.parseSize(e)/6,i,s,n,o)}},HB=new Tk;function kk(r,t,e,i,s){return r.moveTo(e,i-t,s),r.lineTo(t+e,i,s),r.lineTo(e,i+t,s),r.lineTo(e-t,i,s),r.closePath(),!0}var Mk=class extends Yt{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,s,n){return kk(t,this.parseSize(e)/2,i,s,n)}drawFitDir(t,e,i,s,n){return kk(t,this.parseSize(e)/2,i,s,n)}drawOffset(t,e,i,s,n,o){return kk(t,this.parseSize(e)/2+n,i,s,o)}},NB=new Mk;function VB(r,t,e,i){let s=2*t;return r.rect(e-t,i-t,s,s),!1}var Dk=class extends Yt{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,s){return VB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return VB(t,this.parseSize(e)/2+n,i,s)}},jB=new Dk;function zB(r,t,e,i,s=0){return r.moveTo(e+t+2*s,t+i+s),r.lineTo(e-t-2*s,t+i+s),r.lineTo(e,i-t-2*s),r.closePath(),!0}var Bg=class extends Yt{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,s){return zB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return zB(t,this.parseSize(e)/2,i,s,n)}},GB=new Bg;var Ek=class extends Bg{constructor(){super(...arguments),this.type="triangle"}},UB=new Ek;var YB=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),cY=Math.sin(gi/10)*YB,uY=-Math.cos(gi/10)*YB;function WB(r,t,e,i){let s=cY*t,n=uY*t;r.moveTo(e,-t+i),r.lineTo(s+e,n+i);for(let o=1;o<5;++o){let a=gi*o/5,l=Math.cos(a),h=Math.sin(a);r.lineTo(h*t+e,-l*t+i),r.lineTo(l*s-h*n+e,h*s+l*n+i)}return r.closePath(),!0}var wk=class extends Yt{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,s){return WB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return WB(t,this.parseSize(e)/2+n,i,s)}},XB=new wk;var pY=ar(3);function KB(r,t,e,i){let s=t,n=s/pY,o=n/5,a=t;return r.moveTo(0+e,-s+i),r.lineTo(n/2+e,i),r.lineTo(o/2+e,i),r.lineTo(o/2+e,a+i),r.lineTo(-o/2+e,a+i),r.lineTo(-o/2+e,i),r.lineTo(-n/2+e,i),r.closePath(),!0}var Pk=class extends Yt{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,s){return KB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return KB(t,this.parseSize(e)/2+n,i,s)}},$B=new Pk;function qB(r,t,e,i){let s=2*t;return r.moveTo(e,-t+i),r.lineTo(s/3/2+e,t+i),r.lineTo(-s/3/2+e,t+i),r.closePath(),!0}var Rk=class extends Yt{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,s){return qB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return qB(t,this.parseSize(e)/2+n,i,s)}},ZB=new Rk;function JB(r,t,e,i){return r.moveTo(-t+e,i),r.lineTo(e,t+i),!1}var Bk=class extends Yt{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,s){return JB(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return JB(t,this.parseSize(e)/2+n,i,s)}},QB=new Bk;var Hs=-.5,Ns=ar(3)/2,Lk=1/ar(12),aft=3*(Lk/2+1);function tL(r,t,e,i){let s=t/2,n=t*Lk,o=s,a=t*Lk+t,l=-o,h=a;return r.moveTo(s+e,n+i),r.lineTo(o+e,a+i),r.lineTo(l+e,h+i),r.lineTo(Hs*s-Ns*n+e,Ns*s+Hs*n+i),r.lineTo(Hs*o-Ns*a+e,Ns*o+Hs*a+i),r.lineTo(Hs*l-Ns*h+e,Ns*l+Hs*h+i),r.lineTo(Hs*s+Ns*n+e,Hs*n-Ns*s+i),r.lineTo(Hs*o+Ns*a+e,Hs*a-Ns*o+i),r.lineTo(Hs*l+Ns*h+e,Hs*h-Ns*l+i),r.closePath(),!1}var Ik=class extends Yt{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,s){return tL(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return tL(t,this.parseSize(e)/2+n,i,s)}},eL=new Ik;function iL(r,t,e,i,s){return r.moveTo(-t+e-2*s,i),r.lineTo(t+e+s,t+i+2*s),r.lineTo(t+e+s,i-t-2*s),r.closePath(),!0}var Fk=class extends Yt{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,s){return iL(t,this.parseSize(e)/2,i,s,0)}drawOffset(t,e,i,s,n){return iL(t,this.parseSize(e)/2,i,s,n)}},rL=new Fk;function sL(r,t,e,i,s=0){return r.moveTo(e-t-s,t+i+2*s),r.lineTo(t+e+2*s,i),r.lineTo(e-t-s,i-t-2*s),r.closePath(),!0}var Ok=class extends Yt{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,s){return sL(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return sL(t,this.parseSize(e)/2,i,s,n)}},nL=new Ok;function oL(r,t,e,i,s=0){return r.moveTo(e-t-2*s,i-t-s),r.lineTo(e+t+2*s,i-t-s),r.lineTo(e,i+t+2*s),r.closePath(),!0}var Hk=class extends Yt{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,s){return oL(t,this.parseSize(e)/2,i,s)}drawOffset(t,e,i,s,n){return oL(t,this.parseSize(e)/2,i,s,n)}},aL=new Hk;var Nk=ar(3);function lL(r,t,e,i){let s=t*Nk;return r.moveTo(e,i+-s/3*2),r.lineTo(t+e,i+s),r.lineTo(e-t,i+s),r.closePath(),!0}var Vk=class extends Yt{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,s){return lL(t,this.parseSize(e)/2/Nk,i,s)}drawOffset(t,e,i,s,n){return lL(t,this.parseSize(e)/2/Nk+n,i,s)}},hL=new Vk;function dL(r,t,e,i){let s=2*t;return r.moveTo(t+e,i-s),r.lineTo(e-t,i),r.lineTo(t+e,s+i),!0}var jk=class extends Yt{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,s){return dL(t,this.parseSize(e)/4,i,s)}drawOffset(t,e,i,s,n){return dL(t,this.parseSize(e)/4+n,i,s)}},cL=new jk;function uL(r,t,e,i){let s=2*t;return r.moveTo(e-t,i-s),r.lineTo(e+t,i),r.lineTo(e-t,s+i),!0}var zk=class extends Yt{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,s){return uL(t,this.parseSize(e)/4,i,s)}drawOffset(t,e,i,s,n){return uL(t,this.parseSize(e)/4+n,i,s)}},pL=new zk;function mL(r,t,e,i){let s=2*t;return r.moveTo(e-s,i+t),r.lineTo(e,i-t),r.lineTo(e+s,i+t),!0}var Gk=class extends Yt{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,s){return mL(t,this.parseSize(e)/4,i,s)}drawOffset(t,e,i,s,n){return mL(t,this.parseSize(e)/4+n,i,s)}},gL=new Gk;function fL(r,t,e,i){let s=2*t;return r.moveTo(e-s,i-t),r.lineTo(e,i+t),r.lineTo(e+s,i-t),!0}var Uk=class extends Yt{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,s){return fL(t,this.parseSize(e)/4,i,s)}drawOffset(t,e,i,s,n){return fL(t,this.parseSize(e)/4+n,i,s)}},_L=new Uk;function vL(r,t,e,i,s){return r.moveTo(e,i-t),r.lineTo(e,i+t),!0}var Wk=class extends Yt{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,s,n){return vL(t,this.parseSize(e)/2,i,s,n)}drawOffset(t,e,i,s,n,o){return vL(t,this.parseSize(e)/2+n,i,s,o)}drawToSvgPath(t,e,i,s){let n=this.parseSize(t)/2;return`M ${e}, ${i-n} L ${e},${i+n}`}},yL=new Wk;function xL(r,t,e,i,s){return r.moveTo(e-t,i),r.lineTo(e+t,i),!0}var Yk=class extends Yt{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,s,n){return xL(t,this.parseSize(e)/2,i,s,n)}drawOffset(t,e,i,s,n,o){return xL(t,this.parseSize(e)/2+n,i,s,o)}drawToSvgPath(t,e,i,s){let n=this.parseSize(t)/2;return`M ${e-n}, ${i} L ${e+n},${i}`}},bL=new Yk;function SL(r,t,e,i,s){return r.moveTo(e-t,i-t),r.lineTo(e+t,i+t),r.moveTo(e+t,i-t),r.lineTo(e-t,i+t),!0}var Xk=class extends Yt{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,s,n){return SL(t,this.parseSize(e)/2,i,s,n)}drawOffset(t,e,i,s,n,o){return SL(t,this.parseSize(e)/2+n,i,s,o)}drawToSvgPath(t,e,i,s){let n=this.parseSize(t)/2;return`M ${e-n}, ${i-n} L ${e+n},${i+n} M ${e+n}, ${i-n} L ${e-n},${i+n}`}},AL=new Xk;function CL(r,t,e,i){return r.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function TL(r,t,e,i){let s=t,n=t/2;return r.rect(e-s/2,i-n/2,s,n),!1}var Kk=class extends Yt{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,s){return J(e)?TL(t,e,i,s):CL(t,e,i,s)}drawWithClipRange(t,e,i,s,n,o,a){J(e)&&(e=[e,e/2]);let l=2*(e[0]+e[1])*n,h=[{x:i+e[0]/2,y:s-e[1]/2},{x:i+e[0]/2,y:s+e[1]/2},{x:i-e[0]/2,y:s+e[1]/2},{x:i-e[0]/2,y:s-e[1]/2}],d=0,c=h[3];t.moveTo(c.x,c.y);for(let u=0;u<h.length;u++){let p=h[u],m=Math.sqrt((p.x-c.x)*(p.x-c.x)+(p.y-c.y)*(p.y-c.y));if(d+m>l){let g=(p.x-c.x)*(l-d)/m,f=(p.y-c.y)*(l-d)/m;t.lineTo(c.x+g,c.y+f);break}t.lineTo(p.x,p.y),c=p,d+=m}return!1}drawOffset(t,e,i,s,n){return J(e)?TL(t,e+2*n,i,s):CL(t,[e[0]+2*n,e[1]+2*n],i,s)}},kL=new Kk;var Lg=new ie,Ig=class{constructor(t,e,i=!1){this.pathStr="",this.type=t,H(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,s,n,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{t.beginPath(),Lr(l.path.commandList,t,i,s,e,e),a&&a(l.path,l.attribute)}),!1):(Lr(this.path.commandList,t,i,s,e+n,e+n),!1)}draw(t,e,i,s,n,o){return e=this.parseSize(e),this.drawOffset(t,e,i,s,0,n,o)}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,s,n,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{l.path.drawWithClipRange(t,e,i,s,n),a&&a(l.path,l.attribute)}),!1):(this.path.drawWithClipRange(t,e,i,s,n),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach(({path:i})=>{Lg.x1=i.bounds.x1*t,Lg.y1=i.bounds.y1*t,Lg.x2=i.bounds.x2*t,Lg.y2=i.bounds.y2*t,e.union(Lg)})):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}};var mY=[OB,HB,NB,jB,hL,UB,XB,$B,ZB,QB,eL,rL,nL,GB,aL,cL,pL,gL,_L,kL,yL,bL,AL],$k={};mY.forEach(r=>{$k[r.type]=r});var ML={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};var gY=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",h_t=gY+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040";function DL(r,t){let e=[],i=t.exec(r);for(;i;){let s=[];s.startIndex=t.lastIndex-i[0].length;let n=i.length;for(let o=0;o<n;o++)s.push(i[o]);e.push(s),i=t.exec(r)}return e}var Fg=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};function EL(r,t,e,i){let s=r.indexOf(t,e);if(s===-1)throw new Error(i);return s+t.length-1}function fY(r,t,e=">"){let i,s="";for(let n=t;n<r.length;n++){let o=r[n];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0]){if(!e[1])return{data:s,index:n};if(r[n+1]===e[1])return{data:s,index:n}}else o==="	"&&(o=" ");s+=o}}function wL(r,t,e,i=">"){let s=fY(r,t+1,i);if(!s)return;let n=s.data,o=s.index,a=n.search(/\s/),l=n,h=!0;a!==-1&&(l=n.substr(0,a).replace(/\s\s*$/,""),n=n.substr(a+1));let d=l;if(e){let c=l.indexOf(":");c!==-1&&(l=l.substr(c+1),h=l!==s.data.substr(c+1))}return{tagName:l,tagExp:n,closeIndex:o,attrExpPresent:h,rawTagName:d}}var _Y=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm"),dx=class{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){let s=e.tagname;typeof s=="string"&&(e.tagname=s),t.addChild(e)}buildAttributesMap(t,e,i){let s={};if(!t)return;let n=DL(t,_Y),o=n.length;for(let a=0;a<o;a++){let l=n[a][1],h=n[a][4],d=l;l&&(s[d]=h===void 0||(isNaN(h)?h:Number(h)))}return s}parseXml(t){t=t.replace(/\r\n?/g,`
`);let e=new Fg("!xml"),i=e,s="",n="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){let a=EL(t,">",o,"Closing Tag is not closed."),l=n.lastIndexOf(".");n=n.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&s&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=s),s="",o=a}else if(t[o+1]==="?")o=wL(t,o,!1,"?>").closeIndex+1;else if(t.substr(o+1,3)==="!--")o=EL(t,"-->",o+4,"Comment is not closed.");else{let a=wL(t,o,!1),l=a.tagName,h=a.tagExp,d=a.attrExpPresent,c=a.closeIndex;if(l!==e.tagname&&(n+=n?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),n=n.substr(0,n.length-1),h=l):h=h.substr(0,h.length-1);let u=new Fg(l);l!==h&&d&&(u[":@"]=this.buildAttributesMap(h,n,l)),this.addChild(i,u,n),n=n.substr(0,n.lastIndexOf("."))}else{let u=new Fg(l);this.tagsNodeStack.push(i),l!==h&&d&&(u[":@"]=this.buildAttributesMap(h,n,l)),this.addChild(i,u,n),i=u}s="",o=c}else s+=t[o];return e.child}};function PL(r,t){return RL(r)}function RL(r,t){let e={};for(let i=0;i<r.length;i++){let s=r[i],n=vY(s),o="";if(o=t===void 0?n:t+"."+n,n!==void 0&&s[n]){let a=RL(s[n],o);xY(a),s[":@"]&&yY(a,s[":@"],o),e[n]!==void 0&&e.hasOwnProperty(n)?(Array.isArray(e[n])||(e[n]=[e[n]]),e[n].push(a)):e[n]=a}}return e}function vY(r){let t=Object.keys(r);for(let e=0;e<t.length;e++){let i=t[e];if(i!==":@")return i}}function yY(r,t,e){if(t){let i=Object.keys(t),s=i.length;for(let n=0;n<s;n++){let o=i[n];r[o]=t[o]}}}function xY(r){return Object.keys(r).length===0}var Lc=class r{constructor(t){this.options=Object.assign({},r.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;let e=new dx(this.options).parseXml(t);return PL(e,this.options)}};Lc.defaultOptions={};function BL(r){return r.startsWith("<svg")||r.startsWith("<?xml")}var bY=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};function LL(r){return bY(this,void 0,void 0,function*(){let t=[],e=r.getChildren();yield new Promise(i=>{j.global.getRequestAnimationFrame()(()=>{i(null)})}),e.forEach(i=>{i.subLayers.size&&i.subLayers.forEach(s=>{s.drawContribution&&s.drawContribution.hooks&&s.drawContribution.rendering&&t.push(new Promise(n=>{s.drawContribution.hooks.completeDraw.tap("outWait",()=>{s.drawContribution.hooks.completeDraw.taps=s.drawContribution.hooks.completeDraw.taps.filter(o=>o.name!=="outWait"),n(null)})}))})}),yield Promise.all(t)})}function Oh(r,t,e,i=0){return r.expand(t+(i/2+(e?SY(e,t):0))),r}function SY(r,t){return r?t:0}var AY=0;function dr(){return AY++}var Fh;(function(r){r[r.HORIZONTAL=0]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})(Fh||(Fh={}));function IL(r){let t=[],e=0,i="";for(let s=0;s<r.length;s++)kY(r[s])?e?i+=r[s]:(e=1,i=r[s]):(e&&(t.push({text:i,direction:Fh.VERTICAL}),i="",e=0),t.push({text:r[s],direction:Fh.HORIZONTAL}));return i&&t.push({text:i,direction:Fh.VERTICAL}),t}var CY=["\u2026","\uFF08","\uFF09","\u2014","\u3010","\u3011","\u300C","\u300D","\u300A","\u300B"],FL=new Map;CY.forEach(r=>FL.set(r,!0));var TY=[""],OL=new Map;function kY(r){if(FL.has(r))return!0;if(OL.has(r))return!1;let t=!1;return r.codePointAt(0)<256&&(t=!0),t}TY.forEach(r=>OL.set(r,!0));var tl=dr(),Ic=dr(),ho=dr(),el=dr(),Fc=dr(),Oc=dr(),il=dr(),co=dr(),rl=dr(),sl=dr(),cx=dr(),Hc=dr(),ux=dr(),Nc=dr(),nl=dr(),ol=dr(),px=Symbol.for("GraphicService"),mx=Symbol.for("GraphicCreator"),MY={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity"},T_t=Object.keys(MY),qk={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},HL=Object.keys(qk);var gx=new ie,DY=new Kt,NL=new ie;var ci=["lineWidth","scaleX","scaleY","angle","anchor","visible"],VL=["x","y"],jL=["scaleX","scaleY"],zL=["angle"],Og=new Xt,Be={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1},Ve=class r extends Jy{static mixin(t){let e=Object.keys(t);for(let i=0;i<e.length;++i){let s=e[i];Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new ie,this._updateTag=De.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,s;let{dx:n=t.dx,dy:o=t.dy}=this.attribute;if(e&&this.parent){let a=this.parent.attribute;Og.x=n+((i=a.scrollX)!==null&&i!==void 0?i:0),Og.y=o+((s=a.scrollY)!==null&&s!==void 0?s:0)}else Og.x=n,Og.y=o;return Og}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){let t=this.attribute.boundsMode==="imprecise";if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;j.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);let e=this.doUpdateAABBBounds(t);return j.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode==="empty"&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new Kv),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){let e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){let{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);let{shape:e}=t,i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=$k[t];if(e||(e=r.userSymbolMap[t],e))return e;let i=ML[t];if(BL(t=i||t)===!0){let h=new Lc,{svg:d}=h.parse(t);if(!d)return null;let c=H(d.path)?d.path:[d.path];gx.clear();let u=[];c.forEach(_=>{let v=new ne().fromString(_.d),x={};HL.forEach(y=>{_[y]&&(x[qk[y]]=_[y])}),u.push({path:v,attribute:x}),gx.union(v.bounds)});let p=gx.width(),m=gx.height(),g=1/ri(p,m);u.forEach(_=>_.path.transform(0,0,g,g));let f=new Ig(t,u,!0);return r.userSymbolMap[t]=f,f}let s=new ne().fromString(t),n=s.bounds.width(),o=s.bounds.height(),a=1/ri(n,o);s.transform(0,0,a,a);let l=new Ig(t,s);return r.userSymbolMap[t]=l,l}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;let e=this.getGraphicTheme();this._AABBBounds.clear();let i=this.attribute,s=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:n=e.boundsPadding}=i,o=Eg(n);return o&&s.expand(o),this.clearUpdateBoundTag(),s}updatePathProxyAABBBounds(t){let e=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;let i=new Ua(t);return Lr(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){let t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){let e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new Kt),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&De.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&j.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&De.UPDATE_BOUNDS)&&j.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&De.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&De.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&De.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;let i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&De.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=De.CLEAR_SHAPE}containsPoint(t,e,i,s){if(!s)return!1;if(i===io.GLOBAL){let n=new Xt(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(n,n),t=n.x,e=n.y}return s.containsPoint(this,{x:t,y:e})}setAttributes(t,e=!1,i){(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t,e=!1,i){let s=Object.keys(t);for(let n=0;n<s.length;n++){let o=s[n];this.attribute[o]=t[o]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(s)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,s){var n;let o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,s);o?this._setAttributes(o,i,s):T((n=this.normalAttrs)===null||n===void 0?void 0:n[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s)):this.normalAttrs[t]=e,t==="background"?this.loadImage(e,!0):t==="shadowGraphic"&&this.setShadowGraphic(e)}needUpdateTags(t,e=ci){for(let i=0;i<e.length;i++){let s=e[i];if(t.indexOf(s)!==-1)return!0}return!1}needUpdateTag(t,e=ci){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){let e={type:fi.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=De.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,s;if(t===0&&e===0)return this;let n={type:fi.TRANSLATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,VL,n);o&&(t=o.x,e=o.y,delete o.x,delete o.y,this._setAttributes(o));let a=this.attribute,l=a.postMatrix;return l?j.transformUtil.fromMatrix(l,l).translate(t,e):(a.x=((i=a.x)!==null&&i!==void 0?i:Pi.x)+t,a.y=((s=a.y)!==null&&s!==void 0?s:Pi.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}translateTo(t,e){let i=this.attribute;if(i.x===t&&i.y===e)return this;let s={type:fi.TRANSLATE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,VL,s);return n?(this._setAttributes(n,!1,s),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this)}scale(t,e,i){var s,n;if(t===1&&e===1)return this;let o={type:fi.SCALE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,jL,o);a&&(t=a.scaleX,e=a.scaleY,delete a.scaleX,delete a.scaleY,this._setAttributes(a));let l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new Kt,l.postMatrix=h),j.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((s=l.scaleX)!==null&&s!==void 0?s:Pi.scaleX)*t,l.scaleY=((n=l.scaleY)!==null&&n!==void 0?n:Pi.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}scaleTo(t,e){let i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;let s={type:fi.SCALE_TO},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,jL,s);return n?(this._setAttributes(n,!1,s),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this)}rotate(t,e){var i;if(t===0)return this;let s={type:fi.ROTATE},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,zL,s);n&&(delete n.angle,this._setAttributes(n,!1,s));let o=this.attribute;if(e){let{postMatrix:a}=this.attribute;a||(a=new Kt,o.postMatrix=a),j.transformUtil.fromMatrix(a,a).rotate(t,e)}else o.angle=((i=o.angle)!==null&&i!==void 0?i:Pi.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}rotateTo(t){let e=this.attribute;if(e.angle===t)return this;let i={type:fi.ROTATE_TO},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,zL,i);return s?(this._setAttributes(s,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){var e;this.animates||(this.animates=new Map);let i=new wc(t?.id,(e=t?.timeline)!==null&&e!==void 0?e:this.stage&&this.stage.getTimeline(),t?.slience);if(i.bind(this),t){let{onStart:s,onFrame:n,onEnd:o,onRemove:a}=t;s!=null&&i.onStart(s),n!=null&&i.onFrame(n),o!=null&&i.onEnd(o),a!=null&&i.onRemove(a),i.interpolateFunc=t.interpolate}return this.animates.set(i.id,i),i.onRemove(()=>{i.stop(),this.animates.delete(i.id)}),i}onAttributeUpdate(t){t&&t.skipUpdateCallback||(j.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!T(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,s){var n,o,a,l;if(i){let h=Object.keys(t),d=this.getNoWorkAnimateAttr(),c={},u;h.forEach(m=>{d[m]?(u||(u={}),u[m]=t[m]):c[m]=s&&t[m]===void 0?this.getDefaultAttribute(m):t[m]});let p=this.animate({slience:!0});p.stateNames=e,p.to(c,(o=(n=this.stateAnimateConfig)===null||n===void 0?void 0:n.duration)!==null&&o!==void 0?o:xk.duration,(l=(a=this.stateAnimateConfig)===null||a===void 0?void 0:a.easing)!==null&&l!==void 0?l:xk.easing),u&&this.setAttributes(u,!1,{type:fi.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:fi.STATE})}updateNormalAttrs(t){let e={};this.normalAttrs?(Object.keys(t).forEach(i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{t[i]=this.normalAttrs[i]})):Object.keys(t).forEach(i=>{e[i]=this.getNormalAttribute(i)}),this.normalAttrs=e}stopStateAnimates(t="end"){this.animates&&this.animates.forEach(e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))})}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){let s=i.getEndProps();zn(s,t)&&(e=s[t])}}),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){let i=H(t)?n=>!t.includes(n):n=>n!==t,s=this.currentStates.filter(i);s.length!==this.currentStates.length&&this.useStates(s,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){let i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var s;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;let n=e&&(!((s=this.currentStates)===null||s===void 0)&&s.length)?this.currentStates.concat([t]):[t];this.useStates(n,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((n,o)=>this.currentStates[o]!==n)))return;let s={};t.forEach(n=>{var o;let a=this.stateProxy?this.stateProxy(n,t):(o=this.states)===null||o===void 0?void 0:o[n];a&&Object.assign(s,a)}),this.updateNormalAttrs(s),this.currentStates=t,this.applyStateAttrs(s,t,e)}addUpdateBoundTag(){this._updateTag|=De.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=De.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=De.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&De.UPDATE_SHAPE_AND_BOUNDS)===De.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=De.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=De.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=De.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=De.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=De.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=De.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=De.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&De.UPDATE_LAYOUT)}getAnchor(t,e){let i=[0,0],s=()=>{if(e.b)return e.b;let{scaleX:n,scaleY:o,angle:a}=this.attribute;return NL.copy(this._AABBBounds),this.setAttributes({scaleX:1,scaleY:1,angle:0}),e.b=this.AABBBounds.clone(),this._AABBBounds.copy(NL),this.setAttributes({scaleX:n,scaleY:o,angle:a}),e.b};if(typeof t[0]=="string"){let n=parseFloat(t[0])/100,o=s();i[0]=o.x1+(o.x2-o.x1)*n}else i[0]=t[0];if(typeof t[1]=="string"){let n=parseFloat(t[1])/100,o=s();i[1]=o.y1+(o.y2-o.y1)*n}else i[1]=t[1];return i}doUpdateLocalMatrix(){let{x:t=Pi.x,y:e=Pi.y,scaleX:i=Pi.scaleX,scaleY:s=Pi.scaleY,angle:n=Pi.angle,scaleCenter:o,anchor:a,postMatrix:l}=this.attribute,h=[0,0],d={};if(a&&(h=this.getAnchor(a,d)),!o||i===1&&s===1)FP(this._transMatrix,this._transMatrix.reset(),t,e,i,s,n,a&&h);else{let u=this._transMatrix;u.reset(),u.translate(h[0],h[1]),u.rotate(n),u.translate(-h[0],-h[1]),u.translate(t,e),h=this.getAnchor(o,d),j.transformUtil.fromMatrix(u,u).scale(i,s,{x:h[0],y:h[1]})}let c=this.getOffsetXY(Pi);if(this._transMatrix.e+=c.x,this._transMatrix.f+=c.y,l){let u=DY.setValue(l.a,l.b,l.c,l.d,l.e,l.f),p=this._transMatrix;u.multiply(p.a,p.b,p.c,p.d,p.e,p.f),p.setValue(u.a,u.b,u.c,u.d,u.e,u.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);let{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){let i=t.getTimeline();this.animates.forEach(s=>{s.timeline===Lh&&s.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,t,e),j.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:fi.ANIMATE_END})}onStep(t,e,i,s,n){let o={};if(i.customAnimate)i.customAnimate.update(n,s,o);else{let a=i.props,l=i.parsedProps,h=i.propKeys;this.stepInterpolate(t,e,o,i,s,n,a,void 0,l,h)}this.setAttributes(o,!1,{type:fi.ANIMATE_UPDATE,animationState:{ratio:s,end:n,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,s,n,o,a,l,h,d){d||(d=Object.keys(a),s.propKeys=d),o?s.propKeys.forEach(c=>{e.validAttr(c)&&(i[c]=a[c])}):d.forEach(c=>{var u;if(!e.validAttr(c))return;let p=a[c],m=(u=l&&l[c])!==null&&u!==void 0?u:t.getLastPropByName(c,s);if(p==null||m==null||p===m)return void(i[c]=p);let g;g=e.interpolateFunc&&e.interpolateFunc(c,n,m,p,i),g||(g=e.customInterpolate(c,n,m,p,this,i),g||this.defaultInterpolate(p,m,c,i,h,n)||this._interpolate(c,n,m,p,i))}),s.parsedProps=h}defaultInterpolate(t,e,i,s,n,o){if(Number.isFinite(t)&&Number.isFinite(e))return s[i]=e+(t-e)*o,!0;if(i==="fill"){n||(n={});let a=n.fillColorArray,l=$o(e,a??t,o,!1,(h,d)=>{n.fillColorArray=d});return l&&(s[i]=l),!0}if(i==="stroke"){n||(n={});let a=n.strokeColorArray,l=$o(e,a??t,o,!1,(h,d)=>{n.strokeColorArray=d});return l&&(s[i]=l),!0}if(i==="shadowColor"){n||(n={});let a=n.shadowColorArray,l=$o(e,a??t,o,!0,(h,d)=>{n.shadowColorArray=d});return l&&(s[i]=l),!0}if(Array.isArray(t)&&t.length===e.length){let a=[],l=!0;for(let h=0;h<t.length;h++){let d=e[h],c=d+(t[h]-d)*o;if(!Number.isFinite(c)){l=!1;break}a.push(c)}l&&(s[i]=a)}return!1}_interpolate(t,e,i,s,n){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t??j.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(t=>t.toJson())}}createPathProxy(t){return Z(t,!0)?this.pathProxy=new ne().fromString(t):this.pathProxy=new ne,this.pathProxy}loadImage(t,e=!1){if(!t||e&&EY(t))return;let i=t;this.resources||(this.resources=new Map);let s={data:"init",state:null};this.resources.set(i,s),typeof t=="string"?(s.state="loading",t.startsWith("<svg")?(mn.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(wC(t)||t.includes("/")||PC(t))&&(mn.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):ct(t)?(s.state="success",s.data=t,this.backgroundImg=this.backgroundImg||e):s.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;let s=this.resources.get(t);s&&(s.state="success",s.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;let i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach(e=>{e.stop()})}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren(e=>{e.stopAnimates(t)})}release(){this.releaseStatus="released",this.stopAnimates(),j.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,s;if(this._events&&t in this._events){let n=new ao(t,e);n.bubbles=!1,n.manager=(s=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||s===void 0?void 0:s.manager,this.dispatchEvent(n)}}};function EY(r){return!(!r.fill&&!r.stroke)}Ve.userSymbolMap={},Ve.mixin(wB);var GL;(function(r){r[r.LESS_GROUP=0]="LESS_GROUP",r[r.MORE_GROUP=1]="MORE_GROUP"})(GL||(GL={}));var Vs=class r extends Ve{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=Oc,this._childUpdateTag=De.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new no),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new no)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren(e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===io.GLOBAL){let s=new Xt(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(s,s),this.AABBBounds.contains(s.x,s.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&De.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;j.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);let t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),j.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),this.attribute.boundsMode==="empty"&&e.clear(),e}doUpdateLocalMatrix(){let{x:t=Pi.x,y:e=Pi.y,dx:i=Pi.dx,dy:s=Pi.dy,scaleX:n=Pi.scaleX,scaleY:o=Pi.scaleY,angle:a=Pi.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||s!==0||n!==1||o!==1||a!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return dt(this).group}updateAABBBounds(t,e,i){let s=i;i=i.clone();let{width:n,height:o,path:a,clip:l=e.clip}=t;if(a&&a.length?a.forEach(h=>{i.union(h.AABBBounds)}):n!=null&&o!=null&&i.set(0,0,Math.max(0,n),Math.max(0,o)),!l){this.forEachChildren(c=>{i.union(c.AABBBounds)});let{scrollX:h=0,scrollY:d=0}=t;i.translate(h,d)}return j.graphicService.updateTempAABBBounds(i),j.graphicService.transformAABBBounds(t,i,e,!1,this),s.copy(i),s}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;let t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=De.CLEAR_BOUNDS,this._childUpdateTag&=De.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=De.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&De.UPDATE_BOUNDS||(this._childUpdateTag|=De.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){let e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),j.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),j.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t,e=!0){let i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){let e=super.removeChild(t);return t.stage=null,j.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren(e=>{j.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),j.graphicService.onSetStage(this,t),this.forEachChildren(i=>{i.setStage(t,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){let e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&De.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find(i=>i.name===t,e)}createOrUpdateChild(t,e,i){let s=this._getChildByName(t);return s?s.setAttributes(e):(s=j.graphicService.creator[i](e),s.name=t,this.add(s)),s}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren(e=>{e.release(t)}),super.release()}};Vs.NOWORK_ANIMATE_ATTR=Be;function qo(r){return new Vs(r)}var fx=class extends Vs{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("\u6682\u4E0D\u652F\u6301")}get dpr(){return this._dpr}constructor(t,e,i,s){var n;super({}),this.stage=t,this.global=e,this.window=i,this.main=s.main,this.layerHandler=s.layerHandler,this.layerHandler.init(this,i,{main:s.main,canvasId:s.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(n=s.zIndex)!==null&&n!==void 0?n:0}),this.layer=this,this.subLayers=new Map,this.theme=new no,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){let e=Array.from(this.subLayers.values()).sort((i,s)=>i.zIndex-s.zIndex);this.layerHandler.merge(e.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler()))),t&&e.forEach(i=>{i.group&&(i.group.incremental=0)}),e.forEach(i=>{j.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)})}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach(s=>s(this)),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setToFrame(t){throw new Error("\u6682\u4E0D\u652F\u6301")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(t=>{j.layerService.releaseLayer(this.stage,t.layer)})}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(s=>s(this))}};var _x=Symbol.for("TransformUtil"),vx=Symbol.for("GraphicUtil"),Vc=Symbol.for("LayerService"),yx=Symbol.for("StaticLayerHandlerContribution"),UL=Symbol.for("DynamicLayerHandlerContribution"),WL=Symbol.for("VirtualLayerHandlerContribution");var Hg,wY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},PY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},jc=Hg=class{static GenerateLayerId(){return`${Hg.idprefix}_${Hg.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=j.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(r){return this.layerMap.get(r)}getRecommendedLayerType(r){return r||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(r){let t;return t=r==="static"?yt.get(yx):r==="dynamic"?yt.get(UL):yt.get(WL),t}createLayer(r,t={main:!1}){var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;let s=this.getLayerHandler(i),n=new fx(r,this.global,r.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:Hg.GenerateLayerId(),layerHandler:s})),o=this.layerMap.get(r)||[];return o.push(n),this.layerMap.set(r,o),this.staticLayerCountInEnv--,n}prepareStageLayer(r){let t;r.forEachChildren(e=>{let i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])})}releaseLayer(r,t){t.release();let e=this.layerMap.get(r)||[];this.layerMap.set(r,e.filter(i=>i!==t))}layerCount(r){return(this.layerMap.get(r)||[]).length}restLayerCount(r){return this.global.env==="browser"?10:0}releaseStage(r){this.layerMap.delete(r)}};jc.idprefix="visactor_layer",jc.prefix_count=0,jc=Hg=wY([q(),PY("design:paramtypes",[])],jc);var YL=new tt(r=>{r(Ga).to(Ry).inSingletonScope(),r(Rh).to(Ky),r(vx).to($y).inSingletonScope(),r(_x).to(qy).inSingletonScope(),r(Vc).to(jc).inSingletonScope()});function gs(r,t){return!(!r&&!t)}function gn(r,t){let e;return e=H(r)?r.some(i=>i||i===void 0):!!r,e&&t>0}function js(r,t,e){return e&&r*t>0}function zc(r,t,e,i,s){return s&&r*t>0&&e!==0&&i!==0}function Ng(r,t){return r*t>0}function Gc(r,t,e,i){return r*t>0&&e!==0&&i!==0}function RY(r,t,e,i,s,n,o,a){let l=e-r,h=i-t,d=o-s,c=a-n,u=c*l-d*h;return u*u<1e-12?[]:(u=(d*(t-n)-c*(r-s))/u,[r+u*l,t+u*h])}function Zo(r,t,e,i,s,n,o){let a=r-e,l=t-i,h=(o?n:-n)/Math.sqrt(a*a+l*l),d=h*l,c=-h*a,u=r+d,p=t+c,m=e+d,g=i+c,f=(u+m)/2,_=(p+g)/2,v=m-u,x=g-p,y=v*v+x*x,b=s-n,S=u*g-m*p,C=(x<0?-1:1)*Math.sqrt(Math.max(0,b*b*y-S*S)),k=(S*x-v*C)/y,M=(-S*v-x*C)/y,E=(S*x+v*C)/y,D=(-S*v+x*C)/y,P=k-f,B=M-_,L=E-f,w=D-_;return P*P+B*B>L*L+w*w&&(k=E,M=D),{cx:k,cy:M,x01:-d,y01:-c,x11:k*(s/b-1),y11:M*(s/b-1)}}function Zk(r,t,e,i,s){let n=Dt(e-t),o=r.getParsedCornerRadius(),a=H(o),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:d,outerEndAngle:c,innerEndAngle:u,innerStartAngle:p}=r.getParsePadAngle(t,e),m=a?o[0]:o,g=a?o[1]:o,f=a?o[2]:o,_=a?o[3]:o,v=Math.max(g,m),x=Math.max(f,_),y=v,b=x,S=s*Ce(d),C=s*ce(d),k=i*Ce(u),M=i*ce(u),E,D,P,B;if((x>1e-12||v>1e-12)&&(E=s*Ce(c),D=s*ce(c),P=i*Ce(p),B=i*ce(p),n<ge)){let L=RY(S,C,P,B,E,D,k,M);if(L){let w=S-L[0],R=C-L[1],N=E-L[0],z=D-L[1],Y=1/ce(SP((w*N+R*z)/(ar(w*w+R*R)*ar(N*N+z*z)))/2),U=ar(L[0]*L[0]+L[1]*L[1]);b=Ge(x,(i-U)/(Y-1)),y=Ge(v,(s-U)/(Y+1))}}return{outerDeltaAngle:l,xors:S,yors:C,xirs:P,yirs:B,xore:E,yore:D,xire:k,yire:M,limitedOcr:y,limitedIcr:b,outerCornerRadiusStart:m,outerCornerRadiusEnd:g,maxOuterCornerRadius:v,maxInnerCornerRadius:x,outerStartAngle:d,outerEndAngle:c,innerDeltaAngle:h,innerEndAngle:u,innerStartAngle:p,innerCornerRadiusStart:_,innerCornerRadiusEnd:f}}function Vg(r,t,e,i,s,n,o){let{startAngle:a,endAngle:l}=r.getParsedAngle(),h=Dt(l-a),d=l>a,c=!1;if(s<n){let u=s;s=n,n=u}if(s<=1e-12)t.moveTo(e,i);else if(h>=vt-1e-12)t.moveTo(e+s*Ce(a),i+s*ce(a)),t.arc(e,i,s,a,l,!d),n>1e-12&&(t.moveTo(e+n*Ce(l),i+n*ce(l)),t.arc(e,i,n,l,a,d));else{let{outerDeltaAngle:u,xors:p,yors:m,xirs:g,yirs:f,limitedOcr:_,outerCornerRadiusStart:v,outerCornerRadiusEnd:x,maxOuterCornerRadius:y,xore:b,yore:S,xire:C,yire:k,outerStartAngle:M,outerEndAngle:E,limitedIcr:D,innerDeltaAngle:P,innerEndAngle:B,innerStartAngle:L,innerCornerRadiusStart:w,innerCornerRadiusEnd:R,maxInnerCornerRadius:N}=Zk(r,a,l,n,s);if(u<.001)o&&(o[3]||o[1])&&t.moveTo(e+p,i+m),c=!0;else if(_>1e-12){let z=Ge(v,_),Y=Ge(x,_),U=Zo(g,f,p,m,s,z,Number(d)),$=Zo(b,S,C,k,s,Y,Number(d));_<y&&z===Y?!o||o[0]?(t.moveTo(e+U.cx+U.x01,i+U.cy+U.y01),t.arc(e+U.cx,i+U.cy,_,ae(U.y01,U.x01),ae($.y01,$.x01),!d)):t.moveTo(e+U.cx+_*Ce(ae($.y01,$.x01)),i+U.cy+_*ce(ae($.y01,$.x01))):!o||o[0]?(t.moveTo(e+U.cx+U.x01,i+U.cy+U.y01),z>0&&t.arc(e+U.cx,i+U.cy,z,ae(U.y01,U.x01),ae(U.y11,U.x11),!d),t.arc(e,i,s,ae(U.cy+U.y11,U.cx+U.x11),ae($.cy+$.y11,$.cx+$.x11),!d),Y>0&&t.arc(e+$.cx,i+$.cy,Y,ae($.y11,$.x11),ae($.y01,$.x01),!d)):Y>0?t.moveTo(e+$.cx+Y*Ce(ae($.y01,$.x01)),i+$.cy+Y*ce(ae($.y01,$.x01))):t.moveTo(e+b,i+s*ce(E))}else!o||o[0]?(t.moveTo(e+p,i+m),t.arc(e,i,s,M,E,!d)):t.moveTo(e+s*Ce(E),i+s*ce(E));if(!(n>1e-12)||P<.001)!o||o[1]?t.lineTo(e+C,i+k):t.moveTo(e+C,i+k),c=!0;else if(D>1e-12){let z=Ge(w,D),Y=Ge(R,D),U=Zo(C,k,b,S,n,-Y,Number(d)),$=Zo(p,m,g,f,n,-z,Number(d));if(!o||o[1]?t.lineTo(e+U.cx+U.x01,i+U.cy+U.y01):t.moveTo(e+U.cx+U.x01,i+U.cy+U.y01),D<N&&z===Y){let ut=ae($.y01,$.x01);!o||o[2]?t.arc(e+U.cx,i+U.cy,D,ae(U.y01,U.x01),ut,!d):t.moveTo(e+U.cx+Ce(ut),i+U.cy+ce(ut))}else!o||o[2]?(Y>0&&t.arc(e+U.cx,i+U.cy,Y,ae(U.y01,U.x01),ae(U.y11,U.x11),!d),t.arc(e,i,n,ae(U.cy+U.y11,U.cx+U.x11),ae($.cy+$.y11,$.cx+$.x11),d),z>0&&t.arc(e+$.cx,i+$.cy,z,ae($.y11,$.x11),ae($.y01,$.x01),!d)):z>0?t.moveTo(e+$.cx+z*Ce(ae($.y01,$.x01)),i+$.cy+z*ce(ae($.y01,$.x01))):t.moveTo(e+g,i+f)}else!o||o[1]?t.lineTo(e+C,i+k):t.moveTo(e+C,i+k),!o||o[2]?t.arc(e,i,n,B,L,d):t.moveTo(e+n*Ce(L),i+n*ce(L))}return o?o[3]&&t.lineTo(e+s*Ce(a),i+s*ce(a)):t.closePath(),c}var Uc=class r{static GetCanvas(){try{return r.canvas||(r.canvas=j.global.createCanvas({})),r.canvas}catch{return null}}static GetCtx(){if(!r.ctx){let t=r.GetCanvas();r.ctx=t.getContext("2d")}return r.ctx}},Jk=class r extends $v{static getInstance(){return r._instance||(r._instance=new r),r._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;let i=Uc.GetCanvas(),s=Uc.GetCtx();if(i.width=e,i.height=1,!s)return;if(s.translate(0,0),!s)throw new Error("\u83B7\u53D6ctx\u53D1\u751F\u9519\u8BEF");let n=s.createLinearGradient(0,0,e,0);t.forEach(o=>{n.addColorStop(o[0],o[1])}),s.fillStyle=n,s.fillRect(0,0,e,1),this.rgbaSet=s.getImageData(0,0,e,1).data}getColor(t){let e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,s,n=[],o=100){let a=`${t}${e}${i}${s}`;n.forEach(h=>a+=h.join()),a+=o;let l=this.dataMap.get(a);return l||(l={data:new r(n,o),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(a,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}},al=class r{static GetSize(t){for(let e=0;e<r.ImageSize.length;e++)if(r.ImageSize[e]>=t)return r.ImageSize[e];return t}static Get(t,e,i,s,n,o,a){let l=r.GenKey(t,e,i,s,n),h=r.cache[l];if(!h||h.length===0)return null;for(let d=0;d<h.length;d++)if(h[d].width>=o&&h[d].height>=a)return h[d].pattern;return null}static Set(t,e,i,s,n,o,a,l){let h=r.GenKey(t,e,i,s,n);r.cache[h]?r.cache[h].push({width:a,height:l,pattern:o}):r.cache[h]=[{width:a,height:l,pattern:o}]}static GenKey(t,e,i,s,n){return`${e},${i},${s},${n},${t.join()}`}};al.cache={},al.ImageSize=[20,40,80,160,320,640,1280,2560];function XL(r,t,e,i){let{stops:s,startAngle:n,endAngle:o}=i;for(;e<0;)e+=vt;for(;e>vt;)e-=vt;if(e<n||e>o)return s[0].color;let a,l,h=(e-n)/(o-n);for(let d=0;d<s.length;d++)if(s[d].offset>=h){a=s[d-1],l=s[d];break}return h=(h-a.offset)/(l.offset-a.offset),$o(a.color,l.color,h,!1)}function KL(r,t,e,i,s,n,o,a,l){let h=Math.floor(180*s/Math.PI),d=Uc.GetCanvas(),c=Uc.GetCtx();if(!c)return null;let u=al.GetSize(a),p=al.GetSize(l),m=al.Get(t,e,i,n,o,u,p);if(m)return m;let g=Math.sqrt(Math.max(Math.max(Math.pow(e,2)+Math.pow(i,2),Math.pow(u-e,2)+Math.pow(i,2)),Math.max(Math.pow(u-e,2)+Math.pow(p-i,2),Math.pow(e,2)+Math.pow(p-i,2)))),f=h+1,_=s/Math.max(1,f-1),v=Jk.getInstance().GetOrCreate(e,i,u,p,t,f),x=2*Math.PI*g/360;d.width=u,d.height=p,c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,u,p),c.translate(e,i),c.rotate(n);for(let b=0,S=f-1;b<S&&!(n+b*_>o);b++){let C=v.getColor(b);c.beginPath(),c.rotate(_),c.moveTo(0,0),c.lineTo(g,-2*x),c.lineTo(g,0),c.fillStyle=C,c.closePath(),c.fill()}let y=c.getImageData(0,0,u,p);return d.width=y.width,d.height=y.height,c.putImageData(y,0,0),m=r.createPattern(d,"no-repeat"),m&&al.Set(t,e,i,n,o,m,u,p),m}var jg=Symbol.for("ArcRenderContribution"),zg=Symbol.for("AreaRenderContribution"),Gg=Symbol.for("CircleRenderContribution"),xx=Symbol.for("GroupRenderContribution"),Ug=Symbol.for("ImageRenderContribution"),Wg=Symbol.for("PathRenderContribution"),Yg=Symbol.for("PolygonRenderContribution"),Hh=Symbol.for("RectRenderContribution"),Xg=Symbol.for("SymbolRenderContribution"),Kg=Symbol.for("TextRenderContribution"),T0t=Symbol.for("CommonRenderContribution"),bx=Symbol.for("InteractiveSubRenderContribution");function Jo(r,t){return r==="end"||r==="right"?-t:r==="center"?-t/2:0}function Nh(r,t,e,i=0){return r==="middle"?-t/2:r==="top"?0:r==="bottom"?i-t:r&&r!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}function Sx(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function $L(r,t,e){let i=Math.sin(e),s=Math.cos(e),n=t[4],o=t[5],a=t[6],l=t[7],h=t[8],d=t[9],c=t[10],u=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=n*s+h*i,r[5]=o*s+d*i,r[6]=a*s+c*i,r[7]=l*s+u*i,r[8]=h*s-n*i,r[9]=d*s-o*i,r[10]=c*s-a*i,r[11]=u*s-l*i,r}function qL(r,t,e){let i=Math.sin(e),s=Math.cos(e),n=t[0],o=t[1],a=t[2],l=t[3],h=t[8],d=t[9],c=t[10],u=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=n*s-h*i,r[1]=o*s-d*i,r[2]=a*s-c*i,r[3]=l*s-u*i,r[8]=n*i+h*s,r[9]=o*i+d*s,r[10]=a*i+c*s,r[11]=l*i+u*s,r}function ZL(r,t,e){let i=Math.sin(e),s=Math.cos(e),n=t[0],o=t[1],a=t[2],l=t[3],h=t[4],d=t[5],c=t[6],u=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=n*s+h*i,r[1]=o*s+d*i,r[2]=a*s+c*i,r[3]=l*s+u*i,r[4]=h*s-n*i,r[5]=d*s-o*i,r[6]=c*s-a*i,r[7]=u*s-l*i,r}function Wc(r,t,e){let i=e[0],s=e[1],n=e[2],o,a,l,h,d,c,u,p,m,g,f,_;return t===r?(r[12]=t[0]*i+t[4]*s+t[8]*n+t[12],r[13]=t[1]*i+t[5]*s+t[9]*n+t[13],r[14]=t[2]*i+t[6]*s+t[10]*n+t[14],r[15]=t[3]*i+t[7]*s+t[11]*n+t[15]):(o=t[0],a=t[1],l=t[2],h=t[3],d=t[4],c=t[5],u=t[6],p=t[7],m=t[8],g=t[9],f=t[10],_=t[11],r[0]=o,r[1]=a,r[2]=l,r[3]=h,r[4]=d,r[5]=c,r[6]=u,r[7]=p,r[8]=m,r[9]=g,r[10]=f,r[11]=_,r[12]=o*i+d*s+m*n+t[12],r[13]=a*i+c*s+g*n+t[13],r[14]=l*i+u*s+f*n+t[14],r[15]=h*i+p*s+_*n+t[15]),r}function $g(r,t){r[0]=t.a,r[1]=t.b,r[2]=0,r[3]=0,r[4]=t.c,r[5]=t.d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t.e,r[13]=t.f,r[14]=0,r[15]=1}function JL(r,t,e){let i=e[0],s=e[1],n=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*s,r[5]=t[5]*s,r[6]=t[6]*s,r[7]=t[7]*s,r[8]=t[8]*n,r[9]=t[9]*n,r[10]=t[10]*n,r[11]=t[11]*n,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function fn(r,t,e){let i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],d=t[7],c=t[8],u=t[9],p=t[10],m=t[11],g=t[12],f=t[13],_=t[14],v=t[15],x=e[0],y=e[1],b=e[2],S=e[3];return r[0]=x*i+y*a+b*c+S*g,r[1]=x*s+y*l+b*u+S*f,r[2]=x*n+y*h+b*p+S*_,r[3]=x*o+y*d+b*m+S*v,x=e[4],y=e[5],b=e[6],S=e[7],r[4]=x*i+y*a+b*c+S*g,r[5]=x*s+y*l+b*u+S*f,r[6]=x*n+y*h+b*p+S*_,r[7]=x*o+y*d+b*m+S*v,x=e[8],y=e[9],b=e[10],S=e[11],r[8]=x*i+y*a+b*c+S*g,r[9]=x*s+y*l+b*u+S*f,r[10]=x*n+y*h+b*p+S*_,r[11]=x*o+y*d+b*m+S*v,x=e[12],y=e[13],b=e[14],S=e[15],r[12]=x*i+y*a+b*c+S*g,r[13]=x*s+y*l+b*u+S*f,r[14]=x*n+y*h+b*p+S*_,r[15]=x*o+y*d+b*m+S*v,r}function fs(r,t,e){let i=t[0],s=t[1],n=t[2],o=e[3]*i+e[7]*s+e[11]*n+e[15];return o=o||1,r[0]=(e[0]*i+e[4]*s+e[8]*n+e[12])/o,r[1]=(e[1]*i+e[5]*s+e[9]*n+e[13])/o,r[2]=(e[2]*i+e[6]*s+e[10]*n+e[14])/o,r}var P0t=Symbol.for("MatrixAllocate"),R0t=Symbol.for("Mat4Allocate");function QL(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}var Qk=class{constructor(){this.pools=[]}allocate(t,e,i,s,n,o){if(!this.pools.length)return new Kt(t,e,i,s,n,o);let a=this.pools.pop();return a.a=t,a.b=e,a.c=i,a.d=s,a.e=n,a.f=o,a}allocateByObj(t){if(!this.pools.length)return new Kt(t.a,t.b,t.c,t.d,t.e,t.f);let e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},tM=class r{constructor(){this.pools=[]}static identity(t){return Sx(t)}allocate(){if(!this.pools.length)return QL();let t=this.pools.pop();return r.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():QL();for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},hi=new Qk,Fe=new tM;var BY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},LY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},IY=function(r,t){return function(e,i){t(e,i,r)}};function Cx(r,t,e){var i;let{x:s=e.x,y:n=e.y,z:o=e.z,dx:a=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:d=e.scaleX,scaleY:c=e.scaleY,scaleZ:u=e.scaleZ,alpha:p=e.alpha,beta:m=e.beta,angle:g=e.angle,anchor3d:f=t.attribute.anchor,anchor:_}=t.attribute,v=[0,0,0];if(f){if(typeof f[0]=="string"){let x=parseFloat(f[0])/100,y=t.AABBBounds;v[0]=y.x1+(y.x2-y.x1)*x}else v[0]=f[0];if(typeof f[1]=="string"){let x=parseFloat(f[1])/100,y=t.AABBBounds;v[1]=y.x1+(y.x2-y.x1)*x}else v[1]=f[1];v[2]=(i=f[2])!==null&&i!==void 0?i:0}if(Sx(r),Wc(r,r,[s+a,n+l,o+h]),Wc(r,r,[v[0],v[1],v[2]]),$L(r,r,m),qL(r,r,p),Wc(r,r,[-v[0],-v[1],v[2]]),JL(r,r,[d,c,u]),g){let x=Fe.allocate(),y=[0,0];if(_){if(typeof f[0]=="string"){let b=parseFloat(f[0])/100,S=t.AABBBounds;y[0]=S.x1+(S.x2-S.x1)*b}else y[0]=f[0];if(typeof f[1]=="string"){let b=parseFloat(f[1])/100,S=t.AABBBounds;y[1]=S.x1+(S.x2-S.x1)*b}else y[1]=f[1]}Wc(x,x,[y[0],y[1],0]),ZL(x,x,g),Wc(x,x,[-y[0],-y[1],0]),fn(r,r,x)}}function tI(r){let{alpha:t,beta:e}=r.attribute;return t||e}var Ax=class{constructor(r){this.creator=r,this.hooks={onAttributeUpdate:new wi(["graphic"]),onSetStage:new wi(["graphic","stage"]),onRemove:new wi(["graphic"]),onRelease:new wi(["graphic"]),onAddIncremental:new wi(["graphic","group","stage"]),onClearIncremental:new wi(["graphic","group","stage"]),beforeUpdateAABBBounds:new wi(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new wi(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new wi(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new ie,this.tempAABBBounds2=new ie}onAttributeUpdate(r){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(r)}onSetStage(r,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(r,t)}onRemove(r){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(r)}onRelease(r){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(r)}onAddIncremental(r,t,e){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(r,t,e)}onClearIncremental(r,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(r,t)}beforeUpdateAABBBounds(r,t,e,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(r,t,e,i)}afterUpdateAABBBounds(r,t,e,i,s){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(r,t,e,i,s)}clearAABBBounds(r,t,e){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(r,t,e)}updatePathProxyAABBBounds(r,t){let e=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;if(!e)return!1;let i=new Ua(r);return Lr(e.commandList,i,0,0),!0}updateHTMLTextAABBBounds(r,t,e,i){let{textAlign:s,textBaseline:n}=r;if(r.forceBoundsHeight!=null){let o=J(r.forceBoundsHeight)?r.forceBoundsHeight:r.forceBoundsHeight(),a=Nh(n,o,o);e.set(e.x1,a,e.x2,a+o)}if(r.forceBoundsWidth!=null){let o=J(r.forceBoundsWidth)?r.forceBoundsWidth:r.forceBoundsWidth(),a=Jo(s,o);e.set(a,e.y1,a+o,e.y2)}}combindShadowAABBBounds(r,t){if(t&&t.shadowRoot){let e=t.shadowRoot.AABBBounds;r.union(e)}}transformAABBBounds(r,t,e,i,s){if(!t.empty()){let{scaleX:a=e.scaleX,scaleY:l=e.scaleY,stroke:h=e.stroke,shadowBlur:d=e.shadowBlur,lineWidth:c=e.lineWidth,pickStrokeBuffer:u=e.pickStrokeBuffer,strokeBoundsBuffer:p=e.strokeBoundsBuffer}=r,m=this.tempAABBBounds1,g=this.tempAABBBounds2;if(h&&c){let f=(c+u)/Math.abs(a+l);Oh(m,f,i,p),t.union(m),m.setValue(g.x1,g.y1,g.x2,g.y2)}if(d){let{shadowOffsetX:f=e.shadowOffsetX,shadowOffsetY:_=e.shadowOffsetY}=r,v=d/Math.abs(a+l)*2;Oh(m,v,!1,p+1),m.translate(f,_),t.union(m)}}if(this.combindShadowAABBBounds(t,s),t.empty())return;let n=!0,o=s.transMatrix;s&&s.isContainer&&(n=!(o.a===1&&o.b===0&&o.c===0&&o.d===1&&o.e===0&&o.f===0)),n&&Xm(t,t,o)}validCheck(r,t,e,i){if(!i||r.forceBoundsHeight!=null||r.forceBoundsWidth!=null||i.shadowRoot||i.isContainer)return!0;let{visible:s=t.visible}=r;return!(!i.valid||!s)||(e.empty()||(i.parent&&e.transformWithMatrix(i.parent.globalTransMatrix),j.graphicService.clearAABBBounds(i,i.stage,e),e.clear()),!1)}updateTempAABBBounds(r){let t=this.tempAABBBounds1,e=this.tempAABBBounds2;return t.setValue(r.x1,r.y1,r.x2,r.y2),e.setValue(r.x1,r.y1,r.x2,r.y2),{tb1:t,tb2:e}}};Ax=BY([q(),IY(0,lt(mx)),LY("design:paramtypes",[Object])],Ax);var uo=(r,t,e)=>{let{outerBorder:i,shadowBlur:s=t.shadowBlur}=r;if(i){let n=t.outerBorder,{distance:o=n.distance,lineWidth:a=n.lineWidth}=i;e.expand(o+(s+a)/2)}return e};var eI=["radius","startAngle","endAngle",...ci],Tx=class r extends Ve{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=el}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return dt(this).circle}updateAABBBounds(t,e,i,s){this.updatePathProxyAABBBounds(i)||(s?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));let{tb1:n,tb2:o}=j.graphicService.updateTempAABBBounds(i);return uo(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2),j.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){let{radius:s=e.radius}=t;return i.set(-s,-s,s,s),i}updateCircleAABBBoundsAccurate(t,e,i){let{startAngle:s=e.startAngle,endAngle:n=e.endAngle,radius:o=e.radius}=t;return n-s>vt-1e-12?i.set(-o,-o,o,o):wg(s,n,o,i),i}needUpdateTags(t){return super.needUpdateTags(t,eI)}needUpdateTag(t){return super.needUpdateTag(t,eI)}toCustomPath(){var t,e,i;let s=this.attribute,n=(t=s.radius)!==null&&t!==void 0?t:this.getDefaultAttribute("radius"),o=(e=s.startAngle)!==null&&e!==void 0?e:this.getDefaultAttribute("startAngle"),a=(i=s.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle"),l=new ne;return l.arc(0,0,n,o,a),l}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Tx.NOWORK_ANIMATE_ATTR=Be;function eM(r){return new Tx(r)}var Vh=class{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,s){if(t.xOffset=e==="left"||e==="start"?0:e==="center"?t.width/-2:e==="right"||e==="end"?-t.width:0,i==="top")t.yOffset=0;else if(i==="middle")t.yOffset=t.height/-2;else if(i==="alphabetic"){let n=.79;if(s.length===1){let o=s[0];n=o.ascent/(o.ascent+o.descent)}t.yOffset=t.height*-n}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,s,n="",o,a){let{lineWidth:l,suffixPosition:h="end",measureMode:d=eo.actualBounding,keepCenterInLine:c=!1}=a??{};t=t.map(g=>g.toString());let u=[],p=[0,0];if(typeof l=="number"&&l!==1/0){let g;for(let f=0,_=t.length;f<_;f++){let v=this.textMeasure.measureTextPixelADscentAndWidth(t[f],this.textOptions,d),x=t[f].toString();if(v.width>l){let y=this.textMeasure.clipTextWithSuffix(t[f],this.textOptions,l,n,o,h);x=y.str,g=y.width}else g=v.width;u.push({str:x,width:g,ascent:v.ascent,descent:v.descent,keepCenterInLine:c})}p[0]=l}else{let g,f,_=0;for(let v=0,x=t.length;v<x;v++){f=t[v];let y=this.textMeasure.measureTextPixelADscentAndWidth(t[v],this.textOptions,d);g=y.width,_=Math.max(_,g),u.push({str:f,width:g,ascent:y.ascent,descent:y.descent,keepCenterInLine:c})}p[0]=_}p[1]=u.length*s,p[0]=u.reduce((g,f)=>Math.max(g,f.width),0);let m={xOffset:0,yOffset:0,width:p[0],height:p[1]};return this.LayoutBBox(m,e,i,u),this.layoutWithBBox(m,u,e,i,s)}layoutWithBBox(t,e,i,s,n){let o=[0,0],a=e.length*n;s==="top"||(s==="middle"?o[1]=(t.height-a)/2:s==="bottom"&&(o[1]=t.height-a));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,s,n,o);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:n,textAlign:i,textBaseline:s}}lineOffset(t,e,i,s,n,o){if(i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=n/2+(e.ascent-e.descent)/2+o[1],!e.keepCenterInLine){let l=e.ascent+e.descent+0;if(l<n-0&&(s==="bottom"?e.topOffset+=(n-l)/2:s==="top"&&(e.topOffset-=(n-l)/2)),s==="alphabetic"){let h=n/(e.ascent+e.descent);e.topOffset=n/2+(e.ascent-e.descent)/2*h+o[1]}}return o[1]+=n,e}};var iI=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...ci],jh=class r extends Ve{get font(){let t=this.getGraphicTheme();return this._font||(this._font=fh(this.attribute,t)),this._font}get clipedText(){var t;let e=this.attribute,i=this.getGraphicTheme(),s=this.getMaxWidth(i);return Number.isFinite(s)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;let i=this.getGraphicTheme(),s=this.attribute,n=this.getMaxWidth(i);if(!Number.isFinite(n))return!1;let{text:o}=this.attribute;if(this.tryUpdateAABBBounds(),(e=(t=this.cache)===null||t===void 0?void 0:t.layoutData)===null||e===void 0?void 0:e.lines){let a="";return this.cache.layoutData.lines.forEach(l=>{a+=l.str}),(Array.isArray(o)?o.join(""):o)!==a}return s.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(a=>a.text).join("")!==s.text.toString():this.clipedText!=null&&this.clipedText!==s.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=ol,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{text:t}=this.attribute;return H(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}getGraphicTheme(){return dt(this).text}doUpdateOBBBounds(){let t=this.getGraphicTheme();this._OBBBounds.clear();let e=this.attribute,{angle:i=t.angle}=e;if(!i){let h=this.AABBBounds;return this._OBBBounds.setValue(h.x1,h.y1,h.x2,h.y2),this._OBBBounds}this.obbText||(this.obbText=new r({})),this.obbText.setAttributes(Object.assign(Object.assign({},e),{angle:0}));let s=this.obbText.AABBBounds,{x:n,y:o}=e,a={x:(s.x1+s.x2)/2,y:(s.y1+s.y2)/2},l=Pa(a,i,{x:n,y:o});return this._OBBBounds.copy(s),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(t,e,i){let{text:s=e.text}=this.attribute;Array.isArray(s)?this.updateMultilineAABBBounds(s):this.updateSingallineAABBBounds(s);let{tb1:n}=j.graphicService.updateTempAABBBounds(i),{scaleX:o=e.scaleX,scaleY:a=e.scaleY,shadowBlur:l=e.shadowBlur,strokeBoundsBuffer:h=e.strokeBoundsBuffer}=t;if(l){let d=l/Math.abs(o+a);Oh(n,d,!0,h),i.union(n)}return j.graphicService.combindShadowAABBBounds(i,this),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||j.graphicService.updateHTMLTextAABBBounds(t,e,i),Xm(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);let e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){let i=e.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(t){let e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:s=e.underlineOffset}=this.attribute,n=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&s&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+s),n}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;let i=this.getGraphicTheme(),s=this.attribute,{fontFamily:n=i.fontFamily,textAlign:o=i.textAlign,textBaseline:a=i.textBaseline,fontSize:l=i.fontSize,fontWeight:h=i.fontWeight,ellipsis:d=i.ellipsis,maxLineWidth:c,stroke:u=i.stroke,wrap:p=i.wrap,measureMode:m=i.measureMode,lineWidth:g=i.lineWidth,whiteSpace:f=i.whiteSpace,suffixPosition:_=i.suffixPosition,ignoreBuf:v=i.ignoreBuf,keepCenterInLine:x=i.keepCenterInLine}=s,y=v?0:this.guessLineHeightBuf(l),b=this.getLineHeight(s,i,y);if(f==="normal"||p)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){let M=this.cache.layoutData.bbox;return this._AABBBounds.set(M.xOffset,M.yOffset,M.xOffset+M.width,M.yOffset+M.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}let S=j.graphicUtil.textMeasure,C=new Vh(n,{fontSize:l,fontWeight:h,fontFamily:n,lineHeight:b},S).GetLayoutByLines(t,o,a,b,d===!0?i.ellipsis:d||void 0,!1,{lineWidth:c,suffixPosition:_,measureMode:m,keepCenterInLine:x}),{bbox:k}=C;return this.cache.layoutData=C,this.clearUpdateShapeTag(),this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,s;let n=this.getGraphicTheme(),{fontFamily:o=n.fontFamily,textAlign:a=n.textAlign,textBaseline:l=n.textBaseline,fontSize:h=n.fontSize,ellipsis:d=n.ellipsis,maxLineWidth:c,stroke:u=n.stroke,lineWidth:p=n.lineWidth,wordBreak:m=n.wordBreak,fontWeight:g=n.fontWeight,ignoreBuf:f=n.ignoreBuf,measureMode:_=n.measureMode,suffixPosition:v=n.suffixPosition,heightLimit:x=0,lineClamp:y,keepCenterInLine:b=n.keepCenterInLine}=this.attribute,S=f?0:this.guessLineHeightBuf(h),C=this.getLineHeight(this.attribute,n,S);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){let N=this.cache.layoutData.bbox;return this._AABBBounds.set(N.xOffset,N.yOffset,N.xOffset+N.width,N.yOffset+N.height),u&&this._AABBBounds.expand(p/2),this._AABBBounds}let k=j.graphicUtil.textMeasure,M={fontSize:h,fontWeight:g,fontFamily:o,lineHeight:C},E=new Vh(o,M,k),D=H(t)?t.map(N=>N.toString()):[t.toString()],P=[],B=[0,0],L=1/0;if(x>0&&(L=Math.max(Math.floor(x/C),1)),y&&(L=Math.min(L,y)),typeof c=="number"&&c!==1/0){if(c>0)for(let z=0;z<D.length;z++){let Y=D[z],U=!0;if(z===L-1){let bt=k.clipTextWithSuffix(Y,M,c,d,!1,v,z!==D.length-1),Ot=k.measureTextPixelADscentAndWidth(bt.str,M,_);P.push({str:bt.str,width:bt.width,ascent:Ot.ascent,descent:Ot.descent,keepCenterInLine:b});break}let $=k.clipText(Y,M,c,m!=="break-all",m==="keep-all");if(Y!==""&&$.str===""||$.wordBreaked){if(d){let bt=k.clipTextWithSuffix(Y,M,c,d,!1,v);$.str=(i=bt.str)!==null&&i!==void 0?i:"",$.width=(s=bt.width)!==null&&s!==void 0?s:0}else $.str="",$.width=0;U=!1}let ut=k.measureTextPixelADscentAndWidth($.str,M,_);P.push({str:$.str,width:$.width,ascent:ut.ascent,descent:ut.descent,keepCenterInLine:b});let mt=$.str.length;if(!$.wordBreaked||Y!==""&&$.str===""||(U=!0,mt=$.wordBreaked),$.str.length!==Y.length){if(U){let bt=Y.substring(mt);m==="keep-all"&&(bt=bt.replace(/^\s+/g,"")),D.splice(z+1,0,bt)}}}let N=0;P.forEach(z=>{N=Math.max(N,z.width)}),B[0]=N}else{let N,z,Y=0;for(let U=0,$=D.length;U<$;U++){if(U===L-1){let mt=k.clipTextWithSuffix(D[U],M,c,d,!1,v),bt=k.measureTextPixelADscentAndWidth(mt.str,M,_);P.push({str:mt.str,width:mt.width,ascent:bt.ascent,descent:bt.descent,keepCenterInLine:b}),Y=Math.max(Y,mt.width);break}z=D[U],N=k.measureTextWidth(z,M),Y=Math.max(Y,N);let ut=k.measureTextPixelADscentAndWidth(z,M,_);P.push({str:z,width:N,ascent:ut.ascent,descent:ut.descent,keepCenterInLine:b})}B[0]=Y}B[1]=P.length*C;let w={xOffset:0,yOffset:0,width:B[0],height:B[1]};E.LayoutBBox(w,a,l,P);let R=E.layoutWithBBox(w,P,a,l,C);return this.cache.layoutData=R,this.clearUpdateShapeTag(),this._AABBBounds.set(w.xOffset,w.yOffset,w.xOffset+w.width,w.yOffset+w.height),u&&this._AABBBounds.expand(p/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i;let s=this.getGraphicTheme(),n=j.graphicUtil.textMeasure,o,a=this.attribute,{maxLineWidth:l=s.maxLineWidth,ellipsis:h=s.ellipsis,fontFamily:d=s.fontFamily,fontSize:c=s.fontSize,fontWeight:u=s.fontWeight,stroke:p=s.stroke,lineWidth:m=s.lineWidth,verticalMode:g=s.verticalMode,suffixPosition:f=s.suffixPosition}=a,_=this.getLineHeight(a,s,0),{textAlign:v=s.textAlign,textBaseline:x=s.textBaseline}=a;if(!g){let k=v;v=(e=r.baselineMapAlign[x])!==null&&e!==void 0?e:"left",x=(i=r.alignMapBaseline[k])!==null&&i!==void 0?i:"top"}if(o=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(D=>{let P=D.reduce((B,L)=>B+L.width,0);o=ri(P,o)});let k=Jo(v,o),M=this.cache.verticalList.length*_,E=Nh(x,M,c);return this._AABBBounds.set(E,k,E+M,k+o),p&&this._AABBBounds.expand(m/2),this._AABBBounds}let y=t.map(k=>IL(k.toString()));y.forEach((k,M)=>{if(Number.isFinite(l))if(h){let E=h===!0?s.ellipsis:h,D=n.clipTextWithSuffixVertical(k,{fontSize:c,fontWeight:u,fontFamily:d},l,E,!1,f);y[M]=D.verticalList,o=D.width}else{let E=n.clipTextVertical(k,{fontSize:c,fontWeight:u,fontFamily:d},l,!1);y[M]=E.verticalList,o=E.width}else o=0,k.forEach(E=>{let D=E.direction===Fh.HORIZONTAL?c:n.measureTextWidth(E.text,{fontSize:c,fontWeight:u,fontFamily:d});o+=D,E.width=D})}),this.cache.verticalList=y,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(k=>{let M=k.reduce((E,D)=>E+D.width,0);o=ri(M,o)});let b=Jo(v,o),S=this.cache.verticalList.length*_,C=Nh(x,S,c);return this._AABBBounds.set(C,b,C+S,b+o),p&&this._AABBBounds.expand(m/2),this._AABBBounds}getMaxWidth(t){var e,i;let s=this.attribute;return(i=(e=s.maxLineWidth)!==null&&e!==void 0?e:s.maxWidth)!==null&&i!==void 0?i:t.maxWidth}getLineHeight(t,e,i){var s;return(s=Ih(t.lineHeight,t.fontSize||e.fontSize))!==null&&s!==void 0?s:(t.fontSize||e.fontSize)+i}needUpdateTags(t,e=iI){return super.needUpdateTags(t,e)}needUpdateTag(t,e=iI){return super.needUpdateTag(t,e)}_interpolate(t,e,i,s,n){t==="text"&&(n.text=s)}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return r.baselineMapAlign}getAlignMapBaseline(){return r.alignMapBaseline}};jh.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},Be),jh.baselineMapAlign={top:"left",bottom:"right",middle:"center"},jh.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function zs(r){return new jh(r)}var rI=(r,t,e)=>{let{outerBorder:i,shadowBlur:s=t.shadowBlur,strokeBoundsBuffer:n=t.strokeBoundsBuffer}=r;if(i){let o=t.outerBorder,{distance:a=o.distance,lineWidth:l=o.lineWidth}=i;Oh(e,a+(s+l)/2,!0,n)}return e};var sI=["symbolType","size",...ci],Yc=class r extends Ve{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=nl}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(t=0,e=0,i=1){let s=null;try{s=new Path2D}catch{return null}let n=this.getParsedPath();if(!n)return null;n.draw(s,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{size:t}=this.attribute;return H(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){let{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return dt(this).symbol}updateAABBBounds(t,e,i,s){this.updatePathProxyAABBBounds(i)||(s?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));let{tb1:n,tb2:o}=j.graphicService.updateTempAABBBounds(i);rI(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2);let{lineJoin:a=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateSymbolAABBBoundsImprecise(t,e,i){let{size:s=e.size}=t;if(H(s))i.set(-s[0]/2,-s[1]/2,s[0]/2,s[1]/2);else{let n=s/2;i.set(-n,-n,n,n)}return i}updateSymbolAABBBoundsAccurate(t,e,i){let{size:s=e.size}=t;return this.getParsedPath().bounds(s,i),i}needUpdateTags(t){return super.needUpdateTags(t,sI)}needUpdateTag(t){return super.needUpdateTag(t,sI)}toCustomPath(){let t=this.getParsedPath(),e=this.attribute.size,i=H(e)?e:[e,e];return t.path?new ne().fromCustomPath2D(t.path,0,0,i[0],i[1]):new ne().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Yc.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},Be);function _n(r){return new Yc(r)}var nI=["segments","points","curveType","curveTension",...ci],kx=class r extends Ve{constructor(t={}){super(t),this.type="line",this.numberType=co}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;let{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&!(t.length<=1)}_interpolate(t,e,i,s,n){t==="points"&&(n.points=Rc(i,s,e))}getGraphicTheme(){return dt(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),j.graphicService.updateTempAABBBounds(i);let{lineJoin:s=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,s==="miter",this),i}updateLineAABBBoundsByPoints(t,e,i,s){let{points:n=e.points,connectedType:o}=t,a=i;return n.forEach(l=>{l.defined===!1&&o!=="connect"||a.add(l.x,l.y)}),a}updateLineAABBBoundsBySegments(t,e,i,s){let{segments:n=e.segments,connectedType:o}=t,a=i;return n.forEach(l=>{l.points.forEach(h=>{h.defined===!1&&o!=="connect"||a.add(h.x,h.y)})}),a}needUpdateTags(t){return super.needUpdateTags(t,nI)}needUpdateTag(t){return super.needUpdateTag(t,nI)}toCustomPath(){let t=this.attribute,e=new ne,i=t.segments,s=n=>{if(n&&n.length){let o=!0;n.forEach(a=>{a.defined!==!1&&(o?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y),o=!1)})}};return i&&i.length?i.forEach(n=>{s(n.points)}):t.points&&s(t.points),e}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};kx.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Be);function Xc(r){return new kx(r)}var oI=["width","x1","y1","height","cornerRadius",...ci],Kc=class r extends Ve{constructor(t){super(t),this.type="rect",this.numberType=Hc}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return dt(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:o,height:a}=t,{x1:l,y1:h,x:d,y:c}=t;o=o??l-d,a=a??h-c,(isFinite(o)||isFinite(a)||isFinite(d)||isFinite(c))&&i.set(0,0,o||0,a||0)}let{tb1:s,tb2:n}=j.graphicService.updateTempAABBBounds(i);return uo(t,e,s),i.union(s),s.setValue(n.x1,n.y1,n.x2,n.y2),j.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,oI)}needUpdateTag(t){return super.needUpdateTag(t,oI)}toCustomPath(){let t=this.attribute,{x:e,y:i,width:s,height:n}=Sk(t),o=new ne;return o.moveTo(e,i),o.rect(e,i,s,n),o}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Kc.NOWORK_ANIMATE_ATTR=Be;function cr(r){return new Kc(r)}var aI=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],iM=class r extends Kc{constructor(t){super(t),this.type="rect3d",this.numberType=ux}findFace(){let t={polygons:[],vertices:[],edges:[]},e=this.getGraphicTheme(),{x1:i,y1:s,x:n,y:o,length:a=Ge(e.width,e.height)}=this.attribute,{width:l,height:h}=this.attribute;l=l??i-n,h=h??s-o;for(let d=0;d<aI.length;d++){let c=aI[d];t.vertices.push([c[0]*l,c[1]*h,c[2]*a])}return t.polygons.push({polygon:[0,1,5,4],normal:[0,-1,0]}),t.polygons.push({polygon:[2,3,7,6],normal:[0,1,0]}),t.polygons.push({polygon:[4,7,3,0],normal:[-1,0,0]}),t.polygons.push({polygon:[1,2,6,5],normal:[1,0,0]}),t.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),t.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),t.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],t}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};iM.NOWORK_ANIMATE_ATTR=Be;var rM=class r extends Ve{constructor(t){super(t),this.type="glyph",this.numberType=Fc,this.subGraphic=[],this._onInit&&this._onInit(this),this.valid=this.isValid()}setSubGraphic(t){this.detachSubGraphic(),this.subGraphic=t,t.forEach(e=>{e.glyphHost=this,Object.setPrototypeOf(e.attribute,this.attribute)}),this.valid=this.isValid(),this.addUpdateBoundTag()}detachSubGraphic(){this.subGraphic.forEach(t=>{t.glyphHost=null,Object.setPrototypeOf(t.attribute,{})})}getSubGraphic(){return this.subGraphic}onInit(t){this._onInit=t}onUpdate(t){this._onUpdate=t}isValid(){return!0}setAttribute(t,e,i,s){super.setAttribute(t,e,i,s),this.subGraphic.forEach(n=>{n.addUpdateShapeAndBoundsTag(),n.addUpdatePositionTag()})}setAttributes(t,e=!1,i){super.setAttributes(t,e,i),this.subGraphic.forEach(s=>{s.addUpdateShapeAndBoundsTag(),s.addUpdatePositionTag()})}translate(t,e){return super.translate(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}translateTo(t,e){return super.translateTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}scale(t,e,i){return super.scale(t,e,i),this.subGraphic.forEach(s=>{s.addUpdatePositionTag(),s.addUpdateBoundTag()}),this}scaleTo(t,e){return super.scaleTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}rotate(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}rotateTo(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}getGraphicTheme(){return dt(this).glyph}updateAABBBounds(t,e,i){return this.getSubGraphic().forEach(s=>{i.union(s.AABBBounds)}),i}doUpdateAABBBounds(){this.updateAABBBoundsStamp++,this._AABBBounds.clear();let t=this.updateAABBBounds(this.attribute,this.getGraphicTheme(),this._AABBBounds);return this.clearUpdateBoundTag(),t}needUpdateTags(t){return!1}needUpdateTag(t){return!1}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((o,a)=>this.currentStates[a]!==o)))return;this.stopStateAnimates();let s={},n=this.subGraphic.map(()=>({}));t.forEach(o=>{var a;let l=this.glyphStateProxy?this.glyphStateProxy(o,t):this.glyphStates[o];l&&(Object.assign(s,l.attributes),!((a=l.subAttributes)===null||a===void 0)&&a.length&&n.forEach((h,d)=>{Object.assign(h,l.subAttributes[d])}))}),this.subGraphic.forEach((o,a)=>{o.updateNormalAttrs(n[a]),o.applyStateAttrs(n[a],t,e)}),this.updateNormalAttrs(s),this.currentStates=t,this.applyStateAttrs(s,t,e)}clearStates(t){this.stopStateAnimates(),this.hasState()&&this.normalAttrs?(this.currentStates=[],this.subGraphic.forEach(e=>{e.applyStateAttrs(e.normalAttrs,this.currentStates,t,!0),e.normalAttrs=null}),this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}clone(){let t=new r(Object.assign({},this.attribute));return t.setSubGraphic(this.subGraphic.map(e=>e.clone())),t}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};rM.NOWORK_ANIMATE_ATTR=Be;var qg=class{constructor(t,e,i,s,n,o,a,l,h,d,c,u,p,m){this.left=t,this.top=e,this.width=i,this.height=s,this.actualHeight=0,this.bottom=e+s,this.right=t+i,this.ellipsis=n,this.wordBreak=o,this.verticalDirection=a,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=d,this.directionKey=bc[this.layoutDirection],this.isWidthMax=c,this.isHeightMax=u,this.singleLine=p,m?(m.clear(),this.icons=m):this.icons=new Map}draw(t,e){let{width:i,height:s}=this.getActualSize(),n=this.isWidthMax?Math.min(this.width,i):this.width||i||0,o=this.isHeightMax?Math.min(this.height,s):this.height||s||0;o=Math.min(o,s);let a=0;switch(this.globalBaseline){case"top":a=0;break;case"middle":a=-o/2;break;case"bottom":a=-o}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-n:this.globalAlign==="center"&&(l=-n/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let d=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let c=0;c<this.lines.length;c++){let{top:u,height:p}=this.lines[c];if(u+p<this[this.directionKey.top]||u+p>this[this.directionKey.top]+h)return d;let m=!1;this.ellipsis&&this.lines[c+1]&&this.lines[c+1].top+this.lines[c+1].height>this[this.directionKey.top]+h&&(m=!0,d=!0),this.lines[c].draw(t,m,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e)}else{let c=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=c:a+=c;for(let u=0;u<this.lines.length;u++)this.lines[u].draw(t,!1,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let c=0;c<this.lines.length;c++){let{top:u,height:p}=this.lines[c],m=h-this.lines[c].top-this.lines[c].height;if(h===0)this.lines[c].draw(t,!1,l,m+a,this.ellipsis,e);else{if(m+p>this[this.directionKey.top]+h||m<this[this.directionKey.top])return d;{let g=!1;this.ellipsis&&this.lines[c+1]&&m-this.lines[c+1].height<this[this.directionKey.top]&&(g=!0,d=!0),this.lines[c].draw(t,g,l,m+a,this.ellipsis,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let c=0;c<this.lines.length;c++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[c].height+this.lines[c].top);let{top:u,height:p}=this.lines[c];if(h===0)this.lines[c].draw(t,!1,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e);else{if(u+p<this[this.directionKey.top]||u+p>this[this.directionKey.top]+h)return d;{let m=!1;this.ellipsis&&this.lines[c+1]&&this.lines[c+1].top+this.lines[c+1].height>this[this.directionKey.top]+h&&(m=!0,d=!0),this.lines[c].draw(t,m,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e)}}}}return d}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){let s=this.lines[i];s.actualWidth>t&&(t=s.actualWidth),e+=s.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0,{width:i,height:s}=this.getRawActualSize();this.width;let n=this.height||s||0;n=Math.min(n,s);let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=o&&o!==0)for(let a=0;a<this.lines.length;a++){let{top:l,height:h}=this.lines[a];if(!(l+h<this[this.directionKey.top]||l+h>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+o){let d=this.ellipsis===!0?"...":this.ellipsis||"",c=this.lines[a].getWidthWithEllips(d);c>t&&(t=c),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else{Math.floor((o-this.actualHeight)/2);for(let a=0;a<this.lines.length;a++)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else if(this.verticalDirection==="bottom")for(let a=0;a<this.lines.length;a++){let{top:l,height:h}=this.lines[a],d=o-this.lines[a].top-this.lines[a].height;if(o===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(d+h>this[this.directionKey.top]+o||d<this[this.directionKey.top]))if(this.ellipsis&&this.lines[a+1]&&d-this.lines[a+1].height<this[this.directionKey.top]){let c=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[a].getWidthWithEllips(c);u>t&&(t=u),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}else for(let a=0;a<this.lines.length;a++){let{top:l,height:h}=this.lines[a];if(o===0)this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height;else if(!(l+h<this[this.directionKey.top]||l+h>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[a+1]&&this.lines[a+1].top+this.lines[a+1].height>this[this.directionKey.top]+o){let d=this.ellipsis===!0?"...":this.ellipsis||"",c=this.lines[a].getWidthWithEllips(d);c>t&&(t=c),e+=this.lines[a].height}else this.lines[a].actualWidth>t&&(t=this.lines[a].actualWidth),e+=this.lines[a].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}};function Zg(r,t,e,i){let s=Math.round(r),n=Math.round(e),o=Math.round(t),a=Math.round(i);return{left:r>s?s:s-.5,top:e>n?n:n-.5,right:o>t?o:o+.5,bottom:a>i?a:a+.5}}var Gs=class{constructor(t,e,i,s){this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=s;let n=Ih(i.lineHeight,this.fontSize);this.lineHeight=typeof n=="number"?n>this.fontSize?n:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;let{ascent:o,height:a,descent:l,width:h}=Wo(t,i,this.ascentDescentMode),d=0,c=0,u=0;this.height>a&&(d=(this.height-a)/2,c=Math.ceil(d),u=Math.floor(d)),this.textBaseline==="top"?(this.ascent=d,this.descent=a-d):this.textBaseline==="bottom"?(this.ascent=a-d,this.descent=d):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=o+c,this.descent=l+u),this.length=t.length,this.width=h||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){let{width:t}=Wo(this.text,this.character,this.ascentDescentMode);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,s,n,o,a){if(this.text===""||this.text===`
`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let l=e+i,h=this.text,d=this.left+s;l+=this.top;let c=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,c="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,o!=="right"&&o!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){let p=Sc(h,(c==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,p),h+=this.ellipsisStr,o==="right"||o==="end"){let{width:m}=Wo(this.text.slice(p),this.character,this.ascentDescentMode);c==="vertical"||(d-=this.ellipsisWidth-m)}}}let u=Zg(d,d+(this.widthOrigin||this.width),e,e+a);return Object.assign(Object.assign({},u),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,s,n,o,a){let l=e+i,h=this.text,d=this.left+s;l+=this.top;let c=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,c="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,o!=="right"&&o!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){let p=Sc(h,(c==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,p),h+=this.ellipsisStr,o==="right"||o==="end"){let{width:m}=Wo(this.text.slice(p),this.character,this.ascentDescentMode);c==="vertical"||(d-=this.ellipsisWidth-m)}}}switch(this.character.script){case"super":l-=this.ascent*(1/3);break;case"sub":l+=this.descent/2}c==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,d,l),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(d,l),d=0,l=0);let{lineWidth:u=1}=this.character;if(this.character.stroke&&u&&t.strokeText(h,d,l),this.character.fill&&t.fillText(h,d,l),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){let p=1+l,m=Zg(d,d+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(m.left,1+l,m.right-m.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){let p=1+l-this.ascent/2,m=Zg(d,d+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(m.left,1+l-this.ascent/2,m.right-m.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration==="underline"){let p=1+l,m=Zg(d,d+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(m.left,1+l,m.right-m.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration==="line-through"){let p=1+l-this.ascent/2,m=Zg(d,d+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(m.left,1+l-this.ascent/2,m.right-m.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}c==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text,i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){let s=Sc(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,s),e+=this.ellipsisStr;let{width:n}=Wo(this.text.slice(s),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-n}return i}};function lI(r,t){let e=r.text.slice(0,t),i=r.text.slice(t);return[new Gs(e,r.newLine,r.character,r.ascentDescentMode),new Gs(i,!0,r.character,r.ascentDescentMode)]}var hI=["width","height","image",...ci],$c=class r extends Ve{constructor(t){super(t),this.type="image",this.numberType=il,this.loadImage(this.attribute.image)}getImageElement(){let{image:t}=this.attribute;if(!t||!this.resources)return null;let e=this.resources.get(t);return e.state!=="success"?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,()=>{this.successCallback&&this.successCallback()}),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,()=>{this.failCallback&&this.failCallback()})}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,s){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,s)}getGraphicTheme(){return dt(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{maxWidth:o=e.maxWidth,maxHeight:a=e.maxHeight}=t,{width:l,height:h}=t;if(l==null||h==null){let d=this.getImageElement();if(d){let c=d.width,u=d.height;if(l!=null)h=l*(u/c);else if(h!=null)l=h*(c/u);else{let p=c/u;p>o/a?(l=o,h=o/p):(h=a,l=a*p)}}else l=o,h=a}this._actualWidth=l,this._actualHeight=h,i.set(0,0,l,h)}let{tb1:s,tb2:n}=j.graphicService.updateTempAABBBounds(i);return uo(t,e,s),i.union(s),s.setValue(n.x1,n.y1,n.x2,n.y2),j.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return $a[t]}needUpdateTags(t){return super.needUpdateTags(t,hI)}needUpdateTag(t){return super.needUpdateTag(t,hI)}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};$c.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},Be);function sM(r){return new $c(r)}var Vr=class extends $c{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){let e=Eg(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,s)=>{if(H(s)&&s.indexOf("margin")!==-1||s==="margin")if(i.margin){let n=Eg(i.margin);this._marginArray=typeof n=="number"?[n,n,n,n]:n}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();let{width:t=$a.width,height:e=$a.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:s=e}=this.attribute,n=(i-t)/2,o=(s-e)/2;return this._AABBBounds.expand([0,2*n,2*o,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}};var Jg=class{constructor(t,e,i,s,n,o,a,l){this.left=t,this.width=e,this.baseline=i,this.ascent=s,this.descent=n,this.top=i-s,this.paragraphs=o.map(d=>d),this.textAlign=(this.paragraphs[0]instanceof Vr?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=a,this.directionKey=bc[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach((d,c)=>{if(c===0&&d instanceof Gs){let u=gB.exec(d.text);u?.index!==0&&(d.text=d.text.slice(u?.index),d.updateWidth())}this.actualWidth+=d[this.directionKey.width],h=Math.max(d[this.directionKey.height],h)}),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){let i=this.directionKey,s=this.height,n=this.left,o=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?n=t-this.actualWidth:this.textAlign==="center"?n=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?n=(t-this.actualWidth)/2:o=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(a){a instanceof Vr?(a["_"+i.x]=n,n+=a[i.width]+o,a["_"+i.y]=a.attribute.textBaseline==="top"?0:a.attribute.textBaseline==="bottom"?s-a.height:(s-a.height)/2):(a[i.left]=n,n+=a[i.width]+o)})}draw(t,e,i,s,n,o){if(n&&(e||this.paragraphs.some(c=>c.overflow))){let c=!0,u=!1;for(let m=this.paragraphs.length-1;m>=0;m--){let g=this.paragraphs[m];if(g.overflow)c=c&&g.text==="";else if(c){u=!0;break}}let p=0;if(!u)for(let m=this.paragraphs.length-1;m>=0;m--){let g=this.paragraphs[m];if(g.overflow){if(g.text==="")break;continue}if(g instanceof Vr)break;if(this.direction==="vertical"&&g.direction!=="vertical"){g.verticalEllipsis=!0;break}let f=n===!0?"...":n||"";g.ellipsisStr=f;let{width:_}=Wo(f,g.character,g.ascentDescentMode),v=_||0;if(v<=this.blankWidth+p){e&&(g.ellipsis="add");break}if(v<=this.blankWidth+p+g.width){g.ellipsis="replace",g.ellipsisWidth=v,g.ellipsisOtherParagraphWidth=this.blankWidth+p;break}g.ellipsis="hide",p+=g.width}}let a="",l=-1,h=[],d=[h];this.paragraphs.forEach((c,u)=>{if(c instanceof Vr)return;let p=c.drawBackground(t,s,this.ascent,i,u===0,this.textAlign,this.height);p&&(a===p.fillStyle&&l===p.globalAlpha||(h=[],d.push(h),a=p.fillStyle,l=p.globalAlpha),h.push(p))}),d.forEach(c=>{if(c.length===0)return;let u=c[0],p=c[c.length-1];t.fillStyle=u.fillStyle,t.globalAlpha=u.globalAlpha,t.fillRect(u.left,u.top,p.right-u.left,p.bottom-u.top)}),this.paragraphs.forEach((c,u)=>{if(c instanceof Vr)return c.setAttributes({x:i+c._x,y:s+c._y}),void o(c,t,i+c._x,s+c._y,this.ascent);let p={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};vB(t,c.character),_B(t,c.character,p),c.draw(t,s,this.ascent,i,u===0,this.textAlign,this.height)})}getWidthWithEllips(t){let e=0;for(let s=this.paragraphs.length-1;s>=0;s--){let n=this.paragraphs[s];if(n instanceof Vr)break;let{width:o}=Wo(t,n.character,n.ascentDescentMode),a=o||0;if(a<=this.blankWidth+e){n.ellipsis="add",n.ellipsisWidth=a;break}if(a<=this.blankWidth+e+n.width){n.ellipsis="replace",n.ellipsisWidth=a,n.ellipsisOtherParagraphWidth=this.blankWidth+e;break}n.ellipsis="hide",e+=n.width}let i=0;return this.paragraphs.forEach((s,n)=>{i+=s instanceof Vr?s.width:s.getWidthWithEllips(this.direction)}),i}};var Qg=class{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=bc[this.direction]}store(t){if(t instanceof Vr){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;let t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new Jg(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t,e=!1){t instanceof Vr?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),(t.text.length!==0||this.newLine)&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){let i=this[this.directionKey.width]-this.lineWidth||0,s=Math.ceil(i/t[this.directionKey.width]*t.length)||0,n=Sc(t.text,i,t.character,s,this.frame.wordBreak==="break-word");if(n!==0){let[o,a]=lI(t,n);this.store(o),e?this.send():this.deal(a)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}};var nM=!1;try{nM=Intl&&typeof Intl.Segmenter=="function"}catch{nM=!1}var dI=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...ci],tf=class r extends Ve{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=Nc,this.onBeforeAttributeUpdate=(e,i,s)=>{for(let n in e)if(n==="hoverIconId"){if(e[n]===i[n])continue;let o=this._frameCache.icons.get(e[n]);this.updateHoverIconState(o)}}}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:dn.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:dn.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:dn.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:dn.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:dn.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:dn.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:dn.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:dn.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return dt(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every(e=>e.paragraphs.every(i=>!(i.text&&Z(i.text)&&r.splitText(i.text).length>1))):t.every(e=>e.isComposing||!(e.text&&Z(e.text)&&r.splitText(e.text).length>1))}static splitText(t){if(nM){let e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(let{segment:s}of e.segment(t))i.push(s);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){let e=[];return t.forEach(i=>{let s=r.splitText(i.text.toString());if(Z(i.text)&&s.length>1)for(let n=0;n<s.length;n++){let o=s[n];e.push(Object.assign(Object.assign({},i),{text:o}))}else e.push(i)}),e}updateAABBBounds(t,e,i){var s,n,o,a;let{width:l=e.width,height:h=e.height,maxWidth:d=e.maxWidth,maxHeight:c=e.maxHeight,textAlign:u=e.textAlign,verticalDirection:p=(n=(s=t.textBaseline)!==null&&s!==void 0?s:e.textBaseline)!==null&&n!==void 0?n:e.verticalDirection,editOptions:m}=t;if(l>0&&h>0)i.set(0,0,l,h);else{let _=this.getFrameCache(),{width:v,height:x}=_.getActualSize(),y=l||v||0,b=h||x||0;b=typeof c=="number"&&b>c?c:b||0,y=typeof d=="number"&&y>d?d:y||0,i.set(0,0,y,b)}m&&m.keepHeightWhileEmpty&&!i.height()&&!(!((o=t.textConfig)===null||o===void 0)&&o.length)&&(i.y2=i.y1+((a=t.fontSize)!==null&&a!==void 0?a:12),i.x2=i.x1+2);let g=0;switch(p){case"top":g=0;break;case"middle":g=-i.height()/2;break;case"bottom":g=-i.height()}let f=0;switch(u){case"left":f=0;break;case"center":f=-i.width()/2;break;case"right":f=-i.width()}return i.translate(f,g),j.graphicService.updateTempAABBBounds(i),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||j.graphicService.updateHTMLTextAABBBounds(t,e,i),j.graphicService.transformAABBBounds(t,i,e,!1,this),i.width()===0&&i.height()===0&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,dI)}needUpdateTag(t){return super.needUpdateTag(t,dI)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){let t=this.getFrameCache();if(t.actualHeight>t.height)return!0;let{disableAutoWrapLine:e}=this.attribute;if(e)for(let i=0;i<t.lines.length;i++){let s=t.lines[i];for(let n=0;n<s.paragraphs.length;n++){let o=s.paragraphs[n];if(o.overflow&&o.text!=="")return!0}}return!1}combinedStyleToCharacter(t){let{fill:e,stroke:i,fontSize:s,fontFamily:n,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,lineHeight:c,strokeOpacity:u,upgradeAttrs:p}=this.attribute,m=Object.assign({fill:e,stroke:i,fontSize:s,fontFamily:n,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,strokeOpacity:u},t);return p?.lineHeight&&(m.lineHeight=c),m}doUpdateFrameCache(t){var e;let{maxWidth:i,maxHeight:s,width:n,height:o,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:d,textBaseline:c,layoutDirection:u,singleLine:p,disableAutoWrapLine:m,editable:g,ascentDescentMode:f,upgradeAttrs:_}=this.attribute,v=_&&_.multiBreakLine,{textConfig:x=[]}=this.attribute;g&&x.length>0&&!r.AllSingleCharacter(x)&&(x=r.TransformTextConfig2SingleCharacter(x),this.attribute.textConfig=x);let y=[],b=t??x;for(let P=0;P<b.length;P++)if("image"in b[P]){let B=this.combinedStyleToCharacter(b[P]);B.lineWidth=void 0;let L=B.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(B.id);if(L)y.push(L);else{let w=new Vr(B);w.successCallback=()=>{var R;this.addUpdateBoundTag(),(R=this.stage)===null||R===void 0||R.renderNextFrame()},w.richtextId=B.id,y.push(w)}}else{let B=this.combinedStyleToCharacter(b[P]);if(J(B.text)&&(B.text=`${B.text}`),B.text&&B.text.includes(`
`)){let L=B.text.split(`
`);for(let w=0;w<L.length;w++)if(w===0)y.push(new Gs(L[w],!1,B,f));else if(L[w]||P===b.length-1)y.push(new Gs(L[w],!0,B,f));else{let R=this.combinedStyleToCharacter(b[P+1]);y.push(new Gs(L[w],!0,R,f))}}else B.text&&y.push(new Gs(B.text,!1,B,f))}let S=typeof i=="number"&&Number.isFinite(i)&&i>0,C=typeof s=="number"&&Number.isFinite(s)&&s>0,k=typeof n=="number"&&Number.isFinite(n)&&n>0&&(!S||n<=i),M=typeof o=="number"&&Number.isFinite(o)&&o>0&&(!C||o<=s),E=new qg(0,0,(k?n:S?i:0)||0,(M?o:C?s:0)||0,a,l,h,d,c,u||"horizontal",!k&&S,!M&&C,p||!1,(e=this._frameCache)===null||e===void 0?void 0:e.icons),D=new Qg(E);if(D.newLine=v,m){let P=0,B=!1;for(let L=0;L<y.length;L++){let w=y[L];B?(w.overflow=!0,w.left=1/0,w.top=1/0,!w.newLine&&E.lines[E.lines.length-1].paragraphs.push(w)):D.deal(w,!0),E.lines.length!==P&&(P=E.lines.length,D.lineBuffer.length=0,w.overflow=!0,w.left=1e3,w.top=1e3,E.lines[E.lines.length-1].paragraphs.push(w),B=!0),w.newLine&&(B=!1,D.lineWidth=0),D.send()}}else for(let P=0;P<y.length;P++)D.deal(y[P]);if(D.send(),!(E.layoutDirection==="horizontal"?k:M)){let P=E.getActualSizeWidthEllipsis(),B=E.layoutDirection==="horizontal"?P.width:P.height;(E.layoutDirection==="horizontal"?S:C)&&(B=Math.min(B,E.layoutDirection==="horizontal"?i:s)),E.lines.forEach(function(L){L.calcOffset(B,!1)})}v&&E.lines.forEach(P=>{let B=P.paragraphs;P.paragraphs=P.paragraphs.filter(L=>L.text!==""),P.paragraphs.length===0&&B.length&&(B[0].text=`
`,P.paragraphs.push(B[0]))}),this._frameCache=E}clone(){return new r(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach(i=>{i.setStage(t,e)})}bindIconEvent(){this.addEventListener("pointermove",t=>{let e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(t){var e,i,s,n,o;t?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(t.attribute.cursor),(s=this.stage)===null||s===void 0||s.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(n=this.stage)===null||n===void 0||n.setCursor(),(o=this.stage)===null||o===void 0||o.renderNextFrame())}pickIcon(t){let e=this.getFrameCache(),{e:i,f:s}=this.globalTransMatrix,n;return e.icons.forEach((o,a)=>{var l,h;let d=o.AABBBounds.clone();d.translate(o._marginArray[3],o._marginArray[0]),d.containsPoint({x:t.x-i,y:t.y-s})&&(n=o,n.globalX=((l=n.attribute.x)!==null&&l!==void 0?l:0)+i+o._marginArray[3],n.globalY=((h=n.attribute.y)!==null&&h!==void 0?h:0)+s+o._marginArray[0])}),n}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};tf.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},Be);function qc(r){return new tf(r)}var cI=["path","customPath",...ci],Mx=class r extends Ve{constructor(t){super(t),this.type="path",this.numberType=rl}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){let t=this.getGraphicTheme();if(!this.valid)return t.path;let e=this.attribute;return e.path instanceof ne?e.path:(T(this.cache)&&this.doUpdatePathShape(),this.cache instanceof ne?this.cache:t.path)}getGraphicTheme(){return dt(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let a=this.getParsedPathShape();i.union(a.getBounds())}let{tb1:s,tb2:n}=j.graphicService.updateTempAABBBounds(i);uo(t,e,s),i.union(s),s.setValue(n.x1,n.y1,n.x2,n.y2);let{lineJoin:o=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,o==="miter",this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){let t=this.attribute;Z(t.path,!0)?this.cache=new ne().fromString(t.path):t.customPath&&(this.cache=new ne,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,cI)}needUpdateTag(t){return super.needUpdateTag(t,cI)}toCustomPath(){return new ne().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Mx.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},Be);function Dx(r){return new Mx(r)}var uI=["segments","points","curveType","curveTension",...ci],Ex=class r extends Ve{constructor(t){super(t),this.type="area",this.numberType=ho}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;let{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&t.length!==0}getGraphicTheme(){return dt(this).area}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i):this.updateAreaAABBBoundsByPoints(t,e,i)),j.graphicService.updateTempAABBBounds(i);let{lineJoin:s=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,s==="miter",this),i}updateAreaAABBBoundsByPoints(t,e,i,s){let{points:n=e.points}=t,o=i;return n.forEach(a=>{var l,h;o.add(a.x,a.y),o.add((l=a.x1)!==null&&l!==void 0?l:a.x,(h=a.y1)!==null&&h!==void 0?h:a.y)}),o}updateAreaAABBBoundsBySegments(t,e,i,s){let{segments:n=e.segments}=t,o=i;return n.forEach(a=>{a.points.forEach(l=>{var h,d;o.add(l.x,l.y),o.add((h=l.x1)!==null&&h!==void 0?h:l.x,(d=l.y1)!==null&&d!==void 0?d:l.y)})}),o}_interpolate(t,e,i,s,n){t==="points"&&(n.points=Rc(i,s,e))}needUpdateTags(t){return super.needUpdateTags(t,uI)}needUpdateTag(t){return super.needUpdateTag(t,uI)}toCustomPath(){let t=new ne,e=this.attribute,i=e.segments,s=n=>{if(n&&n.length){let o=!0,a=[];if(n.forEach(l=>{var h,d;l.defined!==!1&&(o?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),a.push({x:(h=l.x1)!==null&&h!==void 0?h:l.x,y:(d=l.y1)!==null&&d!==void 0?d:l.y}),o=!1)}),a.length){for(let l=a.length-1;l>=0;l--)t.lineTo(a[l].x,a[l].y);t.closePath()}}};return e.points?s(e.points):i&&i.length&&i.forEach(n=>{s(n.points)}),t}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Ex.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},Be);function ef(r){return new Ex(r)}var pI=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...ci],Zc=class r extends Ve{constructor(t){super(t),this.type="arc",this.numberType=tl}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{startAngle:t,endAngle:e,outerRadius:i,innerRadius:s}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(s)}getParsedCornerRadius(){let t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:s=t.outerPadding}=this.attribute,{outerRadius:n=t.outerRadius,innerRadius:o=t.innerRadius}=this.attribute;if(n+=s,o-=i,e===0||e==="0%")return 0;let a=Math.abs(n-o),l=h=>Math.min(J(h,!0)?h:a*parseFloat(h)/100,a/2);if(H(e)){let h=e.map(d=>l(d)||0);return h.length===0?[h[0],h[0],h[0],h[0]]:h.length===2?[h[0],h[1],h[0],h[1]]:(h.length===3&&h.push(0),h)}return l(e)}getParsedAngle(){let t=this.getGraphicTheme(),{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute,{cap:s=t.cap}=this.attribute,n=i-e>=0?1:-1,o=i-e;if(e=TP(e),i=e+o,s&&Dt(o)<vt-1e-12){let a=1,l=1;s.length&&(a=Number(s[0]),l=Number(s[1]));let{outerRadius:h=t.outerRadius,innerRadius:d=t.innerRadius}=this.attribute,{outerPadding:c=t.outerPadding,innerPadding:u=t.innerPadding}=this.attribute;h+=c,d-=u;let p=Math.abs(h-d)/2,m=p/h;if(p>1e-12&&h>1e-12)return{startAngle:e-n*m*a,endAngle:i+n*m*l,sc:n*m*a,ec:n*m*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){let i=this.getGraphicTheme(),{innerPadding:s=i.innerPadding,outerPadding:n=i.outerPadding,padAngle:o=i.padAngle}=this.attribute,{outerRadius:a=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;a+=n,l-=s;let{padRadius:h=ar(a*a+l*l)}=this.attribute,d=Dt(e-t),c=t,u=e,p=t,m=e,g=o/2,f=d,_=d;if(g>1e-12&&h>1e-12){let v=e>t?1:-1,x=IC(Number(h)/l*ce(g)),y=IC(Number(h)/a*ce(g));return(f-=2*x)>1e-12?(x*=v,p+=x,m-=x):(f=0,p=m=(t+e)/2),(_-=2*y)>1e-12?(y*=v,c+=y,u-=y):(_=0,c=u=(t+e)/2),{outerStartAngle:c,outerEndAngle:u,innerStartAngle:p,innerEndAngle:m,innerDeltaAngle:f,outerDeltaAngle:_}}return{outerStartAngle:c,outerEndAngle:u,innerStartAngle:p,innerEndAngle:m,innerDeltaAngle:f,outerDeltaAngle:_}}getGraphicTheme(){return dt(this).arc}updateAABBBounds(t,e,i,s){this.updatePathProxyAABBBounds(i)||(s?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));let{tb1:n,tb2:o}=j.graphicService.updateTempAABBBounds(i);uo(t,e,n),i.union(n),n.setValue(o.x1,o.y1,o.x2,o.y2);let{lineJoin:a=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:s=e.outerRadius,innerRadius:n=e.innerRadius}=t,{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;return s+=o,n-=a,s<n&&(s=n),i.set(-s,-s,s,s),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:s=e.outerRadius,innerRadius:n=e.innerRadius}=t,{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;if(s+=o,n-=a,s<n){let d=s;s=n,n=d}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){let d=h;h=l,l=d}return s<=1e-12?i.set(0,0,0,0):Math.abs(l-h)>vt-1e-12?i.set(-s,-s,s,s):(wg(h,l,s,i),wg(h,l,n,i)),i}needUpdateTags(t){return super.needUpdateTags(t,pI)}needUpdateTag(t){return super.needUpdateTag(t,pI)}toCustomPath(){var t,e,i,s;let n=this.attribute,{startAngle:o,endAngle:a}=this.getParsedAngle(),l=((t=n.innerRadius)!==null&&t!==void 0?t:0)-((e=n.innerPadding)!==null&&e!==void 0?e:0),h=((i=n.outerRadius)!==null&&i!==void 0?i:0)-((s=n.outerPadding)!==null&&s!==void 0?s:0),d=Dt(a-o),c=a>o;if(h<l){let p=h;h=l,l=p}let u=new ne;if(h<=1e-12)u.moveTo(0,0);else if(d>=vt-1e-12)u.moveTo(0+h*Ce(o),0+h*ce(o)),u.arc(0,0,h,o,a,!c),l>1e-12&&(u.moveTo(0+l*Ce(a),0+l*ce(a)),u.arc(0,0,l,a,o,c));else{let p=h*Ce(o),m=h*ce(o),g=l*Ce(a),f=l*ce(a);u.moveTo(0+p,0+m),u.arc(0,0,h,o,a,!c),u.lineTo(0+g,0+f),u.arc(0,0,l,a,o,c),u.closePath()}return u}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Zc.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Be);function ll(r){return new Zc(r)}var oM=class r extends Zc{constructor(t){super(t),this.type="arc3d",this.numberType=Ic}updateAABBBounds(t,e,i){let s=this.stage;if(!s||!s.camera)return i;let{outerRadius:n=e.outerRadius,height:o=0}=t,a=n+o;return i.setValue(-a,-a,a,a),j.graphicService.updateTempAABBBounds(i),j.graphicService.transformAABBBounds(t,i,e,!1,this),i}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};oM.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},Be);var mI=["points","cornerRadius",...ci],Jc=class r extends Ve{constructor(t){super(t),this.type="polygon",this.numberType=sl}isValid(){return super.isValid()&&this._isValid()}_isValid(){let{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return dt(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),j.graphicService.updateTempAABBBounds(i);let{lineJoin:s=e.lineJoin}=t;return j.graphicService.transformAABBBounds(t,i,e,s==="miter",this),i}updatePolygonAABBBoundsImprecise(t,e,i){let{points:s=e.points}=t;return s.forEach(n=>{i.add(n.x,n.y)}),i}_interpolate(t,e,i,s,n){t==="points"&&(n.points=Rc(i,s,e))}needUpdateTags(t){return super.needUpdateTags(t,mI)}needUpdateTag(t){return super.needUpdateTag(t,mI)}toCustomPath(){let t=this.attribute.points,e=new ne;return t.forEach((i,s)=>{s===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)}),e.closePath(),e}clone(){return new r(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};Jc.NOWORK_ANIMATE_ATTR=Be;function aM(r){return new Jc(r)}var lM=class r extends Jc{constructor(t){super(t),this.type="pyramid3d",this.numberType=cx}updateAABBBounds(t,e,i){let s=this.stage;return!s||!s.camera||(this.findFace().vertices.forEach(n=>{let o=n[0],a=n[1];i.add(o,a)}),j.graphicService.updateTempAABBBounds(i),j.graphicService.transformAABBBounds(t,i,e,!1,this)),i}findFace(){let{points:t}=this.attribute,e=t.map((a,l)=>{let h=l===3?t[0]:t[l+1],d=a.x-h.x;return d===0?0:(a.y-h.y)/d}),i=t.map(a=>({p:a,d:0})),s=!1,n=0;for(let a=0;a<e.length-1;a++){for(let l=a+1;l<e.length;l++){if(e[a]===e[l]){s=!0;let h=pe.distancePP(i[a].p,i[a+1].p);i[a].d=h,i[a+1].d=h,n=ri(n,h);let d=pe.distancePP(i[l].p,i[l+1].p);i[l].d=d,i[l+1].d=d,n=ri(n,d)}if(s)break}if(s)break}for(let a=t.length-1;a>=0;a--){let l=t[a];i.unshift({p:l,d:0})}for(let a=0;a<t.length;a++){let l=(n-i[a+t.length].d)/2;i[a].d+=l,i[a+t.length].d+=l}let o={polygons:[],vertices:[],edges:[]};return i.forEach(a=>{o.vertices.push([a.p.x,a.p.y,a.d])}),o.polygons.push({polygon:[0,4,5,1],normal:[0,-1,0]}),o.polygons.push({polygon:[7,6,2,3],normal:[0,1,0]}),o.polygons.push({polygon:[0,4,7,3],normal:[-1,0,0]}),o.polygons.push({polygon:[1,5,6,2],normal:[1,0,0]}),o.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),o.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),o.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],o}_isValid(){return super._isValid()&&this.attribute.points.length===4}getNoWorkAnimateAttr(){return r.NOWORK_ANIMATE_ATTR}};lM.NOWORK_ANIMATE_ATTR=Be;var hM=class extends Vs{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){let e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){let t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}};function gI(r){return new hM(r)}var dM=class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){let i=this.store.get(t);return i?i(e):null}},Q=new dM;var Px;function rf(r){return Px||(Px=Q.CreateGraphic("text",{})),Px.initAttributes(r),Px.AABBBounds}var FY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},OY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},fI=function(r,t){return function(e,i){t(e,i,r)}},Qo=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){var m;let{background:g,backgroundOpacity:f=(m=t.attribute.fillOpacity)!==null&&m!==void 0?m:h.backgroundOpacity,opacity:_=h.opacity,backgroundMode:v=h.backgroundMode,backgroundFit:x=h.backgroundFit,backgroundKeepAspectRatio:y=h.backgroundKeepAspectRatio,backgroundScale:b=h.backgroundScale,backgroundOffsetX:S=h.backgroundOffsetX,backgroundOffsetY:C=h.backgroundOffsetY,backgroundClip:k=h.backgroundClip}=t.attribute;if(g)if(t.backgroundImg&&t.resources){let M=t.resources.get(g);if(M.state!=="success"||!M.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){let D=dt(t.parent).group,{scrollX:P=D.scrollX,scrollY:B=D.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(P,B)}k&&e.clip();let E=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,s,h),e.globalAlpha=f*_,this.doDrawImage(e,M.data,E,{backgroundMode:v,backgroundFit:x,backgroundKeepAspectRatio:y,backgroundScale:b,backgroundOffsetX:S,backgroundOffsetY:C}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,s,h),e.globalAlpha=f*_,e.fillStyle=g,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,s){let{backgroundMode:n,backgroundFit:o,backgroundKeepAspectRatio:a,backgroundScale:l=1,backgroundOffsetX:h=0,backgroundOffsetY:d=0}=s,c=i.width(),u=i.height(),p=c,m=u;if(n==="no-repeat")if(o)if(a){let g=Math.max(c/e.width,u/e.height);t.drawImage(e,i.x1+h,i.y1+d,e.width*g*l,e.height*g*l)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{let g=e.width*l,f=e.height*l;t.drawImage(e,i.x1+h,i.y1+d,g,f)}else{if(o&&n!=="repeat"&&(e.width||e.height)){let _=e.width,v=e.height;n==="repeat-x"?(p=_*(u/v),m=u):n==="repeat-y"&&(m=v*(c/_),p=c);let x=t.dpr,y=pn.allocate({width:p,height:m,dpr:x}),b=y.getContext("2d");b&&(b.inuse=!0,b.clearMatrix(),b.setTransformForCurrent(!0),b.clearRect(0,0,p,m),b.drawImage(e,0,0,p,m),e=y.nativeCanvas),pn.free(y)}let g=t.dpr,f=t.createPattern(e,n);f.setTransform&&f.setTransform(new DOMMatrix([1/g,0,0,1/g,0,0])),t.fillStyle=f,t.translate(i.x1,i.y1),t.fillRect(0,0,c,u),t.translate(-i.x1,-i.y1)}}},Tr=new Qo,Si=class{constructor(r){this.subRenderContribitions=r,this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(r,t,e,i,s,n,o,a,l,h,d,c,u){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(p=>{p.render(r,t,e,i,s,n,o,a,l,h,d,c,u)})}};Si=FY([q(),fI(0,lt($t)),fI(0,Zt(bx)),OY("design:paramtypes",[Object])],Si);var cM=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){var m,g;let{clipConfig:f}=t.attribute;if(!f)return;let _=t.getClipPath();if(!_)return;let v=!(c||u),x=t.AABBBounds,y=(m=t.attribute.width)!==null&&m!==void 0?m:x.width(),b=(g=t.attribute.height)!==null&&g!==void 0?g:x.height();v&&e.save(),e.beginPath(),_.draw(e,[y,b],i+y/2,s+b/2,0)===!1&&e.closePath(),c&&c(e,t.attribute,h,!0),v&&e.clip()}},_I=new cM,uM=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){let{clipConfig:m}=t.attribute;m&&t.getClipPath()&&(c||u||e.restore())}},vI=new uM;function HY(r){return r<=.5?4*r-1:-4*r+3}function NY(r,t,e,i,s,n,o){let{fill:a="orange",percent:l=.6,frequency:h=4,opacity:d,phi:c=0}=s,{amplitude:u=10}=s;u*=HY(t);let p=i*(1-l),m=e,g=Math.max(Math.round(m/70),2);r.beginPath(),r.moveTo(0+n,i+o),r.lineTo(0+n,p+o);let f=m/h*t,_=m/Math.PI/(2*h);for(let v=0;v<m;v+=g){let x=u*Math.sin((v+f+c)/_+c);r.lineTo(v+n,p+x+o)}r.lineTo(m+n,i+o),r.closePath(),r.fillStyle=a,isFinite(d)&&(r.globalAlpha=d),r.fill()}var zh=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,s,n){let o=(t-2*e)/2,a=s.dpr,l=pn.allocate({width:t,height:t,dpr:a}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),n(o,h);let d=s.createPattern(l.nativeCanvas,"repeat");return d.setTransform&&d.setTransform(new DOMMatrix([1/a,0,0,1/a,0,0])),pn.free(l),d}createCirclePattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{o.fillStyle=i,o.arc(n,n,n,0,vt),o.fill()})}createDiamondPattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{let a=t/2,l=a;o.fillStyle=i,o.moveTo(a,l-n),o.lineTo(n+a,l),o.lineTo(a,l+n),o.lineTo(a-n,l),o.closePath(),o.fill()})}createRectPattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{let a=e,l=a;o.fillStyle=i,o.fillRect(a,l,2*n,2*n)})}createVerticalLinePattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{let a=e;o.fillStyle=i,o.fillRect(a,0,2*n,t)})}createHorizontalLinePattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{let a=e;o.fillStyle=i,o.fillRect(0,a,t,2*n)})}createBiasLRLinePattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{o.strokeStyle=i,o.lineWidth=n,o.moveTo(0,0),o.lineTo(t,t);let a=t/2,l=-a;o.moveTo(a,l),o.lineTo(a+t,l+t),o.moveTo(-a,-l),o.lineTo(-a+t,-l+t),o.stroke()})}createBiasRLLinePattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{o.strokeStyle=i,o.lineWidth=n,o.moveTo(t,0),o.lineTo(0,t);let a=t/2,l=a;o.moveTo(t+a,l),o.lineTo(a,l+t),o.moveTo(t-a,-l),o.lineTo(-a,-l+t),o.stroke()})}createGridPattern(t,e,i,s){return this.createCommonPattern(t,e,i,s,(n,o)=>{let a=e,l=a;o.fillStyle=i,o.fillRect(a,l,n,n),o.fillRect(a+n,l+n,n,n)})}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){this.textureMap||this.initTextureMap(e,t.stage);let{texture:m=h.texture,textureColor:g=h.textureColor,textureSize:f=h.textureSize,texturePadding:_=h.texturePadding}=t.attribute;m&&this.drawTexture(m,t,e,i,s,h,g,f,_)}drawTexture(t,e,i,s,n,o,a,l,h){var d;let{textureRatio:c=o.textureRatio,textureOptions:u=null}=e.attribute,p=this.textureMap.get(t);if(!p)switch(t){case"circle":p=this.createCirclePattern(l,h,a,i);break;case"diamond":p=this.createDiamondPattern(l,h,a,i);break;case"rect":p=this.createRectPattern(l,h,a,i);break;case"vertical-line":p=this.createVerticalLinePattern(l,h,a,i);break;case"horizontal-line":p=this.createHorizontalLinePattern(l,h,a,i);break;case"bias-lr":p=this.createBiasLRLinePattern(l,h,a,i);break;case"bias-rl":p=this.createBiasRLLinePattern(l,h,a,i);break;case"grid":p=this.createGridPattern(l,h,a,i)}if(u&&u.dynamicTexture){let{gridConfig:m={},useNewCanvas:g}=u,f=e.AABBBounds;s=f.x1,n=f.y1;let _=i,v;if(g){v=pn.allocate({width:f.width(),height:f.height(),dpr:i.dpr});let L=v.getContext("2d");L.clearRect(0,0,f.width(),f.height()),s=0,n=0,i=L}if(_.save(),e.parent&&!e.transMatrix.onlyTranslate()){let{scrollX:L=0,scrollY:w=0}=e.parent.attribute;_.setTransformFromMatrix(e.parent.globalTransMatrix),_.translate(L,w,!0)}_.setCommonStyle(e,e.attribute,s,n,o),_.clip();let x=f.width(),y=f.height(),b=h,S=l,C=m.columns?m.columns:Math.ceil(x/S),k=m.rows?m.rows:Math.ceil(y/S),M=m.gutterColumn?m.gutterColumn:2*b,E=m.gutterRow?m.gutterRow:2*b;this._tempSymbolGraphic||(this._tempSymbolGraphic=_n({}));let D=m.columns?x/m.columns:S,P=m.rows?y/m.rows:S;this._tempSymbolGraphic.setAttributes({size:[D-M,P-E],symbolType:t});let B=this._tempSymbolGraphic.getParsedPath();for(let L=0;L<k;L++)for(let w=0;w<C;w++){let R=s+S/2+w*S,N=n+S/2+L*S;(d=u.beforeDynamicTexture)===null||d===void 0||d.call(u,i,L,w,k,C,c,e,f.width(),f.height()),i.beginPath(),B.draw(i,Math.min(D-M,P-E),R,N,0)===!1&&i.closePath(),i.fillStyle=a,u.dynamicTexture(i,L,w,k,C,c,e,f.width(),f.height())}g&&(_.globalAlpha=1,_.drawImage(v.nativeCanvas,0,0,v.nativeCanvas.width,v.nativeCanvas.height,f.x1,f.y1,f.width()*_.dpr,f.height()*_.dpr)),_.restore()}else if(p)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,s,n,o),i.fillStyle=p,i.fill(),i.highPerformanceRestore();else if(t==="wave"){i.save(),i.setCommonStyle(e,e.attribute,s,n,o),i.clip();let m=e.AABBBounds;NY(i,c,m.width(),m.height(),Object.assign(Object.assign({},u||{}),{fill:a}),s+m.x1-s,n+m.y1-n),i.restore()}}},Us=new zh;var pM=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){let{outerBorder:p,innerBorder:m}=t.attribute,g=p&&p.visible!==!1,f=m&&m.visible!==!1;if(!g&&!f)return;let{innerPadding:_=h.innerPadding,outerPadding:v=h.outerPadding,startAngle:x=h.startAngle,endAngle:y=h.endAngle,opacity:b=h.opacity,x:S=h.x,y:C=h.y,scaleX:k=h.scaleX,scaleY:M=h.scaleY,keepStrokeScale:E=h.keepStrokeScale}=t.attribute,{innerRadius:D=h.innerRadius,outerRadius:P=h.outerRadius}=t.attribute;P+=v,D-=_;let B=(L,w)=>{let R=!(!L||!L.stroke),{distance:N=h[w].distance}=L,z=E?N:Vi(e,N,e.dpr),Y=N/P,U=w==="outerBorder"?1:-1;if(t.setAttributes({outerRadius:P+U*z,innerRadius:D-U*z,startAngle:x-U*Y,endAngle:y+U*Y}),e.beginPath(),Vg(t,e,i,s,P+U*z,D-U*z),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),u)u(e,L,h[w]);else if(R){let $=h[w].opacity;h[w].opacity=b,e.setStrokeStyle(t,L,(S-i)/k,(C-s)/M,h[w]),h[w].opacity=$,e.stroke()}};g&&B(p,"outerBorder"),f&&B(m,"innerBorder"),t.setAttributes({outerRadius:P,innerRadius:D,startAngle:x,endAngle:y})}},yI=new pM,xI=Us,bI=Tr;var mM=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){let{outerBorder:p,innerBorder:m}=t.attribute,g=p&&p.visible!==!1,f=m&&m.visible!==!1;if(!g&&!f)return;let{radius:_=h.radius,startAngle:v=h.startAngle,endAngle:x=h.endAngle,opacity:y=h.opacity,x:b=h.x,y:S=h.y,scaleX:C=h.scaleX,scaleY:k=h.scaleY,keepStrokeScale:M=h.keepStrokeScale}=t.attribute,E=(D,P)=>{let B=!(!D||!D.stroke),{distance:L=h[P].distance}=D,w=M?L:Vi(e,L,e.dpr),R=P==="outerBorder"?1:-1;if(e.beginPath(),e.arc(i,s,_+R*w,v,x),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),u)u(e,D,h[P]);else if(B){let N=h[P].opacity;h[P].opacity=y,e.setStrokeStyle(t,D,(b-i)/C,(S-s)/k,h[P]),h[P].opacity=N,e.stroke()}};g&&E(p,"outerBorder"),f&&E(m,"innerBorder")}},SI=new mM,AI=Us,CI=Tr;var gM=class extends Qo{constructor(){super(...arguments),this.time=Ee.beforeFillStroke}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){let{background:p,backgroundMode:m=h.backgroundMode,backgroundFit:g=h.backgroundFit,backgroundKeepAspectRatio:f=h.backgroundKeepAspectRatio,backgroundScale:_=h.backgroundScale,backgroundOffsetX:v=h.backgroundOffsetX,backgroundOffsetY:x=h.backgroundOffsetY}=t.attribute;if(p)if(t.backgroundImg&&t.resources){let y=t.resources.get(p);if(y.state!=="success"||!y.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);let b=t.AABBBounds;this.doDrawImage(e,y.data,b,{backgroundMode:m,backgroundFit:g,backgroundKeepAspectRatio:f,backgroundScale:_,backgroundOffsetX:v,backgroundOffsetY:x}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=p,e.fill(),e.highPerformanceRestore()}},TI=new gM;var Rx=ge/2;function _s(r,t,e,i,s,n,o=!0,a){let l;if(Array.isArray(o)&&(a=o,o=!0),i<0&&(t+=i,i=-i),s<0&&(e+=s,s=-s),J(n,!0))l=[n=Dt(n),n,n,n];else if(Array.isArray(n)){let C=n,k,M;switch(C.length){case 0:l=[0,0,0,0];break;case 1:k=Dt(C[0]),l=[k,k,k,k];break;case 2:case 3:k=Dt(C[0]),M=Dt(C[1]),l=[k,M,k,M];break;default:l=C,l[0]=Dt(l[0]),l[1]=Dt(l[1]),l[2]=Dt(l[2]),l[3]=Dt(l[3])}}else l=[0,0,0,0];if(i<0||l[0]+l[1]+l[2]+l[3]<1e-12)return r.rect(t,e,i,s);let[h,d,c,u]=[[t,e],[t+i,e],[t+i,e+s],[t,e+s]],p=Math.min(i/2,s/2),m=[Math.min(p,l[0]),Math.min(p,l[1]),Math.min(p,l[2]),Math.min(p,l[3])],g=[h[0]+m[0],h[1]],f=[h[0],h[1]+m[0]],_=[d[0]-m[1],d[1]],v=[d[0],d[1]+m[1]],x=[c[0]-m[2],c[1]],y=[c[0],c[1]-m[2]],b=[u[0]+m[3],u[1]],S=[u[0],u[1]-m[3]];if(r.moveTo(g[0],g[1]),o){if(a&&a[0]?a[0](g[0],g[1],_[0],_[1]):r.lineTo(_[0],_[1]),!zm(_,v)){a&&a[0]&&r.moveTo(_[0],_[1]);let C=_[0],k=_[1]+m[1];r.arc(C,k,m[1],-Rx,0,!1)}if(a&&a[1]?a[1](v[0],v[1],y[0],y[1]):r.lineTo(y[0],y[1]),!zm(x,y)){let C=y[0]-m[2],k=y[1];a&&a[1]&&r.moveTo(y[0],y[1]),r.arc(C,k,m[2],0,Rx,!1)}if(a&&a[2]?a[2](x[0],x[1],b[0],b[1]):r.lineTo(b[0],b[1]),!zm(b,S)){let C=b[0],k=b[1]-m[3];a&&a[2]&&r.moveTo(b[0],b[1]),r.arc(C,k,m[3],Rx,ge,!1)}if(a&&a[3]?a[3](S[0],S[1],f[0],f[1]):r.lineTo(f[0],f[1]),!zm(g,f)){let C=g[0],k=g[1]+m[0];a&&a[3]&&r.moveTo(f[0],f[1]),r.arc(C,k,m[0],ge,ge+Rx,!1)}}else a&&a[0]?a[0](g[0],g[1],_[0],_[1]):r.lineTo(_[0],_[1]),a&&a[1]?a[1](_[0],_[1],x[0],x[1]):r.lineTo(x[0],x[1]),a&&a[2]?a[2](x[0],x[1],b[0],b[1]):r.lineTo(b[0],b[1]),a&&a[2]?a[2](b[0],b[1],g[0],g[1]):r.lineTo(g[0],g[1]);return!a&&r.closePath(),r}var kI=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},sf=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){let{outerBorder:p,innerBorder:m}=t.attribute,g=p&&p.visible!==!1,f=m&&m.visible!==!1;if(!g&&!f)return;let{cornerRadius:_=h.cornerRadius,cornerType:v=h.cornerType,opacity:x=h.opacity,x:y=h.x,y:b=h.y,scaleX:S=h.scaleX,scaleY:C=h.scaleY,x1:k,y1:M,keepStrokeScale:E=h.keepStrokeScale}=t.attribute,{width:D,height:P}=t.attribute;D=(D??k-i)||0,P=(P??M-s)||0;let B=(L,w)=>{let R=!(!L||!L.stroke),N=w==="outerBorder"?-1:1,{distance:z=h[w].distance}=L,Y=E?z:Vi(e,z,e.dpr),U=i+N*Y,$=s+N*Y,ut=2*Y;if(_===0||H(_)&&_.every(mt=>mt===0)?(e.beginPath(),e.rect(U,$,D-N*ut,P-N*ut)):(e.beginPath(),_s(e,U,$,D-N*ut,P-N*ut,_,v!=="bevel")),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),u)u(e,L,h[w]);else if(R){let mt=h[w].opacity;h[w].opacity=x,e.setStrokeStyle(t,L,(y-i)/S,(b-s)/C,h[w]),h[w].opacity=mt,e.stroke()}};g&&B(p,"outerBorder"),f&&B(m,"innerBorder")}},nf=class{constructor(){this.time=Ee.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(r,t,e,i,s,n,o,a,l,h,d,c,u){let{stroke:p=l.stroke}=r.attribute;Array.isArray(p)&&p.some(m=>m===!1)&&(u.doStroke=!1)}};nf=kI([q()],nf);var of=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(r,t,e,i,s,n,o,a,l,h,d,c){let{x1:u,y1:p,x:m=l.x,y:g=l.y,stroke:f=l.stroke,cornerRadius:_=l.cornerRadius,cornerType:v=l.cornerType}=r.attribute,{width:x,height:y}=r.attribute;if(x=(x??u-m)||0,y=(y??p-g)||0,Array.isArray(f)&&f.some(b=>b===!1)){if(t.setStrokeStyle(r,r.attribute,e,i,l),!(_===0||H(_)&&_.every(b=>b===0))){let b,S=0;return _s(t,e,i,x,y,_,v!=="bevel",new Array(4).fill(0).map((C,k)=>(M,E,D,P)=>{f[k]&&(S===k-1&&f[k]===b||(t.setStrokeStyle(r,Object.assign(Object.assign({},r.attribute),{stroke:f[k]}),e,i,l),t.beginPath(),t.moveTo(M,E),b=f[k]),S=k,t.lineTo(D,P),t.stroke(),k===3&&t.beginPath())})),void t.stroke()}if(t.beginPath(),t.moveTo(e,i),f[0]?t.lineTo(e+x,i):t.moveTo(e+x,i),f[1]?t.lineTo(e+x,i+y):t.moveTo(e+x,i+y),f[2]?t.lineTo(e,i+y):t.moveTo(e,i+y),f[3]){let b=f[0]?i-t.lineWidth/2:i;t.lineTo(e,b)}else t.moveTo(e,i);t.stroke()}}};of=kI([q()],of);var MI=new sf,DI=Us,EI=Tr;var fM=class extends sf{constructor(){super(...arguments),this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){return super.drawShape(t,e,i,s,n,o,a,l,h,d,c,u)}},wI=new fM,PI=Tr;var _M=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){let p=t.getParsedPath();if(!p)return;let{outerBorder:m,innerBorder:g}=t.attribute,f=m&&m.visible!==!1,_=g&&g.visible!==!1;if(!f&&!_)return;let{size:v=h.size,opacity:x=h.opacity,x:y=h.x,y:b=h.y,scaleX:S=h.scaleX,scaleY:C=h.scaleY,keepStrokeScale:k=h.keepStrokeScale}=t.attribute,M=(E,D)=>{let P=!(!E||!E.stroke),{distance:B=h[D].distance}=E,L=k?B:Vi(e,B,e.dpr),w=D==="outerBorder"?1:-1;if(e.beginPath(),p.drawOffset(e,v,i,s,w*L)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),u)u(e,E,h[D]);else if(P){let R=h[D].opacity;h[D].opacity=x,e.setStrokeStyle(t,E,(y-i)/S,(b-s)/C,h[D]),h[D].opacity=R,e.stroke()}};f&&M(m,"outerBorder"),_&&M(g,"innerBorder")}},vM=class{constructor(){this.time=Ee.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){let{clipRange:m=h.clipRange,x:g=h.x,y:f=h.y,z:_=h.z,size:v=h.size,scaleX:x=h.scaleX,scaleY:y=h.scaleY}=t.attribute,b=t.getParsedPath();b&&m<1&&m>0&&(e.beginPath(),b.drawWithClipRange&&b.drawWithClipRange(e,v,i,s,m,_,(S,C)=>{var k,M,E,D;if(t._parsedPath.svgCache){let P=Object.assign({},C);P.fill=(k=C.fill)!==null&&k!==void 0?k:t.attribute.fill,P.opacity=(M=C.opacity)!==null&&M!==void 0?M:t.attribute.opacity,P.fillOpacity=t.attribute.fillOpacity,P.stroke=(E=C.stroke)!==null&&E!==void 0?E:t.attribute.stroke,P.lineWidth=(D=C.lineWidth)!==null&&D!==void 0?D:t.attribute.lineWidth,C=P}C.stroke&&(u?u(e,t.attribute,h):l&&(e.setStrokeStyle(t,C,(g-i)/x,(f-s)/y,h),e.stroke()))}),o&&!b.isSvg&&(u?u(e,t.attribute,h):l&&(e.setStrokeStyle(t,t.attribute,(g-i)/x,(f-s)/y,h),e.stroke())))}},RI=new _M,BI=new vM,LI=Us,II=Tr;var Bx=class extends zh{constructor(){super(...arguments),this.time=Ee.afterFillStroke}drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p){var m,g,f,_;this.textureMap||this.initTextureMap(e,t.stage);let{attribute:v=t.attribute}=p||{},{texture:x=(m=t.attribute.texture)!==null&&m!==void 0?m:Pg(h,"texture"),textureColor:y=(g=t.attribute.textureColor)!==null&&g!==void 0?g:Pg(h,"textureColor"),textureSize:b=(f=t.attribute.textureSize)!==null&&f!==void 0?f:Pg(h,"textureSize"),texturePadding:S=(_=t.attribute.texturePadding)!==null&&_!==void 0?_:Pg(h,"texturePadding")}=v;x&&this.drawTexture(x,t,e,i,s,h,y,b,S)}};var Ai={x:0,y:0,z:0,lastModelMatrix:null},Le=class{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(_I),this.builtinContributions.push(vI),this.builtinContributions.forEach(e=>this._renderContribitions.push(e)),this._renderContribitions.length&&(this._renderContribitions.sort((e,i)=>i.order-e.order),this._beforeRenderContribitions=this._renderContribitions.filter(e=>e.time===Ee.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(e=>e.time===Ee.afterFillStroke))}beforeRenderStep(t,e,i,s,n,o,a,l,h,d,c,u,p){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(m=>{m.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(m.supportedAppName)?m.supportedAppName:[m.supportedAppName]).includes(t.stage.params.context.appName)||m.drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p)})}afterRenderStep(t,e,i,s,n,o,a,l,h,d,c,u,p){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(m=>{m.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(m.supportedAppName)?m.supportedAppName:[m.supportedAppName]).includes(t.stage.params.context.appName)||m.drawShape(t,e,i,s,n,o,a,l,h,d,c,u,p)})}drawPathProxy(t,e,i,s,n,o,a,l){if(!t.pathProxy)return!1;let h=dt(t,o?.theme)[t.type.replace("3d","")],{fill:d=h.fill,stroke:c=h.stroke,opacity:u=h.opacity,fillOpacity:p=h.fillOpacity,lineWidth:m=h.lineWidth,strokeOpacity:g=h.strokeOpacity,visible:f=h.visible,x:_=h.x,y:v=h.y}=t.attribute,x=js(u,p,d),y=Ng(u,g),b=gs(d),S=gn(c,m);if(!f||!b&&!S||!(x||y||a||l))return!0;e.beginPath();let C=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;return Lr(C.commandList,e,i,s),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,s,b,S,x,y,h,n,a,l),S&&(l?l(e,t.attribute,h):y&&(e.setStrokeStyle(t,t.attribute,i-_,s-v,h),e.stroke())),b&&(a?a(e,t.attribute,h):x&&(e.setCommonStyle(t,t.attribute,i-_,s-v,h),e.fill())),this.afterRenderStep(t,e,i,s,b,S,x,y,h,n,a,l),!0}valid(t,e,i,s){let{fill:n=e.fill,background:o,stroke:a=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:d=e.lineWidth,strokeOpacity:c=e.strokeOpacity,visible:u=e.visible}=t.attribute,p=js(l,h,n),m=Ng(l,c),g=gs(n,o),f=gn(a,d);return!(!t.valid||!u)&&!(!g&&!f)&&!!(p||m||i||s||o)&&{fVisible:p,sVisible:m,doFill:g,doStroke:f}}transform(t,e,i,s=!1){let{x:n=e.x,y:o=e.y,z:a=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:d=e.angle,postMatrix:c}=t.attribute,u=i.modelMatrix,p=i.camera;Ai.x=n,Ai.y=o,Ai.z=a,Ai.lastModelMatrix=u;let m=p&&(s||tI(t)),g=m?t.transMatrix.onlyTranslate()&&!c:l===1&&h===1&&d===0&&!c;if(m){let f=Fe.allocate(),_=Fe.allocate();Cx(_,t,e),fn(f,u||f,_),Ai.x=0,Ai.y=0,Ai.z=0,i.modelMatrix=f,i.setTransform(1,0,0,1,0,0,!0),Fe.free(_)}if(g&&!u){let f=t.getOffsetXY(e);Ai.x+=f.x,Ai.y+=f.y,Ai.z=a,i.setTransformForCurrent()}else if(m)Ai.x=0,Ai.y=0,Ai.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(p&&i.project){let f=t.getOffsetXY(e);Ai.x+=f.x,Ai.y+=f.y,this.transformWithoutTranslate(i,Ai.x,Ai.y,Ai.z,l,h,d)}else i.transformFromMatrix(t.transMatrix,!0),Ai.x=0,Ai.y=0,Ai.z=0;return Ai}transformUseContext2d(t,e,i,s){let n=s.camera;if(this.camera=n,n){let o=t.AABBBounds,a=o.x2-o.x1,l=o.y2-o.y1,h=s.project(0,0,i),d=s.project(a,0,i),c=s.project(a,l,i),u={x:0,y:0},p={x:a,y:0},m={x:a,y:l};s.camera=null;let g=1/(u.x*(m.y-p.y)-p.x*m.y+m.x*p.y+(p.x-m.x)*u.y),f=-(u.y*(c.x-d.x)-p.y*c.x+m.y*d.x+(p.y-m.y)*h.x)*g,_=(p.y*c.y+u.y*(d.y-c.y)-m.y*d.y+(m.y-p.y)*h.y)*g,v=(u.x*(c.x-d.x)-p.x*c.x+m.x*d.x+(p.x-m.x)*h.x)*g,x=-(p.x*c.y+u.x*(d.y-c.y)-m.x*d.y+(m.x-p.x)*h.y)*g,y=(u.x*(m.y*d.x-p.y*c.x)+u.y*(p.x*c.x-m.x*d.x)+(m.x*p.y-p.x*m.y)*h.x)*g,b=(u.x*(m.y*d.y-p.y*c.y)+u.y*(p.x*c.y-m.x*d.y)+(m.x*p.y-p.x*m.y)*h.y)*g;s.setTransform(f,_,v,x,y,b,!0)}}restoreTransformUseContext2d(t,e,i,s){this.camera&&(s.camera=this.camera)}transformWithoutTranslate(t,e,i,s,n,o,a){let l=t.project(e,i,s);t.translate(l.x,l.y,!1),t.scale(n,o,!1),t.rotate(a,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,s,n){let{context:o}=s;if(!o)return;let{renderable:a}=t.attribute;if(a===!1)return;o.highPerformanceSave();let l=this.transform(t,e,o,i),{x:h,y:d,z:c,lastModelMatrix:u}=l;this.z=c,this.drawPathProxy(t,o,h,d,s,n)||(this.drawShape(t,o,h,d,s,n),this.z=0,o.modelMatrix!==u&&Fe.free(o.modelMatrix),o.modelMatrix=u),o.highPerformanceRestore()}};var VY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},jY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},FI=function(r,t){return function(e,i){t(e,i,r)}},af=class extends Le{constructor(r){super(),this.arcRenderContribitions=r,this.numberType=tl,this.builtinContributions=[yI,bI,xI],this.init(r)}drawArcTailCapPath(r,t,e,i,s,n,o,a){let l=a-o,h=r.getParsedAngle(),d=h.startAngle,c=h.endAngle;c=a,Dt(c-d);let u=c>d,p=!1;if(s<n){let N=s;s=n,n=N}let{outerDeltaAngle:m,xors:g,yors:f,xirs:_,yirs:v,limitedOcr:x,outerCornerRadiusStart:y,outerCornerRadiusEnd:b,maxOuterCornerRadius:S,xore:C,yore:k,xire:M,yire:E,limitedIcr:D,innerDeltaAngle:P,innerStartAngle:B,innerCornerRadiusStart:L,innerCornerRadiusEnd:w,maxInnerCornerRadius:R}=Zk(r,d,c,n,s);if(x>1e-12){let N=Ge(y,x),z=Ge(b,x),Y=Zo(_,v,g,f,s,N,Number(u)),U=Zo(C,k,M,E,s,z,Number(u));if(x<S&&N===z)t.moveTo(e+Y.cx+Y.x01,i+Y.cy+Y.y01),t.arc(e+Y.cx,i+Y.cy,x,ae(Y.y01,Y.x01),ae(U.y01,U.x01),!u);else{let $=c-l-.03,ut=ae(U.y11,U.x11);t.arc(e,i,s,$,ut,!u),z>0&&t.arc(e+U.cx,i+U.cy,z,ae(U.y11,U.x11),ae(U.y01,U.x01),!u)}}else t.moveTo(e+g,i+f);if(!(n>1e-12)||P<.001)t.lineTo(e+M,i+E),p=!0;else if(D>1e-12){let N=Ge(L,D),z=Ge(w,D),Y=Zo(M,E,C,k,n,-z,Number(u)),U=Zo(g,f,_,v,n,-N,Number(u));if(t.lineTo(e+Y.cx+Y.x01,i+Y.cy+Y.y01),D<R&&N===z){let $=ae(U.y01,U.x01);t.arc(e+Y.cx,i+Y.cy,D,ae(Y.y01,Y.x01),$,!u)}else{z>0&&t.arc(e+Y.cx,i+Y.cy,z,ae(Y.y01,Y.x01),ae(Y.y11,Y.x11),!u);let $=ae(Y.cy+Y.y11,Y.cx+Y.x11),ut=c-l-.03;t.arc(e,i,n,$,ut,u)}}else t.lineTo(e+n*Ce(B),i+n*ce(B));return p}drawShape(r,t,e,i,s,n,o,a){let l=dt(r,n?.theme).arc,{fill:h=l.fill,stroke:d=l.stroke,x:c=l.x,y:u=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=r.attribute,m=this.valid(r,l,o,a);if(!m)return;let{fVisible:g,sVisible:f,doFill:_,doStroke:v}=m,{outerPadding:x=l.outerPadding,innerPadding:y=l.innerPadding,cap:b=l.cap,forceShowCap:S=l.forceShowCap}=r.attribute,{outerRadius:C=l.outerRadius,innerRadius:k=l.innerRadius}=r.attribute;C+=x,k-=y;let M=0,E=(te(b)&&b||b[0])&&h.gradient==="conical";if(E){let{sc:L,startAngle:w,endAngle:R}=r.getParsedAngle();Dt(R-w)<vt-1e-12&&(M=L||0,h.startAngle-=M,h.endAngle-=M)}let D=!1,{isFullStroke:P,stroke:B}=RB(d);if(_||P){t.beginPath(),Vg(r,t,e,i,C,k),D=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l),this.beforeRenderStep(r,t,e,i,_,v,g,f,l,s,o,a);let L=()=>{_&&(o?o(t,r.attribute,l):g&&(t.setCommonStyle(r,r.attribute,c-e,u-i,l),t.fill()))},w=()=>{v&&P&&(a?a(t,r.attribute,l):f&&(t.setStrokeStyle(r,r.attribute,c-e,u-i,l),t.stroke()))};p?(w(),L()):(L(),w())}if(!P&&v&&(t.beginPath(),Vg(r,t,e,i,C,k,B),D||this.beforeRenderStep(r,t,e,i,_,v,g,f,l,s,o,a),a?a(t,r.attribute,l):f&&(t.setStrokeStyle(r,r.attribute,e,i,l),t.stroke())),(te(b)&&b||b[1])&&S){let{startAngle:L,endAngle:w}=r.getParsedAngle();if(Dt(w-L)>=vt-1e-12){t.beginPath();let R=Math.abs(C-k)/2/C,{endAngle:N=l.endAngle,fill:z=l.fill}=r.attribute,Y=N;this.drawArcTailCapPath(r,t,e,i,C,k,Y,Y+R),D||this.beforeRenderStep(r,t,e,i,_,v,g,f,l,s,o,a);let U=()=>{if(_){let ut=z;if(ut.gradient==="conical"){let mt=XL(0,0,N,ut);o||js&&(t.setCommonStyle(r,r.attribute,e,i,l),t.fillStyle=mt,t.fill())}}},$=()=>{v&&(a||f&&(t.setStrokeStyle(r,r.attribute,e,i,l),t.stroke()))};U(),$()}}this.afterRenderStep(r,t,e,i,_,v,g,f,l,s,o,a),E&&(h.startAngle+=M,h.endAngle+=M)}draw(r,t,e,i){let s=dt(r,i?.theme).arc;this._draw(r,s,!1,e,i)}};af=VY([q(),FI(0,lt($t)),FI(0,Zt(jg)),jY("design:paramtypes",[Object])],af);var zY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},GY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},OI=function(r,t){return function(e,i){t(e,i,r)}},lf=class extends Le{constructor(r){super(),this.circleRenderContribitions=r,this.numberType=el,this.builtinContributions=[SI,CI,AI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){let l=dt(r,n?.theme).circle,{radius:h=l.radius,startAngle:d=l.startAngle,endAngle:c=l.endAngle,x:u=l.x,y:p=l.y,fillStrokeOrder:m=l.fillStrokeOrder}=r.attribute,g=this.valid(r,l,o,a);if(!g)return;let{fVisible:f,sVisible:_,doFill:v,doStroke:x}=g;t.beginPath(),t.arc(e,i,h,d,c),t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l),this.beforeRenderStep(r,t,e,i,v,x,f,_,l,s,o,a);let y=()=>{v&&(o?o(t,r.attribute,l):f&&(t.setCommonStyle(r,r.attribute,u-e,p-i,l),t.fill()))},b=()=>{x&&(a?a(t,r.attribute,l):_&&(t.setStrokeStyle(r,r.attribute,u-e,p-i,l),t.stroke()))};m?(b(),y()):(y(),b()),this.afterRenderStep(r,t,e,i,v,x,f,_,l,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).circle;this._draw(r,s,!1,e,i)}};lf=zY([q(),OI(0,lt($t)),OI(0,Zt(Gg)),GY("design:paramtypes",[Object])],lf);function Qc(r,t,e,i){if(!t.p1)return;let{offsetX:s=0,offsetY:n=0,offsetZ:o=0}=i||{};if(e===1)t.p2&&t.p3?r.bezierCurveTo(s+t.p1.x,n+t.p1.y,s+t.p2.x,n+t.p2.y,s+t.p3.x,n+t.p3.y,o):r.lineTo(s+t.p1.x,n+t.p1.y,o);else if(t.p2&&t.p3){let[a]=Eh(t,e);r.bezierCurveTo(s+a.p1.x,n+a.p1.y,s+a.p2.x,n+a.p2.y,s+a.p3.x,n+a.p3.y,o)}else{let a=t.getPointAt(e);r.lineTo(s+a.x,n+a.y,o)}}function HI(r,t,e,i,s,n,o){var a;let l=t.p0,h=i;if(e&&e.originP1===e.originP2&&(l=e.p0),t.defined)i||(r.lineTo(l.x+s,l.y+n,o),h=!i);else{let{originP1:d,originP2:c}=t,u;if(d&&d.defined!==!1&&!e?u=l:d&&c.defined!==!1&&(u=(a=t.p3)!==null&&a!==void 0?a:t.p1),i){h=!i;let p=u?u.x:t.p0.x,m=u?u.y:t.p0.y;r.moveTo(p+s,m+n,o)}else u&&(h=!i,r.lineTo(u.x+s,u.y+n,o))}return h}function Lx(r,t,e,i,s){let{offsetX:n=0,offsetY:o=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=s||{};if(h&&l==="none"||!t)return;let d=!0,{curves:c}=t;if(e>=1){if(h){let _,v=!0;c.forEach((x,y)=>{x.originP1!==x.originP2&&(v=HI(r,x,_,v,n,o,a)),_=x})}else c.forEach(_=>{_.defined?(d&&r.moveTo(_.p0.x+n,_.p0.y+o,a),Qc(r,_,1,s),d=!1):d=!0});return}if(e<=0)return;let u;i==="x"?u=se.ROW:i==="y"?u=se.COLUMN:i==="auto"&&(u=t.direction);let p=e*t.tryUpdateLength(u),m=0,g=!0,f=null;for(let _=0,v=c.length;_<v;_++){let x=c[_],y=x.getLength(u),b=(p-m)/y;if(m+=y,b<0)break;if(h){if(x.originP1===x.originP2){f=x;continue}g=HI(r,x,f,g,n,o,a),f=x}else{if(!x.defined){d=!0;continue}d&&r.moveTo(x.p0.x+n,x.p0.y+o,a),Qc(r,x,Ge(b,1),s),d=!1}}}function NI(r,t,e,i){let{offsetX:s=0,offsetY:n=0}=i||{},o=t?t.points[t.points.length-1]:e.points[0];r.moveTo(o.x+s,o.y+n),e.points.forEach(a=>{a.defined!==!1?r.lineTo(a.x+s,a.y+n):r.moveTo(a.x+s,a.y+n)})}function VI(r,t,e,i){let{offsetX:s=0,offsetY:n=0}=i||{},{points:o}=e,a=[],l=0;for(let h=0;h<o.length;h++)o[h].defined===!1&&(l+1!==h&&a.slice(l,h),l=h);a.length,a.push(o),a.forEach((h,d)=>{var c,u,p,m;let g=t&&d===0?t.points[t.points.length-1]:h[0];r.moveTo(g.x+s,g.y+n),h.forEach(f=>{f.defined!==!1?r.lineTo(f.x+s,f.y+n):r.moveTo(f.x+s,f.y+n)});for(let f=h.length-1;f>=0;f--){let _=h[f];r.lineTo((c=_.x1)!==null&&c!==void 0?c:_.x,(u=_.y1)!==null&&u!==void 0?u:_.y)}r.lineTo((p=g.x1)!==null&&p!==void 0?p:g.x,(m=g.y1)!==null&&m!==void 0?m:g.y),r.closePath()})}var UY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Gh=class extends Le{constructor(){super(...arguments),this.numberType=co}draw(r,t,e,i){let s=dt(r,i?.theme).line;this._draw(r,s,!1,e,i)}drawSegmentItem(r,t,e,i,s,n,o,a,l,h,d,c,u,p,m){var g;if(!t)return;r.beginPath();let f=(g=this.z)!==null&&g!==void 0?g:0;Lx(r.camera?r:r.nativeContext,t,l,h,{offsetX:d,offsetY:c,offsetZ:f}),u.cache&&!H(u.cache)&&u.cache.curves.every(x=>x.defined)&&u.attribute.curveType&&u.attribute.curveType.includes("Closed")&&r.closePath(),r.setShadowBlendStyle&&r.setShadowBlendStyle(u,o,a);let{x:_=0,x:v=0}=o;return e!==!1&&(p?p(r,o,a):s&&(r.setCommonStyle(u,o,_-d,v-c,a),r.fill())),i!==!1&&(m?m(r,o,a):n&&(r.setStrokeStyle(u,o,_-d,v-c,a),r.stroke())),!1}drawLinearLineHighPerformance(r,t,e,i,s,n,o,a,l,h,d,c,u){var p;t.beginPath();let m=(p=this.z)!==null&&p!==void 0?p:0,{points:g}=r.attribute,f=g[0];t.moveTo(f.x+o,f.y+a,m);for(let x=1;x<g.length;x++){let y=g[x];t.lineTo(y.x+o,y.y+a,m)}t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l);let{x:_=0,x:v=0}=r.attribute;e!==!1&&(c?c(t,r.attribute,l):s&&(t.setCommonStyle(r,r.attribute,_-o,v-a,l),t.fill())),i!==!1&&(u?u(t,r.attribute,l):n&&(t.setStrokeStyle(r,r.attribute,_-o,v-a,l),t.stroke()))}drawShape(r,t,e,i,s,n,o,a){let l=dt(r,n?.theme).line,{fill:h=l.fill,stroke:d=l.stroke,fillOpacity:c=l.fillOpacity,strokeOpacity:u=l.strokeOpacity,segments:p,points:m,closePath:g,curveTension:f=l.curveTension,connectedType:_=l.connectedType}=r.attribute;if(!this.valid(r,l,o,a))return;let{curveType:v=l.curveType}=r.attribute;g&&v==="linear"&&(v="linearClosed");let{clipRange:x=l.clipRange,clipRangeByDimension:y=l.clipRangeByDimension}=r.attribute;if(x===1&&!p&&!m.some(S=>S.defined===!1)&&v==="linear")return this.drawLinearLineHighPerformance(r,t,!!h,!!d,c,u,e,i,l,s,n,o,a);function b(S,C){return C==="none"?S:S.filter(k=>k.defined!==!1)}if(r.shouldUpdateShape()){let{points:S,segments:C}=r.attribute,k=S;if(C&&C.length){let M,E;if(r.cache=C.map((D,P)=>{if(D.points.length<=1&&P===0)return D.points[0]&&(E={endX:D.points[0].x,endY:D.points[0].y,curves:[{defined:D.points[0].defined!==!1}]}),null;P===1?M={x:E.endX,y:E.endY,defined:E.curves[E.curves.length-1].defined}:P>1&&(M.x=E.endX,M.y=E.endY,M.defined=E.curves[E.curves.length-1].defined);let B=ro(b(D.points,_),v,{startPoint:M,curveTension:f});return E=B,B}).filter(D=>!!D),v==="linearClosed"){let D;for(let P=0;P<r.cache.length;P++){let B=r.cache[P];for(let L=0;L<B.curves.length;L++)if(B.curves[L].defined){D=B.curves[L].p0;break}if(D)break}r.cache[r.cache.length-1]&&r.cache[r.cache.length-1].lineTo(D.x,D.y,!0)}}else{if(!S||!S.length)return r.cache=null,void r.clearUpdateShapeTag();r.cache=ro(b(k,_),v,{curveTension:f})}r.clearUpdateShapeTag()}if(Array.isArray(r.cache)){let S=r.attribute.segments.filter(C=>C.points.length);if(S[0].points.length===1&&S.shift(),x===1){let C=!1;r.cache.forEach((k,M)=>{C||(C=this.drawSegmentItem(t,k,!!h,!!d,c,u,S[M],[l,r.attribute],x,y,e,i,r,o,a))})}else{let C=r.cache.reduce((D,P)=>D+P.getLength(),0),k=x*C,M=0,E=!1;r.cache.forEach((D,P)=>{if(E)return;let B=D.getLength(),L=(k-M)/B;M+=B,L>0&&(E=this.drawSegmentItem(t,D,!!h,!!d,c,u,S[P],[l,r.attribute],Ge(L,1),y,e,i,r,o,a))})}}else this.drawSegmentItem(t,r.cache,!!h,!!d,c,u,r.attribute,l,x,y,e,i,r,o,a)}};Gh=UY([q()],Gh);function jI(r,t,e,i){var s;let{top:n,bottom:o}=t;if(n.curves.length!==o.curves.length)return;if(e>=1){let _=[],v=[],x=!0;for(let y=0,b=n.curves.length;y<b;y++){let S=n.curves[y];x!==S.defined?(x?(Ix(r,_,v,i),_.length=0,v.length=0):(_.push(S),v.push(o.curves[b-y-1])),x=!x):x&&(_.push(S),v.push(o.curves[b-y-1]))}return void Ix(r,_,v,i)}if(e<=0)return;let{direction:a}=i||{},{curves:l}=n,h=(s=l[l.length-1].p3)!==null&&s!==void 0?s:l[l.length-1].p1,d=Dt(h.x-l[0].p0.x),c=Dt(h.y-l[0].p0.y);a=a??(d>c?se.ROW:se.COLUMN),Number.isFinite(d)||(a=se.COLUMN),Number.isFinite(c)||(a=se.ROW);let u=e*(a===se.ROW?d:c),p=0,m=!0,g=[],f=[];for(let _=0,v=n.curves.length;_<v;_++){let x=n.curves[_],y=x.getLength(a),b=(u-p)/y;if(b<0)break;p+=y;let S=null,C=null;m!==x.defined?(m?(Ix(r,g,f,i),g.length=0,f.length=0):(S=x,C=o.curves[v-_-1]),m=!m):m&&(S=x,C=o.curves[v-_-1]),S&&C&&(b<1&&(S=S.p2&&S.p3?Eh(S,b)[0]:ek(S,b)[0],C=C.p2&&C.p3?Eh(C,1-b)[1]:ek(C,1-b)[1]),S.defined=m,C.defined=m,g.push(S),f.push(C)),S=null,C=null}Ix(r,g,f,i)}function Ix(r,t,e,i){let{offsetX:s=0,offsetY:n=0,offsetZ:o=0}=i||{},a=!0;t.forEach(l=>{l.defined?(a&&r.moveTo(l.p0.x+s,l.p0.y+n,o),Qc(r,l,1,i),a=!1):a=!0}),a=!0;for(let l=e.length-1;l>=0;l--){let h=e[l];h.defined?(a&&r.lineTo(h.p0.x+s,h.p0.y+n,o),Qc(r,h,1,i),a=!1):a=!0}r.closePath()}var zI=new Bx,GI=Tr;var WY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},YY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},UI=function(r,t){return function(e,i){t(e,i,r)}},Uh=class extends Le{constructor(r){super(),this.areaRenderContribitions=r,this.numberType=ho,this.builtinContributions=[zI,GI],this.init(r)}drawLinearAreaHighPerformance(r,t,e,i,s,n,o,a,l,h,d,c,u){var p,m,g;let{points:f}=r.attribute;if(f.length<2)return;t.beginPath();let _=(p=this.z)!==null&&p!==void 0?p:0,v=f[0];t.moveTo(v.x+o,v.y+a,_);for(let b=1;b<f.length;b++){let S=f[b];t.lineTo(S.x+o,S.y+a,_)}for(let b=f.length-1;b>=0;b--){let S=f[b];t.lineTo(((m=S.x1)!==null&&m!==void 0?m:S.x)+o,((g=S.y1)!==null&&g!==void 0?g:S.y)+a,_)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l),this.beforeRenderStep(r,t,o,a,!!s,!1,e,!1,l,h,c,null,{attribute:r.attribute});let{x=0,x:y=0}=r.attribute;e!==!1&&(c?c(t,r.attribute,l):s&&(t.setCommonStyle(r,r.attribute,x-o,y-a,l),t.fill())),this.afterRenderStep(r,t,o,a,!!s,!1,e,!1,l,h,c,null,{attribute:r.attribute}),(()=>{var b,S;if(i){let{stroke:C=l&&l.stroke}=r.attribute;if(H(C)&&(C[0]||C[2])&&C[1]===!1){if(t.beginPath(),C[0]){t.moveTo(v.x+o,v.y+a,_);for(let k=1;k<f.length;k++){let M=f[k];t.lineTo(M.x+o,M.y+a,_)}}else if(C[2]){let k=f[f.length-1];t.moveTo(k.x+o,k.y+a,_);for(let M=f.length-2;M>=0;M--){let E=f[M];t.lineTo(((b=E.x1)!==null&&b!==void 0?b:E.x)+o,((S=E.y1)!==null&&S!==void 0?S:E.y)+a,_)}}}u?u(t,r.attribute,l):(t.setStrokeStyle(r,r.attribute,x-o,y-a,l),t.stroke())}})()}drawShape(r,t,e,i,s,n,o,a){var l,h,d,c,u,p;let m=dt(r,n?.theme).area,{fill:g=m.fill,stroke:f=m.stroke,fillOpacity:_=m.fillOpacity,z:v=m.z,strokeOpacity:x=m.strokeOpacity,curveTension:y=m.curveTension,connectedType:b=m.connectedType}=r.attribute,S=this.valid(r,m,o,a);if(!S)return;let{doFill:C}=S,k=S.doStroke&&S.sVisible,{clipRange:M=m.clipRange,closePath:E,points:D,segments:P}=r.attribute,{curveType:B=m.curveType}=r.attribute;function L(w,R){return R!=="connect"?w:w.filter(N=>N.defined!==!1)}if(E&&B==="linear"&&(B="linearClosed"),M===1&&!P&&!D.some(w=>w.defined===!1)&&B==="linear")return this.drawLinearAreaHighPerformance(r,t,!!g,k,_,x,e,i,m,s,n,o,a);if(r.shouldUpdateShape()){if(P&&P.length){let w,R,N=P.map((U,$)=>{if(U.points.length<=1&&$===0)return U.points[0]&&(R={endX:U.points[0].x,endY:U.points[0].y}),null;$===1?w={x:R.endX,y:R.endY}:$>1&&(w.x=R.endX,w.y=R.endY);let ut=ro(L(U.points,b),B,{startPoint:w,curveTension:y});return R=ut,ut}).filter(U=>!!U),z,Y=[];for(let U=P.length-1;U>=0;U--){let $=P[U].points,ut=[];for(let mt=$.length-1;mt>=0;mt--)ut.push({x:(l=$[mt].x1)!==null&&l!==void 0?l:$[mt].x,y:(h=$[mt].y1)!==null&&h!==void 0?h:$[mt].y});if(U!==0){let mt=P[U-1].points,bt=mt[mt.length-1];bt&&ut.push({x:(d=bt.x1)!==null&&d!==void 0?d:bt.x,y:(c=bt.y1)!==null&&c!==void 0?c:bt.y})}ut.length>1&&(z=ro(L(ut,b),B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:y}),Y.unshift(z))}r.cacheArea=Y.map((U,$)=>({top:N[$],bottom:U}))}else{if(!D||!D.length)return r.cacheArea=null,void r.clearUpdateShapeTag();{let w=L(D,b),R=[];for(let Y=w.length-1;Y>=0;Y--)R.push({x:(u=w[Y].x1)!==null&&u!==void 0?u:w[Y].x,y:(p=w[Y].y1)!==null&&p!==void 0?p:w[Y].y});let N=ro(w,B,{curveTension:y}),z=ro(R,B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:y});r.cacheArea={top:N,bottom:z}}}r.clearUpdateShapeTag()}if(Array.isArray(r.cacheArea)){let w=r.attribute.segments.filter(R=>R.points.length);if(w[0].points.length===1&&w.shift(),M===1){let R=!1;r.cacheArea.forEach((N,z)=>{R||(R=this.drawSegmentItem(t,N,C,_,k,x,w[z],[m,r.attribute],M,e,i,v,r,s,o,a))})}else{let R=r.cacheArea.reduce((U,$)=>U+$.top.getLength(),0),N=M*R,z=0,Y=!1;r.cacheArea.forEach((U,$)=>{if(Y)return;let ut=U.top.getLength(),mt=(N-z)/ut;z+=ut,mt>0&&(Y=this.drawSegmentItem(t,U,C,_,k,x,w[$],[m,r.attribute],Ge(mt,1),e,i,v,r,s,o,a))})}}else this.drawSegmentItem(t,r.cacheArea,C,_,k,x,r.attribute,m,M,e,i,v,r,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).area;this._draw(r,s,!1,e,i)}drawSegmentItem(r,t,e,i,s,n,o,a,l,h,d,c,u,p,m,g){return this._drawSegmentItem(r,t,e,i,s,n,o,a,l,h,d,c,u,p,m,g)}_drawSegmentItem(r,t,e,i,s,n,o,a,l,h,d,c,u,p,m,g){if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;r.beginPath();let{points:f,segments:_}=u.attribute,v,x,y=se.ROW;if(_){let M=_[_.length-1];x=_[0].points[0],v=M.points[M.points.length-1]}else x=f[0],v=f[f.length-1];let b=Dt(v.x-x.x),S=Dt(v.y-x.y);y=v.x1==null?se.ROW:v.y1==null?se.COLUMN:Number.isFinite(b+S)?b>S?se.ROW:se.COLUMN:se.ROW,jI(r.camera?r:r.nativeContext,t,l,{offsetX:h,offsetY:d,offsetZ:c,direction:y}),this.beforeRenderStep(u,r,h,d,!!i,!1,e,!1,a,p,m,null,{attribute:o}),r.setShadowBlendStyle&&r.setShadowBlendStyle(u,o,a);let{x:C=0,x:k=0}=o;return e!==!1&&(m?m(r,o,a):i&&(r.setCommonStyle(u,o,C-h,k-d,a),r.fill())),this.afterRenderStep(u,r,h,d,!!i,!1,e,!1,a,p,m,null,{attribute:o}),(()=>{if(s!==!1)if(g)g(r,o,a);else{let{stroke:M=a&&a[1]&&a[1].stroke}=o;H(M)&&(M[0]||M[2])&&M[1]===!1&&(r.beginPath(),Lx(r.camera?r:r.nativeContext,M[0]?t.top:t.bottom,l,y===se.ROW?"x":"y",{offsetX:h,offsetY:d,offsetZ:c})),r.setStrokeStyle(u,o,C-h,k-d,a),r.stroke()}})(),!1}};Uh=WY([q(),UI(0,lt($t)),UI(0,Zt(zg)),YY("design:paramtypes",[Object])],Uh);var WI=Us,YI=Tr;var XY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},KY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},XI=function(r,t){return function(e,i){t(e,i,r)}},hf=class extends Le{constructor(r){super(),this.pathRenderContribitions=r,this.numberType=rl,this.builtinContributions=[YI,WI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){var l,h,d;let c=(l=this.tempTheme)!==null&&l!==void 0?l:dt(r,n?.theme).path,{x:u=c.x,y:p=c.y,fillStrokeOrder:m=c.fillStrokeOrder}=r.attribute,g=(h=this.z)!==null&&h!==void 0?h:0,f=this.valid(r,c,o,a);if(!f)return;let{fVisible:_,sVisible:v,doFill:x,doStroke:y}=f;if(t.beginPath(),r.pathShape)Lr(r.pathShape.commandList,t,e,i,1,1,g);else{let C=(d=r.attribute.path)!==null&&d!==void 0?d:c.path;Lr(C.commandList,t,e,i,1,1,g)}t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,c),this.beforeRenderStep(r,t,e,i,x,y,_,v,c,s,o,a);let b=()=>{y&&(a?a(t,r.attribute,c):v&&(t.setStrokeStyle(r,r.attribute,u-e,p-i,c),t.stroke()))},S=()=>{x&&(o?o(t,r.attribute,c):_&&(t.setCommonStyle(r,r.attribute,u-e,p-i,c),t.fill()))};m?(b(),S()):(S(),b()),this.afterRenderStep(r,t,e,i,x,y,_,v,c,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).path;this.tempTheme=s,this._draw(r,s,!1,e,i),this.tempTheme=null}};hf=XY([q(),XI(0,lt($t)),XI(0,Zt(Wg)),KY("design:paramtypes",[Object])],hf);var $Y=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},qY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},KI=function(r,t){return function(e,i){t(e,i,r)}},df=class extends Le{constructor(r){super(),this.rectRenderContribitions=r,this.type="rect",this.numberType=Hc,this.builtinContributions=[MI,EI,DI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){var l;let h=(l=this.tempTheme)!==null&&l!==void 0?l:dt(r,n?.theme).rect,{fill:d=h.fill,background:c,stroke:u=h.stroke,cornerRadius:p=h.cornerRadius,cornerType:m=h.cornerType,opacity:g=h.opacity,fillOpacity:f=h.fillOpacity,lineWidth:_=h.lineWidth,strokeOpacity:v=h.strokeOpacity,visible:x=h.visible,x1:y,y1:b,x:S=h.x,y:C=h.y,fillStrokeOrder:k=h.fillStrokeOrder}=r.attribute,{width:M,height:E}=r.attribute;M=(M??y-S)||0,E=(E??b-C)||0;let D=zc(g,f,M,E,d),P=Gc(g,v,M,E),B=gs(d,c),L=gn(u,_);if(!r.valid||!x||!B&&!L||!(D||P||o||a||c))return;p===0||H(p)&&p.every(z=>z===0)?(t.beginPath(),t.rect(e,i,M,E)):(t.beginPath(),_s(t,e,i,M,E,p,m!=="bevel"));let w={doFill:B,doStroke:L};t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,h),this.beforeRenderStep(r,t,e,i,B,L,D,P,h,s,o,a,w);let R=()=>{w.doFill&&(o?o(t,r.attribute,h):D&&(t.setCommonStyle(r,r.attribute,S-e,C-i,h),t.fill()))},N=()=>{w.doStroke&&(a?a(t,r.attribute,h):P&&(t.setStrokeStyle(r,r.attribute,S-e,C-i,h),t.stroke()))};k?(N(),R()):(R(),N()),this.afterRenderStep(r,t,e,i,B,L,D,P,h,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).rect;this.tempTheme=s,this._draw(r,s,!1,e,i),this.tempTheme=null}};df=$Y([q(),KI(0,lt($t)),KI(0,Zt(Hh)),qY("design:paramtypes",[Object])],df);var ZY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},JY=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},$I=function(r,t){return function(e,i){t(e,i,r)}},cf=class extends Le{constructor(r){super(),this.symbolRenderContribitions=r,this.numberType=nl,this.builtinContributions=[RI,II,LI,BI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){var l;let h=dt(r,n?.theme).symbol,{size:d=h.size,x:c=h.x,y:u=h.y,scaleX:p=h.scaleX,scaleY:m=h.scaleY,fillStrokeOrder:g=h.fillStrokeOrder,clipRange:f=h.clipRange}=r.attribute,_=this.valid(r,h,o,a);if(!_)return;let{fVisible:v,sVisible:x,doFill:y,doStroke:b}=_,S=r.getParsedPath();if(!S)return;let{keepDirIn3d:C=h.keepDirIn3d}=r.attribute,k=(l=this.z)!==null&&l!==void 0?l:0;t.beginPath();let M=d,E=e,D=i,P=k,B=t.camera;if(C&&B&&t.project){let R=t.project(e,i,k);t.camera=null,M=H(d)?[d[0]*p,d[1]*m]:d*p,E=R.x,D=R.y,P=void 0}S.draw(t,d,E,D,P,(R,N)=>{var z,Y,U,$;if(r._parsedPath.svgCache){let bt=Object.assign({},N);bt.fill=(z=N.fill)!==null&&z!==void 0?z:r.attribute.fill,bt.opacity=(Y=N.opacity)!==null&&Y!==void 0?Y:r.attribute.opacity,bt.fillOpacity=r.attribute.fillOpacity,bt.stroke=(U=N.stroke)!==null&&U!==void 0?U:r.attribute.stroke,bt.lineWidth=($=N.lineWidth)!==null&&$!==void 0?$:r.attribute.lineWidth,N=bt}let ut=()=>{N.fill&&(o?o(t,r.attribute,h):(t.setCommonStyle(r,N,c-e,u-i,h),t.fill()))},mt=()=>{N.stroke&&(a?a(t,r.attribute,h):x&&f>=1&&(t.setStrokeStyle(r,N,(c-e)/p,(u-i)/m,h),t.stroke()))};g?(mt(),ut()):(ut(),mt())})===!1&&t.closePath(),t.camera=B,t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,h),this.beforeRenderStep(r,t,e,i,y,b,v,x,h,s,o,a);let L=()=>{y&&!S.isSvg&&(o?o(t,r.attribute,h):v&&(t.setCommonStyle(r,r.attribute,c-e,u-i,h),t.fill()))},w=()=>{b&&!S.isSvg&&(a?a(t,r.attribute,h):x&&f>=1&&(t.setStrokeStyle(r,r.attribute,(c-e)/p,(u-i)/m,h),t.stroke()))};g?(w(),L()):(L(),w()),this.afterRenderStep(r,t,e,i,y,b,v,x,h,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).symbol;this._draw(r,s,!1,e,i)}};cf=ZY([q(),$I(0,lt($t)),$I(0,Zt(Xg)),JY("design:paramtypes",[Object])],cf);var u1t=Symbol.for("BoundsAllocate"),yM=class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new ie)}allocate(t,e,i,s){if(!this.pools.length)return new ie().setValue(t,e,i,s);let n=this.pools.pop();return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}allocateByObj(t){if(!this.pools.length)return new ie(t);let e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},tu=new yM;var xM=class extends Qo{constructor(){super(...arguments),this.time=Ee.beforeFillStroke}drawShape(t,e,i,s,n,o,a,l,h,d,c,u){var p,m,g,f,_,v,x,y,b,S;let{backgroundMode:C=h.backgroundMode,backgroundFit:k=h.backgroundFit,backgroundKeepAspectRatio:M=h.backgroundKeepAspectRatio}=t.attribute,E,{background:D}=t.attribute;if(!D)return;let P=()=>{t.type==="richtext"&&(e.restore(),e.save(),E&&e.setTransformFromMatrix(E,!0,1))},B;t.type==="richtext"&&(E=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());let L=ct(D)&&D.background,w=t.transMatrix.onlyTranslate();if(L){let R=t.AABBBounds,N=((p=D.x)!==null&&p!==void 0?p:R.x1)+((m=D.dx)!==null&&m!==void 0?m:0),z=((g=D.y)!==null&&g!==void 0?g:R.y1)+((f=D.dy)!==null&&f!==void 0?f:0),Y=(_=D.width)!==null&&_!==void 0?_:R.width(),U=(v=D.height)!==null&&v!==void 0?v:R.height();if(B=tu.allocate(N,z,N+Y,z+U),D=D.background,!w){let $=B.width(),ut=B.height();B.set(((x=D.x)!==null&&x!==void 0?x:0)+((y=D.dx)!==null&&y!==void 0?y:0),((b=D.y)!==null&&b!==void 0?b:0)+((S=D.dy)!==null&&S!==void 0?S:0),$,ut)}}else B=t.AABBBounds,w||(B=rf(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){let R=t.resources.get(D);if(R.state!=="success"||!R.data)return void P();e.highPerformanceSave(),w&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,s,h),this.doDrawImage(e,R.data,B,{backgroundMode:C,backgroundFit:k,backgroundKeepAspectRatio:M}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{let{backgroundCornerRadius:R}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,s,h),e.fillStyle=D,R?(_s(e,B.x1,B.y1,B.width(),B.height(),R,!0),e.fill()):e.fillRect(B.x1,B.y1,B.width(),B.height()),e.highPerformanceRestore()}L&&tu.free(B),P()}},Fx=new xM;var QY=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},t6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},qI=function(r,t){return function(e,i){t(e,i,r)}},Ox=class extends Le{constructor(r){super(),this.textRenderContribitions=r,this.numberType=ol,this.builtinContributions=[Fx],this.init(r)}drawShape(r,t,e,i,s,n,o,a){var l,h,d;let c=dt(r,n?.theme).text,{text:u,underline:p=c.underline,lineThrough:m=c.lineThrough,keepDirIn3d:g=c.keepDirIn3d,direction:f=c.direction,fontSize:_=c.fontSize,verticalMode:v=c.verticalMode,x=c.x,y=c.y}=r.attribute,b=(l=Ih(r.attribute.lineHeight,_))!==null&&l!==void 0?l:_,S=this.valid(r,c,o,a);if(!S)return;let{fVisible:C,sVisible:k,doFill:M,doStroke:E}=S,D=!g,P=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,c),this.beforeRenderStep(r,t,e,i,M,E,C,k,c,s,o,a),D&&this.transformUseContext2d(r,c,P,t);let B=(L,w,R,N)=>{let z=e+w,Y=i+R;if(N){t.highPerformanceSave(),z+=_;let U=hi.allocate(1,0,0,1,0,0);U.rotateByCenter(Math.PI/2,z,Y),t.transformFromMatrix(U,!0),hi.free(U)}E&&(a?a(t,r.attribute,c):k&&(t.setStrokeStyle(r,r.attribute,x-e,y-i,c),t.strokeText(L,z,Y,P))),M&&(o?o(t,r.attribute,c):C&&(t.setCommonStyle(r,r.attribute,x-e,y-i,c),t.fillText(L,z,Y,P))),N&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(t.setTextStyleWithoutAlignBaseline(r.attribute,c,P),f==="horizontal"){let{multilineLayout:L}=r;if(!L)return void t.highPerformanceRestore();let{xOffset:w,yOffset:R}=L.bbox;E&&(a?a(t,r.attribute,c):k&&(t.setStrokeStyle(r,r.attribute,x-e,y-i,c),L.lines.forEach(N=>{t.strokeText(N.str,(N.leftOffset||0)+w+e,(N.topOffset||0)+R+i,P)}))),M&&(o?o(t,r.attribute,c):C&&(t.setCommonStyle(r,r.attribute,x-e,y-i,c),L.lines.forEach(N=>{t.fillText(N.str,(N.leftOffset||0)+w+e,(N.topOffset||0)+R+i,P),this.drawUnderLine(p,m,r,(N.leftOffset||0)+w+e,(N.topOffset||0)+R+i,N.descent,(N.descent-N.ascent)/2,P,c,t,{width:N.width})})))}else{let{textAlign:L=c.textAlign,textBaseline:w=c.textBaseline}=r.attribute;if(!v){let ut=L;L=(h=r.getBaselineMapAlign()[w])!==null&&h!==void 0?h:"left",w=(d=r.getAlignMapBaseline()[ut])!==null&&d!==void 0?d:"top"}r.tryUpdateAABBBounds();let R=r.cache,{verticalList:N}=R;t.textAlign="left",t.textBaseline="top";let z=b*N.length,Y=0;N.forEach(ut=>{let mt=ut.reduce((bt,Ot)=>bt+(Ot.width||0),0);Y=ri(mt,Y)});let U=0,$=0;w==="bottom"?$=-z:w==="middle"&&($=-z/2),L==="center"?U-=Y/2:L==="right"&&(U-=Y),N.forEach((ut,mt)=>{let bt=ut.reduce((Lt,Ht)=>Lt+(Ht.width||0),0),Ot=Y-bt,me=U;L==="center"?me+=Ot/2:L==="right"&&(me+=Ot),ut.forEach(Lt=>{let{text:Ht,width:de,direction:je}=Lt;B(Ht,z-(mt+1)*b+$,me,je),me+=de})})}D&&this.restoreTransformUseContext2d(r,c,P,t),this.afterRenderStep(r,t,e,i,M,E,C,k,c,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).text,{keepDirIn3d:n=s.keepDirIn3d}=r.attribute,o=!n;this._draw(r,s,o,e,i)}drawUnderLine(r,t,e,i,s,n,o,a,l,h,d){if(t+r<=0)return;let{textAlign:c=l.textAlign,fill:u=l.fill,opacity:p=l.opacity,underlineOffset:m=l.underlineOffset,underlineDash:g=l.underlineDash,fillOpacity:f=l.fillOpacity}=e.attribute,_=!T(d),v=_?d.width:e.clipedWidth,x=_?0:Jo(c,v),y={lineWidth:0,stroke:u,opacity:p,strokeOpacity:f};if(r){y.lineWidth=r,h.setStrokeStyle(e,y,i,s,l),g&&h.setLineDash(g),h.beginPath();let b=s+n+m;h.moveTo(i+x,b,a),h.lineTo(i+x+v,b,a),h.stroke()}if(t){y.lineWidth=t,h.setStrokeStyle(e,y,i,s,l),h.beginPath();let b=s+o;h.moveTo(i+x,b,a),h.lineTo(i+x+v,b,a),h.stroke()}}};Ox=QY([q(),qI(0,lt($t)),qI(0,Zt(Kg)),t6("design:paramtypes",[Object])],Ox);var e6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},ZI=class{};ZI=e6([q()],ZI);function SM(r,t,e,i){r.moveTo(t[0].x+e,t[0].y+i);for(let s=1;s<t.length;s++)r.lineTo(t[s].x+e,t[s].y+i)}function JI(r,t,e,i,s,n=!0){var o;if(t.length<3)return void SM(r,t,e,i);let a=0,l=t.length-1;n||(a+=1,l-=1,r.moveTo(t[0].x+e,t[0].y+i));for(let h=a;h<=l;h++){let d=t[h===0?l:(h-1)%t.length],c=t[h%t.length],u=t[(h+1)%t.length],p=c.x-d.x,m=c.y-d.y,g=c.x-u.x,f=c.y-u.y,_=(Math.atan2(m,p)-Math.atan2(f,g))/2,v=Math.abs(Math.tan(_)),x=Array.isArray(s)?(o=s[h%t.length])!==null&&o!==void 0?o:0:s,y=x/v,b=Hx(p,m),S=Hx(g,f),C=Math.min(b,S);y>C&&(y=C,x=C*v);let k=bM(c,y,b,p,m),M=bM(c,y,S,g,f),E=2*c.x-k.x-M.x,D=2*c.y-k.y-M.y,P=Hx(E,D),B=bM(c,Hx(y,x),P,E,D),L=Math.atan2(k.y-B.y,k.x-B.x),w=Math.atan2(M.y-B.y,M.x-B.x),R=w-L;R<0&&(L=w,R=-R),R>Math.PI&&(R-=Math.PI),h===0?r.moveTo(k.x+e,k.y+i):r.lineTo(k.x+e,k.y+i),R&&r.arcTo(c.x+e,c.y+i,M.x+e,M.y+i,x),r.lineTo(M.x+e,M.y+i)}n||r.lineTo(t[l+1].x+e,t[l+1].y+i)}function Hx(r,t){return Math.sqrt(r*r+t*t)}function bM(r,t,e,i,s){let n=t/e;return{x:r.x-i*n,y:r.y-s*n}}var QI=Us,tF=Tr;var i6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},r6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},eF=function(r,t){return function(e,i){t(e,i,r)}},Nx=class extends Le{constructor(r){super(),this.polygonRenderContribitions=r,this.numberType=sl,this.builtinContributions=[tF,QI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){let l=dt(r,n?.theme).polygon,{points:h=l.points,cornerRadius:d=l.cornerRadius,x:c=l.x,y:u=l.y,closePath:p=l.closePath,fillStrokeOrder:m=l.fillStrokeOrder}=r.attribute,g=this.valid(r,l,o,a);if(!g)return;let{fVisible:f,sVisible:_,doFill:v,doStroke:x}=g;t.beginPath(),d<=0||H(d)&&d.every(S=>S===0)?SM(t.camera?t:t.nativeContext,h,e,i):JI(t.camera?t:t.nativeContext,h,e,i,d,p),p&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l),this.beforeRenderStep(r,t,e,i,v,x,f,_,l,s,o,a);let y=()=>{v&&(o?o(t,r.attribute,l):f&&(t.setCommonStyle(r,r.attribute,c-e,u-i,l),t.fill()))},b=()=>{x&&(a?a(t,r.attribute,l):_&&(t.setStrokeStyle(r,r.attribute,c-e,u-i,l),t.stroke()))};m?(b(),y()):(y(),b()),this.afterRenderStep(r,t,e,i,v,x,f,_,l,s,o,a)}draw(r,t,e,i){let s=dt(r,i?.theme).polygon;this._draw(r,s,!1,e,i)}};Nx=i6([q(),eF(0,lt($t)),eF(0,Zt(Yg)),r6("design:paramtypes",[Object])],Nx);var s6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},n6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},iF=function(r,t){return function(e,i){t(e,i,r)}},Vx=class{constructor(r){this.groupRenderContribitions=r,this.numberType=Oc}drawShape(r,t,e,i,s,n,o,a){let l=dt(r,n?.theme).group,{fill:h=l.fill,background:d,stroke:c=l.stroke,opacity:u=l.opacity,width:p=l.width,height:m=l.height,clip:g=l.clip,fillOpacity:f=l.fillOpacity,strokeOpacity:_=l.strokeOpacity,cornerRadius:v=l.cornerRadius,path:x=l.path,lineWidth:y=l.lineWidth,visible:b=l.visible,fillStrokeOrder:S=l.fillStrokeOrder,cornerType:C=l.cornerType,x:k=l.x,y:M=l.y}=r.attribute,E=zc(u,f,p,m,h),D=Gc(u,_,p,m),P=gs(h,d),B=gn(c,y);if(!r.valid||!b||!g&&(!P&&!B||!(E||D||o||a||d)))return;if(x&&x.length&&s.drawContribution){let N=t.disableFill,z=t.disableStroke,Y=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,x.forEach(U=>{s.drawContribution.getRenderContribution(U).draw(U,s.renderService,s,n)}),t.disableFill=N,t.disableStroke=z,t.disableBeginPath=Y}else v===0||H(v)&&v.every(N=>N===0)?(t.beginPath(),t.rect(e,i,p,m)):(t.beginPath(),_s(t,e,i,p,m,v,C!=="bevel"));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(TI));let L={doFill:P,doStroke:B};t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l),this._groupRenderContribitions.forEach(N=>{N.time===Ee.beforeFillStroke&&N.drawShape(r,t,e,i,P,B,E,D,l,s,o,a,L)}),g&&t.clip();let w=()=>{L.doFill&&(o?o(t,r.attribute,l):E&&(t.setCommonStyle(r,r.attribute,k-e,M-i,l),t.fill()))},R=()=>{L.doStroke&&(a?a(t,r.attribute,l):D&&(t.setStrokeStyle(r,r.attribute,k-e,M-i,l),t.stroke()))};S?(R(),w()):(w(),R()),this._groupRenderContribitions.forEach(N=>{N.time===Ee.afterFillStroke&&N.drawShape(r,t,e,i,P,B,E,D,l,s,o,a)})}draw(r,t,e,i){let{context:s}=e;if(!s)return;let{clip:n,baseOpacity:o=1,drawMode:a,x:l,y:h,width:d,height:c}=r.attribute,u=s.nativeContext,p=s.canvas.nativeCanvas;if(a>0){let y=s.canvas,b=kt.createCanvas({width:y.width,height:y.height,dpr:1}),S=b.getContext("2d"),C=s.nativeContext.getTransform();S.setTransform(C.a,C.b,C.c,C.d,C.e,C.f),a===1&&(S.save(),S.clearRect(0,0,y.width,y.height),S.beginPath(),S.rect(l,h,d,c),S.clip(),S.drawImage(y.nativeCanvas,0,0,y.width,y.height,0,0,y.displayWidth,y.displayHeight),S.restore()),s.nativeContext=S,y.nativeCanvas=b}n?s.save():s.highPerformanceSave();let m=s.baseGlobalAlpha;s.baseGlobalAlpha*=o;let g=dt(r,i?.theme).group,f=s.modelMatrix;if(s.camera){let y=Fe.allocate(),b=Fe.allocate();Cx(b,r,g),fn(y,f||y,b),s.modelMatrix=y,Fe.free(b),s.setTransform(1,0,0,1,0,0,!0)}else s.transformFromMatrix(r.transMatrix,!0);s.beginPath(),i.skipDraw?this.drawShape(r,s,0,0,e,i,()=>!1,()=>!1):this.drawShape(r,s,0,0,e);let{scrollX:_=g.scrollX,scrollY:v=g.scrollY}=r.attribute,x;if((_||v)&&s.translate(_,v),i&&i.drawingCb&&(x=i.drawingCb()),s.modelMatrix!==f&&Fe.free(s.modelMatrix),s.modelMatrix=f,s.baseGlobalAlpha=m,a>0){let y=s.nativeContext,b=s.canvas.nativeCanvas;u.save(),u.setTransform(s.dpr,0,0,s.dpr,0,0,!0),a===1&&y.rect(l,h,d,c),u.drawImage(b,0,0,b.width,b.height,0,0,s.canvas.displayWidth,s.canvas.displayHeight);let S=y.getTransform();u.setTransform(S.a,S.b,S.c,S.d,S.e,S.f),s.nativeContext=u,s.canvas.nativeCanvas=p,u.restore()}x&&x.then?x.then(()=>{n?s.restore():s.highPerformanceRestore()}):n?s.restore():s.highPerformanceRestore()}};Vx=s6([q(),iF(0,lt($t)),iF(0,Zt(xx)),n6("design:paramtypes",[Object])],Vx);var o6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},a6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},rF=function(r,t){return function(e,i){t(e,i,r)}},l6=["","repeat-x","repeat-y","repeat"],jx=class extends Le{constructor(r){super(),this.imageRenderContribitions=r,this.numberType=il,this.builtinContributions=[wI,PI],this.init(r)}drawShape(r,t,e,i,s,n,o,a){let l=dt(r).image,{repeatX:h=l.repeatX,repeatY:d=l.repeatY,x:c=l.x,y:u=l.y,cornerRadius:p=l.cornerRadius,fillStrokeOrder:m=l.fillStrokeOrder,cornerType:g=l.cornerType,image:f}=r.attribute,_=this.valid(r,l,o);if(!_)return;let{fVisible:v,sVisible:x,doFill:y,doStroke:b}=_;if(!f||!r.resources)return;let S=r.resources.get(f);if(S.state!=="success")return;let C=r.width,k=r.height;t.beginPath();let M=!1;p===0||H(p)&&p.every(P=>P===0)?t.rect(e,i,C,k):(_s(t,e,i,C,k,p,g!=="bevel"),M=!0),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,l);let E=()=>{if(y){if(o)o(t,r.attribute,l);else if(v){t.setCommonStyle(r,r.attribute,e,i,l);let P=0;if(h==="repeat"&&(P|=1),d==="repeat"&&(P|=2),P){let B=t.createPattern(S.data,l6[P]);t.fillStyle=B,t.translate(e,i,!0),t.fillRect(0,0,C,k),t.translate(-e,-i,!0)}else t.drawImage(S.data,e,i,C,k)}}},D=()=>{b&&(a?a(t,r.attribute,l):x&&(t.setStrokeStyle(r,r.attribute,c-e,u-i,l),t.stroke()))};m?(D(),M&&(t.save(),t.clip()),this.beforeRenderStep(r,t,e,i,y,!1,v,!1,l,s,o),E(),M&&t.restore()):(M&&(t.save(),t.clip()),this.beforeRenderStep(r,t,e,i,y,!1,v,!1,l,s,o),E(),M&&t.restore(),D()),this.afterRenderStep(r,t,e,i,y,!1,v,!1,l,s,o)}draw(r,t,e){let{image:i}=r.attribute;if(!i||!r.resources)return;let s=r.resources.get(i);if(s.state==="loading"&&Z(i))return void mn.improveImageLoading(i);if(s.state!=="success")return;let{context:n}=t.drawParams;if(!n)return;let o=dt(r).image;this._draw(r,o,!1,e)}};jx=o6([q(),rF(0,lt($t)),rF(0,Zt(Ug)),a6("design:paramtypes",[Object])],jx);var zx=Symbol.for("IncrementalDrawContribution"),Wh=Symbol.for("ArcRender"),AM=Symbol.for("Arc3dRender"),Yh=Symbol.for("AreaRender"),Xh=Symbol.for("CircleRender"),fe=Symbol.for("GraphicRender"),CM=Symbol.for("GroupRender"),Kh=Symbol.for("LineRender"),$h=Symbol.for("PathRender"),qh=Symbol.for("PolygonRender"),Zh=Symbol.for("RectRender"),TM=Symbol.for("Rect3DRender"),Jh=Symbol.for("SymbolRender"),uf=Symbol.for("TextRender"),pf=Symbol.for("RichTextRender"),kM=Symbol.for("Pyramid3dRender"),mf=Symbol.for("GlyphRender"),gf=Symbol.for("ImageRender"),kCt=Symbol.for("RenderSelector"),eu=Symbol.for("DrawContribution");var Gx=(r,t,e,i)=>{let s,n=!1,o=!1;if(t.forEachChildren(a=>(n=a.numberType===Ic,!n)),t.forEachChildren(a=>(o=!!a.findFace,!o)),n){let a=t.getChildren(),l=[...a];l.sort((h,d)=>{var c,u,p,m;let g=((u=(c=h.attribute.startAngle)!==null&&c!==void 0?c:0+h.attribute.endAngle)!==null&&u!==void 0?u:0)/2,f=((m=(p=d.attribute.startAngle)!==null&&p!==void 0?p:0+d.attribute.endAngle)!==null&&m!==void 0?m:0)/2;for(;g<0;)g+=vt;for(;f<0;)f+=vt;return f-g}),l.forEach(h=>{h._next=null,h._prev=null}),t.removeAllChild(),t.update(),l.forEach(h=>{t.appendChild(h)}),i.hack_pieFace="outside",s=e(n,o),s&&s.graphic||(i.hack_pieFace="inside",s=e(n,o)),s&&s.graphic||(i.hack_pieFace="top",s=e(n,o)),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),a.forEach(h=>{t.appendChild(h)})}else if(o){let a=t.getChildren(),l=a.map(h=>({ave_z:h.findFace().vertices.map(d=>{var c;return r.view(d[0],d[1],(c=d[2]+h.attribute.z)!==null&&c!==void 0?c:0)[2]}).reduce((d,c)=>d+c,0),g:h}));l.sort((h,d)=>d.ave_z-h.ave_z),t.removeAllChild(),l.forEach(h=>{h.g._next=null,h.g._prev=null}),t.update(),l.forEach(h=>{t.add(h.g)}),s=e(n,o),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),t.update(),a.forEach(h=>{t.add(h)})}else s=e(n,o);return s};var h6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},d6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Qh=Symbol.for("DrawItemInterceptor"),sF=new ie,nF=new ie,MM=class{constructor(){this.order=1}afterDrawItem(t,e,i,s,n){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,s,n),!1}beforeDrawItem(t,e,i,s,n){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,s,n),!1}drawItem(t,e,i,s,n){if(!t.shadowRoot)return!1;let{context:o}=i;if(o.highPerformanceSave(),o.transformFromMatrix(t.transMatrix,!0),s.dirtyBounds&&s.backupDirtyBounds){sF.copy(s.dirtyBounds),nF.copy(s.backupDirtyBounds);let a=t.globalTransMatrix.getInverse();s.dirtyBounds.copy(s.backupDirtyBounds).transformWithMatrix(a),s.backupDirtyBounds.copy(s.dirtyBounds)}return s.renderGroup(t.shadowRoot,i,hi.allocate(1,0,0,1,0,0)),o.highPerformanceRestore(),s.dirtyBounds&&s.backupDirtyBounds&&(s.dirtyBounds.copy(sF),s.backupDirtyBounds.copy(nF)),!0}},DM=class{constructor(){this.order=1}afterDrawItem(t,e,i,s,n){return t.attribute._debug_bounds&&this.drawItem(t,e,i,s,n),!1}drawItem(t,e,i,s,n){if(!t.attribute._debug_bounds)return!1;let{context:o}=i;o.highPerformanceSave(),t.parent&&o.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&o.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);let a=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(o,t),o.strokeRect(a.x1,a.y1,a.width(),a.height()),o.highPerformanceRestore(),!0}},ff=class{constructor(){this.order=1,this.interceptors=[new MM,new wM,new EM,new DM]}afterDrawItem(r,t,e,i,s){for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].afterDrawItem&&this.interceptors[n].afterDrawItem(r,t,e,i,s))return!0;return!1}beforeDrawItem(r,t,e,i,s){if((!r.in3dMode||e.in3dInterceptor)&&!r.shadowRoot&&!(r.baseGraphic||r.attribute.globalZIndex||r.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].beforeDrawItem&&this.interceptors[n].beforeDrawItem(r,t,e,i,s))return!0;return!1}};ff=h6([q(),d6("design:paramtypes",[])],ff);var EM=class{constructor(){this.order=1}beforeDrawItem(t,e,i,s,n){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,s,n):this.beforeSetInteractive(t,e,i,s,n))}beforeSetInteractive(t,e,i,s,n){let o=t.interactiveGraphic;if(t.attribute.globalZIndex){o||(o=t.clone(),t.interactiveGraphic=o,o.baseGraphic=t),o.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();let a=i.stage.getLayer("_builtin_interactive");return a&&this.getShadowRoot(a).add(o),!0}if(o){i.stage.tryInitInteractiveLayer();let a=i.stage.getLayer("_builtin_interactive");a&&this.getShadowRoot(a).removeChild(o),t.interactiveGraphic=null,o.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,s,n){let o=t.baseGraphic,a=!!o.stage,l=o.parent;for(;a&&l&&l.stage!==l;)a=!!l.stage,l=l.parent;if(!a){let h=i.stage.getLayer("_builtin_interactive");return h&&this.getShadowRoot(h).removeChild(t),!0}if(o){this.processing=!0;let{context:h}=i;return h.highPerformanceSave(),h.setTransformFromMatrix(o.parent.globalTransMatrix,!0),o.isContainer?s.renderGroup(o,i,o.parent.globalTransMatrix):s.renderItem(o,i),h.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=Q.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}},wM=class{constructor(){this.order=1}beforeDrawItem(t,e,i,s,n){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;let{context:o,stage:a}=e.drawParams;o.canvas,o.save(),this.initCanvasCtx(o),o.camera=a.camera;let l=o.currentMatrix;l.a/=o.dpr,l.b/=o.dpr,l.c/=o.dpr,l.d/=o.dpr,l.e/=o.dpr,l.f/=o.dpr;let h=Fe.allocate();$g(h,l);let d=o.modelMatrix;if(d){if(h){let c=Fe.allocate();o.modelMatrix=fn(c,d,h)}}else o.modelMatrix=h;return o.setTransform(1,0,0,1,0,0,!0),t.isContainer?Gx(o,t,(c,u)=>s.renderGroup(t,i,t.parent.globalTransMatrix,!c&&u),i):s.renderItem(t,i),o.camera=null,o.restore(),o.modelMatrix!==d&&Fe.free(o.modelMatrix),o.modelMatrix=d,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}};var c6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},u6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},p6=function(r,t){return function(e,i){t(e,i,r)}},Wx=Symbol.for("RenderService"),sTt=Symbol.for("BeforeRenderConstribution"),Ux=class{constructor(r){this.drawContribution=r}prepare(r){r&&this.renderTreeRoots.forEach(t=>{this._prepare(t,r)})}_prepare(r,t){r.forEachChildren(e=>{this._prepare(e,t)}),r.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(r){}draw(r){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(r){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(r,t){this.renderTreeRoots=r,this.drawParams=t;let e=t.updateBounds;this.prepare(e),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t),this.drawParams=null}};Ux=c6([q(),p6(0,lt(eu)),u6("design:paramtypes",[Object])],Ux);var oF=new tt(r=>{r(Wx).to(Ux)});var dTt=Symbol.for("GraphicPicker"),vs=Symbol.for("PickerService"),cTt=Symbol.for("BoundsPicker"),PM=Symbol.for("GlobalPickerService"),vn=Symbol.for("PickItemInterceptor"),ta=Symbol.for("PickServiceInterceptor");var Yx=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},_f=class{constructor(){this.order=1}afterPickItem(r,t,e,i,s){if(r.graphic){let n=r.graphic;for(;n.parent;)n=n.parent;n.shadowHost&&(r.params={shadowTarget:r.graphic},r.graphic=n.shadowHost)}return r}};_f=Yx([q()],_f);var vf=class{constructor(){this.order=1}afterPickItem(r,t,e,i,s){return r.attribute.shadowRootIdx>0||!r.attribute.shadowRootIdx?this._pickItem(r,t,e,i,s):null}beforePickItem(r,t,e,i,s){return r.attribute.shadowRootIdx<0?this._pickItem(r,t,e,i,s):null}_pickItem(r,t,e,i,s){var n;if(!r.shadowRoot)return null;let{parentMatrix:o}=s||{};if(!o)return null;let a=t.pickContext;a.highPerformanceSave();let l=(n=dt(r))===null||n===void 0?void 0:n[r.type],{shadowPickMode:h=l?.shadowPickMode}=r.attribute,d=r.shadowRoot,c=hi.allocateByObj(o),u=new Xt(c.a*e.x+c.c*e.y+c.e,c.b*e.x+c.d*e.y+c.f),p=t.pickGroup(d,u,c,i);return a.highPerformanceRestore(),!p.graphic&&p.group&&h==="full"&&(p.graphic=p.group),p}};vf=Yx([q()],vf);var yf=class{constructor(){this.order=1}beforePickItem(r,t,e,i,s){let n=r.baseGraphic;if(n&&n.parent){let o=new Xt(e.x,e.y),a=t.pickContext;a.highPerformanceSave();let l=n.parent.globalTransMatrix;l.transformPoint(o,o);let h=n.isContainer?t.pickGroup(n,o.clone(),l,i):t.pickItem(n,o.clone(),l,i);return a.highPerformanceRestore(),h}return null}};yf=Yx([q()],yf);var xf=class{constructor(){this.order=1}beforePickItem(r,t,e,i,s){if(!r.in3dMode||i.in3dInterceptor)return null;let n=t.pickContext,o=r.stage;if(!n||!o)return null;if(i.in3dInterceptor=!0,n.save(),this.initCanvasCtx(n),n.camera=o.camera,r.isContainer){let a=Gx(n,r,()=>t.pickGroup(r,e,s.parentMatrix,i),i);return n.camera=null,i.in3dInterceptor=!1,n.restore(),a}return n.restore(),null}initCanvasCtx(r){r.setTransformForCurrent()}};xf=Yx([q()],xf);var aF=new tt((r,t,e)=>{e(vs)||(r(PM).toSelf(),r(vs).toService(PM)),r(xf).toSelf().inSingletonScope(),r(vn).toService(xf),r(vf).toSelf().inSingletonScope(),r(vn).toService(vf),r(yf).toSelf().inSingletonScope(),r(vn).toService(yf),Me(r,vn),r(_f).toSelf().inSingletonScope(),r(ta).toService(_f),Me(r,ta)});var lF=new tt(r=>{r(px).to(Ax).inSingletonScope(),r(mx).toConstantValue(Q)});var bf=Symbol.for("AutoEnablePlugins"),Xx=Symbol.for("PluginService");var m6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},g6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},hF=function(r,t){return function(e,i){t(e,i,r)}},Kx=class{constructor(r){this.autoEnablePlugins=r,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(r,t){this.stage=r,this.actived=!0;let{pluginList:e}=t;e&&yt.isBound(bf)&&this.autoEnablePlugins.getContributions().forEach(i=>{e.includes(i.name)&&this.register(i)})}findPluginsByName(r){let t=[];return this.onStartupFinishedPlugin.forEach(e=>{e.name===r&&t.push(e)}),this.onRegisterPlugin.forEach(e=>{e.name===r&&t.push(e)}),t}register(r){r.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(r):r.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(r),r.activate(this))}unRegister(r){r.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(r),1):r.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(r),1),r.deactivate(this)}release(...r){this.onStartupFinishedPlugin.forEach(t=>{t.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(t=>{t.deactivate(this)}),this.onRegisterPlugin=[]}};Kx=m6([q(),hF(0,lt($t)),hF(0,Zt(bf)),g6("design:paramtypes",[Object])],Kx);var dF=new tt(r=>{r(Xx).to(Kx),RR(r,bf)});var cF=new tt(r=>{Me(r,to)});var uF=new tt(r=>{r(Cg).to(Uy).inSingletonScope(),Me(r,Cg)});var f6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},_6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Sf=class{constructor(){this.type="static",this.offscreen=!1,this.global=j.global}setDpr(r){this.canvas.dpr=r}init(r,t,e){if(this.layer=r,this.window=t,e.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,e.canvasId&&(i=this.global.getElementById(e.canvasId)),i||(i=this.global.createCanvas({width:t.width,height:t.height})),i.style&&(i.style["pointer-events"]="none");let s=t.getContext().getCanvas().nativeCanvas,n=kc({nativeCanvas:i,width:t.width,height:t.height,dpr:t.dpr,id:e.canvasId,canvasControled:!0,container:t.getContainer(),x:s.offsetLeft,y:s.offsetTop});n.applyPosition(),this.canvas=n,this.context=n.getContext()}}resize(r,t){this.canvas.resize(r,t)}resizeView(r,t){}render(r,t,e){var i;if(!this.main){let s=this.window.getContext().getCanvas().nativeCanvas;!s||this.canvas.x===s.offsetLeft&&this.canvas.y===s.offsetTop||(this.canvas.x=s.offsetLeft,this.canvas.y=s.offsetTop,this.canvas.applyPosition())}t.renderService.render(r,Object.assign(Object.assign({context:this.context,clear:(i=t.background)!==null&&i!==void 0?i:"#ffffff"},t),e))}merge(r){r.forEach(t=>{let e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)})}prepare(r,t){}drawTo(r,t,e){var i;let s=r.getContext();e.renderService.render(t,Object.assign(Object.assign({context:s},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};Sf=f6([q(),_6("design:paramtypes",[])],Sf);var pF=new tt(r=>{r(Sf).toSelf(),r(yx).toService(Sf)});function RM(r){r.load(cF),r.load(uF),r.load(pF)}var v6=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};function mF(r,t,e){let i={},s=[];return r.forEachChildren(n=>{let{zIndex:o=t}=n.attribute;i[o]?i[o].push(n):(i[o]=[n],s.push(o))},e),s.sort((n,o)=>e?o-n:n-o),{childMap:i,zIdxArray:s}}function $x(r,t,e,i=!1,s=!1){let n=!1;if(s)n=!0;else{let o;r.forEachChildren((a,l)=>{let{zIndex:h=t}=a.attribute;if(l===0)o=h;else if(o!==h)return n=!0,!0;return!1},i)}if(n){let{childMap:o,zIdxArray:a}=mF(r,t,i),l=!1;for(let h=0;h<a.length&&!l;h++){let d=o[a[h]];s&&d.sort((c,u)=>{var p,m;return(i?-1:1)*(((p=u.attribute.z)!==null&&p!==void 0?p:0)-((m=c.attribute.z)!==null&&m!==void 0?m:0))});for(let c=0;c<d.length;c++)if(e(d[c],c)){l=!0;break}}}else r.forEachChildren(e,i)}function BM(r,t,e,i=!1){return v6(this,void 0,void 0,function*(){yield r.forEachChildrenAsync(e,i)})}function gF(r,t,e,i=!1){let s=!1;r.forEachChildren((a,l)=>{let{zIndex:h=e}=a.attribute;if(l!==0){if(h!==void 0)return s=!0,!0}return!1},i);let n=null,o=!1;if(s){let{childMap:a,zIdxArray:l}=mF(r,e,i),h=!1;for(let d=0;d<l.length&&!h;d++){let c=a[l[d]];for(let u=0;u<c.length;u++){if(o){h=!0,n=c[u];break}c[u]._uid!==t||(o=!0)}}}else r.forEachChildren(a=>o?(n=a,!0):(a._uid===t&&(o=!0),!1),i);return n}var y6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},x6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},LM=function(r,t){return function(e,i){t(e,i,r)}},iu=class{constructor(r,t){this.contributions=r,this.drawItemInterceptorContributions=t,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Ye,this.backupDirtyBounds=new Ye,this.global=j.global,this.layerService=j.layerService,H(this.contributions)||(this.contributions=[this.contributions]),this.init()}init(){this.contributions.forEach(r=>{if(r.style){let t=this.styleRenderMap.get(r.style)||new Map;t.set(r.numberType,r),this.styleRenderMap.set(r.style,t)}else this.defaultRenderMap.set(r.numberType,r)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((r,t)=>r.order-t.order)}prepareForDraw(r,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(r,t){this.prepareForDraw(r,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=r;let{context:e,stage:i,viewBox:s,transMatrix:n}=t;if(!e)return;let o=this.dirtyBounds.setValue(0,0,s.width(),s.height());if(i.dirtyBounds&&!i.dirtyBounds.empty()){let l=PP(o,i.dirtyBounds,!1);o.x1=Math.floor(l.x1),o.y1=Math.floor(l.y1),o.x2=Math.ceil(l.x2),o.y2=Math.ceil(l.y2)}let a=e.dpr%1;(a||a!==.5)&&(o.x1=Math.floor(o.x1*e.dpr)/e.dpr,o.y1=Math.floor(o.y1*e.dpr)/e.dpr,o.x2=Math.ceil(o.x2*e.dpr)/e.dpr,o.y2=Math.ceil(o.y2*e.dpr)/e.dpr),this.backupDirtyBounds.copy(o),e.inuse=!0,e.setClearMatrix(n.a,n.b,n.c,n.d,n.e,n.f),e.clearMatrix(),e.setTransformForCurrent(!0),e.translate(s.x1,s.y1,!0),e.beginPath(),e.rect(o.x1,o.y1,o.width(),o.height()),e.clip(),i.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(r,e,t),e.save(),r.renderTreeRoots.sort((l,h)=>{var d,c;return((d=l.attribute.zIndex)!==null&&d!==void 0?d:Je.zIndex)-((c=h.attribute.zIndex)!==null&&c!==void 0?c:Je.zIndex)}).forEach(l=>{l.isContainer?this.renderGroup(l,t,hi.allocate(1,0,0,1,0,0)):this.renderItem(l,t)}),e.restore(),e.setClearMatrix(1,0,0,1,0,0),e.inuse=!1,e.draw()}doRegister(){throw new Error("\u6682\u4E0D\u652F\u6301")}_findNextGraphic(r){let t=r.parent,e=r._uid;for(;t;){let i=gF(t,e,Je.zIndex);if(i)return i;e=t._uid,t=t.parent}return null}renderGroup(r,t,e,i){if(t.break||r.attribute.visibleAll===!1)return;if(r.incremental&&(t.startAtId==null||t.startAtId===r._uid))return t.break=!0,void this._increaseRender(r,t);if(this.useDirtyBounds&&!jo(r.AABBBounds,this.dirtyBounds,!1)&&r.attribute.boundsMode!=="empty")return;let s,n=e;if(this.useDirtyBounds){s=tu.allocateByObj(this.dirtyBounds);let o=r.transMatrix;n=hi.allocateByObj(e).multiply(o.a,o.b,o.c,o.d,o.e,o.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(n.getInverse())}this.renderItem(r,t,{drawingCb:()=>{var o;i?r.forEachChildren(a=>{t.break||(a.isContainer?this.renderGroup(a,t,n):this.renderItem(a,t))}):$x(r,Je.zIndex,a=>{t.break||(a.isContainer?this.renderGroup(a,t,n):this.renderItem(a,t))},!1,!!(!((o=t.context)===null||o===void 0)&&o.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(s),tu.free(s),hi.free(n))}_increaseRender(r,t){let{layer:e,stage:i}=t,{subLayers:s}=e,n=s.get(r._uid);n||(n={layer:this.layerService.createLayer(i),zIndex:s.size,group:r},s.set(r._uid,n));let o=n.layer.getNativeHandler().getContext(),a=n.drawContribution||yt.get(zx);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:n.layer,context:o,startAtId:r._uid,break:!1})),n.drawContribution=a;let l=this._findNextGraphic(r);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,t);else{let h=s.get(l._uid);h||(h={layer:this.layerService.createLayer(i),zIndex:s.size},s.set(l._uid,h));let d=h.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:h.layer,context:d,startAtId:l._uid,break:!1}))}}getRenderContribution(r){let t;return t||(t=this.selectRenderByNumberType(r.numberType,r)),t||(t=this.selectRenderByType(r.type)),t}renderItem(r,t,e){if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){let l=this.InterceptorContributions[a];if(l.beforeDrawItem&&l.beforeDrawItem(r,this.currentRenderService,t,this,e))return}let i=this.getRenderContribution(r);if(!i)return;let s,n=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(r.parent){let{scrollX:a=0,scrollY:l=0}=r.parent.attribute;(a||l)&&(n=!0,this.scrollMatrix||(this.scrollMatrix=hi.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-a,-l))}if(n&&(s=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!r.isContainer&&r.attribute.boundsMode!=="empty"&&!jo(r.AABBBounds,s??this.dirtyBounds,!1)){if(n&&r.parent){let{scrollX:a=0,scrollY:l=0}=r.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}return}let o=t.startAtId!=null&&r._uid!==t.startAtId;if(r._uid===t.startAtId&&(t.startAtId=null),e&&(e.skipDraw=o),o?r.isContainer&&i.draw(r,this.currentRenderService,t,e):i.draw(r,this.currentRenderService,t,e),n&&r.parent){let{scrollX:a=0,scrollY:l=0}=r.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){let l=this.InterceptorContributions[a];if(l.afterDrawItem&&l.afterDrawItem(r,this.currentRenderService,t,this))return}}selectRenderByType(r){return Nt.getInstance().warn("\u672A\u77E5\u9519\u8BEF\uFF0C\u4E0D\u5E94\u8BE5\u8D70\u5230\u8FD9\u91CC"),null}selectRenderByNumberType(r,t){let e;if(t.attribute.renderStyle){let i=this.styleRenderMap.get(t.attribute.renderStyle);e=i&&i.get(r)}return e||this.currentRenderMap.get(r)||this.defaultRenderMap.get(r)}clearScreen(r,t,e){var i,s;let{clear:n,viewBox:o}=e,a=o.width(),l=o.height();if(n){t.clearRect(0,0,a,l);let h=(i=r.drawParams)===null||i===void 0?void 0:i.stage;if(h&&(t.globalAlpha=(s=h.attribute.opacity)!==null&&s!==void 0?s:1),h&&h.backgroundImg&&h.resources){let d=h.resources.get(n);d&&d.state==="success"&&d.data&&t.drawImage(d.data,0,0,a,l)}else t.fillStyle=Ph(t,n,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+l}},0,0),t.fillRect(0,0,a,l)}}afterDraw(r,t){}};iu=y6([q(),LM(0,yg(fe)),LM(1,lt($t)),LM(1,Zt(Qh)),x6("design:paramtypes",[Array,Object])],iu);var b6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},ru=class extends Gh{constructor(){super(...arguments),this.numberType=co}drawShape(r,t,e,i,s,n,o,a){if(r.incremental&&s.multiGraphicOptions){let{startAtIdx:l,length:h}=s.multiGraphicOptions,{segments:d=[]}=r.attribute;if(l>d.length)return;let c=dt(r).line,{fill:u=c.fill,stroke:p=c.stroke,opacity:m=c.opacity,fillOpacity:g=c.fillOpacity,strokeOpacity:f=c.strokeOpacity,lineWidth:_=c.lineWidth,visible:v=c.visible}=r.attribute,x=js(m,g,u),y=Ng(m,f),b=gs(u),S=gn(p,_);if(!r.valid||!v||!b&&!S||!(x||y||o||a))return;let{context:C}=s;for(let k=l;k<l+h;k++)this.drawIncreaseSegment(r,C,d[k-1],d[k],r.attribute.segments[k],[c,r.attribute],e,i)}else super.drawShape(r,t,e,i,s,n,o,a)}drawIncreaseSegment(r,t,e,i,s,n,o,a){i&&(t.beginPath(),NI(t.nativeContext,e,i,{offsetX:o,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,s,n),t.setStrokeStyle(r,s,o,a,n),t.stroke())}};ru=b6([q()],ru);var S6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},su=class extends Uh{constructor(){super(...arguments),this.numberType=ho}drawShape(r,t,e,i,s,n,o){if(r.incremental&&s.multiGraphicOptions){let{startAtIdx:a,length:l}=s.multiGraphicOptions,{segments:h=[]}=r.attribute;if(a>h.length)return;let d=dt(r).area,{fill:c=d.fill,fillOpacity:u=d.fillOpacity,opacity:p=d.opacity,visible:m=d.visible}=r.attribute,g=js(p,u,c),f=gs(c);if(!r.valid||!m||!f||!g&&!o)return;for(let _=a;_<a+l;_++)this.drawIncreaseSegment(r,t,h[_-1],h[_],r.attribute.segments[_],[d,r.attribute],e,i)}else super.drawShape(r,t,e,i,s,n,o)}drawIncreaseSegment(r,t,e,i,s,n,o,a){i&&(t.beginPath(),VI(t.camera?t:t.nativeContext,e,i,{offsetX:o,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,s,n),t.setCommonStyle(r,s,o,a,n),t.fill())}};su=S6([q()],su);var nu,A6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},C6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Af=function(r,t){return function(e,i){t(e,i,r)}},po=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};(function(r){r[r.NORMAL=0]="NORMAL",r[r.STOP=1]="STOP"})(nu||(nu={}));var qx=class extends iu{constructor(r,t,e,i){super(r,i),this.contributions=r,this.lineRender=t,this.areaRender=e,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=nu.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new wi([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(r,t){return po(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=r,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);let e=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,e)return;this.currentRenderService=r;let{context:i,viewBox:s}=t;i&&(i.inuse=!0,i.clearMatrix(),i.setTransformForCurrent(!0),i.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,i,t),i.translate(s.x1,s.y1,!0),i.save(),r.renderTreeRoots.sort((n,o)=>{var a,l;return((a=n.attribute.zIndex)!==null&&a!==void 0?a:Je.zIndex)-((l=o.attribute.zIndex)!==null&&l!==void 0?l:Je.zIndex)}).forEach(n=>{this.renderGroup(n,t)}),this.hooks.completeDraw.tap("top-draw",()=>{i.restore(),i.restore(),i.draw(),i.inuse=!1,this.rendering=!1}))})}_increaseRender(r,t){return po(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(r,t)})}_renderIncrementalGroup(r,t){return po(this,void 0,void 0,function*(){this.count=r.count,yield new Promise(e=>{this.renderItem(r,t,{drawingCb:()=>po(this,void 0,void 0,function*(){if(r.count!==2)yield BM(r,Je.zIndex,(i,s)=>{if(this.status===nu.STOP)return!0;if(i.isContainer||s<this.currentIdx)return!1;let n=this.currFrameStartAt+r.incremental;return s<n&&(this.currentIdx=s+1,this.renderItem(i,t)),s===n-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),e(!1);else{let i=r.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,t),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,t);e(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return po(this,void 0,void 0,function*(){return new Promise(r=>{this.global.getRequestAnimationFrame()(()=>{r(!1)})})})}checkForDraw(r){return po(this,void 0,void 0,function*(){let t=this.rendering;return r.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t})}forceStop(){return po(this,void 0,void 0,function*(){this.rendering&&(this.status=nu.STOP,yield new Promise(r=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=nu.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(t=>t.name!=="stopCb"),r(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(r,t){return po(this,void 0,void 0,function*(){if(!t.break&&r.attribute.visibleAll!==!1)return r.incremental&&t.startAtId===r._uid?(yield this._increaseRender(r,t),void(t.break=!0)):void(yield new Promise(e=>{this.renderItem(r,t,{drawingCb:()=>po(this,void 0,void 0,function*(){yield BM(r,Je.zIndex,i=>po(this,void 0,void 0,function*(){t.break||i.isContainer&&(yield this.renderGroup(i,t))})),e(!1)})})}))})}};qx=A6([q(),Af(0,yg(fe)),Af(1,lt(ru)),Af(2,lt(su)),Af(3,lt($t)),Af(3,Zt(Qh)),C6("design:paramtypes",[Array,Object,Object,Object])],qx);var fF=new tt(r=>{r(Qo).toSelf().inSingletonScope(),r(zh).toSelf().inSingletonScope(),r(eu).to(iu),r(zx).to(qx),r(CM).to(Vx).inSingletonScope(),r(fe).toService(CM),Me(r,xx),r(Si).toSelf().inSingletonScope(),Me(r,bx),Me(r,fe),r(ff).toSelf().inSingletonScope(),r(Qh).toService(ff),Me(r,Qh)});function IM(r){r.load(fF)}function Zx(){Zx.__loaded||(Zx.__loaded=!0,yt.load(YL),yt.load(lF),yt.load(oF),yt.load(aF),yt.load(dF),RM(yt),IM(yt))}Zx.__loaded=!1,Zx();var kt=yt.get(Ga);j.global=kt;var T6=yt.get(vx);j.graphicUtil=T6;var k6=yt.get(_x);j.transformUtil=k6;var M6=yt.get(px);j.graphicService=M6;var D6=yt.get(Vc);j.layerService=D6;var Jx=class{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=le.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,j.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),j.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),j.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){let e=i=>i.filter(s=>s.name!==this.key);j.graphicService.hooks.onAttributeUpdate.taps=e(j.graphicService.hooks.onAttributeUpdate.taps),j.graphicService.hooks.onSetStage.taps=e(j.graphicService.hooks.onSetStage.taps),j.graphicService.hooks.onRemove.taps=e(j.graphicService.hooks.onRemove.taps)}};var Qx=class{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=le.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=j.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){let t=j.global.getRequestAnimationFrame();this.rafId=t(()=>{j.global.devicePixelRatio!==this.dpr&&(this.dpr=j.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{let t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push(()=>{i&&i.removeEventListener("change",e)})}catch{return!1}return!0}deactivate(t){var e;let i=j.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),(e=this.autoRefreshCbs)===null||e===void 0||e.forEach(s=>{s()}),this.autoRefreshCbs=void 0}};var tb=class{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=le.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,j.graphicService.hooks.onAddIncremental.tap(this.key,(e,i,s)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),j.graphicService.hooks.onClearIncremental.tap(this.key,(e,i)=>{e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})}deactivate(t){j.graphicService.hooks.onAddIncremental.taps=j.graphicService.hooks.onAddIncremental.taps.filter(e=>e.name!==this.key),j.graphicService.hooks.onClearIncremental.taps=j.graphicService.hooks.onClearIncremental.taps.filter(e=>e.name!==this.key)}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,j.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){let t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(e=>{let i=e.layer;if(!i||!e.layer.subLayers)return;let s=e.layer.subLayers.get(e._uid);s&&s.drawContribution&&s.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:s.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}};var _F=new ie,eb=class{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=le.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()}),j.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,s,n)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||s&&(_F.setValue(n.x1,n.y1,n.x2,n.y2),i.dirty(_F,e.parent&&e.parent.globalTransMatrix)))}),j.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,s,n,o)=>{i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!o||i.dirty(n.globalAABBBounds))}),j.graphicService.hooks.clearAABBBounds.tap(this.key,(e,i,s)=>{i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(s)}),j.graphicService.hooks.onRemove.tap(this.key,e=>{let i=e.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(e.globalAABBBounds)})}deactivate(t){j.graphicService.hooks.beforeUpdateAABBBounds.taps=j.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),j.graphicService.hooks.afterUpdateAABBBounds.taps=j.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),j.graphicService.hooks.clearAABBBounds.taps=j.graphicService.hooks.clearAABBBounds.taps.filter(e=>e.name!==this.key),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),j.graphicService.hooks.onRemove.taps=j.graphicService.hooks.onRemove.taps.filter(e=>e.name!==this.key)}};var ib=new Dc;ib.addTimeline(Lh);ib.setFPS(60);var ou;function E6(){if(ou==null)try{let r=document.createElement("canvas"),t=r.getContext("2d");ou=!!(window&&r.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&t&&t.isPointInPath&&t.isPointInStroke),ou&&(ou=!!document.createElement)}catch{ou=!1}}function au(){E6();let r=j.global&&j.global.env;return r?r==="browser":ou}var kr=class r{static registerPlugin(t,e){r._pluginClasses[t]=e}static getPlugin(t){return r._pluginClasses[t]}};kr._pluginClasses={};var vF={WIDTH:500,HEIGHT:500,X:0,Y:0,BACKGROUND:"white"},rb=class extends Vs{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){let e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){let e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:vF.BACKGROUND}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(t={}){var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=i=>{if(!(this._skipRender<0))if(i){if(this.dirtyBounds){let s=this.window.getViewBox();this.dirtyBounds.setValue(s.x1,s.y1,s.width(),s.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(s=>s(i)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var i;this.tickedBeforeRender=!0,((i=this.params.optimize)===null||i===void 0?void 0:i.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=t,this.theme=new no,this.hooks={beforeRender:new wi(["stage"]),afterRender:new wi(["stage"])},this.global=j.global,!this.global.env&&au()&&this.global.setEnv("browser"),this.window=yt.get(Rh),this.renderService=yt.get(Wx),this.pluginService=yt.get(Xx),this.layerService=yt.get(Vc),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(e=t.background)!==null&&e!==void 0?e:vF.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||ib,this.supportInteractiveLayer=t.interactiveLayer!==!1,this.timeline=new Ec,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&Z(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(t=-1){this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new ex(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){let{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:s=0,beta:n=0,camera:o,fieldRatio:a=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:s,beta:n,camera:o,fieldRatio:a,fieldDepth:l})}set3dOptions(t){var e,i,s,n,o,a;this.option3d=t;let l=this.get3dOptions(t),{light:h,center:d,camera:c,alpha:u,beta:p,fieldRatio:m,fieldDepth:g}=l,{dir:f=[1,1,-1],color:_="white",ambient:v}=h,x=((e=d.x)!==null&&e!==void 0?e:this.width/2)+((i=d.dx)!==null&&i!==void 0?i:0),y=((s=d.y)!==null&&s!==void 0?s:this.height/2)+((n=d.dy)!==null&&n!==void 0?n:0),b=[x,y,((o=d.z)!==null&&o!==void 0?o:0)+((a=d.dz)!==null&&a!==void 0?a:0)],S=0,C=0,k=0;c||(S=Math.sin(u)+x,C=Math.sin(p)+y,k=Math.cos(u)*Math.cos(p)*1);let M=kr.getPlugin("DirectionalLight");M&&(this.light=new M(f,_,v));let E={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:m,fieldDepth:g,viewParams:{pos:[S,C,k],center:b,up:[0,1,0]}};if(this.camera)this.camera.params=E;else{let D=kr.getPlugin("OrthoCamera");D&&(this.camera=new D(E))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;let t=kr.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Jx))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new Qx))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new tb))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Ye;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new eb,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;let t=kr.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableHtmlAttribute(t){if(this.htmlAttribute)return;let e=kr.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableReactAttribute(t){if(this.reactAttribute)return;let e=kr.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){let t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}createLayer(t,e){if(this.releaseStatus==="released")return;let i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){let e=this.children;e.sort(t),this.removeAllChild(),e.forEach(i=>{this.appendChild(i)})}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();let i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){let t=this.window.getContext().nativeContext;this.forEachChildren((e,i)=>{if(i>0){let s=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(s)}})}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();let t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){let i=[];for(let s=0;s<t.length;s++){let n=t[s];n.layerMode==="virtual"&&(n=n.getNativeHandler().mainHandler.layer),i.includes(n)||i.push(n)}i.forEach(s=>{s.renderCount>this.renderCount||(s.renderCount=this.renderCount+1,s===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),s.render({renderService:this.renderService,background:s===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren(s=>{s.resize(t,e)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e,i=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren(s=>{s.resizeView(t,e)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,s,n){let o=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(o=!1)):(this.viewBox.setValue(t,e,t+i,e+s),n===!1&&(o=!1)),this.forEachChildren(a=>{a.resizeView(this.viewBox.width(),this.viewBox.height())}),o&&this.render()}setDpr(t,e=!0){this.forEachChildren(i=>{i.setDpr(t)}),e&&this.render()}setOrigin(t,e){throw new Error("\u6682\u4E0D\u652F\u6301")}export(t){throw new Error("\u6682\u4E0D\u652F\u6301")}pick(t,e){if(this.releaseStatus==="released")return;let i=this.getPickerService().pick(this.children,new Xt(t,e),{bounds:this.AABBBounds});return!(!i?.graphic&&!i?.group)&&i}startAnimate(t){throw new Error("\u6682\u4E0D\u652F\u6301")}setToFrame(t){throw new Error("\u6682\u4E0D\u652F\u6301")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(t=>{t.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){this.releaseStatus!=="released"&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter(e=>e.name===t)[0]}renderTo(t){this.releaseStatus!=="released"&&this.forEachChildren((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(t=!0,e){if(this.releaseStatus==="released")return;let i=yt.get(Rh),s=e?-e.x1:0,n=e?-e.y1:0,o=e?e.x2:this.viewWidth,a=e?e.y2:this.viewHeight,l=e?e.width():this.viewWidth,h=e?e.height():this.viewHeight;return i.create({viewBox:{x1:s,y1:n,x2:o,y2:a},width:l,height:h,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(t=!0,e){if(this.releaseStatus==="released")return;let i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){let e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=yt.get(vs)),this.pickerService}};function yF(r){return new rb(r)}var w6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},P6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},R6=new Kt(1,0,0,1,0,0),lu={x:0,y:0},sb=class{get nativeContext(){return this.path}constructor(r,t){this.matrix=new Kt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Kt(1,0,0,1,0,0),this.path=new ne,this._clearMatrix=new Kt(1,0,0,1,0,0)}getCanvas(){throw new Error("\u4E0D\u652F\u6301getCanvas")}getContext(){throw new Error("\u4E0D\u652F\u6301getContext")}setTransformForCurrent(r=!1){!r&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix=this.cloneMatrix(this.matrix))}get currentMatrix(){return this.matrix}cloneMatrix(r){return hi.allocateByObj(r)}clear(){this.save(),this.resetTransform(),this.restore()}restore(){this.stack.length>0&&(hi.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent())}highPerformanceRestore(){this.stack.length>0&&(hi.free(this.matrix),this.matrix=this.stack.pop())}rotate(r,t=!0){this.matrix.rotate(r),t&&this.setTransformForCurrent()}save(){let r=this.cloneMatrix(this.matrix);this.stack.push(r)}highPerformanceSave(){let r=this.cloneMatrix(this.matrix);this.stack.push(r)}scale(r,t,e=!0){this.matrix.scale(r,t),e&&this.setTransformForCurrent()}setScale(r,t,e=!0){this.matrix.setScale(r,t),e&&this.setTransformForCurrent()}scalePoint(r,t,e,i,s=!0){this.translate(e,i,!1),this.scale(r,t,!1),this.translate(-e,-i,!1),s&&this.setTransformForCurrent()}setTransform(r,t,e,i,s,n,o=!0,a=this.dpr){this.matrix.setValue(a*r,a*t,a*e,a*i,a*s,a*n),o&&this.setTransformForCurrent()}setTransformFromMatrix(r,t=!0,e=this.dpr){this.matrix.setValue(r.a*e,r.b*e,r.c*e,r.d*e,r.e*e,r.f*e),t&&this.setTransformForCurrent()}resetTransform(r=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),r&&this.setTransformForCurrent()}transform(r,t,e,i,s,n,o=!0){this.matrix.multiply(r,t,e,i,s,n),o&&this.setTransformForCurrent()}transformFromMatrix(r,t){this.matrix.multiply(r.a,r.b,r.c,r.d,r.e,r.f),t&&this.setTransformForCurrent()}translate(r,t,e=!0){this.matrix.translate(r,t),e&&this.setTransformForCurrent()}rotateDegrees(r,t=!0){let e=r*Math.PI/180;this.rotate(e,t)}rotateAbout(r,t,e,i=!0){this.translate(t,e,!1),this.rotate(r,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(r,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(r,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.path.clear()}clip(r,t){}arc(r,t,e,i,s,n){this.path.arc(r,t,e,i,s,n)}arcTo(r,t,e,i,s){this.path.arcTo(r,t,e,i,s)}bezierCurveTo(r,t,e,i,s,n){this.path.bezierCurveTo(r,t,e,i,s,n)}closePath(){this.path.closePath()}ellipse(r,t,e,i,s,n,o,a){}lineTo(r,t){this.path.lineTo(r,t)}moveTo(r,t){this.path.moveTo(r,t)}quadraticCurveTo(r,t,e,i){this.path.quadraticCurveTo(r,t,e,i)}rect(r,t,e,i){this.path.rect(r,t,e,i)}createImageData(r,t){return null}createLinearGradient(r,t,e,i){throw new Error("\u4E0D\u652F\u6301createLinearGradient")}createPattern(r,t){throw new Error("\u4E0D\u652F\u6301createPattern")}createRadialGradient(r,t,e,i,s,n){throw new Error("\u4E0D\u652F\u6301createRadialGradient")}createConicGradient(r,t,e,i){return null}fill(r,t){}fillRect(r,t,e,i){this.path.rect(r,t,e,i)}clearRect(r,t,e,i){}fillText(r,t,e){}getImageData(r,t,e,i){return null}getLineDash(){return[]}isPointInPath(r,t){return this.matrix.transformPoint({x:r,y:t},lu),AB(this.path.commandList,lu.x,lu.y)}isPointInStroke(r,t){if(!this.lineWidth)return!1;this.matrix.transformPoint({x:r,y:t},lu);let e=Vi(this,this.lineWidth,this.dpr);return CB(this.path.commandList,e,lu.x,lu.y)}measureText(r){throw new Error("\u4E0D\u652F\u6301measureText")}putImageData(r,t,e){throw new Error("\u4E0D\u652F\u6301measureText")}setLineDash(r){}stroke(r){}strokeRect(r,t,e,i){this.path.rect(r,t,e,i)}strokeText(r,t,e){}drawImage(){}setCommonStyle(r,t,e,i,s){}_setCommonStyle(r,t,e,i){}setStrokeStyle(r,t,e,i,s){}_setStrokeStyle(r,t,e,i){}setTextStyleWithoutAlignBaseline(r,t){}setTextStyle(r,t){}draw(){}clearMatrix(r=!0,t=this.dpr){this.setTransformFromMatrix(R6,r,t)}setClearMatrix(r,t,e,i,s,n){this._clearMatrix.setValue(r,t,e,i,s,n)}onlyTranslate(r=this.dpr){return this.matrix.a===r&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===r}release(...r){this.stack.forEach(t=>hi.free(t)),this.stack.length=0}};sb=w6([q(),P6("design:paramtypes",[Object,Number])],sb);var FM={WIDTH:500,HEIGHT:500,DPR:1},ea=class{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;let{nativeCanvas:i,width:s=FM.WIDTH,height:n=FM.HEIGHT,dpr:o=FM.DPR,x:a,y:l,id:h,canvasControled:d=!0}=t;this._x=a??0,this._y=l??0,this._pixelWidth=s*o,this._pixelHeight=n*o,this._visiable=t.visiable!==!1,this.controled=d,this._displayWidth=s,this._displayHeight=n,this._dpr=o,this._nativeCanvas=i,this._id=(e=i.id)!==null&&e!==void 0?e:h,h&&(i.id=h),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,s){return this._context.getImageData(t,e,i,s)}convertToBlob(t){throw new Error("\u6682\u672A\u5B9E\u73B0")}transferToImageBitmap(){throw new Error("\u6682\u672A\u5B9E\u73B0")}release(...t){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}};ea.env="browser";var B6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},L6=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})},hl=class{configure(r,...t){r.env===this.type&&r.setActiveEnvContribution(this)}getNativeAABBBounds(r){return new ie}removeDom(r){return!1}createDom(r){return null}updateDom(r,t){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(r){return document.getElementById(r)}getRootElement(){return document.body}loadJson(r){let t=fetch(r).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(r){return fetch(r).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(r){return fetch(r).then(t=>t.blob()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(r,t){return 0}getElementLeft(r,t){return 0}getElementTopLeft(r,t){return{top:0,left:0}}loadFont(r,t,e){return L6(this,void 0,void 0,function*(){return{loadState:"fail"}})}isMacOS(){return!1}copyToClipBoard(r){return Promise.resolve(null)}};hl=B6([q()],hl);var I6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},F6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},dl=class{constructor(){this._uid=le.GenAutoIncrementId(),this.viewBox=new ie,this.modelMatrix=new Kt(1,0,0,1,0,0)}onChange(r){this._onChangeCb=r}configure(r,t){t.env===this.type&&r.setWindowHandler(this)}release(...r){this.releaseWindow()}isVisible(r){return!0}onVisibleChange(r){}getTopLeft(r){return{top:0,left:0}}setViewBox(r){this.viewBox.setValue(r.x1,r.y1,r.x2,r.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(r,t,e,i,s,n){this.modelMatrix.setValue(r,t,e,i,s,n)}getViewBoxTransform(){return this.modelMatrix}};dl=I6([q(),F6("design:paramtypes",[])],dl);var O6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},H6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},nb=function(r,t){return function(e,i){t(e,i,r)}},hu=class{constructor(r,t){this.pickItemInterceptorContributions=r,this.pickServiceInterceptorContributions=t,this.type="default",this.global=j.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((r,t)=>r.order-t.order),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort((r,t)=>r.order-t.order)}pick(r,t,e){let i={graphic:null,group:null};e.pickerService=this;let s=e.bounds.width(),n=e.bounds.height();if(!new ie().setValue(0,0,s,n).containsPoint(t))return i;this.pickContext&&(this.pickContext.inuse=!0),e.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);let o=new Kt(1,0,0,1,0,0),a;for(let l=r.length-1;l>=0&&(i=r[l].isContainer?this.pickGroup(r[l],t,o,e):this.pickItem(r[l],t,o,e),!i.graphic);l--)a||(a=i.group);if(i.graphic||(i.group=a),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let l=0;l<this.pickerServiceInterceptorContributions.length;l++){let h=this.pickerServiceInterceptorContributions[l];h.afterPickItem&&(i=h.afterPickItem(i,this,t,e,{parentMatrix:o}))}return i}containsPoint(r,t,e){var i;return!!(!((i=this.pickItem(r,t,null,e??{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(r,t,e,i){let s={group:null,graphic:null};if(r.attribute.visibleAll===!1)return s;let n=i.pickContext,o=n.modelMatrix;if(n.camera){let p=r.transMatrix,m=Fe.allocate();if($g(m,p),o){if(m){let g=Fe.allocate();n.modelMatrix=fn(g,o,m),Fe.free(m)}}else $g(m,r.globalTransMatrix),n.modelMatrix=m}if(this.InterceptorContributions.length)for(let p=0;p<this.InterceptorContributions.length;p++){let m=this.InterceptorContributions[p];if(m.beforePickItem){let g=m.beforePickItem(r,this,t,i,{parentMatrix:e});if(g)return n.modelMatrix!==o&&Fe.free(n.modelMatrix),n.modelMatrix=o,g}}let a=r.transMatrix,l=hi.allocateByObj(e),h=new Xt(t.x,t.y);l.transformPoint(h,h);let d=r.AABBBounds.containsPoint(h);if(!d&&!r.stage.camera)return s;let c=this.pickItem(r,h.clone(),e,i);c&&c.graphic&&(s.graphic=c.graphic,s.params=c.params);let u=r.attribute.pickable!==!1&&d;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),r.attribute.childrenPickable===!1||c&&c.graphic||$x(r,Je.zIndex,p=>{if(p.isContainer){let m=new Xt(t.x,t.y),g=dt(r).group,{scrollX:f=g.scrollX,scrollY:_=g.scrollY}=r.attribute;m.x-=f,m.y-=_,s=this.pickGroup(p,m,l,i)}else{let m=new Xt(t.x,t.y);l.transformPoint(m,m);let g=dt(r).group,{scrollX:f=g.scrollX,scrollY:_=g.scrollY}=r.attribute;m.x-=f,m.y-=_;let v=this.pickItem(p,m,e,i);v&&v.graphic&&(s.graphic=v.graphic,s.params=v.params)}return!!s.graphic||!!s.group},!0,!!n.camera),n.modelMatrix!==o&&Fe.free(n.modelMatrix),n.modelMatrix=o,s.graphic||s.group||!u||r.stage.camera||(s.group=r),hi.free(l),s}selectPicker(r){return this.pickerMap.get(r.numberType)||null}};hu=O6([q(),nb(0,lt($t)),nb(0,Zt(vn)),nb(1,lt($t)),nb(1,Zt(ta)),H6("design:paramtypes",[Object,Object])],hu);var N6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},V6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},xF=class{constructor(){this.global=j.global,this.global.hooks.onSetEnv.tap("global-picker-service",(r,t,e)=>{this.configure(e,t)}),this.configure(this.global,this.global.env)}configure(r,t){}pick(r,t,e){let i={graphic:null,group:null},s=new Kt(1,0,0,1,0,0),n;for(let o=0;o<r.length;o++){if(r[o].isContainer)i=this.pickGroup(r[o],t,s,e);else{let a=this.pickItem(r[o],t,s,e);a&&(i.graphic=a.graphic,i.params=a.params)}if(i.graphic)break;n||(n=i.group)}if(i.graphic||(i.group=n),i.graphic){let o=i.graphic;for(;o.parent;)o=o.parent;o.shadowHost&&(i.params={shadowTarget:i.graphic},i.graphic=o.shadowHost)}return i}containsPoint(r,t,e){return!!this.pickItem(r,t,null,e)}pickGroup(r,t,e,i){let s={group:null,graphic:null};if(r.attribute.visibleAll===!1)return s;let n=r.transMatrix,o=new Xt(t.x,t.y);e.transformPoint(o,o);let a=r.AABBBounds.containsPoint(o);if(!a)return s;let l=r.attribute.pickable!==!1&&a;return e.multiply(n.a,n.b,n.c,n.d,n.e,n.f),r.attribute.childrenPickable!==!1&&r.forEachChildren(h=>{if(h.isContainer)s=this.pickGroup(h,t,e,i);else{let d=new Xt(t.x,t.y);e.transformPoint(d,d);let c=this.pickItem(h,d,e,i);c&&(s.graphic=c.graphic,s.params=c.params)}return!!s.graphic||!!s.group}),s.graphic||s.group||!l||(s.group=r),s}pickItem(r,t,e,i){return r.attribute.pickable===!1?null:r.AABBBounds.containsPoint(t)?{graphic:r}:null}};xF=N6([q(),V6("design:paramtypes",[])],xF);function j6(r,t){let e,i,s=r[0].x,n=r[0].y,o=[r[0]];for(let a=1,l=r.length;a<l;a++)e=r[a].x-s,i=r[a].y-n,e*e+i*i>t&&(s=r[a].x,n=r[a].y,o.push(r[a]));return r[r.length-1].x===s&&r[r.length-1].y===n||o.push(r[r.length-1]),o}function bF(r,t,e){return r.length<=10?r:r=e?r:j6(r,t!==void 0?t*t:1)}var mo=class{constructor(){this.pools=[]}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},OM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.rect(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.rect(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},JEt=new OM,HM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.arc(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.arc(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},QEt=new HM,NM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.area(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.area(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},twt=new NM,VM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.circle(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.circle(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},ewt=new VM,jM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.line(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.line(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},iwt=new jM,zM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.path(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.path(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},rwt=new zM,GM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.symbol(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.symbol(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},z6=new GM,UM=class extends mo{allocate(t){if(!this.pools.length)return j.graphicService.creator.text(t);let e=this.pools.pop();return e.initAttributes(t),e}allocateByObj(t){if(!this.pools.length)return j.graphicService.creator.text(t.attribute);let e=this.pools.pop();return e.initAttributes(t.attribute),e}},G6=new UM,WM=class{constructor(){this.map={text:G6,symbol:z6}}gc(t){t.isContainer?t.forEachChildren(e=>this.gc(e)):this.gcItem(t)}gcItem(t){let e=this.map[t.type];e&&e.free(t)}},swt=new WM;var SF=!1,AF=new tt(r=>{SF||(SF=!0,r(af).toSelf().inSingletonScope(),r(Wh).to(af).inSingletonScope(),r(fe).toService(Wh),r(jg).toService(Si),Me(r,jg))});var CF=!1,TF=new tt(r=>{CF||(CF=!0,r(df).toSelf().inSingletonScope(),r(Zh).to(df).inSingletonScope(),r(fe).toService(Zh),r(of).toSelf(),r(nf).toSelf(),r(Hh).toService(of),r(Hh).toService(nf),r(Hh).toService(Si),Me(r,Hh))});var kF=!1,MF=new tt(r=>{kF||(kF=!0,r(Gh).toSelf().inSingletonScope(),r(ru).toSelf().inSingletonScope(),r(Kh).to(Gh).inSingletonScope(),r(fe).toService(Kh))});var DF=!1,EF=new tt(r=>{DF||(DF=!0,r(Uh).toSelf().inSingletonScope(),r(Yh).to(Uh).inSingletonScope(),r(fe).toService(Yh),r(zg).toService(Si),Me(r,zg),r(su).toSelf().inSingletonScope())});var wF=!1,PF=new tt(r=>{wF||(wF=!0,r(cf).toSelf().inSingletonScope(),r(Jh).to(cf).inSingletonScope(),r(fe).toService(Jh),r(Xg).toService(Si),Me(r,Xg))});var RF=!1,BF=new tt(r=>{RF||(RF=!0,r(lf).toSelf().inSingletonScope(),r(Xh).to(lf).inSingletonScope(),r(fe).toService(Xh),r(Gg).toService(Si),Me(r,Gg))});var LF=!1,IF=new tt(r=>{LF||(LF=!0,r(uf).to(Ox).inSingletonScope(),r(fe).toService(uf),r(Kg).toService(Si),Me(r,Kg))});var FF=!1,OF=new tt(r=>{FF||(FF=!0,r(hf).toSelf().inSingletonScope(),r($h).to(hf).inSingletonScope(),r(fe).toService($h),r(Wg).toService(Si),Me(r,Wg))});var HF=!1,NF=new tt(r=>{HF||(HF=!0,r(qh).to(Nx).inSingletonScope(),r(fe).toService(qh),r(Yg).toService(Si),Me(r,Yg))});var U6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},ob=class{constructor(){this.numberType=Fc}drawShape(r,t,e,i,s,n,o,a){s.drawContribution&&r.getSubGraphic().forEach(l=>{let h=s.drawContribution.getRenderContribution(l);h&&h.drawShape&&h.drawShape(l,t,e,i,s,n,o,a)})}draw(r,t,e,i){let{context:s}=e;if(!s||(s.highPerformanceSave(),!e.drawContribution))return;let n=dt(r),o=r.getSubGraphic();o.length&&o.forEach(a=>{e.drawContribution.renderItem(a,e,{theme:n})}),s.highPerformanceRestore()}};ob=U6([q()],ob);var VF=!1,SPt=new tt(r=>{VF||(VF=!0,r(mf).to(ob).inSingletonScope(),r(fe).toService(mf))});var W6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Y6=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},ab=class extends Le{constructor(){super(),this.numberType=Nc,this.builtinContributions=[Fx],this.init()}drawShape(r,t,e,i,s){let n=dt(r).richtext,{strokeOpacity:o=n.strokeOpacity,opacity:a=n.opacity,fillOpacity:l=n.fillOpacity,visible:h=n.visible}=r.attribute;if(!r.valid||!h)return;let d=js(a,l,!0),c=js(a,o,!0);d&&(t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,n),t.translate(e,i),this.beforeRenderStep(r,t,e,i,d,c,d,c,n,s),r.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(r,t,e,i,d,c,d,c,n,s))}drawIcon(r,t,e,i,s){var n;let o=dt(r).richtextIcon,{width:a=o.width,height:l=o.height,opacity:h=o.opacity,image:d,backgroundFill:c=o.backgroundFill,backgroundFillOpacity:u=o.backgroundFillOpacity,backgroundStroke:p=o.backgroundStroke,backgroundStrokeOpacity:m=o.backgroundStrokeOpacity,backgroundRadius:g=o.backgroundRadius,margin:f}=r.attribute,{backgroundWidth:_=a,backgroundHeight:v=l}=r.attribute;if(f&&(e+=r._marginArray[3],i+=r._marginArray[0]),r._hovered){let y=(_-a)/2,b=(v-l)/2;g===0?(t.beginPath(),t.rect(e-y,i-b,_,v)):(t.beginPath(),_s(t,e-y,i-b,_,v,g,!0)),c&&(t.globalAlpha=u,t.fillStyle=c,t.fill()),p&&(t.globalAlpha=m,t.strokeStyle=p,t.stroke())}let x=d&&((n=r?.resources)===null||n===void 0?void 0:n.get(d));x&&x.state==="success"&&(t.globalAlpha=h,t.drawImage(x.data,e,i,a,l))}draw(r,t,e){let i=dt(r).richtext;this._draw(r,i,!1,e)}};ab=W6([q(),Y6("design:paramtypes",[])],ab);var jF=!1,zF=new tt(r=>{jF||(jF=!0,r(pf).to(ab).inSingletonScope(),r(fe).toService(pf))});var GF=!1,UF=new tt(r=>{GF||(GF=!0,r(gf).to(jx).inSingletonScope(),r(fe).toService(gf),r(Ug).toService(Si),Me(r,Ug))});var du=class extends Le{stroke(t,e,i,s,n){let o=s.vertices;s.edges.forEach(a=>{let l=o[a[0]],h={x:t+l[0],y:e+l[1],z:i+l[2]},d=o[a[1]],c={x:t+d[0],y:e+d[1],z:i+d[2]};n.beginPath(),n.moveTo(h.x,h.y,h.z),n.lineTo(c.x,c.y,c.z),n.stroke()})}fill(t,e,i,s,n,o,a,l,h,d,c){let u=Nr.Get(o,Cr.Color255),p=s.vertices,m=p.map(f=>a.view(f[0],f[1],f[2])[2]),g=[];s.polygons.forEach((f,_)=>{if(n&&!n[_])return;g.push({faceIdx:_,polygon:f});let{polygon:v}=f,x=m[v[0]],y=m[v[1]],b=m[v[2]],S=m[v[3]];f.ave_z=x+y+b+S}),g.sort((f,_)=>_.polygon.ave_z-f.polygon.ave_z),g.forEach(f=>{let{polygon:_,normal:v}=f.polygon,x=p[_[0]],y=p[_[1]],b=p[_[2]],S=p[_[3]],C={x:t+x[0],y:e+x[1],z:i+x[2]},k={x:t+y[0],y:e+y[1],z:i+y[2]},M={x:t+b[0],y:e+b[1],z:i+b[2]},E={x:t+S[0],y:e+S[1],z:i+S[2]};a.beginPath(),a.moveTo(C.x,C.y,C.z),a.lineTo(k.x,k.y,k.z),a.lineTo(M.x,M.y,M.z),a.lineTo(E.x,E.y,E.z),a.closePath(),c?c(a,h&&h.attribute,d):(a.fillStyle=l?l.computeColor(v,u):o,a.fill())})}};var X6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},lb=class extends du{constructor(){super(...arguments),this.type="rect3d",this.numberType=ux}drawShape(r,t,e,i,s,n,o,a){var l;let h=dt(r,n?.theme).rect,{fill:d=h.fill,stroke:c=h.stroke,x1:u,y1:p,x:m,y:g,opacity:f=h.opacity,fillOpacity:_=h.fillOpacity,lineWidth:v=h.lineWidth,strokeOpacity:x=h.strokeOpacity,visible:y=h.visible}=r.attribute,{width:b,height:S}=r.attribute;b=(b??u-m)||0,S=(S??p-g)||0;let C=(l=this.z)!==null&&l!==void 0?l:0,k=zc(f,_,b,S,d),M=Gc(f,x,b,S),E=gs(d),D=gn(c,v);if(!r.valid||!y||!E&&!D||!(k||M||o||a))return;let{light:P}=s.stage||{},B=r.findFace();if(d!==!1){t.setCommonStyle(r,r.attribute,e,i,h);let L=d;typeof L!="string"&&(L="black"),this.fill(e,i,C,B,null,L,t,P,null,null,o)}c!==!1&&(t.setStrokeStyle(r,r.attribute,e,i,h),this.stroke(e,i,C,B,t))}draw(r,t,e){let i=dt(r).rect;this._draw(r,i,!1,e)}};lb=X6([q()],lb);var WF=!1,rRt=new tt(r=>{WF||(WF=!0,r(TM).to(lb).inSingletonScope(),r(fe).toService(TM))});var K6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o};function $6(r,t,e,i,s,n,o){let{startAngle:a,endAngle:l}=r.getParsedAngle(),h=Dt(l-a),d=l>a,c=!1;if(n<o){let u=n;n=o,o=u}if(n<=1e-12)t.moveTo(e,i,s);else if(h>=vt-1e-12)t.moveTo(e+n*Ce(a),i+n*ce(a),s),t.arc(e,i,n,a,l,!d,s),o>1e-12&&(t.moveTo(e+o*Ce(l),i+o*ce(l),s),t.arc(e,i,o,l,a,d,s));else{let{outerDeltaAngle:u,innerDeltaAngle:p,outerStartAngle:m,outerEndAngle:g,innerEndAngle:f,innerStartAngle:_}=r.getParsePadAngle(a,l),v=n*Ce(m),x=n*ce(m),y=o*Ce(f),b=o*ce(f);u<.001?c=!0:(t.moveTo(e+v,i+x,s),t.arc(e,i,n,m,g,!d,s)),!(o>1e-12)||p<.001?(t.lineTo(e+y,i+b,s),c=!0):(t.lineTo(e+y,i+b,s),t.arc(e,i,o,f,_,d,s))}return t.closePath(),c}function q6(r,t,e,i,s,n,o,a){let{startAngle:l,endAngle:h}=r.getParsedAngle(),d=Dt(h-l),c=h>l,u=!1;if(o<=1e-12)t.moveTo(e,i,s);else if(d>=vt-1e-12)t.moveTo(e+o*Ce(l),i+o*ce(l),s),t.arc(e,i,o,l,h,!c,s),t.lineTo(e+o*Ce(h),i+o*ce(h),n),t.arc(e,i,o,h,l,c,n);else{let{innerouterDeltaAngle:p,innerouterStartAngle:m,innerouterEndAngle:g}=a(l,h),f=o*Ce(m),_=o*ce(m),v=o*Ce(g),x=o*ce(g);p<.001?u=!0:(t.moveTo(e+f,i+_,s),t.arc(e,i,o,m,g,!c,s),t.lineTo(e+v,i+x,n),t.arc(e,i,o,g,m,c,n))}return t.closePath(),u}var hb=class extends Le{constructor(){super(...arguments),this.numberType=Ic}drawShape(r,t,e,i,s,n,o,a){var l;let h=dt(r,n?.theme).arc,{fill:d=h.fill}=r.attribute,c=this.valid(r,h,o,a);if(!c)return;let{fVisible:u,sVisible:p,doFill:m,doStroke:g}=c,f=(l=this.z)!==null&&l!==void 0?l:0,{outerPadding:_=h.outerPadding,innerPadding:v=h.innerPadding,height:x=10}=r.attribute,{outerRadius:y=h.outerRadius,innerRadius:b=h.innerRadius}=r.attribute;y+=_,b-=v;let S=Nr.Get(d,Cr.Color255),{light:C}=s.stage||{},k=s.hack_pieFace,M={top:f,bottom:f+x},E={top:[0,1,0],bottom:[0,-1,0],outside:[1,0,-1],inside:[1,0,-1]};k==="bottom"||k==="top"?(t.beginPath(),$6(r,t,e,i,M[k],y,b),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,h),m&&(o?o(t,r.attribute,h):u&&(t.setCommonStyle(r,r.attribute,e,i,h),t.fillStyle=C?C.computeColor(E[k],S):d,t.fill())),g&&(a?a(t,r.attribute,h):p&&(t.setStrokeStyle(r,r.attribute,e,i,h),t.stroke()))):k!=="outside"&&k!=="inside"||(k==="inside"&&(t.save(),t.beginPath(),t.arc(e,i,b,0,vt,!0,M.top),t.clip()),t.beginPath(),q6(r,t,e,i,M.top,M.bottom,k==="outside"?y:b,(D,P)=>{let{outerDeltaAngle:B,innerDeltaAngle:L,outerStartAngle:w,outerEndAngle:R,innerEndAngle:N,innerStartAngle:z}=r.getParsePadAngle(D,P);return k==="outside"?{innerouterDeltaAngle:B,innerouterEndAngle:R,innerouterStartAngle:w}:{innerouterDeltaAngle:L,innerouterEndAngle:N,innerouterStartAngle:z}}),t.setShadowBlendStyle&&t.setShadowBlendStyle(r,r.attribute,h),m&&(o?o(t,r.attribute,h):u&&(t.setCommonStyle(r,r.attribute,e,i,h),t.fillStyle=C?C.computeColor(E[k],S):d,t.fill())),g&&(a?a(t,r.attribute,h):p&&(t.setStrokeStyle(r,r.attribute,e,i,h),t.stroke())),k==="inside"&&t.restore())}draw(r,t,e,i){let s=dt(r,i?.theme).arc;this._draw(r,s,!1,e,i)}};hb=K6([q()],hb);var YF=!1,fRt=new tt(r=>{YF||(YF=!0,r(AM).to(hb).inSingletonScope(),r(fe).toService(AM))});var Z6=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},db=class extends du{constructor(){super(...arguments),this.type="pyramid3d",this.numberType=cx}drawShape(r,t,e,i,s,n,o,a){var l;let h=dt(r,n?.theme).polygon,{fill:d=h.fill,stroke:c=h.stroke,face:u=[!0,!0,!0,!0,!0,!0]}=r.attribute,p=(l=this.z)!==null&&l!==void 0?l:0;if(!this.valid(r,h,o,a))return;let{light:m}=s.stage||{},g=r.findFace();if(d!==!1){t.setCommonStyle(r,r.attribute,e,i,h);let f=d;typeof f!="string"&&(f="black"),this.fill(e,i,p,g,u,f,t,m,r,h,o)}c!==!1&&(t.setStrokeStyle(r,r.attribute,e,i,h),this.stroke(e,i,p,g,t))}draw(r,t,e){let i=dt(r).polygon;this._draw(r,i,!1,e)}};db=Z6([q()],db);var XF=!1,MRt=new tt(r=>{XF||(XF=!0,r(kM).to(db).inSingletonScope(),r(fe).toService(kM))});function KF(){Q.RegisterGraphicCreator("arc",ll)}function $F(){Q.RegisterGraphicCreator("area",ef)}function qF(){Q.RegisterGraphicCreator("circle",eM)}function ZF(){Q.RegisterGraphicCreator("group",qo)}function JF(){Q.RegisterGraphicCreator("image",sM)}function QF(){Q.RegisterGraphicCreator("line",Xc)}function tO(){Q.RegisterGraphicCreator("path",Dx)}function eO(){Q.RegisterGraphicCreator("polygon",aM)}function iO(){Q.RegisterGraphicCreator("rect",cr)}function rO(){Q.RegisterGraphicCreator("richtext",qc)}function sO(){Q.RegisterGraphicCreator("symbol",_n)}function nO(){Q.RegisterGraphicCreator("text",zs)}function oO(){Q.RegisterGraphicCreator("shadowRoot",gI)}var JBt=new ie;function Cf(r){let t=[];for(let e=0;e<r.length;e++){let i=r[e];e!==0&&i[0]===t[t.length-1]||t.push(i[0]),t.push(i[1])}return t}var ji=(r,t)=>(V(Tf.warnHandler)&&Tf.warnHandler.call(null,r,t),t?Nt.getInstance().warn(`[VChart warn]: ${r}`,t):Nt.getInstance().warn(`[VChart warn]: ${r}`)),ia=(r,t,e)=>{if(!Tf.silent){if(!V(Tf.errorHandler))throw new Error(r);Tf.errorHandler.call(null,r,t)}},Tf={silent:!1,warnHandler:!1,errorHandler:!1};var aO=au(),YM=aO&&globalThis?globalThis.document:void 0;function jr(r){return(r==="desktop-browser"||r==="mobile-browser")&&aO}function zr(r){return Gr(r)||r==="mobile-browser"}function Gr(r){return r.includes("miniApp")||r==="lynx"||r==="wx"||r==="harmony"}var XM=0;function ts(){return XM>=9999999&&(XM=0),XM++}function yn(r){return r!=null&&r!==""&&(!!J(r)||+r==+r)}function lO(r){if(K(r))return r;let t=+r;return K(t)?t:0}function ra(r){return!(!r||r.length===0)&&!T(r[0])&&!T(r[0].dataId)&&H(r[0].fields)}var hO=(r,t,e)=>(r.fields=t||[],r.fname=e,r);var dO=r=>t=>ft(t,r);var KM=r=>r,$M=r=>0;var td=r=>{Nt.getInstance().error(r)};var cO=r=>{let t=[],e=r.length,i,s,n,o=null,a=0,l="";r+="";let h=()=>{t.push(l+r.substring(i,s)),l="",i=s+1};for(i=0,s=0;s<e;s+=1)if(n=r[s],n==="\\")l+=r.substring(i,s),l+=r.substring(++s,++s),i=s;else if(n===o)h(),o=null,a=-1;else{if(o)continue;i===a&&n==='"'||i===a&&n==="'"?(i=s+1,o=n):n!=="."||a?n==="["?(s>i&&h(),i=s+1,a=i):n==="]"&&(a||td("Access path missing open bracket: "+r),a>0&&h(),a=0,i=s+1):s>i?h():i=s+1}return a&&td("Access path missing closing bracket: "+r),o&&td("Access path missing closing quote: "+r),s>i&&(s+=1,h()),t};var uO=(r,t,e={})=>{if(V(r))return r;let i=cO(r),s=i.length===1?i[0]:r;return hO((e&&e.get||dO)(i),[s],t||s)},Ur=(r,t,e={})=>{if(H(r)){let i=r.map(s=>uO(s,t,e));return s=>i.map(n=>n(s))}return uO(r,t,e)};var cb=(r,t)=>{let e=V(t)?t:n=>n,i,s;if(r&&r.length){let n=r.length;for(let o=0;o<n;o+=1){let a=e(r[o]);T(a)||!J(a=+a)||Number.isNaN(a)||(T(i)?(i=a,s=a):(i=Math.min(i,a),s=Math.max(s,a)))}return[i,s]}return[i,s]};var es=(r,t)=>T(r)?t:Z(r)?t*parseFloat(r)/100:r;function i7(r,t,e,i){let s=i-r*r,n=Math.abs(s)<1e-24?0:(e-r*t)/s;return[t-n*r,n]}function pO(r,t,e,i){let s,n,o=-1;r.forEach(a=>{s=t(a),n=e(a),!T(s)&&(s=+s)>=s&&!T(n)&&(n=+n)>=n&&i(s,n,++o)})}function r7(r,t,e,i,s){let n=0,o=0;return pO(r,t,e,(a,l)=>{let h=l-s(a),d=l-i;n+=h*h,o+=d*d}),1-n/o}function qM(r,t=i=>i.x,e=i=>i.y){let i=0,s=0,n=0,o=0,a=0;pO(r,t,e,(d,c)=>{++a,i+=(d-i)/a,s+=(c-s)/a,n+=(d*c-n)/a,o+=(d*d-o)/a});let l=i7(i,s,n,o),h=d=>l[0]+l[1]*d;return{coef:l,predict:h,rSquared:r7(r,t,e,s,h)}}function ZM(r){return r==="vertical"}var s7=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"],xe=class extends Vs{constructor(t,e){super(t),this._skipRenderAttributes=s7,e?.mode&&(this.mode=e.mode,this.setMode(e.mode)),e?.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(t,e,i,s){let n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,s);if(n)return this._setAttributes(n,i);xi(this.attribute[t])&&xi(e)&&!V(this.attribute[t])&&!V(e)?G(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){let i=Object.keys(t);this._mergeAttributes(t,i),i.every(s=>this._skipRenderAttributes.includes(s))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){T(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){let s=e[i];!xi(this.attribute[s])||V(this.attribute[s])||V(t[s])?this.attribute[s]=t[s]:G(this.attribute[s],t[s])}}bindEvents(){}_getNodeId(t){var e;return`${(e=this.id)!==null&&e!==void 0?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;let s=new ao(t,e);s.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(s)}};var Ci=Symbol.for("MathPickerContribution"),JM=Symbol.for("MathArcPicker"),QM=Symbol.for("MathAreaPicker"),tD=Symbol.for("MathCirclePicker"),cu=Symbol.for("MathImagePicker"),eD=Symbol.for("MathLinePicker"),iD=Symbol.for("MathPathPicker"),rD=Symbol.for("MathRectPicker"),sD=Symbol.for("MathSymbolPicker"),nD=Symbol.for("MathTextPicker"),oD=Symbol.for("MathPolygonPicker"),aD=Symbol.for("MathGlyphPicker"),lD=Symbol.for("CanvasArcPicker"),OFt=Symbol.for("CanvasArc3dPicker"),hD=Symbol.for("CanvasAreaPicker"),dD=Symbol.for("CanvasCirclePicker"),cD=Symbol.for("CanvasImagePicker"),HFt=Symbol.for("CanvasGifImagePicker"),uD=Symbol.for("CanvasLinePicker"),NFt=Symbol.for("CanvasLottiePicker"),pD=Symbol.for("CanvasPathPicker"),mD=Symbol.for("CanvasRectPicker"),VFt=Symbol.for("CanvasRect3dPicker"),gD=Symbol.for("CanvasSymbolPicker"),fD=Symbol.for("CanvasTextPicker"),_D=Symbol.for("CanvasPolygonPicker"),jFt=Symbol.for("CanvasPyramid3dPicker"),vD=Symbol.for("CanvasRichTextPicker"),zFt=Symbol.for("CanvasGlyphPicker"),yD=Symbol.for("CanvasGroupPicker"),Qe=Symbol.for("CanvasPickerContribution");var mO=(r,t)=>{let e=t.x-r.x,i=t.y-r.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},ub=(r,t)=>{let e=Math.abs(t.x-r.x),i=Math.abs(t.y-r.y);return Math.sqrt(e*e+i*i)},n7=r=>{let t=r.length;if(t===1)return{x:Math.round(r[0].x),y:Math.round(r[0].y)};let e=0,i=0,s=0;for(;s<t;)e+=r[s].x,i+=r[s].y,s++;return{x:Math.round(e/t),y:Math.round(i/t)}},kf=class extends lr.default{constructor(t,e={}){var i,s,n,o,a,l,h,d,c,u;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=p=>{this.startTime=lo.now();let{cachedEvents:m,startPoints:g}=this;p&&m.push(p.clone()),g.length=m.length;for(let f=0;f<m.length;f++){let{x:_,y:v}=m[f],x={x:_,y:v};g[f]=x}if(g.length!==1)this.startDistance=ub(g[0],g[1]),this.center=n7([g[0],g[1]]);else{let f=m[0];this.pressTimeout=setTimeout(()=>{f.direction="none",f.deltaX=0,f.deltaY=0,f.points=g,this.triggerStartEvent("press",f),this.triggerEvent("press",f),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=p=>{this.clearPressTimeout();let{startPoints:m,cachedEvents:g}=this;if(!m.length)return;let f=p.clone(),{x:_,y:v,pointerId:x}=f;for(let M=0,E=g.length;M<E;M++)if(x===g[M].pointerId){g[M]=f;break}let y={x:_,y:v},b=g.map(M=>({x:M.x,y:M.y})),S=lo.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=S,this.lastMovePoint=y,m.length===1){let M=m[0],E=_-M.x,D=v-M.y,P=this.direction||mO(M,y);this.direction=P;let B=this.getEventType(y);return f.direction=P,f.deltaX=E,f.deltaY=D,f.points=b,this.triggerStartEvent(B,f),void this.triggerEvent(B,f)}let{startDistance:C}=this,k=ub(b[0],b[1]);f.scale=k/C,f.center=this.center,f.points=b,this.triggerStartEvent("pinch",f),this.triggerEvent("pinch",f)},this.onEnd=p=>{let m=p.clone(),{cachedEvents:g,startPoints:f}=this,_=g.map(v=>({x:v.x,y:v.y}));if(m.points=_,this.triggerEndEvent(m),g.length===1){let v=lo.now(),x=this.lastMoveTime;if(v-x<100){let y=x-(this.prevMoveTime||this.startTime);if(y>0){let b=this.prevMovePoint||f[0],S=this.lastMovePoint||f[0],C=ub(b,S),k=C/y;if(k>this.config.swipe.velocity&&C>this.config.swipe.threshold)return m.velocity=k,m.direction=mO(b,S),this.triggerEvent("swipe",m),this.cachedEvents=[],this.startPoints=[],void this.reset()}}v-this.startTime<this.config.press.time&&(v-this.lastTapTime<this.config.tap.interval&&p.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=v,this.lastTapTarget=p.target,this.tapCount===1?this.triggerEvent("tap",m):this.tapCount===2&&(this.triggerEvent("doubletap",m),this.tapCount=0))}for(let v=0,x=g.length;v<x;v++)if(g[v].pointerId===m.pointerId){g.splice(v,1),f.splice(v,1);break}this.reset(),g.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(s=(i=e?.press)===null||i===void 0?void 0:i.time)!==null&&s!==void 0?s:251,threshold:(o=(n=e?.press)===null||n===void 0?void 0:n.threshold)!==null&&o!==void 0?o:9},swipe:{threshold:(l=(a=e?.swipe)===null||a===void 0?void 0:a.threshold)!==null&&l!==void 0?l:10,velocity:(d=(h=e?.swipe)===null||h===void 0?void 0:h.velocity)!==null&&d!==void 0?d:.3},tap:{interval:(u=(c=e?.tap)===null||c===void 0?void 0:c.interval)!==null&&u!==void 0?u:300}},this.initEvents()}initEvents(){let{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){let{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){let{eventType:e,startTime:i,startPoints:s}=this;if(e==="press")return e;let n;return n=lo.now()-i>this.config.press.time&&ub(s[0],t)<this.config.press.threshold?"press":"pan",this.eventType=n,n}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){let{emitThrottles:i}=this,s={type:t,ev:e};for(let n=0,o=i.length;n<o;n++)if(i[n].type===t)return void i.splice(n,1,s);i.push(s)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);let{throttleTimer:i,emitThrottles:s}=this;i||(this.throttleTimer=j.global.getRequestAnimationFrame()(()=>{j.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let n=0,o=s.length;n<o;n++){let{type:a,ev:l}=s[n];this.emitEvent(a,l)}this.emitThrottles.length=0}))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){let e=this.processEvent;Object.keys(e).forEach(i=>{this.triggerEvent(`${i}end`,t),i==="press"&&this.triggerEvent(`${i}up`,t),delete e[i]})}emitEvent(t,e){if(!this.element)return;let i=this.element._events[Qy];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let s=0,n=i.length;s<n&&!e.propagationImmediatelyStopped;s++)i[s].fn.call(i[s].context,e,t);this.emit(t,e)}};var o7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},a7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Jt=[0,0,0],l7=(r,t,e,i,s,n,o,a)=>{if(a)for(;e>t;)e-=vt;else for(;e<t;)e+=vt;let l=ge/3*(e>t?1:-1),h=t,d=h;for(;d!==e;){d=l>0?Math.min(d+l,e):Math.max(d+l,e);let c=Math.abs(d-h),u=4*Math.tan(c/4)/3,p=d<h?-1:1,m=Math.cos(h),g=Math.sin(h),f=Math.cos(d),_=Math.sin(d),v=m*n+i,x=g*o+s,y=f*n+i,b=_*o+s,S=n*u*p,C=o*u*p;r.push([v-S*g,x+C*m,y+S*_,b-C*f,y,b]),h=d}},xn=class{set fillStyle(r){this.nativeContext.fillStyle=r}get fillStyle(){return this.nativeContext.fillStyle}set font(r){this.nativeContext.font=r}get font(){return this.nativeContext.font}set globalAlpha(r){this.nativeContext.globalAlpha=r*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(r){this.nativeContext.lineCap=r}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(r){this.nativeContext.lineDashOffset=r}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(r){this.nativeContext.lineJoin=r}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(r){this.nativeContext.lineWidth=r}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(r){this.nativeContext.miterLimit=r}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(r){this.nativeContext.shadowBlur=r}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(r){this.nativeContext.shadowColor=r}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(r){this.nativeContext.shadowOffsetX=r}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(r){this.nativeContext.shadowOffsetY=r}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(r){this.nativeContext.strokeStyle=r}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(r){this.nativeContext.textAlign=r}get textAlign(){return this.nativeContext.textAlign}set textBaseline(r){this.nativeContext.textBaseline=r}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(r){r!==!!this._inuse&&(this._inuse=r,r?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(r,t){this.fillAttributes=Object.assign(Object.assign({},uk),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},pk),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},Ir),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;let e=r.nativeCanvas.getContext("2d");if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u83B7\u53D62d\u4E0A\u4E0B\u6587\u5931\u8D25");this.nativeContext=e,this.canvas=r,this.matrix=new Kt(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Kt(1,0,0,1,0,0),this._clearMatrix=new Kt(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&Nt.getInstance().warn("\u53EF\u80FD\u5B58\u5728bug\uFF0Cmatrix\u6CA1\u6709\u6E05\u7A7A"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Kt(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(r=!1){!r&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(r){return hi.allocateByObj(r)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(hi.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(hi.free(this.matrix),this.matrix=this.stack.pop())}rotate(r,t=!0){this.matrix.rotate(r),t&&this.setTransformForCurrent()}save(){let r=this.cloneMatrix(this.matrix);this.stack.push(r),this.nativeContext.save()}highPerformanceSave(){let r=this.cloneMatrix(this.matrix);this.stack.push(r)}scale(r,t,e=!0){this.matrix.scale(r,t),e&&this.setTransformForCurrent()}setScale(r,t,e=!0){this.matrix.setScale(r,t),e&&this.setTransformForCurrent()}scalePoint(r,t,e,i,s=!0){this.translate(e,i,!1),this.scale(r,t,!1),this.translate(-e,-i,!1),s&&this.setTransformForCurrent()}setTransform(r,t,e,i,s,n,o=!0,a=this.dpr){this.matrix.setValue(a*r,a*t,a*e,a*i,a*s,a*n),o&&this.setTransformForCurrent()}setTransformFromMatrix(r,t=!0,e=this.dpr){this.matrix.setValue(r.a*e,r.b*e,r.c*e,r.d*e,r.e*e,r.f*e),t&&this.setTransformForCurrent()}resetTransform(r=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),r&&this.setTransformForCurrent()}transform(r,t,e,i,s,n,o=!0){this.matrix.multiply(r,t,e,i,s,n),o&&this.setTransformForCurrent()}transformFromMatrix(r,t){this.matrix.multiply(r.a,r.b,r.c,r.d,r.e,r.f),t&&this.setTransformForCurrent()}translate(r,t,e=!0){this.matrix.translate(r,t),e&&this.setTransformForCurrent()}rotateDegrees(r,t=!0){let e=r*Math.PI/180;this.rotate(e,t)}rotateAbout(r,t,e,i=!0){this.translate(t,e,!1),this.rotate(r,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(r,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(r,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(r,t){r?typeof r=="string"?this.nativeContext.clip(r):this.nativeContext.clip(r,t):this.nativeContext.clip()}arc(r,t,e,i,s,n,o){if(o=o||0,this.camera){let a=[];l7(a,i,s,r,t,e,e,n);for(let l=0;l<a.length;++l){let h=a[l];this.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5],o)}}else this.nativeContext.arc(r,t,Math.max(0,e),i,s,n)}arcTo(r,t,e,i,s){this.nativeContext.arcTo(r,t,e,i,s)}bezierCurveTo(r,t,e,i,s,n,o){if(o=o||0,this.camera){let a=o,l=o;this.modelMatrix&&(fs(Jt,[r,t,o],this.modelMatrix),r=Jt[0],t=Jt[1],a=Jt[2],fs(Jt,[e,i,o],this.modelMatrix),e=Jt[0],i=Jt[1],l=Jt[2],fs(Jt,[s,n,o],this.modelMatrix),s=Jt[0],n=Jt[1],o=Jt[2]);let h=this.camera.vp(s,n,o);s=h.x,n=h.y,h=this.camera.vp(r,t,a),r=h.x,t=h.y,h=this.camera.vp(e,i,l),e=h.x,i=h.y}this.nativeContext.bezierCurveTo(r,t,e,i,s,n)}closePath(){this.nativeContext.closePath()}ellipse(r,t,e,i,s,n,o,a){a==null?this.nativeContext.ellipse(r,t,e,i,s,n,o):this.nativeContext.ellipse(r,t,e,i,s,n,o,a)}lineTo(r,t,e){if(e=e||0,this.camera){this.modelMatrix&&(fs(Jt,[r,t,e],this.modelMatrix),r=Jt[0],t=Jt[1],e=Jt[2]);let i=this.camera.vp(r,t,e);r=i.x,t=i.y}this.nativeContext.lineTo(r,t)}moveTo(r,t,e){if(e=e||0,this.camera){this.modelMatrix&&(fs(Jt,[r,t,e],this.modelMatrix),r=Jt[0],t=Jt[1],e=Jt[2]);let i=this.camera.vp(r,t,e);r=i.x,t=i.y}this.nativeContext.moveTo(r,t)}quadraticCurveTo(r,t,e,i,s){if(s=s||0,this.camera){let n=s;this.modelMatrix&&(fs(Jt,[r,t,s],this.modelMatrix),r=Jt[0],t=Jt[1],n=Jt[2],fs(Jt,[e,i,s],this.modelMatrix),e=Jt[0],i=Jt[1],s=Jt[2]);let o=this.camera.vp(e,i,s);e=o.x,i=o.y,o=this.camera.vp(r,t,n),r=o.x,t=o.y}this.nativeContext.quadraticCurveTo(r,t,e,i)}rect(r,t,e,i,s){s=s||0,this.camera?(this.moveTo(r,t,s),this.lineTo(r+e,t,s),this.lineTo(r+e,t+i,s),this.lineTo(r,t+i,s),this.closePath()):this.nativeContext.rect(r,t,e,i)}createImageData(){let r=arguments;return r.length===2?this.nativeContext.createImageData(r[0],r[1]):r.length===1?this.nativeContext.createImageData(r[0]):null}createLinearGradient(r,t,e,i){return isFinite(r+t+e+i)||(r=0,t=0,e=0,i=0),this.nativeContext.createLinearGradient(r,t,e,i)}createPattern(r,t){return r.width===0||r.height===0?null:this.nativeContext.createPattern(r,t)}createRadialGradient(r,t,e,i,s,n){return this.nativeContext.createRadialGradient(r,t,e,i,s,n)}createConicGradient(r,t,e,i){let s,n=!1,o=this;return{stops:[],addColorStop(a,l){this.stops.push([a,l]),n=!0},GetPattern(a,l,h){return n&&(h||(h=i-e),s=KL(o,this.stops,r,t,h,e,i,a,l),n=!1),s}}}fill(r,t){this.disableFill||(r?this.nativeContext.fill(r):this.nativeContext.fill())}fillRect(r,t,e,i){this.nativeContext.fillRect(r,t,e,i)}clearRect(r,t,e,i){this.nativeContext.clearRect(r,t,e,i)}project(r,t,e){if(e=e||0,this.camera){this.modelMatrix&&(fs(Jt,[r,t,e],this.modelMatrix),r=Jt[0],t=Jt[1],e=Jt[2]);let i=this.camera.vp(r,t,e);r=i.x,t=i.y}return{x:r,y:t}}view(r,t,e){return e=e||0,this.camera?(this.modelMatrix&&(fs(Jt,[r,t,e],this.modelMatrix),r=Jt[0],t=Jt[1],e=Jt[2]),this.camera.view(r,t,e)):[r,t,e]}fillText(r,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(fs(Jt,[t,e,i],this.modelMatrix),t=Jt[0],e=Jt[1],i=Jt[2]);let s=this.camera.vp(t,e,i);t=s.x,e=s.y}this.nativeContext.fillText(r,t,e)}getImageData(r,t,e,i){return this.nativeContext.getImageData(r,t,e,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(r,t){return this.nativeContext.isPointInPath(r,t)}isPointInStroke(r,t){return this.nativeContext.isPointInStroke(r,t)}measureText(r,t=j.global.measureTextMethod){var e,i;if(!t||t==="native")return this.nativeContext.measureText(r);this.mathTextMeasure||(this.mathTextMeasure=j.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));let s=(e=this.fontFamily)!==null&&e!==void 0?e:Ir.fontFamily,n=(i=this.fontSize)!==null&&i!==void 0?i:Ir.fontSize;return this.mathTextMeasure.textSpec.fontFamily===s&&this.mathTextMeasure.textSpec.fontSize===n||(this.mathTextMeasure.textSpec.fontFamily=s,this.mathTextMeasure.textSpec.fontSize=n,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(r,t)}putImageData(r,t,e){this.nativeContext.putImageData(r,t,e)}setLineDash(r){let t=arguments,e=this.nativeContext;this.nativeContext.setLineDash?t[0]&&e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])}stroke(r){this.disableStroke||(r?this.nativeContext.stroke(r):this.nativeContext.stroke())}strokeRect(r,t,e,i){this.nativeContext.strokeRect(r,t,e,i)}strokeText(r,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(fs(Jt,[t,e,i],this.modelMatrix),t=Jt[0],e=Jt[1],i=Jt[2]);let s=this.camera.vp(t,e,i);t=s.x,e=s.y}this.nativeContext.strokeText(r,t,e)}drawImage(){let r=this.nativeContext,t=arguments;t.length===3?r.drawImage(t[0],t[1],t[2]):t.length===5?r.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&r.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(r,t,e,i,s){if(Array.isArray(s)){if(s.length<=1)return this._setCommonStyle(r,t,e,i,s[0]);let n=Object.create(s[0]);return s.forEach((o,a)=>{a!==0&&Object.assign(n,o)}),this._setCommonStyle(r,t,e,i,n)}return this._setCommonStyle(r,t,e,i,s)}_setCommonStyle(r,t,e,i,s){let n=this.nativeContext;s||(s=this.fillAttributes);let{fillOpacity:o=s.fillOpacity,opacity:a=s.opacity,fill:l=s.fill}=t;n.globalAlpha=o*a*this.baseGlobalAlpha,o>1e-12&&a>1e-12&&(n.fillStyle=Ph(this,l,r,e,i))}setShadowBlendStyle(r,t,e){if(Array.isArray(e)){if(e.length<=1)return this._setShadowBlendStyle(r,e[0]);let i=Object.create(e[0]);return e.forEach((s,n)=>{n!==0&&Object.assign(i,s)}),this._setShadowBlendStyle(r,t,i)}return this._setShadowBlendStyle(r,t,e)}_setShadowBlendStyle(r,t,e){let i=this.nativeContext;e||(e=this.fillAttributes);let{opacity:s=e.opacity,shadowBlur:n=e.shadowBlur,shadowColor:o=e.shadowColor,shadowOffsetX:a=e.shadowOffsetX,shadowOffsetY:l=e.shadowOffsetY,blur:h=e.blur,filter:d=e.filter,globalCompositeOperation:c=e.globalCompositeOperation}=t;s<=1e-12||(n||a||l?(i.shadowBlur=n*this.dpr,i.shadowColor=o,i.shadowOffsetX=a*this.dpr,i.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0),h?(i.filter=`blur(${h}px)`,this._clearFilterStyle=!0):d?(i.filter=d,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),c?(i.globalCompositeOperation=c,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(r,t,e,i,s){if(Array.isArray(s)){if(s.length<=1)return this._setStrokeStyle(r,t,e,i,s[0]);let n=Object.create(s[0]);return s.forEach((o,a)=>{a!==0&&Object.assign(n,o)}),this._setStrokeStyle(r,t,e,i,n)}return this._setStrokeStyle(r,t,e,i,s)}_setStrokeStyle(r,t,e,i,s){let n=this.nativeContext;s||(s=this.strokeAttributes);let{strokeOpacity:o=s.strokeOpacity,opacity:a=s.opacity}=t;if(n.globalAlpha=o*a*this.baseGlobalAlpha,o>1e-12&&a>1e-12){let{lineWidth:l=s.lineWidth,stroke:h=s.stroke,lineJoin:d=s.lineJoin,lineDash:c=s.lineDash,lineDashOffset:u=s.lineDashOffset,lineCap:p=s.lineCap,miterLimit:m=s.miterLimit,keepStrokeScale:g=s.keepStrokeScale}=t;n.lineWidth=g?l:Vi(this,l,this.dpr),n.strokeStyle=Ph(this,h,r,e,i),n.lineJoin=d,c&&(n.setLineDash(c),n.lineDashOffset=u),n.lineCap=p,n.miterLimit=m}}setTextStyleWithoutAlignBaseline(r,t,e){let i=this.nativeContext;t||(t=this.textAttributes);let{scaleIn3d:s=t.scaleIn3d}=r;r.font?i.font=r.font:i.font=fh(r,t,s&&this.camera&&this.camera.getProjectionScale(e));let{fontFamily:n=t.fontFamily,fontSize:o=t.fontSize}=r;this.fontFamily=n,this.fontSize=o,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(r,t,e){var i,s;let n=this.nativeContext;t||(t=this.textAttributes),r.font?n.font=r.font:n.font=fh(r,t,this.camera&&this.camera.getProjectionScale(e));let{fontFamily:o=t.fontFamily,fontSize:a=t.fontSize}=r;this.fontFamily=o,this.fontSize=a,n.textAlign=(i=r.textAlign)!==null&&i!==void 0?i:t.textAlign,n.textBaseline=(s=r.textBaseline)!==null&&s!==void 0?s:t.textBaseline}draw(){}clearMatrix(r=!0,t=this.dpr){this.setTransformFromMatrix(this._clearMatrix,r,t)}setClearMatrix(r,t,e,i,s,n){this._clearMatrix.setValue(r,t,e,i,s,n)}onlyTranslate(r=this.dpr){return this.matrix.a===r&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===r}release(...r){this.stack.forEach(t=>hi.free(t)),this.stack.length=0}};xn.env="browser",xn=o7([q(),a7("design:paramtypes",[Object,Number])],xn);var h7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},d7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},cl=class extends ea{constructor(r){super(r)}init(r){let{container:t}=r;if(typeof t=="string"){let e=j.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new xn(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;let{nativeCanvas:r}=this;r.width=this._pixelWidth,r.height=this._pixelHeight,!r.style||this.setCanvasStyle(r,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(r),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){let r=this._nativeCanvas;r.style.position="absolute",r.style.top=`${this._y}px`,r.style.left=`${this._x}px`}resetStyle(r){if(!this.controled)return;let{width:t=this._displayWidth,height:e=this._displayHeight,dpr:i=this._dpr,x:s=this._x,y:n=this._y}=r,{nativeCanvas:o}=this;o.width=t*i,o.height=e*i,!o.style||this.setCanvasStyle(o,s,n,t,e),r.id&&(o.id=r.id),this.visiable||this.hide()}setCanvasStyle(r,t,e,i,s){this.controled&&(r.style.width=`${i}px`,r.style.height=`${s}px`)}toDataURL(r,t){return r==="image/jpeg"?this._nativeCanvas.toDataURL(r,t):r==="image/png"?this._nativeCanvas.toDataURL(r):this._nativeCanvas.toDataURL(r,t)}resize(r,t){this.controled&&(this._pixelWidth=r*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=r,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${r}px`,this._nativeCanvas.style.height=`${t}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};cl.env="browser",cl=h7([q(),d7("design:paramtypes",[Object])],cl);function uu(r,t){return new tt(e=>{e(Wy).toDynamicValue(()=>i=>new r(i)).whenTargetNamed(r.env),e(gk).toDynamicValue(()=>(i,s)=>new t(i,s)).whenTargetNamed(t.env)})}var gO=uu(cl,xn);var c7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},u7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},ed=function(r,t){return function(e,i){t(e,i,r)}},id=class extends hu{constructor(r,t,e,i){super(e,i),this.contributions=r,this.drawContribution=t,this.pickItemInterceptorContributions=e,this.pickServiceInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",(s,n,o)=>{this.configure(o,n)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(r=>{this.pickerMap.set(r.numberType,r)}),super._init()}configure(r,t){this.pickCanvas=pn.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(r,t,e,i){if(r.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){let h=this.InterceptorContributions[l];if(h.beforePickItem){let d=h.beforePickItem(r,this,t,i,{parentMatrix:e});if(d)return d}}let s=this.pickerMap.get(r.numberType);if(!s)return null;let n=s.contains(r,t,i),o=n?r:null,a={graphic:o,params:n};if(o)return a;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){let h=this.InterceptorContributions[l];if(h.afterPickItem){let d=h.afterPickItem(r,this,t,i,{parentMatrix:e});if(d)return d}}return a}};id=c7([q(),ed(0,lt($t)),ed(0,Zt(Qe)),ed(1,lt(eu)),ed(2,lt($t)),ed(2,Zt(vn)),ed(3,lt($t)),ed(3,Zt(ta)),u7("design:paramtypes",[Object,Object,Object,Object])],id);var p7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},pb=class{constructor(){this.type="group",this.numberType=Oc}contains(r,t,e){return!1}};pb=p7([q()],pb);var mb=new tt((r,t,e,i)=>{mb.__vloaded||(mb.__vloaded=!0,r(yD).to(pb).inSingletonScope(),r(Qe).toService(yD),Me(r,Qe))});mb.__vloaded=!1;var fO=mb;var m7=new tt((r,t,e,i)=>{e(id)||r(id).toSelf().inSingletonScope(),e(vs)?i(vs).toService(id):r(vs).toService(id)});function _O(r){r.load(fO),r.load(m7)}var Mf,g7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},f7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},ul=Mf=class extends dl{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${Mf.idprefix}_${Mf.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=j.global,this.viewBox=new ie,this.modelMatrix=new Kt(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(r){r.canvas?this.createWindowByCanvas(r):this.createWindowByConfig(r),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("\u53D1\u751F\u9519\u8BEF\uFF0C\u8BE5\u73AF\u5883\u4E0D\u5B58\u5728IntersectionObserver")}}isElementVisible(r){let t=r.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);let r=new IntersectionObserver((t,e)=>{t.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});r&&r.observe(this.canvas.nativeCanvas)}createWindowByConfig(r){let t=this.global.createCanvas({width:r.width,height:r.height}),e;if(e=typeof r.container=="string"?this.global.getElementById(r.container):r.container?r.container:this.global.getRootElement(),!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0CcontainerId\u53EF\u80FD\u4F20\u5165\u6709\u8BEF");r.offscreen?e=null:e.appendChild(t);let i={width:r.width,height:r.height,dpr:r.dpr,nativeCanvas:t,container:e,id:Mf.GenerateCanvasId(),canvasControled:!0};this.canvas=new cl(i)}createWindowByCanvas(r){var t;let e;if(typeof r.canvas=="string"){if(e=this.global.getElementById(r.canvas),!e)throw new Error("canvasId \u53C2\u6570\u4E0D\u6B63\u786E\uFF0C\u8BF7\u786E\u8BA4canvas\u5B58\u5728\u5E76\u63D2\u5165dom")}else e=r.canvas;if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u4F20\u5165\u7684canvas\u4E0D\u6B63\u786E");let i=r.width,s=r.height;if(i==null||s==null||!r.canvasControled){let o=e.getBoundingClientRect();i=o.width,s=o.height}let n=r.dpr;n==null&&(n=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new cl({width:i,height:s,dpr:n,nativeCanvas:e,canvasControled:r.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(r,t){this.canvas.resize(r,t)}setDpr(r){this.canvas.dpr=r}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(r,t,e){return this.canvas.nativeCanvas.addEventListener(r,t,e)}removeEventListener(r,t,e){return this.canvas.nativeCanvas.removeEventListener(r,t,e)}dispatchEvent(r){return this.canvas.nativeCanvas.dispatchEvent(r)}getStyle(){var r;return(r=this.canvas.nativeCanvas.style)!==null&&r!==void 0?r:{}}setStyle(r){this.canvas.nativeCanvas.style=r}getBoundingClientRect(){let r=this.canvas.nativeCanvas,t=this.getWH();return r.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(r){let t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),r&&(e.fillStyle=r,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}isVisible(r){return this._canvasIsIntersecting}onVisibleChange(r){this._onVisibleChangeCb=r}getTopLeft(r){return this.global.getElementTopLeft(this.canvas.nativeCanvas,r)}};ul.env="browser",ul.idprefix="visactor_window",ul.prefix_count=0,ul=Mf=g7([q(),f7("design:paramtypes",[])],ul);var vO=new tt(r=>{r(ul).toSelf(),r(Bh).toDynamicValue(t=>t.container.get(ul)).whenTargetNamed(ul.env)});var _7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},v7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},y7=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})},xD=class{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}};function yO(r,t=!1){let e=document.createElement("img");if(j.global.isImageAnonymous&&(e.crossOrigin="anonymous"),t){let i=new Blob([r],{type:"image/svg+xml"});r=window.URL.createObjectURL(i)}return e.src=r,e.complete?Promise.resolve(e):new Promise((i,s)=>{e.onload=()=>{i(e)},e.onerror=()=>{s(new Error("\u52A0\u8F7D\u5931\u8D25"))}})}var Df=class extends hl{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(r,t){var e,i;let s=0,n=0,o=0,a=0;if(r.changedTouches){let l=(e=r.changedTouches[0])!==null&&e!==void 0?e:{};s=l.clientX||0,n=l.clientY||0,o=s,a=n}else s=r.clientX||0,n=r.clientY||0,o=r.offsetX||0,a=r.offsetY||0;if(t){let l=s,h=n,d=t.getBoundingClientRect(),c=(i=t.getNativeHandler)===null||i===void 0?void 0:i.call(t).nativeCanvas,u,p;return c&&(u=d.width/c.offsetWidth,p=d.height/c.offsetHeight),{x:(l-d.left)/(K(u)?u:1),y:(h-d.top)/(K(p)?p:1)}}return{x:o,y:a}}getNativeAABBBounds(r){let t=r;if(typeof r=="string"&&(t=new DOMParser().parseFromString(r,"text/html").firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){let e=t.getBoundingClientRect();return new xD(e)}return new ie}removeDom(r){return r.parentElement.removeChild(r),!0}updateDom(r,t){let{width:e,height:i,style:s}=t;return s&&(Z(s)?r.setAttribute("style",s):Object.keys(s).forEach(n=>{r.style[n]=s[n]})),e!=null&&(r.style.width=`${e}px`),i!=null&&(r.style.height=`${i}px`),!0}createDom(r){let{tagName:t="div",parent:e}=r,i=document.createElement(t);if(this.updateDom(i,r),e){let s=Z(e)?this.getElementById(e):e;s&&s.appendChild&&s.appendChild(i)}return i}loadImage(r){return yO(r,!1).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(r){return yO(r,!0).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(r){var t,e;let i=document.createElement("canvas");r.id&&(i.id=(t=r.id)!==null&&t!==void 0?t:le.GenAutoIncrementId().toString());let s=(e=r.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return r.width&&r.height&&(i.style.width=`${r.width}px`,i.style.height=`${r.height}px`,i.width=r.width*s,i.height=r.height*s),i}createOffscreenCanvas(r){var t;let e=(t=r.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return new OffscreenCanvas(r.width*e,r.height*e)}releaseCanvas(r){let t;t=typeof r=="string"?document.getElementById(r):r,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(r,t,e){return document.addEventListener(r,t,e)}removeEventListener(r,t,e){return document.removeEventListener(r,t,e)}dispatchEvent(r){return document.dispatchEvent(r)}getElementById(r){return document.getElementById(r)}getRootElement(){return document.body}getDocument(){return document}release(...r){}getElementTop(r,t){let e=r.offsetTop,i=r.offsetParent;for(;i!==null;)e+=i.offsetTop,i=i.offsetParent;return e}getElementLeft(r,t){let e=r.offsetLeft,i=r.offsetParent;for(;i!==null;)e+=i.offsetLeft,i=i.offsetParent;return e}getElementTopLeft(r,t){let e=r.offsetTop,i=r.offsetLeft,s=r.offsetParent;for(;s!==null;)e+=s.offsetTop,i+=s.offsetLeft,s=s.offsetParent;return{top:e,left:i}}loadFont(r,t,e){return y7(this,void 0,void 0,function*(){return new FontFace(r,Z(t)?`url(${t})`:t,e).load().then(function(i){return document.fonts.add(i),{loadState:"success"}}).catch(function(i){return console.error("Failed to load font:",i),{loadState:"fail"}})})}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(r){return navigator.clipboard.writeText(r).then(()=>{}).catch(t=>{})}};Df=_7([q(),v7("design:paramtypes",[])],Df);var gb=new tt(r=>{gb.isBrowserBound||(gb.isBrowserBound=!0,r(Df).toSelf().inSingletonScope(),r(to).toService(Df))});gb.isBrowserBound=!1;function Ef(r,t=!0){Ef.__loaded||(Ef.__loaded=!0,r.load(gb),r.load(gO),r.load(vO),t&&_O(r))}Ef.__loaded=!1;var x7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},b7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},pu=function(r,t){return function(e,i){t(e,i,r)}},rd=class extends hu{constructor(r,t,e){super(t,e),this.contributions=r,this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=e,this.global.hooks.onSetEnv.tap("math-picker-service",(i,s,n)=>{this.configure(n,s)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(r=>{this.pickerMap.set(r.numberType,r)}),super._init()}configure(r,t){this.pickContext=new sb(null,1)}pickItem(r,t,e,i){if(r.attribute.pickable===!1)return null;let s=this.pickerMap.get(r.numberType);if(!s)return null;let n=s.contains(r,t,i),o=n?r:null;return o?{graphic:o,params:n}:null}};rd=x7([q(),pu(0,lt($t)),pu(0,Zt(Ci)),pu(1,lt($t)),pu(1,Zt(vn)),pu(2,lt($t)),pu(2,Zt(ta)),b7("design:paramtypes",[Object,Object,Object])],rd);var fb=new tt(r=>{fb.__vloaded||(fb.__vloaded=!0,Me(r,Ci))});fb.__vloaded=!1;var xO=fb;var ni=class{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise"||!this.canvasRenderer)return!0;let{pickContext:s}=i??{};if(!s)return!1;let n=t.getGraphicTheme();s.highPerformanceSave();let{x:o=n.x,y:a=n.y}=t.attribute;if(t.transMatrix.onlyTranslate()){let d=t.getOffsetXY(n);o+=d.x,a+=d.y,s.setTransformForCurrent()}else o=0,a=0,s.transformFromMatrix(t.transMatrix,!0);let l=!1,h=!1;return this.canvasRenderer.drawShape(t,s,o,a,{},null,(d,c,u,p)=>!(!l&&!h)||(l=d.isPointInPath(e.x,e.y),h=p||h,l),(d,c,u,p)=>{if(l||h)return!0;let m=c.lineWidth||u.lineWidth,g=c.pickStrokeBuffer||u.pickStrokeBuffer,f=c.keepStrokeScale||u.keepStrokeScale;return s.lineWidth=f?m+g:Vi(s,m+g,s.dpr),l=d.isPointInStroke(e.x,e.y),h=p||h,l}),s.highPerformanceRestore(),l}};var S7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},A7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},C7=function(r,t){return function(e,i){t(e,i,r)}},_b=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="arc",this.numberType=tl}};_b=S7([q(),C7(0,lt(Wh)),A7("design:paramtypes",[Object])],_b);var bO=!1,vb=new tt((r,t,e,i)=>{bO||(bO=!0,r(JM).to(_b).inSingletonScope(),r(Ci).toService(JM))});var T7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},k7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},M7=function(r,t){return function(e,i){t(e,i,r)}},yb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="area",this.numberType=ho}};yb=T7([q(),M7(0,lt(Yh)),k7("design:paramtypes",[Object])],yb);var SO=!1,xb=new tt((r,t,e,i)=>{SO||(SO=!0,r(QM).to(yb).inSingletonScope(),r(Ci).toService(QM))});var D7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},E7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},w7=function(r,t){return function(e,i){t(e,i,r)}},bb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="circle",this.numberType=el}};bb=D7([q(),w7(0,lt(Xh)),E7("design:paramtypes",[Object])],bb);var AO=!1,Sb=new tt((r,t,e,i)=>{AO||(AO=!0,r(tD).to(bb).inSingletonScope(),r(Ci).toService(tD))});var Ab=class{constructor(){this.type="glyph",this.numberType=Fc}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;let{pickContext:s}=i??{};if(!s)return!1;let n=i?.pickerService;if(n){let o=!1;return t.getSubGraphic().forEach(a=>{if(o)return;let l=n.pickItem(a,e,null,i);o=!(!l||!l.graphic)}),o}return!1}};var P7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},R7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},B7=function(r,t){return function(e,i){t(e,i,r)}},wf=class extends Ab{constructor(r){super(),this.canvasRenderer=r}};wf=P7([q(),B7(0,lt(mf)),R7("design:paramtypes",[Object])],wf);var CO=!1,TO=new tt((r,t,e,i)=>{CO||(CO=!0,r(aD).to(wf).inSingletonScope(),r(wf).toService(aD))});var L7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},pl=class{constructor(){this.type="image",this.numberType=il}contains(r,t,e){let{pickContext:i}=e??{};return!!i&&!!r.AABBBounds.containsPoint(t)}};pl=L7([q()],pl);var kO=!1,Cb=new tt((r,t,e,i)=>{kO||(kO=!0,r(cu).to(pl).inSingletonScope(),r(pl).toService(cu))});var I7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},F7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},O7=function(r,t){return function(e,i){t(e,i,r)}},Tb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="line",this.numberType=co}};Tb=I7([q(),O7(0,lt(Kh)),F7("design:paramtypes",[Object])],Tb);var MO=!1,kb=new tt((r,t,e,i)=>{MO||(MO=!0,r(eD).to(Tb).inSingletonScope(),r(Ci).toService(eD))});var H7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},N7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},V7=function(r,t){return function(e,i){t(e,i,r)}},Mb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="polygon",this.numberType=sl}};Mb=H7([q(),V7(0,lt(qh)),N7("design:paramtypes",[Object])],Mb);var DO=!1,Db=new tt((r,t,e,i)=>{DO||(DO=!0,r(oD).to(Mb).inSingletonScope(),r(Ci).toService(oD))});var j7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},z7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},G7=function(r,t){return function(e,i){t(e,i,r)}},Eb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="path",this.numberType=rl}};Eb=j7([q(),G7(0,lt($h)),z7("design:paramtypes",[Object])],Eb);var EO=!1,wb=new tt((r,t,e,i)=>{EO||(EO=!0,r(iD).to(Eb).inSingletonScope(),r(Ci).toService(iD))});var bD=new ie,mu=class{constructor(){this.type="rect",this.numberType=Hc}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;let{pickContext:s}=i??{};if(!s)return!1;let n=t.getGraphicTheme(),{cornerRadius:o=n.cornerRadius}=t.attribute,{x:a=n.x,y:l=n.y}=t.attribute;s.highPerformanceSave();let h=!0;if(t.transMatrix.onlyTranslate()){let c=t.getOffsetXY(n);a+=c.x,l+=c.y,s.setTransformForCurrent()}else a=0,l=0,h=!1,s.transformFromMatrix(t.transMatrix,!0);let d=!0;if(!h||t.shadowRoot||J(o,!0)&&o!==0||H(o)&&o.some(c=>c!==0))d=!1,this.canvasRenderer.drawShape(t,s,a,l,{},null,(c,u,p)=>!!d||(d=c.isPointInPath(e.x,e.y),d),(c,u,p)=>{if(d)return!0;let m=u.lineWidth||p.lineWidth,g=u.pickStrokeBuffer||p.pickStrokeBuffer,f=u.keepStrokeScale||p.keepStrokeScale;return s.lineWidth=f?m+g:Vi(s,m+g,s.dpr),d=c.isPointInStroke(e.x,e.y),d});else{let{fill:c=n.fill,stroke:u=n.stroke,lineWidth:p=n.lineWidth}=t.attribute;if(c)d=!0;else if(u){let m=t.AABBBounds;bD.setValue(m.x1,m.y1,m.x2,m.y2),bD.expand(-p/2),d=!bD.containsPoint(e)}}return s.highPerformanceRestore(),d}};var U7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},W7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},Y7=function(r,t){return function(e,i){t(e,i,r)}},Pb=class extends mu{constructor(r){super(),this.canvasRenderer=r}};Pb=U7([q(),Y7(0,lt(Zh)),W7("design:paramtypes",[Object])],Pb);var wO=!1,Rb=new tt((r,t,e,i)=>{wO||(wO=!0,r(rD).to(Pb).inSingletonScope(),r(Ci).toService(rD))});var PO=!1,Bb=new tt((r,t,e,i)=>{PO||(PO=!0,r(cu).to(pl).inSingletonScope(),r(pl).toService(cu))});var X7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},K7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},$7=function(r,t){return function(e,i){t(e,i,r)}},Lb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="symbol",this.numberType=nl}};Lb=X7([q(),$7(0,lt(Jh)),K7("design:paramtypes",[Object])],Lb);var RO=!1,Ib=new tt((r,t,e,i)=>{RO||(RO=!0,r(sD).to(Lb).inSingletonScope(),r(Ci).toService(sD))});var q7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Fb=class{constructor(){this.type="text",this.numberType=ol}contains(r,t,e){return!!r.AABBBounds.containsPoint(t)}};Fb=q7([q()],Fb);var BO=!1,Ob=new tt((r,t,e,i)=>{BO||(BO=!0,r(nD).to(Fb).inSingletonScope(),r(Ci).toService(nD))});var Z7=new tt((r,t,e,i)=>{e(rd)||r(rd).toSelf().inSingletonScope(),e(vs)?i(vs).toService(rd):r(vs).toService(rd)});function LO(r){r.load(xO),r.load(Z7),r.load(vb),r.load(xb),r.load(Sb),r.load(TO),r.load(Cb),r.load(kb),r.load(Db),r.load(wb),r.load(Rb),r.load(Bb),r.load(Ib),r.load(Ob)}var J7=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Q7=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},sd=class extends xn{constructor(r,t){super(r,t);let e=r.nativeCanvas.getContext("2d");if(!e)throw new Error("\u53D1\u751F\u9519\u8BEF\uFF0C\u83B7\u53D62d\u4E0A\u4E0B\u6587\u5931\u8D25");this.nativeContext=e,this.canvas=r,this.matrix=new Kt(1,0,0,1,0,0),this.stack=[],this.dpr=t??1}release(...r){}};sd.env="node",sd=J7([q(),Q7("design:paramtypes",[Object,Number])],sd);var tX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},eX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},ml=class extends ea{constructor(r){super(r)}init(){this._context=new sd(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...r){this._nativeCanvas.release&&V(this._nativeCanvas.release)&&this._nativeCanvas.release()}};ml.env="node",ml=tX([q(),eX("design:paramtypes",[Object])],ml);var IO=uu(ml,sd);var iX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},rX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},sX=function(r,t){return function(e,i){t(e,i,r)}},gu=class extends dl{get container(){return null}constructor(r){super(),this.global=r,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(r){r.canvas?this.createWindowByCanvas(r):this.createWindowByConfig(r)}createWindowByConfig(r){let t=this.global.createCanvas({width:r.width,height:r.height}),e={width:r.width,height:r.height,dpr:r.dpr,nativeCanvas:t,id:le.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new ml(e)}createWindowByCanvas(r){var t;let e=r.canvas,i=(t=r.dpr)!==null&&t!==void 0?t:1,s=r.width,n=r.height;s!=null&&n!=null&&r.canvasControled||(s=e.width/i,n=e.height/i),this.canvas=new ml({width:s,height:n,dpr:i,nativeCanvas:e,canvasControled:r.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(r,t){this.canvas.resize(r,t)}setDpr(r){this.canvas.dpr=r}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(r="image/png"){return this.canvas.nativeCanvas.toBuffer(r)}addEventListener(r,t,e){}dispatchEvent(r){return!0}removeEventListener(r,t,e){}getStyle(){}setStyle(r){}getBoundingClientRect(){return null}clearViewBox(r){}};gu.env="node",gu=iX([q(),sX(0,lt(Ga)),rX("design:paramtypes",[Object])],gu);var FO=new tt(r=>{r(gu).toSelf(),r(Bh).toDynamicValue(t=>t.container.get(gu)).whenTargetNamed(gu.env)});var nX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},Pf=class extends hl{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(r,t){r.env===this.type&&(r.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(r){let t=fetch(r).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(r){return fetch(r).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(r){let{loadImage:t}=this.pkg;return t?t(r).then(e=>({loadState:e?"success":"fail",data:e})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(r){let t=this.pkg.Resvg;if(!t)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));let e=new t(r).render().asPng();return this.loadImage(e)}createCanvas(r){return this.pkg.createCanvas(r.width,r.height)}releaseCanvas(r){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(r){return Bc.call(r)}}getCancelAnimationFrame(){return r=>{Bc.clear(r)}}addEventListener(r,t,e){}removeEventListener(r,t,e){}getElementById(r){return null}getRootElement(){return null}dispatchEvent(r){}release(...r){}createOffscreenCanvas(r){}};Pf=nX([q()],Pf);var Hb=new tt(r=>{Hb.isNodeBound||(Hb.isNodeBound=!0,r(Pf).toSelf().inSingletonScope(),r(to).toService(Pf))});Hb.isNodeBound=!1;function Rf(r,t=!0){Rf.__loaded||(Rf.__loaded=!0,r.load(Hb),r.load(IO),r.load(FO))}Rf.__loaded=!1;var oX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},nd=class extends xn{draw(){}createPattern(r,t){return null}};nd.env="wx",nd=oX([q()],nd);var aX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},lX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},gl=class extends ea{constructor(r){super(r)}init(){this._context=new nd(this,this._dpr)}release(...r){}};gl.env="wx",gl=aX([q(),lX("design:paramtypes",[Object])],gl);var OO=uu(gl,nd);var hX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},dX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},cX=function(r,t){return function(e,i){t(e,i,r)}},SD=class{constructor(){this.cache={}}addEventListener(t,e){t&&e&&(this.cache[t]=this.cache[t]||{listener:[]},this.cache[t].listener.push(e))}removeEventListener(t,e){if(!t||!e||!this.cache[t])return;let i=this.cache[t].listener.findIndex(s=>s===e);i>=0&&this.cache[t].listener.splice(i,1)}cleanEvent(){this.cache={}}},fu=class extends dl{get container(){return null}constructor(r){super(),this.global=r,this.type="wx",this.eventManager=new SD}getTitle(){return this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return{x:0,y:0}}createWindow(r){r.canvas?this.createWindowByCanvas(r):this.createWindowByConfig(r)}createWindowByConfig(r){let t=this.global.createCanvas({width:r.width,height:r.height}),e={width:r.width,height:r.height,dpr:r.dpr,nativeCanvas:t,id:le.GenAutoIncrementId().toString(),canvasControled:!1};this.canvas=new gl(e)}createWindowByCanvas(r){let t;if(typeof r.canvas=="string"){if(t=this.global.getElementById(r.canvas),!t)throw new Error("canvasId \u53C2\u6570\u4E0D\u6B63\u786E\uFF0C\u8BF7\u786E\u8BA4canvas\u5B58\u5728\u5E76\u63D2\u5165dom")}else t=r.canvas;let e=r.width,i=r.height;if(e==null||i==null||!r.canvasControled){let n=t.getBoundingClientRect();e=n.width,i=n.height}let s=r.dpr;s==null&&(s=t.width/e),this.canvas=new gl({width:e,height:i,dpr:s,nativeCanvas:t,canvasControled:r.canvasControled})}releaseWindow(){}resizeWindow(r,t){}setDpr(r){this.canvas.dpr=r}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(r,t){this.eventManager.addEventListener(r,t)}removeEventListener(r,t){this.eventManager.removeEventListener(r,t)}dispatchEvent(r){var t,e,i,s;let{type:n}=r;return!!this.eventManager.cache[n]&&(r.changedTouches&&r.changedTouches[0]&&(r.offsetX=r.changedTouches[0].x,r.changedTouches[0].offsetX=(t=r.changedTouches[0].x)!==null&&t!==void 0?t:r.changedTouches[0].pageX,r.changedTouches[0].clientX=(e=r.changedTouches[0].x)!==null&&e!==void 0?e:r.changedTouches[0].pageX,r.offsetY=r.changedTouches[0].y,r.changedTouches[0].offsetY=(i=r.changedTouches[0].y)!==null&&i!==void 0?i:r.changedTouches[0].pageY,r.changedTouches[0].clientY=(s=r.changedTouches[0].y)!==null&&s!==void 0?s:r.changedTouches[0].pageY),r.preventDefault=()=>{},r.stopPropagation=()=>{},this.eventManager.cache[n].listener&&this.eventManager.cache[n].listener.forEach(o=>{o(r)}),!0)}getStyle(){return{}}setStyle(r){}getBoundingClientRect(){let r=this.getWH();return{x:0,y:0,width:r.width,height:r.height,left:0,top:0,right:0,bottom:0}}clearViewBox(r){let t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),r&&(e.fillStyle=r,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}};fu.env="wx",fu=hX([q(),cX(0,lt(Ga)),dX("design:paramtypes",[Object])],fu);var HO=new tt(r=>{r(fu).toSelf(),r(Bh).toDynamicValue(t=>t.container.get(fu)).whenTargetNamed(fu.env)});var uX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},pX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},mX=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};function gX(r,t,e,i,s,n){return mX(this,void 0,void 0,function*(){let o=wx.getSystemInfoSync().pixelRatio;for(let a=0;a<t.length;a++){let l=t[a];e.has(l)||(yield new Promise(h=>{let d=wx.createSelectorQuery();n&&(d=d.in(n)),d.select(`#${l}`).fields({node:!0,size:!0}).exec(c=>{if(!c[0])return;let u=c[0].node,p=c[0].width,m=c[0].height;u.width=p*o,u.height=m*o,e.set(l,u),a>=i&&s.push(u),h(null)})}))}})}var Bf=class extends hl{constructor(){super(),this.type="wx",this.supportEvent=!0,this.canvasMap=new Map,this.freeCanvasList=[],this.canvasIdx=0,this.supportsTouchEvents=!0;try{this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsPointerEvents=!1,this.supportsMouseEvents=!1}this.applyStyles=!0}configure(r,t){if(r.env===this.type)return r.setActiveEnvContribution(this),gX(t.domref,t.canvasIdLists,this.canvasMap,t.freeCanvasIdx,this.freeCanvasList,t.component).then(()=>{})}loadImage(r){return Promise.resolve({data:r,loadState:"success"})}loadSvg(r){return Promise.reject()}createCanvas(r){let t=this.freeCanvasList[this.canvasIdx]||this.freeCanvasList[this.freeCanvasList.length-1];return this.canvasIdx++,t}createOffscreenCanvas(r){}releaseCanvas(r){}getDevicePixelRatio(){return wx.getSystemInfoSync().pixelRatio}getRequestAnimationFrame(){return function(r){return Bc.call(r)}}getCancelAnimationFrame(){return r=>{Bc.clear(r)}}addEventListener(r,t,e){return null}removeEventListener(r,t,e){return null}dispatchEvent(r){return null}getElementById(r){return this.canvasMap.get(r)}getRootElement(){return null}getDocument(){return null}release(...r){}mapToCanvasPoint(r){var t;return(t=r?.type)===null||t===void 0||t.startsWith("mouse"),r}};Bf=uX([q(),pX("design:paramtypes",[])],Bf);var Nb=new tt(r=>{Nb._isWxBound||(Nb._isWxBound=!0,r(Bf).toSelf().inSingletonScope(),r(to).toService(Bf))});Nb._isWxBound=!1;function Lf(r,t=!0){Lf.__loaded||(Lf.__loaded=!0,r.load(Nb),r.load(OO),r.load(HO),t&&LO(r))}Lf.__loaded=!1;var fX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},_X=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},vX=function(r,t){return function(e,i){t(e,i,r)}},Vb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="arc",this.numberType=tl}};Vb=fX([q(),vX(0,lt(Wh)),_X("design:paramtypes",[Object])],Vb);var NO=!1,VO=new tt((r,t,e,i)=>{NO||(NO=!0,r(lD).to(Vb).inSingletonScope(),r(Qe).toService(lD))});var yX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},xX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},bX=function(r,t){return function(e,i){t(e,i,r)}},jb=class extends mu{constructor(r){super(),this.canvasRenderer=r}};jb=yX([q(),bX(0,lt(Zh)),xX("design:paramtypes",[Object])],jb);var jO=!1,zO=new tt((r,t,e,i)=>{jO||(jO=!0,r(mD).to(jb).inSingletonScope(),r(Qe).toService(mD))});var _u=class extends Le{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;let{pickContext:s}=i??{};if(!s)return!1;s.highPerformanceSave();let n=t.getGraphicTheme(),o=this.transform(t,n,s),{x:a,y:l,z:h,lastModelMatrix:d}=o,c=e;if(s.camera){c=e.clone();let p=t.parent.globalTransMatrix;c.x=p.a*e.x+p.c*e.y+p.e,c.y=p.b*e.x+p.d*e.y+p.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,s,a,l,{},null,p=>!!u||(u=p.isPointInPath(c.x,c.y),u),(p,m,g)=>{if(u)return!0;let f=m.lineWidth||g.lineWidth,_=m.pickStrokeBuffer||g.pickStrokeBuffer,v=m.keepStrokeScale||g.keepStrokeScale;return s.lineWidth=v?f+_:Vi(s,f+_,s.dpr),u=p.isPointInStroke(c.x,c.y),u}),this.canvasRenderer.z=0,s.modelMatrix!==d&&Fe.free(s.modelMatrix),s.modelMatrix=d,s.highPerformanceRestore(),u}};var SX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},AX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},CX=function(r,t){return function(e,i){t(e,i,r)}},zb=class extends _u{constructor(r){super(),this.canvasRenderer=r,this.type="line",this.numberType=co}};zb=SX([q(),CX(0,lt(Kh)),AX("design:paramtypes",[Object])],zb);var GO=!1,UO=new tt((r,t,e,i)=>{GO||(GO=!0,r(uD).to(zb).inSingletonScope(),r(Qe).toService(uD))});var TX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},kX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},MX=function(r,t){return function(e,i){t(e,i,r)}},Gb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="area",this.numberType=ho}};Gb=TX([q(),MX(0,lt(Yh)),kX("design:paramtypes",[Object])],Gb);var WO=!1,YO=new tt((r,t,e,i)=>{WO||(WO=!0,r(hD).to(Gb).inSingletonScope(),r(Qe).toService(hD))});var vu=class extends Le{contains(t,e,i){let{pickContext:s}=i??{};if(!s)return!1;let n=t.getGraphicTheme();s.highPerformanceSave();let o=this.transform(t,n,s),{x:a,y:l,z:h,lastModelMatrix:d}=o,c=e;if(s.camera){c=e.clone();let p=t.parent.globalTransMatrix;c.x=p.a*e.x+p.c*e.y+p.e,c.y=p.b*e.x+p.d*e.y+p.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,s,a,l,i,null,(p,m,g)=>!!u||(u=p.isPointInPath(c.x,c.y),u)),this.canvasRenderer.z=0,s.modelMatrix!==d&&Fe.free(s.modelMatrix),s.modelMatrix=d,s.highPerformanceRestore(),u}};var DX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},EX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},wX=function(r,t){return function(e,i){t(e,i,r)}},Ub=class extends vu{constructor(r){super(),this.canvasRenderer=r,this.type="symbol",this.numberType=nl}contains(r,t,e){let{pickContext:i}=e??{};if(!i)return!1;let s=r.getParsedPath();if(!i.camera){if(!r.AABBBounds.containsPoint(t))return!1;if(s.isSvg||r.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();let n=r.getGraphicTheme(),o=this.transform(r,n,i),{x:a,y:l,z:h,lastModelMatrix:d}=o,c=t;if(i.camera){c=t.clone();let p=r.parent.globalTransMatrix;c.x=p.a*t.x+p.c*t.y+p.e,c.y=p.b*t.x+p.d*t.y+p.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(r,i,a,l,{},null,(p,m,g)=>!!u||(u=p.isPointInPath(c.x,c.y),u),(p,m,g)=>{if(u)return!0;let f=m.lineWidth||g.lineWidth,_=m.pickStrokeBuffer||g.pickStrokeBuffer,v=m.keepStrokeScale||g.keepStrokeScale;return i.lineWidth=v?f+_:Vi(i,f+_,i.dpr),u=p.isPointInStroke(c.x,c.y),u}),this.canvasRenderer.z=0,i.modelMatrix!==d&&Fe.free(i.modelMatrix),i.modelMatrix=d,i.highPerformanceRestore(),u}};Ub=DX([q(),wX(0,lt(Jh)),EX("design:paramtypes",[Object])],Ub);var XO=!1,KO=new tt((r,t,e,i)=>{XO||(XO=!0,r(gD).to(Ub).inSingletonScope(),r(Qe).toService(gD))});var PX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},RX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},BX=function(r,t){return function(e,i){t(e,i,r)}},Wb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="circle",this.numberType=el}};Wb=PX([q(),BX(0,lt(Xh)),RX("design:paramtypes",[Object])],Wb);var $O=!1,qO=new tt((r,t,e,i)=>{$O||($O=!0,r(dD).to(Wb).inSingletonScope(),r(Qe).toService(dD))});var LX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},IX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},FX=function(r,t){return function(e,i){t(e,i,r)}},Yb=class extends vu{constructor(r){super(),this.canvasRenderer=r,this.type="text",this.numberType=ol}contains(r,t,e){let{pickContext:i}=e??{};if(!i)return!1;let s=r.AABBBounds;if(!i.camera)return!!s.containsPoint(t);i.highPerformanceSave();let n=r.getGraphicTheme(),{keepDirIn3d:o=n.keepDirIn3d}=r.attribute,a=!o,l=this.transform(r,n,i,a),{x:h,y:d,z:c,lastModelMatrix:u}=l;this.canvasRenderer.z=c;let p=t;if(i.camera){p=t.clone();let g=r.parent.globalTransMatrix;p.x=g.a*t.x+g.c*t.y+g.e,p.y=g.b*t.x+g.d*t.y+g.f}let m=!1;return this.canvasRenderer.drawShape(r,i,h,d,{},null,(g,f,_)=>{if(m)return!0;let{fontSize:v=n.fontSize,textBaseline:x=n.textBaseline,textAlign:y=n.textAlign}=r.attribute,b=r.AABBBounds,S=b.height(),C=b.width(),k=Nh(x,S,v),M=Jo(y,C);return g.rect(M+h,k+d,C,S,c),m=g.isPointInPath(p.x,p.y),m},(g,f,_)=>m),this.canvasRenderer.z=0,i.modelMatrix!==u&&Fe.free(i.modelMatrix),i.modelMatrix=u,i.highPerformanceRestore(),m}};Yb=LX([q(),FX(0,lt(uf)),IX("design:paramtypes",[Object])],Yb);var ZO=!1,JO=new tt((r,t,e,i)=>{ZO||(ZO=!0,r(fD).to(Yb).inSingletonScope(),r(Qe).toService(fD))});var OX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},HX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},NX=function(r,t){return function(e,i){t(e,i,r)}},Xb=class extends _u{constructor(r){super(),this.canvasRenderer=r,this.type="path",this.numberType=rl}};Xb=OX([q(),NX(0,lt($h)),HX("design:paramtypes",[Object])],Xb);var QO=!1,t2=new tt((r,t,e,i)=>{QO||(QO=!0,r(pD).to(Xb).inSingletonScope(),r(Qe).toService(pD))});var VX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},jX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},zX=function(r,t){return function(e,i){t(e,i,r)}},Kb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="polygon",this.numberType=sl}};Kb=VX([q(),zX(0,lt(qh)),jX("design:paramtypes",[Object])],Kb);var e2=!1,i2=new tt((r,t,e,i)=>{e2||(e2=!0,r(_D).to(Kb).inSingletonScope(),r(Qe).toService(_D))});var GX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},UX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},WX=function(r,t){return function(e,i){t(e,i,r)}},$b=class{constructor(r){this.canvasRenderer=r,this.type="richtext",this.numberType=Nc}contains(r,t,e){return!!r.AABBBounds.containsPoint(t)}};$b=GX([q(),WX(0,lt(pf)),UX("design:paramtypes",[Object])],$b);var r2=!1,s2=new tt((r,t,e,i)=>{r2||(r2=!0,r(vD).to($b).inSingletonScope(),r(Qe).toService(vD))});var YX=function(r,t,e,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(o=(n<3?s(o):n>3?s(t,e,o):s(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},XX=function(r,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,t)},KX=function(r,t){return function(e,i){t(e,i,r)}},qb=class extends ni{constructor(r){super(),this.canvasRenderer=r,this.type="image",this.numberType=il}};qb=YX([q(),KX(0,lt(gf)),XX("design:paramtypes",[Object])],qb);var n2=!1,o2=new tt((r,t,e,i)=>{n2||(n2=!0,r(cD).to(qb).inSingletonScope(),r(Qe).toService(cD))});var Ti=au();function Zb(){Zb.__loaded||(Zb.__loaded=!0,KF(),yt.load(AF),yt.load(Ti?VO:vb))}Zb.__loaded=!1;var sa=Zb;function Jb(){Jb.__loaded||(Jb.__loaded=!0,$F(),yt.load(EF),yt.load(Ti?YO:xb))}Jb.__loaded=!1;var AD=Jb;function Qb(){Qb.__loaded||(Qb.__loaded=!0,qF(),yt.load(BF),yt.load(Ti?qO:Sb))}Qb.__loaded=!1;var CD=Qb;function tS(){tS.__loaded||(tS.__loaded=!0,ZF())}tS.__loaded=!1;var _e=tS;function eS(){eS.__loaded||(eS.__loaded=!0,JF(),yt.load(UF),yt.load(Ti?o2:Cb))}eS.__loaded=!1;var TD=eS;function iS(){iS.__loaded||(iS.__loaded=!0,QF(),yt.load(MF),yt.load(Ti?UO:kb))}iS.__loaded=!1;var is=iS;function rS(){rS.__loaded||(rS.__loaded=!0,tO(),yt.load(OF),yt.load(Ti?t2:wb))}rS.__loaded=!1;var na=rS;function sS(){sS.__loaded||(sS.__loaded=!0,eO(),yt.load(NF),yt.load(Ti?i2:Db))}sS.__loaded=!1;var od=sS;function nS(){nS.__loaded||(nS.__loaded=!0,iO(),yt.load(TF),yt.load(Ti?zO:Rb))}nS.__loaded=!1;var rs=nS;function oS(){oS.__loaded||(oS.__loaded=!0,rO(),yt.load(zF),yt.load(Ti?s2:Bb))}oS.__loaded=!1;var bn=oS;function aS(){aS.__loaded||(aS.__loaded=!0,oO())}aS.__loaded=!1;var If=aS;function lS(){lS.__loaded||(lS.__loaded=!0,sO(),yt.load(PF),yt.load(Ti?KO:Ib))}lS.__loaded=!1;var Mr=lS;function hS(){hS.__loaded||(hS.__loaded=!0,nO(),yt.load(IF),yt.load(Ti?JO:Ob))}hS.__loaded=!1;var Wr=hS;function dS(){_e(),rs()}var Sn=-.5*Math.PI,An=1.5*Math.PI,kD="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",a2=14,di;(function(r){r.selected="selected",r.selectedReverse="selected_reverse",r.hover="hover",r.hoverReverse="hover_reverse"})(di||(di={}));var wt={[di.selectedReverse]:{},[di.selected]:{},[di.hover]:{},[di.hoverReverse]:{}},MD={container:"",width:30,height:30,style:{}},l2="scrollDown",h2="scrollDrag",d2="scrollUp";var c2={debounce:Zi,throttle:Hi};dS();var fl=class r extends xe{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="scrollbar",this._onRailPointerDown=i=>{let{viewX:s,viewY:n}=i,{direction:o,width:a,height:l,range:h}=this.attribute,d=this._sliderSize,[c,u]=this._getScrollRange(),p;if(o==="vertical"){let m=n-this._viewPosition.y,g=ee(m-d/2,c,u);p=m/l,this._slider.setAttribute("y",g,!0)}else{let m=s-this._viewPosition.x,g=ee(m-d/2,c,u);p=m/a,this._slider.setAttribute("x",g,!0)}this.setScrollRange([p-(h[1]-h[0])/2,p+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{let{stopSliderDownPropagation:s=!0}=this.attribute;s&&i.stopPropagation();let{direction:n}=this.attribute,{x:o,y:a}=this.stage.eventPointTransform(i);this._prePos=n==="horizontal"?o:a,this._dispatchEvent(l2,{pos:this._prePos,event:i}),kt.env==="browser"?(kt.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),kt.addEventListener("pointerup",this._onSliderPointerUp)):(this.stage.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.addEventListener("pointerup",this._onSliderPointerUp),this.stage.addEventListener("pointerupoutside",this._onSliderPointerUp))},this._computeScrollValue=i=>{let{direction:s}=this.attribute,{x:n,y:o}=this.stage.eventPointTransform(i),a,l,h=0,{width:d,height:c}=this.getSliderRenderBounds();return s==="vertical"?(l=o,h=l-this._prePos,a=h/c):(l=n,h=l-this._prePos,a=h/d),[l,a]},this._onSliderPointerMove=i=>{let{stopSliderMovePropagation:s=!0}=this.attribute;s&&i.stopPropagation();let n=this.getScrollRange(),[o,a]=this._computeScrollValue(i);this.setScrollRange([n[0]+a,n[1]+a],!0),this._prePos=o},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:c2[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{i.preventDefault();let{range:s,limitRange:n=[0,1]}=this.attribute,o=this.getScrollRange(),[a,l]=this._computeScrollValue(i),h=[o[0]+l,o[1]+l];this._dispatchEvent(d2,{pre:s,value:Un(h,n[0],n[1])}),kt.env==="browser"?(kt.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),kt.removeEventListener("pointerup",this._onSliderPointerUp)):(this.stage.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),this.stage.removeEventListener("pointerup",this._onSliderPointerUp),this.stage.removeEventListener("pointerupoutside",this._onSliderPointerUp))}}setScrollRange(t,e=!0){let{direction:i="horizontal",limitRange:s=[0,1],range:n,realTime:o=!0}=this.attribute,a=Un(t,s[0],s[1]);if(e){let l=this._getSliderPos(a);if(this._slider){let h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=a,o&&this._dispatchEvent(h2,{pre:n,value:a})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;let{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",c2[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown)}render(){this._reset();let{direction:t="horizontal",width:e,height:i,range:s,limitRange:n=[0,1],railStyle:o,sliderStyle:a,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),d=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},o),"rect");this._rail=d;let c=this.getSliderRenderBounds(),u=this._getSliderPos(Un(s,n[0],n[1])),p=u[1]-u[0],m;this._sliderSize=p,m=t==="horizontal"?{x:u[0],y:c.y1,width:p,height:c.height}:{x:c.x1,y:u[0],width:c.width,height:p};let g=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},m),{cornerRadius:this._getDefaultSliderCornerRadius()}),a),{boundsPadding:Ni(l),pickMode:"imprecise"}),"rect");this._slider=g,this._container=h;let f=this._container.AABBBounds;this._viewPosition={x:f.x1,y:f.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;let{width:t,height:e,padding:i=2}=this.attribute,[s,n,o,a]=Ni(i),l={x1:a,y1:s,x2:t-n,y2:e-o,width:Math.max(0,t-(a+n)),height:Math.max(0,e-(s+o))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){let{direction:t,round:e}=this.attribute;if(e){let{width:i,height:s}=this.getSliderRenderBounds();return t==="horizontal"?s:i}return 0}_getSliderPos(t){let{direction:e}=this.attribute,{width:i,height:s,x1:n,y1:o}=this.getSliderRenderBounds();return e==="horizontal"?[i*t[0]+n,i*t[1]+n]:[s*t[0]+o,s*t[1]+o]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;let{limitRange:t=[0,1],direction:e}=this.attribute,[i,s]=Un(t,0,1),{width:n,height:o,x1:a,y1:l}=this.getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?Un([a+i*n,a+s*n],a,n-h):Un([l+i*o,l+s*o],l,o-h)}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}};fl.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};function Yr(r,t){r.forEachChildren(e=>{let i=t(e);e.isContainer&&!i&&Yr(e,t)})}function u2(r,t){if(!t)return[];let e=r.find(i=>i.name===t,!0);return e?e.getChildren():[]}function p2(r,t){if(!t)return[];let e=r.find(i=>i.name===t,!0);return e?e.findAll(i=>i.type!=="group",!0):[]}function m2(r){let t=[r[0]];for(let e=1;e<r.length;e++)r[e].x===r[e-1].x&&r[e].y===r[e-1].y||t.push(r[e]);return t}function ad(r){return r>=0&&r<Math.PI/2||r>3*Math.PI/2&&r<=2*Math.PI}function Ws(r,t,e){return Math.abs(r-t)<e}function cS(r,t,e){return r?{textAlign:"right",textBaseline:"middle"}:{textAlign:t<Math.PI&&e.toLocaleLowerCase().includes("top")||t>Math.PI&&e.toLocaleLowerCase().includes("bottom")?"left":t<Math.PI&&e.toLocaleLowerCase().includes("bottom")||t>Math.PI&&e.toLocaleLowerCase().includes("top")?"right":"center",textBaseline:t<Math.PI&&e.includes("inside")||t>Math.PI&&!e.includes("inside")?"bottom":"top"}}var $X=["#ffffff","#000000"];function Ff(r,t,e,i,s,n){if(typeof r!="string"||typeof t!="string")return r;let o=new Di(r).toHex(),a=new Di(t).toHex();return uS(o,a,e,i,n)?o:qX(o,a,e,i,s,n)}function qX(r,t,e,i,s,n){let o=[];s&&(s instanceof Array?o.push(...s):o.push(s)),o.push(...$X);for(let a of o)if(r!==a&&uS(a,t,e,i,n))return a}function uS(r,t,e,i,s){if(s==="lightness"){let n=Di.getColorBrightness(new Di(t));return Di.getColorBrightness(new Di(r))<.5?n>=.5:n<.5}return i?DD(r,t)>i:e==="largeText"?DD(r,t)>3:DD(r,t)>4.5}function DD(r,t){let e=g2(r),i=g2(t);return((e>i?e:i)+.05)/((e>i?i:e)+.05)}function g2(r){let t=Km(r),e=t[0]/255,i=t[1]/255,s=t[2]/255,n,o,a;return n=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),a=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),.2126*n+.7152*o+.0722*a}function Of(r,t,e,i){let s;switch(r){case"base":s=t;break;case"invertBase":s=e;break;case"similarBase":s=i}return s}function pS(r,t){return[r[0]*t,r[1]*t]}function ED(r){let[t,e]=r;return Math.sqrt(t*t+e*e)}function f2(r){let t=ED(r);return t>0&&(t=1/t),[r[0]*t,r[1]*t]}function ZX(r,t){let[e,i]=r,[s,n]=t,o=Math.sqrt((e*e+i*i)*(s*s+n*n)),a=o&&(e*s+i*n)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function _2(r,t,e){let i=ZX(r,t),s=Wm(r,t)>=0;return e?s?2*Math.PI-i:i:s?i:2*Math.PI-i}var yu=(r,t,e,i)=>new ps(Object.assign({defaultFontParams:Object.assign({fontFamily:kD,fontSize:a2},i),getTextBounds:e?void 0:rf,specialCharSet:`-/: .,@%'"~`+ps.ALPHABET_CHAR_SET+ps.ALPHABET_CHAR_SET.toUpperCase()},t??{}),r);function _l(r,t,e={}){if(!r)return{width:0,height:0};let i=rf({text:r,fontFamily:t.fontFamily||e.fontFamily||kD,fontSize:t.fontSize||e.fontSize||12,fontWeight:t.fontWeight||e.fontWeight,textAlign:t.textAlign||"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||e.fontSize||12});return{width:i.width(),height:i.height()}}function v2(r,t="type"){return y2(r,t)==="rich"}function y2(r,t="type"){var e,i;return ct(r.text)&&"type"in r.text?(e=r.text.type)!==null&&e!==void 0?e:"text":t in r&&(i=r[t])!==null&&i!==void 0?i:"text"}function wD(r){var t,e;return A(r.maxLineWidth)&&(r.maxWidth=r.maxLineWidth,delete r.maxLineWidth),r.width=(t=r.width)!==null&&t!==void 0?t:0,r.height=(e=r.height)!==null&&e!==void 0?e:0,r.textConfig=r.text.text||r.text,r}function JX(r){let{text:t,_originText:e}=r,{text:i}=t;return r.html=i,r.text=e,r.renderable=!1,r}function QX(r){let{text:t,_originText:e}=r,{text:i}=t;return r.react=i,r.text=e,r.renderable=!1,r}function oa(r,t="type"){let e=y2(r,t);return e==="rich"?Q.richtext(wD(r)):(e==="html"?r=JX(r):e==="react"&&(r=QX(r)),Q.text(r))}var ld=(r,t)=>{let e=Math.atan2(r,t);return e<0?e+2*Math.PI:e};function PD(r,t){let{x1:e,y1:i,x2:s,y2:n}=t,{x1:o,y1:a,x2:l,y2:h}=r.AABBBounds,d=0,c=0;return o<e&&(d=e-o),a<i&&(c=i-a),l>s&&(d=s-l),h>n&&(c=n-h),{dx:d,dy:c}}function xu(r,t){let{dx:e,dy:i}=PD(r,t),{dx:s=0,dy:n=0}=r.attribute;e&&r.setAttribute("dx",e+s),i&&r.setAttribute("dy",i+n)}function vl(){_e(),rs(),Mr(),bn(),Wr()}var x2=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};vl();var Wi=class r extends xe{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();let{text:s="",textStyle:n={},shape:o={},panel:a={},space:l=4,minWidth:h,maxWidth:d,padding:c=4,visible:u,state:p,type:m,textAlwaysCenter:g,containerTextAlign:f}=this.attribute,_=Ni(c),v=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group"),x,y=-_[3],b=-_[0],S=_[1]+_[3],C=_[0]+_[2],k=0,M=0,{visible:E}=o,D=x2(o,["visible"]);if(te(E)){let w=D?.size||10,R=J(w)?w:Math.max(w[0],w[1]);x=v.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:w,strokeBoundsBuffer:0},D),{visible:E,x:R/2,y:R/2}),"symbol"),st(p?.shape)||(x.states=p.shape),E&&(M=R+l)}let P;if(S+=M,k+=M,v2({text:s})||m==="rich"){let w=Object.assign(Object.assign(Object.assign({},wD(Object.assign({type:m,text:s},n))),n),{visible:A(s)&&u!==!1,x:k,y:0});P=v.createOrUpdateChild("tag-text",w,"richtext"),S+=P.AABBBounds.width(),C+=P.AABBBounds.height(),y+=P.AABBBounds.x1,b+=P.AABBBounds.y1}else{let w=Object.assign(Object.assign({text:ct(s)&&"type"in s&&s.type==="text"?s.text:s,visible:A(s)&&u!==!1,lineHeight:n?.fontSize},n),{x:k,y:0});T(w.lineHeight)&&(w.lineHeight=n.fontSize),P=v.createOrUpdateChild("tag-text",w,"text"),st(p?.text)||(P.states=p.text);let R=_l(w.text,n,(e=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||e===void 0?void 0:e.text),N=R.width,z=R.height;S+=N;let Y=(i=o.size)!==null&&i!==void 0?i:10,U=J(Y)?Y:Math.max(Y[0],Y[1]);C+=Math.max(z,o.visible?U:0);let{textAlign:$,textBaseline:ut}=n;(A(h)||A(d))&&(A(h)&&S<h&&(S=h),A(d)&&S>d&&(S=d,P.setAttribute("maxLineWidth",d-_[1]-_[2]))),y=0,b=0;let mt=0;$==="left"||$==="start"?mt=1:$==="right"||$==="end"?mt=-1:$==="center"&&(mt=0),mt?mt<0?(y-=S,x&&x.setAttribute("x",(x.attribute.x||0)-N),v.setAttribute("x",-_[1]-M)):mt>0&&v.setAttribute("x",_[3]):(y-=S/2,x&&x.setAttribute("x",(x.attribute.x||0)-N/2),v.setAttribute("x",-M/2));let bt=f==="right"||f==="end",Ot=f==="left"||f==="start";if((f?f==="center":g)&&mt){let me=S-_[1]-_[3],Lt=N+M,Ht=mt===1?(me-Lt)/2+M+N/2:_[0]+M-(S/2+Lt/2-M)+N/2;if(P.setAttributes({x:Ht,textAlign:"center"}),x){let de=Ht-N/2-M+U/2;x.setAttributes({x:de})}}if(Ot&&mt!==1){let me=S-_[1]-_[3],Lt=mt===0?-me/2+M/2:-S+_[3]+_[1]+M,Ht=Lt+M;if(P.setAttributes({x:Ht,textAlign:"left"}),x){let de=Lt+U/2;x.setAttributes({x:de})}}if(bt&&mt!==-1){let me=S-_[1]-_[3],Lt=mt===0?me/2+M/2:me;if(P.setAttributes({x:Lt,textAlign:"right"}),x){let Ht=Lt-N-M+U/2;x.setAttributes({x:Ht})}}ut==="middle"?(b-=C/2,x&&x.setAttribute("y",0)):ut==="bottom"?(b-=C,x&&x.setAttribute("y",-z/2),v.setAttribute("y",-_[2])):ut==="top"&&(v.setAttribute("y",_[0]),x&&x.setAttribute("y",z/2))}let{visible:B}=a,L=x2(a,["visible"]);if(u&&te(B)){let w=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},L),{visible:B&&!!s,width:S,height:C,x:y,y:b}),"rect");if(st(p?.panel)||(w.states=p.panel),L.customShape){let R=L.customShape;w.pathProxy=N=>R(this,N,new ne)}this._bgRect=w}this._textShape=P,this._symbol=x,this.resetStates()}initAttributes(t,e){t=e?.skipDefault?t:G({},r.defaultAttributes,t),super.initAttributes(t),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m;this._tagStates=(e=(t=this.currentStates)===null||t===void 0?void 0:t.slice())!==null&&e!==void 0?e:[],this._rectStates=(n=(s=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||s===void 0?void 0:s.slice())!==null&&n!==void 0?n:[],this._symbolStates=(l=(a=(o=this._symbol)===null||o===void 0?void 0:o.currentStates)===null||a===void 0?void 0:a.slice())!==null&&l!==void 0?l:[],this._textStates=(c=(d=(h=this._textShape)===null||h===void 0?void 0:h.currentStates)===null||d===void 0?void 0:d.slice())!==null&&c!==void 0?c:[],this.clearStates(),(u=this._bgRect)===null||u===void 0||u.clearStates(),(p=this._symbol)===null||p===void 0||p.clearStates(),(m=this._textShape)===null||m===void 0||m.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((t=this._bgRect)===null||t===void 0||t.useStates(this._rectStates)),this._symbolStates.length&&((e=this._symbol)===null||e===void 0||e.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}};Wi.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};var RD={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},b2={poptip:G({},RD)};function BD(r){G(b2.poptip,RD,r)}var Ys=class extends xe{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}};function S2(){_e(),is()}function A2(){_e(),sa()}function C2(){_e(),na()}function T2(){_e(),rs()}function k2(){_e(),sa()}S2();var hd=class r extends Ys{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderCrosshair(t){let{start:e,end:i,lineStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-line",Object.assign({points:[e,i]},s),"line")}setLocation(t){let{start:e,end:i}=t;this.setAttributes({start:e,end:i})}};hd.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};T2();var Hf=class r extends Ys{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderCrosshair(t){let{start:e,end:i,rectStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-rect",Object.assign({x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y},s),"rect")}setLocation(t){let{start:e,end:i}=t;this.setAttributes({start:e,end:i})}};Hf.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}};A2();var Nf=class r extends Ys{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderCrosshair(t){let{center:e,radius:i,lineStyle:s}=this.attribute;return t.createOrUpdateChild("crosshair-circle",Object.assign(Object.assign(Object.assign(Object.assign({},e),{outerRadius:i}),this.attribute),s),"arc")}setLocation(t){let{center:e}=this.attribute,i=pe.distancePP(t,e);this.setAttribute("radius",i)}};Nf.defaultAttributes={lineStyle:{stroke:["#b2bacf",!1,!1,!1],lineWidth:1,lineDash:[2]}};k2();var Vf=class r extends Ys{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderCrosshair(t){let{center:e,radius:i,innerRadius:s=0,sectorStyle:n}=this.attribute,{startAngle:o,endAngle:a}=this.attribute;return t.createOrUpdateChild("crosshair-sector",Object.assign(Object.assign(Object.assign({},e),{outerRadius:i,innerRadius:s,startAngle:o,endAngle:a}),n),"arc")}setLocation(t){let{center:e,startAngle:i=Sn,endAngle:s=An}=this.attribute,n=s-i,o=Xn(jv(e,t));this.setAttributes({startAngle:o-n/2,endAngle:o+n/2})}};Vf.defaultAttributes={sectorStyle:{fill:"#b2bacf",opacity:.2}};C2();var jf=class r extends Ys{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderCrosshair(t){let{center:e,radius:i,sides:s=6,lineStyle:n}=this.attribute,{startAngle:o,endAngle:a}=this.attribute,l=(a-o)%(2*Math.PI)==0,h=(a-o)/s,d;for(let c=0;c<=s;c++){let u=oe(e,i,o+h*c);c===0?d=`M${u.x},${u.y}`:d+=`L${u.x},${u.y}`,c===s&&l&&(d+="Z")}return t.createOrUpdateChild("crosshair-polygon",Object.assign({path:d},n),"path")}setLocation(t){let{center:e}=this.attribute,i=pe.distancePP(t,e);this.setAttribute("radius",i)}};jf.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};function zf(){_e(),is(),od(),Mr()}function Gf(){_e(),is(),sa(),Mr()}zf();var ys=class r extends xe{getStartAngle(){return Kn(this._startAngle)}getEndAngle(){return Kn(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();let{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:n=!0,multiSegment:o,mainSegmentIndex:a}=this.attribute;if(!n)return;this._computeLineAngle();let l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),d=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=d,o){let c=[...this.attribute.points];if(K(a))c[a]=this._clipPoints(c[a]);else{let u=this._clipPoints(Iv(c));c[0][0]=u[0],c[c.length-1][c[c.length-1].length-1]=u[u.length-1]}c.forEach((u,p)=>{var m,g;let f=Q.line(Object.assign(Object.assign({points:u},H(i)?(m=i[p])!==null&&m!==void 0?m:i[i.length-1]:i),{fill:!1}));f.name=`${this.name}-line`,f.id=this._getNodeId("line"+p),st(s?.line)||(f.states=H(s.line)?(g=s.line[p])!==null&&g!==void 0?g:s.line[s.line.length-1]:s.line),this.add(f),this.lines.push(f)})}else{let c=Q.line;O(i)[0].cornerRadius&&(c=Q.polygon);let u=c(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},O(i)[0]),{fill:!1,closePath:!1}));u.name=`${this.name}-line`,u.id=this._getNodeId("line"),st(s?.line)||(u.states=[].concat(s.line)[0]),this.add(u),this.lines.push(u)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;let{autoRotate:s=!0}=t,n;if(t&&t.visible){let o=this.getStartAngle(),a=this.getEndAngle(),{state:l}=this.attribute,h=e[0],d=e[e.length-1],{refX:c=0,refY:u=0,refAngle:p=0,style:m,symbolType:g,size:f=12}=t,_,v;i==="start"?(_={x:h.x+(K(o)?c*Math.cos(o)+u*Math.cos(o-Math.PI/2):0),y:h.y+(K(o)?c*Math.sin(o)+u*Math.sin(o-Math.PI/2):0)},v=this._computeStartRotate(this._startAngle)):(_={x:d.x+(K(a)?c*Math.cos(a)+u*Math.cos(a-Math.PI/2):0),y:d.y+(K(a)?c*Math.sin(a)+u*Math.sin(a-Math.PI/2):0)},v=this._computeEndRotate(this._endAngle)),n=Q.symbol(Object.assign(Object.assign(Object.assign({},_),{symbolType:g,size:f,angle:s?v+p:0,strokeBoundsBuffer:0}),m)),n.name=`${this.name}-${i}-symbol`,n.id=this._getNodeId(`${i}-symbol`),st(l?.symbol)||(n.states=l.symbol),i==="start"?st(l?.startSymbol)||(n.states=l.startSymbol):st(l?.endSymbol)||(n.states=l.endSymbol),this.add(n)}return n}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;let{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute,s;return s=e?K(i)?t[i]:Iv(t):t,this._mainSegmentPoints=s,s}_clipPoints(t){let{startSymbol:e={},endSymbol:i={}}=this.attribute,s=t;if(e.visible){let n=e.clip?e.size||10:0;s=[{x:t[0].x-n/2*(Math.cos(this._startAngle)||0),y:t[0].y-n/2*(Math.sin(this._startAngle)||0)},...s.slice(1)]}if(i.visible){let n=i.clip?i.size||10:0,o={x:t[t.length-1].x-n/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-n/2*(Math.sin(this._endAngle)||0)};s=[...s.slice(0,s.length-1),o]}return s}_computeLineAngle(){let t=this._getMainSegmentPoints();if(t.length<=1)return;let e=t[0],i=t[1],s=t[t.length-2],n=t[t.length-1],o=[e.x-i.x,e.y-i.y],a=Math.atan2(o[1],o[0]),l=[n.x-s.x,n.y-s.y],h=Math.atan2(l[1],l[0]);this._startAngle=a,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}};ys.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};Gf();var dd=class extends ys{constructor(t,e){super(e?.skipDefault?t:G({},ys.defaultAttributes,t)),this.name="arc-segment",this.key="arc-segment",this.isReverseArc=!1}getStartAngle(){let t=this.isReverseArc?this._startAngle+Math.PI/2:this._startAngle-Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getEndAngle(){let t=this.isReverseArc?this._endAngle-Math.PI/2:this._endAngle+Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getMainSegmentPoints(){return this._mainSegmentPoints}_computeStartRotate(t){return this.isReverseArc?t+Math.PI:t}_computeEndRotate(t){return this.isReverseArc?t:t+Math.PI}render(){this.removeAllChild(!0),this._reset();let{startSymbol:t,endSymbol:e,lineStyle:i,state:s,visible:n=!0,radius:o,startAngle:a,endAngle:l,center:h}=this.attribute;if(!n)return;this._startAngle=a,this._endAngle=l,this.isReverseArc=a>l;let d={x:h.x+o*Math.cos(this._startAngle),y:h.y+o*Math.sin(this._startAngle)},c={x:h.x+o*Math.cos(this._endAngle),y:h.y+o*Math.sin(this._endAngle)};this._mainSegmentPoints=[d,c];let u=this._renderSymbol(t,this._mainSegmentPoints,"start"),p=this._renderSymbol(e,this._mainSegmentPoints,"end");this.startSymbol=u,this.endSymbol=p;let m=Q.arc(Object.assign({x:h.x,y:h.y,startAngle:a,endAngle:l,innerRadius:o,outerRadius:o},i));m.name=`${this.name}-line`,m.id=this._getNodeId("arc"),st(s?.line)||(m.states=[].concat(s.line)[0]),this.add(m),this.line=m}};var oi;(function(r){r.innerView="inner-view",r.axisContainer="axis-container",r.labelContainer="axis-label-container",r.tickContainer="axis-tick-container",r.tick="axis-tick",r.subTick="axis-sub-tick",r.label="axis-label",r.title="axis-title",r.gridContainer="axis-grid-container",r.grid="axis-grid",r.gridRegion="axis-grid-region",r.line="axis-line",r.background="axis-background",r.axisLabelBackground="axis-label-background",r.axisBreak="axis-break",r.axisBreakSymbol="axis-break-symbol"})(oi||(oi={}));var bu;(function(r){r.selected="selected",r.selectedReverse="selected_reverse",r.hover="hover",r.hoverReverse="hover_reverse"})(bu||(bu={}));var Xs={[bu.selectedReverse]:{},[bu.selected]:{},[bu.hover]:{},[bu.hoverReverse]:{}},M2=999;var cd={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},LD={size:8,stroke:"#000",lineWidth:1,zIndex:1};function t9(r){let t=r.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:r.attribute.x,centerY:r.attribute.y,angle:r.attribute.angle}}function D2(r){r.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;let e=t9(t),i=Pa({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),s=i.x-e.centerX,n=i.y-e.centerY;e.x1+=s,e.x2+=s,e.y1+=n,e.y2+=n,e.centerX+=s,e.centerY+=n,t.rotatedBounds=e})}function E2(r,t){var e,i;return!((e=r.OBBBounds)===null||e===void 0)&&e.empty()||!((i=t.OBBBounds)===null||i===void 0)&&i.empty()?jo(r.AABBBounds,t.AABBBounds,!1)&&(!r.rotatedBounds||!t.rotatedBounds||Gv(r.rotatedBounds,t.rotatedBounds,!0)):r.OBBBounds.intersects(t.OBBBounds)}var w2=Math.sin(Math.PI/10);function mS(r,t=w2){let e=!T(r)&&r!==0,i=e?Math.cos(r):1;return e&&Math.abs(i)<=t}function Su(r,t=w2){let e=!T(r)&&r!==0,i=e?Math.sin(r):0;return!e||Math.abs(i)<=t}function e9(r,t){return{x:r.x+t[0],y:r.y+t[1]}}function P2(r={}){var t,e;let{style:i={},angle:s=.5*Math.PI}=r,n=G({},LD,i),o=(t=n.size)!==null&&t!==void 0?t:LD.size;return Object.assign(Object.assign({},n),{symbolType:(e=n.symbolType)!==null&&e!==void 0?e:`M ${-o/2} ${o*Math.sin(s)} L ${o/2} ${-o*Math.sin(s)}`,symbolSize:o})}function fS(r){let t={};return Yr(r,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function Uf(r,t){return{x:r.x+t[0],y:r.y+t[1]}}function gS(r,t,e,i=!1,s=!1){let n=[t.x-e.x,t.y-e.y];return pS(n,(i?-1:1)*(s?-1:1)*r/ED(n))}function ID(r){let t="center",e="middle";return t=(r=Kn(r))>=Math.PI*(5/3)||r<=Math.PI*(1/3)?"left":r>=Math.PI*(2/3)&&r<=Math.PI*(4/3)?"right":"center",e=r>=Math.PI*(7/6)&&r<=Math.PI*(11/6)?"bottom":r>=Math.PI*(1/6)&&r<=Math.PI*(5/6)?"top":"middle",{align:t,baseline:e}}function R2(r,t,e,i,s){let n=oe({x:0,y:0},e,r),o=Uf(n,gS(i,n,t,s));return e9(o,gS(i||1,o,t,s))}function _S(r,t,e,i,s){let n=[],o=s-i;for(let a=0;a<t;a++){let l=i+a*o/t;n.push(oe(r,e,l))}return n}function aa(r,t){let e="";return r.length===0||(r.forEach((i,s)=>{s===0?e=`M${i.x},${i.y}`:e+=`L${i.x},${i.y}`}),t&&(e+="Z")),e}function xs(r,t,e){var i;let s,n,o=(i=r.attribute)===null||i===void 0?void 0:i.angle,a=(l,h,d)=>(s=l.AABBBounds,n=h.AABBBounds,d>Math.max(n.x1-s.x2,s.x1-n.x2,n.y1-s.y2,s.y1-n.y2));return Su(o,Number.EPSILON)?a(r,t,e):(s=r.OBBBounds,n=t.OBBBounds,!s||!n||s.empty()||n.empty()?a(r,t,e):s.intersects(n))}function Wf(r,t){for(let e,i=1,s=r.length,n=r[0];i<s;n=e,++i)if(e=r[i],xs(n,e,t))return!0;return!1}var vS=(r,t,e)=>{let i=r.target;return i!==e&&i.name&&!st(i.states)?(i.addState(di.hover,!0),Yr(t,s=>{s!==i&&s.name&&!st(s.states)&&s.addState(di.hoverReverse,!0)}),i):e},yS=(r,t,e)=>e&&(Yr(t,i=>{i.name&&!st(i.states)&&(i.removeState(di.hoverReverse),i.removeState(di.hover))}),null),xS=(r,t,e)=>{let i=r.target;return e===i&&i.hasState(di.selected)?(Yr(t,s=>{s.name&&!st(s.states)&&(s.removeState(di.selectedReverse),s.removeState(di.selected))}),null):i.name&&!st(i.states)?(i.addState(di.selected,!0),Yr(t,s=>{s!==i&&s.name&&!st(s.states)&&s.addState(di.selectedReverse,!0)}),i):e};var Au=class extends xe{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=vS(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=yS(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=xS(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){let e=li(this.attribute);G(this.attribute,t);let i=Q.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&fS(this._innerView),this.removeAllChild(!0),this._innerView=Q.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;let{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){let{title:e,label:i,tick:s,line:n,items:o}=this.attribute,a=Q.group({x:0,y:0,zIndex:1,pickable:!1});if(a.name=oi.axisContainer,a.id=this._getNodeId("container"),a.setMode(this.mode),this.axisContainer=a,t.add(a),n&&n.visible&&this.renderLine(a),o&&o.length&&(this.data=this._transformItems(o[0]),s&&s.visible&&this.renderTicks(a),i&&i.visible)){let l=Q.group({x:0,y:0,pickable:!1});l.name=oi.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,a.add(l),o.forEach((h,d)=>{let c=this.renderLabels(l,h,d),u=c.getChildren();this.beforeLabelsOverlap(u,h,c,d,o.length),this.handleLabelsOverlap(u,h,c,d,o.length),this.afterLabelsOverlap(u,h,c,d,o.length);let p=0,m=0,g="center",f="middle",_=0;u.forEach((v,x)=>{var y;let b=v.attribute,S=(y=b.angle)!==null&&y!==void 0?y:0,C=v.AABBBounds,k=C.width(),M=C.height();S&&(k=Math.abs(k*Math.cos(S)),M=Math.abs(M*Math.sin(S))),p=Math.max(p,k),m=Math.max(m,M),g=b.textAlign,f=b.textBaseline,x===0&&(_=b.x)}),this.axisLabelLayerSize[d]={width:p,height:m,labelPos:_,textAlign:g,textBaseline:f}})}e&&e.visible&&this.renderTitle(a)}renderTicks(t){let e=this.getTickLineItems(),i=Q.group({x:0,y:0,pickable:!1});i.name=oi.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((n,o)=>{var a;let l=Q.line(Object.assign({},this._getTickLineAttribute("tick",n,o,e)));if(l.name=oi.tick,l.id=this._getNodeId(n.id),st((a=this.attribute.tick)===null||a===void 0?void 0:a.state))l.states=wt;else{let h=this.data[o],d=G({},wt,this.attribute.tick.state);Object.keys(d).forEach(c=>{V(d[c])&&(d[c]=d[c](h.rawValue,o,h,this.data))}),l.states=d}i.add(l)}),this.tickLineItems=e;let{subTick:s}=this.attribute;if(s&&s.visible){let n=this.getSubTickLineItems();n.length&&n.forEach((o,a)=>{let l=Q.line(Object.assign({},this._getTickLineAttribute("subTick",o,a,e)));if(l.name=oi.subTick,l.id=this._getNodeId(`${a}`),st(s.state))l.states=wt;else{let h=G({},wt,s.state);Object.keys(h).forEach(d=>{V(h[d])&&(h[d]=h[d](o.value,a,o,e))}),l.states=h}i.add(l)}),this.subTickLineItems=n}}renderLabels(t,e,i){let{dataFilter:s}=this.attribute.label;s&&V(s)&&(e=s(e,i));let n=this._transformItems(e),o=Q.group({x:0,y:0,pickable:!1});return o.name=`${oi.labelContainer}-layer-${i}`,o.id=this._getNodeId(`label-container-layer-${i}`),t.add(o),n.forEach((a,l)=>{var h;let d=this._getLabelAttribute(a,l,n,i),c=oa(d);if(c.name=oi.label,c.id=this._getNodeId(`layer${i}-label-${a.id}`),st((h=this.attribute.label)===null||h===void 0?void 0:h.state))c.states=wt;else{let u=G({},wt,this.attribute.label.state);Object.keys(u).forEach(p=>{V(u[p])&&(u[p]=u[p](a,l,n,i))}),c.states=u}c.data=Object.assign(Object.assign({},a),{index:l,layer:i}),o.add(c)}),o}renderTitle(t){let e=this.getTitleAttribute(),i=new Wi(Object.assign({},e));i.name=oi.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return Uf(t,this.getVerticalVector(e,i,t))}getTickLineItems(){let{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:s,inside:n=!1,length:o,dataFilter:a}=t,l=1;return e.length>=2&&(l=e[1].value-e[0].value),(a&&V(a)?a(e):e).forEach(h=>{let d=h.point,c=h.value;if(!s){let p=h.value-l/2;if(this.isInValidValue(p))return;d=this.getTickCoord(p),c=p}let u=this.getVerticalCoord(d,o,n);if(this.mode==="3d"){let p=this.getVerticalVector(o,n,d),m=0,g=0;Dt(p[0])>Dt(p[1])?m=ge/2*(u.x>d.x?1:-1):g=ge/2*(u.y>d.y?-1:1),i.push({start:d,end:u,value:c,id:`tick-${h.id}`,anchor:[d.x,d.y],alpha:m,beta:g})}else i.push({start:d,end:u,value:c,id:`tick-${h.id}`})}),i}getSubTickLineItems(){let{subTick:t}=this.attribute,e=[],{count:i=4,inside:s=!1,length:n=2}=t,o=this.tickLineItems,a=o.length;if(a>=2)for(let l=0;l<a-1;l++){let h=o[l],d=o[l+1];for(let c=0;c<i;c++){let u=(c+1)/(i+1),p=(1-u)*h.value+u*d.value,m=this.getTickCoord(p),g=this.getVerticalCoord(m,n,s);e.push({start:m,end:g,value:p,id:`sub-tick-${p}`})}}return e}_getTickLineAttribute(t,e,i,s){let n=ft(this.attribute,`${t}.style`),o=this.data[i];n=V(n)?G({},ft(cd,`${t}.style`),t==="tick"?n(o.rawValue,i,o,this.data):n(e.value,i,e,s)):n;let{start:a,end:l,anchor:h,alpha:d,beta:c}=e;return Object.assign({points:[a,l],anchor:h,alpha:d,beta:c},n)}_getLabelAttribute(t,e,i,s){var n,o;let{space:a=4,inside:l=!1,formatMethod:h,type:d="text",text:c}=this.attribute.label,u=a,p=0;!((n=this.attribute.tick)===null||n===void 0)&&n.visible&&this.attribute.tick.inside===l&&(p=this.attribute.tick.length||4),!((o=this.attribute.subTick)===null||o===void 0)&&o.visible&&this.attribute.subTick.inside===l&&(p=Math.max(p,this.attribute.subTick.length||2)),u+=p;let m=this.getRelativeVector(t.point);s>0&&(m[1]===0?u+=(this.axisLabelLayerSize[s-1].height+ft(this.attribute,"label.space",4))*s:u+=(this.axisLabelLayerSize[s-1].width+ft(this.attribute,"label.space",4))*s);let g=this.getVerticalCoord(t.point,u,l),f=this.getVerticalVector(u||1,l,g),_=h?h(`${t.label}`,t,e,i,s):t.label,{style:v}=this.attribute.label;v=V(v)?G({},cd.label.style,v(t,e,i,s)):v;let x=this.getLabelAlign(f,l,v.angle);return v=G(x,v),V(v.text)&&(v.text=v.text({label:t.label,value:t.rawValue,index:t.index,layer:s})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(g,f,_,v)),{text:c??_,_originText:t.label,lineHeight:v?.fontSize,type:d}),v)}getLabelPosition(t,e,i,s){return t}_transformItems(t){let e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}};var B2={parity:function(r){return r.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(r,t){let e;return r.filter((i,s)=>s&&xs(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function i9(r){let t;return t=r.OBBBounds.empty()?r.AABBBounds:r.OBBBounds,t.width()>1&&t.height()>1}function r9(r){return r.forEach(t=>t.setAttribute("opacity",1)),r}function L2(r,t,e,i,s=!1){if(e&&!r.attribute.opacity){let n=t.length;if(n>1){r.setAttribute("opacity",1);for(let o=0;o<n;o++){let a=s?t[n-1-o]:t[o];if(!i(a))break;a.setAttribute("opacity",0)}}}}function bS(r,t){if(st(r))return;let e=r.filter(i9);if(st(e))return;let i;i=r9(e);let{method:s="parity",separation:n=0}=t,o=V(s)?s:B2[s]||B2.parity;if(i.length>=3&&Wf(i,n)){do i=o(i,n);while(i.length>=3&&Wf(i,n));let a=(u,p,m=!0)=>m&&u<3||p,l=a(i.length,t.firstVisible,!1),h=a(i.length,t.lastVisible),d=e[0],c=It(e);xs(d,c,n)&&l&&h&&(c.setAttribute("opacity",0),h=!1),L2(d,i,l,u=>xs(u,d,n)),L2(c,i,h,u=>xs(u,c,n)||!(!l||u===d)&&xs(u,d,n),!0)}e.forEach(a=>{a.setAttribute("visible",!!a.attribute.opacity)})}function I2(r,t){if(st(r))return;let{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||r.some(o=>!!o.attribute.angle))return;let s=0,n=0;for(i&&i.length>0&&(n=i.length);s<n;){let o=i[s++];if(r.forEach(a=>{a.attribute.angle=Ut(o)}),n9(e,r),!s9(r))break}}function s9(r){for(let t=1;t<r.length;t++)if(E2(r[t-1],r[t]))return!0;return!1}function n9(r,t){r!=="bottom"&&r!=="top"||a9(r,t),r!=="left"&&r!=="right"||o9(r,t),D2(t)}function SS(r=0){if(r<0)for(;r<0;)r+=2*Math.PI;if(r>0)for(;r>=2*Math.PI;)r-=2*Math.PI;return r}function o9(r,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},OD(r,e.attribute.angle)),{angle:SS(e.attribute.angle)}))})}function a9(r,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},FD(r,e.attribute.angle)),{angle:SS(e.attribute.angle)}))})}function FD(r,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];r==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);let s=(t=SS(t))/(.5*Math.PI),n;return n=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[n],textBaseline:i[n]}}function OD(r,t=0){let e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];r==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);let s=(t=SS(t))/(.5*Math.PI),n;return n=s===Math.floor(s)?2*Math.floor(s):2*Math.floor(s)+1,{textAlign:e[n],textBaseline:i[n]}}function l9(r){return K(r)?{left:r,right:r}:ct(r)?{left:r.left||0,right:r.right||0}:{left:0,right:0}}function F2(r,t){let{limitLength:e,verticalLimitLength:i,ellipsis:s="...",orient:n,axisLength:o}=t;if(st(r)||!K(e))return;let a=l9(t.overflowLimitLength),l=r[0],h=l.attribute.angle,d=!T(h),c=d?Math.cos(h):1,u=d?Math.sin(h):0,p=Su(h),m=mS(h),g=n==="top"||n==="bottom",f=l.attribute.direction,_=!p&&!m&&g&&(r.length<2||r.some(v=>Math.abs(v.AABBBounds.width()-l.AABBBounds.width())>=2))&&l.AABBBounds.width()>Math.abs(e/u);r.forEach(v=>{var x;if(g&&(m&&Math.floor(v.AABBBounds.height())<=e||p&&Math.floor(v.AABBBounds.width())<=i)||!g&&(f==="vertical"&&Math.floor(v.AABBBounds.height())<=i||f!=="vertical"&&(p&&Math.floor(v.AABBBounds.width())<=e||m&&Math.floor(v.AABBBounds.height())<=i)))return;let y=null;if(p||m)y=g?p?i:e:f==="vertical"||m?i:e;else if(g){let{x1:b,x2:S}=v.AABBBounds,C=u/c,k=Math.abs(e/u);if(_&&C>0&&b<=o+a.right&&e/C+b>o+a.right){let M=(o-b+a.right)/Math.abs(c);y=Math.min(M,k)}else if(_&&C<0&&S>=-a.left&&e/C+S<-a.left){let M=(S+a.left)/Math.abs(c);y=Math.min(M,k)}else y=k}else y=Math.abs(e/c);K(v.attribute.maxLineWidth)&&(y=K(y)?Math.min(v.attribute.maxLineWidth,y):v.attribute.maxLineWidth),v.setAttributes({maxLineWidth:y,ellipsis:(x=v.attribute.ellipsis)!==null&&x!==void 0?x:s})})}function H2(r,t){let{limitLength:e,axisLength:i,ellipsis:s="...",orient:n}=t;if(st(r)||!K(e))return;let o=r[0].attribute.angle,a=Su(o),l=mS(o),h=n==="top"||n==="bottom",d=i/r.length;r.forEach((c,u)=>{var p,m,g,f,_;if(h){if(l&&Math.floor(c.AABBBounds.height())<=e)return;if(a){let y=O2(c.attribute.x,(p=r[u+1])===null||p===void 0?void 0:p.attribute.x,(m=r[u-1])===null||m===void 0?void 0:m.attribute.x);K(y)&&(d=Ge(d,y))}}else{if(l){let y=O2(c.attribute.y,(g=r[u+1])===null||g===void 0?void 0:g.attribute.y,(f=r[u-1])===null||f===void 0?void 0:f.attribute.y);K(y)&&(d=Ge(d,y))}if(a&&Math.floor(c.AABBBounds.width())<=e)return}let v=null,x=null;h?l?(v=e,x=d):(v=d,x=e):l?(v=d,x=e):(v=e,x=d),c.setAttributes({maxLineWidth:v,ellipsis:(_=c.attribute.ellipsis)!==null&&_!==void 0?_:s,whiteSpace:"normal",heightLimit:x})})}function O2(r,t,e){let i;return K(t)&&(i=Math.abs(t-r)),K(e)&&(i=K(i)?Math.min(Math.abs(r-e),i):Math.abs(r-e)),i}function N2(r,t,e,i,s){i==="left"||i==="right"?s==="left"?r.forEach(n=>{var o;n.setAttributes({dx:((o=n.attribute.dx)!==null&&o!==void 0?o:0)+t-n.AABBBounds.x1})}):s==="right"?r.forEach(n=>{var o;n.setAttributes({dx:((o=n.attribute.dx)!==null&&o!==void 0?o:0)+t+e-n.AABBBounds.x2})}):s==="center"&&r.forEach(n=>{var o;n.setAttributes({dx:((o=n.attribute.dx)!==null&&o!==void 0?o:0)+t+e/2-(n.AABBBounds.x1+n.AABBBounds.x2)/2})}):i!=="bottom"&&i!=="top"||(s==="top"?r.forEach(n=>{var o;n.setAttributes({dy:((o=n.attribute.dy)!==null&&o!==void 0?o:0)+t-n.AABBBounds.y1})}):s==="bottom"?r.forEach(n=>{var o;n.setAttributes({dy:((o=n.attribute.dy)!==null&&o!==void 0?o:0)+t+e-n.AABBBounds.y2})}):s==="middle"&&r.forEach(n=>{var o;n.setAttributes({dy:((o=n.attribute.dy)!==null&&o!==void 0?o:0)+t+e/2-(n.AABBBounds.y1+n.AABBBounds.y2)/2})}))}var Cu=class{isInValidValue(t){return t<0||t>1}getTickCoord(t){let{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){let{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){let{verticalFactor:s=1}=this.attribute,n=this.getRelativeVector(),o=f2(n),a=[o[1],-1*o[0]];return pS(a,t*(e?1:-1)*s)}};function V2(){_e(),is(),bn(),Wr()}function j2(){V2(),rs()}function z2(){V2(),CD()}function G2(){_e(),na()}function U2(){_e(),na()}var W2=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};j2();var Tu=class r extends Au{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){let s=[];for(let n=0;n<this.attribute.breaks.length;n++){let o=this.attribute.breaks[n],{range:a,breakSymbol:l,rawRange:h}=o;s.push({startPoint:this.getTickCoord(a[0]),endPoint:this.getTickCoord(a[1]),range:a,breakSymbol:l,rawRange:h})}this._breaks=s}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach((s,n)=>{let{startPoint:o,endPoint:a,breakSymbol:l,rawRange:h}=s;if(l?.visible!==!1){let d=Q.group({zIndex:M2});d.name=oi.axisBreak,d.id=this._getNodeId(`${oi.axisBreak}-${n}`),d.data=h;let c=P2(l),u=Q.symbol(Object.assign({x:o.x,y:o.y},c));u.name=oi.axisBreakSymbol;let p=Q.symbol(Object.assign({x:a.x,y:a.y},c));p.name=oi.axisBreakSymbol,d.add(u),d.add(p),t.add(d)}});let{panel:i}=this.attribute;if(i&&i.visible){let s=this.axisContainer,n=s.AABBBounds,o=Q.rect(Object.assign({x:n.x1,y:n.y1,width:n.width(),height:n.height()},i.style));o.name=oi.background,o.id=this._getNodeId("background"),o.states=G({},Xs,(e=i.state)!==null&&e!==void 0?e:{}),s.insertBefore(o,s.firstChild)}}renderLine(t){let{start:e,end:i,line:s}=this.attribute,n=s,{startSymbol:o,endSymbol:a,style:l,state:h}=n,d=W2(n,["startSymbol","endSymbol","style","state"]),c=Object.assign({startSymbol:o,endSymbol:a,lineStyle:l},d);if(this._breaks&&this._breaks.length){let p=[],m=e;this._breaks.forEach(g=>{let{startPoint:f,endPoint:_}=g;p.push([m,f]),m=_}),p.push([m,i]),c.points=p,c.multiSegment=!0}else c.points=[e,i];st(h)||(c.state={line:G({},Xs,h),symbol:G({},Xs,h)});let u=new ys(c);u.name=oi.line,u.id=this._getNodeId("line"),t.add(u)}getTextAlign(t){let e="center";return Re(t[0],0)?Re(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;let s=this.attribute.title,{position:n="middle",space:o=4,textStyle:a={},autoRotate:l=!0,shape:h,background:d,state:c={},maxWidth:u}=s,p=W2(s,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]),m=.5;n==="start"?m=0:n==="end"&&(m=1);let{verticalFactor:g=1}=this.attribute,f=-1*g,_=this.getTickCoord(m),v=this.getRelativeVector(),x=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){let B=+ft(this.attribute,"label.space",4);x+=B;let L=Object.keys(this.axisLabelLayerSize).length;if(v[1]===0){let w=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(w)?x+=w+(L-1)*B:x=0}else if(v[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){let w=this.axisLabelLayerSize[0].labelPos,R=this.axisLabelsContainer.AABBBounds;x+=(f===1?R.x2>w?Math.min(R.x2-w,R.width()):0:R.x1<w?Math.min(w-R.x1,R.width()):0)+(L-1)*B}else x=0;else Object.keys(this.axisLabelLayerSize).forEach((w,R)=>{x+=this.axisLabelLayerSize[w].width+(R>0?B:0)})}let y=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(y=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(y=Math.max(y,this.attribute.subTick.length||2));let b=y+x+o,S=this.getVerticalCoord(_,b,!1),C=this.getVerticalVector(b,!1,{x:0,y:0}),k,M,{angle:E}=p;if(k=n==="start"?"start":n==="end"?"end":"center",T(E)&&l){E=_2(v,[1,0],!0);let{verticalFactor:B=1}=this.attribute;M=-1*B===1?"bottom":"top"}else k=this.getTextAlign(C),M=this.getTextBaseline(C,!1);let D=u;if(T(D)){let{verticalLimitSize:B,verticalMinSize:L,orient:w}=this.attribute,R=Math.min(B||1/0,L||1/0);if(K(R))if(w==="bottom"||w==="top")if(E!==Math.PI/2){let N=Math.abs(Math.cos(E??0));D=N<1e-6?1/0:this.attribute.end.x/N}else D=R-b;else if(E&&E!==0){let N=Math.abs(Math.sin(E));D=N<1e-6?1/0:this.attribute.end.y/N}else D=R-b}let P=Object.assign(Object.assign(Object.assign({},S),p),{maxWidth:D,textStyle:Object.assign({textAlign:k,textBaseline:M},a),state:{text:G({},Xs,c.text),shape:G({},Xs,c.shape),panel:G({},Xs,c.background)}});return P.angle=E,h&&h.visible&&(P.shape=Object.assign({visible:!0},h.style),h.space&&(P.space=h.space)),d&&d.visible&&(P.panel=Object.assign({visible:!0},d.style)),P}getTextBaseline(t,e){let i="middle",{verticalFactor:s=1}=this.attribute,n=(e?1:-1)*s;return Re(t[1],0)?i=!Re(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":n===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){let s=this.attribute.orient;if(["top","bottom","right","left"].includes(s)||t[0]===0&&t[1]===0){if(s==="top"||s==="bottom")return FD(e?s==="bottom"?"top":"bottom":s,i);if(s==="left"||s==="right")return OD(e?s==="left"?"right":"left":s,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,s,n){var o,a,l,h;let{flush:d=!1}=this.attribute.label||{};if(d&&t.length){let{orient:c,start:u,end:p}=this.attribute,m=c==="bottom"||c==="top",g=t[0],f=It(t),_=m?g.attribute.x>f.attribute.x:g.attribute.y<f.attribute.y;if(m){let v=_?f:g,x=_?g:f,y=u.x,b=p.x,S=v.AABBBounds.x1,C=x.AABBBounds.x2;S<y&&(v.attribute.angle?v.setAttributes({dx:((o=v.attribute.dx)!==null&&o!==void 0?o:0)+y-S}):v.setAttributes({x:y,textAlign:"left"})),C>b&&(x.attribute.angle?x.setAttributes({dx:((a=x.attribute.dx)!==null&&a!==void 0?a:0)+b-C}):x.setAttributes({x:b,textAlign:"right"}))}else{let v=_?f:g,x=_?g:f,y=v.AABBBounds.y2,b=x.AABBBounds.y1,S=u.y,C=p.y;b<S&&(x.attribute.angle?x.setAttributes({dy:((l=x.attribute.dy)!==null&&l!==void 0?l:0)+S-b}):x.setAttributes({y:S,textBaseline:"top"})),y>C&&(v.attribute.angle?v.setAttributes({dy:((h=v.attribute.dy)!==null&&h!==void 0?h:0)+C-y}):v.setAttributes({y:C,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,s,n){if(st(t))return;let{verticalLimitSize:o,label:a,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(o,n),{layoutFunc:d,autoRotate:c,autoRotateAngle:u,autoLimit:p,limitEllipsis:m,autoHide:g,autoHideMethod:f,autoHideSeparation:_,lastVisible:v,firstVisible:x,autoWrap:y,overflowLimitLength:b}=a;if(V(d))d(t,e,s,this);else{if(c)I2(t,{labelRotateAngle:u,orient:l});else if(y){let S=Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);H2(t,{orient:l,limitLength:h,axisLength:S,ellipsis:m})}if(!y&&p&&K(h)&&h>0){let S=l==="left"||l==="right",C=Math.abs(S?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),k=S?C/t.length:g||c?1/0:C/t.length;F2(t,{limitLength:h,verticalLimitLength:k,ellipsis:m,orient:l,axisLength:C,overflowLimitLength:b})}g&&bS(t,{orient:l,method:f,separation:_,lastVisible:v,firstVisible:x})}}afterLabelsOverlap(t,e,i,s,n){let{verticalLimitSize:o,orient:a}=this.attribute,l=a==="bottom"||a==="top",h=i.AABBBounds,d=l?h.height():h.width(),{verticalMinSize:c}=this.attribute;if(K(c)&&(!K(o)||c<=o)){let u=this._getAxisLabelLimitLength(c,n),p,m;d=Math.max(d,u),a==="left"?(p=h.x2-d,m=h.y1):a==="right"?(p=h.x1,m=h.y1):a==="top"?(p=h.x1,m=h.y2-d):a==="bottom"&&(p=h.x1,m=h.y1);let g=Q.rect({x:p,y:m,width:l?h.width():d,height:l?d:h.height(),pickable:!1});g.name=oi.axisLabelBackground,g.id=this._getNodeId("axis-label-background"),i.insertBefore(g,i.firstChild)}if(A(this.attribute.label.containerAlign)){let u;a==="left"?u=h.x2-d:a==="right"?u=h.x1:a==="top"?u=h.y2-d:a==="bottom"&&(u=h.y1),N2(t,u,d,a,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,s,n,o,a;let{label:l,title:h,line:d,tick:c}=this.attribute,u=(i=l.space)!==null&&i!==void 0?i:4,p=t,m=0,g=0,f=d&&d.visible?(s=d.style.lineWidth)!==null&&s!==void 0?s:1:0,_=c&&c.visible?(n=c.length)!==null&&n!==void 0?n:4:0;if(h&&h.visible&&typeof h.text=="string"){m=_l(h.text,h.textStyle,(a=(o=this.stage)===null||o===void 0?void 0:o.getTheme())===null||a===void 0?void 0:a.text).height;let v=Ni(h.padding);g=h.space+v[0]+v[2]}return p&&(p=(p-u-g-m-f-_)/e),p}release(){super.release(),this._breaks=null}};Tu.defaultAttributes=cd,Ct(Tu,Cu);var ku=class{isInValidValue(t){let{startAngle:e=Sn,endAngle:i=An}=this.attribute;return Math.abs(i-e)%(2*Math.PI)==0?t>1:t<0||t>1}getTickCoord(t){let{startAngle:e=Sn,endAngle:i=An,center:s,radius:n,inside:o=!1,innerRadius:a=0}=this.attribute;return oe(s,o&&a>0?a:n,e+(i-e)*t)}getVerticalVector(t,e=!1,i){return gS(t,i,this.attribute.center,e,this.attribute.inside)}getRelativeVector(t){let{center:e}=this.attribute;return[t.y-e.y,-1*(t.x-e.x)]}};function X2(r,t){let e=r.length;return{prevLabel:t>=1?r[t-1]:r[e-1],nextLabel:t<e-1?r[t+1]:r[0]}}function Yf(r,t,e){var i;r.setAttributes({maxLineWidth:t,ellipsis:(i=r.attribute.ellipsis)!==null&&i!==void 0?i:e})}function Y2(r,t,e){let i=[];if(r.length>=3){let{prevLabel:o,nextLabel:a}=X2(r,t);i.push(o,a)}else r.length===2&&i.push(r[t===0?1:0]);let s=r[t],n=Math.min(Math.abs(s.attribute.y-e.y1),Math.abs(s.attribute.y-e.y2));i.forEach(o=>{n=Math.min(n,Math.abs(o.attribute.y-s.attribute.y))}),n>0&&s.setAttributes({whiteSpace:"normal",heightLimit:n})}function K2(r,t){let{ellipsis:e,inside:i,bounds:s,autoWrap:n,center:o}=t;i||r.forEach((a,l)=>{let{x:h,y:d}=a.attribute,c=a.AABBBounds;if(Re(h,o.x)){if(d>s.y2||d<s.y1)return void Yf(a,0,e);let u=s.x2-s.x1;if(r.length>=3){let{prevLabel:p,nextLabel:m}=X2(r,l),g=p.attribute.x,f=m.attribute.x;g>f&&(g=m.attribute.x,f=p.attribute.x);let _=g===f?u:h>=g&&h<=f?f-g:Math.min(Math.abs(g-h),Math.abs(f-h));a.AABBBounds.width()>_&&Yf(a,_,e)}else a.AABBBounds.width()>u&&Yf(a,u,e)}else h>o.x&&c.x2>s.x2?(Yf(a,s.x2-h,e),n&&Y2(r,l,s)):h<o.x&&c.x1<s.x1&&(Yf(a,h-s.x1,e),n&&Y2(r,l,s))})}var h9=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};z2();var Mu=class r extends Au{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t))}renderLine(t){let{startAngle:e=Sn,endAngle:i=An,radius:s,center:n,innerRadius:o=0,line:a={},inside:l=!1,sides:h}=this.attribute,d,c=s,u=o;if(l&&o>0&&(c=o,u=0),K(h)&&h>=3){let p=_S(n,h,c,e,i);d=Q.path(Object.assign(Object.assign({},a.style),{path:aa(p,!0)}))}else{let p=Object.assign(Object.assign(Object.assign({},n),{startAngle:e,endAngle:i,radius:c,innerRadius:u}),a.style);d=Q.circle(p)}d.name=oi.line,d.id=this._getNodeId("line"),st(a.state)||(d.states=G({},Xs,a.state)),t.add(d)}getTitleAttribute(){var t,e,i;let{center:s,radius:n,innerRadius:o=0}=this.attribute,a=this.attribute.title,{space:l=4,textStyle:h={},shape:d,background:c,state:u={}}=a,p=h9(a,["space","textStyle","shape","background","state"]),m=s,g=0;!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1&&(g=ft(this.attribute.label,"style.fontSize",12)+ft(this.attribute.label,"space",4));let f=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(f=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(f=Math.max(f,this.attribute.subTick.length||2));let _=n+f+g+l,v="middle",{position:x}=this.attribute.title;T(x)&&(x=o===0?"end":"middle"),x==="start"?(v="bottom",m={x:s.x,y:s.y-_}):x==="end"&&(v="top",m={x:s.x,y:s.y+_});let y=Object.assign(Object.assign(Object.assign({},m),p),{textStyle:Object.assign({textBaseline:v,textAlign:"center"},h),state:{text:G({},Xs,u.text),shape:G({},Xs,u.shape),panel:G({},Xs,u.background)}}),{angle:b}=p;return y.angle=b,d&&d.visible&&(y.shape=Object.assign({visible:!0},d.style),d.space&&(y.space=d.space)),c&&c.visible&&(y.panel=Object.assign({visible:!0},c.style)),y}getSubTickLineItems(){var t,e;let{subTick:i}=this.attribute,s=[],{count:n=4,inside:o=!1,length:a=2}=i,l=this.tickLineItems,h=l.length;if(h>=2){let d=this.data[1].value-this.data[0].value,c=(e=(t=this.attribute)===null||t===void 0?void 0:t.tick)===null||e===void 0?void 0:e.alignWithLabel;for(let u=0;u<h;u++){let p=l[u],m=l[u+1];for(let g=0;g<n;g++){let f=(g+1)/(n+1),_=(1-f)*p.value+f*(m?m.value:c?1:p.value+d),v=this.getTickCoord(_),x=this.getVerticalCoord(v,a,o);s.push({start:v,end:x,value:_})}}}return s}beforeLabelsOverlap(t,e,i,s,n){}handleLabelsOverlap(t,e,i,s,n){if(st(t))return;let{inside:o,radius:a,center:l,size:h,label:d,orient:c}=this.attribute,u=h?{x1:0,y1:0,x2:h.width,y2:h.height}:{x1:l.x-a,y1:l.y-a,x2:l.x+a,y2:l.y+a},{layoutFunc:p,autoLimit:m,limitEllipsis:g,autoHide:f,autoHideMethod:_,autoHideSeparation:v,autoWrap:x}=d;V(p)?p(t,e,s,this):((m||x)&&K2(t,{inside:o,autoWrap:x,bounds:u,ellipsis:g,center:l}),f&&bS(t,{orient:c,method:_,separation:v}))}afterLabelsOverlap(t,e,i,s,n){}getTextBaseline(t){return Math.abs(t[1]/t[0])<.3?"middle":t[1]<0?"bottom":t[1]>0?"top":"middle"}getLabelAlign(t,e,i){return Re(t[0],0)?{textAlign:"center",textBaseline:t[1]>0?"top":"bottom"}:t[0]<0?{textAlign:"right",textBaseline:this.getTextBaseline(t)}:t[0]>0?{textAlign:"left",textBaseline:this.getTextBaseline(t)}:{textAlign:"center",textBaseline:"middle"}}getLabelPosition(t,e,i,s){return t}};Mu.defaultAttributes=cd,Ct(Mu,ku);var AS=class extends Os{constructor(){super(...arguments),this.mode=kh.NORMAL}onBind(){let t=this.target.getInnerView(),e=this.target.getPrevInnerView();e&&(this._newElementAttrMap={},Yr(t,i=>{var s,n,o,a,l,h;if(i.type!=="group"&&i.id){let d=e[i.id];if(d){if(!Bt(i.attribute,d.attribute)){let c=li(i.attribute);this._newElementAttrMap[i.id]={state:"update",node:i,attrs:Object.assign(Object.assign({},c),{opacity:(s=c.opacity)!==null&&s!==void 0?s:1,fillOpacity:(n=c.fillOpacity)!==null&&n!==void 0?n:1,strokeOpacity:(o=c.strokeOpacity)!==null&&o!==void 0?o:1})},i.setAttributes(d.attribute)}}else{let c={opacity:(a=i.attribute.opacity)!==null&&a!==void 0?a:1,fillOpacity:(l=i.attribute.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(h=i.attribute.strokeOpacity)!==null&&h!==void 0?h:1};this._newElementAttrMap[i.id]={state:"enter",node:i,attrs:c},i.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let t=this.duration,e=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(i=>{var s;let{node:n,attrs:o,state:a}=this._newElementAttrMap[i];if(a==="enter"){let{enter:l={}}=(s=this.params)!==null&&s!==void 0?s:{};t=K(l.duration)?l.duration:t,e=l.easing?l.easing:e}n.type==="path"?n.animate({interpolate:(l,h,d,c,u)=>l==="path"&&(u.path=bP(d,c)(h),!0)}).to(o,t,e):n.animate().to(o,t,e)})}onUpdate(t,e,i){}};var ss=r=>r.map((t,e)=>({index:e,value:t})),HD=(r,t,e=0)=>{let i=new ie(r).expand(e/2),s=new ie(t).expand(e/2);return i.intersects(s)};var ND=12,CS=(r,t,e,i)=>e<r?Math.max(r-t/2,e):e>r?Math.min(r-t/2,e-t):e<i?e:e-t,Xf=(r,t,e)=>{var i;let{labelStyle:s,axisOrientType:n,labelFlush:o,labelFormatter:a,startAngle:l=0}=e,h=(i=s.angle)!==null&&i!==void 0?i:0;s.direction==="vertical"&&(h+=Ut(90));let d=["bottom","top"].includes(n),c=["left","right"].includes(n),u=1,p=0;d||(c?(u=0,p=1):l&&(u=Math.cos(l),p=-Math.sin(l)));let m=yu(s),g=r.range();return t.map((_,v)=>{var x,y;let b=a?a(_):`${_}`,{width:S,height:C}=m.quickMeasure(b),k=Math.max(S,12),M=Math.max(C,12),E=r.scale(_),D=u*E,P=p*E,B,L,w=D,R=P;o&&d&&v===0?w=CS(D,k,g[0],g[g.length-1]):o&&d&&v===t.length-1?w=CS(D,k,g[g.length-1],g[0]):B=(x=s.textAlign)!==null&&x!==void 0?x:"center",B==="right"?w-=k:B==="center"&&(w-=k/2),o&&c&&v===0?R=CS(P,M,g[0],g[g.length-1]):o&&c&&v===t.length-1?R=CS(P,M,g[g.length-1],g[0]):L=(y=s.textBaseline)!==null&&y!==void 0?y:"middle",L==="bottom"?R-=M:L==="middle"&&(R-=M/2);let N=new ie().set(w,R,w+k,R+M);return h&&N.rotate(h,D,P),N})},$2=r=>["bottom","top","z"].includes(r);var Ue;(function(r){r.Identity="identity",r.Linear="linear",r.Log="log",r.Pow="pow",r.Sqrt="sqrt",r.Symlog="symlog",r.Time="time",r.Quantile="quantile",r.Quantize="quantize",r.Threshold="threshold",r.Ordinal="ordinal",r.Point="point",r.Band="band"})(Ue||(Ue={}));var q2={};Object.values(Ue).forEach(r=>{q2[r]=!0});function Vt(r){switch(r){case Ue.Linear:case Ue.Log:case Ue.Pow:case Ue.Sqrt:case Ue.Symlog:case Ue.Time:return!0;default:return!1}}function Kf(r){return!!q2[r]}function Ke(r){switch(r){case Ue.Ordinal:case Ue.Point:case Ue.Band:return!0;default:return!1}}function yl(r){return r}var Z2=r=>-Math.log(-r),J2=r=>-Math.exp(-r),d9=r=>isFinite(r)?Math.pow(10,r):r<0?0:r,jD=r=>r===10?d9:r===Math.E?Math.exp:t=>Math.pow(r,t),zD=r=>r===Math.E?Math.log:r===10?Math.log10:r===2?Math.log2:(r=Math.log(r),t=>Math.log(t)/r),GD=r=>t=>Math.sign(t)*Math.log1p(Math.abs(t/r)),UD=r=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*r;function VD(r,t){if(r=Number(r),t=Number(t),t-=r)return i=>(i-r)/t;let e=Number.isNaN(t)?NaN:.5;return()=>e}function WD(r,t,e){let i=r[0],s=r[1],n=t[0],o=t[1],a,l;return s<i?(a=VD(s,i),l=e(o,n)):(a=VD(i,s),l=e(n,o)),h=>l(a(h))}function TS(r,t,e){let i;return i=r===1?r+2*e:r-t+2*e,r?i>0?i:1:0}function Du(r,t,e,i){return e===1&&(e=0),TS(r,e,i)*(t/(1-e))}function Q2(r,t,e,i,s){let n=TS(r,e,i),o=t/Math.max(1,n||1);s&&(o=Math.floor(o));let a=o*(1-e);return s&&(a=Math.round(a)),a}function kS(r,t){let e=(r[1]-r[0])/(t[1]-t[0]),i=r[0]-e*t[0];return[i,e+i]}function t3(r,t,e){let i=Math.min(r.length,t.length)-1,s=new Array(i),n=new Array(i),o=-1;for(r[i]<r[0]&&(r=r.slice().reverse(),t=t.slice().reverse());++o<i;)s[o]=VD(r[o],r[o+1]),n[o]=e(t[o],t[o+1]);return function(a){let l=Um(r,a,1,i)-1;return n[l](s[l](a))}}var e3=(r,t)=>{let e=r.slice(),i=0,s=e.length-1,n=e[i],o=e[s];return o<n&&([i,s]=[s,i],[n,o]=[o,n]),e[i]=t.floor(n),e[s]=t.ceil(o),e},MS=(r,t=!1)=>{let e=Math.floor(Math.log10(r)),i=r/Math.pow(10,e),s;return s=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,s*Math.pow(10,e)},i3=(r,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(r,e),i)};var Eu=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=kS(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(s=>s>=0&&s<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):A(this._rangeFactorStart)&&A(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return T(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!T(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return T(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!T(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);let{distortion:e=2,radiusRatio:i=.1,radius:s}=this._fishEyeOptions,n=this.range(),o=n[0],a=n[n.length-1],l=Math.min(o,a),h=Math.max(o,a),d=ee((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),c=T(s)?(h-l)*i:s,u=Math.exp(e);u=u/(u-1)*c;let p=e/c;this._fishEyeTransform=m=>{let g=Math.abs(m-d);if(g>=c)return m;if(g<=1e-6)return d;let f=u*(1-Math.exp(-g*p))/g*.75+.25;return d+(m-d)*f}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}};var DS=Symbol("implicit"),la=class r extends Eu{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Ue.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=DS}clone(){let t=new r().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){let e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let s=this._index.get(e);if(!s){if(this._unknown!==DS)return this._unknown;s=this._domain.push(t),this._index.set(e,s)}let n=this._ordinalRange[(s-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(n):n}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(let e of t){let i=`${e}`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();let e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(`${t}`))!==null&&e!==void 0?e:-1}};function r3(r,t,e,i){let s=[],n=r;for(;n<=t;)s.push(n),n+=e;return i&&s.reverse(),s}function YD(r,t,e,i){let s,n;if(t=Math.floor(+t),r=Math.floor(+r),!(e=Math.floor(+e)))return[];if(r===t)return[r];if(s=t<r){let a=r;r=t,t=a}let o=sn(1,t-r+1)(e);if(n=Math.floor((t-r+1)/o),!i)for(;Math.ceil((t-r+1)/n)>e&&o>1;)o-=1,n=Math.floor((t-r)/o);return r3(r,t,n,s)}function s3(r,t,e){let i;if(t=Math.floor(+t),r=Math.floor(+r),e=sn(1,t-r+1)(Math.floor(+e)),i=t<r){let s=r;r=t,t=s}return r3(r,t,e,i)}var bs=class r extends la{constructor(t){super(),this.type=Ue.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;let i=this._calculateWholeRange(this._range,e),s=super.domain().length,n=i[1]<i[0],o=i[Number(n)-0],a=i[1-Number(n)],l=TS(s,this._paddingInner,this._paddingOuter);return this._step=(a-o)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),o+=(a-o-this._step*(s-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(o=Math.round(o),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:n,start:n?o+this._step*(s-1):o,count:s},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;let e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let s=this._index.get(e);if(!s){if(this._unknown!==DS)return this._unknown;s=this._domain.push(t),this._index.set(e,s)}let{count:n,start:o,reverse:a}=this._bandRangeState,l=o+(a?-1:1)*((s-1)%n)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&t.length===2){let n=kS(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(n[1]-n[0])}else i=Math.abs(t[1]-t[0]);let s=Q2(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);s<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):s>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=s,this._isFixed=!1)}if(this.isBandwidthFixed()){let i=Du(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),s=Math.min((t[1]-t[0])/i,1);if(A(this._rangeFactorStart)&&A(this._rangeFactorEnd)){let n=this._rangeFactorStart+s<=1,o=this._rangeFactorEnd-s>=0;if(e==="rangeFactorStart"&&n?this._rangeFactorEnd=this._rangeFactorStart+s:e==="rangeFactorEnd"&&o?this._rangeFactorStart=this._rangeFactorEnd-s:t[0]<=t[1]?n?this._rangeFactorEnd=this._rangeFactorStart+s:o?this._rangeFactorStart=this._rangeFactorEnd-s:(this._rangeFactorStart=0,this._rangeFactorEnd=s):o?this._rangeFactorStart=this._rangeFactorEnd-s:n?this._rangeFactorEnd=this._rangeFactorStart+s:(this._rangeFactorStart=1-s,this._rangeFactorEnd=1),i>0){let a=t[0]-i*this._rangeFactorStart,l=a+i;this._wholeRange=[a,l]}else{let a=t[1]+i*(1-this._rangeFactorEnd),l=a-i;this._wholeRange=[l,a]}}else this._rangeFactorStart=0,this._rangeFactorEnd=s,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){let t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){let e=this._domain;if(A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&e.length){let i=this._getInvertIndex(t[0]),s=this._getInvertIndex(t[1]);return e.slice(Math.min(i,s),Math.max(i,s)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[Gn(t[0]),Gn(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[Gn(t[0]),Gn(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){let e=this.calculateVisibleDomain(this._range);return t===-1?e:YD(0,e.length-1,t,!1).map(i=>e[i])}tickData(t=10){return this.ticks(t).map((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(t=10){let e=this.calculateVisibleDomain(this._range);return YD(0,e.length-1,t,!0).filter(i=>i<e.length).map(i=>e[i])}stepTicks(t){let e=this.calculateVisibleDomain(this._range);return s3(0,e.length-1,t).map(i=>e[i])}_getInvertIndex(t){let e=0,i=this.step()/2,s=this.bandwidth()/2,n=this._domain.length,o=this.range(),a=o[0]>o[o.length-1];for(e=0;e<n;e++){let l=this.scale(this._domain[e])+s;if(e===0&&(!a&&!us(t,l+i)||a&&!Zr(t,l-i))||e===n-1||!Zr(t,l-i)&&!us(t,l+i))break}return e>=0&&e<=n-1?e:n-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return T(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return T(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&J(this._userBandwidth)}clone(){var t,e,i;return new r(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}};var{interpolateRgb:XD}=Ia;function n3(r,t){let e=typeof t,i;if(T(t)||e==="boolean")return()=>t;if(e==="number")return ph(r,t);if(e==="string"){if(i=Ia.Color.parseColorString(t)){let s=XD(Ia.Color.parseColorString(r),i);return n=>s(n).formatRgb()}return ph(Number(r),Number(t))}return t instanceof Ia.RGB?XD(r,t):t instanceof Ia.Color?XD(r.color,t.color):t instanceof Date?xP(r,t):ph(Number(r),Number(t))}var wu=class extends Eu{constructor(t=yl,e=yl){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=yl,this._piecewise=WD,this._interpolate=n3}calculateVisibleDomain(t){var e;return A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));let i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),ph)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;let s=Array.from(t,Gn);return this._domain=s,this.rescale(e)}range(t,e){if(!t)return this._range.slice();let i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){let i=Array.from(t);return this._range=i,this._interpolate=yP,this.rescale(e)}rescale(t){var e;if(t)return this;let i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,s=i.length,n=this._range.length,o=Math.min(s,n);if(s&&s<n&&this._forceAlign){let a=n-s+1,l=i[s-1],h=s>=2?(l-i[s-2])/a:0;for(let d=1;d<=a;d++)i[s-2+d]=l-h*(a-d);o=n}return this._autoClamp&&(this._clamp=sn(i[0],i[o-1])),this._piecewise=o>2?t3:WD,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:yl),this.rescale(i)):this._clamp!==yl}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){let e=this.ticks(t);return(e??[]).map((i,s)=>({index:s,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return T(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return T(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};var c9=Math.sqrt(50),u9=Math.sqrt(10),p9=Math.sqrt(2),ES=[1,2,5,10],o3=(r,t,e)=>{let i=1,s=r,n=Math.floor((t-1)/2),o=Math.abs(r);return r>=0&&r<=Number.MIN_VALUE?s=0:r<0&&r>=-Number.MIN_VALUE?s=-(t-1):!e&&o<1?i=l3(o).step:(e||o>1)&&(s=Math.floor(r)-n*i),i>0?(r>0?s=Math.max(s,0):r<0&&(s=Math.min(s,-(t-1)*i)),Gm(0,t).map(a=>s+a*i)):r>0?wS(0,-(t-1)/i,i):wS((t-1)/i,0,i)},a3=wa((r,t,e,i)=>{let s,n,o,a,l=-1;if(e=+e,(r=+r)==(t=+t))return[r];if(Math.abs(r-t)<=Number.MIN_VALUE&&e>0)return[r];if((s=t<r)&&(n=r,r=t,t=n),a=$D(r,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(r/a),d=Math.round(t/a);for(h*a<r&&++h,d*a>t&&--d,o=new Array(n=d-h+1);++l<n;)o[l]=(h+l)*a}else if(a<0&&i?.noDecimals){a=1;let h=Math.ceil(r),d=Math.floor(t);if(!(h<=d))return[];for(o=new Array(n=d-h+1);++l<n;)o[l]=h+l}else{a=-a;let h=Math.round(r*a),d=Math.round(t*a);for(h/a<r&&++h,d/a>t&&--d,o=new Array(n=d-h+1);++l<n;)o[l]=(h+l)/a}return s&&o.reverse(),o}),wS=(r,t,e)=>{let i,s,n=-1;if(e>0){let o=Math.floor(r/e),a=Math.ceil(t/e);for((o+1)*e<r&&++o,(a-1)*e>t&&--a,s=new Array(i=a-o+1);++n<i;)s[n]=(o+n)*e}else{e=-e;let o=Math.floor(r*e),a=Math.ceil(t*e);for((o+1)/e<r&&++o,(a-1)/e>t&&--a,s=new Array(i=a-o+1);++n<i;)s[n]=(o+n)/e}return s},m9=(r,t,e)=>{let i,s=r[0],n=r[r.length-1],o=t-r.length;if(n<=0){let h=[];for(i=o;i>=1;i--)h.push(s-i*e);return h.concat(r)}if(s>=0){for(i=1;i<=o;i++)r.push(n+i*e);return r}let a=[],l=[];for(i=1;i<=o;i++)i%2==0?a=[s-Math.floor(i/2)*e].concat(a):l.push(n+Math.ceil(i/2)*e);return a.concat(r).concat(l)},$f=wa((r,t,e,i)=>{let s,n,o;if(e=+e,(r=+r)==(t=+t)||Math.abs(r-t)<=Number.MIN_VALUE&&e>0)return o3(r,e,i?.noDecimals);(s=t<r)&&(o=r,r=t,t=o);let a=$D(r,t,e),l=a.step;if(!isFinite(l))return[];if(l>0){let h=1,{power:d,gap:c}=a,u=c===10?2*10**d:1*10**d;for(;h<=5&&(n=wS(r,t,l),n.length>e+1)&&e>2;)l+=u,h+=1;e>2&&n.length<e-1&&(n=m9(n,e,l))}else i?.noDecimals&&l<0&&(l=1),n=wS(r,t,l);return s&&n.reverse(),n}),l3=r=>{let t=Math.floor(Math.log(r)/Math.LN10),e=r/10**t,i=ES[0];return e>=c9?i=ES[3]:e>=u9?i=ES[2]:e>=p9&&(i=ES[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function $D(r,t,e){let i=(t-r)/Math.max(0,e);return l3(i)}function qD(r,t,e){let i;if(e=+e,(r=+r)==(t=+t)&&e>0)return[r];if(e<=0||(i=g9(r,t,e))===0||!isFinite(i))return[];let s=new Array(e);for(let n=0;n<e;n++)s[n]=r+n*i;return s}function g9(r,t,e){return(t-r)/Math.max(1,e-1)}function ZD(r,t,e){let i,s,n=-1;if(e=+e,(s=(t=+t)<(r=+r))&&(i=r,r=t,t=i),!isFinite(e)||t-r<=e)return[r];let o=Math.floor((t-r)/e+1),a=new Array(o);for(;++n<o;)a[n]=r+n*e;return s&&a.reverse(),a}function PS(r,t=10){let e,i,s=0,n=r.length-1,o=r[s],a=r[n],l=10;for(a<o&&(i=o,o=a,a=i,i=s,s=n,n=i);l-- >0;){if(i=$D(o,a,t).step,i===e)return r[s]=o,r[n]=a,r;if(i>0)o=Math.floor(o/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;o=Math.ceil(o*i)/i,a=Math.floor(a*i)/i}e=i}}function RS(r,t){let e=J(t.forceMin),i=J(t.forceMax),s=null,n=[],o=null,a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?n[0]=t.forceMin:J(t.min)&&t.min<=Math.min(r[0],r[r.length-1])&&(n[0]=t.min),i?n[1]=t.forceMax:J(t.max)&&t.max>=Math.max(r[0],r[r.length-1])&&(n[1]=t.max),J(n[0])&&J(n[1])?(o=r.slice(),o[0]=n[0],o[o.length-1]=n[1]):s=J(n[0])||J(n[1])?J(n[0])?"max":"min":"all",{niceType:s,niceDomain:o,niceMinMax:n,domainValidator:a}}var KD=(r,t,e)=>Math.abs(t-r)<1?+e.toFixed(1):Math.round(+e),BS=wa((r,t,e,i,s,n,o)=>{let a=r,l=t,h=l<a;h&&([a,l]=[l,a]);let d,c,u=s(a),p=s(l),m=[];if(!(i%1)&&p-u<e){if(u=Math.floor(u),p=Math.ceil(p),a>0){for(;u<=p;++u)for(d=1;d<i;++d)if(c=u<0?d/n(-u):d*n(u),!(c<a)){if(c>l)break;m.push(c)}}else for(;u<=p;++u)for(d=i-1;d>=1;--d)if(c=u>0?d/n(-u):d*n(u),!(c<a)){if(c>l)break;m.push(c)}2*m.length<e&&(m=$f(a,l,e))}else m=$f(u,p,Math.min(p-u,e)).map(n);return m=m.filter(g=>g!==0),o?.noDecimals&&(m=Array.from(new Set(m.map(g=>Math.floor(g))))),h?m.reverse():m}),LS=wa((r,t,e,i,s,n)=>{let o=[],a={},l=s(r),h=s(t),d=[];if(Number.isInteger(i))d=$f(l,h,e);else{let c=(h-l)/(e-1);for(let u=0;u<e;u++)d.push(l+u*c)}return d.forEach(c=>{let u=n(c),p=Number.isInteger(i)?KD(r,t,u):KD(r,t,MS(u)),m=KD(r,t,i3(p,[r,t]));!a[m]&&!isNaN(m)&&d.length>1&&(a[m]=1,o.push(m))}),o}),Pu=wa((r,t,e,i,s)=>qD(i(r),i(t),e).map(n=>MS(s(n)))),h5t=wa((r,t,e,i,s)=>ZD(i(r),i(t),e).map(n=>MS(s(n))));var ir=class r extends wu{constructor(){super(...arguments),this.type=Ue.Linear}clone(){return new r().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){let i=this.calculateVisibleDomain(this._range);return a3(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(V(e?.customTicks))return e.customTicks(this,t);if(A(this._rangeFactorStart)&&A(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);let s=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,n=this._domain,o=s[0],a=s[s.length-1],l=$f(n[0],n[n.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==o||l[l.length-1]!==a)&&this._niceType){let h=s.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==o?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){let d=Math.min(h[0],h[h.length-1]),c=Math.max(h[0],h[h.length-1]);l=l.filter(u=>u>=d&&u<=c)}}return l}forceTicks(t=10){let e=this.calculateVisibleDomain(this._range);return qD(e[0],e[e.length-1],t)}stepTicks(t){let e=this.calculateVisibleDomain(this._range);return ZD(e[0],e[e.length-1],t)}nice(t=10,e){var i,s;let n=this._domain,o=[];if(e){let a=RS(n,e);if(o=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){let a=PS(n.slice(),t);this._niceType==="min"?a[a.length-1]=(i=o[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(s=o[0])!==null&&s!==void 0?s:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";let e=this._domain[this._domain.length-1],i=PS(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";let e=this._domain[0],i=PS(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};var Ru=class{nice(t=10,e){var i,s,n,o;let a=this._domain,l=[],h=null;if(e){let d=RS(a,e);if(l=d.niceMinMax,this._domainValidator=d.domainValidator,h=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else h="all";if(h){let d=e3(a.slice(),(s=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&s!==void 0?s:{floor:c=>Math.floor(c),ceil:c=>Math.ceil(c)});return h==="min"?d[d.length-1]=(n=l[1])!==null&&n!==void 0?n:d[d.length-1]:h==="max"&&(d[0]=(o=l[0])!==null&&o!==void 0?o:d[0]),this._niceDomain=d,this.rescale(),this}return this}niceMin(){let t=this._domain[this._domain.length-1];this.nice();let e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){let t=this._domain[0];this.nice();let e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}};function h3(r){return t=>-r(-t)}function d3(r=Number.EPSILON){return t=>Math.max(t,r)}function f9(r=Number.EPSILON){return t=>Math.min(t,-r)}var Bu=class r extends wu{constructor(){super(zD(10),jD(10)),this.type=Ue.Log,this._limit=d3(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new r().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();let i=zD(this._base),s=jD(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=h3(i),this._pows=h3(s),this._limit=f9(),this.transformer=Z2,this.untransformer=J2):(this._logs=i,this._pows=s,this._limit=d3(),this.transformer=this._logs,this.untransformer=s),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));let i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return yl}d3Ticks(t=10,e){let i=this.domain(),s=this._limit(i[0]),n=this._limit(i[i.length-1]);return BS(s,n,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){let e=this.calculateVisibleDomain(this._range);return LS(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){let e=this.calculateVisibleDomain(this._range);return Pu(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){let e=this.calculateVisibleDomain(this._range);return Pu(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}};Ct(Bu,Ru);var qf=class extends bs{constructor(t){super(!1),this.type=Ue.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}};var Lu=class r extends ir{constructor(){super(GD(1),UD(1)),this.type=Ue.Symlog,this._const=1}clone(){return new r().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=GD(t),this.untransformer=UD(t),this.rescale(e)):this._const}d3Ticks(t=10,e){let i=this.domain(),s=i[0],n=i[i.length-1];return BS(s,n,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){let e=this.calculateVisibleDomain(this._range);return LS(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){let e=this.calculateVisibleDomain(this._range);return Pu(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){let e=this.calculateVisibleDomain(this._range);return Pu(e[0],e[e.length-1],t,this.transformer,this.untransformer)}};Ct(Lu,Ru);var Zf=class r{constructor(){this.type=Ue.Threshold,this._range=[0,1],this._domain=[.5],this.n=1}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}scale(t){return!T(t)&&K(+t)?this._range[Um(this._domain,t,0,this.n)]:this._unknown}invertExtent(t){let e=this._range.indexOf(t);return[this._domain[e-1],this._domain[e]]}domain(t){return t?(this._domain=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._domain.slice()}range(t){return t?(this._range=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._range.slice()}clone(){return new r().domain(this._domain).range(this._range).unknown(this._unknown)}};function JD(r,t,e,i){let s,{breakData:n}=r;if(n&&n()){let{breakDomains:o}=n(),a=t.domain();s=[];for(let l=0;l<a.length-1;l++)i(e,[a[l],a[l+1]]).forEach(h=>{o.some(d=>h>=d[0]&&h<=d[1])||s.push(h)});t.domain(a)}else s=i(e);return s}function c3(r,t,e,i,s=!1){if(e&&!t.includes(r)){let n=t.length;if(n>1){s?t.push(r):t.unshift(r);for(let o=0;o<n;o++){let a=s?n-1-o:o;if(!i(t[a]))break;t.splice(a,1),o--,n--}}}}var Cn=(r,t)=>{var e,i;if(!Vt(r.type))return ss(r.domain());let s=r.range(),n=Math.abs(s[s.length-1]-s[0]);if(n<2)return ss([r.domain()[0]]);let{tickCount:o,forceTickCount:a,tickStep:l,noDecimals:h=!1,labelStyle:d,breakData:c}=t,u;if(A(l))p=r.stepTicks(l),m=c&&c()?c().breakDomains:null,u=m&&m.length?p.filter(f=>m.every(_=>f<_[0]||f>_[1])):p;else if(A(a))u=JD(t,r,a,(f,_)=>_&&_.length?r.domain(_,!0).forceTicks(f):r.forceTicks(f));else if(t.tickMode==="d3"){let f=(e=V(o)?o({axisLength:n,labelStyle:d}):o)!==null&&e!==void 0?e:5;u=JD(t,r,f,(_,v)=>v&&v.length?r.domain(v,!0).d3Ticks(_,{noDecimals:h}):r.d3Ticks(_,{noDecimals:h}))}else{let f=(i=V(o)?o({axisLength:n,labelStyle:d}):o)!==null&&i!==void 0?i:5,_=V(t.tickMode)?t.tickMode:void 0;u=JD(t,r,f,(v,x)=>x&&x.length?r.domain(x,!0).ticks(v,{noDecimals:h,customTicks:_}):r.ticks(v,{noDecimals:h,customTicks:_}))}var p,m;let g=r.domain();if(t.labelFirstVisible&&g[0]!==u[0]&&!u.includes(g[0])&&u.unshift(g[0]),t.labelLastVisible&&g[g.length-1]!==u[u.length-1]&&!u.includes(g[g.length-1])&&u.push(g[g.length-1]),t.sampling&&u.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){let{labelGap:f=4,labelFlush:_}=t,v=6,x;if(u.length*v>n){let E=[],D=Math.floor(u.length*v/n);u.forEach((P,B)=>{B%D!=0&&B!==u.length-1||E.push(P)}),x=Xf(r,E,t).map((P,B)=>({AABBBounds:P,value:E[B]}))}else x=Xf(r,u,t).map((E,D)=>({AABBBounds:E,value:u[D]}));let y=x[0],b=It(x),S=c&&c()?u3.greedy:u3.parity;for(;x.length>=3&&Wf(x,f);)x=S(x,f);let C=t.labelFirstVisible,k=t.labelLastVisible;xs(y,b,f)&&x.includes(b)&&x.length>1&&C&&k&&(x.splice(x.indexOf(b),1),k=!1),c3(y,x,C,E=>xs(E,y,f)),c3(b,x,k,E=>xs(E,b,f)||!(!C||E===y)&&xs(E,y,f),!0);let M=x.map(E=>E.value);M.length<3&&_&&(M.length>1&&M.pop(),It(M)!==It(u)&&M.push(It(u))),u=M}return ss(u)},u3={parity:function(r){return r.filter((t,e)=>e%2==0)},greedy:function(r,t){let e;return r.filter((i,s)=>(!s||!xs(e,i,t))&&(e=i,!0))}};var p3=(r,t,e,i)=>Xf(r,t,e).map(s=>i?[s.x1,s.x2,s.width()]:[s.y1,s.y2,s.height()]),m3=(r,t,e=0)=>Math.max(r[0],t[0])-e/2<=Math.min(r[1],t[1])+e/2,g3=(r,t)=>r[1]<t[0]?t[0]-r[1]:t[1]<r[0]?r[0]-t[1]:0,QD=(r,t)=>{var e;let i=r.domain();if(!i.length)return[];let{tickCount:s,forceTickCount:n,tickStep:o,labelGap:a=4,axisOrientType:l,labelStyle:h}=t,d=$2(l),c=r.range(),u=r.calculateWholeRangeSize();if(u<2)return t.labelLastVisible?ss([i[i.length-1]]):ss([i[0]]);let p;if(A(o))p=r.stepTicks(o);else if(A(n))p=r.forceTicks(n);else if(A(s)){let m=V(s)?s({axisLength:u,labelStyle:h}):s;p=r.ticks(m)}else if(t.sampling){let m=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,g=Ae(c),f=Pe(c);if(i.length<=u/m){let _=(f-g)/i.length,v=p3(r,i,t,d),x=Math.min(...v.map(b=>b[2])),y=_9(i,v,a,t.labelLastVisible,Math.floor(x/_),!1);p=r.stepTicks(y.step),t.labelLastVisible&&(y.delCount&&(p=p.slice(0,p.length-y.delCount)),p.push(i[i.length-1]))}else{let _=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],v=p3(r,_,t,d),x=null;v.forEach(b=>{x?x[2]<b[2]&&(x=b):x=b});let y=f-g-a>0?Math.ceil(i.length*(a+x[2])/(f-g-a)):i.length-1;p=r.stepTicks(y),!t.labelLastVisible||p.length&&p[p.length-1]===i[i.length-1]||(p.length&&Math.abs(r.scale(p[p.length-1])-r.scale(i[i.length-1]))<x[2]&&(p=p.slice(0,-1)),p.push(i[i.length-1]))}}else p=r.domain();return ss(p)},_9=(r,t,e,i,s,n)=>{let o=0,a=0,l=-1,h=Number.MAX_VALUE,d=p=>{let m=!0,g=0;do g+p<r.length&&m3(t[g],t[g+p],e)&&(m=!1),g+=p;while(m&&g<r.length);return m},c=Nv(s,r.length,p=>d(p)?1:-1),u=c;do if(u>c&&!n&&!d(u))u++;else{if(!i){a=u;break}{let p=r.length-1,m,g=0;m=r.length%u>0?r.length-r.length%u+u:r.length;do{if(m-=u,m!==p&&!m3(t[m],t[p],e))break;g++}while(m>0);if(m===p){a=u,o=g;break}{let f=Math.floor(r.length/u)-g+1;if(f<l)break;{l=f;let _=g3(t[m],t[p]),v=m-u>=0?g3(t[m-u],t[m]):_,x=Math.abs(_-v);if(x<h&&(h=x,a=u,o=g),_<=v)break}}}u++}while(u<=r.length);return{step:a,delCount:o}};var v9=(r,t,e)=>{var i;let{labelStyle:s,getRadius:n,labelOffset:o,labelFormatter:a,inside:l}=e,h=n?.(),d=(i=s.angle)!==null&&i!==void 0?i:0,c=yu(s);return t.map(u=>{let p=a?a(u):`${u}`,{width:m,height:g}=c.quickMeasure(p),f=Math.max(m,ND),_=Math.max(g,ND),v=r.scale(u),x={x:0,y:0},y=0,b=0,S={align:s.textAlign,baseline:s.textBaseline},{x:C,y:k}=R2(v,x,h,o,l);return S.align||(Re(C,x.x)?S.baseline||(S.baseline=k>x.y?"top":"bottom"):C>x.x?S.align="left":C<x.x&&(S.align="right")),y=C+(S.align==="right"?-f:S.align==="left"?0:-f/2),b=k+(S.baseline==="bottom"?-_:S.baseline==="top"?0:-_/2),new ie().set(y,b,y+f,b+_).rotate(d,y+f/2,b+_/2)})},tE=(r,t)=>{let{tickCount:e,forceTickCount:i,tickStep:s,getRadius:n,labelOffset:o,labelGap:a=0,labelStyle:l}=t,h=n?.();if(!h)return ss(r.domain());let d;if(A(s))d=r.stepTicks(s);else if(A(i))d=r.forceTicks(i);else if(A(e)){let c=r.range(),u=Math.abs(c[c.length-1]-c[0]),p=V(e)?e({axisLength:u,labelStyle:l}):e;d=r.ticks(p)}else if(t.sampling){let c=r.domain(),u=r.range(),p=v9(r,c,t),m=Ae(u),g=Pe(u),f=Math.abs(g-m)*(h+o)/c.length,{step:_,delCount:v}=y9(c,p,a,Math.floor(p.reduce((x,y)=>Math.min(x,y.width(),y.height()),Number.MAX_VALUE)/f));d=r.stepTicks(_),d=d.slice(0,d.length-v)}else d=r.domain();return ss(d)},y9=(r,t,e,i)=>{let s=i;do{let o=!0;s++;let a=0;do a+s<r.length&&HD(t[a],t[a+s],e)&&(o=!1),a+=s;while(o&&a<r.length);if(o)break}while(s<=r.length);let n=0;if(r.length>2){let o=r.length-r.length%s;for(o>=r.length&&(o-=s);o>0&&HD(t[0],t[o]);)n++,o-=s}return{step:s,delCount:n}};var xl=new Uint32Array(33),Tn=new Uint32Array(33);Tn[0]=0,xl[0]=~Tn[0];for(let r=1;r<=32;++r)Tn[r]=Tn[r-1]<<1|1,xl[r]=~Tn[r];function f3(r,t){let e=new Uint32Array(~~((r*t+32)/32));function i(n,o){e[n]|=o}function s(n,o){e[n]&=o}return{array:e,get:(n,o)=>{let a=o*r+n;return e[a>>>5]&1<<(31&a)},set:(n,o)=>{let a=o*r+n;i(a>>>5,1<<(31&a))},clear:(n,o)=>{let a=o*r+n;s(a>>>5,~(1<<(31&a)))},getRange:({x1:n,y1:o,x2:a,y2:l})=>{if(a<0||l<0||n>r||o>t)return!0;let h,d,c,u,p=l;for(;p>=o;--p)if(h=p*r+n,d=p*r+a,c=h>>>5,u=d>>>5,c===u){if(e[c]&xl[31&h]&Tn[1+(31&d)])return!0}else{if(e[c]&xl[31&h]||e[u]&Tn[1+(31&d)])return!0;for(let m=c+1;m<u;++m)if(e[m])return!0}return!1},setRange:({x1:n,y1:o,x2:a,y2:l})=>{if(a<0||l<0||n>r||o>t)return;let h,d,c,u,p;for(;o<=l;++o)if(h=o*r+n,d=o*r+a,c=h>>>5,u=d>>>5,c===u)i(c,xl[31&h]&Tn[1+(31&d)]);else for(i(c,xl[31&h]),i(u,Tn[1+(31&d)]),p=c+1;p<u;++p)i(p,4294967295)},clearRange:({x1:n,y1:o,x2:a,y2:l})=>{let h,d,c,u,p;for(;o<=l;++o)if(h=o*r+n,d=o*r+a,c=h>>>5,u=d>>>5,c===u)s(c,Tn[31&h]|xl[1+(31&d)]);else for(s(c,Tn[31&h]),s(u,xl[1+(31&d)]),p=c+1;p<u;++p)s(p,0)},outOfBounds:({x1:n,y1:o,x2:a,y2:l})=>n<0||o<0||l>=t||a>=r,toImageData:n=>{let o=n.createImageData(r,t),a=o.data;for(let l=0;l<t;++l)for(let h=0;h<r;++h){let d=l*r+h,c=4*d,u=e[d>>>5]&1<<(31&d);a[c+0]=255*u,a[c+1]=255*u,a[c+2]=255*u,a[c+3]=31}return o}}}function _3(r,t,e={top:0,left:0,right:0,bottom:0}){let{top:i=0,left:s=0,right:n=0,bottom:o=0}=e,a=Math.max(1,Math.sqrt(r*t/1e6)),l=~~((r+s+n+a)/a),h=~~((t+i+o+a)/a),d=c=>~~(c/a);return d.bitmap=()=>f3(l,h),d.x=c=>~~((c+s)/a),d.y=c=>~~((c+i)/a),d.ratio=a,d.padding=e,d.width=r,d.height=t,d}function eE(r,t){let{x1:e,x2:i,y1:s,y2:n}=t,o=ee(e,0,r.width),a=ee(i,0,r.width),l=ee(s,0,r.height),h=ee(n,0,r.height);return{x1:r.x(o),x2:r.x(a),y1:r.y(l),y2:r.y(h)}}function Ks(r,t,e=!1){return e?eE(r,t):{x1:r.x(t.x1),x2:r.x(t.x2),y1:r.y(t.y1),y2:r.y(t.y2)}}function Iu(r,t,e,i=!0,s=0){let n=e;s>0&&(n={x1:e.x1-s,x2:e.x2+s,y1:e.y1-s,y2:e.y2+s}),n=Ks(r,n);let o=t.outOfBounds(n);return(!i||!o)&&(o&&(n=eE(r,n)),!t.getRange(n))}function iE(r,t,e,i=[],s=!0,n=0,o=!1){let a=i.filter(l=>A(l));for(let l=0;l<a.length;l++){let h;if(h=o?e:e.clone(),h.setAttributes(a[l]),Iu(r,t,h.AABBBounds,s,n))return t.setRange(Ks(r,h.AABBBounds,!0)),a[l]}return!1}function v3(r,t,e,i,s,n,o){var a,l;let h=(a=i.overlap)===null||a===void 0?void 0:a.clampForce,d=(l=i.overlap)===null||l===void 0?void 0:l.overlapPadding;if(e.type==="bound"||e.type==="position"){if(V(o)){let c=((V(e.position)?e.position(s.attribute):e.position)||S9(i.type)).map(p=>o(s.AABBBounds,n,p,i.offset)),u=e.restorePosition===!1;return iE(r,t,s,c,h,d,u)}return!1}if(e.type==="moveY"){let c=(e.offset?V(e.offset)?e.offset(s.attribute):e.offset:[]).map(u=>({x:s.attribute.x,y:s.attribute.y+u}));return iE(r,t,s,c,h,d)}if(e.type==="moveX"){let c=(e.offset?V(e.offset)?e.offset(s.attribute):e.offset:[]).map(u=>({x:s.attribute.x+u,y:s.attribute.y}));return iE(r,t,s,c,h,d)}return!1}var x9=["top","bottom","right","left","top-right","bottom-right","top-left","bottom-left"],b9=["top","inside-top","inside"];function S9(r){return r==="rect"?b9:x9}function rE(r,t,e,i={}){let{x1:s,x2:n,y1:o,y2:a}=r.AABBBounds,{top:l=0,left:h=0,right:d=0,bottom:c=0}=i,u=Math.min(s,n),p=Math.max(s,n),m=Math.min(o,a),g=Math.max(o,a),f=t+d,_=e+c,v=0,x=0;return u<0-h?v=-u:p>f&&(v=f-p),m<0-l?x=-m:g>_&&(x=_-g),{dx:v,dy:x}}var A9=(r={})=>{var t,e,i;return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(t=r.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=r.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=r.strokeOpacity)!==null&&i!==void 0?i:1}}},C9=(r={})=>{var t,e,i;return{from:{opacity:(t=r.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=r.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=r.strokeOpacity)!==null&&i!==void 0?i:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}},y3={fadeIn:A9,fadeOut:C9};function sE(r,t){var e,i;return(i=(e=y3[t])===null||e===void 0?void 0:e.call(y3,r))!==null&&i!==void 0?i:{from:{},to:{}}}function b3(r,t,e){if(!H(e)){let{duration:i,easing:s,increaseEffect:n=!0}=e;return r.animate().to(t.attribute,i,s),void(n&&r.type==="text"&&t.type==="text"&&x3(r,t,i,s))}e.forEach(i=>{let{duration:s,easing:n,increaseEffect:o=!0,channel:a}=i,{to:l}=T9(r,t,a,i.options);st(l)||r.animate().to(l,s,n),o&&r.type==="text"&&t.type==="text"&&x3(r,t,s,n)})}var T9=(r,t,e,i)=>{let s=Object.assign({},r.attribute),n=Object.assign({},t.attribute);return O(i?.excludeChannels).forEach(o=>{delete n[o]}),Object.keys(n).forEach(o=>{e&&!e.includes(o)&&delete n[o]}),{from:s,to:n}};function x3(r,t,e,i){r.attribute.text!==t.attribute.text&&K(Number(r.attribute.text)*Number(t.attribute.text))&&r.animate().play(new ox({text:r.attribute.text},{text:t.attribute.text},e,i))}var IS={mode:"same-time",duration:300,easing:"linear"};function bl(r){return r===3||r===4}function A3(r){return r===1||r===2}function C3(r,t,e,i,s,n){if(r===0&&t===0||n<=0)return[];if(r===0){let u=-e/t,p=n**2-(u-s)**2;return p<0?[]:p===0?[{x:i,y:u}]:[{x:Math.sqrt(p)+i,y:u},{x:-Math.sqrt(p)+i,y:u}]}if(t===0){let u=-e/r,p=n**2-(u-i)**2;return p<0?[]:p===0?[{x:u,y:s}]:[{x:u,y:Math.sqrt(p)+s},{x:u,y:-Math.sqrt(p)+s}]}let o=(t/r)**2+1,a=2*((e/r+i)*(t/r)-s),l=a**2-4*o*((e/r+i)**2+s**2-n**2);if(l<0)return[];let h=(-a+Math.sqrt(l))/(2*o),d=(-a-Math.sqrt(l))/(2*o),c=-(t*h+e)/r;return l===0?[{x:c,y:h}]:[{x:c,y:h},{x:-(t*d+e)/r,y:d}]}function T3(r,t){return t>2*r?NaN:2*Math.asin(t/2/r)}function k3(r,t){let{x1:e,y1:i,x2:s,y2:n}=r,{x1:o,y1:a,x2:l,y2:h}=t;return!(e<=o&&s<=o||e>=l&&s>=l||i<=a&&n<=a||i>=h&&n>=h)}var M3=r=>{if(!r||!r.attribute)return[];let{points:t,segments:e}=r.attribute;if(e&&e.length){let i=[];return e.forEach(s=>{s.points.forEach(n=>{i.push(n)})}),i}return t};function D3(r,t){if(!r||!t||jo(r,t,!0))return;let e=Math.min(r.x1,r.x2),i=Math.min(r.y1,r.y2),s=Math.min(t.x1,t.x2),n=Math.min(t.y1,t.y2),o=Math.abs(r.x2-e)/2,a=Math.abs(r.y2-i)/2,l=Math.abs(t.x2-s)/2,h=Math.abs(t.y2-n)/2,d=e+o,c=i+a,u=s+l,p=n+h,m=u-d,g=p-c;return[S3(m,g,d,c,o,a),S3(-m,-g,u,p,l,h)]}function S3(r,t,e,i,s,n){return Math.abs(t/r)<n/s?{x:e+(r>0?s:-s),y:i+t*s/Math.abs(r)}:{x:e+r*n/Math.abs(t),y:i+(t>0?n:-n)}}function E3(r){return r==="left"?0:r==="right"?1:.5}function w3(){_e(),Wr(),bn(),is()}var P3=(r,t)=>Math.ceil(r)>Math.floor(t),k9=([r,t],[e,i])=>i>r&&t>e;function M9(r,t){let[e,i]=r,[s,n]=t,o=Math.max(e,s),a=Math.min(i,n);return Math.max(0,a-o)}function R3(r,t){let{maxY:e=Number.MAX_VALUE,labelling:i,globalShiftY:s={enable:!0,maxIterations:10,maxError:.1,padding:1}}=t,n=r.length;if(n<=1)return r;let o=new Map,a=new Map,l=b=>a.get(b).y1Initial,h=b=>a.get(b).height,d=b=>a.get(b).y1,c=b=>a.get(b).x,u=b=>a.get(b).x1,p=b=>a.get(b).x2,m=b=>a.get(b).attempts,g=(b,S)=>{a.get(b).y1=S},f=(b,S)=>{a.get(b).attempts=S};function _(b){for(let C=b.length-1;C>=0;C--){let k=b[C],M=b[C-1],E=b[C+1];if(M&&P3(d(M)+h(M),d(k))||d(k)===0&&k._isClamped){let{y:D}=i(k);E&&P3(D+h(k)/2,d(E))||D+h(k)/2<=e&&g(k,d(k)+D-(S=k,a.get(S).y))}}var S}r.sort((b,S)=>b.attribute.x-S.attribute.x);for(let b of r){let{y1:S,y2:C,x1:k,x2:M}=b.AABBBounds,{x:E,y:D}=b.attribute;a.set(b,{y1Initial:S,y1:S,y2:C,y:D,height:C-S,x1:k,x2:M,x:E,attempts:0});let P=!1;for(let[B,L]of o){let{start:w,end:R}=B;if(k>=w&&M<=R)L.push(b),P=!0;else if(Re(E,c(L[0]),void 0,5)){let N={start:Math.min(w,k),end:Math.max(R,M)};L.push(b),o.set(N,L),o.delete(B),P=!0}else if(M9([w,R],[k,M])/(R-w)>.5){let N={start:Math.min(w,k),end:Math.max(R,M)};L.push(b),o.set(N,L),o.delete(B),P=!0}if(P)break}P||o.set({start:k,end:M},[b])}for(let b of o.values())b.sort((S,C)=>l(S)-l(C)),_(b);if(s.enable!==!1){let{maxIterations:b=10,maxError:S=.1,padding:C=1,maxAttempts:k=1e3,deltaYTolerance:M=Number.MAX_VALUE}=s;for(let E=0;E<b;E++){r.sort((P,B)=>l(P)-l(B));let D=0;for(let P=0;P<n-1;P++){let B=r[P];if(m(B)>=k)continue;let L,w=P+1;for(;(L=r[w])&&!k9([u(B),p(B)],[u(L),p(L)]);)w+=1;if(L){let R=d(B),N=h(B),z=d(L),Y=z-(R+N);if(Y<C){let U=(C-Y)/2;if(D=Math.max(D,U),R+U+h(L)>e){let $=R-(C-Y),ut=l(B)-$;Math.abs(ut)<=M&&(g(B,$),f(B,m(B)+1))}else if(R-U<0){let $=z+(C-Y),ut=l(L)-$;Math.abs(ut)<=M&&(g(L,$),f(L,m(L)+1))}else{let $=R-U,ut=l(B)-$,mt=z+U,bt=l(L)-mt;Math.abs(ut)<=M&&Math.abs(bt)<=M&&(g(B,$),g(L,mt),f(B,m(B)+1),f(L,m(L)+1))}}}}if(D<S)break}}for(let b of r){let S=b.attribute.y+d(b)-l(b);b.setAttribute("y",S)}let v=[];r.sort((b,S)=>b.attribute.x-S.attribute.x);let x=0,y=r.length-1;for(;x<=y;)x===y?v.push(r[x]):(v.push(r[x]),v.push(r[y])),x++,y--;return v}var D9=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};w3();var ud=class r extends xe{setBitmap(t){this._bitmap=t}setBitmapTool(t){this._bmpTool=t}constructor(t,e){let{data:i}=t,s=D9(t,["data"]);super(e?.skipDefault?t:Object.assign({data:i},G({},r.defaultAttributes,s))),this.name="label",this._onHover=n=>{let o=n.target;o===this._lastHover||st(o.states)||(o.addState(di.hover,!0),Yr(this,a=>{a===o||st(a.states)||a.addState(di.hoverReverse,!0)}),this._lastHover=o)},this._onUnHover=n=>{this._lastHover&&(Yr(this,o=>{st(o.states)||(o.removeState(di.hoverReverse),o.removeState(di.hover))}),this._lastHover=null)},this._onClick=n=>{let o=n.target;if(this._lastSelect===o&&o.hasState("selected"))return this._lastSelect=null,void Yr(this,a=>{st(a.states)||(a.removeState(di.selectedReverse),a.removeState(di.selected))});st(o.states)||(o.addState(di.selected,!0),Yr(this,a=>{a===o||st(a.states)||a.addState(di.selectedReverse,!0)}),this._lastSelect=o)},this._handleRelatedGraphicSetState=n=>{var o,a,l,h,d;if(((o=n.detail)===null||o===void 0?void 0:o.type)===fi.STATE||((a=n.detail)===null||a===void 0?void 0:a.type)===fi.ANIMATE_UPDATE&&(!((l=n.detail.animationState)===null||l===void 0)&&l.isFirstFrameOfStep)){let c=(d=(h=n.target)===null||h===void 0?void 0:h.currentStates)!==null&&d!==void 0?d:[],u=this._isCollectionBase?[...this._graphicToText.values()]:[this._graphicToText.get(n.target)];this.updateStatesOfLabels(u,c)}}}labeling(t,e,i,s){}_getLabelLinePoints(t,e){return D3(t.AABBBounds,e?.AABBBounds)}_createLabelLine(t,e){let i=this._getLabelLinePoints(t,e);if(i){let s=Q.line({points:i}),{line:n={}}=t.attribute;if(n.customShape){let o=n.customShape;s.pathProxy=a=>o({text:t,baseMark:e},a,new ne)}return e&&e.attribute.fill&&s.setAttribute("stroke",e.attribute.fill),this.attribute.line&&!st(this.attribute.line.style)&&s.setAttributes(this.attribute.line.style),this._setStatesOfLabelLine(s),s}}render(){if(this._prepare(),T(this._idToGraphic)||this._isCollectionBase&&T(this._idToPoint))return;let{overlap:t,smartInvert:e,dataFilter:i,customLayoutFunc:s,customOverlapFunc:n}=this.attribute,o=this.attribute.data;if(V(i)&&(o=i(o)),o&&o.length){let l=new Set;o=o.filter(h=>!l.has(h.id)&&l.add(h.id))}let a=this._initText(o);a=V(s)?s(o,a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):this._layout(a),V(n)?a=n(a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):t!==!1&&(a=this._overlapping(a)),V(this.attribute.onAfterOverlapping)&&this.attribute.onAfterOverlapping(a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this),a&&a.length&&a.forEach(l=>{this._bindEvent(l),this._setStatesOfText(l)}),e!==!1&&this._smartInvert(a),this._renderLabels(a)}_bindEvent(t){if(this.attribute.disableTriggerEvent||!t)return;let{hover:e,select:i}=this.attribute;e&&(t.addEventListener("pointermove",this._onHover),t.addEventListener("pointerout",this._onUnHover)),i&&t.addEventListener("pointerdown",this._onClick)}_setStatesOfText(t){if(!t)return;let e=this.attribute.state;e&&!st(e)&&(t.states=e)}_setStatesOfLabelLine(t){if(!t)return;let e=this.attribute.labelLineState;e&&!st(e)&&(t.states=e)}_createLabelText(t){var e,i;let s=Object.assign(Object.assign({},(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),t);return oa(s,"textType")}_prepare(){var t,e;let i=[],s;if(s=V(this.attribute.getBaseMarks)?this.attribute.getBaseMarks():u2(this.getRootNode(),this.attribute.baseMarkGroupName),s.forEach(o=>{o.releaseStatus!=="willRelease"&&i.push(o)}),(t=this._idToGraphic)===null||t===void 0||t.clear(),(e=this._idToPoint)===null||e===void 0||e.clear(),this._baseMarks=i,this._isCollectionBase=this.attribute.type==="line-data",!i||i.length===0)return;let{data:n}=this.attribute;if(n&&n.length!==0){if(this._idToGraphic||(this._idToGraphic=new Map),this._isCollectionBase){this._idToPoint||(this._idToPoint=new Map);let o=0;for(let a=0;a<i.length;a++){let l=i[a],h=M3(l);if(h&&h.length)for(let d=0;d<h.length;d++){let c=n[o];c&&h[d]&&(A(c.id)||(c.id=`vrender-component-${this.name}-${o}`),this._idToPoint.set(c.id,h[d]),this._idToGraphic.set(c.id,l)),o++}}}else for(let o=0;o<i.length;o++){let a=n[o],l=i[o];a&&l&&(A(a.id)||(a.id=`vrender-component-${this.name}-${o}`),this._idToGraphic.set(a.id,l))}if(this.attribute.animation!==!1){let{animation:o,animationEnter:a,animationExit:l,animationUpdate:h}=this.attribute,d=ct(o)?o:{};this._animationConfig={enter:a!==!1&&G({},IS,d,a??{}),exit:l!==!1&&G({},IS,d,l??{}),update:h!==!1&&(H(h)?h:G({},IS,d,h??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}getRelatedGraphic(t){return this._idToGraphic.get(t.id)}_initText(t=[]){let{textStyle:e={}}=this.attribute,i=[];for(let s=0;s<t.length;s++){let n=t[s],o=this.getRelatedGraphic(n);if(!o)continue;let a=Object.assign(Object.assign({fill:this._isCollectionBase?H(o.attribute.stroke)?o.attribute.stroke.find(h=>!!h&&h!==!0):o.attribute.stroke:o.attribute.fill},e),n),l=this._createLabelText(a);i.push(l)}return i}_layout(t){let{position:e,offset:i}=this.attribute;for(let s=0;s<t.length;s++){let n=t[s];if(!n)return;let o=n.attribute,a=this.getRelatedGraphic(o);if(!a)continue;n.attachedThemeGraphic=this;let l=this.getGraphicBounds(n);n.attachedThemeGraphic=null;let h=V(e)?e(o):e,d=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(o.id),h):this.getGraphicBounds(a,{x:o.x,y:o.y},h),c=this.labeling(l,d,h,i);c&&n.setAttributes(c)}return t}_overlapping(t){var e,i,s;if(t.length===0)return[];let n=ct(this.attribute.overlap)?this.attribute.overlap:{},o=this.getBaseMarkGroup(),a=(e=n.size)!==null&&e!==void 0?e:{width:(i=o?.AABBBounds.width())!==null&&i!==void 0?i:0,height:(s=o?.AABBBounds.height())!==null&&s!==void 0?s:0};if(a.width===0||a.height===0)return t;let{strategy:l,priority:h}=n,d=this._bmpTool||_3(a.width,a.height),c=this._bitmap||d.bitmap();return h&&(t=t.sort((u,p)=>h(p.attribute.data)-h(u.attribute.data))),l?.type==="shiftY"?this._overlapGlobal(t,n,d,c):this._overlapByStrategy(t,n,d,c)}_overlapGlobal(t,e,i,s){let n=t.filter(d=>d.attribute.visible&&d.attribute.opacity!==0),{clampForce:o=!0,hideOnHit:a=!0,overlapPadding:l,strategy:h}=e;if(o)for(let d=0;d<n.length;d++){let c=t[d],{dx:u=0,dy:p=0}=rE(c,i.width,i.height,i.padding);u===0&&p===0||(c.setAttributes({x:c.attribute.x+u,y:c.attribute.y+p}),c._isClamped=!0)}n=R3(n,Object.assign(Object.assign({maxY:i.height},h),{labelling:d=>{let c=this.getRelatedGraphic(d.attribute),u=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(d.attribute.id)):this.getGraphicBounds(c,d);return this.labeling(d.AABBBounds,u,"bottom",this.attribute.offset)}}));for(let d=0;d<n.length;d++){let c=n[d],u=c.AABBBounds,p=Ks(i,u,!0);if(Iu(i,s,u,o,l))s.setRange(p);else{if(o&&this._processClampForce(c,i,s,l))continue;a?c.setAttributes({visible:!1}):s.setRange(p)}}return n}_processClampForce(t,e,i,s=0){let{dy:n=0,dx:o=0}=rE(t,e.width,e.height,e.padding);if(o===0&&n===0){if(Iu(e,i,t.AABBBounds,!1,s))return i.setRange(Ks(e,t.AABBBounds,!0)),!0}else if(Iu(e,i,{x1:t.AABBBounds.x1+o,x2:t.AABBBounds.x2+o,y1:t.AABBBounds.y1+n,y2:t.AABBBounds.y2+n}))return t.setAttributes({x:t.attribute.x+o,y:t.attribute.y+n}),i.setRange(Ks(e,t.AABBBounds,!0)),!0;return!1}_overlapByStrategy(t,e,i,s){var n;let{avoidBaseMark:o,strategy:a=[],hideOnHit:l=!0,clampForce:h=!0,avoidMarks:d=[],overlapPadding:c}=e,u=[],p=a.some(m=>m.type==="bound");o&&((n=this._baseMarks)===null||n===void 0||n.forEach(m=>{m.AABBBounds&&s.setRange(Ks(i,m.AABBBounds,!0))})),d.length>0&&d.forEach(m=>{Z(m)?p2(this.getRootNode(),m).forEach(g=>{g.AABBBounds&&s.setRange(Ks(i,g.AABBBounds,!0))}):m.AABBBounds&&s.setRange(Ks(i,m.AABBBounds,!0))});for(let m=0;m<t.length;m++){if(t[m].attribute.visible===!1)continue;let g=t[m],f=this.getRelatedGraphic(g.attribute);if(g.update(),!jo(f.AABBBounds,{x1:0,x2:i.width,y1:0,y2:i.height},!0))continue;if(Iu(i,s,g.AABBBounds,h,c)){if(!p){s.setRange(Ks(i,g.AABBBounds,!0)),u.push(g);continue}if(p&&f&&f.AABBBounds&&this._canPlaceInside(g.AABBBounds,f.AABBBounds)){s.setRange(Ks(i,g.AABBBounds,!0)),u.push(g);continue}}let _=!1;for(let v=0;v<a.length;v++)if(_=v3(i,s,a[v],this.attribute,g,this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(t[m].attribute.id)):this.getGraphicBounds(f,t[m].attribute),this.labeling),_!==!1){g.setAttributes({x:_.x,y:_.y}),u.push(g);break}if(!_&&h&&this._processClampForce(g,i,s,c)){u.push(g);continue}!_&&!l&&u.push(g)}return u}getBaseMarkGroup(){let{baseMarkGroupName:t}=this.attribute;if(t)return this.getRootNode().find(e=>e.name===t,!0)}getGraphicBounds(t,e={},i){if(t){if(t.attribute.visible!==!1)return t.AABBBounds;let{x:o,y:a}=t.attribute;return{x1:o,x2:o,y1:a,y2:a}}if(e&&i&&i==="inside-middle"){let{x:o,y:a,x1:l=o,y1:h=a}=e;return{x1:(o+l)/2,x2:(o+l)/2,y1:(a+h)/2,y2:(a+h)/2}}let{x:s,y:n}=e;return{x1:s,x2:s,y1:n,y2:n}}_renderLabels(t){var e;let{syncState:i}=this.attribute,s=new Map,n=this._graphicToText||new Map,o=[],a=[],{visible:l}=(e=this.attribute.line)!==null&&e!==void 0?e:{};t&&t.forEach((h,d)=>{var c;let u=this.getRelatedGraphic(h.attribute),p=this._isCollectionBase?h.attribute.id:u,m=n?.get(p)?"update":"enter",g;if(l&&(g=this._createLabelLine(h,u)),i&&this.updateStatesOfLabels([g?{text:h,labelLine:g}:{text:h}],(c=u.currentStates)!==null&&c!==void 0?c:[]),m==="enter")o.push(h),s.set(p,g?{text:h,labelLine:g}:{text:h}),this._addLabel({text:h,labelLine:g},o,a,d);else if(m==="update"){let f=n.get(p);n.delete(p),s.set(p,f),this._updateLabel(f,{text:h,labelLine:g})}}),this._removeLabel(n),this._graphicToText=s}_addLabel(t,e,i,s){let{text:n,labelLine:o}=t,a=this.getRelatedGraphic(n.attribute);if(this._syncStateWithRelatedGraphic(a),this._enableAnimation!==!1&&this._animationConfig.enter!==!1){if(a){let{from:l,to:h}=sE(n.attribute,"fadeIn");n&&this.add(n),o&&(i.push(o),this.add(o)),this._animationConfig.enter.duration>0&&a.once("animate-bind",d=>{n.setAttributes(l),o&&o.setAttributes(l);let c=this._afterRelatedGraphicAttributeUpdate(n,e,o,i,s,a,h,this._animationConfig.enter);a.on("afterAttributeUpdate",c)})}}else n&&this.add(n),o&&this.add(o)}_updateLabel(t,e){let{text:i,labelLine:s}=t,{text:n,labelLine:o}=e;if(this._enableAnimation!==!1&&this._animationConfig.update!==!1){let{duration:a,easing:l}=this._animationConfig.update;b3(i,n,this._animationConfig.update),s&&o&&t.labelLine.animate().to(o.attribute,a,l)}else t.text.setAttributes(n.attribute),s&&o&&t.labelLine.setAttributes(o.attribute)}_removeLabel(t){let e=i=>{this.removeChild(i.text),i.labelLine&&this.removeChild(i.labelLine)};if(this._enableAnimation!==!1&&this._animationConfig.exit!==!1){let{duration:i,easing:s}=this._animationConfig.exit;t.forEach(n=>{var o;(o=n.text)===null||o===void 0||o.animate().to(sE(n.text.attribute,"fadeOut").to,i,s).onEnd(()=>{e(n)})})}else t.forEach(i=>{e(i)})}updateStatesOfLabels(t,e){t.forEach(i=>{i&&(i.text&&i.text.useStates(e),i.labelLine&&i.labelLine.useStates(e))})}_syncStateWithRelatedGraphic(t){this.attribute.syncState&&t&&t.on("afterAttributeUpdate",this._handleRelatedGraphicSetState)}_afterRelatedGraphicAttributeUpdate(t,e,i,s,n,o,a,{mode:l,duration:h,easing:d,delay:c}){let u=p=>{var m,g,f;let{detail:_}=p;if(!_)return{};let v=(m=_.animationState)===null||m===void 0?void 0:m.step;if(!(_.type===fi.ANIMATE_UPDATE&&v&&!(v.type==="wait"&&((g=v.prev)===null||g===void 0?void 0:g.type)==null)))return{};if(_.type===fi.ANIMATE_END)return t.setAttributes(a),void(i&&i.setAttributes(a));let x=()=>{o&&(o.onAnimateBind=void 0,o.removeEventListener("afterAttributeUpdate",u))};switch(l){case"after":_.animationState.end&&(t.animate({onStart:x}).wait(c).to(a,h,d),i&&i.animate().wait(c).to(a,h,d));break;case"after-all":n===e.length-1&&_.animationState.end&&(e.forEach(y=>{y.animate({onStart:x}).wait(c).to(a,h,d)}),s.forEach(y=>{y.animate().wait(c).to(a,h,d)}));break;default:if(this._isCollectionBase){let y=this._idToPoint.get(t.attribute.id);!y||t.animates&&t.animates.has("label-animate")||!o.containsPoint(y.x,y.y,io.LOCAL,(f=this.stage)===null||f===void 0?void 0:f.getPickerService())||(t.animate({onStart:x}).wait(c).to(a,h,d),i&&i.animate().wait(c).to(a,h,d))}else _.animationState.isFirstFrameOfStep&&(t.animate({onStart:x}).wait(c).to(a,h,d),i&&i.animate().wait(c).to(a,h,d))}};return u}_smartInvert(t){var e,i,s,n,o,a,l;let h=ct(this.attribute.smartInvert)?this.attribute.smartInvert:{},{textType:d,contrastRatiosThreshold:c,alternativeColors:u,mode:p,interactInvertType:m}=h,g=(e=h.fillStrategy)!==null&&e!==void 0?e:"invertBase",f=(i=h.strokeStrategy)!==null&&i!==void 0?i:"base",_=(s=h.brightColor)!==null&&s!==void 0?s:"#ffffff",v=(n=h.darkColor)!==null&&n!==void 0?n:"#000000",x=(o=h.outsideEnable)!==null&&o!==void 0&&o;if(g!=="null"||f!=="null")for(let y=0;y<t.length;y++){let b=t[y];if(!b)continue;let S=this.getRelatedGraphic(b.attribute),C=S.attribute.fill,k=b.attribute.fill;if(ct(C)&&C.gradient){let B=(l=(a=C.stops)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.color;B&&(C=B,k=B)}let M=Ff(k,C,d,c,u,p),E=uS(M,_)?_:v,D=this._canPlaceInside(b.AABBBounds,S.AABBBounds),P=!D&&b.AABBBounds&&S.AABBBounds&&S.AABBBounds.intersects(b.AABBBounds);if(D||x||P&&m==="inside"){let B=Of(g,C,M,E);if(B&&b.setAttributes({fill:B}),b.attribute.lineWidth===0||b.attribute.strokeOpacity===0)continue;let L=Of(f,C,M,E);L&&b.setAttributes({stroke:L})}else if(P&&m!=="none"){if(b.attribute.lineWidth===0||b.attribute.strokeOpacity===0)continue;if(b.attribute.stroke){b.setAttributes({fill:Ff(b.attribute.fill,b.attribute.stroke,d,c,u,p)});continue}let B=Of(g,C,M,E);B&&b.setAttributes({fill:B});let L=Of(f,C,M,E);L&&b.setAttributes({stroke:L})}}}_canPlaceInside(t,e){return!(!t||!e)&&e.encloses(t)}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._enableAnimation=!1}enableAnimation(){this._enableAnimation=!0}};ud.defaultAttributes={textStyle:{fontSize:12,textAlign:"center",textBaseline:"middle",boundsPadding:[-2,-1,-2,-1]},offset:0,pickable:!1};var E9={},FS=(r,t)=>{E9[r]=t};var w9=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Jf=class r extends ud{constructor(t,e){let{data:i}=t,s=w9(t,["data"]);super(e?.skipDefault?t:Object.assign({data:i},G({},r.defaultAttributes,s)))}labeling(t,e,i="top",s=0){if(!t||!e)return;let{x1:n,y1:o,x2:a,y2:l}=t,h=Math.abs(a-n),d=Math.abs(l-o),{x:c,y:u}=IP(e,i),p=0,m=0,g=i.includes("inside");switch(i.includes("top")?m=g?1:-1:i.includes("bottom")?m=g?-1:1:i.includes("left")?p=g?1:-1:i.includes("right")&&(p=g?-1:1),i){case"top-right":case"bottom-right":p=-1;break;case"top-left":case"bottom-left":p=1}return{x:c+p*s+p*h/2,y:u+m*s+m*d/2}}};Jf.tag="rect-label",Jf.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};var B3=()=>{FS("rect",Jf)};var P9=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},nE=class{constructor(t,e,i,s,n,o,a,l,h){this.refDatum=t,this.center=e,this.outerCenter=i,this.quadrant=s,this.radian=n,this.middleAngle=o,this.innerRadius=a,this.outerRadius=l,this.circleCenter=h,this.labelVisible=!0}getLabelBounds(){return this.labelPosition&&this.labelSize?{x1:this.labelPosition.x-this.labelSize.width/2,y1:this.labelPosition.y-this.labelSize.height/2,x2:this.labelPosition.x+this.labelSize.width/2,y2:this.labelPosition.y+this.labelSize.height/2}:{x1:0,x2:0,y1:0,y2:0}}},OS=class r extends ud{constructor(t,e){let{data:i}=t,s=P9(t,["data"]);super(e?.skipDefault?t:Object.assign({data:i},G({},r.defaultAttributes,s))),this.name="arc-label",this._ellipsisWidth=0,this._arcLeft=new Map,this._arcRight=new Map,this._line2MinLength=0,this._alignOffset=0}_overlapping(t){return["inside","inside-center"].includes(this.attribute.position)?super._overlapping(t):t}labeling(t,e,i="outside",s=0){if(t&&e)return{x:0,y:0}}_layout(t){var e,i,s;if(!t||!t.length)return;let n=super._layout(t),o=n.map(u=>this.getGraphicBounds(u)),a=Object.assign(Object.assign({},this.attribute.textStyle),{text:"\u2026"}),l=1/0;if(a.ellipsis!==!1){let u=this._createLabelText(a),p=this.getGraphicBounds(u);l=p.x2-p.x1}let h=n.map(u=>u.attribute),d=Array.from(this._idToGraphic.values());this._line2MinLength=V(this.attribute.line.line2MinLength)?this.attribute.line.line2MinLength(t,d,this.attribute):this.attribute.line.line2MinLength,this._alignOffset=(e=V(this.attribute.layout.alignOffset)?this.attribute.layout.alignOffset(t,d,this.attribute):this.attribute.layout.alignOffset)!==null&&e!==void 0?e:0;let c=this.layoutArcLabels(this.attribute.position,this.attribute,d,h,o,l);for(let u=0;u<h.length;u++){let p=h[u],m=c.find(g=>{var f;return((f=g.refDatum)===null||f===void 0?void 0:f.id)===p.id});if(m){let g={visible:m.labelVisible,x:m.labelPosition.x,y:m.labelPosition.y,angle:m.angle,points:m.pointA&&m.pointB&&m.pointC?[m.pointA,m.pointB,m.pointC]:void 0,line:m.labelLine};n[u].type==="richtext"?g.width=(i=m.labelLimit)!==null&&i!==void 0?i:n[u].attribute.width:g.maxLineWidth=(s=m.labelLimit)!==null&&s!==void 0?s:n[u].attribute.maxLineWidth,m.refArc&&m.refArc.type==="arc3d"&&(g.anchor3d=[m.circleCenter.x-g.x,m.circleCenter.y-g.y],g.beta=m.refArc.attribute.beta),n[u].setAttributes(g)}}return n}layoutArcLabels(t,e,i,s,n,o){this._arcLeft.clear(),this._arcRight.clear(),this._ellipsisWidth=o;let a=0;i.forEach(c=>{c.attribute.outerRadius>a&&(a=c.attribute.outerRadius)}),s.forEach((c,u)=>{var p,m;let g=this._idToGraphic.get(c.id),f=g.attribute,_={x:(p=f?.x)!==null&&p!==void 0?p:0,y:(m=f?.y)!==null&&m!==void 0?m:0};if(!T(s[u])&&!T(n[u])){let v=s[u]?s[u]:null,x=n[u]?n[u]:{x1:0,x2:0,y1:0,y2:0},y=(f.startAngle+f.endAngle)/2,b=f.endAngle-f.startAngle,S=zv(f.endAngle-b/2),C=oe(_,f.outerRadius,y),k=oe(_,a+e.line.line1MinLength,y),M=new nE(v,C,k,S,b,y,f.innerRadius,f.outerRadius,_);M.refArc=g,M.pointA=oe(_,this.computeDatumRadius(2*_.x,2*_.y,f.outerRadius),M.middleAngle),M.labelSize={width:x.x2-x.x1,height:x.y2-x.y1},A3(M.quadrant)?this._arcRight.set(M.refDatum,M):bl(M.quadrant)&&this._arcLeft.set(M.refDatum,M)}});let l=Array.from(this._arcLeft.values()),h=Array.from(this._arcRight.values()),d=[];switch(t){case"inside":case"inside-inner":case"inside-outer":case"inside-center":d.push(...this._layoutInsideLabels(h,e,i)),d.push(...this._layoutInsideLabels(l,e,i));break;default:d.push(...this._layoutOutsideLabels(h,e,i)),d.push(...this._layoutOutsideLabels(l,e,i))}return d}_layoutInsideLabels(t,e,i){var s,n;let o=e,a=o.spaceWidth,l=(s=o.position)!==null&&s!==void 0?s:"inside",h=(n=o.offsetRadius)!==null&&n!==void 0?n:-a;return t.forEach(d=>{var c,u,p;let{labelSize:m,radian:g}=d,f=d.innerRadius,_=d.outerRadius,v;if(g<T3(_,m.height))v=0;else{let k;k=g>=Math.PI?f:Math.max(f,m.height/2/Math.tan(g/2)),v=_-k-a}o.rotate!==!0&&(v=_-a);let x=this._getFormatLabelText(d.refDatum,v);d.labelText=x;let y=Math.min(v,d.labelSize.width),b=this._computeAlign(d,e),S,C=0;if(l==="inside"&&(C=b==="left"?y:b==="right"?0:y/2),S=l==="inside-inner"?f-h+C:l==="inside-center"?f+(_-f)/2:_+h-C,d.labelPosition=oe(d.circleCenter,S,d.middleAngle),d.labelLimit=y,us(y,0)||(d.labelVisible=!1),o.rotate!==!1){d.angle=(u=(c=e.textStyle)===null||c===void 0?void 0:c.angle)!==null&&u!==void 0?u:d.middleAngle;let k=(p=o.offsetAngle)!==null&&p!==void 0?p:0;["inside-inner","inside-outer"].includes(l)&&(k+=Math.PI/2),d.angle+=k}}),t}_layoutOutsideLabels(t,e,i){var s,n,o;let a=(s=i[0].attribute.x)!==null&&s!==void 0?s:0,l=2*((n=i[0].attribute.y)!==null&&n!==void 0?n:0),h=e.layout,d=e.spaceWidth;if(t.forEach(u=>{let p=bl(u.quadrant)?-1:1;u.labelPosition={x:u.outerCenter.x+p*(u.labelSize.width/2+this._line2MinLength+d),y:u.outerCenter.y}}),t.sort((u,p)=>u.labelPosition.y-p.labelPosition.y),e.coverEnable!==!1||h.strategy==="none"){for(let u of t){let{labelPosition:p,labelSize:m}=u;u.labelLimit=m.width,u.pointB=bl(u.quadrant)?{x:p.x+m.width/2+this._line2MinLength+d,y:p.y}:{x:p.x-m.width/2-this._line2MinLength-d,y:p.y},this._computeX(u,e,i)}e.coverEnable===!1&&h.strategy==="none"&&this._coverLabels(t)}else{let u=l/(((o=e.textStyle)===null||o===void 0?void 0:o.fontSize)||16);this._adjustY(t,u,e,i);let{minY:p,maxY:m}=t.reduce((_,v)=>{let{y1:x,y2:y}=v.getLabelBounds();return _.minY=Math.max(0,Math.min(x,_.minY)),_.maxY=Math.min(l,Math.max(y,_.maxY)),_},{minY:1/0,maxY:-1/0}),g=Math.max(Math.abs(l/2-p),Math.abs(m-l/2)),f=this._computeLayoutRadius(g,e,i);for(let _ of t)this._computePointB(_,f,e,i),this._computeX(_,e,i)}let c=2*a;return t.forEach(u=>{var p,m;u.labelVisible&&(Zr(u.pointB.x,this._line2MinLength+d)||us(u.pointB.x,c-this._line2MinLength-d))&&(u.labelVisible=!1),u.angle=(m=(p=e.textStyle)===null||p===void 0?void 0:p.angle)!==null&&m!==void 0?m:0,e.offsetAngle&&(u.angle+=e.offsetAngle),u.labelLine=Object.assign(Object.assign({},e.line),{visible:u.labelVisible})}),t}_computeX(t,e,i){var s;let n=t.circleCenter,o=0,a=this.attribute.width;this.attribute.height;let l=0;i.forEach(M=>{M.attribute.outerRadius>l&&(l=M.attribute.outerRadius)});let h=this.computeLayoutOuterRadius(l,e.width,e.height),d=e.line.line1MinLength,c=(s=e.layout)===null||s===void 0?void 0:s.align,u=e.spaceWidth,{labelPosition:p,quadrant:m,pointB:g}=t;K(g.x*g.y)||(t.pointC={x:NaN,y:NaN},p.x=NaN,t.labelLimit=0);let f=this.computeRadius(h,e.width,e.height),_=bl(m)?-1:1,v=0,x=(_>0?a-g.x:g.x-o)+this._alignOffset-this._line2MinLength-u;c==="labelLine"&&(v=(f+d+this._line2MinLength)*_+n.x,x=(_>0?a-v:v-o)-u);let y=this._getFormatLabelText(t.refDatum,x);t.labelText=y;let b=Math.min(x,t.labelSize.width);switch(c){case"labelLine":break;case"edge":v=_>0?a-b-u:o+b+u;break;default:v=g.x+_*this._line2MinLength}b=Math.max(this._ellipsisWidth,b);let S=b<t.labelSize.width-1;t.labelLimit=S?b:null,t.pointC={x:v,y:p.y};let C=this._computeAlign(t,e),k=E3(C)*(S?b:t.labelSize.width);c==="edge"?(p.x=(_>0?a:o)-_*k+_*this._alignOffset,t.pointC.x+=_*this._alignOffset):p.x=v+_*(this._alignOffset+u+k)}_computeAlign(t,e){var i,s,n,o,a,l;let h=e,d=(s=(i=h.textStyle)===null||i===void 0?void 0:i.textAlign)!==null&&s!==void 0?s:(n=h.textStyle)===null||n===void 0?void 0:n.align,c=(a=(o=h.layout)===null||o===void 0?void 0:o.textAlign)!==null&&a!==void 0?a:(l=h.layout)===null||l===void 0?void 0:l.align;return h.position!=="inside"?T(d)||d==="auto"?c==="edge"?bl(t.quadrant)?"left":"right":bl(t.quadrant)?"right":"left":d:T(d)||d==="auto"?"center":d}_getFormatLabelText(t,e){var i;return(i=t?.text)!==null&&i!==void 0?i:""}_adjustY(t,e,i,s){var n,o;n=s[0].attribute.x;let a=2*((o=s[0].attribute.y)!==null&&o!==void 0?o:0),l=i.layout;if(l.strategy==="vertical"){let h,d=0,c=t.length;if(c<=0)return;for(let p=0;p<c;p++){let{y1:m}=t[p].getLabelBounds();if(h=m-d,Zr(h,0)){let f=this._shiftY(t,p,c-1,-h);this._shiftY(t,f,0,h/2)}let{y2:g}=t[p].getLabelBounds();d=g}let{y1:u}=t[0].getLabelBounds();h=u-0,Zr(h,0)&&this._shiftY(t,0,c-1,-h);for(let p=t.length-1;p>=0&&t[p].getLabelBounds().y2>a;p--)t[p].labelVisible=!1}else if(l.strategy!=="none"){let h=t.map((u,p)=>({arc:u,originIndex:p,priorityIndex:0}));h.sort((u,p)=>p.arc.radian-u.arc.radian),h.forEach((u,p)=>{u.priorityIndex=p,u.arc.labelVisible=!1});let d=1/0,c=-1/0;for(let u=0;u<e&&u<t.length;u++){this._storeY(t);let p=h[u].arc;this._computeYRange(p,i,s),p.labelVisible=!0;let m=p.labelPosition.y,{lastIndex:g,nextIndex:f}=this._findNeighborIndex(t,h[u]),_=t[g],v=t[f];if(g===-1&&f!==-1){let S=v.labelPosition.y;m>S?p.labelPosition.y=S-v.labelSize.height/2-p.labelSize.height/2:this._twoWayShift(t,p,v,f)}else if(g!==-1&&f===-1){let S=_.labelPosition.y;m<S?p.labelPosition.y=S+_.labelSize.height/2+p.labelSize.height/2:this._twoWayShift(t,_,p,h[u].originIndex)}else if(g!==-1&&f!==-1){let S=_.labelPosition.y,C=v.labelPosition.y;m>C?(p.labelPosition.y=C-v.labelSize.height/2-p.labelSize.height/2,this._twoWayShift(t,_,p,h[u].originIndex)):m<S?(p.labelPosition.y=S+_.labelSize.height/2+p.labelSize.height/2,this._twoWayShift(t,p,v,f)):(this._twoWayShift(t,_,p,h[u].originIndex),this._twoWayShift(t,p,v,f))}let x=Math.min(d,h[u].originIndex),y=Math.max(c,h[u].originIndex),b;if(b=t[y].getLabelBounds().y2-a,us(b,0)&&this._shiftY(t,y,0,-b),b=t[x].getLabelBounds().y1-0,Zr(b,0)&&this._shiftY(t,x,t.length-1,-b),b=t[y].getLabelBounds().y2-a,us(b,0)){p.labelVisible=!1,this._restoreY(t);break}l.tangentConstraint&&!this._checkYRange(t)?(p.labelVisible=!1,this._restoreY(t)):(d=x,c=y)}}}_shiftY(t,e,i,s){let n=e<i?1:-1,o=e;for(;o!==-1;){t[o].labelPosition.y+=s;let a=this._findNextVisibleIndex(t,o,i,n);if(a>=0&&a<t.length){let{y1:l,y2:h}=t[o].getLabelBounds(),{y1:d,y2:c}=t[a].getLabelBounds();if(n>0&&h<d||n<0&&l>c)return o}o=a}return i}_findNextVisibleIndex(t,e,i,s){let n=(i-e)*s;for(let o=1;o<=n;o++){let a=e+o*s;if(t[a].labelVisible)return a}return-1}_computePointB(t,e,i,s){let n=i,o=0;s.forEach(h=>{h.attribute.outerRadius>o&&(o=h.attribute.outerRadius)});let a=this.computeLayoutOuterRadius(o,i.width,i.height),l=n.line.line1MinLength;if(n.layout.strategy==="none")t.pointB={x:t.outerCenter.x,y:t.outerCenter.y};else{let h=t.circleCenter,d=this.computeRadius(a,i.width,i.height),{labelPosition:c,quadrant:u}=t,p=e-Math.max(d+l,t.outerRadius),m=Math.sqrt(e**2-Math.abs(h.y-c.y)**2)-p;K(m)?t.pointB={x:h.x+m*(bl(u)?-1:1),y:c.y}:t.pointB={x:NaN,y:NaN}}}_storeY(t){for(let e of t)e.labelVisible&&(e.lastLabelY=e.labelPosition.y)}_computeYRange(t,e,i){let s=t.circleCenter,n={width:2*s.x,height:2*s.y},o=0;i.forEach(b=>{b.attribute.outerRadius>o&&(o=b.attribute.outerRadius)});let a=this.computeLayoutOuterRadius(o,e.width,e.height),l=e.line.line1MinLength,{width:h,height:d}=n,c=this.computeRadius(a,e.width,e.height),u=this._computeLayoutRadius(d/2,e,i),p=Math.abs(t.center.x-h/2),m=t.center.y-d/2,g,f,_;if(Re(h/2,p))g=0,f=1,_=-m;else if(Re(d/2,m))g=1,f=0,_=-p;else{let b=-1/(m/p);g=b,f=-1,_=m-b*p}let v=C3(g,f,_,l+c-u,0,u);if(v.length<2)return;let x,y;v[0].x>v[1].x&&v.reverse(),v[0].x<0?Re(v[0].y,v[1].y)?us(t.middleAngle,-Math.PI)&&Zr(t.middleAngle,0)||us(t.middleAngle,Math.PI)&&Zr(t.middleAngle,2*Math.PI)?(x=0,y=v[1].y+d/2):(x=v[1].y+d/2,y=d):v[0].y<v[1].y?(x=0,y=v[1].y+d/2):(x=v[1].y+d/2,y=n.height):(x=Math.min(v[0].y,v[1].y)+d/2,y=Math.max(v[0].y,v[1].y)+d/2),t.labelYRange=[x,y]}_computeLayoutRadius(t,e,i){let s=e,n=s.layoutArcGap,o=s.line.line1MinLength,a=0;i.forEach(c=>{c.attribute.outerRadius>a&&(a=c.attribute.outerRadius)});let l=this.computeLayoutOuterRadius(a,e.width,e.height),h=this.computeRadius(l,e.width,e.height)+o,d=h-n;return Math.max((d**2+t**2)/(2*d),h)}_findNeighborIndex(t,e){let i=e.originIndex,s=-1,n=-1;for(let o=i-1;o>=0;o--)if(t[o].labelVisible){s=o;break}for(let o=i+1;o<t.length;o++)if(t[o].labelVisible){n=o;break}return{lastIndex:s,nextIndex:n}}_twoWayShift(t,e,i,s){let n=i.getLabelBounds().y1-e.getLabelBounds().y2;if(Zr(n,0)){let o=this._shiftY(t,s,t.length-1,-n);this._shiftY(t,o,0,n/2)}}_restoreY(t){for(let e of t)e.labelVisible&&(e.labelPosition.y=e.lastLabelY)}_checkYRange(t){for(let e of t){let{labelYRange:i,labelPosition:s}=e;if(e.labelVisible&&i&&(Zr(s.y,i[0])||us(s.y,i[1])))return!1}return!0}_coverLabels(t){if(t.length<=1)return;let e=t[0].getLabelBounds();for(let i=1;i<t.length;i++){let s=t[i].getLabelBounds();k3(e,s)?t[i].labelVisible=!1:e=s}}_getLabelLinePoints(t,e){return t.attribute.points}_createLabelLine(t,e){var i,s,n,o,a;let{line:l={},visible:h}=t.attribute,d=super._createLabelLine(t,e);if(d&&(d.setAttributes({visible:(n=(i=l.visible&&h)!==null&&i!==void 0?i:(s=t.attribute)===null||s===void 0?void 0:s.visible)===null||n===void 0||n,lineWidth:(a=(o=l.style)===null||o===void 0?void 0:o.lineWidth)!==null&&a!==void 0?a:1}),l.smooth&&d.setAttributes({curveType:"basis"}),e.type==="arc3d"&&e)){let{beta:c,x:u,y:p}=e.attribute;d.setAttributes({beta:c,anchor3d:[u,p]})}return d}computeRadius(t,e,i,s){return this.computeLayoutRadius(e||0,i||0)*t*(T(s)?1:s)}computeLayoutRadius(t,e){return Math.min(t/2,e/2)}_canPlaceInside(t,e){return this.attribute.position==="inside"||this.attribute.position==="inside-center"}computeLayoutOuterRadius(t,e,i){return t/(Math.min(e,i)/2)}computeDatumRadius(t,e,i){let s=this.computeLayoutOuterRadius(i,t,e);return this.computeLayoutRadius(t||0,e||0)*s}};OS.defaultAttributes={coverEnable:!1,spaceWidth:5,layoutArcGap:6,textStyle:{visible:!0,fontSize:14,fontWeight:"normal",fillOpacity:1,boundsPadding:[-1,0,-1,0],ellipsis:!0},position:"outside",line:{visible:!0,line1MinLength:20,line2MinLength:10},layout:{align:"arc",strategy:"priority",tangentConstraint:!0}};var L3=()=>{FS("arc",OS)};function oE(r,t,e,i){let s="";if(!r||t.length===0)return s;let n=t[0],o=pe.distancePP(r,n),a=e?0:1;return i?s+=`M${r.x},${r.y-o}A${o},${o},0,0,${a},${r.x},${r.y+o}A${o},${o},0,0,${a},${r.x},${r.y-o}Z`:t.forEach((l,h)=>{h===0?s=`M${l.x},${l.y}`:s+=`A${o},${o},0,0,${a},${l.x},${l.y}`}),s}function R9(r,t,e){let{type:i,closed:s}=e,n=t.slice(0).reverse(),o="",a="";if(i==="line"&&e.smoothLink&&e.center){let l=r[0],h=n[0],d=e.center;o=aa(r,!!s),a=aa(n,!!s);let c=pe.distancePP(h,d),u=pe.distancePP(l,d);o+=`A${c},${c},0,0,1,${h.x},${h.y}L${h.x},${h.y}`,a+=`A${u},${u},0,0,0,${l.x},${l.y}`}else if(i==="circle"){let{center:l}=e;o=oE(l,r,!1,!!s),a=oE(l,n,!0,!!s)}else i!=="line"&&i!=="polygon"||(o=aa(r,!!s),a=aa(n,!!s));return s?o+=a:(a="L"+a.substring(1),o+=a,o+="Z"),o}var ha=class r extends xe{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&fS(this._innerView),this.removeAllChild(!0),this._innerView=Q.group({x:0,y:0,pickable:!1}),this.add(this._innerView);let{items:t,visible:e}=this.attribute;t&&t.length&&e!==!1&&(this.data=this._transformItems(t),this._renderGrid(this._innerView))}getVerticalCoord(t,e,i){return Uf(t,this.getVerticalVector(e,i,t))}_transformItems(t){let e=[];return t.forEach(i=>{var s;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(s=i.id)!==null&&s!==void 0?s:i.label}))}),e}_renderGrid(t){let{visible:e}=this.attribute.subGrid||{};e&&this._renderGridByType(!0,t),this._renderGridByType(!1,t)}_renderGridByType(t,e){let i=G({},this.attribute,this.getGridAttribute(t)),{type:s,items:n,style:o,closed:a,alternateColor:l,depth:h=0}=i,d=t?`${oi.grid}-sub`:`${oi.grid}`;if(n.forEach((c,u)=>{let{id:p,points:m}=c,g="";if(s==="line"||s==="polygon")g=aa(m,!!a);else if(s==="circle"){let{center:_}=this.attribute;g=oE(_,m,!1,!!a)}let f=Q.path(Object.assign({path:g,z:h},V(o)?G({},this.skipDefault?null:r.defaultAttributes.style,o(c,u)):o));f.name=`${d}-line`,f.id=this._getNodeId(`${d}-path-${p}`),e.add(f)}),h&&s==="line"&&n.forEach((c,u)=>{let{id:p,points:m}=c,g=[];g.push(m[0]);let f=m[1].x-m[0].x,_=m[1].y-m[0].y,v=Math.sqrt(f*f+_*_),x=h/v;g.push({x:m[0].x+f*x,y:m[0].y+_*x});let y=aa(g,!!a),b=Dt(g[0].x-g[1].x),S=Dt(g[0].y-g[1].y),C=Q.path(Object.assign({path:y,z:0,alpha:b>S?(m[1].x-m[0].x>0?-1:1)*ge/2:0,beta:b<S?-ge/2:0,anchor3d:b>S?[g[0].x,0]:[0,g[0].y]},V(o)?G({},this.skipDefault?null:r.defaultAttributes.style,o(c,u)):o));C.name=`${d}-line`,C.id=this._getNodeId(`${d}-path-${p}`),e.add(C)}),n.length>1&&l){let c=H(l)?l:[l,"transparent"],u=y=>c[y%c.length],p=this.attribute.items,m=p[0],g=p[p.length-1],f=!Re(m.value,0)&&!Re(g.value,0),_=!Re(m.value,1)&&!Re(g.value,1),v=[],x=m.value>g.value;(x&&_||!x&&f)&&v.push(this.getGridPointsByValue(x?1:0)),n.forEach(y=>{v.push(y.points)}),(x&&f||!x&&_)&&v.push(this.getGridPointsByValue(x?0:1));for(let y=0;y<v.length-1;y++){let b=R9(v[y],v[y+1],i),S=Q.path({path:b,fill:u(y)});S.name=`${d}-region`,S.id=this._getNodeId(`${d}-region-${y}`),e.add(S)}}}_getNodeId(t){return`${this.id}-${t}`}_parseTickSegment(){let t=1;return this.data.length>=2&&(t=this.data[1].value-this.data[0].value),t}_getPointsOfSubGrid(t,e){let i=this.data.length,s=[];return i>=2&&this.data.forEach(n=>{let o=n.value;if(!e){let a=n.value-t/2;if(this.isInValidValue(a))return;o=a}s.push({value:o})}),s}release(){super.release(),this._prevInnerView=null,this._innerView=null}};ha.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}};G2();var Qf=class extends ha{constructor(t,e){super(e?.skipDefault?t:G({},ha.defaultAttributes,t),e)}_getGridPoint(t,e){let i;if(t==="line"){let{length:s}=this.attribute;i=[e,this.getVerticalCoord(e,s,!0)]}else if(t==="circle"||t==="polygon"){let{center:s,sides:n=6,startAngle:o=Sn,endAngle:a=An}=this.attribute,l=pe.distancePP(s,e);i=_S(s,n,l,o,a)}return i}getGridPointsByValue(t){let e=this.getTickCoord(t);return this._getGridPoint(this.attribute.type,e)}getGridAttribute(t){let{type:e,alignWithLabel:i=!0}=this.attribute,s=this._parseTickSegment(),n,o=[];if(t){n=G({},this.attribute,this.attribute.subGrid);let a=[],{count:l=4}=n;if(this.data.length>=2){let h=this._getPointsOfSubGrid(s,i);for(let d=0;d<h.length-1;d++){let c=h[d],u=h[d+1];a.push({id:`sub-${d}-0`,points:this.getGridPointsByValue(c.value),datum:{}});for(let p=0;p<l;p++){let m=(p+1)/(l+1),g=(1-m)*c.value+m*u.value;a.push({id:`sub-${d}-${p+1}`,points:this.getGridPointsByValue(g),datum:{}})}d===h.length-2&&a.push({id:`sub-${d}-${l+1}`,points:this.getGridPointsByValue(u.value),datum:{}})}o=a}}else{n=this.attribute;let a=[];this.data.forEach(l=>{let{point:h}=l;if(!i){let d=l.value-s/2;if(this.isInValidValue(d))return;h=this.getTickCoord(d)}a.push({id:l.label,datum:l,points:this._getGridPoint(e,h)})}),o=a}return Object.assign(Object.assign({},n),{items:o})}};Ct(Qf,Cu);var B9=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};U2();var t_=class extends ha{constructor(t,e){super(e?.skipDefault?t:G({},ha.defaultAttributes,t),e)}getGridPointsByValue(t){let e=this.getTickCoord(t),{radius:i,innerRadius:s=0}=this.attribute;return[e,this.getVerticalCoord(e,i-s,!0)]}getGridAttribute(t){let e,i=[],s=this.attribute,{radius:n,innerRadius:o=0,startAngle:a=Sn,endAngle:l=An,center:h,subGrid:d}=s,c=B9(s,["radius","innerRadius","startAngle","endAngle","center","subGrid"]),{alignWithLabel:u=!0}=c||{},p=n-o,m=this._parseTickSegment();if(t){e=G({},c,d);let g=[],{count:f=4}=d||{},_=this.data.length;if(_>=2){let v=this._getPointsOfSubGrid(m,u);for(let x=0;x<_;x++){let y=v[x],b=v[x+1];g.push({id:`sub-${x}-0`,points:[this.getTickCoord(y.value),this.getVerticalCoord(this.getTickCoord(y.value),p,!0)],datum:{}});for(let S=0;S<f;S++){let C=(S+1)/(f+1),k=(1-C)*y.value+C*(b?b.value:u?1:y.value+m),M=this.getTickCoord(k),E=this.getVerticalCoord(M,p,!0);g.push({id:`sub-${x}-${S+1}`,points:[M,E],datum:{}})}}Math.abs(l-a)%(2*Math.PI)==0&&g.push(g[0]),i=g}}else{e=c;let g=[],f;f=Math.abs(l-a)%(2*Math.PI)==0?[...this.data].concat(this.data[0]):this.data,f.forEach(_=>{let{point:v}=_;if(!u){let y=_.value-m/2;if(this.isInValidValue(y))return;v=this.getTickCoord(y)}let x=this.getVerticalCoord(v,p,!0);g.push({id:_.id,points:[v,x],datum:_})}),i=g}return Object.assign(Object.assign({},e),{items:i,center:h,type:"line"})}};Ct(t_,ku);var I3="M -0.0544 0.25 C -0.0742 0.25 -0.0901 0.234 -0.0901 0.2143 L -0.0901 -0.1786 C -0.0901 -0.1983 -0.0742 -0.2143 -0.0544 -0.2143 L -0.0187 -0.2143 L -0.0187 -0.5 L 0.017 -0.5 L 0.017 -0.2143 L 0.0527 -0.2143 C 0.0724 -0.2143 0.0884 -0.1983 0.0884 -0.1786 L 0.0884 0.2143 C 0.0884 0.234 0.0724 0.25 0.0527 0.25 L 0.017 0.25 L 0.017 0.5 L -0.0187 0.5 L -0.0187 0.25 L -0.0544 0.25 Z M -0.0187 -0.1429 L -0.0544 -0.1429 L -0.0544 0.1786 L -0.0187 0.1786 L -0.0187 -0.1429 Z M 0.0527 -0.1429 L 0.017 -0.1429 L 0.017 0.1786 L 0.0527 0.1786 L 0.0527 -0.1429 Z",F3={orient:"bottom",showDetail:"auto",brushSelect:!0,zoomLock:!1,minSpan:0,maxSpan:1,delayType:"throttle",delayTime:0,realTime:!0,backgroundStyle:{fill:"white",stroke:"#D1DBEE",lineWidth:1,cornerRadius:2},dragMaskStyle:{fill:"#B0C8F9",fillOpacity:.2},backgroundChartStyle:{area:{visible:!0,stroke:"#D1DBEE",lineWidth:1,fill:"#F6F8FC"},line:{visible:!0,stroke:"#D1DBEE",lineWidth:1}},selectedBackgroundStyle:{fill:"#B0C8F9",fillOpacity:.5},selectedBackgroundChartStyle:{area:{visible:!0,stroke:"#B0C8F9",lineWidth:1,fill:"#fbb934"},line:{visible:!0,stroke:"#fbb934",lineWidth:1}},middleHandlerStyle:{visible:!0,background:{size:8,style:{fill:"white",stroke:"#B0C8F9",cornerRadius:2}},icon:{size:6,fill:"white",stroke:"#B0C8F9",symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}},startHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:I3,fill:"white",stroke:"#B0C8F9",lineWidth:.5},endHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:I3,fill:"white",stroke:"#B0C8F9",lineWidth:.5},startTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}},endTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}}},da={horizontal:{angle:0,strokeBoundsBuffer:0,boundsPadding:2,pickMode:"imprecise",cursor:"ew-resize"},vertical:{angle:Math.PI/180*90,cursor:"ns-resize",boundsPadding:2,pickMode:"imprecise",strokeBoundsBuffer:0}};var Dr;(function(r){r.startHandler="startHandler",r.endHandler="endHandler",r.middleHandler="middleHandler",r.background="background"})(Dr||(Dr={}));function O3(){vl(),rs(),Mr(),AD(),is()}var H3=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},L9={debounce:Zi,throttle:Hi};O3();var e_=class r extends xe{setPropsFromAttrs(){let{start:t,end:e,orient:i,previewData:s,previewPointsX:n,previewPointsY:o,previewPointsX1:a,previewPointsY1:l}=this.attribute;t&&(this.state.start=t),e&&(this.state.end=e);let{width:h,height:d}=this.getLayoutAttrFromConfig();this._spanCache=this.state.end-this.state.start,this._isHorizontal=i==="top"||i==="bottom",this._layoutCache.max=this._isHorizontal?h:d,this._layoutCache.attPos=this._isHorizontal?"x":"y",this._layoutCache.attSize=this._isHorizontal?"width":"height",s&&(this._previewData=s),V(n)&&(this._previewPointsX=n),V(o)&&(this._previewPointsY=o),V(a)&&(this._previewPointsX1=a),V(l)&&(this._previewPointsY1=l)}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="dataZoom",this._previewData=[],this._activeState=!1,this._activeCache={startPos:{x:0,y:0},lastPos:{x:0,y:0}},this._layoutCache={attPos:"x",attSize:"width",max:0},this.state={start:0,end:1},this._statePointToData=n=>n,this._onHandlerPointerDown=(n,o)=>{n.stopPropagation(),o==="start"?(this._activeTag=Dr.startHandler,this._activeItem=this._startHandlerMask):o==="end"?(this._activeTag=Dr.endHandler,this._activeItem=this._endHandlerMask):o==="middleRect"?(this._activeTag=Dr.middleHandler,this._activeItem=this._middleHandlerRect):o==="middleSymbol"?(this._activeTag=Dr.middleHandler,this._activeItem=this._middleHandlerSymbol):o==="background"&&(this._activeTag=Dr.background,this._activeItem=this._background),this._activeState=!0,this._activeCache.startPos=this.eventPosToStagePos(n),this._activeCache.lastPos=this.eventPosToStagePos(n),kt.env==="browser"&&(kt.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),kt.addEventListener("pointerup",this._onHandlerPointerUp)),this.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0})},this._pointerMove=n=>{n.stopPropagation();let{start:o,end:a,brushSelect:l,realTime:h=!0}=this.attribute,d=this.eventPosToStagePos(n),{attPos:c,max:u}=this._layoutCache,p=(d[c]-this._activeCache.lastPos[c])/u,{start:m,end:g}=this.state;this._activeState&&(this._activeTag===Dr.middleHandler?this.moveZoomWithMiddle((this.state.start+this.state.end)/2+p):this._activeTag===Dr.startHandler?m+p>g?(m=g,g=m+p,this._activeTag=Dr.endHandler):m+=p:this._activeTag===Dr.endHandler&&(g+p<m?(g=m,m=g+p,this._activeTag=Dr.startHandler):g+=p),this._activeCache.lastPos=d,l&&this.renderDragMask()),m=Math.min(Math.max(m,0),1),g=Math.min(Math.max(g,0),1),o===m&&a===g||(this.setStateAttr(m,g,!0),h&&this._dispatchEvent("change",{start:m,end:g,tag:this._activeTag}))},this._onHandlerPointerMove=this.attribute.delayTime===0?this._pointerMove:L9[this.attribute.delayType](this._pointerMove,this.attribute.delayTime),this._onHandlerPointerUp=n=>{n.preventDefault();let{start:o,end:a,brushSelect:l,realTime:h=!0}=this.attribute;if(this._activeState&&this._activeTag===Dr.background){let d=this.eventPosToStagePos(n);this.backgroundDragZoom(this._activeCache.startPos,d)}this._activeState=!1,l&&this.renderDragMask(),this._dispatchEvent("change",{start:this.state.start,end:this.state.end,tag:this._activeTag}),kt.env==="browser"&&(kt.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),kt.removeEventListener("pointerup",this._onHandlerPointerUp)),this.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.removeEventListener("pointerup",this._onHandlerPointerUp)};let{position:i,showDetail:s}=t;this._activeCache.startPos=i,this._activeCache.lastPos=i,this._showText=s!=="auto"&&s,this.setPropsFromAttrs()}setAttributes(t,e){super.setAttributes(t,e),this.setPropsFromAttrs()}bindEvents(){if(this.attribute.disableTriggerEvent)return void this.setAttribute("childrenPickable",!1);let{showDetail:t,brushSelect:e}=this.attribute;this._startHandlerMask&&this._startHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"start")),this._endHandlerMask&&this._endHandlerMask.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"end")),this._middleHandlerSymbol&&this._middleHandlerSymbol.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleSymbol")),this._middleHandlerRect&&this._middleHandlerRect.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"middleRect"));let i=e?"background":"middleRect";this._selectedBackground&&this._selectedBackground.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),e&&this._background&&this._background.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),e&&this._previewGroup&&this._previewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,"background")),this._selectedPreviewGroup&&this._selectedPreviewGroup.addEventListener("pointerdown",s=>this._onHandlerPointerDown(s,i)),this.addEventListener("pointerup",this._onHandlerPointerUp),this.addEventListener("pointerupoutside",this._onHandlerPointerUp),t==="auto"&&(this.addEventListener("pointerenter",this._onHandlerPointerEnter),this.addEventListener("pointerleave",this._onHandlerPointerLeave))}dragMaskSize(){let{position:t}=this.attribute,{attPos:e,max:i}=this._layoutCache;return this._activeCache.lastPos[e]-t[e]>i?i+t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-t[e]<0?t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-this._activeCache.startPos[e]}setStateAttr(t,e,i){let{zoomLock:s=!1,minSpan:n=0,maxSpan:o=1}=this.attribute,a=e-t;a!==this._spanCache&&(s||a<n||a>o)||(this._spanCache=a,this.state.start=t,this.state.end=e,i&&this.setAttributes({start:t,end:e}))}eventPosToStagePos(t){var e,i;return(i=(e=this.stage)===null||e===void 0?void 0:e.eventPointTransform(t))!==null&&i!==void 0?i:{x:0,y:0}}_onHandlerPointerEnter(t){t.stopPropagation(),this._showText=!0,this.renderText()}_onHandlerPointerLeave(t){t.stopPropagation(),this._showText=!1,this.renderText()}backgroundDragZoom(t,e){let{attPos:i,max:s}=this._layoutCache,{position:n}=this.attribute,o=t[i]-n[i],a=e[i]-n[i],l=Math.min(Math.max(Math.min(o,a)/s,0),1),h=Math.min(Math.max(Math.max(o,a)/s,0),1);Math.abs(l-h)<.01?this.moveZoomWithMiddle(l):this.setStateAttr(l,h,!1)}moveZoomWithMiddle(t){let e=t-(this.state.start+this.state.end)/2;e!==0&&(e>0?this.state.end+e>1&&(e=1-this.state.end):e<0&&this.state.start+e<0&&(e=-this.state.start),this.setStateAttr(this.state.start+e,this.state.end+e,!1))}renderDragMask(){let{dragMaskStyle:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig();this._isHorizontal?this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:ee(this.dragMaskSize()<0?this._activeCache.lastPos.x:this._activeCache.startPos.x,e.x,e.x+i),y:e.y,width:this._activeState&&this._activeTag===Dr.background&&Math.abs(this.dragMaskSize())||0,height:s},t),"rect"):this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:e.x,y:ee(this.dragMaskSize()<0?this._activeCache.lastPos.y:this._activeCache.startPos.y,e.y,e.y+s),width:i,height:this._activeState&&this._activeTag===Dr.background&&Math.abs(this.dragMaskSize())||0},t),"rect")}isTextOverflow(t,e,i){if(!e)return!1;if(this._isHorizontal){if(i==="start"){if(e.x1<t.x1)return!0}else if(e.x2>t.x2)return!0}else if(i==="start"){if(e.y1<t.y1)return!0}else if(e.y2>t.y2)return!0;return!1}setTextAttr(t,e){var i,s,n,o,a,l,h,d;let{startTextStyle:c,endTextStyle:u}=this.attribute,{formatMethod:p}=c,m=H3(c,["formatMethod"]),{formatMethod:g}=u,f=H3(u,["formatMethod"]),{start:_,end:v}=this.state;this._startValue=this._statePointToData(_),this._endValue=this._statePointToData(v);let{position:x,width:y,height:b}=this.getLayoutAttrFromConfig(),S=p?p(this._startValue):this._startValue,C=g?g(this._endValue):this._endValue,k={x1:x.x,y1:x.y,x2:x.x+y,y2:x.y+b},M,E,D,P;this._isHorizontal?(M={x:x.x+_*y,y:x.y+b/2},E={x:x.x+v*y,y:x.y+b/2},D={textAlign:this.isTextOverflow(k,t,"start")?"left":"right",textBaseline:(s=(i=m?.textStyle)===null||i===void 0?void 0:i.textBaseline)!==null&&s!==void 0?s:"middle"},P={textAlign:this.isTextOverflow(k,e,"end")?"right":"left",textBaseline:(o=(n=f?.textStyle)===null||n===void 0?void 0:n.textBaseline)!==null&&o!==void 0?o:"middle"}):(M={x:x.x+y/2,y:x.y+_*b},E={x:x.x+y/2,y:x.y+v*b},D={textAlign:(l=(a=m?.textStyle)===null||a===void 0?void 0:a.textAlign)!==null&&l!==void 0?l:"center",textBaseline:this.isTextOverflow(k,t,"start")?"top":"bottom"},P={textAlign:(d=(h=f?.textStyle)===null||h===void 0?void 0:h.textAlign)!==null&&d!==void 0?d:"center",textBaseline:this.isTextOverflow(k,e,"end")?"bottom":"top"}),this._startText=this.maybeAddLabel(this._container,G({},m,{text:S,x:M.x,y:M.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:D}),`data-zoom-start-text-${x}`),this._endText=this.maybeAddLabel(this._container,G({},f,{text:C,x:E.x,y:E.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:P}),`data-zoom-end-text-${x}`)}renderText(){let t=null,e=null;this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds,this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds;let{x1:i,x2:s,y1:n,y2:o}=t,{dx:a=0,dy:l=0}=this.attribute.startTextStyle;if(new Ye().set(i,n,s,o).intersects(e)){let h=this.attribute.orient==="bottom"||this.attribute.orient==="right"?-1:1;this._isHorizontal?this._startText.setAttribute("dy",l+h*Math.abs(e.y1-e.y2)):this._startText.setAttribute("dx",a+h*Math.abs(e.x1-e.x2))}else this._isHorizontal?this._startText.setAttribute("dy",l):this._startText.setAttribute("dx",a)}getLayoutAttrFromConfig(){var t,e,i,s,n,o;if(this._layoutAttrFromConfig)return this._layoutAttrFromConfig;let{position:a,size:l,orient:h,middleHandlerStyle:d={},startHandlerStyle:c={},endHandlerStyle:u={},backgroundStyle:p={}}=this.attribute,{width:m,height:g}=l,f=(e=(t=d.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10,_,v,x;d.visible?this._isHorizontal?(_=m,v=g-f,x={x:a.x,y:a.y+f}):(_=m-f,v=g,x={x:a.x+(h==="left"?f:0),y:a.y}):(_=m,v=g,x=a);let y=(i=c.size)!==null&&i!==void 0?i:this._isHorizontal?v:_,b=(s=u.size)!==null&&s!==void 0?s:this._isHorizontal?v:_;return c.visible&&(this._isHorizontal?(_-=(y+b)/2,x={x:x.x+y/2,y:x.y}):(v-=(y+b)/2,x={x:x.x,y:x.y+y/2})),v+=(n=p.lineWidth/2)!==null&&n!==void 0?n:1,_+=(o=p.lineWidth/2)!==null&&o!==void 0?o:1,this._layoutAttrFromConfig={position:x,width:_,height:v},this._layoutAttrFromConfig}render(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g,f,_,v,x,y,b,S,C,k,M,E,D,P,B,L,w,R,N,z;this._layoutAttrFromConfig=null;let{orient:Y,backgroundStyle:U,backgroundChartStyle:$={},selectedBackgroundStyle:ut={},selectedBackgroundChartStyle:mt={},middleHandlerStyle:bt={},startHandlerStyle:Ot={},endHandlerStyle:me={},brushSelect:Lt,zoomLock:Ht}=this.attribute,{start:de,end:je}=this.state,{position:zt,width:ke,height:Ze}=this.getLayoutAttrFromConfig(),Ds=(t=Ot.triggerMinSize)!==null&&t!==void 0?t:40,Es=(e=me.triggerMinSize)!==null&&e!==void 0?e:40,ii=this.createOrUpdateChild("dataZoom-container",{},"group");if(this._container=ii,this._background=ii.createOrUpdateChild("background",Object.assign(Object.assign({x:zt.x,y:zt.y,width:ke,height:Ze,cursor:Lt?"crosshair":"auto"},U),{pickable:!Ht&&((i=U.pickable)===null||i===void 0||i)}),"rect"),!((s=$.line)===null||s===void 0)&&s.visible&&this.setPreviewAttributes("line",ii),!((n=$.area)===null||n===void 0)&&n.visible&&this.setPreviewAttributes("area",ii),Lt&&this.renderDragMask(),this._isHorizontal?this._selectedBackground=ii.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:zt.x+de*ke,y:zt.y,width:(je-de)*ke,height:Ze,cursor:Lt?"crosshair":"move"},ut),{pickable:!Ht&&((o=mt.pickable)===null||o===void 0||o)}),"rect"):this._selectedBackground=ii.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:zt.x,y:zt.y+de*Ze,width:ke,height:(je-de)*Ze,cursor:Lt?"crosshair":"move"},ut),{pickable:!Ht&&((a=ut.pickable)===null||a===void 0||a)}),"rect"),!((l=mt.line)===null||l===void 0)&&l.visible&&this.setSelectedPreviewAttributes("line",ii),!((h=mt.area)===null||h===void 0)&&h.visible&&this.setSelectedPreviewAttributes("area",ii),this._isHorizontal){if(bt.visible){let Ea=((d=bt.background)===null||d===void 0?void 0:d.size)||10;this._middleHandlerRect=ii.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:zt.x+de*ke,y:zt.y-Ea,width:(je-de)*ke,height:Ea},(c=bt.background)===null||c===void 0?void 0:c.style),{pickable:!Ht&&((m=(p=(u=bt.background)===null||u===void 0?void 0:u.style)===null||p===void 0?void 0:p.pickable)===null||m===void 0||m)}),"rect"),this._middleHandlerSymbol=ii.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:zt.x+(de+je)/2*ke,y:zt.y-Ea/2,strokeBoundsBuffer:0,angle:0,symbolType:(f=(g=bt.icon)===null||g===void 0?void 0:g.symbolType)!==null&&f!==void 0?f:"square"},bt.icon),{pickable:!Ht&&((_=bt.icon.pickable)===null||_===void 0||_)}),"symbol")}this._startHandler=ii.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:zt.x+de*ke,y:zt.y+Ze/2,size:Ze,symbolType:(v=Ot.symbolType)!==null&&v!==void 0?v:"square"},da.horizontal),Ot),{pickable:!Ht&&((x=Ot.pickable)===null||x===void 0||x)}),"symbol"),this._endHandler=ii.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:zt.x+je*ke,y:zt.y+Ze/2,size:Ze,symbolType:(y=me.symbolType)!==null&&y!==void 0?y:"square"},da.horizontal),me),{pickable:!Ht&&((b=me.pickable)===null||b===void 0||b)}),"symbol");let Da=Math.max(this._startHandler.AABBBounds.width(),Ds),ws=Math.max(this._startHandler.AABBBounds.height(),Ds),jn=Math.max(this._endHandler.AABBBounds.width(),Es),oc=Math.max(this._endHandler.AABBBounds.height(),Es);this._startHandlerMask=ii.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:zt.x+de*ke-Da/2,y:zt.y+Ze/2-ws/2,width:Da,height:ws,fill:"white",fillOpacity:0,zIndex:999},da.horizontal),{pickable:!Ht}),"rect"),this._endHandlerMask=ii.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:zt.x+je*ke-jn/2,y:zt.y+Ze/2-oc/2,width:jn,height:oc,fill:"white",fillOpacity:0,zIndex:999},da.horizontal),{pickable:!Ht}),"rect")}else{if(bt.visible){let Ea=((S=bt.background)===null||S===void 0?void 0:S.size)||10;this._middleHandlerRect=ii.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:Y==="left"?zt.x-Ea:zt.x+ke,y:zt.y+de*Ze,width:Ea,height:(je-de)*Ze},(C=bt.background)===null||C===void 0?void 0:C.style),{pickable:!Ht&&((E=(M=(k=bt.background)===null||k===void 0?void 0:k.style)===null||M===void 0?void 0:M.pickable)===null||E===void 0||E)}),"rect"),this._middleHandlerSymbol=ii.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:Y==="left"?zt.x-Ea/2:zt.x+ke+Ea/2,y:zt.y+(de+je)/2*Ze,angle:Math.PI/180*90,symbolType:(P=(D=bt.icon)===null||D===void 0?void 0:D.symbolType)!==null&&P!==void 0?P:"square",strokeBoundsBuffer:0},bt.icon),{pickable:!Ht&&((L=(B=bt.icon)===null||B===void 0?void 0:B.pickable)===null||L===void 0||L)}),"symbol")}this._startHandler=ii.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:zt.x+ke/2,y:zt.y+de*Ze,size:ke,symbolType:(w=Ot.symbolType)!==null&&w!==void 0?w:"square"},da.vertical),Ot),{pickable:!Ht&&((R=Ot.pickable)===null||R===void 0||R)}),"symbol"),this._endHandler=ii.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:zt.x+ke/2,y:zt.y+je*Ze,size:ke,symbolType:(N=me.symbolType)!==null&&N!==void 0?N:"square"},da.vertical),me),{pickable:!Ht&&((z=me.pickable)===null||z===void 0||z)}),"symbol");let Da=Math.max(this._startHandler.AABBBounds.width(),Ds),ws=Math.max(this._startHandler.AABBBounds.height(),Ds),jn=Math.max(this._endHandler.AABBBounds.width(),Es),oc=Math.max(this._endHandler.AABBBounds.height(),Es);this._startHandlerMask=ii.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:zt.x+ke/2+Da/2,y:zt.y+de*Ze-ws/2,width:oc,height:jn,fill:"white",fillOpacity:0,zIndex:999},da.vertical),{pickable:!Ht}),"rect"),this._endHandlerMask=ii.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:zt.x+ke/2+jn/2,y:zt.y+je*Ze-oc/2,width:oc,height:jn,fill:"white",fillOpacity:0,zIndex:999},da.vertical),{pickable:!Ht}),"rect")}this._showText&&this.renderText()}computeBasePoints(){let{orient:t}=this.attribute,{position:e,width:i,height:s}=this.getLayoutAttrFromConfig(),n,o;return this._isHorizontal?(n=[{x:e.x,y:e.y+s}],o=[{x:e.x+i,y:e.y+s}]):t==="left"?(n=[{x:e.x+i,y:e.y}],o=[{x:e.x+i,y:e.y+s}]):(n=[{x:e.x,y:e.y+s}],o=[{x:e.x,y:e.y}]),{basePointStart:n,basePointEnd:o}}simplifyPoints(t){var e;if(t.length>1e4){let i=(e=this.attribute.tolerance)!==null&&e!==void 0?e:this._previewData.length/1e4;return bF(t,i,!1)}return t}getPreviewLinePoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);let{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}getPreviewAreaPoints(){let t=this._previewData.map(s=>({x:this._previewPointsX&&this._previewPointsX(s),y:this._previewPointsY&&this._previewPointsY(s),x1:this._previewPointsX1&&this._previewPointsX1(s),y1:this._previewPointsY1&&this._previewPointsY1(s)}));if(t.length===0)return t;t=this.simplifyPoints(t);let{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}setPreviewAttributes(t,e){this._previewGroup||(this._previewGroup=e.createOrUpdateChild("previewGroup",{pickable:!1},"group")),t==="line"?this._previewLine=this._previewGroup.createOrUpdateChild("previewLine",{},"line"):this._previewArea=this._previewGroup.createOrUpdateChild("previewArea",{curveType:"basis"},"area");let{backgroundChartStyle:i={}}=this.attribute;t==="line"&&this._previewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._previewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}setSelectedPreviewAttributes(t,e){this._selectedPreviewGroupClip||(this._selectedPreviewGroupClip=e.createOrUpdateChild("selectedPreviewGroupClip",{pickable:!1},"group"),this._selectedPreviewGroup=this._selectedPreviewGroupClip.createOrUpdateChild("selectedPreviewGroup",{},"group")),t==="line"?this._selectedPreviewLine=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewLine",{},"line"):this._selectedPreviewArea=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewArea",{curveType:"basis"},"area");let{selectedBackgroundChartStyle:i={}}=this.attribute,{start:s,end:n}=this.state,{position:o,width:a,height:l}=this.getLayoutAttrFromConfig();this._selectedPreviewGroupClip.setAttributes({x:this._isHorizontal?o.x+s*a:o.x,y:this._isHorizontal?o.y:o.y+s*l,width:this._isHorizontal?(n-s)*a:a,height:this._isHorizontal?l:(n-s)*l,clip:!0,pickable:!1}),this._selectedPreviewGroup.setAttributes({x:-(this._isHorizontal?o.x+s*a:o.x),y:-(this._isHorizontal?o.y:o.y+s*l),width:this._isHorizontal?(n-s)*a:a,height:this._isHorizontal?l:(n-s)*l,pickable:!1}),t==="line"&&this._selectedPreviewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._selectedPreviewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}maybeAddLabel(t,e,i){let s=this.find(n=>n.name===i,!0);return s?s.setAttributes(e):(s=new Wi(e),s.name=i),t.add(s),s}setStartAndEnd(t,e){let{start:i,end:s}=this.attribute;A(t)&&A(e)&&(t!==this.state.start||e!==this.state.end)&&(this.state.start=t,this.state.end=e,i===this.state.start&&s===this.state.end||(this.setStateAttr(t,e,!0),this._dispatchEvent("change",{start:t,end:e,tag:this._activeTag})))}setPreviewData(t){this._previewData=t}setText(t,e){e==="start"?this._startText.setAttribute("text",t):this._endText.setAttribute("text",t)}getStartValue(){return this._startValue}getEndTextValue(){return this._endValue}getMiddleHandlerSize(){var t,e,i,s;let{middleHandlerStyle:n={}}=this.attribute,o=(e=(t=n.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10,a=(s=(i=n.icon)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:10;return Math.max(o,...O(a))}setPreviewPointsX(t){V(t)&&(this._previewPointsX=t)}setPreviewPointsY(t){V(t)&&(this._previewPointsY=t)}setPreviewPointsX1(t){V(t)&&(this._previewPointsX1=t)}setPreviewPointsY1(t){V(t)&&(this._previewPointsY1=t)}setStatePointToData(t){V(t)&&(this._statePointToData=t)}};e_.defaultAttributes=F3;var HS;(function(r){r.start="start",r.startTop="startTop",r.startBottom="startBottom",r.insideStart="insideStart",r.insideStartTop="insideStartTop",r.insideStartBottom="insideStartBottom",r.middle="middle",r.insideMiddleTop="insideMiddleTop",r.insideMiddleBottom="insideMiddleBottom",r.end="end",r.endTop="endTop",r.endBottom="endBottom",r.insideEnd="insideEnd",r.insideEndTop="insideEndTop",r.insideEndBottom="insideEndBottom"})(HS||(HS={}));var NS;(function(r){r.left="left",r.right="right",r.top="top",r.bottom="bottom",r.topLeft="topLeft",r.topRight="topRight",r.bottomLeft="bottomLeft",r.bottomRight="bottomRight",r.middle="middle",r.insideLeft="insideLeft",r.insideRight="insideRight",r.insideTop="insideTop",r.insideBottom="insideBottom",r.insideTopLeft="insideTopLeft",r.insideTopRight="insideTopRight",r.insideBottomLeft="insideBottomLeft",r.insideBottomRight="insideBottomRight"})(NS||(NS={}));var Bi;(function(r){r.arcInnerStart="arcInnerStart",r.arcInnerEnd="arcInnerEnd",r.arcInnerMiddle="arcInnerMiddle",r.arcOuterStart="arcOuterStart",r.arcOuterEnd="arcOuterEnd",r.arcOuterMiddle="arcOuterMiddle",r.center="center"})(Bi||(Bi={}));var VS;(function(r){r.top="top",r.bottom="bottom",r.middle="middle",r.insideTop="insideTop",r.insideBottom="insideBottom",r.insideMiddle="insideMiddle"})(VS||(VS={}));function i_(){_e(),vl()}function N3(){i_(),zf()}function V3(){i_(),Gf()}function j3(){i_(),od()}function z3(){i_(),sa()}function G3(){i_(),zf(),Gf(),Mr(),TD(),is()}var go=class extends xe{constructor(){super(...arguments),this.name="marker",this._onHover=t=>{this._lastHover=vS(t,this._container,this._lastHover)},this._onUnHover=t=>{this._lastHover=yS(t,this._container,this._lastHover)},this._onClick=t=>{this._lastSelect=xS(t,this._container,this._lastSelect)}}transAnimationConfig(){var t,e,i;if(this.attribute.animation!==!1){let s=ct(this.attribute.animation)?this.attribute.animation:{};this._animationConfig={enter:G({},this.defaultUpdateAnimation,s,(t=this.attribute.animationEnter)!==null&&t!==void 0?t:{}),exit:G({},this.defaultExitAnimation,s,(e=this.attribute.animationExit)!==null&&e!==void 0?e:{}),update:G({},this.defaultUpdateAnimation,s,(i=this.attribute.animationUpdate)!==null&&i!==void 0?i:{})}}}setAttribute(t,e,i){super.setAttribute(t,e,i),t==="visible"&&this.render()}_bindEvent(){var t,e,i;if(!this.attribute.interactive)return;let{hover:s,select:n}=this.attribute;s&&((t=this._container)===null||t===void 0||t.addEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.addEventListener("pointerout",this._onUnHover)),n&&((i=this._container)===null||i===void 0||i.addEventListener("pointerdown",this._onClick))}_releaseEvent(){var t,e,i;(t=this._container)===null||t===void 0||t.removeEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.removeEventListener("pointerout",this._onUnHover),(i=this._container)===null||i===void 0||i.removeEventListener("pointerdown",this._onClick)}_initContainer(){var t,e;let{limitRect:i={},clipInRange:s}=this.attribute,n;if(s){let o=Q.group(Object.assign(Object.assign({},i),{clip:!0,pickable:!1}));n=Q.group({x:-((t=i.x)!==null&&t!==void 0?t:0),y:-((e=i.y)!==null&&e!==void 0?e:0),pickable:!1}),o.add(n),this._containerClip=o,this.add(o)}else n=Q.group({x:0,y:0,pickable:!1}),this.add(n);n.name="marker-container",this._container=n}_updateContainer(){var t,e;let{limitRect:i={},clipInRange:s}=this.attribute;this._containerClip&&this._containerClip.setAttributes(Object.assign({},i)),this._container.setAttributes({x:s?-((t=i.x)!==null&&t!==void 0?t:0):0,y:s?-((e=i.y)!==null&&e!==void 0?e:0):0})}render(){var t;this.transAnimationConfig(),this.setAttribute("pickable",!1);let e=(t=this.attribute.visible)===null||t===void 0||t;this.attribute.interactive===!1&&this.setAttribute("childrenPickable",!1),e&&this.isValidPoints()?this._container?(this._updateContainer(),this.updateMarker(),this.markerAnimate("update")):(this._initContainer(),this.initMarker(this._container),this.markerAnimate("enter")):(this.markerAnimate("exit"),this._container=null,this.removeAllChild(!0)),this._releaseEvent(),this._bindEvent()}release(){this.markerAnimate("exit"),super.release(),this._releaseEvent(),this._container=null}};var U3={type:"clipIn",duration:500,easing:"linear",delay:0},jS={type:"fadeIn",duration:500,easing:"linear",delay:0},W3={type:"callIn",duration:500,easing:"linear",delay:0},Sl={type:"fadeOut",duration:500,easing:"linear",delay:0};var Fu=class extends go{constructor(){super(...arguments),this.name="markCommonLine",this.defaultUpdateAnimation=U3,this.defaultExitAnimation=Sl}getLine(){return this._line}getLabel(){return this._label}setLabelPos(){let{label:t={},limitRect:e}=this.attribute,{position:i,confine:s,autoRotate:n}=t,o=this.getPointAttrByPosition(i),a=i.toString().toLocaleLowerCase().includes("start")?this._line.getStartAngle()||0:this._line.getEndAngle()||0;if(this._label.setAttributes(Object.assign(Object.assign({},o.position),{angle:n?this.getRotateByAngle(o.angle):0,textStyle:Object.assign(Object.assign({},this.getTextStyle(i,a,n)),t.textStyle)})),e&&s){let{x:l,y:h,width:d,height:c}=e;xu(this._label,{x1:l,y1:h,x2:l+d,y2:h+c})}}initMarker(t){let{label:e,state:i}=this.attribute,s=this.createSegment();s.name="mark-common-line-line",this._line=s,t.add(s);let n=new Wi(Object.assign(Object.assign({},e),{state:{panel:G({},wt,i?.labelBackground),text:G({},wt,i?.label)}}));n.name="mark-common-line-label",this._label=n,t.add(n),this.setLabelPos()}updateMarker(){let{label:t,state:e}=this.attribute;this.setLineAttributes(),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},t),{state:{panel:G({},wt,e?.labelBackground),text:G({},wt,e?.label)}})),this.setLabelPos())}};var $s=.001,Y3={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:HS.end,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},aE={postiveXAxis:{start:{textAlign:"left",textBaseline:"middle"},startTop:{textAlign:"left",textBaseline:"bottom"},startBottom:{textAlign:"left",textBaseline:"top"},insideStart:{textAlign:"right",textBaseline:"middle"},insideStartTop:{textAlign:"right",textBaseline:"bottom"},insideStartBottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"left",textBaseline:"middle"},endTop:{textAlign:"left",textBaseline:"bottom"},endBottom:{textAlign:"left",textBaseline:"top"},insideEnd:{textAlign:"right",textBaseline:"middle"},insideEndTop:{textAlign:"right",textBaseline:"bottom"},insideEndBottom:{textAlign:"right",textBaseline:"top"}},negativeXAxis:{start:{textAlign:"right",textBaseline:"middle"},startTop:{textAlign:"right",textBaseline:"bottom"},startBottom:{textAlign:"right",textBaseline:"top"},insideStart:{textAlign:"left",textBaseline:"middle"},insideStartTop:{textAlign:"left",textBaseline:"bottom"},insideStartBottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"right",textBaseline:"middle"},endTop:{textAlign:"right",textBaseline:"bottom"},endBottom:{textAlign:"right",textBaseline:"top"},insideEnd:{textAlign:"left",textBaseline:"middle"},insideEndTop:{textAlign:"left",textBaseline:"bottom"},insideEndBottom:{textAlign:"left",textBaseline:"top"}}},X3={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:Bi.arcOuterMiddle,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},K3={interactive:!0,label:{position:NS.right,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},$3={interactive:!0,label:{position:Bi.arcOuterMiddle,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},zS={arcInnerStart:{textAlign:"center",textBaseline:"bottom"},arcInnerEnd:{textAlign:"center",textBaseline:"bottom"},arcInnerMiddle:{textAlign:"center",textBaseline:"bottom"},arcOuterStart:{textAlign:"center",textBaseline:"top"},arcOuterEnd:{textAlign:"center",textBaseline:"top"},arcOuterMiddle:{textAlign:"center",textBaseline:"top"},center:{textAlign:"center",textBaseline:"middle"}},q3={left:{textAlign:"right",textBaseline:"middle"},insideLeft:{textAlign:"left",textBaseline:"middle"},right:{textAlign:"left",textBaseline:"middle"},insideRight:{textAlign:"right",textBaseline:"middle"},top:{textAlign:"center",textBaseline:"bottom"},insideTop:{textAlign:"center",textBaseline:"top"},bottom:{textAlign:"center",textBaseline:"top"},insideBottom:{textAlign:"center",textBaseline:"bottom"},middle:{textAlign:"center",textBaseline:"middle"},topLeft:{textAlign:"right",textBaseline:"top"},insideTopLeft:{textAlign:"left",textBaseline:"top"},topRight:{textAlign:"left",textBaseline:"top"},insideTopRight:{textAlign:"right",textBaseline:"top"},bottomLeft:{textAlign:"right",textBaseline:"bottom"},insideBottomLeft:{textAlign:"left",textBaseline:"bottom"},bottomRight:{textAlign:"left",textBaseline:"bottom"},insideBottomRight:{textAlign:"right",textBaseline:"bottom"}},Z3={interactive:!0,targetSymbol:{visible:!1,offset:0,style:{symbolType:"circle",size:20,fill:!1,stroke:"rgba(46, 47, 50)"}},itemLine:{visible:!0,decorativeLine:{visible:!1,length:30},startSymbol:{visible:!0,clip:!0,symbolType:"circle",size:20,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},endSymbol:{visible:!1,clip:!0,symbolType:"triangle",size:12,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},lineStyle:{stroke:"#000",lineWidth:1}},itemContent:{type:"text",position:"middle",refX:10,symbolStyle:{symbolType:"star",fill:"rgb(48, 115, 242)",fillOpacity:.8,size:20},textStyle:{dx:0,dy:0},imageStyle:{width:80,height:80},richTextStyle:{width:100,height:100}}},lE={postiveXAxis:{top:{textAlign:"left",textBaseline:"bottom"},bottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"left",textBaseline:"middle"},insideTop:{textAlign:"right",textBaseline:"bottom"},insideBottom:{textAlign:"right",textBaseline:"top"},insideMiddle:{textAlign:"right",textBaseline:"middle"}},negativeXAxis:{top:{textAlign:"right",textBaseline:"bottom"},bottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"right",textBaseline:"middle"},insideTop:{textAlign:"left",textBaseline:"bottom"},insideBottom:{textAlign:"left",textBaseline:"top"},insideMiddle:{textAlign:"left",textBaseline:"middle"}}};N3();var pd=class r extends Fu{markerAnimate(t){r._animate&&this._animationConfig&&r._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="markLine"}getPointAttrByPosition(t){var e;let{label:i={}}=this.attribute,{refX:s=0,refY:n=0}=i,o=this._line.getMainSegmentPoints(),a=(e=this._line.getEndAngle())!==null&&e!==void 0?e:0,l=(ad(a),a),h=s*Math.cos(l)+n*Math.cos(l-Math.PI/2),d=s*Math.sin(l)+n*Math.sin(l-Math.PI/2);return t.includes("start")||t.includes("Start")?{position:{x:o[0].x+h,y:o[0].y+d},angle:l}:t.includes("middle")||t.includes("Middle")?{position:{x:(o[0].x+o[o.length-1].x)/2+h,y:(o[0].y+o[o.length-1].y)/2+d},angle:l}:{position:{x:o[o.length-1].x+h,y:o[o.length-1].y+d},angle:l}}getRotateByAngle(t){var e;return(ad(t)?t:t-Math.PI)+((e=this.attribute.label.refAngle)!==null&&e!==void 0?e:0)}getTextStyle(t,e,i){return Ws(Math.abs(e),Math.PI/2,$s)||Ws(Math.abs(e),3*Math.PI/2,$s)?cS(i,e,t):ad(e)?aE.postiveXAxis[t]:aE.negativeXAxis[t]}createSegment(){let{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:n,multiSegment:o,state:a}=this.attribute;return new ys({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:n,multiSegment:o,pickable:!1,state:{line:G({},wt,a?.line),startSymbol:G({},wt,a?.lineStartSymbol),endSymbol:G({},wt,a?.lineEndSymbol)}})}setLineAttributes(){let{points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:n,multiSegment:o,state:a}=this.attribute;this._line&&this._line.setAttributes({points:t,startSymbol:e,endSymbol:i,lineStyle:s,mainSegmentIndex:n,multiSegment:o,state:{line:G({},wt,a?.line),startSymbol:G({},wt,a?.lineStartSymbol),endSymbol:G({},wt,a?.lineEndSymbol)}})}isValidPoints(){let{points:t}=this.attribute;if(!t||t.length<2)return!1;let e=!0;return t.forEach(i=>{if(i.length)i.forEach(s=>{K(s.x)&&K(s.y)||(e=!1)});else if(!K(i.x)||!K(i.y))return void(e=!1)}),e}};pd.defaultAttributes=Y3;j3();var md=class r extends go{markerAnimate(t){r._animate&&this._animationConfig&&r._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}getLabel(){return this._label}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="markArea",this.defaultUpdateAnimation=jS,this.defaultExitAnimation=Sl}getPointAttrByPosition(t){let{x1:e,x2:i,y1:s,y2:n}=this._area.AABBBounds,o={x:(e+i)/2,y:(s+n)/2};return(t.includes("left")||t.includes("Left"))&&(o.x=e),(t.includes("right")||t.includes("Right"))&&(o.x=i),(t.includes("top")||t.includes("Top"))&&(o.y=s),(t.includes("bottom")||t.includes("Bottom"))&&(o.y=n),o}setLabelPos(){var t;if(this._label&&this._area){let{label:e={}}=this.attribute,i=(t=e.position)!==null&&t!==void 0?t:"middle",s=this.getPointAttrByPosition(i);if(this._label.setAttributes(Object.assign(Object.assign({},s),{textStyle:Object.assign(Object.assign({},q3[i]),e.textStyle)})),this.attribute.limitRect&&e.confine){let{x:n,y:o,width:a,height:l}=this.attribute.limitRect;xu(this._label,{x1:n,y1:o,x2:n+a,y2:o+l})}}}initMarker(t){let{points:e,label:i,areaStyle:s,state:n}=this.attribute,o=Q.polygon(Object.assign({points:e},s));o.states=G({},wt,n?.area),o.name="mark-area-polygon",this._area=o,t.add(o);let a=new Wi(Object.assign(Object.assign({},i),{state:{panel:G({},wt,n?.labelBackground),text:G({},wt,n?.label)}}));a.name="mark-area-label",this._label=a,t.add(a),this.setLabelPos()}updateMarker(){let{points:t,label:e,areaStyle:i,state:s}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({points:t},i)),this._area.states=G({},wt,s?.area)),this._label&&this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},e),{state:{panel:G({},wt,s?.labelBackground),text:G({},wt,s?.label)}})),this.setLabelPos()}isValidPoints(){let{points:t}=this.attribute;if(!t||t.length<3)return!1;let e=!0;return t.forEach(i=>{K(i.x)&&K(i.y)||(e=!1)}),e}};md.defaultAttributes=K3;V3();var r_=class r extends Fu{markerAnimate(t){r._animate&&this._animationConfig&&r._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t,{label:{autoRotate:!0}})),this.name="markArcLine"}getPointAttrByPosition(t){let{center:e,radius:i,startAngle:s,endAngle:n,label:o}=this.attribute,{refX:a=0,refY:l=0}=o,h;switch(t){case Bi.arcInnerStart:h=s;case Bi.arcOuterStart:h=s;break;case Bi.arcInnerEnd:h=n;case Bi.arcOuterEnd:h=n;break;case Bi.center:case Bi.arcInnerMiddle:case Bi.arcOuterMiddle:default:h=(s+n)/2}return{position:{x:e.x+(i+l)*Math.cos(h)+a*Math.cos(h-Math.PI/2),y:e.y+(i+l)*Math.sin(h)+a*Math.sin(h-Math.PI/2)},angle:h}}getTextStyle(t){return zS[t]}getRotateByAngle(t){var e;return t-Math.PI/2+((e=this.attribute.label.refAngle)!==null&&e!==void 0?e:0)}createSegment(){let{center:t,radius:e,startAngle:i,endAngle:s,startSymbol:n,endSymbol:o,lineStyle:a,state:l}=this.attribute;return new dd({center:t,radius:e,startAngle:i,endAngle:s,startSymbol:n,endSymbol:o,lineStyle:a,state:{line:G({},wt,l?.line),startSymbol:G({},wt,l?.lineStartSymbol),endSymbol:G({},wt,l?.lineEndSymbol)}})}setLineAttributes(){let{center:t,radius:e,startAngle:i,endAngle:s,startSymbol:n,endSymbol:o,lineStyle:a,state:l}=this.attribute;this._line&&this._line.setAttributes({center:t,radius:e,startAngle:i,endAngle:s,startSymbol:n,endSymbol:o,lineStyle:a,state:{line:G({},wt,l?.line),startSymbol:G({},wt,l?.lineStartSymbol),endSymbol:G({},wt,l?.lineEndSymbol)}})}isValidPoints(){return!0}};r_.defaultAttributes=X3;z3();var s_=class r extends go{markerAnimate(t){r._animate&&this._animationConfig&&r._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}getLabel(){return this._label}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t,{label:{autoRotate:!0}})),this.name="markArcArea",this.defaultUpdateAnimation=jS,this.defaultExitAnimation=Sl}getPointAttrByPosition(t){let{center:e,innerRadius:i,outerRadius:s,startAngle:n,endAngle:o,label:a}=this.attribute,{refX:l=0,refY:h=0}=a,d,c;switch(t){case Bi.center:d=(i+s)/2,c=(n+o)/2;break;case Bi.arcInnerStart:d=i,c=n;break;case Bi.arcOuterStart:d=s,c=n;break;case Bi.arcInnerEnd:d=i,c=o;break;case Bi.arcOuterEnd:d=s,c=o;break;case Bi.arcInnerMiddle:d=i,c=(n+o)/2;break;case Bi.arcOuterMiddle:d=s,c=(n+o)/2;break;default:d=i,c=(n+o)/2}return{position:{x:e.x+(d+h)*Math.cos(c)+l*Math.cos(c-Math.PI/2),y:e.y+(d+h)*Math.sin(c)+l*Math.sin(c-Math.PI/2)},angle:c}}setLabelPos(){var t;if(this._label&&this._area){let{label:e={}}=this.attribute,{position:i="arcInnerMiddle",autoRotate:s}=e,n=this.getPointAttrByPosition(i);if(this._label.setAttributes(Object.assign(Object.assign({},n.position),{angle:s?n.angle-Math.PI/2+((t=e.refAngle)!==null&&t!==void 0?t:0):0,textStyle:Object.assign(Object.assign({},zS[i]),e.textStyle)})),this.attribute.limitRect&&e.confine){let{x:o,y:a,width:l,height:h}=this.attribute.limitRect;xu(this._label,{x1:o,y1:a,x2:o+l,y2:a+h})}}}initMarker(t){let{center:e,innerRadius:i,outerRadius:s,startAngle:n,endAngle:o,areaStyle:a,label:l,state:h}=this.attribute,d=Q.arc(Object.assign({x:e.x,y:e.y,innerRadius:i,outerRadius:s,startAngle:n,endAngle:o},a));d.states=G({},wt,h?.area),d.name="polar-mark-area-area",this._area=d,t.add(d);let c=new Wi(Object.assign(Object.assign({},l),{state:{panel:G({},wt,h?.labelBackground),text:G({},wt,h?.label)}}));c.name="mark-area-label",this._label=c,t.add(c),this.setLabelPos()}updateMarker(){let{center:t,innerRadius:e,outerRadius:i,startAngle:s,endAngle:n,areaStyle:o,label:a,state:l}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({x:t.x,y:t.y,innerRadius:e,outerRadius:i,startAngle:s,endAngle:n},o)),this._area.states=G({},wt,l?.area)),this._label&&(this._label.setAttributes(Object.assign(Object.assign({dx:0,dy:0},a),{state:{panel:G({},wt,l?.labelBackground),text:G({},wt,l?.label)}})),this.setLabelPos())}isValidPoints(){return!0}};s_.defaultAttributes=$3;G3();var gd=class r extends go{markerAnimate(t){r._animate&&this._animationConfig&&r._animate([this._line,this._decorativeLine],this._item,this._animationConfig,t)}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="markPoint",this.defaultUpdateAnimation=W3,this.defaultExitAnimation=Sl,this._isArcLine=!1,this._isStraightLine=!1}setLabelPos(){}getTextAlignAttr(t,e,i,s,n){return Ws(Math.abs(s),Math.PI/2,$s)||Ws(Math.abs(s),3*Math.PI/2,$s)?cS(t,s,n):ad(s)?lE.postiveXAxis[n]:lE.negativeXAxis[n]}setItemAttributes(t,e,i,s,n){var o,a;if(!t)return;let{autoRotate:l=!0,refX:h=0,refY:d=0,refAngle:c=0,textStyle:u={},richTextStyle:p={},imageStyle:m={},position:g=VS.middle}=e,{state:f}=this.attribute,_=((o=this._line)===null||o===void 0?void 0:o.getEndAngle())||0,v=h*Math.cos(_)+d*Math.cos(_-Math.PI/2),x=h*Math.sin(_)+d*Math.sin(_-Math.PI/2);if(n==="text"){let b=s.x-i.x,S=s.y-i.y;t.setAttributes(Object.assign(Object.assign({},u),{textStyle:Object.assign(Object.assign({},this.getTextAlignAttr(l,b,S,_,(a=e.position)!==null&&a!==void 0?a:"end")),u.textStyle),state:{panel:G({},wt,f?.textBackground),text:G({},wt,f?.text)}}))}else n==="richText"?(t.setAttributes({dx:this.getItemDx(t,g,p)+(p.dx||0),dy:this.getItemDy(t,g,p)+(p.dy||0)}),t.states=G({},wt,f?.richText)):n==="image"&&(t.setAttributes({dx:this.getItemDx(t,g,m)+(m.dx||0),dy:this.getItemDy(t,g,m)+(m.dy||0)}),t.states=G({},wt,f?.image));let y=ad(_)?_:_-Math.PI;t.setAttributes({x:s.x+(v||0),y:s.y+(x||0),angle:l&&y+c})}getItemDx(t,e,i){var s,n;let o=(n=(s=t?.AABBBounds)===null||s===void 0?void 0:s.width())!==null&&n!==void 0?n:i?.width||0;return e.includes("inside")?-o:0}getItemDy(t,e,i){var s,n;let o=(n=(s=t?.AABBBounds)===null||s===void 0?void 0:s.height())!==null&&n!==void 0?n:i?.height||0;return e.includes("top")||e.includes("Top")?-o:e.includes("middle")||e.includes("Middle")?-o/2:0}initItem(t,e,i){let{state:s}=this.attribute,{type:n="text",symbolStyle:o,richTextStyle:a,imageStyle:l,renderCustomCallback:h}=t,d;return n==="symbol"?(d=Q.symbol(Object.assign(Object.assign({},i),o)),d.states=G({},wt,s?.symbol)):n==="text"?d=new Wi(Object.assign(Object.assign({},i),{state:{panel:G({},wt,s?.textBackground),text:G({},wt,s?.text)}})):n==="richText"?(d=Q.richtext(Object.assign(Object.assign({},i),a)),d.states=G({},wt,s?.richText)):n==="image"?(d=Q.image(Object.assign(Object.assign({},i),l)),d.states=G({},wt,s?.image)):n==="custom"&&h&&(d=h(),d.states=G({},wt,s?.customMark)),d.name=`mark-point-${n}`,this.setItemAttributes(d,t,e,i,n),d}getItemLineAttr(t,e,i){let s=[],n={x:0,y:0},o=0,a=0,l=0,{type:h="type-s",arcRatio:d=.8}=t,c=i.x-e.x,u=i.y-e.y;if(this._isStraightLine=Ws(c,0,$s)||Ws(u,0,$s),this._isArcLine){let{x:p,y:m}=this.attribute.position,{x:g,y:f}=i,_=(p+g)/2,v=(m+f)/2,x=m===f?0:-(p-g)/(m-f),y=_+d*(f>m?-1:1)*_,b=(k=>x*(k-_)+v)(y);a=ld(m-b,p-y),l=ld(f-b,g-y),n={x:y,y:b};let S=Math.sqrt((y-p)*(y-p)+(b-m)*(b-m)),C=this.attribute.targetSymbol.style.size/2;a+=2*Math.acos(Math.sqrt(1-C*C/(4*S*S))),d>0?l<a&&(l+=2*Math.PI):a<l&&(a+=2*Math.PI),o=Math.sqrt((y-p)*(y-p)+(b-m)*(b-m))}else s=h!=="type-do"||this._isStraightLine?h!=="type-po"||this._isStraightLine?h!=="type-op"||this._isStraightLine?[e,i]:[e,{x:e.x,y:i.y},i]:[e,{x:i.x,y:e.y},i]:[e,{x:(e.x+i.x)/2,y:i.y},i];return s=m2(s),{points:s,center:n,radius:o,startAngle:a,endAngle:l}}reDrawLine(t,e){this._line.release();let{startSymbol:i,endSymbol:s,lineStyle:n,type:o="type-s"}=t,{state:a}=this.attribute,l=this._isArcLine?dd:ys;this._container.removeChild(this._line),this._line=new l(Object.assign(Object.assign({},e),{pickable:!1,startSymbol:i,endSymbol:s,lineStyle:n,visible:t.visible,state:{line:G({},wt,a?.line),startSymbol:G({},wt,a?.lineStartSymbol),endSymbol:G({},wt,a?.lineEndSymbol)}})),this._container.add(this._line)}setItemLineAttr(t,e,i){if(this._line){let{startSymbol:s,endSymbol:n,lineStyle:o,type:a="type-s"}=t,{state:l}=this.attribute,h=this.getItemLineAttr(t,e,i);this._isArcLine&&this._line.key==="arc-segment"||!this._isArcLine&&this._line.key==="segment"?this._line.setAttributes(Object.assign(Object.assign({},h),{startSymbol:s,endSymbol:n,lineStyle:o,visible:t.visible,state:{line:G({},wt,l?.line),startSymbol:G({},wt,l?.lineStartSymbol),endSymbol:G({},wt,l?.lineEndSymbol)}})):this.reDrawLine(t,h)}}getDecorativeLineAttr(t){var e;let i=((e=t?.decorativeLine)===null||e===void 0?void 0:e.length)||10,s=this._line.getEndAngle()||0;return{startPointOffsetX:i/2*Math.cos(s-Math.PI/2),startPointOffsetY:i/2*Math.sin(s-Math.PI/2),endPointOffsetX:-i/2*Math.cos(s-Math.PI/2),endPointOffsetY:-i/2*Math.sin(s-Math.PI/2)}}setDecorativeLineAttr(t,e,i){var s;if(this._decorativeLine){let{lineStyle:n}=t,{startPointOffsetX:o,startPointOffsetY:a,endPointOffsetX:l,endPointOffsetY:h}=this.getDecorativeLineAttr(t);this._decorativeLine.setAttributes(Object.assign(Object.assign({points:[{x:e.x+o,y:e.y+a},{x:e.x+l,y:e.y+h}]},n),{visible:i})),this._decorativeLine.states=G({},wt,(s=this.attribute.state)===null||s===void 0?void 0:s.line)}}setTargetItemAttributes(t,e){var i,s;this._targetItem&&(this._targetItem.setAttributes(Object.assign({x:e.x,y:e.y,visible:(i=t.visible)!==null&&i!==void 0&&i,size:t.size},t.style)),this._targetItem.states=G({},wt,(s=this.attribute.state)===null||s===void 0?void 0:s.targetItem))}setAllOfItemsAttr(t,e){var i;let{position:s,itemLine:n={},itemContent:o={},limitRect:a,targetSymbol:l}=this.attribute,{type:h="text",confine:d}=o;if(a&&d){let{x:c,y:u,width:p,height:m}=a,{dx:g,dy:f}=PD(this._item,{x1:c,y1:u,x2:c+p,y2:u+m});e.x=e.x+g,e.y=e.y+f}this.setTargetItemAttributes(l,s),this.setItemLineAttr(n,t,e),this.setItemAttributes(this._item,o,t,e,h),this.setDecorativeLineAttr(n,e,(i=n.decorativeLine)===null||i===void 0?void 0:i.visible)}computeNewPositionAfterTargetItem(t){var e,i;let{itemContent:s={},targetSymbol:n,itemLine:o}=this.attribute,{offsetX:a=0,offsetY:l=0}=s,{offset:h=0,style:d,visible:c=!1,size:u}=n,p=c?(i=(e=d.size)!==null&&e!==void 0?e:u)!==null&&i!==void 0?i:20:0,m;return m=o.type==="type-do"?ld(l,a/2):o.type==="type-po"?ld(0,a):o.type==="type-op"?ld(l,0):ld(l,a),{newPosition:{x:t.x+(p/2+h)*Math.cos(m),y:t.y+(p/2+h)*Math.sin(m)},newItemPosition:{x:t.x+(p/2+h)*Math.cos(m)+a,y:t.y+(p/2+h)*Math.sin(m)+l}}}initMarker(t){let{position:e,itemContent:i={},itemLine:s}=this.attribute,{type:n="type-s",arcRatio:o=.8}=s,{offsetX:a=0,offsetY:l=0}=i;this._isStraightLine=Ws(a,0,$s)||Ws(l,0,$s),this._isArcLine=n==="type-arc"&&o!==0&&!this._isStraightLine;let{newPosition:h,newItemPosition:d}=this.computeNewPositionAfterTargetItem(e),c=new(this._isArcLine?dd:ys)({points:[],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0});c.name="mark-point-line",this._line=c,t.add(c);let u=Q.line({points:[]});u.name="mark-point-decorativeLine",this._decorativeLine=u,t.add(u);let p=Q.symbol({});p.name="mark-point-targetItem",this._targetItem=p,t.add(this._targetItem);let m=this.initItem(i,h,d);this._item=m,t.add(m),this.setAllOfItemsAttr(h,d)}updateMarker(){let{position:t,itemContent:e={},itemLine:i}=this.attribute,{type:s="text"}=e,{type:n="type-s",arcRatio:o=.8}=i,{offsetX:a=0,offsetY:l=0}=e;this._isStraightLine=Ws(a,0,$s)||Ws(l,0,$s);let h=n==="type-arc"&&o!==0&&!this._isStraightLine,{newPosition:d,newItemPosition:c}=this.computeNewPositionAfterTargetItem(t);h!==this._isArcLine?(this._isArcLine=h,this.reDrawLine(i,{points:[{x:0,y:0}],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0})):this._isArcLine=h,this.setItemAttributes(this._item,e,d,c,s),this.setAllOfItemsAttr(d,c)}isValidPoints(){let{position:t}=this.attribute;return!(!K(t.x)||!K(t.y))}};gd.defaultAttributes=Z3;function GS(){_e(),Mr(),Wr()}var J3={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};GS();var Ou=class r extends xe{getCurrent(){return this._current}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{let s=i.target;s.hasState("disable")||s.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{let s=i.target;if(s.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?s.addState("disable"):s.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(s.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?s.addState("disable"):s.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();let{layout:s="horizontal",handler:n=J3,total:o,defaultCurrent:a=1,textStyle:l,padding:h=0}=this.attribute;this._current=a;let d=Ni(h),c=s==="horizontal",u=Q.group({x:0,y:0}),p=n.style||{},m=p.size||15,g=(t=n.space)!==null&&t!==void 0?t:8,f=n.state||{},{preShape:_,nextShape:v}=n;_||(_=c?"triangleLeft":"triangleUp"),v||(v=c?"triangleRight":"triangleDown");let x=Q.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},p),{x:0,y:0,symbolType:_,size:m}));x.states=f,x.name="preHandler",this.preHandler=x,u.add(x);let{width:y,height:b}=_l(this._getPageText(o),Object.assign({textAlign:"center",textBaseline:"middle"},l),(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),S=J(m)?m:m[0],C=J(m)?m:m[1],k=Q.text(Object.assign({x:c?S/2+g+y/2:0,y:c?0:C/2+g+b/2,text:this._getPageText(a),textAlign:"center",textBaseline:"middle",lineHeight:l?.fontSize},l));this.text=k,u.add(k);let M=Q.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},p),{x:c?S+2*g+y:0,y:c?0:C+2*g+b,symbolType:v,size:m}));M.name="nextHandler",M.states=f,this.nextHandler=M,u.add(M),this._total===1?(x.addState("disable"),M.addState("disable")):this._current===1?x.addState("disable"):this._current===o&&M.addState("disable");let E=u.AABBBounds,D=E.width(),P=E.height();u.translateTo(0-E.x1+d[3],0-E.y1+d[0]),this.add(u),this.attribute.width=D+d[1]+d[3],this.attribute.height=P+d[0]+d[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){let{pageFormatter:e}=this.attribute;return e?V(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}};Ou.defaultAttributes={handler:J3,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};var Mt;(function(r){r.selected="selected",r.unSelected="unSelected",r.selectedHover="selectedHover",r.unSelectedHover="unSelectedHover",r.focus="focus"})(Mt||(Mt={}));var ns;(function(r){r.legendItemHover="legendItemHover",r.legendItemUnHover="legendItemUnHover",r.legendItemClick="legendItemClick",r.legendItemAttributeUpdate="legendItemAttributeUpdate"})(ns||(ns={}));var Yi;(function(r){r.innerView="innerView",r.title="legendTitle",r.item="legendItem",r.itemShape="legendItemShape",r.itemLabel="legendItemLabel",r.itemValue="legendItemValue",r.focus="legendItemFocus"})(Yi||(Yi={}));var Al=class extends xe{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);let{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=Ni(i);let s=Q.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});s.name=Yi.innerView,this.add(s),this._innerView=s,e?.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();let n=this._innerView.AABBBounds;this.attribute.width=n.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=n.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){let{text:e="",textStyle:i,padding:s=0,background:n,minWidth:o,maxWidth:a,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:Ni(s),minWidth:o,maxWidth:a};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),A(l.space)&&(h.space=l.space)),n&&n.visible&&(h.panel=Object.assign({visible:!0},n.style));let d=new Wi(h);d.name=Yi.title,this._title=d,this._innerView.add(d)}_adjustLayout(){var t;if(this._title){let e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),s=(t=this.attribute.title)===null||t===void 0?void 0:t.align;s==="center"?this._title.setAttribute("x",(e-i)/2):s==="end"&&this._title.setAttribute("x",e-i)}}};function fd(){_e(),Wr(),rs(),Mr()}function hE(){_e(),vl()}function Q3(){hE(),GS(),dS()}function tH(){hE(),fd()}function eH(){hE(),fd(),na()}var iH=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},F9={[Mt.focus]:{},[Mt.selected]:{},[Mt.selectedHover]:{},[Mt.unSelected]:{},[Mt.unSelectedHover]:{}};Q3();var n_=class r extends Al{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{let s=i.target;if(s&&s.name&&s.name.startsWith(Yi.item)){let n=s.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===n.id)return;this._unHover(this._lastActiveItem,i)}this._hover(n,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var s,n,o,a;let l=i.target;if(l&&l.name&&l.name.startsWith(Yi.item)){let h=l.delegate,{selectMode:d="multiple"}=this.attribute;if(l.name===Yi.focus||d==="focus"){let c=h.hasState(Mt.focus);h.toggleState(Mt.focus),c?(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach(u=>{this._removeLegendItemState(u,[Mt.unSelected,Mt.unSelectedHover,Mt.focus],i),this._setLegendItemState(u,Mt.selected,i)}):(this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i),(n=this._itemsContainer)===null||n===void 0||n.getChildren().forEach(u=>{h!==u&&(this._removeLegendItemState(u,[Mt.selected,Mt.selectedHover,Mt.focus],i),this._setLegendItemState(u,Mt.unSelected,i))}))}else{(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(m=>{m.removeState(Mt.focus)});let{allowAllCanceled:c=!0}=this.attribute,u=h.hasState(Mt.selected),p=this._getSelectedLegends();if(d==="multiple"){if(c===!1&&u&&p.length===1)return void this._dispatchLegendEvent(ns.legendItemClick,h,i);u?(this._removeLegendItemState(h,[Mt.selected,Mt.selectedHover],i),this._setLegendItemState(h,Mt.unSelected,i)):(this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i))}else this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i),(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach(m=>{h!==m&&(this._removeLegendItemState(m,[Mt.selected,Mt.selectedHover],i),this._setLegendItemState(m,Mt.unSelected,i))})}this._dispatchLegendEvent(ns.legendItemClick,h,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach(i=>{let s=i.data;t.includes(s.label)?(this._setLegendItemState(i,Mt.selected),this._removeLegendItemState(i,[Mt.unSelected,Mt.unSelectedHover])):(this._removeLegendItemState(i,[Mt.selected,Mt.selectedHover]),this._setLegendItemState(i,Mt.unSelected))})}_renderItems(){let{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:s,defaultSelected:n,lazyload:o,autoPage:a}=this.attribute,{spaceCol:l=16,spaceRow:h=8,verticalAlign:d="middle"}=t,c=this._itemsContainer,{items:u,isHorizontal:p,startIndex:m,isScrollbar:g}=this._itemContext,f=g?1:p?i:e,_=this._contentMaxHeight,v,{doWrap:x,maxWidthInCol:y,startX:b,startY:S,pages:C}=this._itemContext,k=0,M=0,E=[];for(let D=m,P=u.length;D<P&&!(o&&C>this._itemContext.currentPage*f);D++){o&&(this._itemContext.startIndex=D+1),v=u[D],v.id||(v.id=v.label),v.index=D;let B=!0;H(n)&&(B=n.includes(v.label));let L=this._renderEachItem(v,B,D,u),w=L.attribute.width,R=L.attribute.height;this._itemHeight=Math.max(this._itemHeight,R),y=Math.max(w,y),this._itemMaxWidth=Math.max(w,this._itemMaxWidth),p?(A(s)&&(g&&a?(C=Math.ceil((b+w)/s),x=C>1):b+w>s&&(x=!0,b>0&&(d!=="middle"&&d!=="bottom"||E.forEach(N=>{N.setAttributes({y:N.attribute.y+(M-N.attribute.height)/(d==="middle"?2:1)})}),C+=1,b=0,S+=M+h,M=0,E.length=0))),b===0&&S===0||L.setAttributes({x:b,y:S}),b+=l+w,M=Math.max(M,R),E.push(L)):(A(_)&&(g&&a?(C=Math.ceil((S+R)/_),x=C>1):_<=R?(C+=1,x=!0,S=0,D>0&&(b+=k+l)):_<S+R&&(C+=1,x=!0,S=0,b+=y+l,y=0)),b===0&&S===0||L.setAttributes({x:b,y:S}),S+=h+R),c.add(L),k=w}return!p||d!=="middle"&&d!=="bottom"||E.forEach(D=>{D.setAttributes({y:D.attribute.y+(M-D.attribute.height)/(d==="middle"?2:1)})}),this._itemContext.doWrap=x,this._itemContext.startX=b,this._itemContext.startY=S,this._itemContext.maxWidthInCol=y,this._itemContext.pages=C,this._itemContext.maxPages=f,g&&(this._itemContext.totalPage=C),o||(this._itemContext.startIndex=u.length),this._itemContext}_renderContent(){let{item:t={},items:e,reversed:i,maxWidth:s,maxHeight:n}=this.attribute;if(t.visible===!1||st(e))return;let o=e;i&&(o=e?.reverse()),this._contentMaxHeight=Math.max(0,n-this._parsedPadding[0]-this._parsedPadding[2]);let a=Q.group({x:0,y:0});this._itemsContainer=a;let{layout:l,autoPage:h}=this.attribute,d=l==="horizontal",{maxWidth:c,width:u,height:p}=t,m=[];A(c)&&m.push(c),A(u)&&m.push(u),m.length&&(A(s)&&m.push(s),this._itemWidthByUser=Ae(m)),A(p)&&(this._itemHeightByUser=p);let g=this.attribute.pager;this._itemContext={currentPage:g&&g.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:o,isHorizontal:d,totalPage:1/0,isScrollbar:g&&g.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let f=!1;this._itemContext.doWrap&&h&&this._itemContext.pages>this._itemContext.maxPages&&(f=this._renderPagerComponent()),f||(a.setAttribute("y",this._title?this._title.AABBBounds.height()+ft(this.attribute,"title.space",8):0),this._innerView.add(a))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;let{hover:t=!0,select:e=!0}=this.attribute;if(t){let i="pointermove",s="pointerleave";ct(t)&&(t.trigger&&(i=t.trigger),t.triggerOff&&(s=t.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(s,this._onUnHover)}if(e){let i="pointerdown";ct(e)&&e.trigger&&(i=e.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(t,e,i,s){var n,o;let{label:a,value:l}=this.attribute.item,h=s.AABBBounds,d=i.AABBBounds,c=h.width(),u=d.width(),p=!1;t==="labelFirst"?u>e?p=!0:s.setAttribute("maxLineWidth",e-u):t==="valueFirst"?c>e?p=!0:i.setAttribute("maxLineWidth",e-c):c+u>e&&(p=!0),p&&(s.setAttribute("maxLineWidth",Math.max(e*((n=a.widthRatio)!==null&&n!==void 0?n:.5),e-u)),i.setAttribute("maxLineWidth",Math.max(e*((o=l.widthRatio)!==null&&o!==void 0?o:.5),e-c)))}_renderEachItem(t,e,i,s){var n,o;let{id:a,label:l,value:h,shape:d}=t,{padding:c=0,focus:u,focusIconStyle:p,align:m,autoEllipsisStrategy:g}=this.attribute.item,{shape:f,label:_,value:v,background:x}=this.attribute.item,y=this._handleStyle(f,t,e,i,s),b=this._handleStyle(_,t,e,i,s),S=this._handleStyle(v,t,e,i,s),C=this._handleStyle(x,t,e,i,s),k=Ni(c),M;x.visible===!1?(M=Q.group({x:0,y:0,cursor:(n=C.style)===null||n===void 0?void 0:n.cursor}),this._appendDataToShape(M,Yi.item,t,M)):(M=Q.group(Object.assign({x:0,y:0},C.style)),this._appendDataToShape(M,Yi.item,t,M,C.state)),M.id=`${a??l}-${i}`,M.addState(e?Mt.selected:Mt.unSelected);let E=Q.group({x:0,y:0,pickable:!1});M.add(E);let D,P=0,B=0,L=0;if(f&&f.visible!==!1){let Ot=ft(y,"style.size",10);B=H(Ot)?Ot[0]||0:Ot,L=ft(f,"space",8);let me=Q.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},d),y.style));Object.keys(y.state||{}).forEach(Lt=>{let Ht=y.state[Lt].fill||y.state[Lt].stroke;d.fill&&T(y.state[Lt].fill)&&Ht&&(y.state[Lt].fill=Ht),d.stroke&&T(y.state[Lt].stroke)&&Ht&&(y.state[Lt].stroke=Ht)}),this._appendDataToShape(me,Yi.itemShape,t,M,y.state),me.addState(e?Mt.selected:Mt.unSelected),E.add(me)}let w=0;if(u){let Ot=ft(p,"size",10);D=Q.symbol(Object.assign(Object.assign({x:0,y:-Ot/2-1,strokeBoundsBuffer:0,boundsPadding:k},p),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(D,Yi.focus,t,M),w=Ot}let R=_.formatMethod?_.formatMethod(l,t,i):l,N=Object.assign(Object.assign({x:B/2+L,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(o=b.style)===null||o===void 0?void 0:o.fontSize},b.style),{text:R,_originText:_.formatMethod?l:void 0}),z=oa(N);this._appendDataToShape(z,Yi.itemLabel,t,M,b.state),z.addState(e?Mt.selected:Mt.unSelected),E.add(z);let Y=ft(_,"space",8);if(A(h)){let Ot=ft(v,"space",u?8:0),me=v.formatMethod?v.formatMethod(h,t,i):h,Lt=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:S.style.fontSize},S.style),{text:me,_originText:v.formatMethod?h:void 0}),Ht=oa(Lt);if(this._appendDataToShape(Ht,Yi.itemValue,t,M,S.state),Ht.addState(e?Mt.selected:Mt.unSelected),this._itemWidthByUser){let de=this._itemWidthByUser-k[1]-k[3]-B-L-Y-w-Ot;this._autoEllipsis(g,de,z,Ht),v.alignRight?Ht.setAttributes({textAlign:"right",x:this._itemWidthByUser-B/2-k[1]-k[3]-w-Ot}):Ht.setAttribute("x",Y+(z.AABBBounds.empty()?0:z.AABBBounds.x2))}else Ht.setAttribute("x",Y+(z.AABBBounds.empty()?0:z.AABBBounds.x2));P=Ot+(Ht.AABBBounds.empty()?0:Ht.AABBBounds.x2),E.add(Ht)}else this._itemWidthByUser&&z.setAttribute("maxLineWidth",this._itemWidthByUser-k[1]-k[3]-B-L-w),P=Y+(z.AABBBounds.empty()?0:z.AABBBounds.x2);D&&(D.setAttribute("x",P),E.add(D));let U=E.AABBBounds,$=U.width();if(m==="right"){let Ot=U.x2,me=U.x1;E.forEachChildren((Lt,Ht)=>{Lt.type!=="symbol"&&Lt.attribute.textAlign!=="right"||Lt===D?Lt.setAttribute("x",me+Ot-Lt.attribute.x-Lt.AABBBounds.width()):Lt.type!=="symbol"?Lt.setAttributes({x:me+Ot-Lt.attribute.x,textAlign:"left"}):Lt.setAttribute("x",me+Ot-Lt.attribute.x)})}let ut=U.height(),mt=A(this.attribute.item.width)?this.attribute.item.width:$+k[1]+k[3],bt=this._itemHeightByUser||ut+k[0]+k[2];return M.attribute.width=mt,M.attribute.height=bt,D&&D.setAttribute("visible",!1),E.translateTo(-U.x1+k[3],-U.y1+k[0]),M}_createPager(t){var e,i;let{disableTriggerEvent:s,maxRow:n}=this.attribute,o=a=>a<=99?99:a<=999?999:9999;return this._itemContext.isHorizontal?new Ou(Object.assign(Object.assign({layout:n===1?"horizontal":"vertical",total:o(this._itemContext.pages)},G({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:(e=this.attribute.pager)===null||e===void 0?void 0:e.defaultCurrent,disableTriggerEvent:s})):new Ou(Object.assign({layout:"horizontal",total:o(this._itemContext.pages),disableTriggerEvent:s,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){let{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new fl(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:t.visible===!1?0:12},t),{width:e})):new fl(Object.assign(Object.assign({direction:"vertical",width:t.visible===!1?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){let{pager:s}=this.attribute,{totalPage:n,isHorizontal:o}=this._itemContext,a=s&&s.position||"middle";if(this._pagerComponent.setTotal(n),o){let l;l=a==="start"?t:a==="end"?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:l})}else{let l;l=a==="start"?0:a==="end"?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:l,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){let{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,s=e.AABBBounds,n,o;return t?(o=s.width(),n=o/i.width()):(o=s.height(),n=o/i.height()),n}_updatePositionOfScrollbar(t,e,i){let{isHorizontal:s,currentPage:n,totalPage:o}=this._itemContext,a=(n-1)/o;this._pagerComponent.setScrollRange([a,a+this._computeScrollbarDelta()]),s?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){let i=this.attribute.pager||{},{animation:s=!0,animationDuration:n=450,animationEasing:o="quadIn"}=i,a=this._itemContext.isScrollbar?d=>{let{value:c}=d.detail,u;return u=c[0]===0?1:c[1]===1?this._itemContext.totalPage:c[0]*this._itemContext.totalPage+1,u}:d=>d.detail.current,l=d=>{let c=this._pagerComponent,u=c.getScrollRange(),{direction:p}=c.attribute,{width:m,height:g}=c.getSliderRenderBounds(),f=p==="vertical"?d.deltaY/g:d.deltaX/m;c.setScrollRange([u[0]+f,u[1]+f],!0),this.updateScrollMask()},h=d=>{let c=a(d);if(c!==this._itemContext.currentPage){if(this._itemContext.currentPage=c,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();let u=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=u,this._itemContext.isScrollbar&&this._pagerComponent){let p=this._computeScrollbarDelta(),[m]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([m,m+p])}}if(this._itemContext.isScrollbar){let[u]=this._pagerComponent.getScrollRange(),p;p=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();let m=p*u;this.updateScrollMask(),s?this._itemsContainer.animate().to({[e]:-m},n,o):this._itemsContainer.setAttribute(e,-m)}else s?this._itemsContainer.animate().to({[e]:-(c-1)*t},n,o):this._itemsContainer.setAttribute(e,-(c-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",h),this._pagerComponent.addEventListener("scrollUp",h),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",c=>c.nativeEvent.preventDefault()),this.addEventListener("wheel",Hi(l,50)))):(this._pagerComponent.addEventListener("toPrev",h),this._pagerComponent.addEventListener("toNext",h))}_renderPager(){let t=this._title?this._title.AABBBounds.height()+ft(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:s=2,item:n={},pager:o={}}=this.attribute,{spaceCol:a=16,spaceRow:l=8}=n,h=this._itemsContainer,{space:d=12,defaultCurrent:c=1}=o,u=iH(o,["space","defaultCurrent"]),{isHorizontal:p}=this._itemContext,m=this._contentMaxHeight,g,f=0,_=0,v=0,x=0,y=0,b=0,S=1;if(p){if(_=(s-1)*l+this._itemHeight*s,f=e,g=this._createPager(u),this._pagerComponent=g,this._innerView.add(g),v=e-g.AABBBounds.width()-d,v<=0)return this._innerView.removeChild(g),!1;h.getChildren().forEach((M,E)=>{let{width:D,height:P}=M.attribute;v<y+D&&(y=0,b+=P+l,S+=1),E>0&&M.setAttributes({x:y,y:b}),y+=a+D}),this._itemContext.startX=y,this._itemContext.startY=b,this._itemContext.pages=S;let k=Math.ceil(S/s);this._itemContext.totalPage=k,this._updatePositionOfPager(t,f,_)}else{if(f=this._itemMaxWidth*i+(i-1)*a,_=m,v=f,g=this._createPager(u),this._pagerComponent=g,this._innerView.add(g),x=m-g.AABBBounds.height()-d-t,x<=0)return this._innerView.removeChild(g),!1;h.getChildren().forEach((M,E)=>{let{height:D}=M.attribute;x<b+D&&(b=0,y+=this._itemMaxWidth+a,S+=1),E>0&&M.setAttributes({x:y,y:b}),b+=l+D});let k=Math.ceil(S/i);this._itemContext.totalPage=k,this._updatePositionOfPager(t,f,_)}c>1&&(p?h.setAttribute("y",-(c-1)*(_+l)):h.setAttribute("x",-(c-1)*(f+a)));let C=Q.group({x:0,y:t,width:p?v:f,height:p?_:x,clip:!0,pickable:!1});return C.add(h),this._innerView.add(C),this._itemContext.clipContainer=C,this._bindEventsOfPager(p?_+l:f+a,p?"y":"x"),!0}_renderScrollbar(){var t;let e=this._title?this._title.AABBBounds.height()+ft(this.attribute,"title.space",8):0,{maxWidth:i,item:s={},pager:n={}}=this.attribute,{spaceCol:o=16,spaceRow:a=8}=s,l=this._itemsContainer,{space:h=12,defaultCurrent:d=1}=n,c=iH(n,["space","defaultCurrent"]),{isHorizontal:u}=this._itemContext,p=this._contentMaxHeight,m,g=0,f=0,_=0,v=1;if(u)g=i,f=this._itemHeight,m=this._createScrollbar(c,g),this._pagerComponent=m,this._innerView.add(m);else{if(f=p-e,g=this._itemMaxWidth,m=this._createScrollbar(c,f),this._pagerComponent=m,this._innerView.add(m),f<=0)return this._innerView.removeChild(m),!1;let y=l.getChildren(),b=y.map(S=>S.attribute.height);if(b.length===1||b.every(S=>S===b[0])){let S=b[0],C=f,k=Math.floor(C/(a+S));f=k*(a+S),v=Math.ceil(y.length/k)}else y.forEach((S,C)=>{let{height:k}=S.attribute,M=v,E=_;v=Math.floor((_+k)/f)+1,_+=a+k,M!==v&&C===l.getChildren().length-1&&_-f>=1/3*k&&(f=E+k,v-=1)});this._itemContext.totalPage=v,this._itemContext.pages=v}if(d>1)if(u){let y=this._itemsContainer.AABBBounds.width()-g;l.setAttribute("x",-Math.min((d-1)*(g+o),y))}else{let y=this._itemsContainer.AABBBounds.height()-f;l.setAttribute("y",-Math.min((d-1)*(f+a),y))}let x=Q.group({x:0,y:e,width:g,height:f,clip:!0,pickable:!1});return x.add(l),this._innerView.add(x),this._itemContext.clipContainer=x,this._updatePositionOfScrollbar(g,f,e),!((t=n.scrollMask)===null||t===void 0)&&t.visible&&this.renderScrollMask(x),this._bindEventsOfPager(u?g:f,u?"x":"y"),!0}renderScrollMask(t){let{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:s=16,gradientStops:n}=e;if(!i||!n)return;let o=t.AABBBounds.width(),a=t.AABBBounds.height(),l=this._itemContext.isHorizontal?o:a,h=n.map(u=>({offset:s*u.offset/l,color:u.color})),d=n.map(u=>({offset:(l-s*u.offset)/l,color:u.color})),c=Q.rect({x:0,y:0,width:o,height:a});this._scrollMask=c,this._scrollMaskContext={startStops:h,endStops:d},this.updateScrollMask(),t.add(c)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;let[t,e]=this._pagerComponent.getScrollRange(),i=[];Re(ee(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),Re(ee(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(Mt.selected)?this._setLegendItemState(t,Mt.selectedHover,e):this._setLegendItemState(t,Mt.unSelectedHover,e);let i=t.getChildren()[0].find(s=>s.name===Yi.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(ns.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(Mt.unSelectedHover)||t.hasState(Mt.selectedHover))&&(i=!0),t.removeState(Mt.unSelectedHover),t.removeState(Mt.selectedHover),t.getChildren()[0].getChildren().forEach(n=>{i||!n.hasState(Mt.unSelectedHover)&&!n.hasState(Mt.selectedHover)||(i=!0),n.removeState(Mt.unSelectedHover),n.removeState(Mt.selectedHover)});let s=t.getChildren()[0].find(n=>n.name===Yi.focus,!1);s&&s.setAttribute("visible",!1),i&&this._dispatchLegendEvent(ns.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(ns.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let s=!1;t.hasState(e)||(s=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach(n=>{n.name!==Yi.focus&&(s||n.hasState(e)||(s=!0),n.addState(e,!0))}),s&&this._dispatchLegendEvent(ns.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let s=!1;e.forEach(n=>{!s&&t.hasState(n)&&(s=!0),t.removeState(n)}),t.getChildren()[0].getChildren().forEach(n=>{n.name!==Yi.focus&&e.forEach(o=>{!s&&n.hasState(o)&&(s=!0),n.removeState(o)})}),s&&this._dispatchLegendEvent(ns.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;let e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach(i=>{i.hasState(Mt.selected)&&e.push(i.data)}),e}_appendDataToShape(t,e,i,s,n={}){t.name=e,t.data=i,t.delegate=s,t.states=G({},F9,n)}_dispatchLegendEvent(t,e,i){let s=this._getSelectedLegends();s.sort((o,a)=>o.index-a.index);let n=s.map(o=>o.label);this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(Mt.selected),currentSelectedItems:s,currentSelected:n,event:i})}_handleStyle(t,e,i,s,n){let o={};return t.style&&(V(t.style)?o.style=t.style(e,i,s,n):o.style=t.style),t.state&&(o.state={},Object.keys(t.state).forEach(a=>{t.state[a]&&(V(t.state[a])?o.state[a]=t.state[a](e,i,s,n):o.state[a]=t.state[a])})),o}release(){super.release(),this.removeAllEventListeners()}};n_.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:16,spaceRow:8,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var rr;(function(r){r.innerView="innerView",r.railContainer="sliderRailContainer",r.rail="sliderRail",r.startText="sliderStartText",r.endText="sliderEndText",r.startHandler="sliderStartHandler",r.startHandlerText="startHandlerText",r.endHandler="sliderEndHandler",r.endHandlerText="sliderEndHandlerText",r.track="sliderTrack",r.trackContainer="sliderTrackContainer"})(rr||(rr={}));function cE(r){return H(r)?r:[r,r]}function XS(r){return r?"ew-resize":"ns-resize"}fd();var ca=class r extends xe{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;let s=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),n=ee(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/s:(i.viewY-this._rail.globalAABBBounds.y1)/s,0,1);n!==this._tooltipState.pos&&(this._tooltipState.pos=n,this._tooltipState.value=this.calculateValueByPos(n*s),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{let{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{i.stopPropagation(),this._isChanging=!0;let{x:s,y:n}=this.stage.eventPointTransform(i);this._currentHandler=i.target,this._prePos=this._isHorizontal?s:n,kt.env==="browser"?(kt.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),kt.addEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onHandlerPointerUp),this.stage.addEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onHandlerPointerMove=i=>{var s,n;i.stopPropagation(),this._isChanging=!0;let{railWidth:o,railHeight:a,min:l,max:h}=this.attribute;if(h===l)return;let{x:d,y:c}=this.stage.eventPointTransform(i),u,p,m,g=0;this._isHorizontal?(u=d,g=u-this._prePos,p=(n=this._currentHandler)===null||n===void 0?void 0:n.attribute.x,m=o):(u=c,g=u-this._prePos,p=(s=this._currentHandler)===null||s===void 0?void 0:s.attribute.y,m=a);let f=ee(p+g,0,m),_=this.calculateValueByPos(f);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,f,_):this._updateHandler(this._currentHandler,f,_),this._updateTrack(),this._prePos=u,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{i.preventDefault(),this._isChanging=!1,this._currentHandler=null,kt.env==="browser"?(kt.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),kt.removeEventListener("pointerup",this._onHandlerPointerUp)):(this.stage.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onHandlerPointerUp),this.stage.removeEventListener("pointerupoutside",this._onHandlerPointerUp))},this._onTrackPointerdown=i=>{i.stopPropagation(),this._isChanging=!0;let{x:s,y:n}=this.stage.eventPointTransform(i);this._prePos=this._isHorizontal?s:n,kt.env==="browser"?(kt.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),kt.addEventListener("pointerup",this._onTrackPointerUp)):(this.stage.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.addEventListener("pointerup",this._onTrackPointerUp),this.stage.addEventListener("pointerupoutside",this._onTrackPointerUp))},this._onTrackPointerMove=i=>{i.stopPropagation(),this._isChanging=!0;let{railWidth:s,railHeight:n,min:o,max:a,inverse:l}=this.attribute;if(a===o)return;let{startHandler:h,endHandler:d}=this._getHandlers(),c,u,p,{x:m,y:g}=this.stage.eventPointTransform(i);this._isHorizontal?(c=m,u=this._track.attribute.width,p=s):(c=g,u=this._track.attribute.height,p=n);let f=c-this._prePos;if(h){let _=this._isHorizontal?h.attribute.x:h.attribute.y,v=l?ee(_+f,u,p):ee(_+f,0,p-u),x=this.calculateValueByPos(v);this._updateHandler(h,v,x)}if(d){let _=this._isHorizontal?d.attribute.x:d.attribute.y,v=l?ee(_+f,0,p-u):ee(_+f,u,p),x=this.calculateValueByPos(v),y=h?.attribute;this._updateHandler(d,v,x),this._track.setAttributes(this._isHorizontal?{x:Math.min(y.x,d.attribute.x),width:Math.abs(y.x-d.attribute.x)}:{y:Math.min(y.y,d.attribute.y),height:Math.abs(y.y-d.attribute.y)})}this._prePos=c,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{i.preventDefault(),this._isChanging=!1,kt.env==="browser"?(kt.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),kt.removeEventListener("pointerup",this._onTrackPointerUp)):(this.stage.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),this.stage.removeEventListener("pointerup",this._onTrackPointerUp),this.stage.removeEventListener("pointerupoutside",this._onTrackPointerUp))},this._onRailPointerDown=i=>{i.stopPropagation(),this._isChanging=!0;let{railWidth:s,railHeight:n,min:o,max:a}=this.attribute;if(a===o)return;let l=this._startHandler,h=this._endHandler,d,c,u,p;this._isHorizontal?(d=i.viewX-this._rail.globalAABBBounds.x1,c=l?.attribute.x,u=h?.attribute.x,p=s):(d=i.viewY-this._rail.globalAABBBounds.y1,c=l?.attribute.y,u=h?.attribute.y,p=n);let m=this.calculateValueByPos(d);if(A(u)){let g=Math.abs(d-c)>Math.abs(d-u)?h:l;this._updateHandler(g,d,m)}else this._updateHandler(l,d,m);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){let{layout:i,railWidth:s,railHeight:n,min:o,max:a,inverse:l}=this.attribute,h=0;return h=o===a?e==="start"?0:e==="end"?1:0:(t-o)/(a-o),(l?1-h:h)*(i==="vertical"?n:s)}calculateValueByPos(t){let{layout:e,railWidth:i,railHeight:s,min:n,max:o,inverse:a}=this.attribute,l=e==="vertical"?s:i;return n+(o-n)*(a?1-t/l:t/l)}setValue(t){let{min:e,max:i}=this.attribute;if(i===e)return;let[s,n]=O(t),{startHandler:o,endHandler:a}=this._getHandlers();o&&this._updateHandler(o,this.calculatePosByValue(s),s),a&&this._updateHandler(a,this.calculatePosByValue(n),n),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);let{layout:i="horizontal",railWidth:s,railHeight:n,startText:o,endText:a,min:l,max:h,showHandler:d=!0,showTooltip:c}=this.attribute,{value:u}=this.attribute;T(u)&&(u=[l,h]),this._currentValue={startValue:cE(u)[0],endValue:cE(u)[1]};let p=i==="horizontal";this._isHorizontal=p;let m=Q.group({x:0,y:0});m.name=rr.innerView,this.add(m),this._innerView=m;let g,f=0;if(o&&o.visible){g=Q.text(Object.assign({x:p?0:s/2,y:p?n/2:0,textAlign:p?"start":"center",textBaseline:p?"middle":"top",text:o.text,lineHeight:(t=o.style)===null||t===void 0?void 0:t.fontSize},o.style)),g.name=rr.startText,m.add(g);let y=A(o.space)?o.space:0;f+=(p?g.AABBBounds.width():g.AABBBounds.height())+y}let _=Q.group({x:p?f:0,y:p?0:f});m.add(_);let v=Q.group({x:0,y:0}),x;if(v.name=rr.railContainer,this._railContainer=v,_.add(v),this._mainContainer=_,this._renderRail(v),f+=p?s:n,a&&a.visible){let y=A(a.space)?a.space:0;x=Q.text(Object.assign({x:p?f+y:s/2,y:p?n/2:f+y,textAlign:p?"start":"center",textBaseline:p?"middle":"top",text:a.text,lineHeight:(e=a.style)===null||e===void 0?void 0:e.fontSize},a.style)),x.name=rr.endText,m.add(x)}this._renderTrack(v),d&&(this._renderHandlers(_),this._bindEvents()),c&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){let{railWidth:e,railHeight:i,railStyle:s,slidable:n}=this.attribute,o="default";n!==!1&&(o="pointer");let a=Q.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:o},s));return a.name=rr.rail,t.add(a),this._rail=a,a}_renderHandlers(t){let{range:e,min:i,max:s,handlerSize:n=14,handlerStyle:o,handlerText:a,railHeight:l,railWidth:h,slidable:d}=this.attribute,{value:c}=this.attribute;T(c)&&(c=[i,s]);let u=a&&a.visible,p=this._isHorizontal,[m,g]=cE(c),f=this.calculatePosByValue(m,e?"start":"end"),_=this._renderHandler(Object.assign({x:p?f:h/2,y:p?l/2:f,size:n,strokeBoundsBuffer:0,cursor:d===!1?"default":XS(p)},o));if(_.name=rr.startHandler,this._startHandler=_,t.add(_),this._currentValue.startPos=f,u){let v=this._renderHandlerText(m,e?"start":"end");v.name=rr.startHandlerText,t.add(v),this._startHandlerText=v}if(e){let v=this.calculatePosByValue(g,"end"),x=this._renderHandler(Object.assign({x:p?v:h/2,y:p?l/2:v,size:n,strokeBoundsBuffer:0,cursor:d===!1?"default":XS(p)},o));if(x.name=rr.endHandler,this._endHandler=x,t.add(x),this._currentValue.endPos=v,u){let y=this._renderHandlerText(g,"end");y.name=rr.endHandlerText,t.add(y),this._endHandlerText=y}}}_renderTrack(t){let{range:e,min:i,max:s,railHeight:n,railWidth:o,trackStyle:a,railStyle:l,slidable:h,value:d}=this.attribute,c,u;if(T(d))e?(c=i,u=s):c=u=i;else if(e){let y=Un(d,i,s);c=y[0],u=y[1]}else c=i,u=ee(d,i,s);let p=this._isHorizontal;e||(c=i);let m=Q.group({x:0,y:0,width:o,height:n,cornerRadius:l?.cornerRadius,clip:!0,pickable:!1});m.name=rr.trackContainer;let g=ct(e)&&e.draggableTrack===!0,f;f=h===!1?"default":e===!1||g===!1?"pointer":XS(p);let _=this.calculatePosByValue(c,"start"),v=this.calculatePosByValue(u,e?"end":"start"),x=Q.rect(Object.assign({x:p?Math.min(_,v):0,y:p?0:Math.min(_,v),width:p?Math.abs(v-_):o,height:p?n:Math.abs(v-_),cursor:f},a));x.name=rr.track,this._track=x,m.add(x),t.add(m)}_renderHandler(t){return Q.symbol(t)}_renderHandlerText(t,e){var i,s,n;let{align:o,handlerSize:a=14,handlerText:l={},railHeight:h,railWidth:d,slidable:c}=this.attribute,u=this._isHorizontal,p=this.calculatePosByValue(t,e),m=(i=l.space)!==null&&i!==void 0?i:4,g={text:l.formatter?l.formatter(t):t.toFixed((s=l.precision)!==null&&s!==void 0?s:0),lineHeight:(n=l.style)===null||n===void 0?void 0:n.lineHeight,cursor:c===!1?"default":XS(u)};return u?o==="top"?(g.textBaseline="bottom",g.textAlign="center",g.x=p,g.y=(h-a)/2-m):(g.textBaseline="top",g.textAlign="center",g.x=p,g.y=(h+a)/2+m):o==="left"?(g.textBaseline="middle",g.textAlign="end",g.x=(d-a)/2-m,g.y=p):(g.textBaseline="middle",g.textAlign="start",g.x=(d+a)/2+m,g.y=p),Q.text(Object.assign(Object.assign({},g),l.style))}_renderTooltip(){var t;let{tooltip:e,railHeight:i,railWidth:s,align:n}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;let o=this._isHorizontal?0:s/2,a=this._isHorizontal?i/2:0;if(e&&e.shape){let u=Q.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:o,y:a,symbolType:"circle"},e.shapeStyle));this._tooltipShape=u,this._mainContainer.add(u)}let l=e&&e.text||{},h=(t=l.space)!==null&&t!==void 0?t:6,d={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(d.x=o,d.y=n==="top"?a-i/2-h:a+i/2+h,d.textAlign="center",d.textBaseline=n==="top"?"bottom":"top"):(d.y=a,d.x=n==="left"?o-s/2-h:a+s/2+h,d.textAlign=n==="left"?"end":"start",d.textBaseline="middle");let c=Q.text(Object.assign(Object.assign({},d),l.style));this._mainContainer.add(c),this._tooltipText=c,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;let{railWidth:i,railHeight:s}=this.attribute,n=this._isHorizontal?i:s,o=this._tooltipState.pos*n,a=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[a]:o});let{align:l}=this.attribute;if(this._tooltipText){let h=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[a]:o,text:h.formatter?h.formatter(this._tooltipState.value):this._isHorizontal||l!=="left"?`\u2248 ${this._tooltipState.value.toFixed((e=h.precision)!==null&&e!==void 0?e:0)}`:`${this._tooltipState.value.toFixed((t=h.precision)!==null&&t!==void 0?t:0)} \u2248`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;let{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),ct(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_updateTrack(){let{inverse:t,railWidth:e,railHeight:i}=this.attribute,s=this._startHandler,n=this._endHandler;if(this._isHorizontal){let o=s?.attribute.x;if(n){let a=n?.attribute.x;this._track.setAttributes({x:Math.min(o,a),width:Math.abs(o-a)})}else t?this._track.setAttributes({x:o,width:e-o}):this._track.setAttributes({width:o})}else{let o=s?.attribute.y;if(n){let a=n?.attribute.y;this._track.setAttributes({y:Math.min(o,a),height:Math.abs(o-a)})}else t?this._track.setAttributes({y:o,height:i-o}):this._track.setAttributes({height:o})}}_updateHandler(t,e,i){var s;let n=this._isHorizontal;t.setAttribute(n?"x":"y",e);let o=t.name===rr.startHandler?this._startHandlerText:this._endHandlerText;if(o){let{handlerText:a={}}=this.attribute;o.setAttributes({text:a.formatter?a.formatter(i):i.toFixed((s=a.precision)!==null&&s!==void 0?s:0),[n?"x":"y"]:e})}t.name===rr.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var s;let n=this._isHorizontal,{handlerText:o={}}=this.attribute;t.setAttributes({[n?"x":"y"]:e,text:o.formatter?o.formatter(i):i.toFixed((s=o.precision)!==null&&s!==void 0?s:0)});let a=t.name===rr.startHandlerText?this._startHandler:this._endHandler;a&&a.setAttributes({[n?"x":"y"]:e}),t.name===rr.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){let t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){let{inverse:t}=this.attribute,e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<e?.attribute.x||t&&i.attribute.x>e?.attribute.x)&&([e,i]=[i,e]):(!t&&i.attribute.y<e?.attribute.y||t&&i.attribute.y>e?.attribute.y)&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}};ca.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};tH();var a_=class r extends Al{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=i=>{let s=this._slider.tooltipShape;if(s&&i.detail&&!T(i.detail.value)){let n=this._colorScale.scale(i.detail.value);s.setAttribute("fill",n)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){let{colors:t,slidable:e,layout:i,align:s,min:n,max:o,value:a,railWidth:l,railHeight:h,showHandler:d=!0,handlerSize:c,handlerStyle:u,railStyle:p,trackStyle:m,startText:g,endText:f,handlerText:_,showTooltip:v,tooltip:x,inverse:y,disableTriggerEvent:b}=this.attribute,S=[],C=(o-n)/(t.length-1);for(let M=0;M<t.length;M++)S.push(n+C*M);this._colorScale=new ir().domain(S,!0).range(t),this._color=this._getTrackColor();let k=new ca({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:s,min:n,max:o,value:a,railWidth:l,railHeight:h,showHandler:d,handlerSize:c,handlerStyle:u,railStyle:p,trackStyle:Object.assign({fill:this._color},m),startText:g,endText:f,handlerText:_,showTooltip:v,tooltip:x,disableTriggerEvent:b,inverse:y});this._innerView.add(k),this._slider=k,k.translateTo(0-k.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+ft(this.attribute,"title.space",12):0)-k.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){let{colors:t,layout:e,inverse:i}=this.attribute;if(st(t))return;let s=t.length;if(s===1)return t[0];let n=[];for(let l=0;l<s;l++){let h=l/(s-1);n.push({offset:h,color:t[l]})}let o=e==="horizontal",a={gradient:"linear",stops:n,x0:0,y0:0,x1:o?1:0,y1:o?0:1};return i&&(o?(a.x0=1,a.x1=0):(a.y0=1,a.y1=0)),a}_updateColor(){var t;let{layout:e="horizontal",colors:i,railWidth:s,railHeight:n}=this.attribute,{startHandler:o,endHandler:a,track:l,attribute:h}=this._slider,{startValue:d,endValue:c,startPos:u,endPos:p}=this._slider.currentValue,m=(t=h.handlerStyle)===null||t===void 0?void 0:t.fill;if(o&&!m){let f=this._colorScale.scale(d);o.setAttribute("fill",f)}if(a&&!m){let f=this._colorScale.scale(c);a.setAttribute("fill",f)}let g=e==="horizontal"?s:n;if(Math.abs(u-p)!==g&&i&&i.length>1){let f=this._color.stops,_=Math.min(u,p),v=Math.max(u,p),x=_/g,y=v/g,b=y-x,S=f.filter(P=>P.offset>x&&P.offset<y),C=Math.min(d,c),k=Math.max(d,c),M=this._colorScale.scale(C),E=this._colorScale.scale(k),D=[{offset:0,color:M}];S.forEach(P=>{D.push({offset:(P.offset-x)/b,color:P.color})}),D.push({offset:1,color:E}),l.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:D}))}}};a_.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function nH(r="bottom"){let t=0;return r==="top"?`
    M${t},-6L${t-3.5},-2.5
    v5
    h7
    v-5
    Z
`:r==="left"?(t=1,`
    M${t-6},0L${t-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):r==="right"?(t=-1,`
    M${t+6},0L${t+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${t},6L${t-3.5},2.5
    v-5
    h7
    v5
    Z
`}eH();var l_=class r extends Al{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){let{slidable:t,layout:e,align:i,min:s,max:n,value:o,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:d,handlerStyle:c,railStyle:u,trackStyle:p,startText:m,endText:g,handlerText:f,showTooltip:_,tooltip:v,sizeBackground:x,disableTriggerEvent:y,inverse:b}=this.attribute,S=Q.group({x:0,y:0});this._innerView.add(S);let C=new ca({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:s,max:n,value:o,railWidth:a,railHeight:l,showHandler:h,handlerSize:d,handlerStyle:Object.assign({symbolType:nH(i)},c),railStyle:u,trackStyle:p,startText:m,endText:g,handlerText:f,showTooltip:_,tooltip:v,disableTriggerEvent:y,inverse:b});S.add(C);let k,M=0;e==="horizontal"?i==="top"?(k=`M0,0L${a},0L${b?0:a},12Z`,M=l):(k=`M0,12L${a},12L${b?0:a},0Z`,C.setAttribute("y",12)):i==="left"?k=`M${a},0L${a+12},${b?0:l}L${a},${l}Z`:(k=`M0,${b?0:l}L12,${l}L12,0Z`,C.setAttribute("x",12));let E=Q.path(Object.assign(Object.assign({x:0,y:M,path:k},x),{zIndex:0}));S.add(E);let D=this._title?this._title.AABBBounds.height()+ft(this.attribute,"title.space",12):0;S.translate(0-S.AABBBounds.x1,D-S.AABBBounds.y1),this._slider=C}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}};l_.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function oH(){_e(),Wr(),bn()}oH();var h_=class r extends xe{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="title"}render(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g,f,_,v,x,y;let{textType:b,text:S,subtextType:C,textStyle:k={},subtext:M,subtextStyle:E={},width:D,height:P,minWidth:B,maxWidth:L,minHeight:w,maxHeight:R,align:N,verticalAlign:z,padding:Y=0}=this.attribute,U=Ni(Y),$=this.createOrUpdateChild("title-container",{x:U[3],y:U[0],zIndex:1},"group"),ut=(t=k.height)!==null&&t!==void 0?t:P;if(this.attribute.visible!==!1&&k.visible!==!1){let{width:de,maxHeight:je,maxWidth:zt,x:ke=0,y:Ze=0,ellipsis:Ds=!0,wordBreak:Es="break-word",maxWidth:ii,lineClamp:Da}=k;if(b==="rich"||A(k.character)){let ws=Object.assign({x:ke,y:Ze,width:(e=de??D)!==null&&e!==void 0?e:0,height:ut??0,ellipsis:Ds==null||Ds,wordBreak:Es??"break-word",maxHeight:je??R,maxWidth:zt??ii,textConfig:(i=k.character)!==null&&i!==void 0?i:S},k);this._mainTitle=$.createOrUpdateChild("mainTitle",ws,"richtext")}else if(b==="html"){let ws=Object.assign({html:Object.assign(Object.assign({dom:S},MD),k),x:ke,y:Ze,width:(s=de??D)!==null&&s!==void 0?s:0,height:ut??0,ellipsis:Ds,wordBreak:Es,maxHeight:je??R,maxWidth:zt??ii,textConfig:[]},k);this._mainTitle=$.createOrUpdateChild("mainTitle",ws,"richtext")}else A(S)&&(this._mainTitle=$.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:H(S)?S:[S],whiteSpace:"normal"},k),{maxLineWidth:(o=(n=k.maxLineWidth)!==null&&n!==void 0?n:de)!==null&&o!==void 0?o:D,heightLimit:(a=k.height)!==null&&a!==void 0?a:R,lineClamp:Da,ellipsis:Ds,x:ke,y:Ze}),"text"))}let mt=this._mainTitle?this._mainTitle.AABBBounds.height():0,bt=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&E.visible!==!1){let{width:de,height:je,maxWidth:zt,maxHeight:ke,x:Ze=0,y:Ds=0,ellipsis:Es=!0,wordBreak:ii="break-word",lineClamp:Da}=E,ws=Math.max(Number.MIN_VALUE,R-mt);if(C==="rich"||A(E.character)){let jn=Object.assign({x:Ze,y:Ds,width:(l=de??D)!==null&&l!==void 0?l:0,height:(h=je??P)!==null&&h!==void 0?h:0,ellipsis:Es,wordBreak:ii,maxHeight:ke??ws,maxWidth:zt??L,textConfig:(d=E.character)!==null&&d!==void 0?d:M},E);this._subTitle=$.createOrUpdateChild("subTitle",jn,"richtext")}else if(C==="html"){let jn=Object.assign({html:Object.assign(Object.assign({dom:M},MD),E),x:Ze,y:Ds,width:(c=de??D)!==null&&c!==void 0?c:0,height:(u=je??P)!==null&&u!==void 0?u:0,ellipsis:Es,wordBreak:ii,maxHeight:ke??ws,maxWidth:zt??L,textConfig:[]},E);this._subTitle=$.createOrUpdateChild("subTitle",jn,"richtext")}else A(M)&&(this._subTitle=$.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:H(M)?M:[M],whiteSpace:"normal"},E),{maxLineWidth:(p=E.maxLineWidth)!==null&&p!==void 0?p:D,heightLimit:(m=E.heightLimit)!==null&&m!==void 0?m:ws,lineClamp:Da,ellipsis:Es,x:0,y:mt}),"text"))}let Ot=this._subTitle?this._subTitle.AABBBounds.height():0,me=this._subTitle?this._subTitle.AABBBounds.width():0,Lt=Math.max(bt,me),Ht=mt+((g=E.height)!==null&&g!==void 0?g:Ot);if(A(D)&&(Lt=D),A(P)&&(Ht=P),A(B)&&Lt<B&&(Lt=B),A(L)&&Lt>L&&(Lt=L),A(w)&&Ht<w&&(Ht=w),A(R)&&Ht>R&&(Ht=R),$.attribute.width=Lt,$.attribute.height=Ht,$.attribute.boundsPadding=U,this._mainTitle){if(A(N)||A(k.align)){let zt=k.align?k.align:N,ke=(f=k.width)!==null&&f!==void 0?f:Lt;zt==="center"?(this._mainTitle.setAttribute("x",ke/2),this._mainTitle.setAttribute("textAlign","center")):zt==="right"?(this._mainTitle.setAttribute("x",ke),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}let de=k.verticalAlign?k.verticalAlign:z,je=ut??(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height());de==="middle"?(this._mainTitle.setAttribute("y",je/2),this._mainTitle.setAttribute("textBaseline","middle")):de==="bottom"?(this._mainTitle.setAttribute("y",je),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(A(N)||A(E.align)){let ke=E.align?E.align:N,Ze=(v=(_=E.width)!==null&&_!==void 0?_:k.width)!==null&&v!==void 0?v:Lt;ke==="center"?(this._subTitle.setAttribute("x",Ze/2),this._subTitle.setAttribute("textAlign","center")):ke==="right"?(this._subTitle.setAttribute("x",Ze),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}let de=E.verticalAlign?E.verticalAlign:z,je=this._mainTitle?A(ut)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),ut):this._mainTitle.AABBBounds.y2:0,zt=(y=(x=E.height)!==null&&x!==void 0?x:P)!==null&&y!==void 0?y:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();de==="middle"?(this._subTitle.setAttribute("y",je+zt/2),this._subTitle.setAttribute("textBaseline","middle")):de==="bottom"?(this._subTitle.setAttribute("y",je+zt),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",je),this._subTitle.setAttribute("textBaseline","top"))}}};h_.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};var aH={title:{style:{text:"",fontSize:20,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}},content:{style:{text:"",fontSize:16,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}}};function lH(){_e(),Wr(),bn()}lH();var KS=class extends xe{constructor(){super(...arguments),this.name="indicator"}_renderText(t,e,i,s,n,o){if(e.visible!==!1){let a=G({},ft(aH,n),e.style,{visible:e.visible});a.lineHeight=A(a.lineHeight)?a.lineHeight:a.fontSize,e.formatMethod&&(a._originText=a.text,a.text=e.formatMethod(a.text,a));let l=oa(a);return l.name=o,t.appendChild(l),e.autoFit&&K(i)&&this._setLocalAutoFit(i,l,e),e.autoLimit&&K(s)&&l.setAttribute("maxLineWidth",i),l}}render(){var t,e;if(this.removeAllChild(!0),this.attribute.visible!==!0)return;let{title:i={},content:s,size:n,limitRatio:o=1/0}=this.attribute,a=Math.min(n.width,n.height)*o,l=this.createOrUpdateChild("indicator-container",{x:0,y:0,zIndex:1,pickable:(t=this.attribute.pickable)===null||t===void 0||t},"group");if(A(i)&&(this._title=this._renderText(l,i,a,o,"title.style","indicator-title")),A(s)){let d=O(s),c=[];d.forEach((u,p)=>{u.visible!==!1&&c.push(this._renderText(l,u,a,o,"content.style","indicator-content-"+p))}),this._content=c}this._setGlobalAutoFit(a),this._setYPosition();let h=(e=l?.AABBBounds.height())!==null&&e!==void 0?e:0;l.setAttribute("y",n.height/2-h/2),l.setAttribute("x",n.width/2)}_setLocalAutoFit(t,e,i){var s,n,o,a,l,h,d,c,u;if(((s=i.fitStrategy)!==null&&s!==void 0?s:"default")!=="default")return;let p=_l((o=(n=i.style)===null||n===void 0?void 0:n.text)!==null&&o!==void 0?o:"",(a=i.style)!==null&&a!==void 0?a:{},(h=(l=this.stage)===null||l===void 0?void 0:l.getTheme())===null||h===void 0?void 0:h.text).width;if(p>0){let m=t*((d=i.fitPercent)!==null&&d!==void 0?d:.5)/p,g=Math.floor(((u=(c=i.style)===null||c===void 0?void 0:c.fontSize)!==null&&u!==void 0?u:20)*m);e.setAttribute("fontSize",g),e.setAttribute("lineHeight",A(i.style.lineHeight)?i.style.lineHeight:g)}}_setGlobalAutoFit(t){var e,i,s,n,o,a,l;let h=t/2,d=[],c=0,u=(e=this.attribute.title)!==null&&e!==void 0?e:{};u.autoFit&&u.fitStrategy==="inscribed"?(this._title.setAttribute("fontSize",12),d.push({text:this._title,spec:(i=this.attribute.title)!==null&&i!==void 0?i:{}})):c+=(a=(o=(n=(s=this._title)===null||s===void 0?void 0:s.AABBBounds)===null||n===void 0?void 0:n.height)===null||o===void 0?void 0:o.call(n))!==null&&a!==void 0?a:0;let p=(l=u.space)!==null&&l!==void 0?l:0;if(c+=p,O(this.attribute.content).filter(b=>b.visible!==!1).forEach((b,S)=>{var C,k,M,E;let D=this._content[S];b.autoFit&&b.fitStrategy==="inscribed"?(D.setAttribute("fontSize",12),d.push({text:D,spec:b})):c+=(M=(k=(C=D?.AABBBounds)===null||C===void 0?void 0:C.height)===null||k===void 0?void 0:k.call(C))!==null&&M!==void 0?M:0;let P=(E=b.space)!==null&&E!==void 0?E:0;c+=P}),d.length<=0)return;let m=12/d.reduce((b,S)=>Math.max(b,S.text.AABBBounds.width()),0)*d.length,g=c/2,f=m**2+1,_=2*g*m,v=g**2-h**2,x=2*(m*((-_+Math.sqrt(_**2-4*f*v))/(2*f))+g),y=(x-c)/d.length;K(x)&&d.forEach(b=>{var S;let C=(S=b.spec.style)===null||S===void 0?void 0:S.lineHeight;b.text.setAttribute("fontSize",y),b.text.setAttribute("lineHeight",A(C)?C:y)})}_setYPosition(){var t,e,i,s,n,o;let a=0,l=(s=(i=(e=(t=this._title)===null||t===void 0?void 0:t.AABBBounds)===null||e===void 0?void 0:e.height)===null||i===void 0?void 0:i.call(e))!==null&&s!==void 0?s:0,h=(o=(n=this.attribute.title)===null||n===void 0?void 0:n.space)!==null&&o!==void 0?o:0;O(this.attribute.content).filter(d=>d.visible!==!1).forEach((d,c)=>{var u;let p=this._content[c];p.setAttribute("y",l+h+a);let m=(u=d.space)!==null&&u!==void 0?u:0;a+=p.AABBBounds.height()+m})}};var hH="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -73.1429 161.4994 a 48.7619 48.7619 0 0 1 25.9901 7.5093 l 201.7524 127.1223 a 48.7619 48.7619 0 0 1 0.3657 82.2613 l -201.7524 129.6335 A 48.7619 48.7619 0 0 1 292.5952 540.1838 v -256.7314 a 48.7619 48.7619 0 0 1 48.7619 -48.7619 z m 24.381 92.9402 v 167.9116 l 131.9497 -84.7726 L 365.7381 327.6063 z",dH="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -48.7619 195.0476 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z m 158.4762 0 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z",cH="M 521.29 734.276 L 230.929 448.019 L 521.29 161.762 c 37.685 -37.153 38.003 -97.625 0.707 -134.384 c -37.297 -36.758 -98.646 -36.435 -136.331 0.718 l -357.43 352.378 c -0.155 0.153 -0.297 0.314 -0.451 0.468 c -0.084 0.082 -0.172 0.157 -0.256 0.239 c -18.357 18.092 -27.581 41.929 -27.743 65.902 c -0.004 0.311 -0.017 0.623 -0.018 0.934 c 0.001 0.316 0.014 0.632 0.018 0.948 c 0.165 23.97 9.389 47.803 27.743 65.892 c 0.083 0.082 0.171 0.157 0.255 0.239 c 0.154 0.154 0.296 0.315 0.452 0.468 l 357.43 352.378 c 37.685 37.153 99.034 37.476 136.331 0.718 c 37.297 -36.758 36.979 -97.231 -0.707 -134.384 z",uH="M 734.276 28.71 L 448.019 319.071 L 161.762 28.71 c -37.153 -37.685 -97.625 -38.003 -134.384 -0.707 c -36.758 37.297 -36.435 98.646 0.718 136.331 l 352.378 357.43 c 0.153 0.155 0.314 0.297 0.468 0.451 c 0.082 0.084 0.157 0.172 0.239 0.256 c 18.092 18.357 41.929 27.581 65.902 27.743 c 0.311 0.004 0.623 0.017 0.934 0.018 c 0.316 -0.001 0.632 -0.014 0.948 -0.018 c 23.97 -0.165 47.803 -9.389 65.892 -27.743 c 0.082 -0.083 0.157 -0.171 0.239 -0.255 c 0.154 -0.154 0.315 -0.296 0.468 -0.452 l 352.378 -357.43 c 37.153 -37.685 37.476 -99.034 0.718 -136.331 c -36.758 -37.297 -97.231 -36.979 -134.384 0.707 z",pH="m 161.724 521.29 l 286.257 -290.361 l 286.257 290.361 c 37.153 37.685 97.625 38.003 134.384 0.707 c 36.758 -37.297 36.435 -98.646 -0.718 -136.331 l -352.378 -357.43 c -0.153 -0.155 -0.314 -0.297 -0.468 -0.451 c -0.082 -0.084 -0.157 -0.172 -0.239 -0.256 c -18.092 -18.357 -41.929 -27.581 -65.902 -27.743 c -0.311 -0.004 -0.623 -0.017 -0.934 -0.018 c -0.316 0.001 -0.632 0.014 -0.948 0.018 c -23.97 0.165 -47.803 9.389 -65.892 27.743 c -0.082 0.083 -0.157 0.171 -0.239 0.255 c -0.154 0.154 -0.315 0.296 -0.468 0.452 l -352.378 357.43 c -37.153 37.685 -37.476 99.034 -0.718 136.331 c 36.758 37.297 97.231 36.979 134.384 -0.707 z",mH="M 30 163 L 320.361 449.257 L 30 735.514 c -37.685 37.153 -38.003 97.625 -0.707 134.384 c 37.297 36.758 98.646 36.435 136.331 -0.718 l 357.43 -352.378 c 0.155 -0.153 0.297 -0.314 0.451 -0.468 c 0.084 -0.082 0.172 -0.157 0.256 -0.239 c 18.357 -18.092 27.581 -41.929 27.743 -65.902 c 0.004 -0.311 0.017 -0.623 0.018 -0.934 c -0.001 -0.316 -0.014 -0.632 -0.018 -0.948 c -0.165 -23.97 -9.389 -47.803 -27.743 -65.892 c -0.083 -0.082 -0.171 -0.157 -0.255 -0.239 c -0.154 -0.154 -0.296 -0.315 -0.452 -0.468 l -357.43 -352.378 c -37.685 -37.153 -99.034 -37.476 -136.331 -0.718 c -37.297 36.758 -36.979 97.231 0.707 134.384 z";var Hu=class extends Yc{constructor(t){super(t)}};var ur;(function(r){r.OnPlay="onPlay",r.OnPause="onPause",r.OnForward="onForward",r.OnBackward="onBackward"})(ur||(ur={}));var _d;(function(r){r.Start="start",r.Pause="pause",r.Forward="forward",r.Backward="backward"})(_d||(_d={}));var Nu=class r extends xe{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this._isPaused=!0,this.updateAttributes=()=>{this._startAttr={style:Object.assign(Object.assign(Object.assign({symbolType:hH},r.defaultControllerAttr),{visible:this.attribute.start.visible}),this.attribute.start.style)},this._pauseAttr={style:Object.assign(Object.assign(Object.assign({symbolType:dH},r.defaultControllerAttr),{visible:this.attribute.pause.visible}),this.attribute.pause.style)},this._forwardAttr={style:Object.assign(Object.assign(Object.assign({},r.defaultControllerAttr),{visible:this.attribute.forward.visible}),this.attribute.forward.style)},this._backwardAttr={style:Object.assign(Object.assign(Object.assign({},r.defaultControllerAttr),{visible:this.attribute.backward.visible}),this.attribute.backward.style)},this.updateLayout()},this.updateLayout=()=>{var i,s,n,o;this._layout=this.attribute.layout,this._layout==="horizontal"?(this._backwardAttr.style.symbolType=(i=this._backwardAttr.style.symbolType)!==null&&i!==void 0?i:cH,this._forwardAttr.style.symbolType=(s=this._forwardAttr.style.symbolType)!==null&&s!==void 0?s:mH):this._layout==="vertical"&&(this._backwardAttr.style.symbolType=(n=this._backwardAttr.style.symbolType)!==null&&n!==void 0?n:pH,this._forwardAttr.style.symbolType=(o=this._forwardAttr.style.symbolType)!==null&&o!==void 0?o:uH)},this._initPlay=()=>{T(this._playController)&&(this._playController=new Hu(Object.assign({},this._startAttr.style)),this.add(this._playController))},this._initBackward=()=>{T(this._backwardController)&&(this._backwardController=new Hu(Object.assign({},this._backwardAttr.style)),this.add(this._backwardController))},this._initForward=()=>{T(this._forwardController)&&(this._forwardController=new Hu(Object.assign({},this._forwardAttr.style)),this.add(this._forwardController))},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._playController.addEventListener("pointerdown",i=>{i.stopPropagation(),this._isPaused===!0?this.play():this.pause()}),this._backwardController.addEventListener("pointerdown",i=>{i.stopPropagation(),this.backward()}),this._forwardController.addEventListener("pointerdown",i=>{i.stopPropagation(),this.forward()}))},this.renderPlay=()=>{this._isPaused?this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._startAttr.style)):this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._pauseAttr.style))},this.renderBackward=()=>{this._backwardController.setAttributes(this._backwardAttr.style)},this.renderForward=()=>{this._forwardController.setAttributes(this._forwardAttr.style)},this.play=()=>{this._dispatchEvent(ur.OnPlay)},this.pause=()=>{this._dispatchEvent(ur.OnPause)},this.forward=()=>{this._dispatchEvent(ur.OnForward)},this.backward=()=>{this._dispatchEvent(ur.OnBackward)},this.togglePlay=()=>{this._playController.setAttributes(this._startAttr.style),this._isPaused=!0},this.togglePause=()=>{this._playController.setAttributes(this._pauseAttr.style),this._isPaused=!1},this.updateAttributes(),this._initPlay(),this._initBackward(),this._initForward(),this._initEvents()}render(){this.updateAttributes(),this.renderPlay(),this.renderBackward(),this.renderForward()}};Nu.defaultControllerAttr={visible:!0,x:0,y:0,size:20,fill:"#91caff",pickMode:"imprecise",cursor:"pointer"},Nu.defaultAttributes={[_d.Start]:{},[_d.Pause]:{},[_d.Backward]:{},[_d.Forward]:{}};var d_={visible:!0,style:{x:0,y:0,dx:0,dy:0,size:20},order:0,space:10},$S=[200,10];var fo;(function(r){r.Default="default",r.Reverse="reverse"})(fo||(fo={}));var ti;(function(r){r.change="change",r.play="play",r.pause="pause",r.backward="backward",r.forward="forward",r.end="end",r.OnChange="change",r.OnPlay="play",r.OnPause="pause",r.OnBackward="backward",r.OnForward="forward",r.OnEnd="end"})(ti||(ti={}));var O9=({direction:r,maxIndex:t,dataIndex:e})=>r===fo.Default&&e===t,H9=({direction:r,minIndex:t,dataIndex:e})=>r===fo.Reverse&&e===t,gH=({direction:r,maxIndex:t,minIndex:e,dataIndex:i})=>O9({direction:r,maxIndex:t,dataIndex:i})||H9({direction:r,minIndex:e,dataIndex:i}),N9=({direction:r,minIndex:t,dataIndex:e})=>r===fo.Default&&e===t,V9=({direction:r,maxIndex:t,dataIndex:e})=>r===fo.Reverse&&e===t,fH=({direction:r,maxIndex:t,minIndex:e,dataIndex:i})=>N9({direction:r,minIndex:e,dataIndex:i})||V9({direction:r,maxIndex:t,dataIndex:i});var kn=r=>r==="top"||r==="bottom",_H=(r,t,e,i)=>r==="default"?Math.min(t+1,i):Math.max(t-1,e);var vd=class r extends xe{getMinIndex(){return this._minIndex}getMaxIndex(){return this._maxIndex}getDataIndex(){return this._dataIndex}constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this._data=[],this._dataIndex=0,this._layoutInfo={},this._updateSliderAttrs=()=>{var i,s;let n;K(this._handlerStyle.size)?n=this._handlerStyle.size:this._handlerStyle.size&&this._handlerStyle.size.length&&(n=ri(this._handlerStyle.size[0],this._handlerStyle.size[1]));let o={visible:this._sliderVisible,min:this._minIndex,max:this._maxIndex,value:this._dataIndex,railWidth:this._railStyle.width,railHeight:this._railStyle.height,railStyle:this._railStyle,trackStyle:this._trackStyle,handlerSize:K(n)?n:void 0,handlerStyle:this._handlerStyle,dy:this.attribute.slider.dy,dx:this.attribute.slider.dx,slidable:!0,range:!1,handlerText:{visible:!1},startText:{visible:!1},endText:{visible:!1},disableTriggerEvent:this.attribute.disableTriggerEvent};if(kn(this._orient)){let a=Math.max(0,this._layoutInfo.slider.size),l=(i=this._railStyle.height)!==null&&i!==void 0?i:$S[1];o.layout="horizontal",o.railHeight=l,o.railWidth=a,o.x=this._layoutInfo.slider.x,o.y=this._layoutInfo.slider.y}else{let a=Math.max(0,this._layoutInfo.slider.size),l=(s=this._railStyle.width)!==null&&s!==void 0?s:$S[1];o.layout="vertical",o.railWidth=l,o.railHeight=a,o.x=this._layoutInfo.slider.x,o.y=this._layoutInfo.slider.y}return o},this._initSlider=()=>{let i=this._updateSliderAttrs();this._slider=new ca(i),this._sliderVisible&&this.add(this._slider)},this._updateControllerAttrs=()=>{let i={start:this._start,pause:this._pause,forward:this._forward,backward:this._backward,disableTriggerEvent:this.attribute.disableTriggerEvent};return i.layout=kn(this._orient)?"horizontal":"vertical",i.start=Object.assign(Object.assign({},i.start),{style:Object.assign(Object.assign({},i.start.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),i.pause=Object.assign(Object.assign({},i.pause),{style:Object.assign(Object.assign({},i.pause.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),i.backward=Object.assign(Object.assign({},i.backward),{style:Object.assign(Object.assign({},i.backward.style),{x:this._layoutInfo.backward.x,y:this._layoutInfo.backward.y})}),i.forward=Object.assign(Object.assign({},i.forward),{style:Object.assign(Object.assign({},i.forward.style),{x:this._layoutInfo.forward.x,y:this._layoutInfo.forward.y})}),i},this._initController=()=>{let i=this._updateControllerAttrs();this._controller=new Nu(i),this._controllerVisible&&this.add(this._controller)},this._initAttributes(),this._initDataIndex(),this._initLayoutInfo(),this._initController(),this._initSlider()}_initAttributes(){this._size=this.attribute.size,this._orient=this.attribute.orient,this._data=this.attribute.data,this._minIndex=0,this._maxIndex=this._data.length-1;let{slider:t={},controller:e={}}=this.attribute;this._sliderVisible=t.visible,this._railStyle=Object.assign({},t.railStyle),this._trackStyle=Object.assign({},t.trackStyle),this._handlerStyle=Object.assign({},t.handlerStyle),this._controllerVisible=e.visible,this._start=Object.assign({},e.start),this._pause=Object.assign({},e.pause),this._forward=Object.assign({},e.forward),this._backward=Object.assign({},e.backward)}_initDataIndex(){var t;this._dataIndex=(t=this.attribute.dataIndex)!==null&&t!==void 0?t:0}_initLayoutInfo(){var t,e,i;let s=[this._start,this._backward,this._forward].sort((u,p)=>u.order-p.order),n=s.filter(u=>u.position!=="end"),o=s.filter(u=>u.position==="end"),a=(t=kn(this._orient)?this._railStyle.height:this._railStyle.width)!==null&&t!==void 0?t:$S[1],l=s.reduce((u,p)=>{let m=p.style.size,g=J(m)?m:ri(m[0],m[1]);return u+p.space+g},0),h=this._sliderVisible?(kn(this._orient)?(e=this._size)===null||e===void 0?void 0:e.width:(i=this._size)===null||i===void 0?void 0:i.height)-l:0,d=h-this.attribute.slider.space,c=n.reduce((u,p)=>{let{key:m,space:g,style:{size:f}}=p,_=J(f)?f:ri(f[0],f[1]);return this._layoutInfo[m]=Object.assign(Object.assign({},this._layoutInfo[m]),{size:_,x:kn(this._orient)?u+g:(this._size.width-_)/2,y:kn(this._orient)?(this._size.height-_)/2:u+g}),u+g+_},0);this._layoutInfo.slider=Object.assign(Object.assign({},this._layoutInfo.slider),{size:d,x:kn(this._orient)?c+this.attribute.slider.space:(this._size.width-a)/2,y:kn(this._orient)?(this._size.height-a)/2:c+this.attribute.slider.space}),o.reduce((u,p)=>{let{key:m,space:g,style:{size:f}}=p,_=J(f)?f:ri(f[0],f[1]);return this._layoutInfo[m]=Object.assign(Object.assign({},this._layoutInfo[m]),{size:_,x:kn(this._orient)?u+g:(this._size.width-_)/2,y:kn(this._orient)?(this._size.height-_)/2:u+g}),u+g+_},c+h)}render(){this._initLayoutInfo(),this.renderSlider(),this.renderController()}renderSlider(){let t=this._updateSliderAttrs();this._slider.setAttributes(t)}renderController(){let t=this._updateControllerAttrs();this._controller.setAttributes(t)}dispatchCustomEvent(t,e){this._dispatchEvent(t,{eventType:t,index:e,value:this._data[e]})}};vd.defaultAttributes={visible:!0,data:[],interval:1e3,orient:"bottom",align:"center",size:{height:20,width:300},slider:{visible:!0,space:10,dx:0,dy:0,railStyle:{cornerRadius:5},trackStyle:{},handlerStyle:{}},controller:{visible:!0,start:Object.assign(Object.assign({},d_),{key:"start",position:"start",space:0}),pause:Object.assign(Object.assign({},d_),{key:"pause",position:"start"}),forward:Object.assign(Object.assign({},d_),{key:"forward",position:"end"}),backward:Object.assign(Object.assign({},d_),{key:"backward",position:"start"})}};function vH(){fd(),_e(),Mr()}function yH(){vH()}function xH(){vH()}yH();var qS=class extends vd{constructor(t,e){super(e?.skipDefault?t:G({},t)),this._activeIndex=-1,this._isReachEnd=!1,this._initAttributes=()=>{var i,s,n;super._initAttributes(),this._alternate=(i=this.attribute.alternate)!==null&&i!==void 0&&i,this._interval=(s=this.attribute.interval)!==null&&s!==void 0?s:1e3,this._direction=(n=this.attribute.direction)!==null&&n!==void 0?n:fo.Default},this._initDataIndex=()=>{var i;this._dataIndex=T(this.attribute.dataIndex)?this._direction==="default"?this._minIndex:this._maxIndex:(i=this.attribute.dataIndex)!==null&&i!==void 0?i:0,this._slider.setAttribute("value",this._dataIndex)},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ur.OnPlay,i=>{i.stopPropagation(),this.play()}),this._controller.addEventListener(ur.OnPause,i=>{i.stopPropagation(),this.pause()}),this._controller.addEventListener(ur.OnForward,i=>{i.stopPropagation(),this.forward()}),this._controller.addEventListener(ur.OnBackward,i=>{i.stopPropagation(),this.backward()}),this._slider.addEventListener("change",i=>{let s=Math.floor(i.detail.value)+.5;this._dataIndex=i.detail.value>=s?Math.ceil(i.detail.value):Math.floor(i.detail.value),this._slider.setValue(this._dataIndex),this.dispatchCustomEvent(ti.change)}))},this.play=()=>{this._isPlaying||this._data.length!==1&&(this._controller.togglePause(),this._isPlaying=!0,(gH({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction})||fH({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction}))&&(this._direction===fo.Default?this._updateDataIndex(this._minIndex):this._updateDataIndex(this._maxIndex)),this.dispatchCustomEvent(ti.play),this._isReachEnd=!1,this._tickTime=Date.now(),this._rafId=kt.getRequestAnimationFrame()(this._play.bind(this,!0)))},this._play=i=>{let s=Date.now();if(this._isReachEnd&&s-this._tickTime>=this._interval)return this._isReachEnd=!1,void this._playEnd();i&&this._activeIndex!==this._dataIndex?(this.dispatchCustomEvent(ti.change),this._activeIndex=this._dataIndex):s-this._tickTime>=this._interval&&(this._tickTime=s,this._updateDataIndex(_H(this._direction,this._dataIndex,this._minIndex,this._maxIndex)),this._activeIndex=this._dataIndex,this.dispatchCustomEvent(ti.change)),(this._direction==="default"&&this._dataIndex>=this._maxIndex||this._direction==="reverse"&&this._dataIndex<=this._minIndex)&&(this._isReachEnd=!0),this._rafId=kt.getRequestAnimationFrame()(this._play.bind(this,!1))},this._updateDataIndex=i=>{this._dataIndex=i,this._slider.setValue(this._dataIndex)},this._playEnd=()=>{this._isPlaying=!1,this._controller.togglePlay(),kt.getCancelAnimationFrame()(this._rafId),this._activeIndex=-1,this.dispatchCustomEvent(ti.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,kt.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(ti.pause))},this.backward=()=>{let{loop:i=!1}=this.attribute,s;s=i?this._dataIndex-1<this._minIndex?this._maxIndex:this._dataIndex-1:Math.max(this._dataIndex-1,this._minIndex),this._updateDataIndex(s),this.dispatchCustomEvent(ti.change),this.dispatchCustomEvent(ti.backward)},this.forward=()=>{let{loop:i=!1}=this.attribute,s;s=i?this._dataIndex+1>this._maxIndex?this._minIndex:this._dataIndex+1:Math.min(this._dataIndex+1,this._maxIndex),this._updateDataIndex(s),this.dispatchCustomEvent(ti.change),this.dispatchCustomEvent(ti.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}setAttributes(t,e){super.setAttributes(t,e),this._initAttributes()}dispatchCustomEvent(t){super.dispatchCustomEvent(t,this._dataIndex)}};var j9=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};xH();var ZS=class extends vd{constructor(t){super(t),this._isPlaying=!1,this._startTime=Date.now(),this._initAttributes=()=>{var e;super._initAttributes(),this._maxIndex=this._data.length,this._slider.setAttribute("max",this._maxIndex),this._isPlaying=!1,this._elapsed=0,this._interval=(e=this.attribute.interval)!==null&&e!==void 0?e:1e3;let i=this._data.length;this.attribute.totalDuration&&this._data.length?(this._totalDuration=this.attribute.totalDuration,this._interval=this._totalDuration/(i??1)):(this._totalDuration=this._interval*i,this._interval=this.attribute.interval)},this._initDataIndex=()=>{var e;this._dataIndex=(e=this.attribute.dataIndex)!==null&&e!==void 0?e:this._minIndex},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ur.OnPlay,e=>{e.stopPropagation(),this.play()}),this._controller.addEventListener(ur.OnPause,e=>{e.stopPropagation(),this.pause()}),this._controller.addEventListener(ur.OnForward,e=>{e.stopPropagation(),this.forward()}),this._controller.addEventListener(ur.OnBackward,e=>{e.stopPropagation(),this.backward()}),this._slider.addEventListener("change",e=>{var i;e.stopPropagation();let s=(i=e.detail)===null||i===void 0?void 0:i.value,n=s/this._maxIndex;this._elapsed=n*this._totalDuration,this._startTime=Date.now()-this._elapsed,this._dispatchChange(s)}))},this._getSliderValue=()=>{let e=this._elapsed/this._totalDuration;return Math.min(e*this._maxIndex,this._maxIndex)},this._updateSlider=()=>{let e=this._getSliderValue();this._dataIndex=Math.floor(e),this._slider.setValue(Math.min(e,this._maxIndex)),this._dispatchChange(Math.floor(e))},this._dispatchChange=e=>{let i=Math.floor(e);i!==this._activeIndex&&(this._dataIndex=i,this._activeIndex=i,i!==this._maxIndex&&this.dispatchCustomEvent(ti.change))},this.play=()=>j9(this,void 0,void 0,function*(){this._isPlaying||(this._controller.togglePause(),this._isPlaying=!0,this._elapsed>=this._totalDuration&&(this._elapsed=0),this._startTime=Date.now()-this._elapsed,this.dispatchCustomEvent(ti.play),this._rafId=kt.getRequestAnimationFrame()(this._play.bind(this)))}),this._play=()=>{this._elapsed=Date.now()-this._startTime;let e=this._getSliderValue();this._updateSlider(),e>=this._maxIndex?this._playEnd():this._rafId=kt.getRequestAnimationFrame()(this._play.bind(this))},this._playEnd=()=>{this._isPlaying=!1,kt.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(ti.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,this._elapsed=Date.now()-this._startTime,kt.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(ti.pause))},this.backward=()=>{let e=Date.now(),i=1*this._interval,s=this._elapsed-i;s<=0?(this._elapsed=0,this._startTime=e):(this._elapsed=s,this._startTime=this._startTime+this._interval),this._updateSlider(),this.dispatchCustomEvent(ti.backward)},this.forward=()=>{let e=Date.now(),i=1*this._interval,s=this._elapsed+i;s>=this._totalDuration?(this._startTime=e-this._totalDuration,this._elapsed=this._totalDuration):(this._startTime=this._startTime-i,this._elapsed=s),this._updateSlider(),this.dispatchCustomEvent(ti.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}dispatchCustomEvent(t){super.dispatchCustomEvent(t,this._dataIndex)}render(){super.render()}};var Xi;(function(r){r.drawStart="drawStart",r.drawEnd="drawEnd",r.drawing="drawing",r.moving="moving",r.moveStart="moveStart",r.moveEnd="moveEnd",r.brushClear="brushClear"})(Xi||(Xi={}));var _o={trigger:"pointerdown",updateTrigger:"pointermove",endTrigger:"pointerup",resetTrigger:"pointerupoutside",hasMask:!0,brushMode:"single",brushType:"rect",brushStyle:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",strokeWidth:2},brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:10,interactiveRange:{y1:-1/0,y2:1/0,x1:-1/0,x2:1/0}},bH=5;function SH(){_e(),od()}var z9={debounce:Zi,throttle:Hi};SH();var c_=class r extends xe{constructor(t,e){super(e?.skipDefault?t:G({},r.defaultAttributes,t)),this.name="brush",this._activeDrawState=!1,this._cacheDrawPoints=[],this._isDrawedBeforeEnd=!1,this._isDownBeforeUpOutside=!1,this._activeMoveState=!1,this._operatingMaskMoveDx=0,this._operatingMaskMoveDy=0,this._operatingMaskMoveRangeX=[-1/0,1/0],this._operatingMaskMoveRangeY=[-1/0,1/0],this._brushMaskAABBBoundsDict={},this._onBrushStart=i=>{var s;if(this._outOfInteractiveRange(i))return void(this._isDownBeforeUpOutside=!0);i.stopPropagation();let n=(s=this.attribute.brushMoved)===null||s===void 0||s;this._activeMoveState=n&&this._isPosInBrushMask(i),this._activeDrawState=!this._activeMoveState,this._activeDrawState&&this._initDraw(i),this._activeMoveState&&this._initMove(i)},this._onBrushing=i=>{this._outOfInteractiveRange(i)||((this._activeDrawState||this._activeMoveState)&&i.stopPropagation(),this._activeDrawState&&this._drawing(i),this._activeMoveState&&this._moving(i))},this._onBrushingWithDelay=this.attribute.delayTime===0?this._onBrushing:z9[this.attribute.delayType](this._onBrushing,this.attribute.delayTime),this._onBrushEnd=i=>{var s;if(!this._activeDrawState&&!this._activeMoveState)return;i.preventDefault();let{removeOnClick:n=!0}=this.attribute;this._activeDrawState&&!this._isDrawedBeforeEnd&&n?(!((s=this._operatingMask)===null||s===void 0)&&s._AABBBounds.empty()&&this._dispatchEvent(Xi.brushClear,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._container.incrementalClearChild(),this._brushMaskAABBBoundsDict={}):(this._activeDrawState&&this._dispatchEvent(Xi.drawEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._activeMoveState&&this._dispatchEvent(Xi.moveEnd,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i})),this._activeDrawState=!1,this._activeMoveState=!1,this._isDrawedBeforeEnd=!1,this._operatingMask&&this._operatingMask.setAttribute("pickable",!1)},this._onBrushClear=i=>{i.preventDefault();let{removeOnClick:s=!0}=this.attribute;this._isDownBeforeUpOutside&&s&&(this._dispatchEvent(Xi.brushClear,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:i}),this._container.incrementalClearChild(),this._brushMaskAABBBoundsDict={}),this._activeDrawState=!1,this._activeMoveState=!1,this._isDrawedBeforeEnd=!1,this._isDownBeforeUpOutside=!1,this._operatingMask&&this._operatingMask.setAttribute("pickable",!1)}}_bindBrushEvents(){if(this.attribute.disableTriggerEvent)return;let{trigger:t=_o.trigger,updateTrigger:e=_o.updateTrigger,endTrigger:i=_o.endTrigger,resetTrigger:s=_o.resetTrigger}=this.attribute;O(t).forEach(n=>kt.addEventListener(n,this._onBrushStart)),O(e).forEach(n=>this.stage.addEventListener(n,this._onBrushingWithDelay)),O(i).forEach(n=>this.stage.addEventListener(n,this._onBrushEnd)),O(s).forEach(n=>this.stage.addEventListener(n,this._onBrushClear))}_isPosInBrushMask(t){let e=this.eventPosToStagePos(t),i=this._container.getChildren();for(let s=0;s<i.length;s++){let{points:n=[],dx:o=0,dy:a=0}=i[s].attribute,l=n.map(h=>({x:h.x+o,y:h.y+a}));if(Ym(l,e.x,e.y))return this._operatingMask=i[s],!0}return!1}_initDraw(t){let{brushMode:e}=this.attribute,i=this.eventPosToStagePos(t);this._cacheDrawPoints=[i],this._isDrawedBeforeEnd=!1,e==="single"&&(this._brushMaskAABBBoundsDict={},this._container.incrementalClearChild()),this._addBrushMask(),this._dispatchEvent(Xi.drawStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_initMove(t){var e,i;this._cacheMovePoint=this.eventPosToStagePos(t),this._operatingMaskMoveDx=(e=this._operatingMask.attribute.dx)!==null&&e!==void 0?e:0,this._operatingMaskMoveDy=(i=this._operatingMask.attribute.dy)!==null&&i!==void 0?i:0;let{interactiveRange:s}=this.attribute,{minY:n=-1/0,maxY:o=1/0,minX:a=-1/0,maxX:l=1/0}=s,{x1:h,x2:d,y1:c,y2:u}=this._operatingMask.globalAABBBounds,p=a-h,m=l-d,g=n-c,f=o-u;this._operatingMaskMoveRangeX=[p,m],this._operatingMaskMoveRangeY=[g,f],this._operatingMask.setAttribute("pickable",!0),this._dispatchEvent(Xi.moveStart,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_drawing(t){var e,i;let s=this.eventPosToStagePos(t),{sizeThreshold:n=bH,brushType:o}=this.attribute,a=this._cacheDrawPoints.length;if(a>0){let p=(e=this._cacheDrawPoints[this._cacheDrawPoints.length-1])!==null&&e!==void 0?e:{};if(s.x===p.x&&s.y===p.y)return}o==="polygon"||a<=1?this._cacheDrawPoints.push(s):this._cacheDrawPoints[a-1]=s;let l=this._computeMaskPoints();this._operatingMask.setAttribute("points",l);let{x1:h=0,x2:d=0,y1:c=0,y2:u=0}=(i=this._operatingMask)===null||i===void 0?void 0:i._AABBBounds;this._isDrawedBeforeEnd=!this._operatingMask._AABBBounds.empty()&&(Math.abs(d-h)>n||Math.abs(c-u)>n),this._isDrawedBeforeEnd&&(this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(Xi.drawing,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t}))}_moving(t){let e=this._cacheMovePoint,i=this.eventPosToStagePos(t);if(i.x===e?.x&&i.y===e?.y)return;let s=i.x-e.x,n=i.y-e.y,o=Math.min(this._operatingMaskMoveRangeX[1],Math.max(this._operatingMaskMoveRangeX[0],s))+this._operatingMaskMoveDx,a=Math.min(this._operatingMaskMoveRangeY[1],Math.max(this._operatingMaskMoveRangeY[0],n))+this._operatingMaskMoveDy;this._operatingMask.setAttributes({dx:o,dy:a}),this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchEvent(Xi.moving,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:t})}_computeMaskPoints(){let{brushType:t,xRange:e=[0,0],yRange:i=[0,0]}=this.attribute,s=[],n=this._cacheDrawPoints[0],o=this._cacheDrawPoints[this._cacheDrawPoints.length-1];return s=t==="rect"?[n,{x:o.x,y:n.y},o,{x:n.x,y:o.y}]:t==="x"?[{x:n.x,y:i[0]},{x:o.x,y:i[0]},{x:o.x,y:i[1]},{x:n.x,y:i[1]}]:t==="y"?[{x:e[0],y:n.y},{x:e[0],y:o.y},{x:e[1],y:o.y},{x:e[1],y:n.y}]:li(this._cacheDrawPoints),s}_addBrushMask(){var t;let{brushStyle:e,hasMask:i}=this.attribute,s=Q.polygon(Object.assign(Object.assign({points:li(this._cacheDrawPoints),cursor:"move",pickable:!1},e),{opacity:i?(t=e.opacity)!==null&&t!==void 0?t:1:0}));s.name=`brush-${Date.now()}`,this._operatingMask=s,this._container.add(s),this._brushMaskAABBBoundsDict[s.name]=s.AABBBounds}_outOfInteractiveRange(t){let{interactiveRange:e}=this.attribute,{minY:i=-1/0,maxY:s=1/0,minX:n=-1/0,maxX:o=1/0}=e,a=this.eventPosToStagePos(t);return a.x>o||a.x<n||a.y>s||a.y<i}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}render(){this._bindBrushEvents();let t=this.createOrUpdateChild("brush-container",{},"group");this._container=t}releaseBrushEvents(){let{delayType:t="throttle",delayTime:e=0,trigger:i=_o.trigger,updateTrigger:s=_o.updateTrigger,endTrigger:n=_o.endTrigger,resetTrigger:o=_o.resetTrigger}=this.attribute;O(i).forEach(a=>kt.removeEventListener(a,this._onBrushStart)),O(s).forEach(a=>this.stage.removeEventListener(a,this._onBrushingWithDelay)),O(n).forEach(a=>this.stage.removeEventListener(a,this._onBrushEnd)),O(o).forEach(a=>this.stage.removeEventListener(a,this._onBrushClear))}};c_.defaultAttributes=_o;var JS=Re;function AH(r,t){let e=0,i=2*Math.PI,s=A(r),n=A(t);for(s||n?n?s?(e=r,i=t):(e=t-2*Math.PI,i=t):(e=r,i=r+2*Math.PI):(e=0,i=2*Math.PI);i<=e;)i+=2*Math.PI;for(;e>2*Math.PI;)e-=2*Math.PI,i-=2*Math.PI;for(;i<0;)e+=2*Math.PI,i+=2*Math.PI;return{startAngle:e,endAngle:i}}function CH(r,t,e){return r.x1>t||r.x2<t||r.y1>e||r.y2<e}function uE(r,t){let e=[];return r.forEach(i=>{let s=+i[t];K(s)&&e.push(s)}),e.length===0?null:Ae(e)}function p_(r,t){let e=[];return r.forEach(i=>{let s=+i[t];K(s)&&e.push(s)}),e.length===0?null:Pe(e)}function Vu(r,t){return r.reduce((e,i)=>{let s=t?+i[t]:+i;return K(s)&&(e+=s),e},0)}function pE(r,t){let e=0,i=0;return r.forEach(s=>{let n=t?+s[t]:+s;K(n)&&(e+=n,i++)}),e/i}function mE(r,t){let e=pE(r,t);return r.length<=1?0:r.reduce((s,n)=>s+(t?+n[t]:+n-e)**2,0)/(r.length-1)}function TH(r,t){return Math.sqrt(mE(r,t))}function kH(r,t){return RC(r.map(e=>e[t]))}function MH(r,t,e){let{predict:i}=qM(r,l=>l[t],l=>l[e]),s=uE(r,t),n=p_(r,t),o=i(s),a=i(n);return[{[t]:s,[e]:o},{[t]:n,[e]:a}]}function DH(r){let t="center",e="middle";return t=(r=Kn(r))>=Math.PI*(7/6)&&r<=Math.PI*(11/6)?"right":r>=Math.PI*(1/6)&&r<=Math.PI*(5/6)?"left":"center",e=r>=Math.PI*(5/3)||r<=Math.PI*(1/3)?"bottom":r>=Math.PI*(2/3)&&r<=Math.PI*(4/3)?"top":"middle",{align:t,baseline:e}}function gE(r,t){let e=u_(r),i=u_(t),s=Math.asin((r.x*t.y-t.x*r.y)/e/i),n=Math.acos((r.x*t.x+r.y*t.y)/e/i);return s<0?-n:n}function u_(r,t={x:0,y:0}){return pe.distancePP(r,t)}function EH(r,t=2){let e=r.reduce((h,d)=>h+(isNaN(d)?0:d),0);if(e===0)return 0;let i=Math.pow(10,t),s=r.map(h=>(isNaN(h)?0:h)/e*i*100),n=100*i,o=s.map(h=>Math.floor(h)),a=o.reduce((h,d)=>h+d,0),l=s.map((h,d)=>h-o[d]);for(;a<n;){let h=Number.NEGATIVE_INFINITY,d=null;for(let c=0;c<l.length;c++)l[c]>h&&(h=l[c],d=c);++o[d],l[d]=0,++a}return o.map(h=>h/i)}function be(r,t,e){let i=!1;if(t&&V(t)){for(let s of r)for(let n of s.getSeries(e))if(i=!!t.call(null,n),i)return i}return i}function QS(r,t){let e=[];for(let i of r)for(let s of i.getSeries(t))e.push(s);return e}var ju=(r,t)=>{for(let e=0;e<r.length;e++){let i=r[e].getSeries();for(let s=0;s<i.length;s++){let n=i[s];if(t&&n&&n.coordinate===t||!t&&n)return n}}return null};function zu(r){return function(t){let e;return e=H(r)?r.reduce((i,s)=>i?.[s],t):t?.[r],e}}var wH;(function(r){r.area_horizontal="area_horizontal",r.area_vertical="area_vertical",r.area_stack="area_stack",r.line_horizontal="line_horizontal",r.line_vertical="line_vertical",r.line_stack="line_stack",r.bar_horizontal="bar_horizontal",r.bar_vertical="bar_vertical",r.bar_stack="bar_stack",r.bar3d_horizontal="bar3d_horizontal",r.bar3d_vertical="bar3d_vertical",r.bar3d_stack="bar3d_stack",r.rangeColumn_horizontal="rangeColumn_horizontal",r.rangeColumn_vertical="rangeColumn_vertical",r.rangeColumn3d_horizontal="rangeColumn3d_horizontal",r.rangeColumn3d_vertical="rangeColumn3d_vertical",r.rangeArea_horizontal="rangeArea_horizontal",r.rangeArea_vertical="rangeArea_vertical",r.linearProgress_horizontal="linearProgress_horizontal",r.linearProgress_vertical="linearProgress_vertical",r.linearProgress_stack="linearProgress_stack",r.boxPlot_horizontal="boxPlot_horizontal",r.boxPlot_vertical="boxPlot_vertical",r.sankey_horizontal="sankey_horizontal",r.sankey_vertical="sankey_vertical",r.waterfall_horizontal="waterfall_horizontal",r.waterfall_vertical="waterfall_vertical",r.circularProgress_stack="circularProgress_stack",r.radar_stack="radar_stack",r.rose_stack="rose_stack"})(wH||(wH={}));var F;(function(r){r.area="area",r.line="line",r.bar="bar",r.bar3d="bar3d",r.rangeColumn="rangeColumn",r.rangeColumn3d="rangeColumn3d",r.rangeArea="rangeArea",r.dot="dot",r.geo="geo",r.link="link",r.map="map",r.pie="pie",r.pie3d="pie3d",r.radar="radar",r.rose="rose",r.scatter="scatter",r.circularProgress="circularProgress",r.wordCloud="wordCloud",r.wordCloud3d="wordCloud3d",r.funnel="funnel",r.funnel3d="funnel3d",r.linearProgress="linearProgress",r.boxPlot="boxPlot",r.sankey="sankey",r.gaugePointer="gaugePointer",r.gauge="gauge",r.treemap="treemap",r.sunburst="sunburst",r.circlePacking="circlePacking",r.waterfall="waterfall",r.heatmap="heatmap",r.correlation="correlation",r.liquid="liquid",r.venn="venn",r.mosaic="mosaic",r.pictogram="pictogram"})(F||(F={}));var PH;(function(r){r.label="label",r.point="point",r.line="line",r.area="area",r.bar="bar",r.bar3d="bar3d",r.boxPlot="boxPlot",r.outlier="outlier",r.circlePacking="circlePacking",r.group="group",r.gridBackground="gridBackground",r.grid="grid",r.dot="dot",r.title="title",r.subTitle="subTitle",r.symbol="symbol",r.funnel="funnel",r.funnel3d="funnel3d",r.transform="transform",r.transform3d="transform3d",r.transformLabel="transformLabel",r.outerLabel="outerLabel",r.outerLabelLine="outerLabelLine",r.pin="pin",r.pinBackground="pinBackground",r.pointer="pointer",r.segment="segment",r.track="track",r.cell="cell",r.cellBackground="cellBackground",r.link="link",r.arrow="arrow",r.pie="pie",r.pie3d="pie3d",r.labelLine="labelLine",r.progress="progress",r.minLabel="minLabel",r.maxLabel="maxLabel",r.rose="rose",r.node="node",r.sunburst="sunburst",r.nonLeaf="nonLeaf",r.leaf="leaf",r.nonLeafLabel="nonLeafLabel",r.leaderLine="leaderLine",r.stackLabel="stackLabel",r.word="word",r.fillingWord="fillingWord",r.wordMask="wordMask",r.nodePoint="nodePoint",r.ripplePoint="ripplePoint",r.centerPoint="centerPoint",r.centerLabel="centerLabel",r.barBackground="barBackground",r.lineLabel="lineLabel",r.areaLabel="areaLabel",r.liquidGroup="liquidGroup",r.liquid="liquid",r.liquidBackground="liquidBackground",r.liquidOutline="liquidOutline",r.circle="circle",r.overlap="overlap",r.overlapLabel="overlapLabel",r.pictogram="pictogram"})(PH||(PH={}));function tA(r){var t,e;let{type:i}=r;return i===F.sankey?(t=r.direction)!==null&&t!==void 0?t:"horizontal":(e=r.direction)!==null&&e!==void 0?e:"vertical"}var G9={primaryFontColor:"titleFontColor",tertiaryFontColor:"labelFontColor",axisLabelFontColor:"axisFontColor",axisMarkerFontColor:"labelReverseFontColor",dataZoomHandleStrokeColor:"dataZoomHandlerStrokeColor",sliderHandleColor:"dataZoomHandlerFillColor",sliderRailColor:"dataZoomBackgroundColor",sliderTrackColor:"dataZoomSelectedColor",playerControllerColor:"dataZoomSelectedColor",popupBackgroundColor:"tooltipBackgroundColor",hoverBackgroundColor:"axisGridColor"},U9={titleFontColor:"primaryFontColor",labelFontColor:"tertiaryFontColor",axisFontColor:"axisLabelFontColor",labelReverseFontColor:"axisMarkerFontColor",dataZoomHandlerStrokeColor:"dataZoomHandleStrokeColor",dataZoomHandlerFillColor:"sliderHandleColor",dataZoomBackgroundColor:"sliderRailColor",dataZoomSelectedColor:"sliderTrackColor",tooltipBackgroundColor:"popupBackgroundColor"};function RH(r,t){let e=G9[t];if(e&&r[e])return r[e];if(r[t])return r[t];let i=U9[t];return i?r[i]:void 0}function Cl(r,t){var e;if(!r)return[];let i=IH(r,t);if(!i||H(i))return(e=i)!==null&&e!==void 0?e:[];if(ct(i)){let{dataScheme:s}=i;return s?eA(s)?s.map(n=>Object.assign(Object.assign({},n),{scheme:n.scheme.map(o=>m_(o)?fE(r,o,t):o).filter(A)})):s.map(n=>m_(n)?fE(r,n,t):n).filter(A):[]}return[]}function g_(r,t){var e,i;return eA(r)?(i=(e=r.find(s=>A(s.isAvailable)?V(s.isAvailable)?s.isAvailable(t):!!s.isAvailable:!A(s.maxDomainLength)||t?.length<=s.maxDomainLength))===null||e===void 0?void 0:e.scheme)!==null&&i!==void 0?i:r[r.length-1].scheme:r}function fE(r,t,e){var i;let s=IH(r,e);if(!s)return;let n,{palette:o}=s;if(ct(o)&&(n=(i=RH(o,t.key))!==null&&i!==void 0?i:t.default),!n)return;if(T(t.a)&&T(t.l)||!Z(n))return n;let a=new Di(n);if(A(t.l)){let{r:l,g:h,b:d}=a.color,{h:c,s:u}=Ba(l,h,d),p=Ra(c,u,t.l),m=new Di(`rgb(${p.r}, ${p.g}, ${p.b})`);m.setOpacity(a.color.opacity),a=m}return A(t.a)&&a.setOpacity(t.a),a.toRGBA()}var BH=(r,t,e)=>{if(t&&m_(r)){let i=fE(t,r,e);if(i)return i}return r};function m_(r){return r&&r.type==="palette"&&!!r.key}function eA(r){return!(!H(r)||r.length===0)&&r.every(t=>A(t.scheme))}function LH(r){return H(r)?{dataScheme:r}:r}function IH(r,t){var e,i;let{type:s}=t??{},n;if(!t||T(s))n=r?.default;else{let o=tA(t);n=(i=(e=r?.[`${s}_${o}`])!==null&&e!==void 0?e:r?.[s])!==null&&i!==void 0?i:r?.default}return n}var qs=class extends la{range(t){return t?(this._range=t,this._resetRange(),this):super.range()}domain(t){return t?(super.domain(t),this._resetRange(),this):super.domain()}_resetRange(){if(!eA(this._range))return void super.range(this._range);let t=g_(this._range,this._domain);super.range(t)}};var W9={linear:ir,band:bs,point:qf,ordinal:la,threshold:Zf,colorOrdinal:qs};function iA(r){let t=W9[r];return t?new t:null}function FH(r,t){if("scale"in r&&r.scale)return Z(r.scale)&&t?.globalScale?t.globalScale.registerMarkAttributeScale(r,t.seriesId):r.scale;let e=iA(r.type);return e&&Y9(e,r),e}function Y9(r,t){r&&t&&(t.domain&&r.domain(t.domain),t.range&&r.range(t.range),t.specified&&r.specified&&r.specified(t.specified),t.clamp&&r.clamp&&r.clamp(t.clamp))}function Qt(r,t,e){if(!t)return r;let i=t.range(),s=e&&t._calculateWholeRange?t._calculateWholeRange(i):t.range(),n=Math.min(s[0],s[s.length-1]),o=Math.max(s[0],s[s.length-1]);return Math.min(Math.max(n,r),o)}function OH(r,t,e){if(!t)return!0;let i=t.range(),s=(e&&t._calculateWholeRange?t._calculateWholeRange(i):t.range()).map(a=>t.invert(a)),n=Math.min(s[0],s[s.length-1]),o=Math.max(s[0],s[s.length-1]);return Array.isArray(r)?r.every(a=>a>=n&&a<=o):r>=n&&r<=o}function _E(r){return A(r?.field)&&A(r?.scale)}function Gu(r){switch(r){case"left":case"right":case"top":case"bottom":return!0;default:return!1}}function pr(r){return!!Z(r)&&!!r.endsWith("%")&&yn(r.substring(0,r.length-1))}function X9(r){return!!ct(r)&&("percent"in r||"offset"in r)}function We(r,t,e,i=0){var s,n;return J(r)?r:pr(r)?Number(r.substring(0,r.length-1))*t/100:V(r)?r(e):ct(r)?t*((s=r.percent)!==null&&s!==void 0?s:0)+((n=r.offset)!==null&&n!==void 0?n:0):i}function rA(r,t,e){var i,s,n,o;let a={top:0,bottom:0,left:0,right:0};return Object.values(r).every(l=>J(l))?(a.top=(i=r.top)!==null&&i!==void 0?i:0,a.right=(s=r.right)!==null&&s!==void 0?s:0,a.bottom=(n=r.bottom)!==null&&n!==void 0?n:0,a.left=(o=r.left)!==null&&o!==void 0?o:0,a):([{orients:["left","right"],size:t.width},{orients:["top","bottom"],size:t.height}].forEach(l=>{l.orients.forEach(h=>{a[h]=We(r[h],l.size,e)})}),a)}function HH(r,t){return r?{width:Math.ceil(Math.min(r.x2-r.x1,t.width)),height:Math.ceil(Math.min(r.y2-r.y1,t.height))}:{width:0,height:0}}function Xr(r){let t={};return H(r)?(T(r[0])||(t.top=t.left=t.bottom=t.right=r[0]),T(r[1])||(t.left=t.right=r[1]),T(r[2])||(t.bottom=r[2]),T(r[3])||(t.left=r[3]),t):J(r)||pr(r)||V(r)||X9(r)?(t.top=t.left=t.bottom=t.right=r,t):(ct(r)&&(t=Object.assign({},r)),t)}function vE(r,t,e){return e?{x:r.x+t.x,y:r.y+t.y}:r}var Tl=(r,t)=>{let e=Number(r),i=r.toString();return isNaN(e)&&i[i.length-1]==="%"?t*(Number(i.slice(0,i.length-1))/100):e};var sA=[{maxDomainLength:10,scheme:["#1664FF","#1AC6FF","#FF8A00","#3CC780","#7442D4","#FFC400","#304D77","#B48DEB","#009488","#FF7DDA"]},{scheme:["#1664FF","#B2CFFF","#1AC6FF","#94EFFF","#FF8A00","#FFCE7A","#3CC780","#B9EDCD","#7442D4","#DDC5FA","#FFC400","#FAE878","#304D77","#8B959E","#B48DEB","#EFE3FF","#009488","#59BAA8","#FF7DDA","#FFCFEE"]}];var NH={default:{dataScheme:sA,palette:{backgroundColor:"#ffffff",borderColor:"#e3e5e8",shadowColor:"rgba(33,37,44,0.1)",hoverBackgroundColor:"#f1f2f5",sliderRailColor:"#f1f3f4",sliderHandleColor:"#ffffff",sliderTrackColor:"#0040ff",popupBackgroundColor:"#ffffff",primaryFontColor:"#21252c",secondaryFontColor:"#606773",tertiaryFontColor:"#89909d",axisLabelFontColor:"#89909d",disableFontColor:"#bcc1cb",axisMarkerFontColor:"#ffffff",axisGridColor:"#f1f2f5",axisDomainColor:"#d9dde4",dataZoomHandleStrokeColor:"#aeb5be",dataZoomChartColor:"#c9ced8",playerControllerColor:"#0040ff",scrollBarSliderColor:"rgba(0,0,0,0.3)",axisMarkerBackgroundColor:"#21252c",markLabelBackgroundColor:"#f1f2f5",markLineStrokeColor:"#606773",dangerColor:"#e33232",warningColor:"#ffc528",successColor:"#07a35a",infoColor:"#3073f2",discreteLegendPagerTextColor:"rgb(51, 51, 51)",discreteLegendPagerHandlerColor:"rgb(47, 69, 84)",discreteLegendPagerHandlerDisableColor:"rgb(170, 170, 170)",emptyCircleColor:"#e3e5e8",linearProgressTrackColor:"#E7EBED"}}};var VH={label:{visible:!1,offset:5,position:"top",style:{stroke:{type:"palette",key:"backgroundColor"},lineWidth:2}},point:{style:{symbolType:"circle"}},seriesMark:"area"};var jH={label:{visible:!1,position:"outside",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}};var zH={bar3d:{style:{length:3}},label:{visible:!1,style:{offset:12,position:"outside"}}};var GH={outerRadius:.8,innerRadius:.6,progress:{style:{fillOpacity:1}},track:{style:{fillOpacity:.2}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}};var UH={dot:{style:{size:10,fillOpacity:1}},symbol:{style:{size:10}},title:{style:{textAlign:"left",textBaseline:"middle",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},subTitle:{style:{textAlign:"left",textBaseline:"top",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}};var WH=r=>{let t={label:{style:{fill:"white",textBaseline:"middle",lineWidth:2}},outerLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"}},line:{style:{stroke:{type:"palette",key:"axisDomainColor"}}}},transformLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle"}}};return t[r?"transform3d":"transform"]={style:{fill:{type:"palette",key:"axisGridColor"}}},t},YH=WH(),XH=WH(!0);var KH={outerRadius:.8,innerRadius:.6,padAngle:1.146,segment:{style:{fillOpacity:1}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}};var K9="M-0.020059 -0.978425 C-0.018029 -0.9888053 -0.013378 -1 0 -1 C0.01342 -1 0.01812 -0.989146 0.0201 -0.978425 C0.02161 -0.9702819 0.0692 -0.459505 0.09486 -0.184807 C0.10298 -0.097849 0.1089 -0.034548 0.11047 -0.018339 C0.11698 0.04908 0.07373 0.11111 0.00002 0.11111 C-0.07369 0.11111 -0.117184 0.04991 -0.110423 -0.018339 C-0.103662 -0.086591 -0.022089 -0.9680447 -0.020059 -0.978425Z",$H="M1 0 C1 0.55228 0.55228 1 0 1 C-0.552285 1 -1 0.55228 -1 0 C-1 -0.552285 -0.552285 -1 0 -1 C0.55228 -1 1 -0.552285 1 0Z",qH={pointer:{type:"path",width:.4,height:.4,style:{path:K9}},pin:{width:.025,height:.025,style:{path:$H,fill:"#888"}},pinBackground:{width:.06,height:.06,style:{path:$H,fill:"#ddd"}}};var ZH={label:{visible:!1,position:"top",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}};var JH={bandWidth:30,progress:{style:{fillOpacity:1}},track:{style:{fill:{type:"palette",key:"linearProgressTrackColor"},fillOpacity:1}}};var QH={arrow:{style:{size:10}}};var tN={defaultFillColor:"#f3f3f3",area:{style:{lineWidth:.5,strokeOpacity:1,stroke:"black",fillOpacity:1}},label:{interactive:!1,style:{fontSize:{type:"token",key:"l6FontSize"},lineHeight:{type:"token",key:"l6LineHeight"},textBaseline:"middle",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},stroke:{type:"palette",key:"backgroundColor"}}}};var eN={outerRadius:.6,pie:{style:{fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside",style:{fontWeight:"normal",stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1}},innerLabel:{style:{lineWidth:2}},emptyCircle:{style:{fill:{type:"palette",key:"emptyCircleColor"},fillOpacity:1}}};var iN={outerRadius:.6,pie3d:{style:{height:10,fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside"}};var rN={label:{visible:!1,offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}};var sN={point:{style:{size:8,symbolType:"circle",lineWidth:0,fillOpacity:.8}},label:{visible:!1,offset:5,position:"top",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}};var nN={seriesFieldName:{total:"total",increase:"increase",decrease:"decrease"},leaderLine:{style:{stroke:"black",lineWidth:1,lineDash:[4,4]}},stackLabel:{visible:!0,offset:12,position:"withChange",style:{fill:"black",fontSize:{type:"token",key:"l4FontSize"}}},label:{visible:!1,offset:12,position:"inside",style:{lineWidth:2}}};var oN={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},aN={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}};var lN={gapWidth:1,nodePadding:[5],nonLeaf:{visible:!1,style:{fillOpacity:.5}},label:{style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},nonLeafLabel:{padding:24,style:{fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},textBaseline:"middle",textAlign:"center"}}};var et="__VCHART";var nA=`${et}_ARC_TRANSFORM_VALUE`,hN=`${et}_ARC_RATIO`,yE=`${et}_ARC_START_ANGLE`,xE=`${et}_ARC_END_ANGLE`,dN=`${et}_ARC_K`,Mn=`${et}_ARC_MIDDLE_ANGLE`,cN=`${et}_ARC_QUADRANT`,uN=`${et}_ARC_RADIAN`,kl=-Math.PI/2,Uu=3*Math.PI/2,Wu=-90,oA=270,yd=.6;var pN={innerRadius:0,outerRadius:1,startAngle:Wu,endAngle:oA,gap:0,labelLayout:{align:"center",offset:0,rotate:"radial"},sunburst:{style:{stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1,cursor:"pointer"}},label:{visible:!0,style:{cursor:"pointer",fill:{type:"palette",key:"primaryFontColor"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}};var mN={label:{visible:!1,offset:5,position:"inside",style:{lineWidth:2,fill:{type:"palette",key:"axisMarkerFontColor"}},minLabel:{position:"end"},maxLabel:{position:"start"}}};var gN={layoutPadding:5,circlePacking:{visible:!0,style:{cursor:"pointer",stroke:{type:"palette",key:"backgroundColor"}}},label:{visible:!0,style:{cursor:"pointer",fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}};var fN={cell:{style:{shape:"square",fillOpacity:1}},cellBackground:{visible:!1}};var _N={link:{style:{fillOpacity:.15,round:!0}}};var vN={rose:{style:{fillOpacity:1}},label:{style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"},textAlign:"center",textBaseline:"middle"}}};var yN={boxPlot:{style:{lineWidth:1}},label:{style:{lineWidth:2}}};var xN={centerLabel:{visible:!0,position:"center",style:{fill:"#fff",text:""}},label:{visible:!0,position:"bottom",style:{fill:"#000"}}};var bN={outlinePadding:10,liquidBackground:{style:{lineWidth:0,fillOpacity:.2}},liquidOutline:{style:{lineWidth:2}}};var SN={circle:{style:{opacity:.8},state:{hover:{opacity:1}}},overlap:{style:{opacity:.8},state:{hover:{opacity:1,stroke:"white",lineWidth:2}}},label:{visible:!0,style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"}}},overlapLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}};var AN={label:{visible:!1,position:"center",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},bar:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}}};var CN={scatter:sN,line:ZH,area:VH,bar:jH,bar3d:zH,pie:eN,pie3d:iN,map:tN,radar:rN,dot:UH,link:QH,wordCloud:oN,wordCloud3d:aN,funnel:YH,funnel3d:XH,linearProgress:JH,circularProgress:GH,waterfall:nN,gauge:KH,gaugePointer:qH,treemap:lN,sunburst:pN,rangeColumn:mN,circlePacking:gN,heatmap:fN,sankey:_N,rose:vN,boxPlot:yN,correlation:xN,liquid:bN,venn:SN,mosaic:AN};var TN={text:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1}}},kN={label:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1,lineJoin:"bevel"}},area:{style:{fillOpacity:.2}},line:{style:{lineWidth:2,lineCap:"round",lineJoin:"round"}},point:{style:{size:8,stroke:{type:"palette",key:"backgroundColor"},lineWidth:1,fillOpacity:1}},word:{style:{fontWeight:null,fontSize:null}},fillingWord:{style:{fontWeight:null,fontSize:null}},sunburst:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},circlePacking:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},funnel3d:{style:{stroke:!1}},barBackground:{visible:!1,style:{fill:{type:"palette",key:"primaryFontColor",a:.06},stroke:"transparent"}}};var MN={domainLine:{visible:!0},grid:{visible:!1},subGrid:{visible:!1},tick:{visible:!0},subTick:{visible:!1}};var bE={label:{space:8},title:{space:8},maxHeight:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},DN={label:{space:12,autoLimit:!0},title:{space:12,autoRotate:!0},maxWidth:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},EN=Object.assign(Object.assign({},bE),{label:{space:0}});var wN={domainLine:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,inside:!1,tickSize:4,alignWithLabel:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},subTick:{visible:!1,tickSize:2,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},label:{visible:!0,inside:!1,space:10,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}},title:{space:10,padding:0,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor"},fontWeight:"normal",fillOpacity:1}}};var PN={domainLine:{visible:!1},grid:{visible:!0},subGrid:{visible:!1},tick:{visible:!1},subTick:{visible:!1}};var RN={grid:{smooth:!0,visible:!0},subGrid:{smooth:!0,visible:!1}},BN={grid:{visible:!0,style:{lineDash:[6,6]}},label:{space:5}};var LN={style:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",lineWidth:2},brushMode:"single",brushType:"rect",brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:0};var IN={trigger:"hover",bandField:{visible:!1,line:{type:"rect",visible:!0,style:{fill:{type:"palette",key:"axisGridColor"},opacity:.7,lineWidth:0,stroke:{type:"palette",key:"markLineStrokeColor"},lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}},linearField:{visible:!1,line:{type:"line",visible:!0,style:{stroke:{type:"palette",key:"markLineStrokeColor"},fill:"transparent",opacity:.7,lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}}};var $9=`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;`,FN=()=>({style:{symbolType:$9,fill:{type:"palette",key:"sliderHandleColor"},scaleX:1.2,scaleY:1.2,stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},lineWidth:1}});var ON=r=>({area:{style:{visible:r,stroke:!1,fill:{type:"palette",key:"dataZoomChartColor"}}},line:{style:{visible:r,stroke:{type:"palette",key:"dataZoomChartColor"},lineWidth:1}}}),HN={padding:[12,0],showDetail:"auto",brushSelect:!1,middleHandler:{visible:!1,background:{size:6,style:{stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},cornerRadius:2}},icon:{style:{size:4,fill:{type:"palette",key:"sliderHandleColor"},stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}}},background:{size:20,style:{fill:{type:"palette",key:"sliderRailColor"},lineWidth:0}},selectedBackground:{style:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.1,outerBorder:{stroke:{type:"palette",key:"sliderTrackColor"},strokeOpacity:.2,distance:-.5,lineWidth:1}}},selectedBackgroundChart:ON(!1),startHandler:FN(),endHandler:FN(),startText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},endText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},backgroundChart:ON(!0)};var NN=(r,t)=>({fontSize:{type:"token",key:r},fill:{type:"palette",key:t},fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}),VN={title:{visible:!0,autoLimit:!1,autoFit:!1,style:NN("l1FontSize","primaryFontColor")},content:{visible:!0,style:NN("l2FontSize","tertiaryFontColor")}};var aA={orient:"right",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"primaryFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},endText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},handlerText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6}};var jN=r=>{let t={width:200,height:8,style:{fill:{type:"palette",key:"sliderRailColor"}}};return r?(t.width=200,t.height=8):(t.width=8,t.height=200),Object.assign(Object.assign({},aA),{rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:"#ffffff"},shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"}}}})},zN={horizontal:jN(!0),vertical:jN(!1)};var GN={orient:"bottom",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"primaryFontColor"},fontWeight:"normal"},space:12},pager:{textStyle:{fill:{type:"palette",key:"discreteLegendPagerTextColor"}},handler:{style:{fill:{type:"palette",key:"discreteLegendPagerHandlerColor"}},state:{disable:{fill:{type:"palette",key:"discreteLegendPagerHandlerDisableColor"}}}}},item:{visible:!0,spaceCol:10,spaceRow:6,padding:2,background:{state:{selectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}},unSelectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}}}},shape:{space:6,style:{lineWidth:0,fillOpacity:1,opacity:1},state:{unSelected:{fillOpacity:.2,opacity:1}}},label:{space:6,style:{fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},opacity:1},state:{unSelected:{fill:{type:"palette",key:"disableFontColor"},opacity:1}}}},allowAllCanceled:!1};var UN=r=>{let t={style:{fill:{type:"palette",key:"sliderRailColor"}}};return r?(t.width=200,t.height=4):(t.height=200,t.width=4),Object.assign(Object.assign({},aA),{sizeBackground:{fill:{type:"palette",key:"dataZoomChartColor"}},track:{style:{fill:{type:"palette",key:"sliderTrackColor",a:.8}}},rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:{type:"palette",key:"sliderTrackColor"}},fill:{type:"palette",key:"sliderHandleColor"}}}})},WN={horizontal:UN(!0),vertical:UN(!1)};var YN={visible:!0,offset:12,position:"top",space:10,nameLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},valueLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},background:{visible:!0,padding:{top:4,bottom:4,left:6,right:6},style:{cornerRadius:2,lineWidth:1,fill:"white",stroke:"grey"}},leader:{visible:!1,style:{lineWidth:1,stroke:"red"}}};var lA=()=>({style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fontStyle:"normal",fill:{type:"palette",key:"primaryFontColor"}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:"palette",key:"markLabelBackgroundColor"}}}});var SE={area:{style:{fill:{type:"palette",key:"axisDomainColor",a:.25}}},label:lA()};var XN=r=>({visible:r,symbolType:"triangle",size:10,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}}),KN=lA();KN.refY=5;var AE={line:{style:{lineDash:[3,3],stroke:{type:"palette",key:"markLineStrokeColor"}}},startSymbol:XN(!1),endSymbol:XN(!0),label:KN};var hA={itemLine:{decorativeLine:{visible:!1},startSymbol:{size:5,visible:!0,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},endSymbol:{style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},line:{style:{stroke:{type:"palette",key:"markLineStrokeColor"}}}},itemContent:{offsetY:-50}};var $N={visible:!0,position:"start",padding:{top:20,bottom:20},slider:{space:10,trackStyle:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.8},railStyle:{fill:{type:"palette",key:"sliderRailColor"}},handlerStyle:{size:15,stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fill:{type:"palette",key:"playerControllerColor"}}},controller:{start:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},pause:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},backward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},forward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}}}};var qN={padding:{top:4,bottom:20},textStyle:{fontSize:{type:"token",key:"l3FontSize"},lineHeight:{type:"token",key:"l3LineHeight"},fill:{type:"palette",key:"primaryFontColor"}},subtextStyle:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fill:{type:"palette",key:"tertiaryFontColor"}}};var ZN={offset:{x:10,y:10},panel:{padding:{top:10,left:10,right:10,bottom:10},backgroundColor:{type:"palette",key:"popupBackgroundColor"},border:{color:{type:"palette",key:"popupBackgroundColor"},width:0,radius:3},shadow:{x:0,y:4,blur:12,spread:0,color:{type:"palette",key:"shadowColor"}}},spaceRow:6,titleLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0},shape:{size:8,spacing:6},keyLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle",spacing:26},valueLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0}};var JN={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:{type:"token",key:"l5FontSize"},fontWeight:"bold",fill:{type:"palette",key:"primaryFontColor"}},contentStyle:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"primaryFontColor"}},panel:{visible:!0,fill:{type:"palette",key:"popupBackgroundColor"},cornerRadius:3,lineWidth:0,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"},size:0,space:12}};var QN={visible:!1,offset:5,overlap:{clampForce:!0,strategy:[]},smartInvert:!1,animation:!1,style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"primaryFontColor"}}};var tV={horizontal:{height:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}},vertical:{width:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}}};var eV={discreteLegend:GN,colorLegend:zN,sizeLegend:WN,axis:wN,axisBand:MN,axisLinear:PN,axisX:bE,axisY:DN,axisZ:EN,axisAngle:BN,axisRadius:RN,markLine:AE,markArea:SE,markPoint:hA,polarMarkLine:AE,polarMarkArea:SE,polarMarkPoint:hA,geoMarkPoint:hA,tooltip:ZN,dataZoom:HN,crosshair:IN,player:$N,brush:LN,indicator:VN,title:qN,mapLabel:YN,poptip:JN,totalLabel:QN,scrollBar:tV};function iV(r,t){return r&&t.key in r?r[t.key]:t.default}function rV(r){return r&&r.type==="token"&&!!r.key}var f_={fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14,l1FontSize:32,l1LineHeight:"150%",l2FontSize:20,l2LineHeight:"140%",l3FontSize:16,l3LineHeight:"150%",l4FontSize:14,l4LineHeight:"150%",l5FontSize:12,l5LineHeight:"130%",l6FontSize:10,l6LineHeight:"120%"};var dA={name:"light",background:{type:"palette",key:"backgroundColor"},padding:20,fontFamily:{type:"token",key:"fontFamily"},colorScheme:NH,token:f_,mark:TN,markByName:kN,series:CN,component:eV,animationThreshold:2e3};var sV={default:{dataScheme:sA,palette:{backgroundColor:"#202226",borderColor:"#404349",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"#404349",sliderRailColor:"#404349",sliderHandleColor:"#202226",sliderTrackColor:"#4284FF",popupBackgroundColor:"#404349",primaryFontColor:"#fdfdfd",secondaryFontColor:"#bbbdc3",tertiaryFontColor:"#888c93",axisLabelFontColor:"#888c93",disableFontColor:"#55595f",axisMarkerFontColor:"#202226",axisGridColor:"#404349",axisDomainColor:"#4b4f54",dataZoomHandleStrokeColor:"#bbbdc3",dataZoomChartColor:"#55595F",playerControllerColor:"#4284FF",scrollBarSliderColor:"rgba(255,255,255,0.3)",axisMarkerBackgroundColor:"#fdfdfd",markLabelBackgroundColor:"#404349",markLineStrokeColor:"#bbbdc3",dangerColor:"#eb4b4b",warningColor:"#f0bd30",successColor:"#14b267",infoColor:"#4284ff",discreteLegendPagerTextColor:"#BBBDC3",discreteLegendPagerHandlerColor:"#BBBDC3",discreteLegendPagerHandlerDisableColor:"#55595F",emptyCircleColor:"#bbbdc3",linearProgressTrackColor:"#404349"}}};var CE={name:"dark",colorScheme:sV,component:{dataZoom:{selectedBackground:{style:{fillOpacity:.4,outerBorder:{strokeOpacity:.4}}}}}};var cA=(r,t,e)=>{if(T(t))return r;let i=t[0];return T(i)?r:t.length===1?(r[i]=e,r):(T(r[i])&&(typeof t[1]=="number"?r[i]=[]:r[i]={}),cA(r[i],t.slice(1),e))},nV=(r,t,e)=>{if(!T(t))return ft(r,t,e)};function ot(r,...t){let e=-1,i=t.length;for(;++e<i;){let s=t[e];jm(r,s,!0,!0)}return r}function oV(r,t,e,i){Object.keys(r).forEach(s=>{if(ct(t))t.type===s&&(H(r[s])?r[s].length>=t.index&&(r[s][t.index]=i?ot({},r[s][t.index],e):e):r[s]=i?ot({},r[s],e):e);else if(H(r[s])){let n=r[s].findIndex(o=>o.id===t);n>=0&&(r[s][n]=i?ot({},r[s][n],e):e)}else r.id===t&&(r[s]=i?ot({},r[s],e):e)})}var I=class r{static registerChart(t,e){r._charts[t]=e}static registerSeries(t,e){r._series[t]=e}static registerComponent(t,e,i){r._components[t]={cmp:e,alwaysCheck:i}}static registerMark(t,e){r._marks[t]=e}static registerRegion(t,e){r._regions[t]=e}static registerTransform(t,e){r.transforms[t]=e}static registerLayout(t,e){r._layout[t]=e}static registerAnimation(t,e){r._animations[t]=e}static registerImplement(t,e){r._implements[t]=e}static registerChartPlugin(t,e){r._chartPlugin[t]=e}static registerComponentPlugin(t,e){r._componentPlugin[t]=e}static createChart(t,e,i){return r._charts[t]?new r._charts[t](e,i):null}static createChartSpecTransformer(t,e){if(!r._charts[t])return null;let i=r._charts[t];return new i.transformerConstructor(Object.assign({seriesType:i.seriesType},e))}static createRegion(t,e,i){return r._regions[t]?new r._regions[t](e,i):null}static createRegionSpecTransformer(t,e){return r._regions[t]?new r._regions[t].transformerConstructor(e):null}static createSeries(t,e,i){return r._series[t]?new r._series[t](e,i):null}static createSeriesSpecTransformer(t,e){return r._series[t]?new r._series[t].transformerConstructor(e):null}static createMark(t,e,i){if(!r._marks[t])return null;let s=new r._marks[t](e,i);return s.type==="group"&&s.setMarkConfig({interactive:!1}),s}static getComponents(){return Object.values(r._components)}static getComponentInKey(t){return r._components[t].cmp}static getLayout(){return Object.values(r._layout)}static getLayoutInKey(t){return r._layout[t]}static getSeries(){return Object.values(r._series)}static getSeriesInType(t){return r._series[t]}static getRegionInType(t){return r._regions[t]}static getAnimationInKey(t){return r._animations[t]}static getImplementInKey(t){return r._implements[t]}static getSeriesMarkMap(t){return r._series[t]?r._series[t].mark:{}}static getChartPlugins(){return Object.values(r._chartPlugin)}static getComponentPlugins(){return Object.values(r._componentPlugin)}static getComponentPluginInType(t){return r._componentPlugin[t]}static registerFormatter(t){this._formatter=t}static getFormatter(){return this._formatter}};I._charts={},I._series={},I._components={},I._marks={},I._regions={},I._animations={},I._implements={},I._chartPlugin={},I._componentPlugin={},I.transforms={fields:mg,filter:YC,fold:jT},I.dataParser={csv:_g,dsv:fg,tsv:vg},I._layout={};function Yu(r,...t){return ot(aV(r),...t.map(aV))}function aV(r){var t;if(!r)return r;let e=q9(r.colorScheme);return Object.assign({},r,{colorScheme:e,token:(t=r.token)!==null&&t!==void 0?t:{},series:Object.assign({},r.series)})}function q9(r){return r&&(r=Object.keys(r).reduce((t,e)=>{let i=r[e];return t[e]=LH(i),t},{})),r}function lV(r,t,e,i){let s=I.getSeriesMarkMap(t);if(!s)return r;let n={};return Object.values(s).forEach(({type:o,name:a})=>{n[a]=ot({},e?.[O(o)[0]],i?.[a],r?.[a])}),Object.assign(Object.assign({},r),n)}var Z9=["animationThreshold","colorScheme","name","padding"];function Xu(r,t,e,i){if(!r)return r;t||(t=r.colorScheme),e||(e=r.token);let s={};return Object.keys(r).forEach(n=>{let o=r[n];Z9.includes(n)?s[n]=o:xi(o)?m_(o)?s[n]=BH(o,t,i):rV(o)?s[n]=iV(e,o):s[n]=Xu(o,t,e,i):s[n]=o}),s}var __={[dA.name]:dA},Ku=dA.name,xd=new Map(Object.keys(__).map(r=>[r,__[r]])),TE=new Map(Object.keys(__).map(r=>[r,Xu(__[r])])),uA=new Map(Object.keys(__).map(r=>[r,r===Ku])),v_=(r,t)=>{if(!r)return;let e=J9(t);xd.set(r,e),TE.set(r,Xu(e)),uA.set(r,!0)},kE=(r=Ku,t=!1)=>(uA.has(r)&&!uA.get(r)&&v_(r,xd.get(r)),t?TE.get(r):xd.get(r)),hV=r=>xd.delete(r)&&TE.delete(r)&&uA.delete(r),dV=r=>!!Z(r)&&xd.has(r),J9=r=>{var t;let e=(t=r.type)!==null&&t!==void 0?t:Ku,i=kE(e);return Yu({},i,r)};var vo=class r{static registerInstance(t){r.instances.set(t.id,t)}static unregisterInstance(t){r.instances.delete(t.id)}static getInstance(t){return r.instances.get(t)}static instanceExist(t){return r.instances.has(t)}static forEach(t,e=[],i){let s=O(e);return r.instances.forEach((n,o,a)=>{s.includes(o)||t(n,o,a)},i)}};vo.instances=new Map;var Dn=class r{static registerTheme(t,e){v_(t,e)}static getTheme(t,e=!1){return kE(t,e)}static removeTheme(t){return hV(t)}static themeExist(t){return dV(t)}static getDefaultTheme(){return r.themes.get(Ku)}static setCurrentTheme(t){r.themeExist(t)&&(r._currentThemeName=t,vo.forEach(e=>e?.setCurrentTheme(t)))}static getCurrentTheme(t=!1){return r.getTheme(r._currentThemeName,t)}static getCurrentThemeName(){return r._currentThemeName}};Dn.themes=xd,Dn._currentThemeName=Ku;function ua(r,t){return Z(r)?Dn.themeExist(r)?Dn.getTheme(r,t):{}:ct(r)?r:{}}function pA(r,t={data:e=>e}){if(!r)return r;if(r.constructor===Object){let e={};for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(t[i]){e[i]=t[i](r[i]);continue}e[i]=pA(r[i],t)}return e}return H(r)?r.map(e=>pA(e,t)):r}function mA(r,t){if(!r)return r;if(xi(r)){let e={};for(let i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(Z(r[i])&&t.getFunction(r[i])){e[i]=t.getFunction(r[i]);continue}e[i]=mA(r[i],t)}return e}return H(r)?r.map(e=>mA(e,t)):r}var Q9=(r,t,e)=>yu(r,t,e,{fontFamily:f_.fontFamily,fontSize:f_.fontSize}),gA=(r,t,e,i)=>Q9(t,e,i).measure(r);var A$t=`${et}_MEASURE_CANVAS_ID`,$e=`${et}_DEFAULT_DATA_INDEX`,ki=`${et}_DEFAULT_DATA_KEY`,ui=`${et}_DEFAULT_DATA_SERIES_FIELD`,ME=`${et}_DEFAULT_SERIES_STYLE_NAME`,cV=`${et}_STACK_KEY`,zi=`${et}_STACK_START`,pi=`${et}_STACK_END`,os=`${et}_STACK_START_PERCENT`,Kr=`${et}_STACK_END_PERCENT`,y_=`${et}_STACK_START_OffsetSilhouette`,x_=`${et}_STACK_END_OffsetSilhouette`,$u=`${et}_STACK_TOTAL`,uV=`${et}_STACK_TOTAL_PERCENT`,pa=`${et}_STACK_TOTAL_TOP`,fA=`${et}_STACK_TOTAL_BOTTOM`,qu=`${et}_MOSAIC_VALUE_START_PERCENT`,Zu=`${et}_MOSAIC_VALUE_END_PERCENT`,Ju=`${et}_MOSAIC_CAT_START_PERCENT`,Qu=`${et}_MOSAIC_CAT_END_PERCENT`,tp=`${et}_SEGMENT_START`,_A=`${et}_SEGMENT_END`;function ma(r,t){for(let e=0;e<t.length;e++){let i=t[e],s=tK(r,i.key);s?s.operations=[...new Set(s.operations.concat(i.operations))]:r.push(i)}return r}function tK(r,t){return r.find(e=>e.key===t)}function bd(r,t){var e;if(!r)return t??null;let i=r.getFields();return i&&i[t]?(e=i[t].alias)!==null&&e!==void 0?e:t:t??null}function vA(r,t,e){let i=r.getStackSort(),s={},n=null;return i&&(n={},r.getSeries().forEach(o=>{let a=o.getSeriesField();if(a){let l=o.getRawDataStatisticsByField(a);l.values&&(n[a]||(n[a]={lastIndex:0,sort:{}}),l.values.forEach((h,d)=>{h in n[a].sort||(n[a].sort[h]=n[a].lastIndex,n[a].lastIndex++)}))}})),r.getSeries().forEach(o=>{var a;let l=o.getStackData(),h=o.getStackValue(),d=o.getStackValueField(),c=!e||e(o);l&&d&&c&&(s[h]=(a=s[h])!==null&&a!==void 0?a:{groupField:l.groupField,nodes:{}},gV(o,l,s[h],d,t,n))}),i?pV(s,n):s}function pV(r,t){var e;for(let i in r)!((e=r[i].sortDatums)===null||e===void 0)&&e.length?(r[i].sortDatums.sort((s,n)=>s.index-n.index),r[i].values=r[i].sortDatums.map(s=>s.datum)):pV(r[i].nodes,t);return r}function DE(r,t){if("values"in r&&r.values.length){let e=Vu(r.values,t),i=p_(r.values,Kr);r.values.forEach(s=>{s[$u]=e,s[uV]=i})}else for(let e in r.nodes)DE(r.nodes[e],t)}function EE(r,t){var e,i;if("values"in r&&r.values.length)A((e=r.values[0])===null||e===void 0?void 0:e[$u])?r.total=(i=r.values[0])===null||i===void 0?void 0:i[$u]:r.total=Vu(r.values,t);else{for(let s in r.nodes)EE(r.nodes[s],t);r.nodes&&(r.total=Vu(Object.keys(r.nodes).map(s=>r.nodes[s]),"total"))}}function wE(r,t,e){var i;if(t.groupField&&t.nodes){let s=((i=r.getRawDataStatisticsByField(t.groupField,!1))===null||i===void 0?void 0:i.values)||[],n={key:`${t.groupField}`,values:s.map(o=>{let a=t.nodes[o];return{groupValue:o,value:a.total,end:a.total}})};yA(n,!1,!0,!1,{key:"groupField",start:"start",end:"end",startPercent:"startPercent",endPercent:"endPercent"}),n.values.forEach(o=>{t.nodes[o.groupValue].mosaicData=o})}else if("values"in t&&t.values.length&&e&&e.length){let s=e.length,n=0,o=1,a=0,l=1;for(let h=0;h<s;h++)if(h%2==0){let d=o-n;o=n+e[h].endPercent*d,n+=e[h].startPercent*d}else{let d=l-a;l=a+e[h].endPercent*d,a+=e[h].startPercent*d}s%2==0?t.values.forEach(h=>{let d=o-n;h[Qu]=n+d*h[Kr],h[Ju]=n+d*h[os],h[Zu]=l,h[qu]=a}):t.values.forEach(h=>{let d=l-a;h[Zu]=a+d*h[Kr],h[qu]=a+d*h[os],h[Qu]=o,h[Ju]=n})}for(let s in t.nodes)wE(r,t.nodes[s],t.nodes[s].mosaicData?e?[...e,t.nodes[s].mosaicData]:[t.nodes[s].mosaicData]:null)}function mV(r){if(!r.values.length)return;let t=r.values[r.values.length-1][pi]/2;for(let e=0;e<r.values.length;e++)r.values[e][y_]=r.values[e][zi]-t,r.values[e][x_]=r.values[e][pi]-t}function yA(r,t,e,i,s={key:cV,start:zi,end:pi,startPercent:os,endPercent:Kr,max:pa,min:fA}){let n=i&&A(s.min),o=i&&A(s.max);if(r.values.length>0){let a=0,l=0,h=1,d=0,c=null,u=null,p=r.values.length;for(let m=0;m<p;m++){let g=r.values[t?p-1-m:m];d=g[s.end],d>=0?(g[s.start]=a,a+=g[s.end],g[s.end]=a):(g[s.start]=l,l+=g[s.end],g[s.end]=l),g[s.key]=r.key,o&&(delete g[s.max],(!u||g[s.end]>u[s.end])&&(u=g)),n&&(delete g[s.min],(!c||g[s.start]<c[s.start])&&(c=g))}if(o&&u&&(u[s.max]=!0),n&&c&&(c[s.min]=!0),e)for(let m=0;m<p;m++){let g=r.values[t?p-1-m:m];d=g[s.end];let f=d>=0?a:l;h=d>=0?1:-1,g[s.startPercent]=f===0?0:Math.min(1,g[s.start]/f)*h,g[s.endPercent]=f===0?0:Math.min(1,g[s.end]/f)*h}}for(let a in r.nodes)yA(r.nodes[a],t,e,i,s)}function gV(r,t,e,i,s,n,o){var a;if("values"in t)if(s&&t.values.forEach(l=>l[pi]=lO(l[i])),e.series.push({s:r,values:t.values}),n){let l=r.getSeriesField();t.values.forEach(h=>{e.sortDatums.push({series:r,datum:h,index:l?n[l].sort[h[l]]:0})})}else e.values.push(...t.values);else for(let l in t.nodes){let h=o?`${o}_${l}`:l;e.nodes[l]||(e.nodes[l]={values:[],series:[],nodes:{},sortDatums:[],key:h},A((a=t.nodes[l])===null||a===void 0?void 0:a.groupField)&&(e.nodes[l].groupField=t.nodes[l].groupField)),gV(r,t.nodes[l],e.nodes[l],i,s,n,h)}}var PE=(r,t,e="key",i="children")=>{for(let s=0;s<r.length;s++){let n=r[s];if(n[e]===t)return n;if(n[i]){let o=PE(n[i],t,e,i);if(o)return o}}return null},RE=(r,t,e="key",i="children")=>{for(let s=0;s<r.length;s++){let n=r[s];if(n[i])for(let o=0;o<n[i].length;o++){let a=n[i][o];if(a[e]===t)return n;let l=RE([a],t,e,i);if(l)return l}}return null},fV=(r,t,e="key",i="children")=>{let s=[],n=(o,a)=>{for(let l of o){if(l[e]===t)return s.push(...a,l[e].toString()),!0;if(l[i]){let h=n(l[i],[...a,l[e]]);if(h===!0)return h}}return!1};return n(r,[]),s};function _V(r,t="value",e="children"){return!!ct(r)&&!!r.hasOwnProperty(e)&&Array.isArray(r[e])}function BE(r,t,e,i="value",s="children"){return Array.isArray(r)?r.map(n=>{let o=Object.assign({},n);return Array.isArray(o[s])&&(o[s]=BE(o[s],t,e,i,s)),o}).filter(n=>+n[i]>=t&&+n[i]<=e||n[s]&&n[s].length>0):r}function as(r={}){let t=Object.assign({},r);if(V(r.style)?t.style=(e,i,s,n)=>gt(r.style(e,i,s,n)):st(r.style)||(t.style=gt(r.style)),!st(r.state)){let e={};Object.keys(r.state).forEach(i=>{V(r.state[i])?e[i]=(s,n,o,a)=>gt(r.state[i](s,n,o,a)):st(r.state[i])||(e[i]=gt(r.state[i]))}),t.state=e}return t}function Sd(r){if(st(r))return null;let t={};return Object.keys(r).forEach(e=>{V(r[e])?t[e]=(i,s,n,o)=>gt(r[e](i,s,n,o)):st(r[e])||(t[e]=gt(r[e]))}),t}function vV(r){if(st(r))return null;let t={};return Object.keys(r).forEach(e=>{V(r[e])?t[e]=(i,s,n,o)=>gt(r[e](i.rawValue,s,i,n,o)):st(r[e])||(t[e]=gt(r[e]))}),t}function LE(r,t){if(st(r))return null;let e={};return Object.keys(r).forEach(i=>{V(r[i])?e[i]=r[i](t):e[i]=r[i]}),gt(e)}function gt(r){return r?.angle&&(r.angle=Ut(r.angle)),r}var En;(function(r){r.enter="enter",r.update="update",r.exit="exit",r.group="group",r.connectNulls="connectNulls"})(En||(En={}));var qe;(function(r){r.enter="enter",r.update="update",r.exit="exit",r.unChange="unChange"})(qe||(qe={}));var ht;(function(r){r.arc="arc",r.arc3d="arc3d",r.area="area",r.image="image",r.line="line",r.path="path",r.rect="rect",r.rect3d="rect3d",r.rule="rule",r.shape="shape",r.symbol="symbol",r.text="text",r.richtext="richtext",r.polygon="polygon",r.pyramid3d="pyramid3d",r.circle="circle",r.cell="cell",r.interval="interval",r.group="group",r.glyph="glyph",r.component="component",r.largeRects="largeRects",r.largeSymbols="largeSymbols"})(ht||(ht={}));var mi;(function(r){r.axis="axis",r.grid="grid",r.legend="legend",r.slider="slider",r.label="label",r.datazoom="datazoom",r.player="player",r.title="title",r.scrollbar="scrollbar"})(mi||(mi={}));var yV;(function(r){r[r.player=1]="player",r[r.rollUp=2]="rollUp",r[r.drillDown=3]="drillDown",r[r.slider=4]="slider",r[r.datazoom=5]="datazoom",r[r.legend=6]="legend",r[r.scrollbar=7]="scrollbar",r[r.brush=8]="brush",r[r.normal=9]="normal"})(yV||(yV={}));var Zs;(function(r){r.lineAxis="lineAxis",r.circleAxis="circleAxis"})(Zs||(Zs={}));var Li;(function(r){r.lineAxisGrid="lineAxisGrid",r.circleAxisGrid="circleAxisGrid"})(Li||(Li={}));var xV;(function(r){r.discreteLegend="discreteLegend",r.colorLegend="colorLegend",r.sizeLegend="sizeLegend"})(xV||(xV={}));var bV;(function(r){r.lineCrosshair="lineCrosshair",r.rectCrosshair="rectCrosshair",r.sectorCrosshair="sectorCrosshair",r.circleCrosshair="circleCrosshair",r.polygonCrosshair="polygonCrosshair",r.ringCrosshair="ringCrosshair"})(bV||(bV={}));var SV;(function(r){r.symbolLabel="symbolLabel",r.rectLabel="rectLabel",r.lineLabel="lineLabel",r.dataLabel="dataLabel"})(SV||(SV={}));var AV;(function(r){r.continuousPlayer="continuousPlayer",r.discretePlayer="discretePlayer"})(AV||(AV={}));var wn;(function(r){r.before="before",r.layouting="layouting",r.reevaluate="reevaluate",r.after="after"})(wn||(wn={}));var pt;(function(r){r.BEFORE_EVALUATE_DATA="beforeEvaluateData",r.AFTER_EVALUATE_DATA="afterEvaluateData",r.BEFORE_EVALUATE_SCALE="beforeEvaluateScale",r.AFTER_EVALUATE_SCALE="afterEvaluateScale",r.BEFORE_PARSE_VIEW="beforeParseView",r.AFTER_PARSE_VIEW="afterParseView",r.BEFORE_TRANSFORM="beforeTransform",r.AFTER_TRANSFORM="afterTransform",r.BEFORE_CREATE_VRENDER_STAGE="beforeCreateVRenderStage",r.AFTER_CREATE_VRENDER_STAGE="afterCreateVRenderStage",r.BEFORE_CREATE_VRENDER_LAYER="beforeCreateVRenderLayer",r.AFTER_CREATE_VRENDER_LAYER="afterCreateVRenderLayer",r.BEFORE_STAGE_RESIZE="beforeStageResize",r.AFTER_STAGE_RESIZE="afterStageResize",r.BEFORE_VRENDER_DRAW="beforeVRenderDraw",r.AFTER_VRENDER_DRAW="afterVRenderDraw",r.BEFORE_MARK_JOIN="beforeMarkJoin",r.AFTER_MARK_JOIN="afterMarkJoin",r.BEFORE_MARK_UPDATE="beforeMarkUpdate",r.AFTER_MARK_UPDATE="afterMarkUpdate",r.BEFORE_MARK_STATE="beforeMarkState",r.AFTER_MARK_STATE="afterMarkState",r.BEFORE_MARK_ENCODE="beforeMarkEncode",r.AFTER_MARK_ENCODE="afterMarkEncode",r.BEFORE_DO_LAYOUT="beforeDoLayout",r.AFTER_DO_LAYOUT="afterDoLayout",r.BEFORE_MARK_LAYOUT_END="beforeMarkLayoutEnd",r.AFTER_MARK_LAYOUT_END="afterMarkLayoutEnd",r.BEFORE_DO_RENDER="beforeDoRender",r.AFTER_DO_RENDER="afterDoRender",r.BEFORE_MARK_RENDER_END="beforeMarkRenderEnd",r.AFTER_MARK_RENDER_END="afterMarkRenderEnd",r.BEFORE_CREATE_VRENDER_MARK="beforeCreateVRenderMark",r.AFTER_CREATE_VRENDER_MARK="afterCreateVRenderMark",r.BEFORE_ADD_VRENDER_MARK="beforeAddVRenderMark",r.AFTER_ADD_VRENDER_MARK="afterAddVRenderMark",r.AFTER_VRENDER_NEXT_RENDER="afterVRenderNextRender",r.BEFORE_ELEMENT_UPDATE_DATA="beforeElementUpdateData",r.AFTER_ELEMENT_UPDATE_DATA="afterElementUpdateData",r.BEFORE_ELEMENT_STATE="beforeElementState",r.AFTER_ELEMENT_STATE="afterElementState",r.BEFORE_ELEMENT_ENCODE="beforeElementEncode",r.AFTER_ELEMENT_ENCODE="afterElementEncode",r.ANIMATION_START="animationStart",r.ANIMATION_END="animationEnd",r.ELEMENT_ANIMATION_START="elementAnimationStart",r.ELEMENT_ANIMATION_END="elementAnimationEnd",r.ALL_ANIMATION_START="allAnimationStart",r.ALL_ANIMATION_END="allAnimationEnd"})(pt||(pt={}));var xA;(function(r){r.signal="signal",r.data="data",r.scale="scale",r.coordinate="coordinate",r.mark="mark"})(xA||(xA={}));var Ad;(function(r){r.active="active",r.selected="selected",r.highlight="highlight",r.blur="blur"})(Ad||(Ad={}));var ga="__vgrammar_scene_item__",CV=[ht.line,ht.area],TV=[ht.arc3d,ht.rect3d,ht.pyramid3d],sr="key",ep=[{}],kV=["key"],MV=!0,DV=!0,EV=!1,wV=null,PV=!0;var RV=1e3,BV=0;var LV=!1,IV="quintInOut";var IE="_mo_hide_";function FE(r,t){return O(r).reduce((e,i)=>{let s=Z(i)?t.getGrammarById(i):i;return s&&e.push(s),e},[])}function eK(r){return!V(r)&&!!r?.signal}function iK(r){return!V(r)&&!!r?.callback}function Pn(r,t){if(T(r))return[];if(eK(r)){let e=r.signal;if(Z(e))return O(t.getGrammarById(e));if(e?.grammarType==="signal")return[e]}else if(iK(r))return FE(r.dependency,t);return[]}function Ml(r){return V(r)||r?.signal||!!r?.callback}function mr(r,t,e,i){if(T(r))return r;if(V(r))return i?r.call(null,e,i,t):r.call(null,e,t);if(r.signal){let s=r.signal;return Z(s)?t?.[s]:s.output()}return r.callback?i?r.callback.call(null,e,i,t):r.callback.call(null,e,t):r}function FV(r,t){if(T(r))return r;if(V(r))return r.call(null,t);if(r.signal){let e=r.signal;return Z(e)?t?.[e]:e.output()}return r.callback?r.callback.call(null,t):r}function ip(r,t){return fa(r)?r.output():t[r]}function OV(r){return r&&(r.signal||r.callback)}var fa=r=>r&&!T(r.grammarType),Dl=r=>V(r)?r:t=>t[r];function b_(r){return!!r?.scale}function S_(r){return!!r?.field}function El(r,t){if(!r)return[];let e=[];return r.scale&&(e=fa(r.scale)?[r.scale]:O(t.getScaleById(r.scale))),e.concat(Pn(r,t))}function OE(r,t){switch(t){case"line":return r.some(e=>["x","y","defined"].includes(e));case"area":return r.some(e=>["x","y","x1","y1","defined"].includes(e));case"largeRects":return r.some(e=>["x","y","width","y1"].includes(e));case"largeSymbols":return r.some(e=>["x","y"].includes(e))}return!1}function HV(r){let{x:t,y:e,x1:i,y1:s}=r;return K(t)&&K(e)&&K(i)&&K(s)?[{x:t,y:e},{x:i,y:s}]:[]}function NV(r,t,e,i){return!r||!r.length||r.length===1&&!t?[]:r.some(s=>OE(Object.keys(s.nextAttrs),"line"))?r.map((s,n)=>{var o;let a=s.nextAttrs,{x:l,y:h,x1:d,y1:c,defined:u}=(o=e?.[n])!==null&&o!==void 0?o:{};return T(a.x)&&(a.x=l),T(a.y)&&(a.y=h),T(a.defined)&&u===!1&&(a.defined=!1),a.context=s.key,i&&(T(a.x1)&&(a.x1=d),T(a.y1)&&(a.y1=c)),a}):e??[]}function VV(r,t,e=[]){if(!r||!r.length||r.length===1&&!t)return[];let i=new Float32Array(4*r.length);return r.forEach((s,n)=>{var o,a,l,h;let d=s.nextAttrs,c=(o=d.x)!==null&&o!==void 0?o:e[4*n],u=(a=d.y)!==null&&a!==void 0?a:e[4*n+1],p=(l=d.width)!==null&&l!==void 0?l:e[4*n+2],m=(h=d.y1)!==null&&h!==void 0?h:e[4*n+3];i[4*n]=c,i[4*n+1]=u,i[4*n+2]=p,i[4*n+3]=m-u}),i}function jV(r,t,e=[]){if(!r||!r.length||r.length===1&&!t)return[];let i=new Float32Array(2*r.length);return r.forEach((s,n)=>{var o,a;let l=s.nextAttrs,h=(o=l.x)!==null&&o!==void 0?o:e[2*n],d=(a=l.y)!==null&&a!==void 0?a:e[2*n+1];i[2*n]=h,i[2*n+1]=d}),i}function zV(r,t){if(["x","y","dx","dy"].includes(t))return!0;switch(r){case ht.arc:return["innerRadius","outerRadius","startAngle","endAngle"].includes(t);case ht.group:case ht.rect:case ht.image:return["width","height","y1"].includes(t);case ht.path:case ht.shape:return["path","customPath"].includes(t);case ht.line:return t==="defined";case ht.area:return["x1","y1","defined"].includes(t);case ht.rule:return["x1","y1"].includes(t);case ht.symbol:return t==="size";case ht.polygon:return t==="points";case ht.text:return t==="text"}return!1}function GV(r){return[ht.line,ht.area,ht.largeRects,ht.largeSymbols].includes(r)}function yo(r,t,e,i,s){e&&(Ml(e)?t.forEach(n=>{let o=mr(e,i,n.datum,r);Object.assign(n.nextAttrs,o)}):Object.keys(e).forEach(n=>{var o,a;let l=e[n],h=s&&!zV(r.mark.markType,n)?[t[0]]:t;if(b_(l)){let d=ip(l.scale,i),c=(o=l?.offset)!==null&&o!==void 0?o:0,u=!T(l.band)&&d.bandwidth?d.bandwidth()*l.band:null,p=Z(l?.field),m=p?Ur(l.field):null,g=p?null:T(l?.value)?0:(a=d.scale)===null||a===void 0?void 0:a.call(d,l.value);h.forEach(f=>{var _;p&&(g=(_=d.scale)===null||_===void 0?void 0:_.call(d,m(f.datum))),f.nextAttrs[n]=J(g)||J(u)?g+c+u:g})}else if(S_(l)){let d=Ur(l.field);h.forEach(c=>{c.nextAttrs[n]=d(c.datum)})}else h.forEach(d=>{d.nextAttrs[n]=mr(l,i,d.datum,r)})}))}function wl(r,t,e,i){if(!r)return null;if(Ml(r))return mr(r,i,t,e);let s={};return Object.keys(r).forEach(n=>{var o,a,l;let h=r[n];if(b_(h)){let d=ip(h.scale,i),c=(o=h?.offset)!==null&&o!==void 0?o:0,u=!T(h.band)&&d.bandwidth?d.bandwidth()*h.band:null,p=Z(h?.field),m=p?Ur(h.field):null,g=p?(a=d.scale)===null||a===void 0?void 0:a.call(d,m(t)):T(h?.value)?0:(l=d.scale)===null||l===void 0?void 0:l.call(d,h.value);s[n]=J(g)||J(u)?g+c+u:g}else if(S_(h)){let d=Ur(h.field);s[n]=d(t)}else s[n]=mr(h,i,t,e)}),s}var bA=class{constructor(t,e,i,s){this.channelEncoder={},this.marks=t,e&&this.registerChannelEncoder(e),i&&this.registerDefaultEncoder(i),this.progressiveChannels&&this.registerProgressiveChannels(s)}getMarks(){return this.marks}registerChannelEncoder(t,e){return Z(t)?this.channelEncoder[t]=e:Object.assign(this.channelEncoder,t),this}registerFunctionEncoder(t){return this.functionEncoder=t,this}registerDefaultEncoder(t){return this.defaultEncoder=t,this}registerProgressiveChannels(t){return this.progressiveChannels=O(t),this}getChannelEncoder(){return this.channelEncoder}getFunctionEncoder(){return this.functionEncoder}getDefaultEncoder(){return this.defaultEncoder}getProgressiveChannels(){return this.progressiveChannels}};var at=class r{static registerPlotMarks(t,e){r._plotMarks[t]=e}static createPlotMark(t,e){return r._plotMarks[t]?new r._plotMarks[t](e):null}static registerMark(t,e){r._marks[t]=e}static createMark(t,e,i){return r._marks[t]?new r._marks[t](e,t,i):null}static hasMark(t){return!!r._marks[t]}static getMark(t){return r._marks[t]}static registerComponent(t,e){r._components[t]=e}static createComponent(t,e,i,s){let n=r._components[t];return n?new n(e,i,s):null}static hasComponent(t){return!!r._components[t]}static registerGraphicComponent(t,e){r._graphicComponents[t]=e}static createGraphicComponent(t,e,i){let s=r._graphicComponents[t];return s?s(e,i):null}static registerTransform(t,e,i){r._transforms[t]=Object.assign(e,{type:t,isBuiltIn:!!i})}static getTransform(t){return r._transforms[t]}static unregisterRuntimeTransforms(){Object.keys(r._transforms).forEach(t=>{r._transforms[t]&&!r._transforms[t].isBuiltIn&&(r._transforms[t]=null)})}static registerGrammar(t,e,i){r._grammars[t]={grammarClass:e,specKey:i??t}}static createGrammar(t,e,i){var s;let n=(s=r._grammars[t])===null||s===void 0?void 0:s.grammarClass;return n?new n(e,i):null}static getGrammars(){return this._grammars}static getGlyph(t){return r._glyphs[t]}static createInteraction(t,e,i){let s=r._interactions[t];return s?new s(e,i):null}static hasInteraction(t){return!!r._interactions[t]}};at._plotMarks={},at._marks={},at._components={},at._graphicComponents={},at._transforms={},at._grammars={},at._glyphs={},at._animations={},at._interactions={},at._graphics={},at._stageEventPlugins={},at.registerGlyph=(r,t,e,i,s)=>(at._glyphs[r]=new bA(t,e,i,s),at._glyphs[r]),at.registerAnimationType=(r,t)=>{at._animations[r]=t},at.getAnimationType=r=>at._animations[r],at.registerInteraction=(r,t)=>{at._interactions[r]=t},at.registerGraphic=(r,t)=>{at._graphics[r]=t},at.getGraphicType=r=>at._graphics[r],at.createGraphic=(r,t)=>{let e=at._graphics[r];return e?e(t):null},at.registerDefaultLayout=r=>{at.defaultLayout=r},at.getDefaultLayout=()=>at.defaultLayout,at.registerStageEventPlugin=(r,t)=>{at._stageEventPlugins[r]=t},at.getStageEventPlugin=r=>at._stageEventPlugins[r];var UV=r=>!!ht[r];function Pl(r,t,e={}){var i;let s=at.getGraphicType(t)?at.createGraphic(t,e):at.createGraphicComponent(t,e,{skipDefault:(i=r?.spec)===null||i===void 0?void 0:i.skipTheme});return s||Nt.getInstance().error(`create ${t} graphic failed!`),s}var Cd=r=>{r&&(r[ga]=null,r.release(),r.parent&&r.parent.removeChild(r))};var HE=["fillOpacity"],NE=(r,t,e)=>{var i;return t==="fillOpacity"?(r.fillOpacity=(i=e.fillOpacity)!==null&&i!==void 0?i:1,["fillOpacity"]):[]};function rK(r,t,e,i,s,n){let o=s.getGraphicAttribute(r,!1,n);if(o)return t.forEach(l=>{l in i&&(o[l]=i[l])}),o;let a={};return t.forEach(l=>{a[l]=i[l]}),e[r]=a,a}var A_={rect3d:[{channels:["x","y","z","x1","y1","width","height","length"],transform:(r,t,e)=>{var i,s,n,o,a,l,h,d,c,u,p,m;K(t.width)||!K(t.x1)&&K(e.width)?(r.x=Math.min((i=e.x)!==null&&i!==void 0?i:0,(s=e.x1)!==null&&s!==void 0?s:1/0),r.width=e.width):K(t.x1)||!K(t.width)&&K(e.x1)?(r.x=Math.min(e.x,e.x1),r.width=Math.abs(e.x1-e.x)):(r.x=Math.min((n=e.x)!==null&&n!==void 0?n:0,(o=e.x1)!==null&&o!==void 0?o:1/0),r.width=e.width),K(t.height)||!K(t.y1)&&K(e.height)?(r.y=Math.min((a=e.y)!==null&&a!==void 0?a:0,(l=e.y1)!==null&&l!==void 0?l:1/0),r.height=e.height):K(t.y1)||!K(t.height)&&K(e.y1)?(r.y=Math.min(e.y,e.y1),r.height=Math.abs(e.y1-e.y)):(r.y=Math.min((h=e.y)!==null&&h!==void 0?h:0,(d=e.y1)!==null&&d!==void 0?d:1/0),r.height=e.height),K(t.length)||!K(t.z1)&&K(e.length)?(r.z=Math.min((c=e.z)!==null&&c!==void 0?c:0,(u=e.z1)!==null&&u!==void 0?u:1/0),r.length=e.length):K(t.z1)||!K(t.length)&&K(e.z1)?(r.z=Math.min(e.z,e.z1),r.length=Math.abs(e.z1-e.z)):(r.z=Math.min((p=e.z)!==null&&p!==void 0?p:0,(m=e.z1)!==null&&m!==void 0?m:1/0),r.length=e.length)},storedAttrs:"sizeAttrs"}],[ht.text]:[{channels:["text","limit","autoLimit","maxLineWidth","textType","_originText"],transform:(r,t,e)=>{var i,s,n,o;let a=(i=e.limit)!==null&&i!==void 0?i:1/0,l=(s=e.autoLimit)!==null&&s!==void 0?s:1/0,h=Math.min(a,l),d=xi(e.text)&&!T(e.text.text),c=d?e.text.text:e.text;Array.isArray(c),r.maxLineWidth=h===1/0?e.maxLineWidth:h,d||e.textType?e.text.type==="rich"||e.textType==="rich"?r.textConfig=c:e.text.type==="html"?(r.html=c,r.text=(n=e._originText)!==null&&n!==void 0?n:"",r.renderable=!1):e.text.type==="react"?(r.react=c,r.text=(o=e._originText)!==null&&o!==void 0?o:"",r.renderable=!1):r.text=c:r.text=c},storedAttrs:"limitAttrs"}],[ht.rule]:[{channels:["x","y","x1","y1"],transform:(r,t,e)=>{let i=HV(e);r.points=i,r.x=0,r.y=0},storedAttrs:"pointAttrs"}],[ht.symbol]:[{channels:["shape","symbolType"],transform:(r,t,e)=>{var i;r.symbolType=(i=t.shape)!==null&&i!==void 0?i:t.symbolType}},{channels:["image","fill","background"],transform:(r,t,e)=>{t.image?(r.background=t.image,r.fill=!1):e.image?(r.background=e.image,r.fill=!1):(r.fill=e.fill,r.background=e.background)},storedAttrs:"imageAttrs"}]};var VE=(r,t,e,i)=>{let s={},n=t?Object.keys(t):[],o=Z(r)?A_[r]:r;if(o&&o.length){let a=[];n.forEach(l=>{let h=!1;o.forEach((d,c)=>{if(d.channels.includes(l)){if(!a[c])if(d.storedAttrs){let u=rK(d.storedAttrs,d.channels,s,t,e,i);d.transform(s,t,u)}else d.transform(s,t,null);a[c]=!0,h=!0}}),h||(HE.includes(l)?NE(s,l,t):s[l]=t[l])})}else n.forEach(a=>{HE.includes(a)?NE(s,a,t):s[a]=t[a]});return s};var sK=(r,t)=>{var e,i;if(r===t)return!0;let s=(e=r&&r.length)!==null&&e!==void 0?e:0;return s===((i=t&&t.length)!==null&&i!==void 0?i:0)&&s!==0&&r.every((n,o)=>!n&&!t[o]||n&&t[o]&&n.color===t[o].color&&n.offset===t[o].offset)},nK=(r,t)=>{if(r===t)return!0;if(typeof r!=typeof t||Z(r)||r.gradient!==t.gradient)return!1;let e=Object.keys(r),i=Object.keys(t);return e.length===i.length&&e.every(s=>s==="stops"?sK(r[s],t[s]):r[s]===t[s])},oK=(r,t)=>r.length===t.length&&r.join("-")===t.join("-"),aK=(r,t,e)=>!(!T(r)||!T(t))||!T(r)&&!T(t)&&(e==="lineDash"?oK(r,t):e==="stroke"||e==="fill"?nK(r,t):r===t),lK=["fill","fillOpacity","background","texture","texturePadding","textureSize","textureColor"],WV=["stroke","strokeOpacity","lineDash","lineDashOffset","lineCap","lineJoin","lineWidth","miterLimit"],hK=lK.concat(WV);function SA(r,t,e){var i;if(!r||r.length<=1)return null;let s=((i=e?.mark)===null||i===void 0?void 0:i.markType)==="area"?hK:WV,n=[],o=null;return r.forEach((a,l)=>{o&&s.every(h=>aK(o[h],a[h],h))||(n.length&&(n[n.length-1].endIndex=l),o=a,n.push({attrs:o,startIndex:l}))}),n.length>=2?n.map(a=>{let l=AA(a.attrs);return l.points=t.slice(a.startIndex,T(a.endIndex)?t.length:a.endIndex),l}):null}function YV(r,t,e){if(!r||r.length<=1)return null;let i=!!e&&e.mark.getSpec().enableSegments,s,n,o=[],a=null;if(r.forEach((l,h)=>{a=t[h],a&&a.defined!==!1?(s||(n={items:[],points:[]},o.push(n)),n.points.push(a),n.items.push(l),s===!1&&(n.isConnect=!0,n={items:[],points:[]},o.push(n)),s=!0):s=!1}),o=o.filter(l=>l.points.length>0),o.length>=2){let l=[];return o.forEach(h=>{if(h.isConnect)return void l.push({points:h.points,isConnect:!0});if(i){let c=SA(h.items,h.points,e);if(c)return void c.forEach(u=>{l.push(u)})}let d=AA(h.items[0]);d.points=h.points,l.push(d)}),l}return i?SA(r,t,e):null}function XV(r){return r?r.reduce((t,e)=>t.concat(e.points),[]):null}function AA(r){let t={};if(!r)return t;let e=["x","y","x1","y1","defined","size","width","height","context"];return Object.keys(r).forEach(i=>{e.includes(i)||(t[i]=r[i])}),t}function KV(r,t){var e;if(!r||!r.segments||!r.segments.length)return r;let i=((e=t?.mark)===null||e===void 0?void 0:e.markType)==="area"?["fillOpacity","strokeOpacity"]:["strokeOpacity"],s={};return Object.keys(r).forEach(n=>{i.includes(n)||(s[n]=r[n])}),s}var CA=class{constructor(t){this.data=null,this.states=[],this.diffState=qe.enter,this.isReserved=!1,this.runtimeStatesEncoder=null,this.items=[],this.getStateAttrs=(e,i)=>{var s,n,o,a;let l=!T((s=this.runtimeStatesEncoder)===null||s===void 0?void 0:s[e]),h=l?Object.assign(Object.assign({},(n=this.mark.getSpec().encode)===null||n===void 0?void 0:n[e]),this.runtimeStatesEncoder[e]):(o=this.mark.getSpec().encode)===null||o===void 0?void 0:o[e];if(!h)return{};if(V(h))return h(this.getDatum(),this,e,i);if(!l&&(!((a=this.graphicItem.states)===null||a===void 0)&&a[e]))return this.graphicItem.states[e];let d=this.items.map(u=>Object.assign({},u,{nextAttrs:{}}));yo(this,d,h,this.mark.parameters());let c=this.transformElementItems(d,this.mark.markType);return this.graphicItem.states?this.graphicItem.states[e]||(this.graphicItem.states[e]=c):this.graphicItem.states={[e]:c},c},this.mark=t}initGraphicItem(t={}){if(this.graphicItem)return;let e=this.mark.getAttributeTransforms();if(this.graphicItem=this.mark.addGraphicItem(e?VE(e,t,this):t,this.groupKey),!this.graphicItem)return;let{graphicName:i}=this.mark.getSpec();Z(i)?this.graphicItem.name=i:V(i)&&(this.graphicItem.name=i(this)),this.graphicItem[ga]=this,e&&(this.graphicItem.onBeforeAttributeUpdate=s=>this.mark?VE(e,s,this):s),this.clearGraphicAttributes(),this.mark.needAnimate()&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(Object.assign({},t)),this.setFinalGraphicAttributes(Object.assign({},t)))}updateGraphicItem(){var t;if(!this.graphicItem)return;this.diffState===qe.exit?this.graphicItem.releaseStatus="willRelease":this.graphicItem.releaseStatus=void 0;let e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");e&&e.length!==0&&(this.graphicItem.stateAnimateConfig=e[0].originConfig)}getGraphicItem(){return this.graphicItem}removeGraphicItem(){var t,e;this.graphicItem&&((e=(t=this.graphicItem.animates)===null||t===void 0?void 0:t.forEach)===null||e===void 0||e.call(t,i=>i.stop())),this.graphicItem&&(Cd(this.graphicItem),this.graphicItem[ga]=null,this.graphicItem=null)}resetGraphicItem(){this.graphicItem&&(this.graphicItem=null)}getBounds(){var t;return(t=this.graphicItem)===null||t===void 0?void 0:t.AABBBounds}getStates(){return this.states}updateData(t,e,i){var s;this.mark.emit(pt.BEFORE_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.data=e;let n=Dl(i);return this.items=e.map(o=>({datum:o,key:n(o),view:this.mark.view,nextAttrs:{}})),this.groupKey=t,this.key=this.mark.isCollectionMark()?t:(s=this.items)===null||s===void 0?void 0:s[0].key,this.mark.emit(pt.AFTER_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.items}state(t,e){var i;let s=this.mark.isCollectionMark(),n=this.states,o=O(mr(t,e,this.getDatum(),this)),a=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;a&&o.length&&o.sort(a);let l=o.length!==n.length||o.some((h,d)=>h!==n[d]);this.states=o,!s&&l&&this.diffState===qe.unChange&&(this.diffState=qe.update)}encodeGraphic(t){this.coordinateTransformEncode(this.items);let e=this.transformElementItems(this.items,this.mark.markType);t&&Object.assign(e,t),this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null,IE in this.graphicItem.attribute&&"visible"in e&&delete this.graphicItem.attribute[IE],this.applyGraphicAttributes(e)):this.initGraphicItem(e),this.diffState!==qe.enter&&this.diffState!==qe.update||!this.states.length||this.useStates(this.states),this.mark.markType===ht.shape&&(this.graphicItem.datum=this.items[0].datum),this.items.forEach(i=>{i.nextAttrs={}}),this._setCustomizedShape()}_setCustomizedShape(){var t;if(!this.graphicItem)return;let e=(t=this.mark.getSpec())===null||t===void 0?void 0:t.setCustomizedShape;e&&(this.graphicItem.pathProxy=i=>e(this.data,i,new ne))}encodeItems(t,e,i=!1,s){let n=this.mark.isCollectionMark(),o=e[En.update],a=e[En.enter],l=e[En.exit],h=this.mark.isLargeMode()||n&&!this.mark.getSpec().enableSegments;this.diffState===qe.enter?(a&&yo(this,t,a,s,h),o&&yo(this,t,o,s,h)):this.diffState===qe.update?((n&&a||i)&&yo(this,t,a,s,h),o&&yo(this,t,o,s,h)):this.diffState===qe.exit&&l&&(i&&yo(this,t,a,s,h),yo(this,t,l,s,h))}coordinateTransformEncode(t){if(!this.mark.coord||this.mark.markType==="arc"||this.mark.disableCoordinateTransform===!0)return;let e=this.mark.coord.output();t.forEach(i=>{let s=i.nextAttrs,n=e.convert(s);Object.assign(s,n)})}hasStateAnimation(){var t;let e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");return e&&e.length>0}clearStates(t){let e=te(t)?t:this.hasStateAnimation();this.states=[],this.graphicItem&&this.graphicItem.clearStates(e),this.runtimeStatesEncoder&&(this.runtimeStatesEncoder={})}_updateRuntimeStates(t,e){this.runtimeStatesEncoder||(this.runtimeStatesEncoder={}),this.runtimeStatesEncoder[t]=e}hasState(t){return this.states&&t&&this.states.includes(t)}updateStates(t){if(!this.graphicItem)return!1;let e=this.states.slice(),i=this.mark.getSpec().encode,s=!1,n=!1;return Object.keys(t).forEach(o=>{var a;if(!o)return;let l=t[o];if(ct(l)&&!Bt(l,(a=this.runtimeStatesEncoder)===null||a===void 0?void 0:a[o]))e.includes(o)?s=!0:e.push(o),this._updateRuntimeStates(o,l),n=!0;else if(l)!e.includes(o)&&i?.[o]&&(e.push(o),n=!0);else if(e.length){let h=e.filter(d=>d!==o);h.length!==e.length&&(n=!0,e=h),this.runtimeStatesEncoder&&this.runtimeStatesEncoder[o]&&(this.runtimeStatesEncoder[o]=null)}}),s&&this.graphicItem.clearStates(),!!n&&(this.useStates(e),!0)}addState(t,e){var i;if(!this.graphicItem)return!1;if(e&&Z(t)&&!Bt(e,(i=this.runtimeStatesEncoder)===null||i===void 0?void 0:i[t])){let o=this.states.slice();return o.includes(t)?this.graphicItem.clearStates():o.push(t),this._updateRuntimeStates(t,e),this.useStates(o),!0}let s=this.mark.getSpec().encode,n=O(t).reduce((o,a)=>(a&&!o.includes(a)&&s?.[a]&&o.push(a),o),this.states.slice());return n.length!==this.states.length&&(this.useStates(n),!0)}removeState(t){if(!this.graphicItem)return!1;let e=O(t);if(!e.length)return!1;let i=this.states.filter(s=>!e.includes(s));return i.length!==this.states.length&&(this.runtimeStatesEncoder&&e.forEach(s=>{this.runtimeStatesEncoder[s]=null}),this.useStates(i),!0)}useStates(t,e){var i;if(!this.graphicItem)return!1;this.mark.emit(pt.BEFORE_ELEMENT_STATE,{states:t},this);let s=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;s&&t.sort(s),this.states=t;let n=te(e)?e:this.hasStateAnimation();return this.graphicItem.stateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,n),this.mark.emit(pt.AFTER_ELEMENT_STATE,{states:t},this),!0}diffAttributes(t){let e={},i=this.getFinalGraphicAttributes();for(let s in t)zn(i,s)&&Bt(i[s],t[s])||(e[s]=t[s]);return e}transformElementItems(t,e,i){var s,n,o,a,l;let h=t[0];if(!h.nextAttrs||Object.keys(h.nextAttrs).length===0)return{};let d=h.nextAttrs;if(GV(e)&&t&&t.length&&T((s=h.nextAttrs)===null||s===void 0?void 0:s.points)&&(i===!0||OE(Object.keys(h.nextAttrs),this.mark.markType))){let c=this.mark.getSpec(),u=this.getGraphicAttribute("points",!1),p=this.getGraphicAttribute("segments",!1),m=c.enableSegments,g=(n=this.mark.getSpec().encode)===null||n===void 0?void 0:n[En.connectNulls],f=t.map(v=>v.nextAttrs),_=this.mark.isProgressive();if(d=AA(d),e===ht.line||e===ht.area){let v=NV(t,!0,u,e===ht.area);if(_)d.segments=((l=(a=(o=this.graphicItem)===null||o===void 0?void 0:o.attribute)===null||a===void 0?void 0:a.segments)!==null&&l!==void 0?l:[]).concat([{points:v}]);else if(g){if(d.segments=YV(f,v,this),d.segments&&d.segments.some(x=>x.isConnect)){let x=wl(g,this.getDatum(),this,this.mark.parameters());x&&d.segments.forEach(y=>{y.isConnect&&Object.assign(y,x)})}d.points=v}else if(m){let x=v&&v.length!==0?v:XV(p),y=SA(f,x,this);y?(d.segments=y,d.points=null):(d.segments=null,d.points=x),d=KV(d,this)}else d.points=v,d.segments=null}else e===ht.largeRects?d.points=VV(t,!0,u):e===ht.largeSymbols&&(d.points=jV(t,!0,u))}return d}applyGraphicAttributes(t){var e,i,s;if(!st(t))if(this.mark.needAnimate()){let n=this.diffAttributes(t),o=(e=this.getPrevGraphicAttributes())!==null&&e!==void 0?e:{},a=(i=this.getFinalGraphicAttributes())!==null&&i!==void 0?i:{};Object.keys(n).forEach(c=>{o[c]=this.getGraphicAttribute(c),a[c]=n[c]}),this.setNextGraphicAttributes(n),this.setPrevGraphicAttributes(o),this.setFinalGraphicAttributes(a);let l=(s=this.mark.animate)===null||s===void 0?void 0:s.getElementAnimators(this).filter(c=>{var u;return!(!((u=c.animationOptions.timeline.controlOptions)===null||u===void 0)&&u.ignoreLoopFinalAttributes)||!c.animationOptions.timeline.loop}),h=(l||[]).reduce((c,u)=>Object.assign(c,u.getEndAttributes()),{}),d=Object.assign({},h,a);this.graphicItem.setAttributes(d)}else this.graphicItem.setAttributes(t)}getGraphicAttribute(t,e=!1){var i;if(!this.graphicItem)return;if(e){let o,a=this.getPrevGraphicAttributes();if(!T(o=ft(a,t)))return o}let s=this.mark.getAttributeTransforms(),n=[t];if(s&&s.length){let o=s.find(a=>a.storedAttrs&&a.channels.includes(t));o&&(n=[o.storedAttrs,t])}return ft((i=this.graphicItem)===null||i===void 0?void 0:i.attribute,n)}setGraphicAttribute(t,e,i=!0){if(!this.graphicItem)return;let s=this.getFinalGraphicAttributes(),n=this.getPrevGraphicAttributes();i&&s&&(s[t]=e),n&&!zn(n,t)&&(n[t]=this.graphicItem.attribute[t]),this.graphicItem.setAttribute(t,e)}setGraphicAttributes(t,e=!0){if(!this.graphicItem)return;let i=this.getFinalGraphicAttributes(),s=this.getPrevGraphicAttributes();Object.keys(t).forEach(n=>{i&&e&&(i[n]=t[n]),s&&!zn(s,n)&&(s[n]=this.graphicItem.attribute[n])}),this.graphicItem.setAttributes(t)}getFinalGraphicAttributes(){return this.graphicItem.finalAttrs}setFinalGraphicAttributes(t){this.graphicItem.finalAttrs=t}getPrevGraphicAttributes(){return this.graphicItem.prevAttrs}setPrevGraphicAttributes(t){this.graphicItem.prevAttrs=t}getNextGraphicAttributes(){return this.graphicItem.nextAttrs}getFinalAnimationAttribute(t){var e,i;return(i=(e=this.getFinalGraphicAttributes())===null||e===void 0?void 0:e[t])!==null&&i!==void 0?i:this.getGraphicAttribute(t)}getFinalAnimationAttributes(){var t;return(t=this.getFinalGraphicAttributes())!==null&&t!==void 0?t:this.graphicItem.attribute}setNextGraphicAttributes(t){this.graphicItem.nextAttrs=t}clearChangedGraphicAttributes(){this.graphicItem&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null))}clearGraphicAttributes(){this.graphicItem&&(this.graphicItem.prevAttrs&&this.setPrevGraphicAttributes(null),this.graphicItem.nextAttrs&&this.setNextGraphicAttributes(null),this.graphicItem.finalAttrs&&this.setFinalGraphicAttributes(null))}remove(){this.graphicItem&&(Cd(this.graphicItem),this.graphicItem=null)}release(){this.removeGraphicItem(),this.mark=null,this.data=null,this.items=null}getItemAttribute(t){var e,i;if(!((e=this.items)===null||e===void 0)&&e.length)return this.mark.isCollectionMark()?T(t)?this.items.map(s=>s.nextAttrs):this.items.map(s=>{var n;return(n=s.nextAttrs)===null||n===void 0?void 0:n[t]}):T(t)?this.items[0].nextAttrs:(i=this.items[0].nextAttrs)===null||i===void 0?void 0:i[t]}setItemAttributes(t){var e;!((e=this.items)===null||e===void 0)&&e.length&&(this.mark.isCollectionMark()?H(t)&&this.items.forEach((i,s)=>{Object.assign(i.nextAttrs,t[s])}):Object.assign(this.items[0].nextAttrs,t))}getItem(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.items)!==null&&t!==void 0?t:[]:(e=this.items)===null||e===void 0?void 0:e[0]}getDatum(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.data)!==null&&t!==void 0?t:[]:(e=this.data)===null||e===void 0?void 0:e[0]}};var rp=class{constructor(t,e){this.references=new Map,this.view=t,this.depend(e?.dependency)}getStartState(){return null}depend(t){this.references.clear(),O(t).map(e=>Z(e)?this.view.getGrammarById(e):e).filter(e=>!T(e)).forEach(e=>{var i;this.references.set(e,((i=this.references.get(e))!==null&&i!==void 0?i:0)+1)})}parameters(){let t={};return this.references.forEach((e,i)=>{A(i.id())&&(t[i.id()]=i.output())}),t}bind(){let t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(H(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.addEventListener(i,e.handler)}):e.type!=="none"&&this.view.addEventListener(e.type,e.handler))})}unbind(){let t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(H(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.removeEventListener(i,e.handler)}):e.type!=="none"&&this.view.removeEventListener(e.type,e.handler))})}start(t){}reset(t){}dispatchEvent(t,e){this.view.emit(`${this.type}:${t}`,e),t==="start"&&this.options.onStart?this.options.onStart(e):t==="reset"&&this.options.onReset?this.options.onReset(e):t==="update"&&this.options.onUpdate?this.options.onUpdate(e):t==="end"&&this.options.onEnd&&this.options.onEnd(e)}};var TA=(r,t)=>{if(!t||!r)return null;let e={};return r.forEach(i=>{let s=i&&i.getSpec(),n=s&&s.encode;n&&t.forEach(o=>{o&&n[o]&&(e[o]||(e[o]=[]),e[o].push(i))})}),e},$V=r=>{let t=O(r),e=[],i=[];return t.forEach(s=>{s==="empty"?e.push("view"):Z(s)&&s!=="none"?s.includes("view:")?(i.push(s.replace("view:","")),e.push("view")):(i.push(s),e.push("self")):J(s)&&e.push("timeout")}),{eventNames:i,resetType:e}};var Rl=class r extends rp{constructor(t,e){super(t,e),this.type=r.type,this._resetType=[],this.resetAll=()=>{let{state:i,reverseState:s}=this.options;this._statedElements&&this._statedElements.length&&(this.clearAllStates(i,s),this.dispatchEvent("reset",{elements:this._statedElements,options:this.options}),this._statedElements=[])},this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;let s=i.element,n=s&&this._marks&&this._marks.includes(s.mark);(this._resetType.includes("view")&&!n||this._resetType.includes("self")&&n)&&this.resetAll()},this.options=Object.assign({},r.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=TA(this._marks,[this.options.state,this.options.reverseState])}getStartState(){return this.options.state}getEvents(){let t=this.options.triggerOff,e=this.options.trigger,i=[{type:e,handler:this.handleStart}],{eventNames:s,resetType:n}=$V(t);return s.forEach(o=>{o&&(H(e)?!e.includes(o):o!==e)&&i.push({type:o,handler:this.handleReset})}),this._resetType=n,i}start(t){let{state:e,reverseState:i,isMultiple:s}=this.options;if(t&&this._marks&&this._marks.includes(t.mark))if(t.hasState(e)){if(this._resetType.includes("self")){let n=this._statedElements&&this._statedElements.filter(o=>o!==t);n&&n.length?this._statedElements=this.updateStates(n,this._statedElements,e,i):this.resetAll()}}else this._timer&&clearTimeout(this._timer),t.addState(e),this._statedElements=this.updateStates(s&&this._statedElements?[...this._statedElements,t]:[t],this._statedElements,e,i),this.dispatchEvent("start",{elements:this._statedElements,options:this.options}),this._resetType.includes("timeout")&&(this._timer=setTimeout(()=>{this.resetAll()},this.options.triggerOff));else this._resetType.includes("view")&&this._statedElements&&this._statedElements.length&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.state,this.options.reverseState]):this.resetAll()}};Rl.type="element-select",Rl.defaultOptions={state:Ad.selected,trigger:"click"};var Bl=class r extends rp{constructor(t,e){super(t,e),this.type=r.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;let s=i.element;if(s){let n=this._marks&&this._marks.includes(s.mark);this._resetType!=="view"||n?this._resetType==="self"&&n&&this.resetAll():this.resetAll()}},this.options=Object.assign({},r.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=TA(this._marks,[this.options.highlightState,this.options.blurState])}getStartState(){return this.options.highlightState}getEvents(){let t=this.options.triggerOff,e=[{type:this.options.trigger,handler:this.handleStart}],i=t;return Z(t)&&t.includes("view:")?(i=t.replace("view:",""),this._resetType="view"):this._resetType="self",e.push({type:i,handler:this.handleReset}),e}resetAll(){let{highlightState:t,blurState:e}=this.options;this._lastElement&&(this.clearAllStates(t,e),this.dispatchEvent("reset",{elements:[this._lastElement],options:this.options}),this._lastElement=null,this._statedElements=null)}start(t){if(t&&this._marks&&this._marks.includes(t.mark)){let{highlightState:e,blurState:i}=this.options;if(this._lastElement===t)return;this._statedElements=this.updateStates([t],this._statedElements,e,i),this._lastElement=t,this.dispatchEvent("start",{elements:[t],options:this.options})}else this._lastElement&&this._resetType==="view"&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}};Bl.type="element-highlight",Bl.defaultOptions={highlightState:Ad.highlight,blurState:Ad.blur,trigger:"pointerover",triggerOff:"pointerout"};var C_=class{updateStates(t,e,i,s){return t&&t.length?(i&&s?e&&e.length?(this.toggleReverseStateOfElements(t,e,s),this.toggleStateOfElements(t,e,i)):this.addBothStateOfElements(t,i,s):i&&(e&&e.length?this.toggleStateOfElements(t,e,i):this.addStateOfElements(t,i)),t):null}toggleReverseStateOfElements(t,e,i){e.forEach(s=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(s.mark)&&s.addState(i)}),t.forEach(s=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(s.mark)&&s.removeState(i)})}toggleStateOfElements(t,e,i){e.forEach(s=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(s.mark)&&s.removeState(i)}),t.forEach(s=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(s.mark)&&s.addState(i)})}addBothStateOfElements(t,e,i){this._marks.forEach(s=>{var n;let o=i&&this._stateMarks[i]&&this._stateMarks[i].includes(s),a=e&&this._stateMarks[e]&&this._stateMarks[e].includes(s);(o||a)&&((n=s.elements)===null||n===void 0||n.forEach(l=>{t&&t.includes(l)?a&&l.addState(e):o&&l.addState(i)}))})}addStateOfElements(t,e){this._marks.forEach(i=>{var s;let n=e&&this._stateMarks[e]&&this._stateMarks[e].includes(i);n&&((s=i.elements)===null||s===void 0||s.forEach(o=>{t&&t.includes(o)&&n&&o.addState(e)}))})}clearAllStates(t,e){this._statedElements&&this._statedElements.length&&this._marks.forEach(i=>{i&&i.elements&&(e&&this._stateMarks[e]&&this._stateMarks[e].includes(i)&&i.elements.forEach(s=>{s.removeState(e)}),t&&this._stateMarks[t]&&this._stateMarks[t].includes(i)&&i.elements.forEach(s=>{this._statedElements.includes(s)&&s.removeState(t)}))})}};var jE=()=>{Ct(Rl,C_),at.registerInteraction(Rl.type,Rl)},zE=()=>{Ct(Bl,C_),at.registerInteraction(Bl.type,Bl)};var qV=(r,t)=>fa(r)?r.output():r&&ct(r)?V(r.callback)?e=>r.callback(e,t):V(r.value)?r.value(t):r:r,ZV=(r,t)=>r&&(ct(r)?Object.keys(r).reduce((e,i)=>{let s=r[i];return e[i]=qV(s,t),e},{}):r.map(e=>qV(e,t)));var dK=-1,Ll=class extends lr.default{constructor(t){super(),this.spec={},this.references=new Map,this.targets=[],this.transforms=[],this.view=t,this.uid=++dK}parse(t){return this.id(t.id),this.name(t.name),this.depend(t.dependency),this}depend(t){var e;if(!((e=this.spec)===null||e===void 0)&&e.dependency){let s=O(this.spec.dependency).map(n=>Z(n)?this.view.getGrammarById(n):n);this.detach(s)}this.spec.dependency=t;let i=O(t).map(s=>Z(s)?this.view.getGrammarById(s):s);return this.attach(i),this.commit(),this}addEventListener(t,e,i){let s=e;return i&&i.trap===!1||(s=e,s.raw=e),i&&i.target&&(s.target=i.target),this.on(t,s),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}emit(t,...e){var i,s;return(s=(i=this.view)===null||i===void 0?void 0:i.emit)===null||s===void 0||s.call(i,t,...e),super.emit(t,...e)}emitGrammarEvent(t,...e){return super.emit(t,...e)}evaluateTransform(t,e,i){if(!t||!t.length)return e;let s=e,n=0,o=t.length;for(;n<o;){let a=t[n];this.emit(pt.BEFORE_TRANSFORM,a.type),s=a.transform(a.isRawOptions?a.options:ZV(a.options,i),s,i,this.view),n++,this.emit(pt.AFTER_TRANSFORM,a.type)}return s}set(t){return!1}id(t){return arguments.length?(this.view.grammars.unrecord(this),this._id=t,this.view.grammars.record(this),this):this._id}name(t){return arguments.length?(this._name=t,this):this._name}attach(t,e=1){return O(t).filter(i=>!T(i)).forEach(i=>{var s;T(t)||(i.targets.includes(this)||i.targets.push(this),this.references.set(i,((s=this.references.get(i))!==null&&s!==void 0?s:0)+e))}),this}detach(t,e=1){return O(t).filter(i=>!T(i)).forEach(i=>{let s=this.references.get(i)-e;s>0?this.references.set(i,s-1):(this.references.delete(i),i.targets.includes(this)&&(i.targets=i.targets.filter(n=>n!==this)))}),this}detachAll(){this.references.forEach((t,e)=>{this.detach(e,t)})}link(t){this.grammarSource=t}run(){var t;let e=(t=this.grammarSource)===null||t===void 0?void 0:t.output(),i=this.parameters();return this.evaluate(e,i)}commit(){this.view.commit(this)}parameters(){let t={};return this.references.forEach((e,i)=>{A(i.id())&&(t[i.id()]=i.output())}),t}getSpec(){return this.spec}reuse(t){return this}clear(){this.spec=null,this.view=null}release(){this.clear()}setFunctionSpec(t,e){return T(this.spec[e])||this.detach(Pn(this.spec[e],this.view)),this.spec[e]=t,this.attach(Pn(t,this.view)),this.commit(),this}};var JV=(r,t,e)=>{var i;if(r==="callback"&&V(t))return{references:[],value:{callback:t,dependency:[]}};if(!T(t.data)){let s=e.getDataById(t.data);return{references:[s],value:s}}if(!T(t.customized)){let s=e.getCustomizedById(t.customized);return{references:[s],value:s}}if(!T(t.scale)){let s=e.getScaleById(t.scale);return{references:[s],value:s}}if(OV(t)){let s=Pn(t,e);return{references:s,value:t.callback?{value:t.callback,dependency:s}:(i=s?.[0])!==null&&i!==void 0?i:t}}return{value:t}},cK=(r,t,e)=>{if(T(t))return{value:t};if(H(t)){let i=t.map(s=>JV(r,s,e));return{references:i.reduce((s,n)=>(n.references&&s.concat(n.references),s),[]),value:i.map(s=>s.value)}}return JV(r,t,e)},uK=(r,t)=>{let e=at.getTransform(r.type);if(!e)return;let i={},s=[];return Object.keys(r).forEach(n=>{var o;if(n==="type")return;let a=r[n];if(n==="dependency")return void(a?.length&&(s=s.concat(FE(a,t))));let l=cK(n,a,t);l&&(!((o=l.references)===null||o===void 0)&&o.length&&(s=s.concat(l.references)),i[n]=l.value)}),{markPhase:e.markPhase,transform:e.transform,canProgressive:e.canProgressive,type:e.type,options:i,references:s}},sp=(r,t)=>{if(r?.length){let e=[],i=[];return r.forEach(s=>{var n;let o=uK(s,t);o&&(!((n=o.references)===null||n===void 0)&&n.length&&(i=i.concat(o.references)),e.push(o))}),{transforms:e,refs:i}}return null};var pK=(r,t={},e)=>{if(!Z(r))return O(r);try{return O(JSON.parse(r))}catch{return[]}},QV={csv:_g,dsv:fg,tsv:vg,json:pK},tj=(r,t)=>{if(!t||!QV[t.type])return O(r);let e=t.type==="dsv"?{delimiter:t.delimiter}:{};return QV[t.type](r,e,new St(new Ar))};var kA=class extends Ll{constructor(t,e,i){super(t),this.grammarType="data",this.spec={},this._dataIDKey=`VGRAMMAR_DATA_ID_KEY_${this.uid}`,this._loadTasks=[],this._postFilters=[],this.ingest=s=>{let n=FV(s.format,this.parameters());return this._input=tj(s.values,n),this._input},this.load=s=>{if(s.values)return this.ingest(s)},this.relay=s=>s[0],this._loadTasks=[],T(e)||this.values(e,i)}parse(t){return super.parse(t),this._isLoaded=!1,this.source(t.source,t.format,!1),this.url(t.url,t.format,!1),this.values(t.values,t.format,!1),this.transform(t.transform),this.parseLoad(t),this.commit(),this}parseDataSource(t){let e=[],i=[],s=t.format?Pn(t.format,this.view)[0]:null;if(s&&e.push(s),t.values){let n=Pn(t.values,this.view)[0];n&&e.push(n),i.push({type:"ingest",transform:this.ingest,isRawOptions:!0,options:{values:t.values,format:t.format}})}else if(t.url){let n=Pn(t.url,this.view)[0];n&&e.push(n),i.push({type:"load",transform:this.load,options:{url:n??t.url,format:s??t.format}})}else if(t.source){let n=[];O(t.source).forEach(o=>{let a=fa(o)?o:this.view.getDataById(o);a&&(e.push(a),n.push(a))}),n.length&&(i.push({type:"relay",transform:this.relay,options:n}),this.grammarSource=n[0])}return{transforms:i,refs:e}}evaluate(t,e){this.view.emit(pt.BEFORE_EVALUATE_DATA);let i=this._isLoaded?this.transforms:this._loadTasks.concat(this.transforms);this.grammarSource&&(this._input=t);let s=this.evaluateTransform(i,this._input,e),n=this._evaluateFilter(s,e);return this.setValues(n),this._isLoaded=!0,this.view.emit(pt.AFTER_EVALUATE_DATA),this}output(){return this._values}getDataIDKey(){return this._dataIDKey}values(t,e,i=!0){let s=Object.assign({},this.spec,{values:t,format:e});return T(t)||(s.url=void 0,s.source=void 0),i?this.parseLoad(s):this}url(t,e,i=!0){let s=Object.assign({},this.spec,{url:t,format:e});return T(t)||(s.values=void 0,s.source=void 0),i?this.parseLoad(s):this}source(t,e,i=!0){let s=Object.assign({},this.spec,{source:t,format:e});return T(t)||(s.values=void 0,s.url=void 0),i?this.parseLoad(s):this}parseLoad(t){this.detach(this.parseDataSource(this.spec).refs),this.spec=t;let e=this.parseDataSource(this.spec);return this.attach(e.refs),this._loadTasks=e.transforms,this._isLoaded=!1,this.commit(),this}setValues(t){this._values=O(t).map((e,i)=>{let s=e===Object(e)?e:{data:e};return s[this._dataIDKey]=i,s})}field(t){return this._values.map(e=>e[t])}transform(t){let e=sp(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]),this.spec.transform=t;let i=sp(this.spec.transform,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.commit(),this}getValue(){return this._values}getInput(){return this._input}addDataFilter(t){return this._postFilters=this._postFilters.concat(O(t)),this._postFilters.sort((e,i)=>{var s,n;return((s=e.rank)!==null&&s!==void 0?s:0)-((n=i.rank)!==null&&n!==void 0?n:0)}),this}removeDataFilter(t){let e=O(t);return this._postFilters=this._postFilters.filter(i=>!e.includes(i)),this}_evaluateFilter(t,e){return this._postFilters.reduce((i,s)=>s.filter(i,e),t)}reuse(t){return t.grammarType!==this.grammarType||(this._isLoaded=!1,this._values=t.output()),this}clear(){super.clear(),this._input=null,this._values=null}};function MA(r,t,e,i){let s,n,o=r[t];for(;t>e&&(n=Math.floor((t-1)/2),s=r[n],o&&s&&i(o,s)<0);)r[t]=s,t=n;return r[t]=o}function GE(r,t,e,i){let s=t,n=e??r.length,o=r[t],a,l=2*t+1;for(;l<n;)a=l+1,a<n&&i(r[l],r[a])>=0&&(l=a),r[t]=r[l],l=2*(t=l)+1;return r[t]=o,MA(r,t,s,i)}var DA=class{constructor(t){this.compare=t,this.nodes=[]}size(){return this.nodes.length}last(){return this.nodes[0]}validate(){for(let t=this.nodes.length-1;t>0;t-=1){let e=Math.floor((t-1)/2);if(this.compare(this.nodes[e],this.nodes[t])>0)return!1}return!0}push(t){if(this.nodes.includes(t)){let e=this.nodes.indexOf(t);return MA(this.nodes,e,0,this.compare),GE(this.nodes,e,null,this.compare)}return this.nodes.push(t),MA(this.nodes,this.nodes.length-1,0,this.compare)}remove(t){if(this.nodes.includes(t)){let e=this.nodes.indexOf(t);this.nodes=this.nodes.slice(0,e).concat(this.nodes.slice(e+1)),MA(this.nodes,e,0,this.compare),GE(this.nodes,e,null,this.compare)}}pop(){let t=this.nodes.pop(),e;return this.nodes.length?(e=this.nodes[0],this.nodes[0]=t,GE(this.nodes,0,null,this.compare)):e=t,e}clear(){this.nodes=[]}};var T_=class{constructor(t){this.list=[],this.ids={},this.idFunc=t||KM}add(t){let e=this.idFunc(t);return this.ids[e]||(this.ids[e]=1,this.list.push(t)),this}remove(t){let e=this.idFunc(t);return this.ids[e]&&(this.ids[e]=0,this.list=this.list.filter(i=>i!==t)),this}forEach(t,e){e?this.list.slice().reverse().forEach(t):this.list.forEach(t)}filter(t){return this.list.filter(t)}get length(){return this.list.length}getElementByIndex(t){return this.list[t]}};var k_=class{constructor(){this.grammars=[],this.logger=Nt.getInstance(),this._curRank=0,this._committed=new T_(t=>t.uid),this._heap=new DA((t,e)=>t?.qrank-e?.qrank),this._beforeRunner=null,this._afterRunner=null,this._updateCounter=0,this._finishFirstRender=!1}add(t){if(t)return this._setRankOfGrammar(t),this.commit(t),!this.grammars.includes(t)&&(this.grammars.push(t),!0)}remove(t){t&&(this._committed.remove(t),this._heap.remove(t),this.grammars=this.grammars.filter(e=>e!==t))}_setRankOfGrammar(t){t&&(t.rank=++this._curRank)}_reRank(t){let e=[t];for(;e.length;){let i=e.pop();this._setRankOfGrammar(i);let s=i.targets;s&&s.forEach(n=>{e.push(n),n===t&&this.logger.error("Cycle detected in dataflow graph.")})}}_enqueue(t){t&&(t.qrank=t.rank,this._heap.push(t))}_logGrammarRunInfo(t){if(this.logger.canLogError()){let e=[{key:"id",value:t.id()},{key:"name",value:t.name()}].reduce((i,s,n)=>T(s.value)?i:`${i}${n?" , ":""}${s.key}: ${s.value}`,"");this.logger.debug("Run Operator: ",t,e)}}hasCommitted(){return!!this._committed.length}commit(t){return this._committed.add(t),this}_beforeEvaluate(){this.grammars.forEach(t=>{t.targets.some(e=>e?.rank<t?.rank)&&this._reRank(t)}),this._committed.forEach(t=>this._enqueue(t)),this._committed=new T_(t=>t.uid)}_enqueueTargets(t){t.targets&&t.targets.length&&this._finishFirstRender&&t.targets.forEach(e=>this._enqueue(e))}evaluate(){if(this._beforeRunner&&this._beforeRunner(this),!this._committed.length)return this.logger.info("Dataflow invoked, but nothing to do."),!1;this._updateCounter+=1;let t,e,i=0;for(this.logger.canLogInfo()&&(e=Date.now(),this.logger.debug(`-- START PROPAGATION (${this._updateCounter}) -----`)),this._beforeEvaluate();this._heap.size()>0;)t=this._heap.pop(),t&&(t.rank===t.qrank?(t.run(),this._logGrammarRunInfo(t),this._enqueueTargets(t),i+=1):this._enqueue(t));return this.logger.canLogInfo()&&(e=Date.now()-e,this.logger.info(`> ${i} grammars updated; ${e} ms`)),this._afterRunner&&this._afterRunner(this),this._finishFirstRender=!0,!0}runBefore(t){this._beforeRunner=t}runAfter(t){this._afterRunner=t}release(){this._heap&&(this._heap.clear(),this._heap=null),this.logger=null,this._committed=null}};var EA=(r,t,e,i,s)=>{let n=o=>{if(s||!o||i&&!i(o)||e.call(null,o),o.markType===ht.group){let a=o[t];a&&a.forEach(l=>{n(l)})}s&&(!o||i&&!i(o)||e.call(null,o))};n(r)};var M_=class{constructor(t){this.handleAfterNextRender=()=>{this._stage&&!this._viewOptions.disableDirtyBounds&&this._stage.enableDirtyBounds(),this._view.emit(pt.AFTER_VRENDER_DRAW),this._view.emit(pt.AFTER_VRENDER_NEXT_RENDER)},this._view=t}initialize(t,e,i,s){return this._width=t,this._height=e,this._viewOptions=i,this._eventConfig=s,this.initStage(),this}stage(){var t;return(t=this._stage)!==null&&t!==void 0?t:null}gestureController(){var t;return(t=this._gestureController)!==null&&t!==void 0?t:null}canvas(){return this._stage?this._stage.window.getNativeHandler().nativeCanvas:null}context(){return this._stage?this._stage.window.getContext().nativeContext:null}combineIncrementalLayers(){return this._stage&&LL(this._stage).then(()=>{this._stage&&this._stage.defaultLayer.combineSubLayer()}),this}background(t){if(this._stage)return this._stage.background=t,this}setDpr(t,e){var i,s;return(s=(i=this._stage)===null||i===void 0?void 0:i.setDpr)===null||s===void 0||s.call(i,t),e&&this.renderNextFrame(),this}shouldResize(t,e){return t!==this._width||e!==this._height}resize(t,e){return this._view.emit(pt.BEFORE_STAGE_RESIZE),this.shouldResize(t,e)&&(this._width=t,this._height=e,this._stage&&this._stage.resize(t,e)),this._view.emit(pt.AFTER_STAGE_RESIZE),this}setViewBox(t,e=!0){return this._stage?(!t||this._viewBox&&t.x1===this._viewBox.x1&&t.x2===this._viewBox.x2&&t.y1===this._viewBox.y1&&t.y2===this._viewBox.y2||(this._viewBox=t,this._stage.setViewBox(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e)),this):this}render(t=!1){return this._view.emit(pt.BEFORE_VRENDER_DRAW),this.initStage(),this._stage.disableDirtyBounds(),this._stage.afterNextRender(this.handleAfterNextRender),t&&(this._stage.render(),this._view.emit(pt.AFTER_VRENDER_DRAW)),this}renderNextFrame(){return this.initStage(),this._stage.renderNextFrame(),this}toCanvas(){return this._stage?this._stage.toCanvas():null}preventRender(t){this._stage&&this._stage.preventRender(t)}release(){var t;this._view.traverseMarkTree(e=>{e.release()}),this._dragController&&this._dragController.release(),this._gestureController&&this._gestureController.release(),this._stage!==((t=this._viewOptions)===null||t===void 0?void 0:t.stage)&&this._stage.release(),this._stage=null,this._layer=null,this._dragController=null,this._gestureController=null}createStage(){var t,e,i,s,n;this._view.emit(pt.BEFORE_CREATE_VRENDER_STAGE);let o=this._viewOptions,a=(t=o.stage)!==null&&t!==void 0?t:yF({width:this._width,height:this._height,renderStyle:o.renderStyle,viewBox:o.viewBox,dpr:o.dpr,canvas:o.renderCanvas,canvasControled:o.canvasControled,container:o.container,title:o.rendererTitle,beforeRender:o.beforeRender,afterRender:o.afterRender,disableDirtyBounds:!0,autoRender:!0,pluginList:o.pluginList,enableHtmlAttribute:o.enableHtmlAttribute,optimize:o.optimize,ticker:o.ticker,supportsTouchEvents:o.supportsTouchEvents,supportsPointerEvents:o.supportsPointerEvents,event:{clickInterval:this._eventConfig.clickInterval,autoPreventDefault:!!this._eventConfig.autoPreventDefault},ReactDOM:o.ReactDOM,autoRefresh:o.autoRefresh});!((e=o.options3d)===null||e===void 0)&&e.enable&&a.set3dOptions(o.options3d),a.enableIncrementalAutoRender(),this._viewBox=o.viewBox,this._view.emit(pt.AFTER_CREATE_VRENDER_STAGE),this._view.emit(pt.BEFORE_CREATE_VRENDER_LAYER);let l=(i=o.layer)!==null&&i!==void 0?i:a.defaultLayer;if(this._view.emit(pt.AFTER_CREATE_VRENDER_LAYER),!((s=this._eventConfig)===null||s===void 0)&&s.drag&&at.getStageEventPlugin("drag")&&(this._dragController=new(at.getStageEventPlugin("drag"))(a)),((n=this._eventConfig)===null||n===void 0?void 0:n.gesture)&&at.getStageEventPlugin("gesture")){let h=ct(this._eventConfig.gesture)?this._eventConfig.gesture:{};this._gestureController=new(at.getStageEventPlugin("gesture"))(a,h)}return{stage:a,layer:l}}initStage(){if(!this._stage){let{stage:t,layer:e}=this.createStage();this._stage=t,this._layer=e;let i=this._view.background();this.background(i)}}};function rj(r){["touches","changedTouches","targetTouches"].forEach(e=>{r[e]&&r[e].length&&Array.from(r[e]).forEach(i=>{ij(i,ej(i),!1)})});let t=ej(r);return ij(r,t)}function ej(r){return T(r.offsetX)?T(r.x)?r.changedTouches&&r.changedTouches.length?fK(r):{canvasX:0,canvasY:0}:gK(r):mK(r)}function mK(r){return{canvasX:r.offsetX,canvasY:r.offsetY}}function gK(r){return{canvasX:r.x,canvasY:r.y}}function fK(r){let t=r.changedTouches[0];return{canvasX:t.x,canvasY:t.y}}function ij(r,t,e=!0){let i=["canvasX","canvasY"];return e&&(i.push("clientX"),i.push("clientY")),i.forEach(s=>{K(t[s])&&Object.defineProperty(r,s,{value:t[s],writable:!0})}),[t.canvasX,t.canvasY]}var wA="window",Td="view",sj="browser";var xo="width",bo="height",kd="viewWidth",Md="viewHeight",Ss="padding",D_="viewBox",Dd="autoFit";var nj="@",oj="#";function E_(r,t,e,i){var s,n;if(i===wA){let a=t.changedTouches?t.changedTouches[0]:t;rj(a)}let o=(s=t.target)===null||s===void 0?void 0:s[ga];if(!o&&i===Td){let a=t.target,l=(n=r.rootMark)===null||n===void 0?void 0:n.graphicItem;for(;a?.parent&&a.parent!==l;)if(a=a.parent,a[ga]){o=a[ga];break}}return t.element=o,t}var PA=class extends Ll{constructor(){super(...arguments),this.grammarType="signal",this.spec={value:null,update:null}}parse(t){return super.parse(t),this.value(t.value),this.update(t.update),this.commit(),this}evaluate(t,e){return this._signal=this.spec.update?mr(this.spec.update,e,this._signal):this.spec.value,this.spec.value=this._signal,this}output(){return this._signal}getValue(){return this.output()}set(t){if(H(t)&&H(this.value)&&t.length===this.value.length){for(let e=0;e<t.length;e++)if(this.value[e]!==t[e])return this._signal=t,this.spec.value=t,!0;return!1}return this._signal!==t&&(this._signal=t,this.spec.value=t,!0)}update(t){return T(t)||this.value(void 0),this.setFunctionSpec(t,"update")}value(t){return T(t)||this.update(void 0),this.spec.value=t,this.commit(),this}reuse(t){return t.grammarType!==this.grammarType||(this._signal=t.output()),this}clear(){super.clear(),this._signal=null}};var _K=-1,UE=[xo,bo,Ss,kd,Md,D_,Dd],aj=(r,t,e)=>{var i,s,n,o,a;return[{id:xo,value:(i=r[xo])!==null&&i!==void 0?i:0},{id:bo,value:(s=r[bo])!==null&&s!==void 0?s:0},{id:Ss,value:Ed((o=(n=r[Ss])!==null&&n!==void 0?n:t[Ss])!==null&&o!==void 0?o:e?.padding)},{id:kd,update:{callback:(l,h)=>{let d=Ed(h[Ss]);return h[xo]-d.left-d.right},dependency:[xo,Ss]}},{id:Md,update:{callback:(l,h)=>{let d=Ed(h[Ss]);return h[bo]-d.top-d.bottom},dependency:[bo,Ss]}},{id:D_,update:{callback:(l,h)=>{let d=Ed(h[Ss]);return(l||new Ye).setValue(d.left,d.top,d.left+h[kd],d.top+h[Md])},dependency:[kd,Md,Ss]}},{id:Dd,value:(a=r[Dd])!==null&&a!==void 0?a:t[Dd]}]},Ed=r=>{var t,e,i,s;return J(r)?{top:r,bottom:r,left:r,right:r}:{top:(t=r?.top)!==null&&t!==void 0?t:0,bottom:(e=r?.bottom)!==null&&e!==void 0?e:0,left:(i=r?.left)!==null&&i!==void 0?i:0,right:(s=r?.right)!==null&&s!==void 0?s:0}},lj=r=>{var t;let e=(i,s)=>{var n,o;i.group=s;let a=(n=i.id)!==null&&n!==void 0?n:"VGRAMMAR_MARK_"+ ++_K;i.id=a,((o=i.marks)!==null&&o!==void 0?o:[]).forEach(l=>e(l,a))};return((t=r.marks)!==null&&t!==void 0?t:[]).forEach(i=>e(i,"root")),r},hj=r=>{var t,e,i,s,n;let{reuse:o=MV,morph:a=DV,morphAll:l=EV,animation:h={},enableExitAnimation:d=PV}=r??{};return{reuse:o,morph:a,morphAll:l,animation:{easing:(t=h.easing)!==null&&t!==void 0?t:IV,delay:(e=h.delay)!==null&&e!==void 0?e:BV,duration:(i=h.duration)!==null&&i!==void 0?i:RV,oneByOne:(s=h.oneByOne)!==null&&s!==void 0?s:LV,splitPath:(n=h.splitPath)!==null&&n!==void 0?n:wV},enableExitAnimation:d}};function dj(r){r.mode&&kt.setEnv(r.mode,r.modeParams||{})}function So(r,t,e){let i=new Map;if(!r||r.length===0)return{keys:[],data:i};if(!t)return i.set(sr,e?r.slice().sort(e):r.slice()),{keys:kV,data:i};let s=Dl(t);if(r.length===1){let o=s(r[0]);return i.set(o,[r[0]]),{keys:[o],data:i}}let n=new Set;return r.forEach(o=>{var a;let l=s(o),h=(a=i.get(l))!==null&&a!==void 0?a:[];h.push(o),i.set(l,h),n.add(l)}),e&&n.forEach(o=>{i.get(o).sort(e)}),{keys:Array.from(n),data:i}}var w_=class{constructor(t,e,i){this.prevData=t?.length?So(t,e??null,i):null}setCurrentData(t){this.currentData=t}getCurrentData(){return this.currentData}doDiff(){if(this.callback)if(this.currentData&&this.prevData){let t=new Map(this.prevData.data);this.currentData.keys.forEach(e=>{this.callback(e,this.currentData.data.get(e),t.get(e)),t.delete(e)}),this.prevData.keys.forEach(e=>{t.has(e)&&this.callback(e,null,t.get(e))})}else this.currentData?this.currentData.keys.forEach(t=>{this.callback(t,this.currentData.data.get(t),null)}):this.prevData&&this.prevData.keys.forEach(t=>{this.callback(t,null,this.prevData.data.get(t))})}setCallback(t){this.callback=t}updateToCurrent(){this.prevData=this.currentData,this.currentData=null}reset(){this.prevData=null}};function cj(r,t,e){let i={enter:[],exit:[],update:[]},s=new w_(r,e);return s.setCallback((n,o,a)=>{T(o)?i.exit.push({prev:a[0]}):T(a)?i.enter.push({next:o[0]}):i.update.push({next:o[0],prev:a[0]})}),s.setCurrentData(So(t,e)),s.doDiff(),i}var Ao=class extends Ll{constructor(t,e,i){super(t),this.grammarType="mark",this.elements=[],this.elementMap=new Map,this.isUpdated=!0,this._isReentered=!1,this.differ=new w_([]),this.markType=e,this.spec.type=e,this.spec.encode={update:{}},this.spec.group=i,i&&(this.group=i,this.attach(i),i.appendChild(this))}parse(t){var e,i,s;if(super.parse(t),this.spec.group){let o=Z(this.spec.group)?this.view.getMarkById(this.spec.group):this.spec.group;this.detach(o)}let n=Z(t.group)?this.view.getMarkById(t.group):t.group;return this.attach(n),this.join((e=t.from)===null||e===void 0?void 0:e.data,t.key,t.sort,t.groupBy,t.groupSort),this.coordinate(t.coordinate),this.state(t.state,this.spec.stateSort),Object.keys((i=this.spec.encode)!==null&&i!==void 0?i:{}).forEach(o=>{this.encodeState(o,{},!0)}),Object.keys((s=t.encode)!==null&&s!==void 0?s:{}).forEach(o=>{this.encodeState(o,t.encode[o])}),this.animation(t.animation),this.animationState(t.animationState),this.morph(t.morph,t.morphKey,t.morphElementKey),this.layout(t.layout),this.configure(t),this.transform(t.transform),this.parseAddition(t),this.spec=t,this.markType=t.type,this.commit(),this}parameters(){var t;return(t=this._finalParameters)!==null&&t!==void 0?t:super.parameters()}parseAddition(t){return this}reuse(t){var e;if(t.grammarType!==this.grammarType)return this;let i=t;return this.markType=i.markType,this.coord=i.coord,this.elementMap=i.elementMap,this.elements=i.elements,this.elementMap.forEach(s=>s.mark=this),this.differ=i.differ,(e=this.reuseAnimate)===null||e===void 0||e.call(this,i),this._context=i._context,this.graphicItem=i.graphicItem,this.graphicIndex=i.graphicIndex,this.graphicParent=i.graphicParent,this.needClear=i.needClear,this.isUpdated=i.isUpdated,this}needLayout(){return!T(this.spec.layout)}handleLayoutEnd(){}handleRenderEnd(){this.needClear&&(this.cleanExitElements(),this.elementMap.forEach(t=>{t.diffState===qe.exit?t.clearGraphicAttributes():t.clearChangedGraphicAttributes()}),this.differ.updateToCurrent(),this.needClear=!1)}evaluateMainTasks(t,e){var i,s;if(this.needSkipBeforeLayout()&&this.view.getLayoutState()===wn.before)return this;let n=(i=this.view.renderer)===null||i===void 0?void 0:i.stage();this.init(n,e);let o=this.evaluateTransform(this._getTransformsBeforeJoin(),t??ep,e),a=o?.progressive;if(a?this.renderContext={large:!1}:(this.evaluateGroup(o),this.renderContext=this.parseRenderContext(o,e)),(s=this.renderContext)===null||s===void 0?void 0:s.progressive)this.differ.reset(),this.elementMap.clear(),this.evaluateProgressive();else{let l=null;if(a){if(this.renderContext.parameters=e,this.renderContext.beforeTransformProgressive=o.progressive,l=o.progressive.output(),o.progressive.canAnimate&&o.progressive.unfinished())return this.update(this.spec),this}else l=o;this.emit(pt.BEFORE_MARK_JOIN),this.evaluateJoin(l),this.emit(pt.AFTER_MARK_JOIN),this.emit(pt.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,e),this.emit(pt.AFTER_MARK_STATE),this.emit(pt.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),e),this.emit(pt.AFTER_MARK_ENCODE)}return this.update(this.spec),this}evaluateGroup(t){if(this.markType===ht.group)return;let e=So(t??ep,this.spec.groupBy,this.spec.groupSort);this._groupEncodeResult=null,this._groupedData=e}_getTransformsAfterEncodeItems(){return this.transforms&&this.transforms.filter(t=>t.markPhase==="afterEncodeItems")}_getTransformsAfterEncode(){return this.transforms&&this.transforms.filter(t=>T(t.markPhase)||t.markPhase==="afterEncode")}_getTransformsBeforeJoin(){return this.transforms?this.transforms.filter(t=>t.markPhase==="beforeJoin"):[]}evaluate(t,e){var i;return this.evaluateMainTasks(t,e),!((i=this.renderContext)===null||i===void 0)&&i.progressive||this.evaluateTransform(this._getTransformsAfterEncode(),this.elements,e),this}output(){return this}join(t,e,i,s,n){return this.grammarSource&&(this.detach(this.grammarSource),this.grammarSource=null),this.spec.from=null,T(t)||(Z(t)?this.grammarSource=this.view.getDataById(t):this.grammarSource=t,this.spec.from={data:t},this.attach(this.grammarSource)),this.spec.key=e,this.spec.sort=i,this.spec.groupBy=s,this.spec.groupSort=n,this.commit(),this}coordinate(t){return Z(t)?this.coord=this.view.getCoordinateById(t):this.coord=t,this.attach(this.coord),this.commit(),this}state(t,e){return this.spec.stateSort=e,this.setFunctionSpec(t,"state")}encode(t,e,i){return this.encodeState(qe.update,t,e,i)}encodeState(t,e,i,s){if(t===qe.enter&&(this._isReentered=!0),this.spec.encode[t]){let n=this.spec.encode[t];if(Ml(n))this.detach(El(n,this.view));else{let o=Z(e);o&&s||!o&&i?(Object.keys(n).forEach(a=>{this.detach(El(n[a],this.view))}),this.spec.encode[t]={}):o?this.detach(El(n[e],this.view)):Object.keys(e).forEach(a=>{this.detach(El(n[a],this.view))})}}return e&&(this.spec.encode[t]||(this.spec.encode[t]={}),Z(e)?(this.spec.encode[t][e]=i,this.attach(El(i,this.view))):Ml(e)?(this.spec.encode[t]=e,this.attach(El(e,this.view))):e&&(Object.assign(this.spec.encode[t],e),Object.values(e).forEach(n=>{this.attach(El(n,this.view))}))),this.commit(),this}_getEncoders(){var t;return(t=this.spec.encode)!==null&&t!==void 0?t:{}}animation(t){return this.spec.animation=t,this}animationState(t){return this.setFunctionSpec(t,"animationState")}layout(t){return this.spec.layout=t,this.commit(),this}morph(t,e,i){return this.spec.morph=t,this.spec.morphKey=e,this.spec.morphElementKey=i,this}transform(t){let e=sp(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]);let i=sp(t,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.spec.transform=t,this.commit(),this}configure(t){let e=["clip","clipPath","zIndex","interactive","context","setCustomizedShape","large","largeThreshold","progressiveStep","progressiveThreshold","support3d","morph","morphKey","morphElementKey","attributeTransforms","skipTheme","enableSegments","stateSort","graphicName","overflow"];return t===null?(e.forEach(i=>{T(this.spec[i])||(this.spec[i]=void 0)}),this):(e.forEach(i=>{T(t[i])||(this.spec[i]=t[i])}),this)}context(t){return this.spec.context=t,this._context=t,this}isCollectionMark(){return CV.includes(this.markType)}needAnimate(){var t;return!(!((t=this.renderContext)===null||t===void 0)&&t.progressive)&&!T(this.spec.animation)}getAllElements(){let t=this.elements.slice();return this.elementMap.forEach(e=>{e.diffState!==qe.exit||t.includes(e)||t.push(e)}),this.spec.sort&&t.sort((e,i)=>this.spec.sort(e.getDatum(),i.getDatum())),t}getScales(){let t={};return this.references.forEach((e,i)=>{i.grammarType===xA.scale&&(t[i.id()]=i.output())}),t}getScalesByChannel(){let t=this.spec.encode;if(!t)return{};let e={},i=this.parameters();return Object.keys(t).forEach(s=>{let n=t[s];n&&!Ml(n)&&Object.keys(n).forEach(o=>{b_(n[o])&&(e[o]=ip(n[o].scale,i))})}),e}getFieldsByChannel(){let t=this.spec.encode;if(!t)return{};let e={};return Object.keys(t).forEach(i=>{let s=t[i];Ml(s)||Object.keys(s).forEach(n=>{S_(s[n])&&(e[n]=s[n].field)})}),e}init(t,e){var i,s,n,o,a;if(this._delegateEvent||(this._delegateEvent=(d,c)=>{let u=E_(this.view,d,c,Td),p=d.element;p?.mark===this&&this.emitGrammarEvent(c,u,p)},this.initEvent()),(i=this.initAnimate)===null||i===void 0||i.call(this,this.spec),!this.group){let d=ip(this.spec.group,e);this.group=d,d&&d.appendChild(this)}let l=this.group?this.group.getGroupGraphicItem():t.defaultLayer,h=(o=(n=(s=this.group)===null||s===void 0?void 0:s.children)===null||n===void 0?void 0:n.indexOf(this))!==null&&o!==void 0?o:0;if(this.markType!==ht.group){if(!this.graphicItem){let d=Pl(this,ht.group,{pickable:!1,zIndex:(a=this.spec.zIndex)!==null&&a!==void 0?a:0,overflow:this.spec.overflow});(this.spec.support3d||TV.includes(this.markType))&&d.setMode("3d"),d.name=`${this.id()||this.markType}`,this.graphicItem=d}this.graphicParent=this.graphicItem,!l||this.graphicIndex===h&&this.graphicItem.parent===l||l.insertIntoKeepIdx(this.graphicItem,h)}else this.graphicParent=l,this.graphicParent.setAttributes({overflow:this.spec.overflow});this.graphicIndex=h}update(t){var e;if(this.emit(pt.BEFORE_MARK_UPDATE),this._context=this.spec.context,this.isUpdated=!0,this.renderContext.progressive||(e=this.updateAnimate)===null||e===void 0||e.call(this,t),this.markType!==ht.group){if(T(t.zIndex)||this.graphicItem.setAttribute("zIndex",t.zIndex),T(t.clip)||this.graphicItem.setAttribute("clip",t.clip),!T(t.clipPath)){let i=H(t.clipPath)?t.clipPath:t.clipPath(this.elements);i&&i.length?this.graphicItem.setAttribute("path",i):this.graphicItem.setAttributes({path:i,clip:!1})}T(t.overflow)||this.graphicItem.setAttribute("overflow",t.overflow),this.elementMap.forEach(i=>{i.updateGraphicItem()})}else this.elementMap.forEach(i=>{i.updateGraphicItem()});this.emit(pt.AFTER_MARK_UPDATE)}createElement(){return new CA(this)}evaluateJoin(t){var e,i,s,n;this.needClear=!0;let o=Dl((s=(e=this.spec.key)!==null&&e!==void 0?e:(i=this.grammarSource)===null||i===void 0?void 0:i.getDataIDKey())!==null&&s!==void 0?s:()=>sr),a=Dl((n=this.spec.groupBy)!==null&&n!==void 0?n:()=>sr),l=this.spec.sort,h=this.isCollectionMark(),d=new Set(this.elements.filter(p=>p.diffState===qe.enter)),c=[];this.differ.setCallback((p,m,g)=>{var f;let _=p,v;if(T(m))v=this.elementMap.get(_),v&&(v.diffState=qe.exit);else if(T(g)){if(v=this.elementMap.has(_)?this.elementMap.get(_):this.createElement(),v.diffState===qe.exit){v.diffState=qe.enter;let y=(f=this.animate)===null||f===void 0?void 0:f.getElementAnimators(v,qe.exit);y&&y.forEach(b=>b.stop("start"))}v.diffState=qe.enter;let x=h?p:a(m[0]);v.updateData(x,m,o),this.elementMap.set(_,v),c.push(v)}else if(v=this.elementMap.get(_),v){v.diffState=qe.update;let x=h?p:a(m[0]);v.updateData(x,m,o),c.push(v)}d.delete(v)});let u=t??ep;h?this.differ.setCurrentData(this._groupedData):this.differ.setCurrentData(So(u,p=>`${a(p)}-${o(p)}`,void 0)),this.differ.doDiff(),d.forEach(p=>{this.elementMap.delete(h?p.groupKey:`${p.groupKey}-${p.key}`),p.remove(),p.release()}),this.elements=c,l&&this.elements.length>=2&&this.elements.sort((p,m)=>l(p.getDatum(),m.getDatum()))}evaluateState(t,e,i){e&&t.forEach(s=>{s.state(e,i)})}evaluateGroupEncode(t,e,i){if(!this._groupedData||!e)return;let s={};return this._groupedData.keys.forEach(n=>{let o=t.find(a=>a.groupKey===n);o&&(s[n]=wl(e,o.items&&o.items[0]&&o.items[0].datum,o,i))}),this._groupEncodeResult=s,s}getChannelsFromConfig(t){let e=this.spec;return T(e.interactive)?null:{pickable:e.interactive}}evaluateEncode(t,e,i,s){let n=this.getChannelsFromConfig();if(e){this.emit(pt.BEFORE_ELEMENT_ENCODE,{encoders:e,parameters:i},this);let o=s?null:this.evaluateGroupEncode(t,e[En.group],i);t.forEach(a=>{this.markType===ht.glyph&&this._groupEncodeResult?a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,n,this._groupEncodeResult[a.groupKey])}):o?.[a.groupKey]&&!this.isCollectionMark()?a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,n,o[a.groupKey])}):n&&a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,n)}),a.encodeItems(a.items,e,this._isReentered,i),this.isCollectionMark()&&o?.[a.groupKey]&&A(o[a.groupKey].defined)&&(a.items.forEach(l=>{l.nextAttrs.defined=o[a.groupKey].defined}),delete o[a.groupKey].defined)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),t,i),t.forEach(a=>{a.encodeGraphic(this.isCollectionMark()?o?.[a.groupKey]:null)}),this.emit(pt.AFTER_ELEMENT_ENCODE,{encoders:e,parameters:i},this)}else t.forEach(o=>{o.initGraphicItem(n)})}addGraphicItem(t,e,i){var s;let n=i??Pl(this,this.markType,t);if(n){if(!((s=this.renderContext)===null||s===void 0)&&s.progressive){let o;if(this._groupedData){let a=this._groupedData.keys.indexOf(e);a>=0&&(o=this.graphicParent.getChildAt(a))}else o=this.graphicParent.at(0);this.isCollectionMark()?(n.incremental=1,o.appendChild(n)):o.incrementalAppendChild(n)}else this.graphicParent.appendChild(n);return n}}parseRenderContext(t,e){let i=this.markType!==ht.group&&this.spec.progressiveStep>0&&this.spec.progressiveThreshold>0&&this.spec.progressiveStep<this.spec.progressiveThreshold,s=this.spec.large&&this.spec.largeThreshold>0&&t.length>=this.spec.largeThreshold;if(i){let n=this._groupedData;return n&&n.keys&&n.keys.some(o=>n.data.get(o).length>this.spec.progressiveThreshold)?{large:s,parameters:e,progressive:{data:t,step:this.spec.progressiveStep,currentIndex:0,totalStep:n.keys.reduce((o,a)=>Math.max(Math.ceil(n.data.get(a).length/this.spec.progressiveStep),o),1),groupedData:n.data}}:{large:s}}return{large:s}}isProgressive(){return this.renderContext&&(!!this.renderContext.progressive||!!this.renderContext.beforeTransformProgressive)}canAnimateAfterProgressive(){return this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.canAnimate()}isDoingProgressive(){return this.renderContext&&(this.renderContext.progressive&&this.renderContext.progressive.currentIndex<this.renderContext.progressive.totalStep||this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.unfinished())}clearProgressive(){this.renderContext&&this.renderContext.progressive&&(this.elements=[],this.graphicParent.children.forEach(t=>{t.incrementalClearChild()}),this.graphicParent.removeAllChild()),this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.release(),this.renderContext=null}restartProgressive(){this.renderContext&&this.renderContext.progressive&&(this.renderContext.progressive.currentIndex=0)}evaluateJoinProgressive(){var t,e,i;let s=this.renderContext.progressive.currentIndex,n=Dl((i=(t=this.spec.key)!==null&&t!==void 0?t:(e=this.grammarSource)===null||e===void 0?void 0:e.getDataIDKey())!==null&&i!==void 0?i:()=>sr),o=[];if(this.isCollectionMark())return this._groupedData.keys.forEach((l,h)=>{let d=this.renderContext.progressive.groupedData.get(l),c=this.renderContext.progressive.step,u=d.slice(s*c,(s+1)*c);if(s===0){let p=this.createElement();p.diffState=qe.enter,p.updateData(l,u,n),o.push(p)}else{let p=this.elements[h];p.updateData(l,u,n),o.push(p)}}),o;let a={};return this._groupedData.keys.forEach(l=>{let h=this.renderContext.progressive.groupedData.get(l),d=this.renderContext.progressive.step,c=h.slice(s*d,(s+1)*d),u=[];c.forEach(p=>{let m=this.createElement();m.diffState=qe.enter,m.updateData(l,[p],n),u.push(m),o.push(m)}),a[l]=u}),{groupElements:a,elements:o}}evaluateEncodeProgressive(t,e,i){let s=this.renderContext.progressive.currentIndex;if(s===0){if(this.evaluateEncode(t,e,i),s===0&&this._groupEncodeResult&&!this.isCollectionMark()&&this.markType!==ht.glyph){let n=t[0],o=n.getGraphicItem(),a=o?.parent;a&&this._groupEncodeResult[n.groupKey]&&a.setTheme({common:this._groupEncodeResult[n.groupKey]})}}else this.evaluateEncode(t,e,i,!0)}evaluateProgressive(){var t,e,i;if(!((t=this.renderContext)===null||t===void 0)&&t.beforeTransformProgressive){let l=this.renderContext.beforeTransformProgressive;l.progressiveRun();let h=l.output();if(l.canAnimate){if(l.unfinished())return;this.evaluateGroup(h)}return this.emit(pt.BEFORE_MARK_JOIN),this.evaluateJoin(h),this.emit(pt.AFTER_MARK_JOIN),this.emit(pt.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,this.renderContext.parameters),this.emit(pt.AFTER_MARK_STATE),this.emit(pt.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),this.renderContext.parameters),void this.emit(pt.AFTER_MARK_ENCODE)}if(!(!((e=this.renderContext)===null||e===void 0)&&e.progressive))return;let s=this.renderContext.parameters;this.emit(pt.BEFORE_MARK_JOIN);let n=this.evaluateJoinProgressive(),o=Array.isArray(n)?n:n.elements;if(this.emit(pt.AFTER_MARK_JOIN),this.renderContext.progressive.currentIndex===0?(this.graphicParent.removeAllChild(),this._groupedData.keys.forEach(l=>{let h=Pl(this,ht.group,{pickable:!1,zIndex:this.spec.zIndex});h.incremental=this.renderContext.progressive.step,this.graphicParent.appendChild(h)}),this.elements=o):this.elements=this.elements.concat(o),this.emit(pt.BEFORE_MARK_STATE),this.evaluateState(o,this.spec.state,s),this.emit(pt.AFTER_MARK_STATE),this.emit(pt.BEFORE_MARK_ENCODE),Array.isArray(n))this.evaluateEncodeProgressive(o,this._getEncoders(),s);else{let l=n.groupElements;Object.keys(l).forEach(h=>{this.evaluateEncodeProgressive(l[h],this._getEncoders(),s)})}this.emit(pt.AFTER_MARK_ENCODE);let a=(i=this._getTransformsAfterEncode())===null||i===void 0?void 0:i.filter(l=>l.canProgressive===!0);a?.length&&this.evaluateTransform(a,this.elements,s),this.renderContext.progressive.currentIndex+=1}isLargeMode(){return this.renderContext&&this.renderContext.large}cleanExitElements(){this.elementMap.forEach((t,e)=>{t.diffState!==qe.exit||t.isReserved||(this.elementMap.delete(e),t.remove(),t.release())})}getGroupGraphicItem(){if(this.elements&&this.elements[0]&&this.elements[0].getGraphicItem)return this.elements[0].getGraphicItem()}getBounds(){var t;return this.graphicItem?this.graphicItem.AABBBounds:(t=this.getGroupGraphicItem())===null||t===void 0?void 0:t.AABBBounds}getMorphConfig(){var t;return{morph:(t=this.spec.morph)!==null&&t!==void 0&&t,morphKey:this.spec.morphKey,morphElementKey:this.spec.morphElementKey}}getAttributeTransforms(){var t;return(t=this.spec.attributeTransforms)!==null&&t!==void 0?t:A_[this.markType]}getContext(){return this._context}needSkipBeforeLayout(){var t,e;if(((t=this.spec.layout)===null||t===void 0?void 0:t.skipBeforeLayouted)===!0)return!0;let i=this.group;for(;i;){if(((e=i.getSpec().layout)===null||e===void 0?void 0:e.skipBeforeLayouted)===!0)return!0;i=i.group}return!1}initEvent(){if(this._delegateEvent){let t=this.view.renderer.stage();t&&t.on("*",this._delegateEvent)}}releaseEvent(){if(this._delegateEvent){let t=this.view.renderer.stage();t&&t.off("*",this._delegateEvent)}}clear(){var t;this.releaseEvent(),this.transforms=null,this.elementMap=null,this.elements=null,this.graphicItem=null,this.animate=null,(t=this.group)===null||t===void 0||t.removeChild(this),this.group=null,super.clear()}prepareRelease(){var t;this.differ.setCurrentData(null),(t=this.animate)===null||t===void 0||t.stop(),this.elementMap.forEach(e=>e.diffState=qe.exit),this._finalParameters=this.parameters()}release(){this.releaseEvent(),this.elements.forEach(t=>t.release()),this.differ=null,this.elements=[],this.elementMap.clear(),this._finalParameters=null,this.animate&&this.animate.release(),this.graphicItem&&Cd(this.graphicItem),this.detachAll(),super.release()}};var RA=class extends Ao{constructor(t,e){super(t,ht.group,e),this.children=[]}parseRenderContext(){return{large:!1}}appendChild(t){return this.children.push(t),this}removeChild(t){return this.children=this.children.filter(e=>e!==t),this}includesChild(t,e=!0){return!!this.children.includes(t)||!!e&&this.children.some(i=>i.markType===ht.group&&i.includesChild(t,!0))}updateLayoutChildren(){return this.children.length?(this.layoutChildren||(this.layoutChildren=[]),this.layoutChildren=this.children.filter(t=>t.needLayout()),this):this}getAttributeTransforms(){return A_.rect}evaluateJoin(t){if(!this.elements.length){let e=this.createElement();e.updateData(sr,ep,()=>""),this.elements=[e],this.elementMap.set(sr,e)}}getChannelsFromConfig(t){let e=this.spec,i={};if(T(e.clip)||(i.clip=e.clip),T(e.zIndex)||(i.zIndex=e.zIndex),!T(e.clipPath)){let s=V(e.clipPath)?e.clipPath([t]):e.clipPath;s&&s.length?i.path=s:(i.path=null,i.clip=!1)}return T(e.interactive)||(i.pickable=e.interactive),i}evaluateGroupEncode(t,e,i){var s;let n=this.elements[0],o={},a=[Object.assign({},(s=n.items)===null||s===void 0?void 0:s[0],{nextAttrs:o})];return yo(n,a,e,i),this._groupEncodeResult=o,o}evaluateEncode(t,e,i,s){let n=this.getChannelsFromConfig();if(e){this.emit(pt.BEFORE_ELEMENT_ENCODE,{encoders:e,parameters:i},this);let o=s?null:this.evaluateGroupEncode(t,e[En.group],i);t.forEach(a=>{a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,n,o)}),a.encodeItems(a.items,e,this._isReentered,i)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),t,i),t.forEach(a=>{a.encodeGraphic()}),this.emit(pt.AFTER_ELEMENT_ENCODE,{encoders:e,parameters:i},this)}else t.forEach(o=>{o.initGraphicItem(n)})}addGraphicItem(t,e,i){let s=i??Pl(this,this.markType,t);if(s)return this.emit(pt.BEFORE_ADD_VRENDER_MARK,{graphicItem:s}),s.name=`${this.id()||this.markType}`,this.graphicParent.insertIntoKeepIdx(s,this.graphicIndex),this.emit(pt.AFTER_ADD_VRENDER_MARK,{graphicItem:s}),s}};var P_=class{constructor(t,e){this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}},this._size=0,this._mapKey=Z(t)?i=>i[t]:t,this._warning=e}record(t){var e,i;let s=t.grammarType,n=this._mapKey(t);return this._grammarMap[s]?(this._grammars[s].push(t),T(n)||(this._grammarMap[s][n]?(e=this._warning)===null||e===void 0||e.call(this,n,t):this._grammarMap[s][n]=t)):(this._grammars.customized.push(t),T(n)||(this._grammarMap.customized[n]?(i=this._warning)===null||i===void 0||i.call(this,n,t):this._grammarMap.customized[n]=t)),this._size+=1,this}unrecord(t){let e=t.grammarType,i=this._mapKey(t);return this._grammarMap[e]?(this._grammars[e]=this._grammars[e].filter(s=>s!==t),T(i)||this._grammarMap[e][i]!==t||delete this._grammarMap[e][i]):(this._grammars.customized=this._grammars.customized.filter(s=>s!==t),T(i)||this._grammarMap.customized[i]!==t||delete this._grammarMap.customized[i]),this._size-=1,this}size(){return this._size}getSignal(t){var e;return(e=this._grammarMap.signal[t])!==null&&e!==void 0?e:null}getData(t){var e;return(e=this._grammarMap.data[t])!==null&&e!==void 0?e:null}getScale(t){var e;return(e=this._grammarMap.scale[t])!==null&&e!==void 0?e:null}getCoordinate(t){var e;return(e=this._grammarMap.coordinate[t])!==null&&e!==void 0?e:null}getMark(t){var e;return(e=this._grammarMap.mark[t])!==null&&e!==void 0?e:null}getCustomized(t){var e;return(e=this._grammarMap.customized[t])!==null&&e!==void 0?e:null}getGrammar(t){return this._grammarMap.data[t]?this._grammarMap.data[t]:this._grammarMap.signal[t]?this._grammarMap.signal[t]:this._grammarMap.scale[t]?this._grammarMap.scale[t]:this._grammarMap.coordinate[t]?this._grammarMap.coordinate[t]:this._grammarMap.mark[t]?this._grammarMap.mark[t]:this._grammarMap.customized[t]?this._grammarMap.customized[t]:null}getAllSignals(){return this._grammars.signal}getAllData(){return this._grammars.data}getAllScales(){return this._grammars.scale}getAllCoordinates(){return this._grammars.coordinate}getAllMarks(){return this._grammars.mark}getAllCustomized(){return this._grammars.customized}traverse(t){var e;Object.values((e=this._grammars)!==null&&e!==void 0?e:{}).forEach(i=>(i??[]).forEach(s=>{t.call(null,s)}))}find(t){let e=null;return this.traverse(i=>t.call(null,i)===!0&&(e=i,!0)),e}filter(t){let e=[];return this.traverse(i=>{t.call(null,i)===!0&&e.push(i)}),e}clear(){this._size=0,this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}}}release(){this._size=0,this._grammars=null,this._grammarMap=null}},BA=class extends P_{constructor(){super(...arguments),this._markNodes=[]}record(t){if(super.record(t),t.grammarType==="mark"){let e=t,i={mark:e,parent:null,children:[]};this._markNodes.forEach(s=>{let n=s.mark;n.markType===ht.group&&n.includesChild(e,!1)?(s.children.push(i),i.parent=s):e.markType===ht.group&&e.includesChild(n,!1)&&(i.children.push(s),s.parent=i)}),this._markNodes.push(i)}return this}unrecord(t){if(super.unrecord(t),t.grammarType==="mark"){let e=t,i=this._markNodes.find(s=>s.mark===e);this._markNodes.forEach(s=>{s.mark.markType===ht.group&&s.children.includes(i)?(s.children=s.children.filter(n=>n!==i),i.parent=null):e.markType===ht.group&&i.children.includes(s)&&(i.children=i.children.filter(n=>n!==s),s.parent=null)}),this._markNodes=this._markNodes.filter(s=>s!==i)}return this}getAllMarkNodes(){return this._markNodes}clear(){super.clear(),this._markNodes=[]}release(){super.release(),this._markNodes=null}};var R_=class extends Ao{addGraphicItem(t,e){let i=t&&t.limitAttrs,s=i&&(i.textType==="rich"||i.text&&i.text.type==="rich"),n=Pl(this,s?ht.richtext:ht.text,t);return super.addGraphicItem(t,e,n)}release(){super.release()}};R_.markType=ht.text;var vK={label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#89909d",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],start:{x:0,y:0},end:{x:100,y:0},x:0,y:0},yK={title:{space:4,padding:[0,0,0,0],textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1},text:"theta"},label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#6F6F6F",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],startAngle:0,endAngle:2*Math.PI,radius:100,innerRadius:0,center:{x:0,y:0},x:0,y:0},xK={style:{stroke:"#f1f2f5"}},bK={style:{stroke:"#f1f2f5"}},SK={layout:"vertical",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:10,spaceRow:10,shape:{space:4,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",stroke:"#D8D8D8",fillOpacity:.5}}},label:{space:4,style:{fontSize:12,fill:"black",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",fillOpacity:.5}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"},state:{selectedHover:{fillOpacity:.7,fill:"gray"},unSelectedHover:{fillOpacity:.2,fill:"gray"}}},focus:!1,focusIconStyle:{size:10,fill:"#333",cursor:"pointer"},visible:!0,padding:{top:2,bottom:2,left:2,right:2}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!1,items:[{index:0,id:"",label:"",shape:{fill:"#6690F2",stroke:"#6690F2",symbolType:"circle"}}]},AK={title:{visible:!1,text:""},colors:[],layout:"horizontal",railWidth:200,railHeight:8,railStyle:{cornerRadius:5}},CK={title:{visible:!1,text:""},trackStyle:{fill:"#ccc"},layout:"horizontal",align:"bottom",railWidth:200,railHeight:6,min:0,max:1,value:[0,1]},TK={start:{x:0,y:0},end:{x:0,y:0}},kK={start:{x:0,y:0},end:{x:0,y:0},rectStyle:{width:10,height:10}},MK={center:{x:0,y:0},radius:100,startAngle:0,endAngle:Math.PI/6},DK={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI},EK={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI,sides:6},wK={layout:"horizontal",railWidth:200,railHeight:10,railStyle:{cornerRadius:5},range:{draggableTrack:!0},startText:{visible:!0,text:"",space:8},endText:{visible:!0,text:"",space:8},min:0,max:1,value:[0,1]},PK={size:{width:400,height:400},dataLabels:[]},RK={type:"line-data",data:[{text:""}],position:"top",overlap:{avoidBaseMark:!1,clampForce:!1},smartInvert:!1},BK={type:"line",data:[{text:"",data:{}}],position:"start",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},LK={type:"area",data:[{text:"",data:{}}],position:"end",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},IK={type:"rect",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},FK={type:"symbol",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{avoidBaseMark:!0,size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},OK={type:"arc",data:[{text:"",fill:"#606773",data:{}}],width:800,height:600,position:"outside",zIndex:302},HK={data:[{text:"",fill:"#606773",data:{}}],overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},NK={orient:"bottom",showDetail:"auto",brushSelect:!0,start:0,end:1,position:{x:0,y:0},size:{width:500,height:40},previewData:[]},VK={},jK={},zK={},GK={textStyle:{fill:"#21252c"},subtextStyle:{fill:"#606773"}},UK={width:12,height:12,padding:[2,2],railStyle:{fill:"rgba(0, 0, 0, .1)"}},LA={axis:vK,circleAxis:yK,grid:xK,circleGrid:bK,discreteLegend:SK,colorLegend:AK,sizeLegend:CK,lineCrosshair:TK,rectCrosshair:kK,sectorCrosshair:MK,circleCrosshair:DK,polygonCrosshair:EK,slider:wK,dataLabel:PK,pointLabel:HK,lineLabel:BK,areaLabel:LK,rectLabel:IK,symbolLabel:FK,arcLabel:OK,lineDataLabel:RK,datazoom:NK,continuousPlayer:VK,discretePlayer:jK,tooltip:zK,title:GK,scrollbar:UK};var IA={symbol:{shape:"circle",size:8},text:{fontSize:14,fill:"#000000"}};var gr=Object.assign({},LA);gr.axis=Object.assign({},gr.axis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),gr.circleAxis=Object.assign({},gr.circleAxis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),gr.grid=Object.assign({},gr.grid,{style:{stroke:"#404349"}}),gr.circleGrid=Object.assign({},gr.circleGrid,{style:{stroke:"#404349"}}),gr.rectLabel=Object.assign({},gr.rectLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),gr.lineLabel=Object.assign({},gr.lineLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),gr.symbolLabel=Object.assign({},gr.symbolLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),gr.title=Object.assign({},gr.title,{textStyle:{fill:"#fdfdfd"},subtextStyle:{fill:"#888c93"}});var uj={name:"dark",padding:5,background:"#202226",palette:{default:["#5383F4","#7BCF8E","#FF9D2C","#FFDB26","#7568D9","#80D8FB","#1857A3","#CAB0E8","#FF8867","#B9E493","#2CB4A8","#B9E4E3"]},marks:IA,components:gr};var pj={name:"default",padding:5,palette:{default:["#6690F2","#70D6A3","#B4E6E2","#63B5FC","#FF8F62","#FFDC83","#BCC5FD","#A29BFE","#63C4C7","#F68484"]},marks:IA,components:LA};var Co=class r{static registerTheme(t,e){t&&r._themes.set(t,e)}static unregisterTheme(t){r._themes.delete(t)}static getTheme(t){return r._themes.get(t)}static getDefaultTheme(){return r.getTheme("default")}};Co._themes=new Map,Co.registerTheme("default",pj),Co.registerTheme("dark",uj);var np=class extends Ao{constructor(t,e,i,s){super(t,ht.component,i),this._componentDatum={[sr]:0},this.componentType=e,this.spec.type="component",this.spec.componentType=e,this.mode=s,this._updateComponentEncoders()}configureComponent(t){return this.spec.componentConfig=t,this.commit(),this}addGraphicItem(t,e,i){let s=i??at.createGraphicComponent(this.componentType,t,{mode:this.mode,skipDefault:this.spec.skipTheme});return s&&(this.emit(pt.BEFORE_ADD_VRENDER_MARK,{graphicItem:s}),this.graphicParent.appendChild(s),this.emit(pt.AFTER_ADD_VRENDER_MARK,{graphicItem:s})),s}join(t){return super.join(t,sr)}encodeState(t,e,i){return super.encodeState(t,e,i),this._updateComponentEncoders(),this}parseRenderContext(){return{large:!1}}_prepareRejoin(){this._componentDatum[sr]+=1}evaluateJoin(t){return this.spec.key=sr,t?(t[sr]=this._componentDatum[sr],this._componentDatum=t):this._componentDatum={[sr]:this._componentDatum[sr]},super.evaluateJoin([this._componentDatum])}_updateComponentEncoders(){this._encoders=this.spec.encode}_getEncoders(){var t;return(t=this._encoders)!==null&&t!==void 0?t:{}}};var WE=Symbol.for("key"),FA=class{diffGrammar(t,e){return cj(t,e,i=>{var s;return(s=i.id())!==null&&s!==void 0?s:Symbol()})}diffMark(t,e,i){let s={enter:[],exit:[],update:[]},n=[],o=[];t.forEach(c=>{c.markType!==ht.group&&(i.morph&&c.getMorphConfig().morph||i.morphAll||i.reuse)?n.push(c):s.exit.push({prev:[c]})}),e.forEach(c=>{c.markType!==ht.group&&(i.morph&&c.getMorphConfig().morph||i.morphAll||i.reuse)?o.push(c):s.enter.push({next:[c]})});let a=this.diffUpdateByGroup(n,o,c=>c.getMorphConfig().morphKey,c=>c.getMorphConfig().morphKey);n=a.prev,o=a.next,s.update=s.update.concat(a.update);let l=this.diffUpdateByGroup(n,o,c=>c.id(),c=>c.id());n=l.prev,o=l.next,s.update=s.update.concat(l.update);let h=So(n,c=>{var u,p;return(p=(u=c.group)===null||u===void 0?void 0:u.id)===null||p===void 0?void 0:p.call(u)}),d=So(o,c=>{var u,p;return(p=(u=c.group)===null||u===void 0?void 0:u.id)===null||p===void 0?void 0:p.call(u)});return Object.keys(d).forEach(c=>{let u=h.data.get(c),p=d.data.get(c);if(u&&p){for(let m=0;m<Math.max(u.length,p.length);m+=1){let g=u[m],f=p[m];g&&f?s.update.push({prev:[g],next:[f]}):g?s.exit.push({prev:[g]}):f&&s.enter.push({next:[f]})}n=n.filter(m=>!u.includes(m)),o=o.filter(m=>!p.includes(m))}}),n.forEach(c=>s.exit.push({prev:[c]})),o.forEach(c=>s.enter.push({next:[c]})),s}diffUpdateByGroup(t,e,i,s){let n=So(t,d=>{var c;return(c=i(d))!==null&&c!==void 0?c:WE}),o=So(e,d=>{var c;return(c=s(d))!==null&&c!==void 0?c:WE}),a=t,l=e,h=[];return o.keys.forEach(d=>{if(d!==WE){let c=n.data.get(d),u=o.data.get(d);c&&u&&(h.push({prev:c,next:u}),a=a.filter(p=>!c.includes(p)),l=l.filter(p=>!u.includes(p)))}}),{prev:a,next:l,update:h}}};var Js=class extends lr.default{static useRegisters(t){t.forEach(e=>{e()})}constructor(t={},e={}){super(),this._observer=null,this._onResize=Zi((...i)=>{let s=this._getContainerSize();s&&this.resize(s.width,s.height)},100),this.delegateEvent=(i,s)=>{let n=E_(this,i,s,Td);this.emit(s,n,i.element)},this.handleProgressiveFrame=()=>{this._progressiveMarks.length&&this._progressiveMarks.forEach(i=>{i.isDoingProgressive()&&i.evaluateProgressive()}),this.doPreProgressive()},this._config=e,this._options=Object.assign({mode:sj},t),this.initialize()}getGrammarById(t){return this.grammars.getGrammar(t)}getSignalById(t){return this.grammars.getSignal(t)}getDataById(t){return this.grammars.getData(t)}getScaleById(t){return this.grammars.getScale(t)}getCoordinateById(t){return this.grammars.getCoordinate(t)}getMarkById(t){return this.grammars.getMark(t)}getCustomizedById(t){return this.grammars.getCustomized(t)}getGrammarsByName(t){return this.grammars.filter(e=>e.name()===t)}getGrammarsByType(t){return this.grammars.filter(e=>e.grammarType===t)}getMarksByType(t){return this.grammars.getAllMarks().filter(e=>e.markType===t)}getMarksByName(t){return this.grammars.getAllMarks().filter(e=>e.name()===t)}getMarksBySelector(t){if(!t)return null;let e=O(t),i=[];return e.forEach(s=>{if(fa(s))return void i.push(s);if(s[0]===oj){let o=this.getMarkById(s.slice(1));return void(o&&i.push(o))}let n=s[0]===nj?this.getMarksByName(s.slice(1)):UV(s)?this.getMarksByType(s):null;n&&n.length&&n.forEach(o=>{i.push(o)})}),i}updateSignal(t,e){Z(t)&&(t=this.getSignalById(t)),t.set(e),this.commit(t)}signal(t,e){let i=new PA(this);return arguments.length>=1&&i.value(t),arguments.length>=2&&i.update(e),this.grammars.record(i),this._dataflow.add(i),i}data(t){let e=new kA(this,t);return this.grammars.record(e),this._dataflow.add(e),e}scale(t){let e=at.createGrammar("scale",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}coordinate(t){let e=at.createGrammar("coordinate",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}mark(t,e,i){let s=Z(e)?this.getMarkById(e):e,n;switch(t){case ht.group:n=new RA(this,s);break;case ht.glyph:let o=at.getMark(ht.glyph);o&&(n=new o(this,i?.glyphType,s));break;case ht.component:n=at.hasComponent(i?.componentType)?at.createComponent(i?.componentType,this,s,i?.mode):new np(this,i?.componentType,s,i?.mode);break;case ht.text:n=new R_(this,t,s);break;default:n=at.hasMark(t)?at.createMark(t,this,s):new Ao(this,t,s)}return this.grammars.record(n),this._dataflow.add(n),n}group(t){return this.mark(ht.group,t)}glyph(t,e){return this.mark(ht.glyph,e,{glyphType:t})}component(t,e,i="2d"){return this.mark(ht.component,e,{componentType:t,mode:i})}axis(t,e="2d"){return this.mark(ht.component,t,{componentType:mi.axis,mode:e})}grid(t,e="2d"){return this.mark(ht.component,t,{componentType:mi.grid,mode:e})}legend(t){return this.mark(ht.component,t,{componentType:mi.legend})}slider(t){return this.mark(ht.component,t,{componentType:mi.slider})}label(t){return this.mark(ht.component,t,{componentType:mi.label})}datazoom(t){return this.mark(ht.component,t,{componentType:mi.datazoom})}player(t){return this.mark(ht.component,t,{componentType:mi.player})}title(t){return this.mark(ht.component,t,{componentType:mi.title})}scrollbar(t){return this.mark(ht.component,t,{componentType:mi.scrollbar})}customized(t,e){let i=at.createGrammar(t,this,e?.type);if(i)return i.parse(e),this.grammars.record(i),this._dataflow.add(i),i}addGrammar(t){return this.grammars.find(e=>e.uid===t.uid)||(this.grammars.record(t),this._dataflow.add(t),t.parse(t.getSpec()),this._needBuildLayoutTree=!0),this}removeGrammar(t){let e=Z(t)?this.getGrammarById(t):t;return e&&this.grammars.find(i=>i.uid===e.uid)?(e.grammarType==="mark"&&e.prepareRelease(),this._cachedGrammars.record(e),this._dataflow.remove(e),this.grammars.unrecord(e),this._needBuildLayoutTree=!0,this):this}removeAllGrammars(){return this.grammars.traverse(t=>{t.grammarType==="signal"&&UE.includes(t.id())||t.grammarType==="mark"&&t.id()==="root"||this.removeGrammar(t)}),this}removeAllGraphicItems(){return this.traverseMarkTree(t=>{t.graphicItem&&(Cd(t.graphicItem),t.elementMap.forEach(e=>{e.resetGraphicItem()}),t.graphicItem=null)}),this}parseSpec(t){var e,i,s,n,o,a,l,h;if(this.emit(pt.BEFORE_PARSE_VIEW),this._spec=t,lj(t),t.theme?this.theme(t.theme):this.theme(Co.getDefaultTheme()),t.width&&this.width(t.width),t.height&&this.height(t.height),this.padding((i=(e=t.padding)!==null&&e!==void 0?e:this._options.padding)!==null&&i!==void 0?i:this._theme.padding),!this.width()||!this.height()){let c=this._getContainerSize();c&&(this.updateSignal(xo,c.width),this.updateSignal(bo,c.height))}!((s=t.signals)===null||s===void 0)&&s.length&&t.signals.forEach(c=>{this.signal().parse(c)}),!((n=t.data)===null||n===void 0)&&n.length&&t.data.forEach(c=>{this.data(null).parse(c)}),!((o=t.coordinates)===null||o===void 0)&&o.length&&t.coordinates.forEach(c=>{var u;(u=this.coordinate(c.type))===null||u===void 0||u.parse(c)}),!((a=t.scales)===null||a===void 0)&&a.length&&t.scales.forEach(c=>{var u;(u=this.scale(c.type))===null||u===void 0||u.parse(c)});let d=at.getGrammars();return Object.keys(d).forEach(c=>{let{specKey:u}=d[c];t[u]&&t[u].length&&t[u].forEach(p=>{this.customized(c,p)})}),t.marks&&t.marks.length&&t.marks.forEach(c=>{this.parseMarkSpec(c)}),t.events&&t.events.length&&t.events.forEach(c=>{var u;(u=this.event)===null||u===void 0||u.call(this,c)}),t.interactions&&t.interactions.length&&t.interactions.forEach(c=>{this.interaction(c.type,c)}),t.animation===!1?(l=this.animate)===null||l===void 0||l.disable():(h=this.animate)===null||h===void 0||h.enable(),this.emit(pt.AFTER_PARSE_VIEW),this._needBuildLayoutTree=!0,this._layoutState=wn.before,this}updateSpec(t){return this.removeAllInteractions(),this.removeAllGrammars(),this.parseSpec(t)}parseBuiltIn(){aj(this._options,this._config,this.getCurrentTheme()).forEach(t=>{let e=this.signal().parse(t);t.value&&e.set(t.value)}),this.parseMarkSpec({id:"root",type:"group",encode:{enter:{x:0,y:0},update:{width:{signal:"width"},height:{signal:"height"}}}}),this.rootMark=this.getMarkById("root")}parseMarkSpec(t){var e;let i=t.type===ht.glyph?{glyphType:t.glyphType}:t.type===ht.component?{componentType:t.componentType,mode:t.mode}:null;this.mark(t.type,t.group,i).parse(t),(e=t.marks)===null||e===void 0||e.forEach(s=>{this.parseMarkSpec(s)})}theme(t){var e,i,s,n,o,a;Z(t)?this._theme=(e=Co.getTheme(t))!==null&&e!==void 0?e:Co.getDefaultTheme():this._theme=t;let{background:l,padding:h}=(i=this._spec)!==null&&i!==void 0?i:{};return this._theme?(this.background((s=l??this._options.background)!==null&&s!==void 0?s:this._theme.background),this.padding((n=h??this._options.padding)!==null&&n!==void 0?n:this._theme.padding),(a=(o=this.renderer.stage())===null||o===void 0?void 0:o.setTheme)===null||a===void 0||a.call(o,Object.assign({},this._theme.marks))):(this.background(l??this._options.background),this.padding(h??this._options.padding)),this}getCurrentTheme(){return this._theme}setCurrentTheme(t,e=!0){return this.theme(t),this.grammars.getAllMarks().forEach(i=>{i.commit()}),e?(this.evaluate(),this.renderer.render(!0)):this._dataflow.evaluate(),this}background(t){return arguments.length?(this._background=t,this.renderer.background(t),t):this._background}width(t){let e=this.getSignalById(xo);return arguments.length?(this._options.width=t,this.updateSignal(e,t),t):e.output()}height(t){let e=this.getSignalById(bo);return arguments.length?(this._options.height=t,this.updateSignal(e,t),t):e.output()}viewWidth(t){let e=this.getSignalById(kd);if(arguments.length){let i=this.padding();return this.width(t+i.left+i.right),t}return e.output()}viewHeight(t){let e=this.getSignalById(Md);if(arguments.length){let i=this.padding();return this.height(t+i.top+i.bottom),t}return e.output()}padding(t){let e=this.getSignalById(Ss);if(arguments.length){let i=Ed(t);return this.updateSignal(e,i),i}return Ed(e.output())}autoFit(t){let e=this.getSignalById(Dd);return arguments.length?(this.updateSignal(e,t),t):e.output()}getViewBox(){let t=this.getSignalById(D_);return t?.output()}updateLayoutTag(){return this._layoutState=wn.before,this}getLayoutState(){return this._layoutState}buildLayoutTree(){let t={},e=[];this.traverseMarkTree(i=>{t[i.id()]=!0,i.group&&t[i.group.id()]||e.push(i),i.markType===ht.group&&i.updateLayoutChildren()},i=>i.needLayout()),this._layoutMarks=e}doLayout(){var t;let e=this._options.doLayout||at.getDefaultLayout();e&&(!((t=this._layoutMarks)===null||t===void 0)&&t.length)&&(this.emit(pt.BEFORE_DO_LAYOUT),e(this._layoutMarks,this._options,this),this.emit(pt.AFTER_DO_LAYOUT))}handleLayoutEnd(){this.emit(pt.BEFORE_MARK_LAYOUT_END),this._layoutMarks.forEach(t=>{EA(t,"layoutChildren",e=>{e.handleLayoutEnd()},e=>e!==t)}),this.emit(pt.AFTER_MARK_LAYOUT_END)}handleRenderEnd(){this.emit(pt.BEFORE_MARK_RENDER_END),EA(this.rootMark,"children",t=>{t.handleRenderEnd()}),this.emit(pt.AFTER_MARK_RENDER_END)}commit(t){return this._dataflow.commit(t),this}run(t){return this.evaluate(t),this}doRender(t){this.emit(pt.BEFORE_DO_RENDER),this.renderer&&(!this._progressiveMarks&&this.animate?this.animate.animate():this.traverseMarkTree(e=>{e.cleanExitElements()},null,!0),this.renderer.render(t),this.handleRenderEnd()),this.emit(pt.AFTER_DO_RENDER)}evaluate(t){var e,i;let s=hj(t),n=this._cachedGrammars.size()>0;n&&(this.reuseCachedGrammars(s),this.detachCachedGrammar());let o=this._resizeRenderer(),a=this._dataflow.hasCommitted();return n||a||this._layoutState||o?(this.clearProgressive(),this._dataflow.evaluate(),this._needBuildLayoutTree&&(this.buildLayoutTree(),this._needBuildLayoutTree=!1),this._layoutState&&(this._layoutState=wn.layouting,this.doLayout(),this._dataflow.hasCommitted()&&(this._layoutState=wn.reevaluate,this._dataflow.evaluate()),this._layoutState=wn.after,!((e=this._layoutMarks)===null||e===void 0)&&e.length&&this.handleLayoutEnd()),this._layoutState=null,this.findProgressiveMarks(),this._resizeRenderer(),(i=this.morph)===null||i===void 0||i.call(this,s),this.releaseCachedGrammars(s),this.doRender(!0),this.doPreProgressive(),this):this}reuseCachedGrammars(t){if(t.reuse){let e=i=>{i.next.reuse(i.prev),i.prev.detachAll(),i.prev.clear(),this._cachedGrammars.unrecord(i.prev)};this._differ.diffGrammar(this._cachedGrammars.getAllSignals(),this.grammars.getAllSignals().filter(i=>!UE.includes(i.id()))).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllData(),this.grammars.getAllData()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllScales(),this.grammars.getAllScales()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllCoordinates(),this.grammars.getAllCoordinates()).update.forEach(e)}this._differ.diffMark(this._cachedGrammars.getAllMarks(),this.grammars.getAllMarks().filter(e=>e.id()!=="root"),t).update.forEach(e=>{var i;let s=e.prev.length===1&&e.next.length===1&&e.prev[0].markType===e.next[0].markType,n=e.prev.every(o=>o.getMorphConfig().morph)&&e.next.every(o=>o.getMorphConfig().morph);this.morph&&(t.morph&&n||t.morphAll)?(i=this.addMorphMarks)===null||i===void 0||i.call(this,{prev:e.prev,next:e.next}):s&&t.reuse&&(e.next[0].reuse(e.prev[0]),e.prev[0].detachAll(),e.prev[0].clear(),this._cachedGrammars.unrecord(e.prev[0]))})}detachCachedGrammar(){this._cachedGrammars.traverse(t=>{var e,i;if(t.detachAll(),t.grammarType==="mark"){let s=t;(i=(e=s.group)===null||e===void 0?void 0:e.removeChild)===null||i===void 0||i.call(e,s)}})}releaseCachedGrammars(t){this._cachedGrammars.traverse(s=>{s.grammarType!=="mark"&&s.release()});let e=this._cachedGrammars.getAllMarkNodes();e.forEach(s=>{var n;(n=s.mark.animate)===null||n===void 0||n.stop(),t.enableExitAnimation&&this.animate&&this.animate.animateAddition(s.mark)});let i=s=>{if(s.mark.view&&(!s.mark.animate||s.mark.animate.getAnimatorCount()===0)&&(!s.children||s.children.length===0)){s.mark.release();let n=s.parent;n&&(s.parent.children=s.parent.children.filter(o=>o!==s),s.parent=null,i(n))}};e.forEach(s=>{let n=s.mark;n.animate&&n.animate.getAnimatorCount()!==0?n.addEventListener("animationEnd",()=>{n.animate&&n.animate.getAnimatorCount()===0&&i(s)}):i(s)}),this._cachedGrammars.clear()}runAfter(t){return this._dataflow.runAfter(()=>{t.call(null,this)}),this}runBefore(t){return this._dataflow.runBefore(()=>{t.call(null,this)}),this}getImageBuffer(){var t,e;if(this._options.mode!=="node")return void this.logger.error(new TypeError("getImageBuffer() now only support node environment."));let i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t);return i?(i.render(),i.window.getImageBuffer()):(this.logger.error(new ReferenceError("render is not defined")),null)}traverseMarkTree(t,e,i){return EA(this.rootMark,"children",t,e,i),this}_bindResizeEvent(){var t,e,i,s,n,o;if(this.autoFit()){let a=(n=(s=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||s===void 0?void 0:s.getContainer)===null||n===void 0?void 0:n.call(s);if(a){let l=window.ResizeObserver;this._observer=new l(this._onResize),(o=this._observer)===null||o===void 0||o.observe(a)}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this.autoFit()&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}_getContainerSize(){var t,e,i,s,n,o,a,l,h,d,c;let u=(n=(s=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||s===void 0?void 0:s.getContainer)===null||n===void 0?void 0:n.call(s);if(u){let{width:p,height:m}=$m(u);return{width:(l=(a=(o=this._spec)===null||o===void 0?void 0:o.width)!==null&&a!==void 0?a:this._options.width)!==null&&l!==void 0?l:p,height:(c=(d=(h=this._spec)===null||h===void 0?void 0:h.height)!==null&&d!==void 0?d:this._options.height)!==null&&c!==void 0?c:m}}return null}resize(t,e,i=!0){let s=!1;return t!==this.width()&&(s=!0,this.updateSignal(xo,t)),e!==this.height()&&(s=!0,this.updateSignal(bo,e)),s&&(i?this.evaluate({morph:!1}):this._dataflow.evaluate()),this}_resizeRenderer(){let t=this.width(),e=this.height();return!!this.renderer.shouldResize(t,e)&&(this.renderer.resize(t,e),this.emit("resize",{},{width:t,height:e}),!0)}interaction(t,e){let i=at.createInteraction(t,this,e);return i&&(i.bind(),this._boundInteractions||(this._boundInteractions=[]),this._boundInteractions.push(i)),i}removeInteraction(t,e){if(this._boundInteractions){let i=this._boundInteractions.filter(s=>{var n;return T(e)?Z(t)?s.type===t:t?s===t:void 0:((n=s.options)===null||n===void 0?void 0:n.id)===e});i.length&&i.forEach(s=>{s.unbind()})}return this}removeAllInteractions(){return this._boundInteractions&&(this._boundInteractions.forEach(t=>{t.unbind()}),this._boundInteractions=null),this}initializeEventConfig(t){let e=Object.assign({defaults:{}},t),i=(s,n)=>{n.forEach(o=>{H(s[o])&&(s[o]=s[o].reduce((a,l)=>(a[l]=!0,a),{}))})};return i(e.defaults,["prevent","allow"]),i(e,[Td,wA]),e}initEvent(){let t=this.renderer.stage();t&&t.on("*",this.delegateEvent)}releaseStageEvent(){let t=this.renderer.stage();t&&t.off("*",this.delegateEvent)}addEventListener(t,e,i){let s=e;return i&&i.trap===!1||(s=e,s.raw=e),i&&i.target&&(s.target=i.target),this.on(t,s),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}initializeRenderer(){let t=this._options.width,e=this._options.height;this.renderer=new M_(this),this.renderer.initialize(t,e,this._options,this._eventConfig).background(this._background)}initialize(){var t,e;this.grammars=new P_(i=>i.id(),(i,s)=>this.logger.warn(`Grammar id '${i}' has been occupied`,s)),this._cachedGrammars=new BA(i=>i.id()),this._options.logger&&Nt.setInstance(this._options.logger),this.logger=Nt.getInstance((t=this._options.logLevel)!==null&&t!==void 0?t:0),this._dataflow=new k_,this.animate=(e=this.initAnimate)===null||e===void 0?void 0:e.call(this,this),this._differ=new FA,this._options.hooks&&(Object.keys(this._options.hooks).forEach(i=>{this.on(i,this._options.hooks[i])}),this.hooks=this._options.hooks),this.container=null,this.renderer=null,this._eventListeners=[],this._eventConfig=this.initializeEventConfig(this._options.eventConfig),this._theme=this._options.disableTheme?null:Co.getDefaultTheme(),this.parseBuiltIn(),dj(this._options),this.initializeRenderer(),this._eventConfig.disable||this.initEvent(),this._bindResizeEvent(),this._needBuildLayoutTree=!0,this._layoutState=wn.before,this.theme(this._theme)}pauseProgressive(){return!1}resumeProgressive(){return!1}restartProgressive(){return!1}findProgressiveMarks(){let t=[];return this.traverseMarkTree(e=>{t.push(e)},e=>e.markType!==ht.group&&e.isProgressive()),t.length?(this._progressiveMarks=t,this.renderer&&this.renderer.combineIncrementalLayers(),t):(this._progressiveMarks=null,null)}doPreProgressive(){if(this._progressiveMarks&&this._progressiveMarks.some(t=>t.isDoingProgressive())){let t=kt.getRequestAnimationFrame();this._progressiveRafId=t(this.handleProgressiveFrame)}else this._progressiveMarks&&this.animate&&this._progressiveMarks.every(t=>t.canAnimateAfterProgressive())?this.animate.animate():this._progressiveMarks&&(this._progressiveMarks=null)}clearProgressive(){this._progressiveRafId&&kt.getCancelAnimationFrame()(this._progressiveRafId),this._progressiveMarks&&this._progressiveMarks.length&&(this._progressiveMarks.forEach(t=>{t.clearProgressive()}),this._progressiveMarks=null)}release(){var t,e,i,s;this.removeAllInteractions(),this.releaseStageEvent(),this._unBindResizeEvent(),this.clearProgressive(),at.unregisterRuntimeTransforms(),Nt.setInstance(null),(t=this.animate)===null||t===void 0||t.stop(),this.grammars.release(),this._cachedGrammars.release(),this._dataflow.release(),this._dataflow=null,(i=(e=this.renderer)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),this.renderer=null,this._boundInteractions=null,this.removeAllListeners(),(s=this._eventListeners)===null||s===void 0||s.forEach(n=>{n.source.removeEventListener(n.type,n.handler)}),this._eventListeners=null}};var mj=()=>{If(),sa(),at.registerGraphic(ht.arc,ll),L3()};var gj=()=>{If(),_e(),at.registerGraphic(ht.group,qo)};var fj=()=>{If(),na(),at.registerGraphic(ht.path,Dx)},_j=()=>{If(),rs(),B3(),at.registerGraphic(ht.rect,cr)};var op=class extends np{parseAddition(t){return super.parseAddition(t),this.scale(t.scale),this}scale(t){if(this.spec.scale){let i=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(i),this.spec.scale=void 0}let e=Z(t)?this.view.getScaleById(t):t;return this.spec.scale=e,this.attach(e),this._updateComponentEncoders(),this.commit(),this}getScale(){return Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}};var YK=(r,t,e,i)=>{var s,n,o,a;let l=(n=(s=t?.components)===null||s===void 0?void 0:s.axis)!==null&&n!==void 0?n:{};if(!r)return G({},l,e??{});let h=[((a=(o=r.tickData)===null||o===void 0?void 0:o.call(r,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return G({},l,{items:h},e??{})},XK=(r,t,e,i)=>{var s,n,o,a;let l=(n=(s=t?.components)===null||s===void 0?void 0:s.circleAxis)!==null&&n!==void 0?n:{};if(!r)return G({},l,e??{});let h=[((a=(o=r.tickData)===null||o===void 0?void 0:o.call(r,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return G({},l,{items:h},e??{})},YE=(r,t,e,i,s,n)=>{var o;let a=r.getCoordinateAxisPosition();s&&s.position==="auto"&&(s.position=e?"content":a);let l=r.getCoordinateAxisPoints(i);if(l){let c={start:l[0],end:l[1],verticalFactor:(a==="top"||a==="left"?-1:1)*(e?-1:1)*(!((o=r.getSpec().range)===null||o===void 0)&&o.reversed?-1:1)};if(n&&t.type==="polar"){let u=t.angle();c.center=t.origin(),c.startAngle=u[0],c.endAngle=u[1]}return c}let h=t.radius(),d=t.angle();return{center:t.origin(),radius:h[1],innerRadius:h[0],inside:e,startAngle:d[0],endAngle:d[1]}},B_=class extends op{constructor(t,e,i){super(t,mi.axis,e),this.spec.componentType=mi.axis,this.mode=i}parseAddition(t){return super.parseAddition(t),this.axisType(t.axisType),this.tickCount(t.tickCount),this.inside(t.inside),this.baseValue(t.baseValue),this}scale(t){return super.scale(t),this._axisComponentType=null,this}axisType(t){return this.spec.axisType=t,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(t,e){let i=G({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=at.createGraphicComponent(this._getAxisComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}tickCount(t){let e=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){let t=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((s,n)=>{let o=e[n];return o&&(s[n]={callback:(a,l,h)=>{var d,c;let u=this.spec.skipTheme?null:this.view.getCurrentTheme(),p=wl(o,a,l,h),m=mr(this.spec.inside,h,a,l),g=mr(this.spec.baseValue,h,a,l),f=(d=t?.getCoordinate)===null||d===void 0?void 0:d.call(t);f&&(p=Object.assign(YE(t,f,m,g,this.spec.layout),p));let _=(c=t?.getScale)===null||c===void 0?void 0:c.call(t),v=mr(this.spec.tickCount,h,a,l);switch(this._getAxisComponentType()){case Zs.lineAxis:return YK(_,u,p,v);case Zs.circleAxis:return XK(_,u,p,v)}return p}}),s},{});this._encoders=i}_getAxisComponentType(){var t;if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(T(e)){let i=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=!((t=i?.getCoordinate)===null||t===void 0)&&t.call(i)?i.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=e==="circle"?Zs.circleAxis:Zs.lineAxis,this._axisComponentType}};B_.componentType=mi.axis;var _a=()=>{at.registerGraphicComponent(Zs.lineAxis,(r,t)=>new Tu(r,t)),at.registerComponent(mi.axis,B_)},L_=()=>{at.registerGraphicComponent(Zs.circleAxis,r=>new Mu(r)),at.registerComponent(mi.axis,B_)};var KK=(r,t,e,i)=>{var s,n,o,a;let l=(n=(s=t?.components)===null||s===void 0?void 0:s.grid)!==null&&n!==void 0?n:{};if(!r)return G({},l,e??{});let h=((a=(o=r.tickData)===null||o===void 0?void 0:o.call(r,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return G({},l,{items:h},e??{})},$K=(r,t,e,i)=>{var s,n,o,a;let l=(n=(s=t?.components)===null||s===void 0?void 0:s.circleGrid)!==null&&n!==void 0?n:{};if(!r)return G({},l,e??{});let h=((a=(o=r.tickData)===null||o===void 0?void 0:o.call(r,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return G({},l,{items:h},e??{})},I_=class extends op{constructor(t,e,i){super(t,mi.grid,e),this.spec.componentType=mi.grid,this.mode=i}parseAddition(t){return super.parseAddition(t),this.target(t.target),this.gridType(t.gridType),this.gridShape(t.gridShape),this}scale(t){return super.scale(t),this._gridComponentType=null,this}gridType(t){return this.spec.gridType=t,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(t){return this.spec.gridShape=t,this.commit(),this}target(t){if(this.spec.target){let i=Z(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(i)}this.spec.target=t;let e=Z(t)?this.view.getMarkById(t):t;return this.attach(e),this._targetAxis=e,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(t){let e=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}addGraphicItem(t,e){let i=G({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),s=at.createGraphicComponent(this._getGridComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,s)}_updateComponentEncoders(){let t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,s)=>{let n=t[s];return n&&(i[s]={callback:(o,a,l)=>{var h,d,c,u;let p=this.spec.skipTheme?null:this.view.getCurrentTheme(),m,g=wl(n,o,a,l),f=mr(this.spec.baseValue,l,o,a);if(this._targetAxis){let x=(h=this._targetAxis.getSpec())===null||h===void 0?void 0:h.scale;m=Z(x)?this.view.getScaleById(x):x;let y=this._targetAxis.elements[0];if(y)switch(this._getGridComponentType()){case Li.lineAxisGrid:g=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),start:y.getGraphicAttribute("start"),end:y.getGraphicAttribute("end"),verticalFactor:(d=y.getGraphicAttribute("verticalFactor"))!==null&&d!==void 0?d:1},g);break;case Li.circleAxisGrid:g=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),center:y.getGraphicAttribute("center"),radius:y.getGraphicAttribute("radius"),innerRadius:y.getGraphicAttribute("innerRadius"),inside:y.getGraphicAttribute("inside"),startAngle:y.getGraphicAttribute("startAngle"),endAngle:y.getGraphicAttribute("endAngle")},g)}}else{m=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;let x=mr(this.spec.inside,l,o,a),y=(c=m?.getCoordinate)===null||c===void 0?void 0:c.call(m);y&&(g=Object.assign(YE(m,y,x,f,this.spec.layout,!0),g))}this._getGridComponentType()===Li.lineAxisGrid&&(g=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:g.start,closed:!0},g,{type:this.spec.gridShape}):Object.assign({},g,{type:"line"}));let _=(u=m?.getScale)===null||u===void 0?void 0:u.call(m),v=mr(this.spec.tickCount,l,o,a);switch(this._getGridComponentType()){case Li.lineAxisGrid:return KK(_,p,g,v);case Li.circleAxisGrid:return $K(_,p,g,v)}return g}}),i},{});this._encoders=e}_getGridComponentType(){var t;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=Li.circleAxisGrid:this._gridComponentType=Li.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case Zs.circleAxis:this._gridComponentType=Li.circleAxisGrid;break;case Zs.lineAxis:default:this._gridComponentType=Li.lineAxisGrid}else if(this.spec.scale){let e=Z(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((t=e?.getCoordinate)===null||t===void 0)&&t.call(e)?e.getCoordinateAxisPoints()?Li.lineAxisGrid:Li.circleAxisGrid:Li.lineAxisGrid}else this._gridComponentType=Li.lineAxisGrid;return this._gridComponentType}};I_.componentType=mi.grid;var va=()=>{at.registerGraphicComponent(Li.lineAxisGrid,(r,t)=>new Qf(r,t)),at.registerComponent(mi.grid,I_)},F_=()=>{at.registerGraphicComponent(Li.circleAxisGrid,(r,t)=>new t_(r,t)),at.registerComponent(mi.grid,I_)};function XE(r){return r.reduce((t,e)=>t+e,0)}function vj(r){return r.length===0?0:XE(r)/r.length}var qK={min:Ae,max:Pe,average:vj,sum:XE};function ZK(r,t,e,i){let s=Math.floor(t.length/r),n=[],o=t.length,a,l,h,d=0,c=0;n[c++]=d;for(let u=1;u<o-1;u+=s){let p=Math.min(u+s,o-1),m=Math.min(u+2*s,o),g=(m+p)/2,f=0;for(let b=p;b<m;b++){let S=t[b][i];Number.isNaN(S)||(f+=S)}f/=m-p;let _=u,v=Math.min(u+s,o),x=u-1,y=t[d][i];a=-1,h=_;for(let b=_;b<v;b++){let S=t[b][i];Number.isNaN(i)||(l=Math.abs((x-g)*(S-y)-(x-b)*(f-y)),l>a&&(a=l,h=b))}n[c++]=h,d=h}return n[c-1]!==o-1&&(n[c++]=o-1),n.map(u=>e?t[u].i:u)}function OA(r,t,e,i,s){let n=Math.floor(t.length/r),o=[],a=t.length,l=0,h=[];o.push(l),t[l][s]=t[l][s];for(let d=1;d<a-1;d+=n){n>a-d&&(n=a-d,h.length=n),h=[];for(let u=0;u<n;u++)h.push(t[d+u][s]);let c=qK[i](h);l=Math.min(Math.round(d+h.length/2)||0,a-1),t[l][s]=c,o.push(l)}return o.map(d=>e?t[d].i:d)}function JK(r,t,e,i){return OA(r,t,e,"min",i)}function QK(r,t,e,i){return OA(r,t,e,"max",i)}function t$(r,t,e,i){return OA(r,t,e,"average",i)}function e$(r,t,e,i){return OA(r,t,e,"sum",i)}var yj=(r,t)=>{let e=r.size,i=r.factor||1;if(Array.isArray(e)&&(e=Math.floor(e[1]-e[0])),e*=i,e<=0)return[];if(t.length<=e)return t;if(r.skipfirst)return t.slice(0,1);let{mode:s,yfield:n,groupBy:o}=r,a=n??"y",l=ZK;if(s==="min"?l=JK:s==="max"?l=QK:s==="average"?l=t$:s==="sum"&&(l=e$),t.length){let h={};if(o){for(let c=0,u=t.length;c<u;c++){let p=t[c],m=p[o];h[m]?h[m].push({[a]:p[a],i:c}):(h[m]=[],h[m].push({[a]:p[a],i:c}))}let d=[];return Object.keys(h).forEach(c=>{let u=h[c];if(u.length<=e){let p=u.map(m=>m.i);d=d.concat(p)}else{let p=l(e,u,!0,a);d=d.concat(p),u.forEach(m=>t[m.i][a]=m[a])}}),d.sort((c,u)=>c-u),d.map(c=>t[c])}return l(e,t,!1,a).map(d=>t[d])}return[]};var xj=()=>{at.registerTransform("sampling",{transform:yj,markPhase:"afterEncode"},!0)};var bj=(r,t,e)=>{switch(t?.direction){case"x":{let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width");return{from:A(n)?{x:i+n/2,x1:void 0,width:0}:{x:(i+s)/2,x1:(i+s)/2,width:void 0},to:{x:i,x1:s,width:n}}}case"y":{let i=r.getFinalAnimationAttribute("y"),s=r.getFinalAnimationAttribute("y1"),n=r.getFinalAnimationAttribute("height");return{from:A(n)?{y:i+n/2,y1:void 0,height:0}:{y:(i+s)/2,y1:(i+s)/2,height:void 0},to:{y:i,y1:s,height:n}}}default:{let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width"),o=r.getFinalAnimationAttribute("y"),a=r.getFinalAnimationAttribute("y1"),l=r.getFinalAnimationAttribute("height"),h={};return A(n)?(h.x=i+n/2,h.width=0,h.x1=void 0):(h.x=(i+s)/2,h.x1=(i+s)/2,h.width=void 0),A(l)?(h.y=o+l/2,h.height=0,h.y1=void 0):(h.y=(o+a)/2,h.y1=(o+a)/2,h.height=void 0),{from:h,to:{x:i,y:o,x1:s,y1:a,width:n,height:l}}}}},Sj=(r,t,e)=>{switch(t?.direction){case"x":{let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width");return{to:A(n)?{x:i+n/2,x1:void 0,width:0}:{x:(i+s)/2,x1:(i+s)/2,width:void 0}}}case"y":{let i=r.getFinalAnimationAttribute("y"),s=r.getFinalAnimationAttribute("y1"),n=r.getFinalAnimationAttribute("height");return{to:A(n)?{y:i+n/2,y1:void 0,height:0}:{y:(i+s)/2,y1:(i+s)/2,height:void 0}}}default:{let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("y"),n=r.getFinalAnimationAttribute("x1"),o=r.getFinalAnimationAttribute("y1"),a=r.getFinalAnimationAttribute("width"),l=r.getFinalAnimationAttribute("height"),h={};return A(a)?(h.x=i+a/2,h.width=0,h.x1=void 0):(h.x=(i+n)/2,h.x1=(i+n)/2,h.width=void 0),A(l)?(h.y=s+l/2,h.height=0,h.y1=void 0):(h.y=(s+o)/2,h.y1=(s+o)/2,h.height=void 0),{to:h}}}};function i$(r,t,e){let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width");if(t&&t.orient==="negative"){let a=A(n)?Math.max(i,i+n):Math.max(i,s);return{from:{x:a,x1:T(s)?void 0:a,width:T(n)?void 0:0},to:{x:i,x1:s,width:n}}}let o=A(n)?Math.min(i,i+n):Math.min(i,s);return{from:{x:o,x1:T(s)?void 0:o,width:T(n)?void 0:0},to:{x:i,x1:s,width:n}}}function r$(r,t,e){var i;let s=r.getFinalAnimationAttribute("x"),n=r.getFinalAnimationAttribute("x1"),o=r.getFinalAnimationAttribute("width"),a;return t&&t.orient==="negative"?J(t.overall)?a=t.overall:e.group?(a=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=a):a=e.width:a=J(t?.overall)?t?.overall:0,{from:{x:a,x1:T(n)?void 0:a,width:T(o)?void 0:0},to:{x:s,x1:n,width:o}}}var Aj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?r$(r,t,e):i$(r,t,e)};function s$(r,t,e){let i=r.getFinalAnimationAttribute("x"),s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width");if(t&&t.orient==="negative"){let a=A(n)?Math.max(i,i+n):Math.max(i,s);return{to:{x:a,x1:T(s)?void 0:a,width:T(n)?void 0:0}}}let o=A(n)?Math.min(i,i+n):Math.min(i,s);return{to:{x:o,x1:T(s)?void 0:o,width:T(n)?void 0:0}}}function n$(r,t,e){var i;let s=r.getFinalAnimationAttribute("x1"),n=r.getFinalAnimationAttribute("width"),o;return t&&t.orient==="negative"?J(t.overall)?o=t.overall:e.group?(o=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=o):o=e.width:o=J(t?.overall)?t.overall:0,{to:{x:o,x1:T(s)?void 0:o,width:T(n)?void 0:0}}}var Cj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?n$(r,t,e):s$(r,t,e)};function o$(r,t,e){let i=r.getFinalAnimationAttribute("y"),s=r.getFinalAnimationAttribute("y1"),n=r.getFinalAnimationAttribute("height");if(t&&t.orient==="negative"){let a=A(n)?Math.max(i,i+n):Math.max(i,s);return{from:{y:a,y1:T(s)?void 0:a,height:T(n)?void 0:0},to:{y:i,y1:s,height:n}}}let o=A(n)?Math.min(i,i+n):Math.min(i,s);return{from:{y:o,y1:T(s)?void 0:o,height:T(n)?void 0:0},to:{y:i,y1:s,height:n}}}function a$(r,t,e){var i;let s=r.getFinalAnimationAttribute("y"),n=r.getFinalAnimationAttribute("y1"),o=r.getFinalAnimationAttribute("height"),a;return t&&t.orient==="negative"?J(t.overall)?a=t.overall:e.group?(a=(i=e.groupHeight)!==null&&i!==void 0?i:e.group.getBounds().height(),e.groupHeight=a):a=e.height:a=J(t?.overall)?t.overall:0,{from:{y:a,y1:T(n)?void 0:a,height:T(o)?void 0:0},to:{y:s,y1:n,height:o}}}var Tj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?a$(r,t,e):o$(r,t,e)};function l$(r,t,e){let i=r.getFinalAnimationAttribute("y"),s=r.getFinalAnimationAttribute("y1"),n=r.getFinalAnimationAttribute("height");if(t&&t.orient==="negative"){let a=A(n)?Math.max(i,i+n):Math.max(i,s);return{to:{y:a,y1:T(s)?void 0:a,height:T(n)?void 0:0}}}let o=A(n)?Math.min(i,i+n):Math.min(i,s);return{to:{y:o,y1:T(s)?void 0:o,height:T(n)?void 0:0}}}function h$(r,t,e){var i;let s=r.getFinalAnimationAttribute("y1"),n=r.getFinalAnimationAttribute("height"),o;return t&&t.orient==="negative"?J(t.overall)?o=t.overall:e.group?(o=(i=e.groupHeight)!==null&&i!==void 0?i:e.group.getBounds().height(),e.groupHeight=o):o=e.height:o=J(t?.overall)?t.overall:0,{to:{y:o,y1:T(s)?void 0:o,height:T(n)?void 0:0}}}var kj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?h$(r,t,e):l$(r,t,e)};var d$=(r,t,e)=>{let i=r.getFinalAnimationAttributes();return t&&t.orient==="anticlockwise"?{from:{startAngle:i?.endAngle},to:{startAngle:i?.startAngle}}:{from:{endAngle:i?.startAngle},to:{endAngle:i?.endAngle}}},c$=(r,t,e)=>{let i=r.getFinalAnimationAttributes();if(t&&t.orient==="anticlockwise"){let n=J(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:n,endAngle:n},to:{startAngle:i?.startAngle,endAngle:i?.endAngle}}}let s=J(t?.overall)?t.overall:0;return{from:{startAngle:s,endAngle:s},to:{startAngle:i?.startAngle,endAngle:i?.endAngle}}},Mj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?c$(r,t):d$(r,t)},u$=(r,t,e)=>{let i=r.getFinalAnimationAttributes();return t&&t.orient==="anticlockwise"?{from:{startAngle:r.getGraphicAttribute("startAngle",!0)},to:{startAngle:i?.endAngle}}:{from:{endAngle:r.getGraphicAttribute("endAngle",!0)},to:{endAngle:i?.startAngle}}},p$=(r,t,e)=>{if(t&&t.orient==="anticlockwise"){let s=J(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:r.getGraphicAttribute("startAngle",!0),endAngle:r.getGraphicAttribute("endAngle",!0)},to:{startAngle:s,endAngle:s}}}let i=J(t?.overall)?t.overall:0;return{from:{startAngle:r.getGraphicAttribute("startAngle",!0),endAngle:r.getGraphicAttribute("endAngle",!0)},to:{startAngle:i,endAngle:i}}},Dj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?p$(r,t):u$(r,t)},m$=(r,t,e)=>{let i=r.getFinalAnimationAttributes();return t&&t.orient==="inside"?{from:{innerRadius:i?.outerRadius},to:{innerRadius:i?.innerRadius}}:{from:{outerRadius:i?.innerRadius},to:{outerRadius:i?.outerRadius}}},g$=(r,t,e)=>{let i=r.getFinalAnimationAttributes(),s=J(t?.overall)?t.overall:0;return{from:{innerRadius:s,outerRadius:s},to:{innerRadius:i?.innerRadius,outerRadius:i?.outerRadius}}},Ej=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?g$(r,t):m$(r,t)},f$=(r,t,e)=>{let i=r.getFinalAnimationAttributes();return t&&t.orient==="inside"?{from:{innerRadius:r.getGraphicAttribute("innerRadius",!0)},to:{innerRadius:i?.outerRadius}}:{from:{outerRadius:r.getGraphicAttribute("outerRadius",!0)},to:{outerRadius:i?.innerRadius}}},_$=(r,t,e)=>{let i=J(t?.overall)?t.overall:0;return{from:{innerRadius:r.getGraphicAttribute("innerRadius",!0),outerRadius:r.getGraphicAttribute("outerRadius",!0)},to:{innerRadius:i,outerRadius:i}}},wj=(r,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?_$(r,t):f$(r,t)};var Pj=()=>{at.registerAnimationType("growCenterIn",bj)},Rj=()=>{at.registerAnimationType("growCenterOut",Sj)},Bj=()=>{at.registerAnimationType("growHeightIn",Tj)},Lj=()=>{at.registerAnimationType("growHeightOut",kj)},Ij=()=>{at.registerAnimationType("growWidthIn",Aj)},Fj=()=>{at.registerAnimationType("growWidthOut",Cj)};var Oj=()=>{at.registerAnimationType("growAngleIn",Mj)},Hj=()=>{at.registerAnimationType("growAngleOut",Dj)},Nj=()=>{at.registerAnimationType("growRadiusIn",Ej)},Vj=()=>{at.registerAnimationType("growRadiusOut",wj)};var jj=()=>{at.registerStageEventPlugin("gesture",kf)};var zj=["pointerdown","pointerup","pointerupoutside","pointertap","pointerover","pointermove","pointerenter","pointerleave","pointerout","mousedown","mouseup","mouseupoutside","rightdown","rightup","rightupoutside","click","dblclick","mousemove","mouseover","mouseout","mouseenter","mouseleave","wheel","touchstart","touchend","touchendoutside","touchmove","touchcancel","tap","dragstart","drag","dragenter","dragleave","dragover","dragend","drop","pan","panstart","panend","press","pressup","pressend","pinch","pinchstart","pinchend","swipe"],rt;(function(r){r.initialized="initialized",r.rendered="rendered",r.renderFinished="renderFinished",r.animationFinished="animationFinished",r.regionSeriesDataFilterOver="regionSeriesDataFilterOver",r.afterInitData="afterInitData",r.afterInitEvent="afterInitEvent",r.afterInitMark="afterInitMark",r.rawDataUpdate="rawDataUpdate",r.viewDataFilterOver="viewDataFilterOver",r.viewDataUpdate="viewDataUpdate",r.viewDataStatisticsUpdate="viewDataStatisticsUpdate",r.markDeltaYUpdate="markDeltaYUpdate",r.viewDataLabelUpdate="viewDataLabelUpdate",r.scaleDomainUpdate="scaleDomainUpdate",r.scaleUpdate="scaleUpdate",r.dataZoomChange="dataZoomChange",r.drill="drill",r.layoutStart="layoutStart",r.layoutEnd="layoutEnd",r.layoutRectUpdate="layoutRectUpdate",r.playerPlay="playerPlay",r.playerPause="playerPause",r.playerEnd="playerEnd",r.playerChange="playerChange",r.playerForward="playerForward",r.playerBackward="playerBackward",r.scrollBarChange="scrollBarChange",r.brushStart="brushStart",r.brushChange="brushChange",r.brushEnd="brushEnd",r.brushClear="brushClear",r.legendSelectedDataChange="legendSelectedDataChange",r.legendFilter="legendFilter",r.legendItemClick="legendItemClick",r.legendItemHover="legendItemHover",r.legendItemUnHover="legendItemUnHover",r.tooltipShow="tooltipShow",r.tooltipHide="tooltipHide",r.tooltipRelease="tooltipRelease",r.afterResize="afterResize",r.afterRender="afterRender",r.afterLayout="afterLayout"})(rt||(rt={}));var jt;(function(r){r.chart="chart",r.window="window",r.canvas="canvas"})(jt||(jt={}));var Se;(function(r){r.vchart="vchart",r.chart="chart",r.model="model",r.mark="mark"})(Se||(Se={}));var v$=(r,t,e)=>r.x>=t.x&&r.x<=e.x&&r.y>=t.y&&r.y<=e.y,y$=(r,t,e)=>{let i=r.getRegionsInIds(O(t.layout.layoutBindRegionID));return i?.some(s=>{let n=s.getLayoutRect(),o=s.getLayoutStartPoint();return v$(e,{x:o.x,y:o.y},{x:n.width+o.x,y:n.height+o.y})})},HA=(r,t)=>{var e,i;return r===t||!T(r)&&!T(t)&&r.value===t.value&&((e=r.axis)===null||e===void 0?void 0:e.id)===((i=t.axis)===null||i===void 0?void 0:i.id)},x$=(r,t)=>{let e=r.tooltipFilterRange,i=typeof e=="function"?e({scale:t}):e;return K(i)?[-i,i]:i},O_=(r,t,e,i)=>{var s;let n=t.getScale(),o=Ke(n.type),a=[],l=t.getOption().getChart().getSeriesInIndex(t.getSpecInfo().seriesIndexes);for(let h of l)if(h.coordinate===e){let d=O(i(h)),c=(s=h.getViewData())===null||s===void 0?void 0:s.latestData;if(d&&c)if(o){let u=[],p=[];c.forEach((m,g)=>{var f;((f=m[d[0]])===null||f===void 0?void 0:f.toString())===r?.toString()&&(u.push(m),p.push(g))}),a.push({series:h,datum:u,key:KE(h,p)})}else if(A(d[1])){let u=[],p=[];c.forEach((m,g)=>{var f;(((f=m[d[0]])===null||f===void 0?void 0:f.toString())===r?.toString()||A(m[d[0]])&&A(m[d[1]])&&r>=m[d[0]]&&r<m[d[1]])&&(u.push(m),p.push(g))}),a.push({series:h,datum:u,key:KE(h,p)})}else{let u=t.getSpec(),p=x$(u,n),m=[],g=[];if(p)c.forEach((f,_)=>{if(A(f[d[0]])){let v=f[d[0]]-r;v>=p[0]&&v<=p[1]&&(m.push(f),g.push(_))}});else{let f=1/0,_=0;c.forEach((v,x)=>{if(A(v[d[0]])){let y=Math.abs(v[d[0]]-r),b=Math.sign(v[d[0]]-r);y<f?(f=y,m=[v],g=[x],_=b):y===f&&b===_&&(m.push(v),g.push(x))}})}a.push({series:h,datum:m,key:KE(h,g)})}}return a},KE=(r,t)=>`${r.id}_${t.join("_")}`,ap=(r,t,e)=>{let i=r.getAllComponents().filter(s=>s.specKey==="axes"&&t(s)&&y$(r,s,e));return i.length?i:null};var b$=(r,t)=>{let e=2*Math.PI,i=Ae(t),s=Pe(t);return r<i?r+=Math.ceil((i-r)/e)*e:r>s&&(r-=Math.ceil((r-s)/e)*e),r},NA=(r,t)=>{if(!r)return null;let e=ap(r,l=>l.getOrient()==="angle",t),i=ap(r,l=>l.getOrient()==="radius",t);if(!(e&&e.length||i&&i.length))return null;let s=[],n=l=>l.getDimensionField()[0],{x:o,y:a}=t;return e&&e.forEach(l=>{var h;let d=l.getScale();if(d&&Ke(d.type)){let c=d.domain(),u=d.range(),p=l.getCenter(),m={x:o-l.getLayoutStartPoint().x-p.x,y:a-l.getLayoutStartPoint().y-p.y},g=gE({x:1,y:0},m);g=b$(g,u);let f=u_(m),_=(h=i[0])===null||h===void 0?void 0:h.getScale(),v=_?.range();if((g-u?.[0])*(g-u?.[1])>0||(f-v?.[0])*(f-v?.[1])>0)return;let x=l.invert(g);if(T(x))return;let y=c.findIndex(S=>S?.toString()===x.toString());y<0&&(y=void 0);let b=O_(x,l,"polar",n);s.push({index:y,value:x,position:d.scale(x),axis:l,data:b})}}),i&&i.forEach(l=>{var h;let d=l.getScale(),c=d?.range();if(d&&Ke(d.type)){let u=l.getCenter(),p={x:o-l.getLayoutStartPoint().x-u.x,y:a-l.getLayoutStartPoint().y-u.y},m=gE({x:1,y:0},p);m<-Math.PI/2&&(m=2*Math.PI+m);let g=u_(p),f=(h=e[0])===null||h===void 0?void 0:h.getScale(),_=f?.range();if((m-_?.[0])*(m-_?.[1])>0||(g-c?.[0])*(g-c?.[1])>0)return;let v=d.invert(g);if(T(v))return;let x=d.domain().findIndex(b=>b?.toString()===v.toString());x<0&&(x=void 0);let y=O_(v,l,"polar",n);s.push({index:x,value:v,position:d.scale(v),axis:l,data:y})}}),s.length?s:null};function ve(r){return r==="bottom"||r==="top"}function ls(r){return r==="left"||r==="right"}function Rn(r){return r==="z"}function S$(r,t){return t?ve(r)?"linear":"band":ve(r)?"band":"linear"}function To(r,t){return Gu(r.orient)||t&&t.includes(r.orient)?r.orient:"left"}function VA(r){return r==="top"||r==="bottom"?"horizontal":"vertical"}function Gj(r,t){let e=r.inverse;return t&&!ve(r.orient)&&(e=!A(r.inverse)||!r.inverse),e}function $E(r,t){var e;let i=(e=r.type)!==null&&e!==void 0?e:S$(r.orient,t);return{axisType:i,componentName:`${W.cartesianAxis}-${i}`}}var Yj=r=>r.fieldX[0],Xj=r=>r.fieldY[0],A$=r=>{var t;return[r.fieldX[0],(t=r.fieldX2)!==null&&t!==void 0?t:r.fieldX[1]]},C$=r=>{var t;return[r.fieldY[0],(t=r.fieldY2)!==null&&t!==void 0?t:r.fieldY[1]]},Uj=(r,t)=>r?t?Yj:A$:t?Xj:C$,jA=(r,t,e)=>{var i,s;if(!r)return null;let{x:n,y:o}=t,a=(i=ap(r,m=>ve(m.getOrient()),t))!==null&&i!==void 0?i:[],l=(s=ap(r,m=>ls(m.getOrient()),t))!==null&&s!==void 0?s:[];if(!a.length&&!l.length)return null;let h=new Set,d=new Set,c=new Set;[a,l].forEach(m=>m.forEach(g=>{Ke(g.getScale().type)?h.add(g):d.add(g),e&&g.getSpec().hasDimensionTooltip&&c.add(g)}));let u=[],p=m=>{let g=m==="x",f=g?n:o;(g?a:l).forEach(_=>{if(c.size>0){if(c.has(_)){let v=Wj(_,f,Uj(g,Ke(_.getScale().type)));v&&u.push(v)}}else{let v=h.size>0;if((v?h:d).has(_)){let x=Wj(_,f,Uj(g,v));x&&u.push(x)}}})};return r.getSpec().direction==="horizontal"?(p("y"),u.length===0&&p("x")):(p("x"),u.length===0&&p("y")),u.length?u:null},Wj=(r,t,e)=>{let i=r.positionToData(t,!0);return T(i)?null:qE(r,i,e)},qE=(r,t,e)=>{let i=r.getScale();if(T(t))return null;let s=i.domain().findIndex(o=>o?.toString()===t.toString());s<0&&(s=void 0);let n=O_(t,r,"cartesian",e??(ve(r.getOrient())?Yj:Xj));return{index:s,value:t,position:i.scale(t),axis:r,data:n}};var lp=class{constructor(t,e){this._eventDispatcher=t,this._mode=e}get chart(){var t,e;return this._chart||(this._chart=(e=(t=this._eventDispatcher.globalInstance).getChart)===null||e===void 0?void 0:e.call(t)),this._chart}register(t,e){var i,s;((s=(i=this.chart)===null||i===void 0?void 0:i.getOption().onError)!==null&&s!==void 0?s:ia)("Method not implemented.")}unregister(){var t,e;((e=(t=this.chart)===null||t===void 0?void 0:t.getOption().onError)!==null&&e!==void 0?e:ia)("Method not implemented.")}getTargetDimensionInfo(t,e){var i,s;let n=(i=jA(this.chart,{x:t,y:e}))!==null&&i!==void 0?i:[],o=(s=NA(this.chart,{x:t,y:e}))!==null&&s!==void 0?s:[],a=[].concat(n,o);return a.length===0?null:a}dispatch(t,e){var i;let s=(i=this.chart)===null||i===void 0?void 0:i.getAllComponents().filter(l=>l.specKey==="axes"&&(!e?.filter||e.filter(l))),n=s.filter(l=>{let h=l.getScale();return Ke(h.type)}),o=n.length?n:s.filter(l=>{let h=l.getOrient();return ve(h)||h==="angle"}),a=[];return o.forEach(l=>{let h=qE(l,t);h&&a.push(h)}),this._callback.call(null,{action:"enter",dimensionInfo:a}),a}};var zA=class extends lp{constructor(){super(...arguments),this.onClick=t=>{if(!t)return;let e=t.event.viewX,i=t.event.viewY,s=this.getTargetDimensionInfo(e,i);s&&this._callback.call(null,Object.assign(Object.assign({},t),{action:"click",dimensionInfo:s.slice()}))}}register(t,e){this._callback=e.callback,this._eventDispatcher.register("pointertap",{query:Object.assign(Object.assign({},e.query),{source:jt.chart}),callback:this.onClick})}unregister(){this._eventDispatcher.unregister("pointertap",{query:null,callback:this.onClick})}};var GA=class extends lp{constructor(){super(...arguments),this._cacheDimensionInfo=null,this.onMouseMove=t=>{if(!t)return;let e=t.event.viewX,i=t.event.viewY,s=this.getTargetDimensionInfo(e,i);s===null&&this._cacheDimensionInfo!==null?(this._callback.call(null,Object.assign(Object.assign({},t),{action:"leave",dimensionInfo:this._cacheDimensionInfo.slice()})),this._cacheDimensionInfo=s):s===null||this._cacheDimensionInfo!==null&&s.length===this._cacheDimensionInfo.length&&!s.some((n,o)=>!HA(n,this._cacheDimensionInfo[o]))?s!==null&&this._callback.call(null,Object.assign(Object.assign({},t),{action:"move",dimensionInfo:s.slice()})):(this._callback.call(null,Object.assign(Object.assign({},t),{action:"enter",dimensionInfo:s.slice()})),this._cacheDimensionInfo=s)},this.onMouseOut=t=>{t&&(this._callback.call(null,Object.assign(Object.assign({},t),{action:"leave",dimensionInfo:this._cacheDimensionInfo?this._cacheDimensionInfo.slice():[]})),this._cacheDimensionInfo=null)}}register(t,e){this._callback=e.callback,this._eventDispatcher.register("pointermove",{query:Object.assign(Object.assign({},e.query),{source:jt.chart}),callback:this.onMouseMove}),this._eventDispatcher.register("pointerout",{query:Object.assign(Object.assign({},e.query),{source:jt.canvas}),callback:this.onMouseOut}),zr(this._mode)&&this._eventDispatcher.register("pointerdown",{query:Object.assign(Object.assign({},e.query),{source:jt.chart}),callback:this.onMouseMove})}unregister(){this._eventDispatcher.unregister("pointermove",{query:null,callback:this.onMouseMove}),zr(this._mode)&&this._eventDispatcher.unregister("pointerdown",{query:null,callback:this.onMouseMove})}};var As;(function(r){r.dimensionHover="dimensionHover",r.dimensionClick="dimensionClick"})(As||(As={}));var UA={[As.dimensionHover]:GA,[As.dimensionClick]:zA};var ko=class{getComposedEventMap(){return this._composedEventMap}constructor(t,e){this._composedEventMap=new Map,this._eventDispatcher=t,this._mode=e}on(t,e,i){let s=typeof e=="function"?{query:null,callback:e}:{query:e,callback:i};if(UA[t]){let n=new UA[t](this._eventDispatcher,this._mode);n.register(t,s),this._composedEventMap.set(i,{eventType:t,event:n})}else this._eventDispatcher.register(t,s);return this}off(t,e,i){var s,n;let o=i??e;if(UA[t])if(o)(s=this._composedEventMap.get(o))===null||s===void 0||s.event.unregister(),this._composedEventMap.delete(o);else for(let a of this._composedEventMap.entries())a[1].eventType===t&&((n=this._composedEventMap.get(a[0]))===null||n===void 0||n.event.unregister(),this._composedEventMap.delete(a[0]));else if(o){let a={callback:o,query:null,filter:{nodeName:null,type:t,level:null,source:e.source,markName:null,filter:null,userId:null}};this._eventDispatcher.unregister(t,a)}else this._eventDispatcher.unregister(t);return this}emit(t,e,i){return this._eventDispatcher.dispatch(t,e,i),this}prevent(t,e){return this._eventDispatcher.prevent(t,e),this}allow(t){return this._eventDispatcher.allow(t),this}release(){this._eventDispatcher.clear(),this._composedEventMap.clear()}};var WA=class{constructor(){this._map=new Map,this._levelNodes=new Map,this._levelNodes.set(Se.vchart,[]),this._levelNodes.set(Se.chart,[]),this._levelNodes.set(Se.model,[]),this._levelNodes.set(Se.mark,[])}addHandler(t,e){var i;let s={level:e,handler:t};return(i=this._levelNodes.get(e))===null||i===void 0||i.push(s),this._map.set(t.callback,s),this}removeHandler(t){let e=this._map.get(t.callback);if(!e)return this;this._map.delete(t.callback);let i=this._levelNodes.get(e.level),s=i?.findIndex(n=>n.handler.callback===t.callback);return s!==void 0&&s>=0&&i?.splice(s,1),this}preventHandler(t){return t&&(t.prevented=!0),this}allowHandler(t){return t&&(t.prevented=!1),this}getHandlers(t){var e;return((e=this._levelNodes.get(t))===null||e===void 0?void 0:e.map(i=>i.handler))||[]}getAllHandlers(){return Array.from(this._map.values()).map(t=>t.handler)||[]}getCount(){return this._map.size}release(){this._map.clear(),this._levelNodes.clear()}};var Kj={cartesianAxis:"axis","cartesianAxis-band":"axis","cartesianAxis-linear":"axis","cartesianAxis-time":"axis",polarAxis:"axis","polarAxis-band":"axis","polarAxis-linear":"axis",discreteLegend:"legend",continuousLegend:"legend",colorLegend:"legend",sizeLegend:"legend"},YA=class{constructor(t,e){this._viewBubbles=new Map,this._windowBubbles=new Map,this._canvasBubbles=new Map,this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this._onDelegate=i=>{var s,n;let o=this.globalInstance.getChart(),a=A(i.modelId)&&o?.getModelById(i.modelId)||void 0,l=A(i.markId)&&o?.getMarkById(i.markId)||null,h=new Map,d=(s=i.item)===null||s===void 0?void 0:s.mark;for(d&&A(d.id())&&h.set(d.id(),i.item);d?.elements;){let m=d.id();A(m)&&!h.has(m)&&h.set(m,d.elements[0]),d=d.group}let c=ft(i.event,"target"),u=i.datum;a&&a.modelType==="component"&&(u=(n=a.getDatum(c))!==null&&n!==void 0?n:u);let p={event:i.event,item:i.item,source:i.source,datum:u,itemMap:h,chart:o,model:a,mark:l??void 0,node:ft(i.event,"target")};this.dispatch(i.type,p)},this._onDelegateInteractionEvent=i=>{let s=this.globalInstance.getChart(),n=i.event,o=null;n.elements&&(o=n.elements);let a={event:i.event,chart:s,items:o,datums:o&&o.map(l=>l.getDatum())};this.dispatch(i.type,a)},this.globalInstance=t,this._compiler=e}register(t,e){var i,s,n,o,a;this._parseQuery(e);let l=this.getEventBubble(((i=e.filter)===null||i===void 0?void 0:i.source)||jt.chart),h=this.getEventListeners(((s=e.filter)===null||s===void 0?void 0:s.source)||jt.chart);if(l.get(t)||l.set(t,new WA),l.get(t).addHandler(e,(n=e.filter)===null||n===void 0?void 0:n.level),this._isValidEvent(t)&&!h.has(t)){let d=this._onDelegate.bind(this);this._compiler.addEventListener((o=e.filter)===null||o===void 0?void 0:o.source,t,d),h.set(t,d)}else if(this._isInteractionEvent(t)&&!h.has(t)){let d=this._onDelegateInteractionEvent.bind(this);this._compiler.addEventListener((a=e.filter)===null||a===void 0?void 0:a.source,t,d),h.set(t,d)}return this}unregister(t,e){var i,s,n,o;let a=!1,l=this.getEventBubble(((i=e?.filter)===null||i===void 0?void 0:i.source)||jt.chart),h=this.getEventListeners(((s=e?.filter)===null||s===void 0?void 0:s.source)||jt.chart);if(e){let d=l.get(t);d?.removeHandler(e),d?.getCount()===0&&(d?.release(),l.delete(t),a=!0),!((n=e?.wrappedCallback)===null||n===void 0)&&n.cancel&&e.wrappedCallback.cancel()}else{let d=l.get(t);d?.release(),l.delete(t),a=!0}if(a&&this._isValidEvent(t)){let d=h.get(t);this._compiler.removeEventListener(((o=e?.filter)===null||o===void 0?void 0:o.source)||jt.chart,t,d),h.delete(t)}return this}dispatch(t,e,i){let s=this.getEventBubble(e.source||jt.chart).get(t);if(!s)return this;let n=!1;if(i){let o=s.getHandlers(i);n=this._invoke(o,t,e)}else{let o=[Se.mark,Se.model,Se.chart,Se.vchart],a=0;for(;!n&&a<o.length;)n=this._invoke(s.getHandlers(o[a]),t,e),a++}return this}prevent(t,e){return["canvas","chart","window"].forEach(i=>{let s=this.getEventBubble(i).get(t);s&&s.getAllHandlers().forEach(n=>{e&&n.callback===e||s.preventHandler(n)})}),this}allow(t){return["canvas","chart","window"].forEach(e=>{let i=this.getEventBubble(e).get(t);i&&i.getAllHandlers().forEach(s=>i.allowHandler(s))}),this}clear(){[jt.chart,jt.window,jt.canvas].forEach(t=>{let e=this.getEventListeners(t);for(let i of e.entries())this._compiler.removeEventListener(t,i[0],i[1]);e.clear()}),[this._viewBubbles,this._windowBubbles,this._canvasBubbles].forEach(t=>{for(let e of t.values())e.release();t.clear()})}release(){this.clear(),this.globalInstance=null,this._compiler=null}_filter(t,e,i){var s,n,o;if(V(t.filter)&&!t.filter(i)||t.nodeName&&ft(i,"node.name")!==t.nodeName||t.markName&&((s=i?.mark)===null||s===void 0?void 0:s.name)!==t.markName)return!1;let a=(n=i.model)===null||n===void 0?void 0:n.type;return Kj[a]&&(a=Kj[a]),(!t.type||a===t.type)&&!(t.level==="mark"&&!t.type&&!i?.mark)&&!(t.level==="model"&&!t.type&&!i?.model)&&(!A(t.userId)||((o=i.model)===null||o===void 0?void 0:o.userId)===t.userId)}_prepareParams(t,e){if(t.markName&&e.mark&&e.itemMap){let i=e.mark.getProductId(),s=e.itemMap.get(i),n=s?.getDatum();return Object.assign(Object.assign({},e),{item:s,datum:n})}return Object.assign({},e)}_invoke(t,e,i){return t.map(s=>{var n,o,a;let l=s.filter;if(!s.prevented&&(!s.query||this._filter(l,e,i))){let h=(s.wrappedCallback||s.callback).call(null,this._prepareParams(l,i)),d=h??((n=s.query)===null||n===void 0?void 0:n.consume);return d&&((o=i.event)===null||o===void 0||o.stopPropagation(),(a=i.event)===null||a===void 0||a.preventDefault()),!!d}}).some(s=>s===!0)}_getQueryLevel(t){return t?t.level?t.level:A(t.id)?Se.model:Se.vchart:Se.vchart}_parseQuery(t){var e;let i=t.query;i?.throttle?t.wrappedCallback=Hi(t.callback,i.throttle):i?.debounce&&(t.wrappedCallback=Zi(t.callback,i.debounce));let s=this._getQueryLevel(i),n=null,o=jt.chart,a=null,l=null,h=null;return i?.nodeName&&(a=i.nodeName),i?.markName&&(l=i.markName),!i?.type||s!==Se.model&&s!==Se.mark||(n=i.type),i?.source&&(o=i.source),A(i?.id)&&(h=i?.id,s=Se.model),t.filter={level:s,markName:l,type:n,source:o,nodeName:a,userId:h,filter:(e=i?.filter)!==null&&e!==void 0?e:null},t}getEventBubble(t){switch(t){case jt.chart:return this._viewBubbles;case jt.window:return this._windowBubbles;case jt.canvas:return this._canvasBubbles;default:return this._viewBubbles}}getEventListeners(t){switch(t){case jt.chart:return this._viewListeners;case jt.window:return this._windowListeners;case jt.canvas:return this._canvasListeners;default:return this._viewListeners}}_isValidEvent(t){return zj.includes(t)||Object.values(pt).includes(t)}_isInteractionEvent(t){let e;return t&&(e=t.split(":")[0],e)&&at.hasInteraction(e)}};function nt(r,t,e){r.getTransform(t)||r.registerTransform(t,e)}function hs(r,t,e){r.getParser(t)||r.registerParser(t,e)}var XA=new Map;function $j(r){return XA.get(r)}function qj(r,t=!1){let e=t;return r.latestData instanceof St&&(e=!1),e?li(r.latestData):r.latestData&&r.latestData.slice()}var Il=(r,t)=>r.length===0?[]:r.length===1?qj(r[0],t?.deep):r.map(e=>qj(e,t?.deep));function H_(r,t,e){t=t instanceof Ar?t:r.dataSet,nt(t,"copyDataView",Il);let i=new St(t,e);return i.parse([r],{type:"dataview"}),i.transform({type:"copyDataView",level:Ki.copyDataView}),i}function hp(r,t,e=[]){var i;if(r instanceof St)return r;let{id:s,values:n=[],fromDataIndex:o,fromDataId:a,transforms:l=[]}=r,h=r.parser?li(r.parser):{clone:!0},d=li(r.fields),c;h.clone=h.clone!==!1;let u=e.find(p=>p.name===s);if(u)c=u;else{let p={name:s};if(d&&(p.fields=d),c=new St(t,p),typeof a=="string"){let m=e.find(g=>g.name===a);if(!m)return ji(`no data matches fromDataId ${a}`),null;c.parse([m],{type:"dataview"}),c.transform({type:"copyDataView"})}else if(typeof o=="number"){let m=e[o];if(!m)return ji(`no data matches fromDataIndex ${o}`),null;c.parse([m],{type:"dataview"}),c.transform({type:"copyDataView"})}else Array.isArray(n)?c.parse(n,h):!Z(n)||h&&!["csv","dsv","tsv"].includes(h.type)?(c.parse([]),ji("values should be array")):c.parse(n,(i=h)!==null&&i!==void 0?i:{type:"csv"});l&&l.length&&l.forEach(m=>{t.getTransform(m.type)&&c.transform(m)})}return c}function dp(r,t,e){r&&(t.fields&&r.setFields(t.fields,e),r.parseNewData(t.values,t.parser))}var Ki;(function(r){r[r.copyDataView=-10]="copyDataView",r[r.treemapFilter=-8]="treemapFilter",r[r.treemapFlatten=-7]="treemapFlatten",r[r.dotObjFlat=-7]="dotObjFlat",r[r.linkDotInfo=-7]="linkDotInfo",r[r.sankeyLayout=-7]="sankeyLayout",r[r.dataZoomFilter=-6]="dataZoomFilter",r[r.legendFilter=-5]="legendFilter"})(Ki||(Ki={}));var _i;(function(r){r.appear="appear",r.disappear="disappear",r.enter="enter",r.update="update",r.state="state",r.exit="exit",r.normal="normal",r.none="none"})(_i||(_i={}));var Qs;(function(r){r.data="data",r.signal="signal",r.mark="mark"})(Qs||(Qs={}));function Zj(r){switch(r){case ze["desktop-browser"]:case ze["mobile-browser"]:return"browser";case ze.node:case ze.worker:return"node";case ze.miniApp:case ze["desktop-miniApp"]:return"feishu";case ze.lynx:return"lynx";case ze.wx:return"wx";case ze.tt:return"tt";case ze.harmony:return"harmony"}return"browser"}var T$=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},KA=class{getVGrammarView(){return this._view}getModel(){return this._model}constructor(t,e){this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this.isInited=!1,this._released=!1,this._model={[Qs.signal]:{},[Qs.data]:{},[Qs.mark]:{}},this._compileChart=null,this.handleStageRender=()=>{var i,s;(s=(i=this._compileChart)===null||i===void 0?void 0:i.getEvent())===null||s===void 0||s.emit(rt.afterRender,{chart:this._compileChart})},this._container=t,this._option=e}getRenderer(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer}getCanvas(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.canvas()}getStage(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.stage()}initView(){var t,e,i,s;if(this._released||(this.isInited=!0,this._view))return;let n=new Nt((t=this._option.logLevel)!==null&&t!==void 0?t:Rr.Error);!((e=this._option)===null||e===void 0)&&e.onError&&n.addErrorHandler((...f)=>{var _,v;(v=(_=this._option)===null||_===void 0?void 0:_.onError)===null||v===void 0||v.call(_,...f)});let o=this._option,{performanceHook:a,autoRefreshDpr:l,dpr:h,mode:d,gestureConfig:c,interactive:u,clickInterval:p,autoPreventDefault:m}=o,g=T$(o,["performanceHook","autoRefreshDpr","dpr","mode","gestureConfig","interactive","clickInterval","autoPreventDefault"]);this._view=new Js(Object.assign(Object.assign({width:this._width,height:this._height,container:(i=this._container.dom)!==null&&i!==void 0?i:null,renderCanvas:(s=this._container.canvas)!==null&&s!==void 0?s:null,hooks:a},g),{dpr:h,autoRefresh:A(l)?l:!A(h),mode:Zj(d),autoFit:!1,eventConfig:{gesture:A(c)?c:zr(d),disable:u===!1,clickInterval:p,autoPreventDefault:m},doLayout:()=>{var f;(f=this._compileChart)===null||f===void 0||f.onLayout(this._view)},logger:n,logLevel:n.level()})),this._setCanvasStyle(),this.getStage().hooks.afterRender.tap("chart-event",this.handleStageRender),u!==!1&&this._viewListeners.forEach(f=>{var _;(_=this._view)===null||_===void 0||_.addEventListener(f.type,f.callback)})}_setCanvasStyle(){if(this._view&&this._container.dom&&!Z(this._container.dom)){this._container.dom.style.display="block",this._container.dom.style.position="relative";let t=this.getCanvas();t&&(t.style.display="block")}}compileInteractions(){var t;if(this._view.removeAllInteractions(),(t=this._interactions)===null||t===void 0?void 0:t.length){let e={};this._interactions.forEach(i=>{var s;if(i.regionId){let n=`${i.regionId}-${i.type}-${(s=i.id)!==null&&s!==void 0?s:""}`,o=e[n];e[n]=o?Object.assign(Object.assign(Object.assign({},o),i),{selector:[...o.selector,...i.selector]}):i}else this._view.interaction(i.type,i)}),Object.keys(e).forEach(i=>{let s=this._view.interaction(e[i].type,e[i]);if(this._compileChart){let n=this._compileChart.getRegionsInIds([e[i].regionId])[0];n&&n.interaction.addVgrammarInteraction(s.getStartState(),s)}})}}compile(t,e){if(this._released)return;let{chart:i}=t;this._compileChart=i,this.initView(),this._view&&(i.compile(),i.afterCompile(),this.updateDepend(),this.compileInteractions())}clearNextRender(){return!!this._nextRafId&&(kt.getCancelAnimationFrame()(this._nextRafId),this._nextRafId=null,!0)}clear(t,e=!1){let{chart:i}=t;this.clearNextRender(),i.clear(),this.releaseGrammar(e)}renderNextTick(t){this._released||this._nextRafId||(this._nextRafId=kt.getRequestAnimationFrame()(()=>{this._nextRafId=null,this.render(t)}))}render(t){var e,i;this._released||(this.initView(),this._view&&((e=this._view)===null||e===void 0||e.run(t),this.clearNextRender()&&((i=this._view)===null||i===void 0||i.run(t))))}updateViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}resize(t,e,i=!0){this._view&&(this._width=t,this._height=e,this._view.resize(t,e),i&&this.render({morph:!1}))}setBackground(t){var e;(e=this._view)===null||e===void 0||e.background(t)}setSize(t,e){this._width=t,this._height=e,this._view&&(this._view.width(t),this._view.height(e))}setViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}addEventListener(t,e,i){var s,n;if(this._option.interactive!==!1){if(t===jt.chart){let o=function(a,l){var h,d,c;let u=(d=(h=l?.mark)===null||h===void 0?void 0:h.getContext())!==null&&d!==void 0?d:{},p=A(u.modelId)?u.modelId:null,m=A(u.markId)?u.markId:null,g=A(u.modelUserId)?u.modelUserId:null,f=A(u.markUserId)?u.markUserId:null,_={event:a,type:e,source:t,item:l,datum:((c=l?.getDatum)===null||c===void 0?void 0:c.call(l))||null,markId:m,modelId:p,markUserId:f,modelUserId:g};i.call(null,_)}.bind(this);this._viewListeners.set(i,{type:e,callback:o}),(s=this._view)===null||s===void 0||s.addEventListener(e,o)}else if(t===jt.window){let o=function(l){let h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}.bind(this);this._windowListeners.set(i,{type:e,callback:o});let a=this._getGlobalThis();a?.addEventListener(e,o)}else if(t===jt.canvas){let o=function(l){let h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}.bind(this);this._canvasListeners.set(i,{type:e,callback:o});let a=(n=this.getStage())===null||n===void 0?void 0:n.window;a?.addEventListener(e,o)}}}removeEventListener(t,e,i){var s,n,o,a,l;if(this._option.interactive!==!1){if(t===jt.chart){let h=(s=this._viewListeners.get(i))===null||s===void 0?void 0:s.callback;h&&((n=this._view)===null||n===void 0||n.removeEventListener(e,h)),this._viewListeners.delete(i)}else if(t===jt.window){let h=this._getGlobalThis(),d=(o=this._windowListeners.get(i))===null||o===void 0?void 0:o.callback;d&&h?.removeEventListener(e,d),this._windowListeners.delete(i)}else if(t===jt.canvas){let h=(a=this.getStage())===null||a===void 0?void 0:a.window,d=(l=this._canvasListeners.get(i))===null||l===void 0?void 0:l.callback;h&&d&&h?.removeEventListener(e,d),this._canvasListeners.delete(i)}}}releaseEvent(){let t=this.getStage();t&&t.hooks.afterRender.unTap("chart-event",this.handleStageRender),this._viewListeners.clear(),this._windowListeners.clear(),this._canvasListeners.clear()}release(){var t;this.clearNextRender(),this.releaseEvent(),this._option=this._container=null,this._releaseModel(),(t=this._view)===null||t===void 0||t.release(),this._view=null,this.isInited=!1,this._compileChart=null,this._released=!0}releaseGrammar(t=!1){var e,i;this._releaseModel(),t&&((e=this._view)===null||e===void 0||e.removeAllGraphicItems()),(i=this._view)===null||i===void 0||i.removeAllGrammars()}_releaseModel(){Object.keys(this._model).forEach(t=>{Object.values(this._model[t]).forEach(e=>{Object.values(e).forEach(i=>{i.removeProduct(!0)})}),this._model[t]={}})}addGrammarItem(t){let e=t.getProduct();if(T(e))return;let i=e.id(),s=t.grammarType;T(this._model[s][i])&&(this._model[s][i]={}),this._model[s][i][t.id]=t}removeGrammarItem(t,e){var i;let s=t.getProduct();if(T(s))return;let n=s.id(),o=t.grammarType,a=this._model[o][n];A(a)&&(delete a[t.id],Object.keys(a).length===0&&delete this._model[o][n]),e||(i=this._view)===null||i===void 0||i.removeGrammar(s)}addInteraction(t){this._interactions||(this._interactions=[]),this._interactions.push(t)}removeInteraction(t){this._interactions&&(this._interactions=this._interactions.filter(e=>e.seriesId!==t))}updateDepend(t){return A(t)&&t.length>0?t.every(e=>e.updateDepend()):(Object.values(this._model).forEach(e=>{Object.values(e).forEach(i=>{let s=Object.values(i),n=s[0].getProduct(),o=s.reduce((a,l)=>l.getDepend().length>0?a.concat(l.getDepend()):a,[]).filter(a=>!!a).map(a=>a.getProduct());n.depend(o)})}),!0)}_getGlobalThis(){var t;return jr(this._option.mode)?globalThis:(t=this.getStage())===null||t===void 0?void 0:t.window}};var k$=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})};function Jj(r="vchart",t){let e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank"),e.setAttribute("download",`${r}.png`),e.dispatchEvent(new MouseEvent("click"))}function M$(r){return new Promise(t=>{r.convertToBlob().then(e=>{let i=new FileReader;i.readAsDataURL(e),i.onload=()=>{t(i.result)}})})}function Qj(r,t){var e;return k$(this,void 0,void 0,function*(){if(!r)return"";try{if(OffscreenCanvas!==void 0&&r instanceof OffscreenCanvas)return M$(r)}catch(i){((e=t?.onError)!==null&&e!==void 0?e:ia)(`getCanvasDataURL error : ${i.toString()}`)}return r.toDataURL()})}function nr(r){r.crosshair=O(r.crosshair||{}).map(t=>ot({[r.direction==="horizontal"?"yField":"xField"]:{visible:!0,line:{visible:!0,type:"rect"}}},t))}function $A(r,t,e){var i;let{width:s,height:n}=r;if(A(s)&&A(n))return{width:s,height:n};let o=e.width,a=e.height,l=t.container,h=t.canvas;if(l){let{width:d,height:c}=$m(l,e.width,e.height);o=d,a=c}else if(h&&jr(t.mode)){let d;d=Z(h)?kt.getElementById(h):h;let{width:c,height:u}=$m(d,e.width,e.height);o=c,a=u}else if(Gr(t.mode)&&(!((i=t.modeParams)===null||i===void 0)&&i.domref)){let d=t.modeParams.domref;o=d.width,a=d.height}return o=s??o,a=n??a,{width:o,height:a}}function Fl(r,...t){let e=i=>t.reduce((s,n)=>s||n?.[i],r[i]);return Object.assign(r,{change:e("change"),reCompile:e("reCompile"),reMake:e("reMake"),reRender:e("reRender"),reSize:e("reSize"),reTransformSpec:e("reTransformSpec"),changeTheme:e("changeTheme"),changeBackground:e("changeBackground")}),r}function qA(r,t){return r==="line"||r==="area"||r==="common"&&t.series.every(e=>e.type==="area"||e.type==="line")?{paddingInner:1,paddingOuter:0}:{paddingOuter:0}}var it;(function(r){r.STATE_NORMAL="normal",r.STATE_HOVER="hover",r.STATE_HOVER_REVERSE="hover_reverse",r.STATE_DIMENSION_HOVER="dimension_hover",r.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",r.STATE_SELECTED="selected",r.STATE_SELECTED_REVERSE="selected_reverse",r.STATE_SANKEY_EMPHASIS="selected",r.STATE_SANKEY_EMPHASIS_REVERSE="blur"})(it||(it={}));var cp;(function(r){r.STATE_HOVER_REVERSE="hover_reverse",r.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",r.STATE_SELECTED_REVERSE="selected_reverse"})(cp||(cp={}));var Ol=class r{constructor(){this._children=[],this._markNameMap={},this._infoMap=new Map}getMarkNameMap(){return this._markNameMap}addMark(t,e){T(t)||(this._children.push(t),this._markNameMap[t.name]=t,this._infoMap.set(t,G({},r.defaultMarkInfo,e)))}removeMark(t){let e=this._children.findIndex(i=>i.name===t);e>=0&&(this._infoMap.delete(this._children[e]),delete this._markNameMap[t],this._children.splice(e,1))}clear(){this._children=[],this._markNameMap={},this._infoMap.clear()}forEach(t){this._children.forEach(t)}includes(t,e){return this._children.includes(t,e)}get(t){return isNaN(Number(t))?this._markNameMap[t]:this._children[t]}getMarks(){return this._children.slice()}getMarksInType(t){let e=O(t);return this._children.filter(i=>e.includes(i.type))}getMarkInId(t){return this._children.find(e=>e.id===t)}getMarkWithInfo(t){return this._children.find(e=>Object.keys(t).every(i=>t[i]===this._infoMap.get(e)[i]))}};Ol.defaultMarkInfo={};var ZA=class{get hover(){return this._hover}get select(){return this._select}constructor(t){this._marks=new Ol,this._markReverse=new Ol,this.onHover=e=>{switch(e.action){case"enter":this.interaction.getEventElement(it.STATE_DIMENSION_HOVER).forEach(i=>this.interaction.addEventElement(it.STATE_DIMENSION_HOVER_REVERSE,i)),this.interaction.clearEventElement(it.STATE_DIMENSION_HOVER,!1),this.getEventElement(e).forEach(i=>this.interaction.addEventElement(it.STATE_DIMENSION_HOVER,i)),this.interaction.reverseEventElement(it.STATE_DIMENSION_HOVER);break;case"leave":this.interaction.clearEventElement(it.STATE_DIMENSION_HOVER,!0),e=null}},this._option=t,this.event=this._option.model.getOption().getChart().getEvent(),this.interaction=t.interaction,this.initConfig(t.mode)}setStateKeys(t){}registerMark(t){st(t.stateStyle[it.STATE_DIMENSION_HOVER])||this._marks.addMark(t),st(t.stateStyle[it.STATE_DIMENSION_HOVER_REVERSE])||this._markReverse.addMark(t)}init(){this.initEvent()}release(){this.releaseEvent()}initEvent(){this.event.on(As.dimensionHover,this.onHover)}releaseEvent(){this.event.release()}initConfig(t){}getEventElement(t,e=!1){let i=[];return t.dimensionInfo.forEach(s=>{s.data.forEach(n=>{(e?this._markReverse:this._marks).getMarks().filter(o=>o.model===n.series&&o.getVisible()).forEach(o=>{let a=o.getProduct();if(!a||!a.elements)return;let l=a.elements.filter(h=>{let d=h.getDatum(),c;return c=H(d)?d.every((u,p)=>u===n.datum[p]):n.datum.some(u=>u===d),e?!c:c});i.push(...l)})})}),i}};function tz(r,t,e){var i;let s=(i=t[r])===null||i===void 0?void 0:i.style;return D$(r,s)||V(s)?!0:!(!s?.scale||s.field===e)}function D$(r,t){return(r==="fill"||r==="stroke")&&t?.gradient&&t?.stops}var ez={};Object.values(it).forEach(r=>{ez[r]=!0});function iz(r){return!!ez[r]}var E$={[it.STATE_HOVER]:it.STATE_HOVER_REVERSE,[it.STATE_SELECTED]:it.STATE_SELECTED_REVERSE,[it.STATE_DIMENSION_HOVER]:it.STATE_DIMENSION_HOVER_REVERSE};function N_(r){return E$[r]}var JA=class{constructor(){this._stateMarks=new Map,this._stateElements=new Map,this._vgrammarInteractions=new Map,this._disableTriggerEvent=!1}addVgrammarInteraction(t,e){t&&(this._vgrammarInteractions.get(t)?this._vgrammarInteractions.get(t).push(e):this._vgrammarInteractions.set(t,[e]))}static markStateEnable(t,e){return!st(t.stateStyle[e])}setDisableActiveEffect(t){this._disableTriggerEvent=t}registerMark(t,e){var i;this._stateMarks.has(t)||this._stateMarks.set(t,[]),(i=this._stateMarks.get(t))===null||i===void 0||i.push(e)}getStateMark(t){return this._stateMarks.get(t)}filterEventMark(t,e){var i;return!(!t.mark||!(!((i=this._stateMarks.get(e))===null||i===void 0)&&i.includes(t.mark)))}getEventElement(t){var e;return(e=this._stateElements.get(t))!==null&&e!==void 0?e:[]}getEventElementData(t){return this.getEventElement(t).map(e=>e.getDatum())}exchangeEventElement(t,e){var i;if(this._disableTriggerEvent)return;let s=N_(t);(i=this._stateElements.get(t))===null||i===void 0||i.forEach(n=>{n.removeState(t),s&&this.addEventElement(s,n)}),e.getStates().includes(t)||(e.addState(t),s&&e.removeState(s)),this._stateElements.set(t,[e])}removeEventElement(t,e){var i,s;if(this._disableTriggerEvent)return;e.removeState(t);let n=(s=(i=this._stateElements.get(t))===null||i===void 0?void 0:i.filter(a=>a!==e))!==null&&s!==void 0?s:[];this._stateElements.set(t,n);let o=N_(t);o&&(n.length===0?this.clearEventElement(o,!1):this.addEventElement(o,e))}addEventElement(t,e){var i;if(this._disableTriggerEvent)return;e.getStates().includes(t)||e.addState(t);let s=(i=this._stateElements.get(t))!==null&&i!==void 0?i:[];s.push(e),this._stateElements.set(t,s)}clearEventElement(t,e){var i;if(!this._disableTriggerEvent&&((i=this._stateElements.get(t))===null||i===void 0||i.forEach(s=>{s.removeState(t)}),this._stateElements.set(t,[]),e)){let s=N_(t);s&&this.clearEventElement(s,!1)}}clearAllEventElement(){if(!this._disableTriggerEvent)for(let[t,e]of this._stateElements)e.forEach(i=>{i.clearStates()}),this._stateElements.set(t,[])}reverseEventElement(t){if(this._disableTriggerEvent)return;let e=N_(t);if(!e)return;let i=this.getStateMark(e);if(!i)return;let s=this.getEventElement(t);s.length&&(this.getEventElement(e).length||(s.length===1?i.forEach(n=>{n.getProduct().elements.filter(o=>o!==s[0]).forEach(o=>{this.addEventElement(e,o)})}):i.forEach(n=>{n.getProduct().elements.filter(o=>!s.includes(o)).forEach(o=>{this.addEventElement(e,o)})})))}startInteraction(t,e){let i=this._vgrammarInteractions.get(t);i&&i.forEach(s=>{s.start(e)})}resetInteraction(t,e){let i=this._vgrammarInteractions.get(t);i&&i.forEach(s=>{s.reset(e)})}resetAllInteraction(){for(let[t,e]of this._vgrammarInteractions)e&&e.forEach(i=>{i.reset(null)})}};var Tt;(function(r){r[r.SeriesGroup=0]="SeriesGroup",r[r.Axis_Grid=50]="Axis_Grid",r[r.CrossHair_Grid=100]="CrossHair_Grid",r[r.Region=450]="Region",r[r.Mark=300]="Mark",r[r.Node=400]="Node",r[r.Axis=100]="Axis",r[r.MarkLine=500]="MarkLine",r[r.MarkArea=100]="MarkArea",r[r.MarkPoint=500]="MarkPoint",r[r.DataZoom=500]="DataZoom",r[r.ScrollBar=500]="ScrollBar",r[r.Player=500]="Player",r[r.Legend=500]="Legend",r[r.CrossHair=500]="CrossHair",r[r.Indicator=500]="Indicator",r[r.Title=500]="Title",r[r.Label=500]="Label",r[r.Brush=500]="Brush",r[r.CustomMark=500]="CustomMark",r[r.Interaction=700]="Interaction"})(Tt||(Tt={}));var Gi;(function(r){r[r.Indicator=10]="Indicator",r[r.Region=20]="Region",r[r.Axis=30]="Axis",r[r.DataZoom=40]="DataZoom",r[r.Player=40]="Player",r[r.ScrollBar=40]="ScrollBar",r[r.Legend=50]="Legend",r[r.Title=70]="Title",r[r.CustomMark=70]="CustomMark"})(Gi||(Gi={}));var X;(function(r){r[r.Default=0]="Default",r[r.Theme=1]="Theme",r[r.Chart=2]="Chart",r[r.Base_Series=3]="Base_Series",r[r.Series=4]="Series",r[r.Mark=5]="Mark",r[r.User_Chart=6]="User_Chart",r[r.User_Series=7]="User_Series",r[r.User_Mark=8]="User_Mark",r[r.User_SeriesStyle=9]="User_SeriesStyle",r[r.Built_In=99]="Built_In"})(X||(X={}));var Mo=class{getOption(){return this._option}constructor(t){this._option=t,this.getCompiler=this._option.getCompiler}getVGrammarView(){var t;return(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView()}release(){this._option=null,this.getCompiler=null}};var Hl=class extends Mo{constructor(){super(...arguments),this.id=ts(),this._compiledProductId=null,this._depend=[]}getProduct(){if(A(this._product))return this._product;let t=this.getVGrammarView(),e=this.getProductId();return A(e)&&A(t)&&(this._product=this._lookupGrammar(e)),this._product}getProductId(){var t;return(t=this._compiledProductId)!==null&&t!==void 0?t:this.generateProductId()}getDepend(){return this._depend}setDepend(...t){this._depend=t}compile(t){this._compileProduct(t),this._afterCompile(t)}_afterCompile(t){var e;A(this._product)&&((e=this.getCompiler())===null||e===void 0||e.addGrammarItem(this))}updateDepend(){if(A(this._product)){let t=this.getDepend().map(e=>e.getProduct()).filter(A);return this._product.depend(t),t.length===this.getDepend().length}return!1}release(){this.removeProduct(),super.release(),this._depend=[]}removeProduct(t){this.getCompiler().removeGrammarItem(this,t),this._product=null,this._compiledProductId=null}};var QA=class extends Hl{getValue(){return this._value}getUpdateFunc(){return this._updateFunc}constructor(t,e,i,s){super(t),this.grammarType=Qs.signal,this.name=e,this._value=i,this._updateFunc=s}updateSignal(t,e){this._value=t,this._updateFunc=e,this.compile()}_compileProduct(){let t=this.getVGrammarView();if(t){if(!this.getProduct()){let e=this.getProductId();this._product=t.signal().id(e),this._compiledProductId=e}A(this._value)&&this._product.value(this._value),A(this._updateFunc)&&this._product.update(this._updateFunc)}}generateProductId(){return this.name}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getSignalById(t)}};var t1=class extends Mo{constructor(){super(...arguments),this._signalMap={}}getSignalMap(){return this._signalMap}getSignal(t){return this._signalMap[t]}updateSignal(t,e,i){this._signalMap[t]?this._signalMap[t].updateSignal(e,i):(this._signalMap[t]=new QA(this._option,t,e,i),this._signalMap[t].compile())}compile(){Object.values(this._signalMap).forEach(t=>{t.compile()})}release(){super.release(),Object.values(this._signalMap).forEach(t=>{t.release()}),this._signalMap={}}};var up=class extends t1{getStateMap(){return this._stateMap}_getDefaultStateMap(){return{}}constructor(t){super(t),t.stateKeyToSignalName?this.stateKeyToSignalName=t.stateKeyToSignalName:this.stateKeyToSignalName=()=>"state_signal",this.initStateMap()}initStateMap(t){this._stateMap=t??this._getDefaultStateMap()}compile(t){let e=t??this._stateMap;Object.keys(e).forEach(i=>{let s=this.stateKeyToSignalName(i),n=e[i];this.updateSignal(s,n)})}updateState(t,e){if(t&&(G(this._stateMap,t),this.compile(t),!e))return this.getCompiler().renderNextTick()}};var pp=class extends up{constructor(){super(...arguments),this.id=ts(),this.stateKeyToSignalName=t=>`${et}_animate_${this.id}_${t}`}getAnimationStateSignalName(){return this.stateKeyToSignalName("animationState")}updateAnimateState(t,e){t===_i.update?this.updateState({animationState:{callback:(i,s)=>s.diffState}},e):t===_i.appear?this.updateState({animationState:{callback:(i,s)=>s.diffState==="exit"?_i.none:_i.appear}},e):this.updateState({animationState:{callback:(i,s)=>t}},e)}_getDefaultStateMap(){return{animationState:{callback:(t,e)=>e.diffState==="exit"?_i.exit:e.diffState==="update"?_i.update:_i.appear}}}};var Do=class{constructor(t){this._option=t,this.type=t.type}_initTheme(t,e){return this._theme=this.getTheme(t,e),this._mergeThemeToSpec(t,e)}getTheme(t,e){}transformSpec(t,e,i){this._transformSpecBeforeMergingTheme(t,e,i);let s=this._initTheme(t,e);return this._transformSpecAfterMergingTheme(s.spec,e,i),s}_transformSpecBeforeMergingTheme(t,e,i){}_transformSpecAfterMergingTheme(t,e,i){}_mergeThemeToSpec(t,e){let i=this._theme;if(this._shouldMergeThemeToSpec()){let s=this._getDefaultSpecFromChart(e),n=o=>ot({},i,s,o);return H(t)?{spec:t.map(o=>n(o)),theme:i}:{spec:n(t),theme:i}}return{spec:t,theme:i}}_shouldMergeThemeToSpec(){return!0}_getDefaultSpecFromChart(t){}};var Nl=class extends Mo{getSpec(){return this._spec||{}}getSpecPath(){var t;return(t=this._option)===null||t===void 0?void 0:t.specPath}getSpecInfoPath(){var t,e,i;return(e=(t=this._option)===null||t===void 0?void 0:t.specInfoPath)!==null&&e!==void 0?e:(i=this._option)===null||i===void 0?void 0:i.specPath}getData(){return this._data}get layout(){return this._layout}getOption(){return this._option}getMarks(){var t,e;return(e=(t=this._marks)===null||t===void 0?void 0:t.getMarks())!==null&&e!==void 0?e:[]}getMarkNameMap(){var t;return(t=this._marks)===null||t===void 0?void 0:t.getMarkNameMap()}getMarkSet(){return this._marks}getChart(){return this._option.getChart()}get _theme(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.theme}constructor(t,e){var i;super(e),this.transformerConstructor=Do,this.type="null",this.modelType="null",this.userId=void 0,this._data=null,this._layout=null,this.specKey="",this._marks=new Ol,this._lastLayoutRect=null,this.id=ts(),this.userId=t.id,this._spec=t,this.effect={},this.event=new ko(e.eventDispatcher,e.mode),(i=e.map)===null||i===void 0||i.set(this.id,this)}_releaseEvent(){this.event.release()}created(){this.setAttrFromSpec()}init(t){}afterInit(){}getVisible(){var t;return((t=this._spec)===null||t===void 0?void 0:t.visible)!==!1}onLayoutStart(t,e,i){var s;(s=this._layout)===null||s===void 0||s.onLayoutStart(t,e,i)}onLayoutEnd(t){var e;(e=this._layout)===null||e===void 0||e.onLayoutEnd(t),this.getMarks().forEach(i=>i.updateLayoutState(!0,!0))}onEvaluateEnd(t){}onDataUpdate(){}beforeRelease(){}release(){var t;this._releaseEvent(),this._spec=void 0,this.getMarks().forEach(e=>e.release()),(t=this._data)===null||t===void 0||t.release(),this._data=null,this._marks.clear(),super.release()}updateSpec(t){let e=this._compareSpec(t,this._spec);return this._spec=t,e}_compareSpec(t,e){return{change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1}}reInit(t){t&&(this._spec=t),this.setAttrFromSpec()}updateLayoutAttribute(){}setAttrFromSpec(){var t;(t=this._layout)===null||t===void 0||t.setAttrFromSpec(this._spec,this._option.getChartViewRect())}_convertMarkStyle(t){return Object.assign({},t)}setMarkStyle(t,e,i,s){A(t)&&A(e)&&t.setStyle(this._convertMarkStyle(e),i,s)}initMarkStyleWithSpec(t,e,i){if(!A(t)||!A(e))return;let{style:s,state:n}=e,o=Object.assign({},e);s&&(o.style=this._convertMarkStyle(s)),n&&(o.state={},Object.keys(n).forEach(a=>{o.state[a]=this._convertMarkStyle(n[a])})),t.initStyleWithSpec(o,i)}stateKeyToSignalName(t,e){let i=`${et}_${this.modelType}_${this.type}_${this.id}_${t}`;return e&&(i+=`_${e}`),i}compileData(){var t;(t=this._data)===null||t===void 0||t.compile()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t})})}_createMark(t,e={},i){let{type:s,name:n}=t,o=I.createMark(s,n,Object.assign({model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._option.globalScale},e));return o&&(o.created(),i&&o.setMarkConfig(i)),o}_getDataIdKey(){}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}getSpecInfo(){var t,e,i;let s=(i=(e=(t=this._option).getSpecInfo)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:{};return nV(s,this.getSpecInfoPath())}getSpecIndex(){let t=this.getSpecPath();if(!t?.length)return 0;let e=Number(t[t.length-1]);return isNaN(e)?0:e}};var e1=class{getSpec(){return this._spec||{}}getLayoutStartPoint(){return this._layoutStartPoint}get layoutRectLevelMap(){return this._layoutRectLevelMap}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=t}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=t}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=t}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=t}getLastComputeOutBounds(){return this._lastComputeOutBounds}get layoutOrient(){return this._layoutOrient}set layoutOrient(t){this._layoutOrient=t}get model(){return this._model}get type(){return this._model.type}constructor(t,e){var i;this.layoutClip=!1,this.autoIndent=!1,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:0,height:0},this._layoutRectLevelMap={width:0,height:0},this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._lastComputeRect=null,this._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0},this.getLayoutRect=()=>this._layoutRect,this.layoutType="normal",this._layoutOrient="left",this.layoutPaddingLeft=0,this.layoutPaddingTop=0,this.layoutPaddingRight=0,this.layoutPaddingBottom=0,this.layoutOffsetX=0,this.layoutOffsetY=0,this.layoutLevel=Gi.Region,this._model=t,this._option=e,this.layoutLevel=e.layoutLevel,this.layoutType=e.layoutType,e.layoutOrient&&(this.layoutOrient=e.layoutOrient),this._spec=(i=t?.getSpec)===null||i===void 0?void 0:i.call(t)}_setLayoutAttributeFromSpec(t,e){var i,s,n,o;if(this._spec&&this._spec.visible!==!1){let a=Xr(t.padding),l=rA(a,e,e);this.layoutPaddingLeft=l.left,this.layoutPaddingRight=l.right,this.layoutPaddingTop=l.top,this.layoutPaddingBottom=l.bottom,this._minHeight=T(t.minHeight)?(i=this._minHeight)!==null&&i!==void 0?i:null:We(t.minHeight,e.height,e),this._maxHeight=T(t.maxHeight)?(s=this._maxHeight)!==null&&s!==void 0?s:null:We(t.maxHeight,e.height,e),this._minWidth=T(t.minWidth)?(n=this._minWidth)!==null&&n!==void 0?n:null:We(t.minWidth,e.width,e),this._maxWidth=T(t.maxWidth)?(o=this._maxWidth)!==null&&o!==void 0?o:null:We(t.maxWidth,e.width,e),t.width&&this.setLayoutRect({width:We(t.width,e.width,e)},{width:9}),t.height&&this.setLayoutRect({height:We(t.height,e.height,e)},{height:9}),T(t.offsetX)||(this.layoutOffsetX=We(t.offsetX,e.width,e)),T(t.offsetY)||(this.layoutOffsetY=We(t.offsetY,e.height,e)),t.alignSelf&&(this.alignSelf=t.alignSelf)}}setAttrFromSpec(t,e){var i,s,n,o;this._spec=t,this.layoutType=(i=t.layoutType)!==null&&i!==void 0?i:this.layoutType,this.layoutLevel=(s=t.layoutLevel)!==null&&s!==void 0?s:this.layoutLevel,this.layoutOrient=(n=t.orient)!==null&&n!==void 0?n:this.layoutOrient,this._setLayoutAttributeFromSpec(t,e),this.layoutClip=(o=t.clip)!==null&&o!==void 0?o:this.layoutClip}onLayoutStart(t,e,i){this._setLayoutAttributeFromSpec(this._spec,e)}onLayoutEnd(t){}_getAbsoluteSpecValue(t){let e={top:null,bottom:null,left:null,right:null};return["top","bottom","left","right"].forEach(i=>{T(this._spec[i])||(e[i]=We(this._spec[i],i==="top"||i==="bottom"?t.height:t.width,t))}),e}absoluteLayoutInRect(t){let{top:e,bottom:i,left:s,right:n}=this._getAbsoluteSpecValue(t),o={width:t.width-this.layoutPaddingLeft-this.layoutPaddingRight,height:t.height-this.layoutPaddingTop-this.layoutPaddingBottom};T(s)||(o.width-=s),T(n)||(o.width-=n),T(e)||(o.height-=e),T(i)||(o.height-=i),this.setLayoutRect(o);let{width:a,height:l}=this.computeBoundsInRect(this.getLayoutRect());this.setLayoutRect({width:a,height:l});let h={x:t.x,y:t.y};this._spec.center===!0?(h.x=t.x+.5*t.width-.5*a,h.y=t.y+.5*t.height-.5*l):(T(s)?T(n)||(h.x=t.x+t.width-this.layoutPaddingRight-n-a):h.x=t.x+s+this.layoutPaddingLeft,T(e)?T(i)||(h.y=t.y+t.height-this.layoutPaddingBottom-i-l):h.y=t.y+e+this.layoutPaddingTop),this.setLayoutStartPosition(h)}setLayoutStartPosition(t){var e,i;this._option.transformLayoutPosition&&(t=this._option.transformLayoutPosition(t)),K(t.x)&&(this._layoutStartPoint.x=t.x),K(t.y)&&(this._layoutStartPoint.y=t.y),(i=(e=this._model).afterSetLayoutStartPoint)===null||i===void 0||i.call(e,this._layoutStartPoint)}setLayoutRect({width:t,height:e},i){var s,n,o,a;K(t)&&((s=i?.width)!==null&&s!==void 0?s:0)>=this._layoutRectLevelMap.width&&(this._layoutRect.width=t,this._layoutRectLevelMap.width=(n=i?.width)!==null&&n!==void 0?n:0),K(e)&&((o=i?.height)!==null&&o!==void 0?o:0)>=this._layoutRectLevelMap.height&&(this._layoutRect.height=e,this._layoutRectLevelMap.height=(a=i?.height)!==null&&a!==void 0?a:0),this.setRectInSpec(this._layoutRect)}getLayout(){return{x:this._layoutStartPoint.x,y:this._layoutStartPoint.y,width:this._layoutRect.width,height:this._layoutRect.height}}mergeLayoutRect({width:t,height:e}){let i={width:t,height:e};return this._layoutRectLevelMap.width>0&&(i.width=this._layoutRect.width),this._layoutRectLevelMap.height>0&&(i.height=this._layoutRect.height),i}getOrientPosAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"x":"y"}getOrientSizeAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"width":"height"}changeBoundsBySetting(t){return this._layoutRectLevelMap.width>0&&(t.x2=t.x1+this._layoutRect.width),this._layoutRectLevelMap.height>0&&(t.y2=t.y1+this._layoutRect.height),t.x1-=this._layoutStartPoint.x,t.x2-=this._layoutStartPoint.x,t.y1-=this._layoutStartPoint.y,t.y2-=this._layoutStartPoint.y,t}setRectInSpec(t){let e=Object.assign({},t);return this._layoutRectLevelMap.width<9?(T(this._minWidth)||(e.width=Math.max(e.width,this._minWidth)),T(this._maxWidth)||(e.width=Math.min(e.width,this._maxWidth))):e.width=this._layoutRect.width,this._layoutRectLevelMap.height<9?(T(this._minHeight)||(e.height=Math.max(e.height,this._minHeight)),T(this._maxHeight)||(e.height=Math.min(e.height,this._maxHeight))):e.height=this._layoutRect.height,e}computeBoundsInRect(t){if(this._lastComputeRect=t,!(this.layoutType!=="region-relative"&&this.layoutType!=="region-relative-overlap"||(this._layoutRectLevelMap.width!==9||this.layoutOrient!=="left"&&this.layoutOrient!=="right")&&(this._layoutRectLevelMap.height!==9||this.layoutOrient!=="bottom"&&this.layoutOrient!=="top")))return this._layoutRect;let e=Object.assign({},this._model.getBoundsInRect(this.setRectInSpec(t),t));this.changeBoundsBySetting(e),this.autoIndent&&e.x2-e.x1>0&&e.y2-e.y1>0&&(this._lastComputeOutBounds.x1=Math.ceil(-e.x1),this._lastComputeOutBounds.x2=Math.ceil(e.x2-t.width),this._lastComputeOutBounds.y1=Math.ceil(-e.y1),this._lastComputeOutBounds.y2=Math.ceil(e.y2-t.height));let i=this.setRectInSpec(HH(e,t));return this._option.transformLayoutRect&&(i=this._option.transformLayoutRect(i)),i}getModelId(){return this._model.id}getModelVisible(){return this._model.getVisible()}};var mp=class extends Nl{constructor(){super(...arguments),this.layoutType="normal",this.layoutLevel=0,this.layoutZIndex=0,this._forceLayoutTag=!1,this._layout=null,this._orient=null,this._layoutRect={width:0,height:0},this._layoutStartPos={x:0,y:0},this._isLayout=!0,this.getGraphicBounds=()=>this._layout?{x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}:{x1:0,x2:0,y1:0,y2:0},this._transformLayoutRect=null,this._transformLayoutPosition=null}get layoutOrient(){return this._orient}set layoutOrient(t){this._orient=t,this._layout&&(this._layout.layoutOrient=t)}initLayout(){this.layoutType!=="none"&&(this._layout=new e1(this,{layoutType:this.layoutType,layoutLevel:this.layoutLevel,layoutOrient:this._orient,transformLayoutRect:this._transformLayoutRect,transformLayoutPosition:this._transformLayoutPosition}),this._orient&&this._orient!=="radius"&&this._orient!=="angle"&&this._layout&&(this._layout.layoutOrient=this._orient))}onLayoutStart(t,e,i){this._isLayout=!0,super.onLayoutStart(t,e,i)}onLayoutEnd(t){super.onLayoutEnd(t),this.updateLayoutAttribute();let e=this.getLayoutRect();!this._forceLayoutTag&&Bt(this._lastLayoutRect,e)||(this._lastLayoutRect=Object.assign({},e)),this._forceLayoutTag=!1,this._isLayout=!1}afterSetLayoutStartPoint(t){}_forceLayout(){var t;this._isLayout||(this._forceLayoutTag=!0,(t=this._option.globalInstance.getChart())===null||t===void 0||t.setLayoutTag(!0))}getLayoutStartPoint(){return this._layout?this._layout.getLayoutStartPoint():this._layoutStartPos}setLayoutStartPosition(t){return this._layout?this._layout.setLayoutStartPosition(t):this._layoutStartPos=G(this._layoutStartPos,t)}getLayoutRect(){return this._layout?this._layout.getLayoutRect():this._layoutRect}setLayoutRect(t,e){return this._layout?this._layout.setLayoutRect(t):this._lastLayoutRect=G(this._layoutRect,t)}getLastComputeOutBounds(){var t;return(t=this._layout)===null||t===void 0?void 0:t.getLastComputeOutBounds()}setAttrFromSpec(){var t,e,i,s,n;super.setAttrFromSpec(),this.layoutClip=(t=this._spec.clip)!==null&&t!==void 0?t:this.layoutClip,this.layoutZIndex=(e=this._spec.zIndex)!==null&&e!==void 0?e:this.layoutZIndex,this.layoutType=(i=this._spec.layoutType)!==null&&i!==void 0?i:this.layoutType,this._orient=(s=this._spec.orient)!==null&&s!==void 0?s:this._orient,this.layoutLevel=(n=this._spec.layoutLevel)!==null&&n!==void 0?n:this.layoutLevel}};var V_=class extends Do{_initTheme(t,e){return{spec:t,theme:this._theme}}};var wd=class r extends mp{getMaxWidth(){return this._layout.maxWidth}setMaxWidth(t){this._layout.maxWidth=t}getMaxHeight(){return this._layout.maxHeight}setMaxHeight(t){this._layout.maxHeight=t}getGroupMark(){return this._groupMark}getInteractionMark(){return this._interactionMark}getStackInverse(){return this._spec.stackInverse===!0}getStackSort(){return this._spec.stackSort===!0}constructor(t,e){var i;super(t,e),this.transformerConstructor=V_,this.modelType="region",this.specKey="region",this.type=r.type,this._series=[],this.layoutType="region",this.layoutZIndex=Tt.Region,this.interaction=new JA,this.seriesDataFilterOver=()=>{this.event.emit(rt.regionSeriesDataFilterOver,{model:this,chart:this.getChart()}),this._series.forEach(s=>{s.getViewDataFilter()&&s.reTransformViewData()})},this.getBoundsInRect=()=>({x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}),this.userId=t.id,this.coordinate=(i=t.coordinate)!==null&&i!==void 0?i:"cartesian",this._option.animation&&(this.animate=new pp({getCompiler:e.getCompiler})),this.interaction.setDisableActiveEffect(this._option.disableTriggerEvent)}_getClipDefaultValue(){var t,e,i,s;let n=this._option.getChart().getSpec(),o=(e=(t=n.dataZoom)===null||t===void 0?void 0:t.some)===null||e===void 0?void 0:e.call(t,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"filter")==="axis"}),a=(s=(i=n.scrollBar)===null||i===void 0?void 0:i.some)===null||s===void 0?void 0:s.call(i,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"axis")==="axis"});return!(!o&&!a)||this._layout.layoutClip}created(){var t,e;this.initLayout(),super.created();let i=(t=this._spec.clip)!==null&&t!==void 0?t:this._getClipDefaultValue();this._groupMark=this._createGroupMark("regionGroup",this.userId,this.layoutZIndex),this._spec.roam&&this._groupMark.setMarkConfig({interactive:!0}),this._interactionMark=this._createGroupMark("regionInteractionGroup",((e=this.userId)!==null&&e!==void 0?e:this.type)+"_interaction",Tt.Interaction),st(this._spec.style)||(this._backgroundMark=this._createMark({type:"rect",name:"regionBackground"}),i&&(this._foregroundMark=this._createMark({type:"rect",name:"regionForeground"})),[this._backgroundMark,this._foregroundMark].forEach(s=>{s&&(s.created(),this.setMarkStyle(s,{width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height},"normal",X.Built_In),this._groupMark.addMark(s))}),this._backgroundMark&&this._backgroundMark.setMarkConfig({zIndex:Tt.SeriesGroup-1}),this._foregroundMark&&this._foregroundMark.setMarkConfig({zIndex:Tt.Mark+1})),this.createTrigger()}_createGroupMark(t,e,i){var s,n;let o=this._createMark({type:"group",name:t});o.setUserId(e),o.setMarkConfig({zIndex:i});let a=(s=this._spec.clip)!==null&&s!==void 0?s:this._getClipDefaultValue();return this.setMarkStyle(o,{x:()=>this.getLayoutStartPoint().x,y:()=>this.getLayoutStartPoint().y,width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height,clip:a},"normal",X.Built_In),this.setMarkStyle(o,{cornerRadius:(n=this._spec.style)===null||n===void 0?void 0:n.cornerRadius},"normal",X.User_Mark),this._marks.addMark(o),o}init(t){super.init(t),this.initMark(),this.initSeriesDataflow(),this.initInteraction(),this.initTrigger()}initMark(){this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}_initBackgroundMarkStyle(){var t,e;this._backgroundMark&&(this.setMarkStyle(this._backgroundMark,Object.assign({fillOpacity:!((t=this._spec.style)===null||t===void 0)&&t.fill?1:0},this._spec.style),"normal",X.User_Mark),((e=this._spec.clip)!==null&&e!==void 0?e:this._getClipDefaultValue())&&this.setMarkStyle(this._backgroundMark,{strokeOpacity:0},"normal",X.Built_In))}_initForegroundMarkStyle(){this._foregroundMark&&this.setMarkStyle(this._foregroundMark,Object.assign(Object.assign({},this._spec.style),{fillOpacity:0,pickable:!1}),"normal",X.User_Mark)}_compareSpec(t,e){let i=super._compareSpec(t,e);return Bt(e?.style,t?.style)||(i.reMake=!0),i}reInit(t){super.reInit(t),this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}addSeries(t){t&&(this._series.includes(t)||this._series.push(t))}removeSeries(t){if(!t)return;let e=this._series.findIndex(i=>i===t);e>=0&&this._series.splice(e,1)}getSeries(t={}){return this._series.filter(e=>{var i,s;return(!t.name||e?.name===t.name)&&(!t.userId||O(t.userId).includes(e.userId))&&(!A(t.specIndex)||O(t.specIndex).includes(e.getSpecIndex()))&&(!t.id||e.id===t.id)&&(!t.type||e.type===t.type)&&(!t.coordinateType||e.coordinate===t.coordinateType)&&(!t.dataName||((s=(i=e.getRawData)===null||i===void 0?void 0:i.call(e))===null||s===void 0?void 0:s.name)===t.dataName)})}getSeriesInName(t){return this.getSeries({name:t})[0]}getSeriesInUserId(t){return this.getSeries({userId:t})[0]}getSeriesInId(t){return this.getSeries({id:t})[0]}getSeriesInType(t){return this.getSeries({type:t})}getSeriesInCoordinateType(t){return this.getSeries({coordinateType:t})}getSeriesInDataName(t){return this.getSeries({dataName:t})}onRender(t){}initSeriesDataflow(){let t=this._series.map(e=>{var i;return(i=e.getViewDataFilter())!==null&&i!==void 0?i:e.getViewData()}).filter(e=>!!e);this._option.dataSet.multipleDataViewAddListener(t,"change",this.seriesDataFilterOver)}release(){super.release(),this._series=[]}createTrigger(){let t=Object.assign(Object.assign({},this._option),{model:this,interaction:this.interaction});this._trigger=new ZA(t)}initTrigger(){this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{this._trigger.registerMark(e)})}),this._trigger.init()}initInteraction(){this._option.disableTriggerEvent||this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{for(let i in cp)st(e.stateStyle[cp[i]])||this.interaction.registerMark(cp[i],e)})})}compileMarks(t){this.getMarks().forEach(e=>{var i;e.compile({group:t,context:{model:this}}),(i=e.getProduct())===null||i===void 0||i.layout((s,n,o,a)=>{})})}compile(){var t;(t=this.animate)===null||t===void 0||t.compile(),this.compileMarks()}onLayoutEnd(t){this._series.forEach(e=>e.onLayoutEnd(t)),super.onLayoutEnd(t)}};wd.type="region",wd.transformerConstructor=V_,wd.specKey="region";function s1(r){let t=[],e=[],i=[];return r.forEach(s=>{T(s.getSpec().position)||s.getSpec().position==="start"?t.push(s):s.getSpec().position==="middle"?e.push(s):s.getSpec().position==="end"&&i.push(s)}),{startItems:t,endItems:i,middleItems:e}}function rz(r,t,e){t?r.forEach(i=>{let s=It(i),n=s.getLayoutStartPoint().y+s.getLayoutRect().height-i[0].getLayoutStartPoint().y,o=(e-n)/2;i.forEach(a=>{a.setLayoutStartPosition({x:a.getLayoutStartPoint().x,y:a.getLayoutStartPoint().y+o})})}):r.forEach(i=>{let s=It(i),n=s.getLayoutStartPoint().x+s.getLayoutRect().width-i[0].getLayoutStartPoint().x,o=(e-n)/2;i.forEach(a=>{a.setLayoutStartPosition({x:a.getLayoutStartPoint().x+o,y:a.getLayoutStartPoint().y})})})}function n1(r,t,e,i){let s;r.forEach((n,o)=>{n.length>1&&(s=e[o],n.forEach(a=>{if(!a.alignSelf||a.alignSelf==="start")return;let l=a.getLayoutStartPoint(),h=a.alignSelf==="middle"?.5:1,d=t?s-(a.getLayoutRect().width+a.layoutPaddingLeft+a.layoutPaddingRight):s-(a.getLayoutRect().height+a.layoutPaddingTop+a.layoutPaddingBottom);t?a.setLayoutStartPosition({x:l.x+i*d*h,y:l.y}):a.setLayoutStartPosition({x:l.x,y:l.y+i*d*h})}))})}function i1(r,t,e,i,s){if(r.length){let n=0,o=s==="right",a=o?-1:1,l=o?t.rightCurrent:t.leftCurrent,h=t.topCurrent,d=[],c=[],u=[];r.forEach(p=>{let m=t.getItemComputeLayoutRect(p),g=p.computeBoundsInRect(m);p.setLayoutRect(g);let f=g.height+p.layoutPaddingTop+p.layoutPaddingBottom,_=g.width+p.layoutPaddingLeft+p.layoutPaddingRight,v=o?-g.width-p.layoutPaddingRight:p.layoutPaddingLeft;p.setLayoutStartPosition({x:l+p.layoutOffsetX+v,y:h+p.layoutOffsetY+p.layoutPaddingTop}),h+=f,h>e&&c.length?(u.push(n),l+=a*n,n=_,h=t.topCurrent+f,p.setLayoutStartPosition({x:l+p.layoutOffsetX+v,y:t.topCurrent+p.layoutOffsetY+p.layoutPaddingTop}),d.push(c),c=[p]):(n=Math.max(n,_),c.push(p))}),u.push(n),d.push(c),n1(d,!0,u,a),i&&rz(d,!0,e),o?t.rightCurrent=l+a*n:t.leftCurrent=l+a*n}}function sz(r,t,e,i){if(r.length){let s=0,n=i==="right",o=n?-1:1,a=n?t.rightCurrent:t.leftCurrent,l=t.bottomCurrent,h=[],d=[],c=[];r.forEach(u=>{let p=t.getItemComputeLayoutRect(u),m=u.computeBoundsInRect(p);u.setLayoutRect(m);let g=m.height+u.layoutPaddingTop+u.layoutPaddingBottom,f=m.width+u.layoutPaddingLeft+u.layoutPaddingRight,_=n?-m.width-u.layoutPaddingRight:u.layoutPaddingLeft;l<g&&d.length?(c.push(s),a+=o*s,s=f,l=t.bottomCurrent,u.setLayoutStartPosition({x:a+u.layoutOffsetX+_,y:l+u.layoutOffsetY-m.height-u.layoutPaddingBottom}),h.push(d),d=[u]):(u.setLayoutStartPosition({x:a+u.layoutOffsetX+_,y:l+u.layoutOffsetY-m.height-u.layoutPaddingBottom}),s=Math.max(s,f),l-=g,d.push(u))}),c.push(s),h.push(d),n1(h,!0,c,o),n?t.rightCurrent=a+o*s:t.leftCurrent=a+o*s}}function r1(r,t,e,i,s){if(r.length){let n=s==="top",o=n?1:-1,a=0,l=t.leftCurrent,h=n?t.topCurrent:t.bottomCurrent,d=[],c=[],u=[];r.forEach(p=>{let m=t.getItemComputeLayoutRect(p),g=p.computeBoundsInRect(m);p.setLayoutRect(g);let f=g.height+p.layoutPaddingTop+p.layoutPaddingBottom,_=g.width+p.layoutPaddingLeft+p.layoutPaddingRight,v=n?p.layoutPaddingTop:-g.height-p.layoutPaddingBottom;p.setLayoutStartPosition({x:l+p.layoutOffsetX+p.layoutPaddingLeft,y:h+p.layoutOffsetY+v}),l+=_,l>e&&c.length?(u.push(a),l=t.leftCurrent+_,h+=o*a,a=f,p.setLayoutStartPosition({x:t.leftCurrent+p.layoutOffsetX+p.layoutPaddingLeft,y:h+p.layoutOffsetY+v}),d.push(c),c=[p]):(a=Math.max(a,f),c.push(p))}),u.push(a),d.push(c),n1(d,!1,u,o),i&&rz(d,!1,e),n?t.topCurrent=h+o*a:t.bottomCurrent=h+o*a}}function nz(r,t,e,i){if(r.length){let s=i==="top",n=s?1:-1,o=0,a=t.rightCurrent,l=s?t.topCurrent:t.bottomCurrent,h=[],d=[],c=[];r.forEach(u=>{let p=t.getItemComputeLayoutRect(u),m=u.computeBoundsInRect(p);u.setLayoutRect(m);let g=m.height+u.layoutPaddingTop+u.layoutPaddingBottom,f=m.width+u.layoutPaddingLeft+u.layoutPaddingRight,_=s?u.layoutPaddingTop:-m.height-u.layoutPaddingBottom;a<f&&d.length?(a=t.rightCurrent,l+=n*o,o=g,u.setLayoutStartPosition({x:t.rightCurrent+u.layoutOffsetX-m.width-u.layoutPaddingRight,y:l+u.layoutOffsetY+_}),h.push(d),d=[u]):(d.push(u),u.setLayoutStartPosition({x:a+u.layoutOffsetX-m.width-u.layoutPaddingRight,y:l+u.layoutOffsetY+_}),o=Math.max(o,g),a-=f)}),c.push(o),h.push(d),n1(h,!1,c,n),s?t.topCurrent=l+n*o:t.bottomCurrent=l+n*o}}function oz(r,t,e){let{startItems:i,middleItems:s,endItems:n}=s1(r);i.length&&i1(i,t,e,!1,"left"),s.length&&i1(s,t,e,!0,"left"),n.length&&sz(n,t,e,"left")}function az(r,t,e){let{startItems:i,middleItems:s,endItems:n}=s1(r);i.length&&i1(i,t,e,!1,"right"),s.length&&i1(s,t,e,!0,"right"),n.length&&sz(n,t,e,"right")}function lz(r,t,e){let{startItems:i,middleItems:s,endItems:n}=s1(r);i.length&&r1(i,t,e,!1,"top"),s.length&&r1(s,t,e,!0,"top"),n.length&&nz(n,t,e,"top")}function hz(r,t,e){let{startItems:i,middleItems:s,endItems:n}=s1(r);i.length&&r1(i,t,e,!1,"bottom"),s.length&&r1(s,t,e,!0,"bottom"),n.length&&nz(n,t,e,"bottom")}var j_=class{constructor(t,e){this.leftCurrent=0,this.topCurrent=0,this.rightCurrent=0,this.bottomCurrent=0,this._onError=e?.onError}_layoutInit(t,e,i,s){this._chartLayoutRect=i,this._chartViewBox=s,this.leftCurrent=i.x,this.topCurrent=i.y,this.rightCurrent=i.x+i.width,this.bottomCurrent=i.height+i.y,e.sort((n,o)=>o.layoutLevel-n.layoutLevel)}_layoutNormalItems(t){this.layoutNormalInlineItems(t.filter(e=>e.layoutType==="normal-inline")),this.layoutNormalItems(t.filter(e=>e.layoutType==="normal"))}_groupItems(t){let e=t.filter(a=>a.layoutType==="region"),i=t.filter(a=>a.layoutType==="region-relative"),s=t.filter(a=>a.layoutType==="region-relative-overlap"),n=i.concat(s),o={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}};return s.forEach(a=>{o[a.layoutOrient].items.push(a)}),{regionItems:e,relativeItems:i,relativeOverlapItems:s,allRelatives:n,overlapItems:o}}layoutItems(t,e,i,s){this._layoutInit(t,e,i,s),this._layoutNormalItems(e);let n={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},{regionItems:o,relativeItems:a,relativeOverlapItems:l,allRelatives:h,overlapItems:d}=this._groupItems(e);this.layoutRegionItems(o,a,l,d),this._processAutoIndent(o,a,l,d,h,n),this.layoutAbsoluteItems(e.filter(c=>c.layoutType==="absolute"))}_processAutoIndent(t,e,i,s={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}},n,o){if(n.some(a=>a.autoIndent)){let{top:a,bottom:l,left:h,right:d}=this._checkAutoIndent(n,o);(a||l||h||d)&&(this.topCurrent=o.top+a,this.bottomCurrent=o.bottom-l,this.leftCurrent=o.left+h,this.rightCurrent=o.right-d,this.layoutRegionItems(t,e,i,s))}}layoutNormalItems(t){t.forEach(e=>{let i=this.getItemComputeLayoutRect(e),s=e.computeBoundsInRect(i);e.setLayoutRect(s),e.layoutOrient==="left"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.leftCurrent+=s.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="top"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=s.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient==="right"?(e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX-s.width-e.layoutPaddingRight,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.rightCurrent-=s.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="bottom"&&(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingRight,y:this.bottomCurrent+e.layoutOffsetY-s.height-e.layoutPaddingBottom}),this.bottomCurrent-=s.height+e.layoutPaddingTop+e.layoutPaddingBottom)})}layoutNormalInlineItems(t){let e=t.filter(l=>l.layoutOrient==="left"),i=t.filter(l=>l.layoutOrient==="right"),s=t.filter(l=>l.layoutOrient==="top"),n=t.filter(l=>l.layoutOrient==="bottom"),o=this._chartLayoutRect.width+this._chartLayoutRect.x,a=this._chartLayoutRect.height+this._chartLayoutRect.y;e.length&&oz(e,this,a),s.length&&lz(s,this,o),i.length&&az(i,this,a),n.length&&hz(n,this,o)}_layoutRelativeOverlap(t,e){e.items.forEach(i=>{let s=this.getItemComputeLayoutRect(i),n=i.computeBoundsInRect(s);e.rect.width=Math.max(n.width+i.layoutPaddingLeft+i.layoutPaddingRight,e.rect.width),e.rect.height=Math.max(n.height+i.layoutPaddingTop+i.layoutPaddingBottom,e.rect.height)}),e.items.forEach(i=>{i.setLayoutRect(e.rect),t==="left"?i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX}):t==="right"?i.setLayoutStartPosition({x:this.rightCurrent-e.rect.width+i.layoutOffsetX}):t==="top"?i.setLayoutStartPosition({x:this.topCurrent+i.layoutOffsetY}):i.setLayoutStartPosition({x:this.bottomCurrent-e.rect.height+i.layoutOffsetY})}),t==="left"?this.leftCurrent+=e.rect.width:t==="right"?this.rightCurrent-=e.rect.width:t==="top"?this.topCurrent+=e.rect.height:this.bottomCurrent-=e.rect.height}_layoutRelativeItem(t,e){let i=t.computeBoundsInRect(e);t.layoutOrient==="left"||t.layoutOrient==="right"?t.setLayoutRect({width:i.width}):t.setLayoutRect({height:i.height}),t.layoutOrient==="left"?(t.setLayoutStartPosition({x:this.leftCurrent+t.layoutOffsetX+t.layoutPaddingLeft}),this.leftCurrent+=i.width+t.layoutPaddingLeft+t.layoutPaddingRight):t.layoutOrient==="right"?(this.rightCurrent-=i.width+t.layoutPaddingLeft+t.layoutPaddingRight,t.setLayoutStartPosition({x:this.rightCurrent+t.layoutOffsetX+t.layoutPaddingLeft})):t.layoutOrient==="top"?(t.setLayoutStartPosition({y:this.topCurrent+t.layoutOffsetY+t.layoutPaddingTop}),this.topCurrent+=i.height+t.layoutPaddingTop+t.layoutPaddingBottom):t.layoutOrient==="bottom"&&(this.bottomCurrent-=i.height+t.layoutPaddingTop+t.layoutPaddingBottom,t.setLayoutStartPosition({y:this.bottomCurrent+t.layoutOffsetY+t.layoutPaddingTop}))}_layoutRegionItem(t,e,i){let s=Math.max(Math.min(e,...t.map(o=>{var a;return(a=o.maxWidth)!==null&&a!==void 0?a:Number.MAX_VALUE})),0),n=Math.max(Math.min(i,...t.map(o=>{var a;return(a=o.maxHeight)!==null&&a!==void 0?a:Number.MAX_VALUE})),0);return t.forEach(o=>{let a=s-o.layoutPaddingLeft-o.layoutPaddingRight,l=n-o.layoutPaddingTop-o.layoutPaddingBottom;o.setLayoutRect({width:a,height:l}),o.setLayoutStartPosition({x:this.leftCurrent+o.layoutOffsetX+o.layoutPaddingLeft,y:this.topCurrent+o.layoutOffsetY+o.layoutPaddingTop})}),{regionHeight:n,regionWidth:s}}layoutRegionItems(t,e,i,s={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}}){let n=this.rightCurrent-this.leftCurrent,o=this.bottomCurrent-this.topCurrent;e.filter(h=>h.layoutOrient==="left"||h.layoutOrient==="right").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("left",s.left),this._layoutRelativeOverlap("right",s.right),n=this.rightCurrent-this.leftCurrent,e.filter(h=>h.layoutOrient==="top"||h.layoutOrient==="bottom").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("top",s.top),this._layoutRelativeOverlap("bottom",s.bottom),o=this.bottomCurrent-this.topCurrent;let{regionWidth:a,regionHeight:l}=this._layoutRegionItem(t,n,o);e.concat(i).forEach(h=>{if(["left","right"].includes(h.layoutOrient)){let d=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({height:d.getLayoutRect().height}),h.setLayoutStartPosition({y:d.getLayoutStartPoint().y+h.layoutOffsetY+h.layoutPaddingTop}),h.layoutOrient==="right"&&h.setLayoutStartPosition({x:h.getLayoutStartPoint().x+a-n})}else if(["top","bottom"].includes(h.layoutOrient)){let d=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({width:d.getLayoutRect().width}),h.setLayoutStartPosition({x:d.getLayoutStartPoint().x+h.layoutOffsetX+h.layoutPaddingLeft}),h.layoutOrient==="bottom"&&h.setLayoutStartPosition({y:h.getLayoutStartPoint().y+l-o})}})}layoutAbsoluteItems(t){t.forEach(e=>{e.absoluteLayoutInRect(this._chartLayoutRect)})}filterRegionsWithID(t,e){var i;let s=t.find(n=>n.getModelId()===e);return s||((i=this._onError)!==null&&i!==void 0?i:ia)("can not find target region item, invalid id"),s}getItemComputeLayoutRect(t){return{width:this.rightCurrent-this.leftCurrent-t.layoutPaddingLeft-t.layoutPaddingRight,height:this.bottomCurrent-this.topCurrent-t.layoutPaddingTop-t.layoutPaddingBottom}}_checkAutoIndent(t,e){let i={top:0,left:0,bottom:0,right:0};return t.forEach(s=>{if(!s.getModelVisible()||!s.autoIndent)return;let n=s.layoutOrient==="left"||s.layoutOrient==="right",o=s.getLastComputeOutBounds(),a=this._getOutInLayout(o,s,e);n?(i.top=Math.max(i.top,a.top),i.bottom=Math.max(i.bottom,a.bottom)):(i.left=Math.max(i.left,a.left),i.right=Math.max(i.right,a.right))}),i}_getOutInLayout(t,e,i){let{x:s,y:n}=e.getLayoutStartPoint(),{width:o,height:a}=e.getLayoutRect();return{left:i.left-(s-t.x1),right:s+o+t.x2-i.right,top:i.top-(n-t.y1),bottom:n+a+t.y2-i.bottom}}};j_.type="base";var ZE=["linear","radial","conical"],w$={x0:0,y0:0,x1:1,y1:1},P$={x0:0,y0:0,x1:1,y1:1,r0:0,r1:1},R$={x:.5,y:.5,startAngle:0,endAngle:2*Math.PI},dz={linear:w$,radial:P$,conical:R$};var B$=["line","area","trail"];function o1(r){return B$.includes(r)}function cz(r,t){return r==="monotone"?t==="horizontal"?"monotoneY":"monotoneX":r}function uz(r){return["arc3d","rect3d","pyramid3d"].includes(r)}var a1=class extends up{getStateInfoList(){return this._stateInfoList}constructor(t,e){super(t),this._stateInfoList=[],this._mark=e}_getDefaultStateMap(){return{markUpdateRank:1}}getStateInfo(t){return this._stateInfoList.find(e=>e.stateValue===t)}addStateInfo(t){if(this.getStateInfo(t.stateValue))return;t.level=t.level||0;let e=!0;for(let i=0;i<this._stateInfoList.length;i++){let s=this._stateInfoList[i].level;if(s&&s>t.level){this._stateInfoList.splice(i,0,t),e=!1;break}}e&&this._stateInfoList.push(t)}_clearStateBeforeSet(t){t.datums=null,t.items=null,t.fields=null,t.filter=null}changeStateInfo(t){let e=this.getStateInfo(t.stateValue);if(e){if(t.datums!==void 0&&(this._clearStateBeforeSet(e),e.datums=t.datums,e.datumKeys=t.datumKeys),t.items!==void 0&&(this._clearStateBeforeSet(e),e.items=t.items),t.fields!==void 0)if(this._clearStateBeforeSet(e),t.fields===null)e.fields=t.fields;else{e.fields=e.fields||{};for(let i in t.fields){let s=t.fields[i];e.fields[i]=e.fields[i]||{};let n=e.fields[i];A(s.domain)&&(n.domain=s.domain),A(s.type)&&(n.type=s.type)}}t.filter&&(this._clearStateBeforeSet(e),e.filter=t.filter)}else this.addStateInfo(t)}clearStateInfo(t){t.forEach(e=>{this.getStateInfo(e)&&this.changeStateInfo({stateValue:e,datumKeys:null,datums:null,fields:null,items:null,filter:null,cache:{}})})}checkOneState(t,e,i,s){var n;s=te(o1)?s:!t.mark||o1(t.mark.markType);let o=!1,a=!1;if(A(i.datums)&&i.datums.length>0)o=this.checkDatumState(i,e,s),a=!0;else if(i.items)o=(n=this.checkItemsState(i,t))!==null&&n!==void 0&&n,a=!0;else if(i.fields)o=this.checkFieldsState(i,e,t,s),a=!0;else if(!o&&i.filter){let l={mark:this._mark,renderNode:t,type:t.mark.markType};o=i.filter(e,l),a=!0}return a?o?"in":"out":"skip"}checkState(t,e){let i=t.getStates().filter(n=>iz(n)).map(n=>[n,10]),s=!t.mark||o1(t.mark.markType);for(let n=0;n<this._stateInfoList.length;n++){let o=this._stateInfoList[n],a=this.checkOneState(t,e,o,s);a!=="skip"&&a==="in"&&i.push([o.stateValue,o.level])}return i.map(n=>n[0])}checkDatumState(t,e,i){let s=!1,n=i?e[0]:e;if(H(t.datums)){let o=t.datumKeys||Object.keys(t.datums[0]).filter(a=>!a.startsWith(et));s=t.datums.some(a=>i&&H(a?.items)?o.every(l=>{var h,d;return((d=(h=a?.items)===null||h===void 0?void 0:h[0])===null||d===void 0?void 0:d[l])===n?.[l]}):o.every(l=>a?.[l]===n?.[l]))}else ct(t.datums)?s=(t.datumKeys||Object.keys(t.datums).filter(o=>!o.startsWith(et))).every(o=>{var a,l;return i?((a=t.datums.items)===null||a===void 0?void 0:a[0][o])===n[o]:((l=t.datums)===null||l===void 0?void 0:l[o])===n[o]}):s=e===t.datums;return s}checkItemsState(t,e){var i;return(i=t.items)===null||i===void 0?void 0:i.includes(e)}checkFieldsState(t,e,i,s){var n;let o=!0;for(let a in t.fields){let l=t.fields[a],h=l.type,d=l.domain,c=s?(n=e[0])===null||n===void 0?void 0:n[a]:e[a];if(Vt(h)&&d.length>1){if(this.checkLinearFieldState(d,a,e,i,s)){o=!1;break}o=!0}else{if(!d.some(u=>u===c)){o=!1;break}o=!0}}return o}checkLinearFieldState(t,e,i,s,n){var o;let a=n?(o=i[0])===null||o===void 0?void 0:o[e]:i[e];return a<t[0]||a>t[t.length-1]}updateLayoutState(t){return this._stateMap.markUpdateRank++,this.updateState({markUpdateRank:this._stateMap.markUpdateRank},t)}compileState(t,e){t.state({callback:(i,s)=>this.checkState(s,i)},e)}};var Ii=class extends Hl{getDataView(){return this._data}setDataView(t){this._data=t}getLatestData(){var t;return(t=this._data)===null||t===void 0?void 0:t.latestData}constructor(t,e){super(t),this.grammarType=Qs.data,this._data=null,this._data=e}release(){super.release(),this._data=null}updateData(t){let e=this.getProduct(),i=this.getLatestData();if(e&&i&&(e.values(i),!t))return this.getCompiler().renderNextTick()}_compileProduct(){let t=this.getLatestData();T(t)||(T(this.getProduct())?this._initProduct(t):this._product.values(t))}_initProduct(t){var e,i;let s=this.getVGrammarView();if(!s||!t)return;let n=this.getProductId();this._product=(i=(e=s?.data)===null||e===void 0?void 0:e.call(s,t))===null||i===void 0?void 0:i.id(n),this._compiledProductId=n}generateProductId(){var t;return`${(t=this.getDataView())===null||t===void 0?void 0:t.name}`}_lookupGrammar(t){var e,i;return(i=(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getDataById)===null||i===void 0?void 0:i.call(e,t)}};var l1=class extends Ii{constructor(t){super(t),this._mark=t.mark}setCompiledProductId(t){this._compiledProductId=t}generateProductId(){let t=super.generateProductId();return A(t)?t:`${et}_markData_${this._mark.id}`}_compileProduct(){var t;let e=(t=this._data)===null||t===void 0?void 0:t.latestData;T(e)||A(this.getProduct())||this._initProduct(e)}};var pz=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},h1=class extends Hl{getMarkConfig(){return this._markConfig}setMarkConfig(t){Object.keys(t).forEach(e=>{this._markConfig[e]=t[e]})}getVisible(){return this._visible}setVisible(t){this._visible=t}getUserId(){return this._userId}setUserId(t){A(t)&&(this._userId=t)}getDataView(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}setDataView(t,e){T(this._data)&&this.initMarkData(Object.assign(Object.assign({},this._option),{mark:this})),A(e)&&this._data.setCompiledProductId(e),this._data.setDataView(t)}getData(){return this._data}setData(t){this._data=t}hasState(t){return t in this.state.getStateMap()}getState(t){return this.state.getStateMap()[t]}getAnimationConfig(){return this._animationConfig}setAnimationConfig(t){this._animationConfig=t}setSkipBeforeLayouted(t){this._skipBeforeLayouted=t}getSkipBeforeLayouted(){return this._skipBeforeLayouted}getGroupKey(){return this._groupKey}setGroupKey(t){this._groupKey=t}setStateSortCallback(t){this._stateSort=t}constructor(t,e,i){super(t),this.grammarType=Qs.mark,this.type=void 0,this.name="mark",this._markConfig={zIndex:Tt.Mark,morph:!1},this._visible=!0,this.stateStyle={},this._unCompileChannel={},this._skipBeforeLayouted=!1,this.name=e,this.model=i,this.key=t.key,this.state=new a1(Object.assign(Object.assign({},t),{stateKeyToSignalName:this.stateKeyToSignalName.bind(this)}),this),this._event=new ko(i.getOption().eventDispatcher,i.getOption().mode)}setTransform(t){this._transform=t}initMarkData(t){this._data=new l1(t)}stateKeyToSignalName(t){return`${et}_${this.type}_${this.id}_${t}`}getAttribute(t,e,i,s){}_compileProduct(t){let e=this.getProduct();if(!this.getVisible())return void(A(e)&&this.removeProduct());A(e)||this.getCompiler().isInited&&(this._initProduct(t?.group),T(this._product)||(this.compileSignal(),this.compileData(),this.compileState(),this.compileEncode(),this.compileAnimation(),this.compileContext(t?.context),this.compileTransform()))}_initProduct(t){let e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(this.type,t??e.rootMark).id(i),this.name&&this._product&&this._product.name(this.name),this._compiledProductId=i}generateProductId(){return this._userId?`${this._userId}`:`${this.name}_${this.id}`}compileData(){if(T(this._data))return;this._data.compile();let t=this._data.getProduct();A(this._product)&&A(t)&&this._product.join(t,this.key,void 0,this.getGroupKey())}updateStaticEncode(){if(!this._product)return;let{enterStyles:t,updateStyles:e}=this._separateStyle();this._product.encodeState("group",t,!0),this._product.encode(e,!0)}_separateStyle(){let t=this.stateStyle,e=it.STATE_NORMAL,i=t[e],s=(pz(t,[typeof e=="symbol"?e:e+""]),this._option.noSeparateStyle?null:{}),n={};return Object.keys(i).forEach(o=>{this._unCompileChannel[o]||(this._option.noSeparateStyle||tz(o,i,this.getGroupKey())?n[o]={callback:this.compileCommonAttributeCallback(o,"normal"),dependency:[this.stateKeyToSignalName("markUpdateRank")]}:s[o]=this.compileCommonAttributeCallback(o,"normal"))}),{enterStyles:s,updateStyles:n}}compileEncode(){let t=this.stateStyle,e=it.STATE_NORMAL,i=(t[e],pz(t,[typeof e=="symbol"?e:e+""])),{enterStyles:s,updateStyles:n}=this._separateStyle();this._product.encode(n,!0),this._product.encodeState("group",s,!0),Object.keys(i).forEach(o=>{let a={};Object.keys(i[o]).forEach(l=>{this._unCompileChannel[l]||(a[l]={callback:this.compileCommonAttributeCallback(l,o),dependency:[this.stateKeyToSignalName("markUpdateRank")]})}),this._product.encodeState(o,a,!0)}),this._skipBeforeLayouted&&this._product.layout({skipBeforeLayouted:this._skipBeforeLayouted})}compileState(){this.state.compileState(this._product,this._stateSort)}compileAnimation(){var t,e,i,s;if(this._animationConfig){let n;if(this.type==="component")n=(t=this.model.animate)===null||t===void 0?void 0:t.getAnimationStateSignalName();else{let o=(i=(e=this.model).getRegion)===null||i===void 0?void 0:i.call(e);n=(s=o?.animate)===null||s===void 0?void 0:s.getAnimationStateSignalName()}this._product.animation(this._animationConfig),this._product.animationState({callback:(o,a,l)=>{var h;return(h=l[n])===null||h===void 0?void 0:h.callback(o,a)},dependency:n}),this._animationConfig.normal&&(this._animationConfig.appear?this._event.on(pt.ANIMATION_END,({event:o})=>{o.mark===this.getProduct()&&o.animationState===_i.appear&&this.runAnimationByState(_i.normal)}):this._event.on(pt.AFTER_DO_RENDER,()=>{this.runAnimationByState(_i.normal)}))}}compileContext(t){let e=Object.assign(Object.assign({},this._markConfig),{context:Object.assign({markId:this.id,modelId:this.model.id,markUserId:this._userId,modelUserId:this.model.userId},t)});this._product.configure(e)}compileSignal(){this.state.compile()}_computeAttribute(t,e){return(i,s)=>{}}compileCommonAttributeCallback(t,e){let i=this._computeAttribute(t,e),s={mark:null,parent:null,element:null};return(n,o)=>(s.mark=o.mark,s.parent=o.mark.group,s.element=o,i(n,s))}compileTransform(){var t;!((t=this._transform)===null||t===void 0)&&t.length&&this.getProduct().transform(this._transform)}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getMarkById(t)}updateState(t,e){return this.state.updateState(t,e)}updateLayoutState(t,e){return e&&this.getMarks().length>0&&this.getMarks().forEach(i=>i.state.updateLayoutState(!0)),this.state.updateLayoutState(t)}updateMarkState(t){if(!this._product)return;let e=this.state.getStateInfo(t);this._product.elements.forEach(i=>{this.state.checkOneState(i,i.getDatum(),e)==="in"?i.addState(t):i.removeState(t)})}getMarks(){return[]}runAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.runAnimationByState(t)}stopAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.stopAnimationByState(t)}pauseAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.pauseAnimationByState(t)}resumeAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.resumeAnimationByState(t)}getProductElements(){let t=this.getProduct();if(t)return t.elements}release(){super.release(),this.state.release()}};var mz=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Te=class extends h1{constructor(t,e){var i;super(e,t,e.model),this._extensionChannel={},this._computeExChannel={},this._attributeContext=e.attributeContext,(i=e.map)===null||i===void 0||i.set(this.id,this)}created(){this._initStyle()}initStyleWithSpec(t,e){t&&(A(t.id)&&(this._userId=t.id),te(t.interactive)&&(this._markConfig.interactive=t.interactive),A(t.zIndex)&&(this._markConfig.zIndex=t.zIndex),te(t.visible)&&this.setVisible(t.visible),this._initSpecStyle(t,this.stateStyle,e))}_transformStyleValue(t,e){if(t.scale){let i=t.scale,s=i.range();return i.range(s.map(e)),t}return typeof t=="function"?(...i)=>e(t(...i)):e(t)}convertAngleToRadian(t){return this._transformStyleValue(t,Ut)}isUserLevel(t){return[X.User_Mark,X.User_Series,X.User_Chart,X.User_SeriesStyle].includes(t)}setStyle(t,e="normal",i=0,s=this.stateStyle){if(T(t))return;s[e]===void 0&&(s[e]={});let n=this.isUserLevel(i);Object.keys(t).forEach(o=>{let a=t[o];T(a)||(a=this._filterAttribute(o,a,e,i,n,s),this.setAttribute(o,a,e,i,s))})}getStyle(t,e="normal"){var i;return(i=this.stateStyle[e][t])===null||i===void 0?void 0:i.style}_filterAttribute(t,e,i,s,n,o=this.stateStyle){let a=this._styleConvert(e);if(n)switch(t){case"angle":a=this.convertAngleToRadian(a);break;case"innerPadding":case"outerPadding":a=this._transformStyleValue(a,l=>-l);break;case"curveType":a=this._transformStyleValue(a,l=>cz(l,this._option.model.direction))}return a}setReferer(t,e,i,s=this.stateStyle){var n;if(t)if(e&&i){let o=(n=s[i])!==null&&n!==void 0?n:{[e]:{}};s[i][e]=Object.assign(Object.assign({},o[e]),{referer:t})}else Object.entries(s).forEach(([o,a])=>{Object.entries(a).forEach(([l,h])=>{s[o][l].referer=t})})}setPostProcess(t,e,i="normal"){var s;!((s=this.stateStyle[i])===null||s===void 0)&&s[t]&&(this.stateStyle[i][t].postProcess=e)}getAttribute(t,e,i="normal",s){return this._computeAttribute(t,i)(e,s)}setAttribute(t,e,i="normal",s=0,n=this.stateStyle){var o;n[i]===void 0&&(n[i]={}),n[i][t]===void 0&&(n[i][t]={level:s,style:e,referer:void 0});let a=(o=n[i][t])===null||o===void 0?void 0:o.level;A(a)&&a<=s&&ot(n[i][t],{style:e,level:s}),i!=="normal"&&t in this._extensionChannel&&this._extensionChannel[t].forEach(l=>{n[i][l]===void 0&&(n[i][l]=n.normal[l])})}_getDefaultStyle(){return{visible:!0,x:0,y:0}}_styleConvert(t){if(!t)return t;if(Kf(t.type)||t.scale){let e=FH(t,{globalScale:this._option.globalScale,seriesId:this._option.seriesId});if(e)return{scale:e,field:t.field,changeDomain:t.changeDomain}}return t}_computeAttribute(t,e){var i;let s=(i=this.stateStyle[e])===null||i===void 0?void 0:i[t];s||(s=this.stateStyle.normal[t]);let n=this._computeStateAttribute(s,t,e),o=V(s?.postProcess),a=t in this._computeExChannel;if(o&&a){let l=this._computeExChannel[t];return(h,d)=>{let c=n(h,d);return c=s.postProcess(c,h,this._attributeContext,d,this.getDataView()),l(t,h,e,d,c)}}if(o)return(l,h)=>s.postProcess(n(l,h),l,this._attributeContext,h,this.getDataView());if(a){let l=this._computeExChannel[t];return(h,d)=>l(t,h,e,d,n(h,d))}return n}_computeStateAttribute(t,e,i){var s;return t?t.referer?t.referer._computeAttribute(e,i):t.style?typeof t.style=="function"?(n,o)=>t.style(n,this._attributeContext,o,this.getDataView()):ZE.includes(t.style.gradient)?this._computeGradientAttr(t.style):["outerBorder","innerBorder"].includes(e)?this._computeBorderAttr(t.style):Kf((s=t.style.scale)===null||s===void 0?void 0:s.type)?(n,o)=>{let a=n;return this.model.modelType==="series"&&this.model.getMarkData&&(a=this.model.getMarkData(n)),t.style.scale.scale(a[t.style.field])}:(n,o)=>t.style:(n,o)=>t.style:(n,o)=>{}}_initStyle(){let t=this._getDefaultStyle();this.setStyle(t,"normal",0)}_initSpecStyle(t,e,i){t.style&&this.setStyle(t.style,"normal",X.User_Mark,e);let s=t.state;s&&Object.keys(s).forEach(n=>{let o=s[n];if("style"in o){let a=o.style,l={stateValue:n};"level"in o&&(l.level=o.level),"filter"in o&&(l=V(o.filter)?Object.assign({filter:o.filter},l):Object.assign(Object.assign({},o.filter),l)),this.state.addStateInfo(l),this.setStyle(a,n,X.User_Mark,e)}else this.setStyle(o,n,X.User_Mark,e)})}_computeGradientAttr(t){var e,i;let{gradient:s,scale:n,field:o}=t,a=mz(t,["gradient","scale","field"]),l=n,h=o;if(!(n&&o||this.model.modelType!=="series")){let{scale:u,field:p}=this.model.getColorAttribute();n||(l=u),h||(h=p)}let d=g_(Cl(this.model.getColorScheme(),this.model.modelType==="series"?(i=(e=this.model).getSpec)===null||i===void 0?void 0:i.call(e):void 0),this.model.getDefaultColorDomain()),c=Object.assign(Object.assign({},dz[s]),a);return(u,p)=>{let m={},g=this.getDataView();return Object.keys(c).forEach(f=>{let _=c[f];f==="stops"?m.stops=_.map(v=>{let{opacity:x,color:y,offset:b}=v,S=y??l?.scale(u[h]);return V(y)&&(S=y(u,this._attributeContext,p,g)),A(x)&&(S=Di.SetOpacity(S,x)),{offset:V(b)?b(u,this._attributeContext,p,g):b,color:S||d[0]}}):V(_)?m[f]=_(u,this._attributeContext,p,g):m[f]=_}),m.gradient=s,m}}_computeBorderAttr(t){let{scale:e,field:i}=t,s=mz(t,["scale","field"]);return(n,o)=>{var a,l,h;let d={};if(Object.keys(s).forEach(c=>{let u=s[c];V(u)?d[c]=u(n,this._attributeContext,o,this.getDataView()):d[c]=u}),"stroke"in d)ZE.includes((h=s.stroke)===null||h===void 0?void 0:h.gradient)&&(d.stroke=this._computeGradientAttr(s.stroke)(n,o));else{let c=g_(Cl(this.model.getColorScheme(),this.model.modelType==="series"?(l=(a=this.model).getSpec)===null||l===void 0?void 0:l.call(a):void 0),this.model.getDefaultColorDomain()),u=e,p=i;if(!(e&&i||this.model.modelType!=="series")){let{scale:m,field:g}=this.model.getColorAttribute();e||(u=m),p||(p=g),d.stroke=u?.scale(n[p])||c[0]}}return d}}};var z_=class r extends Te{constructor(){super(...arguments),this.type=r.type,this._marks=[]}getMarks(){return this._marks}_getDefaultStyle(){return Object.assign({},super._getDefaultStyle())}isMarkExist(t){return this._marks.find(e=>e.id===t.id)!==void 0}addMark(t){return this.isMarkExist(t)?(ji("Mark already exists, add mark failed."),!1):(this._marks.push(t),!0)}removeMark(t){let e=this._marks.findIndex(i=>i.id===t.id||i.name===t.name);return e===-1?(ji("Mark does not exists, removeMark failed."),!1):(this._marks.splice(e,1),!0)}getMarkInType(t){return this._marks.filter(e=>e.type===t)}getMarkInId(t){return this._marks.find(e=>e.id===t)}getMarkInUserId(t){let e;if(this._marks.forEach(i=>{i.getUserId()===t&&(e=i)}),!e)for(let i=0;i<this._marks.length;i++){let s=this._marks[i];if(s.type==="group"&&(e=s.getMarkInUserId(t)),e)break}return e}getMarkInName(t){return this._marks.filter(e=>e.name===t)}_compileProduct(t){super._compileProduct(t),this._product.configure({zIndex:this._markConfig.zIndex}),t?.ignoreChildren||this.getMarks().forEach(e=>{e.getProduct()&&e.removeProduct(),e.compile({group:this._product})})}};z_.type="group";var JE=()=>{gj(),I.registerMark(z_.type,z_)};var gz={measureText:gA};var Bn=class r{static instance(){return r.instance_||(r.instance_=new r),r.instance_}constructor(){this.functions={}}registerFunction(t,e){t&&e&&(this.functions[t]=e)}unregisterFunction(t){t&&delete this.functions[t]}getFunction(t){return this.functions[t]||null}getFunctionNameList(){return Object.keys(this.functions)}};var fz=()=>{Ef(yt)};var _z=()=>{Rf(yt)};var vz=()=>{Lf(yt)};var gp=class{constructor(){this.id=ts(),this._plugins=[]}add(t){if(!t||t.length===0)return null;let e=[];return t.forEach(i=>{this._plugins.find(s=>s.id===i.id)?ji("\u4E0D\u8981\u91CD\u590D\u6DFB\u52A0\u76F8\u540C\u7684plugin"):(this._plugins.push(i),e.push(i),i.onAdd&&i.onAdd(this))}),e}load(t){let e=this.add(t);e&&e.length&&this.activate(t)}activate(t){t.length&&t.forEach(e=>{e.init&&e.init()})}get(t){return this._plugins.find(e=>e.id===t)}getAll(){return this._plugins.slice()}release(t){let e=this.get(t);e&&(e.release(this),this._plugins=this._plugins.filter(i=>i!==e))}releaseAll(){this._plugins.forEach(t=>{t.release(this)}),this._plugins=[]}clear(t){let e=this.get(t);e&&e.clear(this)}clearAll(){this._plugins.forEach(t=>{var e;(e=t.clear)===null||e===void 0||e.call(t,this)})}};var d1=class extends gp{constructor(t){super(),this.globalInstance=t}onInit(t){this._plugins.forEach(e=>{e.onInit&&e.onInit(this,t)})}onBeforeResize(t,e){this._plugins.forEach(i=>{i.onBeforeResize&&i.onBeforeResize(this,t,e)})}onAfterChartSpecTransform(t,e){this._plugins.forEach(i=>{i.onAfterChartSpecTransform&&i.onAfterChartSpecTransform(this,t,e)})}onAfterModelSpecTransform(t,e,i){this._plugins.forEach(s=>{s.onAfterModelSpecTransform&&s.onAfterModelSpecTransform(this,t,e,i)})}onBeforeInitChart(t,e){this._plugins.forEach(i=>{i.onBeforeInitChart&&i.onBeforeInitChart(this,t,e)})}releaseAll(){super.releaseAll(),this.globalInstance=null}};var G_=new Map;function c1(r){return G_.get(r)}var Ln=function(r,t,e,i){return new(e||(e=Promise))(function(s,n){function o(h){try{l(i.next(h))}catch(d){n(d)}}function a(h){try{l(i.throw(h))}catch(d){n(d)}}function l(h){var d;h.done?s(h.value):(d=h.value,d instanceof e?d:new e(function(c){c(d)})).then(o,a)}l((i=i.apply(r,t||[])).next())})},L$=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},$i=class r{static useRegisters(t){t.forEach(e=>{typeof e=="function"?e():console.error("Invalid function:",e)})}static useChart(t){t.forEach(e=>I.registerChart(e.type,e))}static useSeries(t){t.forEach(e=>I.registerSeries(e.type,e))}static useComponent(t){t.forEach(e=>I.registerComponent(e.type,e))}static useMark(t){t.forEach(e=>{var i;return I.registerMark((i=e.constructorType)!==null&&i!==void 0?i:e.type,e)})}static useLayout(t){t.forEach(e=>I.registerLayout(e.type,e))}static registerDataSetTransform(t,e){I.registerTransform(t,e)}static registerFunction(t,e){t&&e&&Bn.instance().registerFunction(t,e)}static unregisterFunction(t){t&&Bn.instance().unregisterFunction(t)}static getFunction(t){return t?Bn.instance().getFunction(t):null}static getFunctionList(){return Bn.instance().getFunctionNameList()}static registerMap(t,e,i){let s=I.getImplementInKey("registerMap");s&&s(t,e,i)}static unregisterMap(t){let e=I.getImplementInKey("unregisterMap");e&&e(t)}static getMap(t){return $j(t)}static registerSVG(t,e,i){let s=I.getImplementInKey("registerSVG");s&&s(t,e,i)}static unregisterSVG(t){let e=I.getImplementInKey("unregisterSVG");e&&e(t)}static getSVG(t){return c1(t)}static hideTooltip(t=[]){vo.forEach(e=>{var i;return(i=e?.hideTooltip)===null||i===void 0?void 0:i.call(e)},t)}static getLogger(){return Nt.getInstance()}getSpec(){return this._spec}getSpecInfo(){return this._specInfo}getDataSet(){return this._dataSet}constructor(t,e){var i,s,n,o,a,l,h,d;this.id=ts(),this._userEvents=[],this._autoSize=!0,this._option={mode:ze["desktop-browser"],onError:b=>{throw new Error(b)},optimize:{disableCheckGraphicWidthOutRange:!0}},this._observer=null,this._context={},this._doResize=()=>{let{width:b,height:S}=this.getCurrentSize();this._currentSize.width===b&&this._currentSize.height===S||(this._currentSize={width:b,height:S},this.resizeSync(b,S))},this._renderSync=(b={})=>{var S;let C=this;return this._beforeRender(b)&&((S=this._compiler)===null||S===void 0||S.render(b.morphConfig),this._afterRender()),C},this._updateSpec=(b,S=!1,C)=>{var k,M;let E=this._spec,D={changeBackground:!1,reTransformSpec:!1,change:!1,reMake:!1,reCompile:!1,reSize:!1,changeTheme:!1};if(!this._setNewSpec(b,S))return;Bt(E.theme,this._spec.theme)?Bt(this._spec.background,E.background)||(D.reMake=!0,D.changeBackground=!0):D.changeTheme=!0;let P=this._shouldChartResize(E);if(D.reSize=P,this._spec.type!==E.type)return(M=(k=this._compiler)===null||k===void 0?void 0:k.getVGrammarView())===null||M===void 0||M.updateLayoutTag(),D.reMake=!0,D.reTransformSpec=!0,D.change=!0,D.changeTheme=!0,D;this._initChartSpec(this._spec,"updateSpec");let B=Fl(this._chart.updateSpec(this._spec),D);return C?Object.assign(Object.assign({},B),C):B},this._option=G(this._option,{animation:t.animation!==!1},e),this._onError=(i=this._option)===null||i===void 0?void 0:i.onError;let c=this._option,{dom:u,renderCanvas:p,mode:m,stage:g,poptip:f}=c,_=L$(c,["dom","renderCanvas","mode","stage","poptip"]),v=jr(m);if(v?fz():m==="node"&&_z(),v&&u&&(this._container=Z(u)?kt.getElementById(u):u),p&&(this._canvas=p),g&&(this._stage=g),m!=="node"&&!this._container&&!this._canvas&&!this._stage)return void((s=this._option)===null||s===void 0||s.onError("please specify container or renderCanvas!"));this._viewBox=this._option.viewBox,this._currentThemeName=Dn.getCurrentThemeName(),this._setNewSpec(t),this._updateCurrentTheme(),this._currentSize=this.getCurrentSize();let x=[];!f&&x.push("poptipForText"),t.type==="sankey"&&x.push("scrollbar");let y=Object.assign({},_.performanceHook||{});Object.keys(y).forEach(b=>{_.performanceHook[b]=(...S)=>{y[b](...S,this)}}),this._compiler=new KA({dom:(n=this._container)!==null&&n!==void 0?n:"none",canvas:p},Object.assign(Object.assign({mode:this._option.mode,stage:g,pluginList:x},_),{background:this._getBackground(),onError:this._onError})),this._compiler.setSize(this._currentSize.width,this._currentSize.height),this._eventDispatcher=new YA(this,this._compiler),this._event=new ko(this._eventDispatcher,m),this._compiler.initView(),this._setFontFamilyTheme((o=this._currentTheme)===null||o===void 0?void 0:o.fontFamily),this._initDataSet(this._option.dataSet),this._autoSize=!!v&&((l=(a=t.autoFit)!==null&&a!==void 0?a:this._option.autoFit)===null||l===void 0||l),this._bindResizeEvent(),this._bindVGrammarViewEvent(),this._initChartPlugin(),vo.registerInstance(this),(d=(h=this._option.performanceHook)===null||h===void 0?void 0:h.afterCreateVChart)===null||d===void 0||d.call(h,this)}_setNewSpec(t,e){return!!t&&(Z(t)&&(t=JSON.parse(t)),e&&this._originalSpec&&(t=ot({},this._originalSpec,t)),this._originalSpec=t,this._spec=this._getSpecFromOriginalSpec(),!0)}_getSpecFromOriginalSpec(){var t;let e=pA(this._originalSpec);return e.data=(t=e.data)!==null&&t!==void 0?t:[],e}_initChartSpec(t,e){var i,s;r.getFunctionList()&&r.getFunctionList().length&&(t=mA(t,r)),this._spec=t,this._chartSpecTransformer||(this._chartSpecTransformer=I.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),(i=this._chartSpecTransformer)===null||i===void 0||i.transformSpec(this._spec),this._chartPluginApply("onAfterChartSpecTransform",this._spec,e),this._specInfo=(s=this._chartSpecTransformer)===null||s===void 0?void 0:s.transformModelSpec(this._spec),this._chartPluginApply("onAfterModelSpecTransform",this._spec,this._specInfo,e)}_updateSpecInfo(){var t;this._chartSpecTransformer||(this._chartSpecTransformer=I.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),this._specInfo=(t=this._chartSpecTransformer)===null||t===void 0?void 0:t.createSpecInfo(this._spec)}_initChart(t){var e,i,s;if(!this._compiler)return void((e=this._option)===null||e===void 0||e.onError("compiler is not initialized"));if(this._chart)return void((i=this._option)===null||i===void 0||i.onError("chart is already initialized"));let n=I.createChart(t.type,t,this._getChartOption(t.type));n?(this._chart=n,this._chart.setCanvasRect(this._currentSize.width,this._currentSize.height),this._chart.created(this._chartSpecTransformer),this._chart.init(),this._event.emit(rt.initialized,{chart:n,vchart:this})):(s=this._option)===null||s===void 0||s.onError("init chart fail")}_releaseData(){this._dataSet&&(this._dataSet.dataViewMap={},this._dataSet=null)}_bindVGrammarViewEvent(){if(!this._compiler)return;let t=this._compiler.getVGrammarView();t.addEventListener(pt.ALL_ANIMATION_END,()=>{this._event.emit(rt.animationFinished,{chart:this._chart,vchart:this})}),t.addEventListener(pt.AFTER_VRENDER_NEXT_RENDER,()=>{this._event.emit(rt.renderFinished,{chart:this._chart,vchart:this})})}_bindResizeEvent(){var t,e;if(this._autoSize){if(this._onResize=Hi(this._doResize,(t=this._option.resizeDelay)!==null&&t!==void 0?t:100),this._container){let i=window.ResizeObserver;i&&(this._observer=new i(this._onResize),(e=this._observer)===null||e===void 0||e.observe(this._container))}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this._autoSize&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}getCurrentSize(){var t,e,i,s;return $A(this._spec,{container:this._container,canvas:this._canvas,mode:this._getMode(),modeParams:this._option.modeParams},{width:(e=(t=this._currentSize)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:500,height:(s=(i=this._currentSize)===null||i===void 0?void 0:i.height)!==null&&s!==void 0?s:500})}_initDataSet(t){this._dataSet=t instanceof Ar?t:new Ar,hs(this._dataSet,"dataview",zo),hs(this._dataSet,"array",Bv),nt(this._dataSet,"copyDataView",Il);for(let e in I.transforms)nt(this._dataSet,e,I.transforms[e]);for(let e in I.dataParser)hs(this._dataSet,e,I.dataParser[e])}updateCustomConfigAndRerender(t,e,i={}){if(!this._isReleased&&t)return V(t)&&(t=t()),t.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._reCompile(t),e?this._renderSync(i):this._renderAsync(i)}_updateCustomConfigAndRecompile(t,e={}){return!!t&&(this._reCompile(t),this._beforeRender(e))}_reCompile(t,e){var i,s,n,o,a,l,h,d,c,u;if(t.reMake&&(this._releaseData(),this._initDataSet(),(i=this._chart)===null||i===void 0||i.release(),this._chart=null),t.reTransformSpec&&(this._chartSpecTransformer=null),t.changeTheme?(this._setCurrentTheme(),this._setFontFamilyTheme((s=this._currentTheme)===null||s===void 0?void 0:s.fontFamily)):t.changeBackground&&((n=this._compiler)===null||n===void 0||n.setBackground(this._getBackground())),t.reMake)(o=this._compiler)===null||o===void 0||o.releaseGrammar(((a=this._option)===null||a===void 0?void 0:a.animation)===!1||((l=this._spec)===null||l===void 0?void 0:l.animation)===!1),this._userEvents.forEach(p=>{var m;return(m=this._event)===null||m===void 0?void 0:m.on(p.eType,p.query,p.handler)}),t.reSize&&this._doResize();else if(t.reCompile&&((h=this._compiler)===null||h===void 0||h.clear({chart:this._chart,vChart:this},((d=this._option)===null||d===void 0?void 0:d.animation)===!1||((c=this._spec)===null||c===void 0?void 0:c.animation)===!1),(u=this._compiler)===null||u===void 0||u.compile({chart:this._chart,vChart:this},{})),t.reSize){let{width:p,height:m}=this.getCurrentSize();this._chart.onResize(p,m,!1),this._compiler.resize(p,m,!1)}}_beforeRender(t={}){var e,i,s,n,o,a,l,h;if(this._isReleased)return!1;if(this._chart)return!0;let{transformSpec:d,actionSource:c}=t;return d&&this._initChartSpec(this._spec,"render"),this._chartPluginApply("onBeforeInitChart",this._spec,c),(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeInitializeChart)===null||i===void 0||i.call(e,this),this._initChart(this._spec),(n=(s=this._option.performanceHook)===null||s===void 0?void 0:s.afterInitializeChart)===null||n===void 0||n.call(s,this),!(!this._chart||!this._compiler)&&((a=(o=this._option.performanceHook)===null||o===void 0?void 0:o.beforeCompileToVGrammar)===null||a===void 0||a.call(o),this._compiler.compile({chart:this._chart,vChart:this},{performanceHook:this._option.performanceHook}),(h=(l=this._option.performanceHook)===null||l===void 0?void 0:l.afterCompileToVGrammar)===null||h===void 0||h.call(l),!0)}_afterRender(){return!this._isReleased&&(this._updateAnimateState(),this._event.emit(rt.rendered,{chart:this._chart,vchart:this}),!0)}renderSync(t){return this._renderSync({morphConfig:t,transformSpec:!0,actionSource:"render"})}renderAsync(t){return Ln(this,void 0,void 0,function*(){return this._renderAsync({morphConfig:t,transformSpec:!0,actionSource:"render"})})}_renderAsync(t={}){return Ln(this,void 0,void 0,function*(){return this._renderSync(t)})}_updateAnimateState(t){var e,i;if(this._option.animation){let s=t?_i.appear:_i.update;(e=this._chart)===null||e===void 0||e.getAllRegions().forEach(n=>{var o;(o=n.animate)===null||o===void 0||o.updateAnimateState(s,!0)}),(i=this._chart)===null||i===void 0||i.getAllComponents().forEach(n=>{var o;(o=n.animate)===null||o===void 0||o.updateAnimateState(s,!0)})}}release(){var t,e,i,s;!((t=this._onResize)===null||t===void 0)&&t.cancel&&this._onResize.cancel(),this._chartPluginApply("releaseAll"),this._chartPlugin=null,this._chartSpecTransformer=null,(e=this._chart)===null||e===void 0||e.release(),(i=this._eventDispatcher)===null||i===void 0||i.release(),(s=this._compiler)===null||s===void 0||s.release(),this._unBindResizeEvent(),this._releaseData(),this._onError=null,this._onResize=null,this._container=null,this._currentTheme=null,this._option=null,this._chart=null,this._compiler=null,this._spec=null,this._specInfo=null,this._originalSpec=null,this._userEvents=null,this._event=null,this._eventDispatcher=null,this._isReleased=!0,vo.unregisterInstance(this)}updateData(t,e,i,s){return Ln(this,void 0,void 0,function*(){return this.updateDataSync(t,e,i,s)})}_updateDataById(t,e,i){let s=this._spec.data.find(n=>n.name===t||n.id===t);s?s.id===t?s.values=e:s.name===t&&s.parse(e,i):H(e)?this._spec.data.push({id:t,values:e}):this._spec.data.push(e)}updateDataInBatches(t){return Ln(this,void 0,void 0,function*(){return this._chart?(this._chart.updateFullData(t.map(({id:e,data:i,options:s})=>({id:e,values:i,parser:s}))),this._chart.updateGlobalScaleDomain(),this._compiler.render(),this):(this._spec.data=O(this._spec.data),t.forEach(({id:e,data:i,options:s})=>{this._updateDataById(e,i,s)}),this)})}updateDataSync(t,e,i,s){return T(this._dataSet)?this:this._chart?(s?.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateData(t,e,!0,i),this._compiler.render(),this):(this._spec.data=O(this._spec.data),this._updateDataById(t,e,i),this)}updateFullDataSync(t,e=!0,i){if(this._chart)return i?.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateFullData(t),e&&this._compiler.render(),this;let s=O(this._spec.data);return O(t).forEach(n=>{let{id:o,values:a,parser:l,fields:h}=n,d=s.find(c=>c.name===o);if(d)d instanceof St?(d.setFields(li(h)),d.parse(a,li(l))):(d.values=a,A(l)&&(d.parser=l),A(h)&&(d.fields=h));else{let c=hp(n,this._dataSet,s);H(this._spec.data)&&this._spec.data.push(c)}}),this}updateFullData(t,e=!0){return Ln(this,void 0,void 0,function*(){return this.updateFullDataSync(t,e)})}updateSpec(t,e=!1,i,s){return Ln(this,void 0,void 0,function*(){let n=this._updateSpec(t,e,s);return n?(yield this.updateCustomConfigAndRerender(n,!1,{morphConfig:i,transformSpec:n.reTransformSpec,actionSource:"updateSpec"}),this):this})}updateSpecSync(t,e=!1,i,s){let n=this._updateSpec(t,e,s);return n?(this.updateCustomConfigAndRerender(n,!0,{morphConfig:i,transformSpec:n.reTransformSpec,actionSource:"updateSpec"}),this):this}updateSpecAndRecompile(t,e=!1,i={}){let s=this._updateSpec(t,e);return this._updateCustomConfigAndRecompile(s,Object.assign({actionSource:"updateSpecAndRecompile"},i))}updateModelSpec(t,e,i=!1,s){return Ln(this,void 0,void 0,function*(){return this.updateModelSpecSync(t,e,i,s)})}updateModelSpecSync(t,e,i=!1,s){if(!e||!this._spec)return this;if(Z(e)&&(e=JSON.parse(e)),V(t)||oV(this._spec,t,e,i),this._chart){let n=this._chart.getModelInFilter(t);if(n)return this._updateModelSpec(n,e,!0,i,s)}return this}_updateModelSpec(t,e,i=!1,s=!1,n){s&&(e=ot({},t.getSpec(),e));let o=t.updateSpec(e);return t.reInit(e),(o.change||o.reCompile||o.reMake||o.reSize||o.reRender)&&this._chart.reDataFlow(),this.updateCustomConfigAndRerender(o,i,{morphConfig:n,transformSpec:!1,actionSource:"updateModelSpec"})}resize(t,e){return Ln(this,void 0,void 0,function*(){return this.resizeSync(t,e)})}resizeSync(t,e){var i,s;return this._beforeResize(t,e)?((s=(i=this._compiler).resize)===null||s===void 0||s.call(i,t,e),this._afterResize()):this}_beforeResize(t,e){var i,s,n,o;if(!this._chart||!this._compiler)return!1;let a=this._chart.getCanvasRect();return(!a||a.width!==t||a.height!==e)&&(this._chartPluginApply("onBeforeResize",t,e),(s=(i=this._option.performanceHook)===null||i===void 0?void 0:i.beforeResizeWithUpdate)===null||s===void 0||s.call(i),this._chart.onResize(t,e,!1),(o=(n=this._option.performanceHook)===null||n===void 0?void 0:n.afterResizeWithUpdate)===null||o===void 0||o.call(n),!0)}_afterResize(){return this._isReleased||this._event.emit(rt.afterResize,{chart:this._chart}),this}updateViewBox(t,e=!0,i=!0){return this._chart&&this._compiler?(this._viewBox=t,this._chart.updateViewBox(t,i),i&&(this._compiler.render(),this._chart.onEvaluateEnd()),this._compiler.updateViewBox(t,e),this):this}on(t,e,i){var s;this._userEvents&&(this._userEvents.push({eType:t,query:typeof e=="function"?null:e,handler:typeof e=="function"?e:i}),(s=this._event)===null||s===void 0||s.on(t,e,i))}off(t,e){var i;if(this._userEvents&&this._userEvents.length!==0)if(e){let s=this._userEvents.findIndex(n=>n.eType===t&&n.handler===e);s>=0&&(this._userEvents.splice(s,1),(i=this._event)===null||i===void 0||i.off(t,e))}else this._userEvents.forEach(s=>{var n;s.eType===t&&((n=this._event)===null||n===void 0||n.off(t,s.handler))}),this._userEvents=this._userEvents.filter(s=>s.eType!==t)}updateState(t,e){this._chart&&this._chart.updateState(t,e)}setSelected(t,e,i){this._chart&&this._chart.setSelected(t,e,i)}setHovered(t,e,i){this._chart&&this._chart.setHovered(t,e,i)}clearState(t){this._chart&&this._chart.clearState(t)}clearAllStates(){this._chart&&this._chart.clearAllStates()}clearSelected(){this._chart&&this._chart.clearSelected()}clearHovered(){this._chart&&this._chart.clearHovered()}_updateCurrentTheme(t){var e,i,s;let n=this._option.theme,o=(e=this._spec)===null||e===void 0?void 0:e.theme,a=(i=this._spec)===null||i===void 0?void 0:i.type;t&&(this._currentThemeName=t);let l=(d,c)=>{var u;return!((u=c.chart)===null||u===void 0)&&u[d]&&(c=Yu({},c,c.chart[d])),c},h;if(st(n)&&st(o))h=ua(this._currentThemeName,!0),this._currentTheme=l(a,h);else if(Z(n)&&(!o||Z(o))||Z(o)&&(!n||Z(n))){let d=Yu({},ua(this._currentThemeName,!0),ua(n,!0),ua(o,!0));this._currentTheme=l(a,d)}else{let d=Yu({},ua(this._currentThemeName),ua(n),ua(o));this._currentTheme=Xu(l(a,d))}BD(ft(this._currentTheme,"component.poptip")),(s=this._compiler)===null||s===void 0||s.setBackground(this._getBackground())}_shouldChartResize(t){var e,i;let s=!1;T(this._spec.width)?!T(t.width)&&(this._spec.width=t.width):this._spec.width!==t.width&&(s=!0),T(this._spec.height)?!T(t.height)&&(this._spec.height=t.height):this._spec.height!==t.height&&(s=!0);let n=this._autoSize;return this._autoSize=!!jr(this._option.mode)&&((i=(e=this._spec.autoFit)!==null&&e!==void 0?e:this._option.autoFit)===null||i===void 0||i),this._autoSize!==n&&(s=!0),s}_getBackground(){return(typeof this._spec.background=="string"||ct(this._spec.background)&&this._spec.background.gradient?this._spec.background:null)||this._currentTheme.background||this._option.background}getCurrentTheme(){return ua(this._currentThemeName)}getCurrentThemeName(){return this._currentThemeName}setCurrentTheme(t){return Ln(this,void 0,void 0,function*(){return this.setCurrentThemeSync(t)})}setCurrentThemeSync(t){var e;if(!Dn.themeExist(t))return this;let i=this._setCurrentTheme(t);return this._setFontFamilyTheme((e=this._currentTheme)===null||e===void 0?void 0:e.fontFamily),this.updateCustomConfigAndRerender(i,!0,{transformSpec:!1,actionSource:"setCurrentTheme"}),this}_setCurrentTheme(t){var e;return this._updateCurrentTheme(t),this._initChartSpec(this._getSpecFromOriginalSpec(),"setCurrentTheme"),(e=this._chart)===null||e===void 0||e.setCurrentTheme(),{change:!0,reMake:!1}}_setFontFamilyTheme(t){var e;t&&((e=this.getStage())===null||e===void 0||e.setTheme({text:{fontFamily:t}}))}_getTooltipComponent(){var t;return(t=this._chart)===null||t===void 0?void 0:t.getComponentsByType(W.tooltip)[0]}setTooltipHandler(t){var e,i;this._context.tooltipHandler=t;let s=this._getTooltipComponent();s&&((i=(e=s.tooltipHandler)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),s.tooltipHandler=t)}getTooltipHandlerByUser(){var t;return(t=this._context)===null||t===void 0?void 0:t.tooltipHandler}getTooltipHandler(){let t=this._getTooltipComponent();return t?t.tooltipHandler:this._context.tooltipHandler}showTooltip(t,e){var i;let s=this._getTooltipComponent();return(i=A(t)&&s?.showTooltip(t,e)!=="none")!==null&&i!==void 0&&i}hideTooltip(){var t;let e=this._getTooltipComponent();return(t=e?.hideTooltip())!==null&&t!==void 0&&t}getLegendDataById(t){var e;let i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getLegendData():[]}getLegendDataByIndex(t=0){var e;let i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(W.discreteLegend);return i&&i[t]?i[t].getLegendData():[]}getLegendSelectedDataById(t){var e;let i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getSelectedData():[]}getLegendSelectedDataByIndex(t=0){var e;let i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(W.discreteLegend);return i&&i[t]?i[t].getSelectedData():[]}setLegendSelectedDataById(t,e){var i;let s=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);s&&s.setSelectedData(e)}setLegendSelectedDataByIndex(t=0,e){var i;let s=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(W.discreteLegend);s&&s[t]&&s[t].setSelectedData(e)}getDataURL(){var t;return Ln(this,void 0,void 0,function*(){let e=this.getStage();if(this._chart&&e){e.render();let i=this._chart.getCanvas();return yield Qj(i,{onError:this._onError})}return(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined")),null})}exportImg(t){var e,i;return Ln(this,void 0,void 0,function*(){if(!jr(this._option.mode))return void((e=this._option)===null||e===void 0||e.onError(new TypeError("non-browser environment can not export img")));let s=yield this.getDataURL();s?Jj(t,s):(i=this._option)===null||i===void 0||i.onError(new ReferenceError("render is not defined"))})}exportCanvas(){var t;let e=this.getStage();if(this._chart&&e)return e.toCanvas();(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined"))}getImageBuffer(){var t,e;if(this._option.mode!=="node")return void((t=this._option)===null||t===void 0||t.onError(new TypeError("getImageBuffer() now only support node environment.")));let i=this.getStage();return i?(i.render(),i.window.getImageBuffer()):((e=this._option)===null||e===void 0||e.onError(new ReferenceError("render is not defined")),null)}setLayout(t){var e;this._option.layout=t,(e=this._chart)===null||e===void 0||e.setLayout(t)}reLayout(){var t;(t=this._chart)===null||t===void 0||t.setLayoutTag(!0)}getCompiler(){return this._compiler}getChart(){return this._chart}getStage(){return this._compiler.getStage()}getCanvas(){var t;return(t=this._compiler)===null||t===void 0?void 0:t.getCanvas()}getContainer(){var t;if(A(this._container))return this._container;let e;return e=Z(this._canvas)?kt.getElementById(this._canvas):this._canvas,A(e)?e.parentElement:(t=this.getCanvas())===null||t===void 0?void 0:t.parentElement}getComponents(){return this._chart.getAllComponents()}getScale(t){var e;let i=(e=this._chart)===null||e===void 0?void 0:e.getGlobalScale();return i?.getScale(t)}setDimensionIndex(t,e={}){var i;return(i=this._chart)===null||i===void 0?void 0:i.setDimensionIndex(t,e)}stopAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.stop()}pauseAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.pause()}resumeAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.resume()}convertDatumToPosition(t,e={},i=!1,s){var n;if(!this._chart||st(t))return null;let{seriesId:o,seriesIndex:a=0}=e,l;if(A(o)?l=this._chart.getSeriesInUserId(o):A(a)&&(l=(n=this._chart.getSeriesInIndex([a]))===null||n===void 0?void 0:n[0]),l){let h=Object.keys(t),d=l.getViewData().latestData.find(p=>h.every(m=>p[m]==t[m])),c=l.getRegion().getLayoutStartPoint(),u;return u=d?l.dataToPosition(d,s):l.dataToPosition(t,s),u?vE(u,c,i):null}return null}convertValueToPosition(t,e,i=!1){var s,n;if(!this._chart||T(t)||st(e))return null;if(!H(t)){let{axisId:h,axisIndex:d}=e,c;if(A(h)?c=this._chart.getComponentsByKey("axes").find(p=>p.userId===h):A(d)&&(c=(s=this._chart.getComponentsByKey("axes"))===null||s===void 0?void 0:s[d]),!c)return ji("Please check whether the `axisId` or `axisIndex` is set!"),null;let u=c?.valueToPosition(t);if(i){let p=c.getLayoutStartPoint(),m=c.getOrient();return u+(m==="bottom"||m==="top"?p.x:p.y)}return u}let{seriesId:o,seriesIndex:a}=e,l;return A(o)?l=this._chart.getSeriesInUserId(o):A(a)&&(l=(n=this._chart.getSeriesInIndex([a]))===null||n===void 0?void 0:n[0]),l?vE(l.valueToPosition(t[0],t[1]),l.getRegion().getLayoutStartPoint(),i):(ji("Please check whether the `seriesId` or `seriesIndex` is set!"),null)}getFunction(t){return Bn.instance().getFunction(t)}registerFunction(t,e){t&&e&&Bn.instance().registerFunction(t,e)}unregisterFunction(t){t&&Bn.instance().unregisterFunction(t)}getFunctionList(){return Bn.instance().getFunctionNameList()}setRuntimeSpec(t){this._spec=t,this._updateSpecInfo()}updateIndicatorDataById(t,e){var i;let s=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);s&&s.updateDatum(e)}updateIndicatorDataByIndex(t=0,e){var i;let s=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(W.indicator);s&&s[t]&&s[t].updateDatum(e)}geoZoomByIndex(t=0,e,i){this._geoZoomByQuery({regionIndex:t},e,i)}geoZoomById(t,e,i){this._geoZoomByQuery({regionId:t},e,i)}_geoZoomByQuery(t,e,i){var s,n;let o=(s=this._chart)===null||s===void 0?void 0:s.getRegionsInQuerier(t)[0],a=(n=this._chart)===null||n===void 0?void 0:n.getComponentsByType(W.geoCoordinate),l=a?.find(h=>{var d;return(d=h.getRegions())===null||d===void 0?void 0:d.includes(o)});l&&l.dispatchZoom(e,i)}_initChartPlugin(){let t=I.getChartPlugins();t.length>0&&(this._chartPlugin=new d1(this),this._chartPlugin.load(t.map(e=>new e)),this._chartPluginApply("onInit",this._spec))}_chartPluginApply(t,...e){this._chartPlugin&&this._chartPlugin[t]&&this._chartPlugin[t].apply(this._chartPlugin,e)}_getMode(){return this._option.mode||ze["desktop-browser"]}_getChartOption(t){return{type:t,globalInstance:this,eventDispatcher:this._eventDispatcher,dataSet:this._dataSet,container:this._container,canvas:this._canvas,map:new Map,mode:this._getMode(),modeParams:this._option.modeParams,getCompiler:()=>this._compiler,performanceHook:this._option.performanceHook,viewBox:this._viewBox,animation:this._option.animation,getTheme:()=>{var e;return(e=this._currentTheme)!==null&&e!==void 0?e:{}},getSpecInfo:()=>{var e;return(e=this._specInfo)!==null&&e!==void 0?e:{}},layout:this._option.layout,onError:this._onError,disableTriggerEvent:this._option.disableTriggerEvent===!0}}};$i.InstanceManager=vo,$i.ThemeManager=Dn,$i.globalConfig={uniqueTooltip:!0},$i.Utils=gz,$i.vglobal=kt;I.registerRegion("region",wd),I.registerLayout("base",j_),JE(),Js.useRegisters([jj]),zE(),jE(),v_(CE.name,CE),Nt.getInstance(Rr.Error);var u1="monotone",p1="linear";var yz="bevel";var vp={appear:{duration:1e3,easing:"cubicOut"},update:{type:"update",duration:300,easing:"linear"},enter:{duration:300,easing:"linear"},exit:{duration:300,easing:"linear"},disappear:{duration:500,easing:"cubicIn"},state:{duration:300,easing:"linear"}};var QE=()=>{Js.useRegisters([Bj,Lj,Ij,Fj,Pj,Rj])},tw=()=>{Js.useRegisters([Nj,Vj,Oj,Hj])};var xz=[...Object.keys(vp),"normal"];function _t(r={},t,e){let i={};for(let s=0;s<xz.length;s++){let n=xz[s],o=t?t[n]:void 0;if(o===!1)continue;if(n==="normal"){o&&(i.normal=o);continue}if(n==="state"){o!==!1&&(i.state=o??vp.state);continue}if(n!=="update"&&!o&&!r[n])continue;let a,l;a=H(r[n])?r[n]:[Object.assign(Object.assign({},vp[n]),r[n])],n==="exit"&&a.forEach(h=>{h.controlOptions={stopWhenStateChange:!0}}),o?(l=H(o)?o.map((h,d)=>{var c;let u=h;return Az(u)&&delete u.type,u.oneByOne&&(u=bz(u,(c=e?.dataIndex)!==null&&c!==void 0?c:Sz,e?.dataCount)),u}):a.map((h,d)=>{var c;let u=ot({},a[d],o);return Az(u)&&delete u.type,u.oneByOne&&(u=bz(u,(c=e?.dataIndex)!==null&&c!==void 0?c:Sz,e?.dataCount)),u}),i[n]=l):i[n]=a}return i}function xt(r,t,e){var i,s,n,o,a,l;let h={};return A(t.animationAppear)&&(h.appear=(i=t.animationAppear[r])!==null&&i!==void 0?i:t.animationAppear),A(t.animationDisappear)&&(h.disappear=(s=t.animationDisappear[r])!==null&&s!==void 0?s:t.animationDisappear),A(t.animationEnter)&&(h.enter=(n=t.animationEnter[r])!==null&&n!==void 0?n:t.animationEnter),A(t.animationExit)&&(h.exit=(o=t.animationExit[r])!==null&&o!==void 0?o:t.animationExit),A(t.animationUpdate)&&(h.update=(a=t.animationUpdate[r])!==null&&a!==void 0?a:t.animationUpdate),A(t.animationState)&&(h.state=(l=t.animationState[r])!==null&&l!==void 0?l:t.animationState),t.animationNormal&&t.animationNormal[r]&&(h.normal=t.animationNormal[r]),O$(h,e)}function bz(r,t,e){let{oneByOne:i,duration:s,delay:n,delayAfter:o}=r;return r.delay=(a,l,h)=>{let d=t(a,h),c=V(s)?s(a,l,h):K(s)?s:0,u=V(n)?n(a,l,h):K(n)?n:0,p=V(i)?i(a,l,h):i;return p===!1?u:(p=p===!0?0:p,u+d*(c+p))},r.delayAfter=(a,l,h)=>{let d=t(a,h),c=V(s)?s(a,l,h):K(s)?s:0,u=V(o)?o(a,l,h):K(o)?o:0,p=V(i)?i(a,l,h):i;return p===!1?u:(p=p===!0?0:p,u+((e?e():l.mark.elements.length)-d)*(c+p))},delete r.oneByOne,r}function Sz(r,t){var e,i;return(e=r?.[$e])!==null&&e!==void 0?e:(i=t?.VGRAMMAR_ANIMATION_PARAMETERS)===null||i===void 0?void 0:i.elementIndex}function vi(r,t){var e,i,s,n,o;if(r.animation===!1||((e=r.morph)===null||e===void 0?void 0:e.enable)===!1)return!1;let a=((s=(i=r.animationAppear)===null||i===void 0?void 0:i[t])!==null&&s!==void 0?s:r.animationAppear)!==!1,l=((o=(n=r.animationUpdate)===null||n===void 0?void 0:n[t])!==null&&o!==void 0?o:r.animationUpdate)!==!1;return!(!a||!l)}function F$(r){return A(r.timeSlices)}function Az(r){return!F$(r)&&A(r.channel)}function O$(r,t){if(!r)return r;let e=["custom","customParameters"];return ew(r=li(r,null,e),i=>{var s;return V(i)&&((s=i.prototype)===null||s===void 0?void 0:s.constructor)!==i?(...n)=>i(...n,t):i},e),r}function ew(r,t,e=[]){if(H(r))r.forEach((i,s)=>{r[s]=t(r[s],s),ew(r[s],t,e)});else if(ct(r))for(let i in r)e.includes(i)||(r[i]=t(r[i],i),ew(r[i],t,e))}function iw(r){var t,e,i,s;let n=r.getSpec();if(n.animation===!1||!A(r.getRegion().animate))return!1;let o=(t=n.animationThreshold)!==null&&t!==void 0?t:Number.MAX_SAFE_INTEGER;return(e=r.getMarks())===null||e===void 0||e.forEach(a=>{let l=a.getMarkConfig();l&&(l.large&&l.largeThreshold&&(o=Math.min(o,l.largeThreshold)),l.progressiveThreshold&&(o=Math.min(o,l.progressiveThreshold)))}),!(((s=(i=r.getRawData())===null||i===void 0?void 0:i.latestData)===null||s===void 0?void 0:s.length)>=o)}var tn={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};var Vl=class{addSamplingCompile(){if(this._spec.sampling){let{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,n=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?n[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}addOverlapCompile(){var t;if(this._spec.markOverlap){let e=[];e.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(t=this._symbolMark)===null||t===void 0||t.getProduct().transform(e)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(t,e){var i,s;return this._lineMark=this._createMark(tn.line,{groupKey:this._seriesField,isSeriesMark:e==null||e,stateSort:(i=this._spec.line)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(s=this._spec.line)===null||s===void 0?void 0:s.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(t,e){var i,s;let n=this._lineMark;if(n){if(this.setMarkStyle(n,{stroke:this.getColorAttribute()},"normal",X.Series),this._invalidType!=="zero"&&this.setMarkStyle(n,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",X.Series),this.event.on(rt.viewDataStatisticsUpdate,{filter:o=>o.model===this},()=>{this.encodeDefined(n,"defined")}),this.coordinate==="polar")this.setMarkStyle(n,{lineJoin:yz,curveType:p1,closePath:!0},"normal",X.Series);else{let o=e??((s=(i=this.getSpec().line)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.curveType),a=o===u1?t==="horizontal"?"monotoneY":"monotoneX":o;this.setMarkStyle(n,{curveType:a},"normal",X.Built_In)}this.setMarkStyle(n,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",X.Series)}return n}_getEventElement(t,e=!1){let i=[];return t.dimensionInfo.some(s=>(s.data.some(n=>n.series===this&&(i=n.datum,!0)),!i.length)),i}_dimensionTrigger(t){let e=this._getEventElement(t);switch(t.action){case"enter":this._symbolActiveMark.getDataView().parse(e),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(t,e){let i=this._spec.point||{};if(i.visible!==!1&&(this._symbolMark=this._createMark(tn.point,{groupKey:this._seriesField,isSeriesMark:!!e,stateSort:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:i.customShape,morph:vi(this._spec,tn.point.name),morphElementKey:this.getDimensionField()[0]}))),this._spec.activePoint===!0){let s=new St(this._option.dataSet,{name:`${et}_series_${this.id}_active_point`});s.parse([]),this._symbolActiveMark=this._createMark({name:`active_point_${this.id}`,type:"symbol"},{groupKey:this._seriesField,isSeriesMark:!1,dataView:s,parent:this._region.getInteractionMark(),stateSort:i.stateSort},{setCustomizedShape:i.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){let t=this._symbolMark;if(!t)return this._initSymbolActiveMarkAlone(),t;if(this._initSymbolMark(t),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(As.dimensionHover,this._dimensionTrigger.bind(this));for(let e in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[e]={};for(let i in this._symbolMark.stateStyle[e])i!=="visible"&&(this._symbolActiveMark.stateStyle[e][i]={style:null,level:X.Series,referer:t})}this._symbolActiveMark.state.changeStateInfo({stateValue:it.STATE_DIMENSION_HOVER,filter:()=>!0})}return t}_initSymbolMark(t){t&&(this.setMarkStyle(t,{fill:this.getColorAttribute()},"normal",X.Series),this.setMarkStyle(t,{x:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionX(e):Number.NaN,y:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionY(e):Number.NaN,z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",X.Series))}_initSymbolActiveMarkAlone(){var t,e;let i=this._symbolActiveMark;i&&(this._initSymbolMark(i),i&&(!((e=(t=this._spec[tn.point.name])===null||t===void 0?void 0:t.state)===null||e===void 0)&&e.dimension_hover)&&(i.setVisible(!0),this.event.on(As.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(i,ot({},this._spec[tn.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:it.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(t){var e;t&&(((e=t.getTarget())===null||e===void 0?void 0:e.type)!=="symbol"&&t.setRule("line-data"),this.setMarkStyle(t,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",X.Series),this.event.on(rt.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(t,"visible")}))}initLineLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>{var i;return(i=e[this.getSeriesField()])!==null&&i!==void 0?i:this.getSeriesKeys()[0]},z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(t,e){var i,s,n,o;if(!t)return;let a=this._isFieldAllValid();if(this._invalidType==="zero"||a){if(((s=(i=t.stateStyle.normal)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s.style)===!0)return;this.setMarkStyle(t,{[e]:!0},"normal",X.Series)}else{if(((o=(n=t.stateStyle.normal)===null||n===void 0?void 0:n[e])===null||o===void 0?void 0:o.style)!==!0)return;this.setMarkStyle(t,{[e]:this._getInvalidDefined.bind(this)},"normal",X.Series)}t.getProduct()&&t.compileEncode()}_isFieldAllValid(){let t=this.getViewDataStatistics(),e=this.getStackValueField();return!!(t&&t.latestData&&e)&&t.latestData[e]&&t.latestData[e].allValid}};var en=(r,t)=>{let e=t.beforeCall();return r&&r.forEach((i,s)=>t.call(i,s,e)),e.keyMap&&(e.keyMap.clear(),e.keyMap=null),r};function fr(r,t){return ft(t,`component.${r}`)}function _r(r,t,e,i){if(r)return{formatFunc:r,args:[e,i]};let s=I.getFormatter();return t&&s?{formatFunc:s,args:[e,i,t]}:{}}var Fi=(r,t,e,i)=>{if(T(r[t]))return;let s=H(r[t]),n=s?r[t]:[r[t]],o=[];return n.forEach((a,l)=>{!a||i&&!i(a)||o.push({spec:a,specPath:s?[t,l]:[t],specInfoPath:["component",t,l],type:e})}),o};var xa=(r,t,e,i)=>{let s;if(s=V(r)?r(t,e):xi(r)&&A(r.field)?ft(t,r.field):r,i){let{formatFunc:n,args:o}=_r(void 0,i,r,t);n&&o&&(s=n(...o))}return s};function Cz(r){var t;let e=!((t=r[0])===null||t===void 0)&&t.series?[{data:r,value:""}]:r;for(let{data:i}of e)for(let{datum:s}of i)for(let n of s??[])if(n)return n}var H$=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},kz=r=>{var t,e,i;if(r?.visible===!1)return[];let s={mark:((t=r?.mark)===null||t===void 0?void 0:t.visible)!==!1,dimension:((e=r?.dimension)===null||e===void 0?void 0:e.visible)!==!1,group:((i=r?.group)===null||i===void 0?void 0:i.visible)!==!1};return A(r?.activeType)&&Object.keys(s).forEach(n=>{var o;s[n]=(o=r?.activeType)===null||o===void 0?void 0:o.includes(n)}),Object.keys(s).filter(n=>s[n])},yp=(r,t)=>!t||t.visible!==!1&&(!t[r]||t[r].visible!==!1)&&!(t.activeType&&!(H(t.activeType)?t.activeType.includes(r):t.activeType===r));function Mz(r){return T(r.mark)&&T(r.model)&&T(r.datum)}function rw(r,t,e,i,s,n){let o=a=>{if(a){let l={datum:s},h=T(a.key)&&T(a.value)&&!st(a)?Object.assign(Object.assign(Object.assign({},i),e),a):Object.assign(Object.assign({},i),a),{key:d,keyFormatter:c,keyTimeFormat:u,keyTimeFormatMode:p,value:m,valueFormatter:g,valueTimeFormat:f,valueTimeFormatMode:_}=h,v=H$(h,["key","keyFormatter","keyTimeFormat","keyTimeFormatMode","value","valueFormatter","valueTimeFormat","valueTimeFormatMode"]);l.key=m1(xa(d,s,n,c),u,p),l.value=m1(xa(m,s,n,g),f,_),Object.keys(v).forEach(x=>{l[x]=xa(h[x],s,n)}),l.visible!==!1&&(A(l.key)||A(l.value))&&r.push(l)}};H(t)?t.forEach(a=>{o(a)}):o(t)}function Tz(r,t,e,i,s,n,o){V(t)?rw(r,t(s,o),e,i,n,o):t&&rw(r,t,e,i,n,o)}function Dz(r,t,e,i,s,n){if(s&&s.length){let o=[];return s.forEach(a=>{H(r)?r.forEach(l=>{Tz(o,l,t,e,i,a,n)}):V(r)?Tz(o,r,t,e,i,a,n):r&&rw(o,r,t,e,a,n)}),o}return null}function Ez(r){if(!r||!r.length)return null;let t=[];return r.forEach(({content:e})=>{e&&e.forEach(i=>{t.push(i)})}),t.length?Object.assign(Object.assign({},r[0]),{content:t}):r[0]}var m1=(r,t,e)=>{if(!t&&!e)return typeof r!="object"?r?.toString():r;let i=nn.getInstance();return t=t||"%Y%m%d",((e=e||"local")==="local"?i.timeFormat:i.timeUTCFormat)(t,r)};var he=class{constructor(t){this.activeTriggerSet={mark:new Set,group:new Set},this.ignoreTriggerSet={mark:new Set},this._getSeriesCacheInfo=()=>{var e,i,s;let{series:n}=this,o=n.getSeriesField();return{seriesFields:A(o)?O(o):(e=n.getSeriesKeys())!==null&&e!==void 0?e:[],dimensionFields:(i=n.getDimensionField())!==null&&i!==void 0?i:[],measureFields:(s=n.getMeasureField())!==null&&s!==void 0?s:[],type:n.type}},this._getDimensionData=e=>{let{dimensionFields:i}=this._seriesCacheInfo;return i[0]&&e?.[i[0]]},this._getMeasureData=e=>{let{measureFields:i}=this._seriesCacheInfo;return i[0]&&e?.[i[0]]},this._getSeriesFieldData=e=>{let{dimensionFields:i,seriesFields:s}=this._seriesCacheInfo;if(A(s[0])&&e?.[s[0]])return e?.[s[0]];let n=i[i.length-1];return i.length>1&&(s.length===0||this.series.getSeriesKeys().length),e?.[n]},this._getSeriesStyle=(e,i,s)=>{var n;for(let o of O(i)){let a=(n=this.series.getSeriesStyle(e))===null||n===void 0?void 0:n(o);if(A(a))return a}return s},this.markTooltipKeyCallback=(e,i)=>this._getSeriesFieldData(e),this.markTooltipValueCallback=(e,i)=>this._getMeasureData(e),this.shapeTypeCallback=(e,i)=>{var s;return(s=this._getSeriesStyle(e,"shape",null))!==null&&s!==void 0?s:this._getSeriesStyle(e,"symbolType",this.series.getDefaultShapeType())},this.shapeColorCallback=(e,i)=>this._getSeriesStyle(e,["fill","stroke"]),this.shapeStrokeCallback=(e,i)=>this._getSeriesStyle(e,["stroke","fill"]),this.dimensionTooltipTitleCallback=(e,i)=>this._getDimensionData(e),this.groupTooltipTitleCallback=(e,i)=>this._getSeriesFieldData(e),this.groupTooltipKeyCallback=(e,i)=>{let{seriesFields:s}=this._seriesCacheInfo,n=this._seriesCacheInfo.dimensionFields;return s[0]&&(n=n.filter(o=>o!==s[0])),n.map(o=>e?.[o]).join("-")},this.getHasShape=e=>!!e,this.series=t,this.updateTooltipSpec()}updateTooltipSpec(){var t;let e=(t=this.series.getSpec())===null||t===void 0?void 0:t.tooltip;this.spec=e,this._seriesCacheInfo=this._getSeriesCacheInfo()}getShapeAttrs(t,e,i){var s,n,o,a,l,h,d,c,u,p,m,g;let f=e?"content":"title",_=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(s=i?.style)===null||s===void 0?void 0:s.shape),i?.[t]),(n=i?.[t])===null||n===void 0?void 0:n[f]),(o=this.spec)===null||o===void 0?void 0:o[t]),(l=(a=this.spec)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l[f]);return{shapeType:(h=_.shapeType)!==null&&h!==void 0?h:this.shapeTypeCallback,shapeFill:(c=(d=_.shapeFill)!==null&&d!==void 0?d:_.shapeColor)!==null&&c!==void 0?c:this.shapeColorCallback,shapeStroke:(u=_.shapeStroke)!==null&&u!==void 0?u:this.shapeStrokeCallback,shapeHollow:(p=_.shapeHollow)!==null&&p!==void 0&&p,shapeLineWidth:_.shapeLineWidth,shapeSize:(m=_.shapeSize)!==null&&m!==void 0?m:_.size,hasShape:(g=_.hasShape)!==null&&g!==void 0?g:this.getHasShape(e)}}enableByType(t){return!0}getDefaultContentList(t){return[this.getDefaultContentPattern(t)]}getContentList(t,e,i,s,n,o){var a;return Dz((a=e?.content)!==null&&a!==void 0?a:this.getDefaultContentList(t),this.getDefaultContentPattern(t),i,s,n,o)}getTitleResult(t,e,i,s,n){let o=V(e)?e(s,n):e;if(o?T(o.value)&&(o=Object.assign(Object.assign({},this.getDefaultTitlePattern(t)),o)):o=this.getDefaultTitlePattern(t),o&&o.visible!==!1){let a=Cz(s),l={visible:xa(o.visible,a,n),value:m1(xa(o.value,a,n,o.valueFormatter),o.valueTimeFormat,o.valueTimeFormatMode),valueStyle:xa(o.valueStyle,a,n),hasShape:o.hasShape};return Object.keys(i).forEach(h=>{l[h]=xa(i[h],a,n)}),l}return{hasShape:!1,visible:!1}}getTooltipData(t,e,i,s,n){var o,a;if(!(this.enableByType(t)&&yp(t,this.spec)&&(t!=="dimension"||s&&s.length)))return null;let l=(a=(o=this.spec)===null||o===void 0?void 0:o[t])!==null&&a!==void 0?a:e?.[t],h=this.getShapeAttrs(t,!0,e),d=this.getShapeAttrs(t,!1,e),c;return t==="dimension"?(c=[],this.getContentList(t,l,h,i,s,n).forEach(u=>{c.push(u)})):c=this.getContentList(t,l,h,i,s,n),{visible:!0,activeType:t,data:i,title:this.getTitleResult(t,l?.title,d,i,n),content:c}}getDefaultTitlePattern(t){return{key:void 0,value:t==="group"?this.groupTooltipTitleCallback:this.dimensionTooltipTitleCallback}}getDefaultContentPattern(t){return{seriesId:this.series.id,key:t==="group"?this.groupTooltipKeyCallback:this.markTooltipKeyCallback,value:this.markTooltipValueCallback}}};var N$={min:r=>r.length?Ae(r.map(t=>1*t)):0,max:r=>r.length?Pe(r.map(t=>1*t)):0,"array-min":r=>r.length?Ae(r.map(t=>1*t)):0,"array-max":r=>r.length?Pe(r.map(t=>1*t)):0,values:r=>{let t={},e=[];for(let i of r)t[i]||(e.push(i),t[i]=1);return e}},U_=(r,t)=>{var e,i;let s=t.fields;if(V(s)&&(s=s()),!s?.length||!r?.length)return{};s=ma([],s);let n=t.target==="parser"?"parserData":"latestData",o=r[0][n]?r[0][n]:r||[],a=(i=(e=r[0]).getFields)===null||i===void 0?void 0:i.call(e);return sw(o,s,a)},sw=(r,t,e)=>{let i={},s=[],n=[];return t.forEach(o=>{let a=o.key;i[a]={};let l=e?.[a],h=o.operations,d=h.some(p=>p==="min"||p==="max"||p==="allValid"),c=!0;s.length=0,r&&r.forEach(p=>{p&&s.push(p[a])});let u=s.length;if(d){n.length=0,s.forEach((m,g)=>{yn(m)&&n.push(m)});let p=s;s=n,n=p,c=s.length===u}else s=h.some(p=>p==="array-min"||p==="array-max")?s.reduce((p,m)=>(m&&m.forEach(g=>{yn(g)&&p.push(g)}),p),[]):s.filter(p=>p!==void 0);o.filter&&(s=s.filter(o.filter)),h.forEach(p=>{if(o.customize)i[a][p]=o.customize;else{if(l&&l.lockStatisticsByDomain&&!T(l.domain)){if(p==="values")return void(i[a][p]=l.domain.slice())}else if(p==="allValid")return;i[a][p]=N$[p](s),p==="array-max"&&(i[a].max=i[a][p]),p==="array-min"&&(i[a].min=i[a][p])}}),d&&(i[a].allValid=c)}),i};var wz=(r,t)=>{let{config:e}=t;if(!e)return r;let{invalidType:i,checkField:s}=e();return i!=="zero"||s&&s.length&&r.forEach(n=>{s.forEach(o=>{yn(n[o])||(n[o]=0)})}),r};var yi=class extends Ii{_compileProduct(){var t;let e=(t=this._data)===null||t===void 0?void 0:t.latestData;T(e)||A(this.getProduct())||this._initProduct([])}generateProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.name}};var W_=`${et}_HIERARCHY_DEPTH`,rn=`${et}_HIERARCHY_ROOT`,Pz=`${et}_HIERARCHY_ROOT_INDEX`;function Eo(){return{keyMap:new Map,needDefaultSeriesField:!this._seriesField,defaultSeriesField:this._seriesField?null:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey)}}function In(r,t,e){r&&(e.needDefaultSeriesField&&(r[ui]=e.defaultSeriesField),r[$e]=t,r[ki]=e.getKey(r,t,e))}function xp(){return{keyMap:new Map,needDefaultSeriesField:!0,defaultSeriesField:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey),categoryField:this.getCategoryField()}}function Pd(r,t,e,i=0,s,n){n===void 0&&(n=t),In(r,t,e),r[W_]=i,r[rn]=s||r[e.categoryField],r[Pz]=n,r.children&&r.children.length&&r.children.forEach((o,a)=>Pd(o,a,e,r[W_]+1,r[rn],n))}var Ft={label:{name:"label",type:"text"}},nw=`${et}_rect_x`,ow=`${et}_rect_x1`,aw=`${et}_rect_y`,lw=`${et}_rect_y1`,Rz={data:!0},hw={invalidType:!0,animation:!0,animationAppear:!0,animationEnter:!0,animationUpdate:!0,animationExit:!0,animationNormal:!0};var ye=class extends Do{constructor(){super(...arguments),this.markLabelSpec={}}getLabelSpec(t){return this.markLabelSpec[t]}setLabelSpec(t,e){this.markLabelSpec[t]=O(e)}addLabelSpec(t,e,i=!1){this.markLabelSpec[t]||(this.markLabelSpec[t]=[]),i?this.markLabelSpec[t].unshift(e):this.markLabelSpec[t].push(e)}getTheme(t,e){var i,s,n;let o=tA(t),a=(i=this._option)===null||i===void 0?void 0:i.getTheme(),{markByName:l,mark:h}=a,d=this._option.type,c=I.getSeriesMarkMap(d)?lV(ft(a,`series.${d}`),d,h,l):{},u=ft(a,`series.${d}_${o}`),p=((n=(s=this.stack)!==null&&s!==void 0?s:u?.stack)!==null&&n!==void 0?n:c?.stack)?ft(a,`series.${d}_stack`):void 0;return ot({},c,u,p)}transformSpec(t,e,i){this._transformStack(t);let s=super.transformSpec(t,e,i);return this._transformLabelSpec(s.spec),Object.assign(Object.assign({},s),{markLabelSpec:this.markLabelSpec,stack:this.stack})}_transformLabelSpec(t){}_transformStack(t){te(t.stack)&&(this.stack=t.stack),te(t.percent)&&(this.stack=t.percent||this.stack),T(this.stack)&&this._supportStack&&t.seriesField&&(this.stack=!0)}_addMarkLabelSpec(t,e,i="label",s="initLabelMarkStyle",n=!0,o){t&&O(t[i]).forEach(a=>{var l,h,d;if(a&&a.visible){let{animation:c=!0,animationUpdate:u=!0,animationEnter:p=!0,animationExit:m=!0}=a,{animationUpdate:g=!0,animationEnter:f=!0,animationExit:_=!0}=t,v=!!((d=(h=(l=this._option)===null||l===void 0?void 0:l.animation)!==null&&h!==void 0?h:t.animation)!==null&&d!==void 0?d:a.animation)&&!!n;this.addLabelSpec(V(e)?e(a):e,Object.assign(Object.assign({},a),{animation:!!v&&c,animationUpdate:!!(v&&g&&u)&&g,animationEnter:!!(v&&f&&p)&&f,animationExit:!!(v&&f&&m)&&_,getStyleHandler:x=>{var y;return(y=x[s])===null||y===void 0?void 0:y.bind(x)}}),o)}})}_getDefaultSpecFromChart(t){var e;let i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{outerRadius:s,innerRadius:n,direction:o}=t;return A(s)&&(i.outerRadius=s),A(n)&&(i.innerRadius=n),A(o)&&(i.direction=o),Object.keys(i).length>0?i:void 0}_mergeThemeToSpec(t,e){let i=this._theme;if(this._shouldMergeThemeToSpec()){let s=this._getDefaultSpecFromChart(e),n=o=>{let a=ot({},i,s,o),l=i.label;return l&&ct(l)&&H(a.label)&&(a.label=a.label.map(h=>ot({},l,h))),a};return H(t)?{spec:t.map(o=>n(o)),theme:i}:{spec:n(t),theme:i}}return{spec:t,theme:i}}};function Bz(r){return r===ze["desktop-browser"]||r===ze["desktop-miniApp"]?{hover:{enable:!0,trigger:"pointermove",triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"pointertap"}}:zr(r)||Gr(r)?{hover:{enable:!0,trigger:["pointerdown","pointermove"],triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"tap"}}:null}var qi=class extends Nl{getRegion(){return this._region}getLayoutStartPoint(){return this._region.getLayoutStartPoint()}getRootMark(){return this._rootMark}getSeriesMark(){return this._seriesMark}getRawData(){return this._rawData}getViewDataFilter(){return this._viewDataFilter}getViewData(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}getViewDataProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.getProductId()}getViewDataStatistics(){return this._viewDataStatistics}getViewStackData(){return this._viewStackData}getSeriesField(){return this._seriesField}setSeriesField(t){A(t)&&(this._seriesField=t)}getGroups(){return this._groups}getStack(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.stack}getStackValue(){var t;return(t=this._spec.stackValue)!==null&&t!==void 0?t:`${et}_series_${this.type}`}getPercent(){return this._spec.percent}getStackOffsetSilhouette(){return this._spec.stackOffsetSilhouette}get tooltipHelper(){return this._tooltipHelper||this.initTooltip(),this._tooltipHelper}getInvalidType(){return this._invalidType}setInvalidType(t){var e;this._invalidType=t,(e=this.getViewData())===null||e===void 0||e.reRunAllTransform()}getMarkAttributeContext(){return this._markAttributeContext}constructor(t,e){var i;super(t,e),this.specKey="series",this.type="series",this.layoutType="absolute",this.modelType="series",this.name=void 0,this.transformerConstructor=ye,this.coordinate="none",this._region=null,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:null,height:null},this.getLayoutRect=()=>{var s,n;return{width:(s=this._layoutRect.width)!==null&&s!==void 0?s:this._region.getLayoutRect().width,height:(n=this._layoutRect.height)!==null&&n!==void 0?n:this._region.getLayoutRect().height}},this._rootMark=null,this._seriesMark=null,this._viewDataMap=new Map,this._viewDataFilter=null,this._data=null,this.layoutZIndex=Tt.SeriesGroup,this._invalidType="break",this._region=e.region,this._dataSet=e.dataSet,!((i=this._spec)===null||i===void 0)&&i.name&&(this.name=this._spec.name)}created(){super.created(),this._buildMarkAttributeContext(),this.initData(),this.initGroups(),this.initStatisticalData(),this.event.emit(rt.afterInitData,{model:this}),this.initRootMark(),this.initMark();let t=iw(this);this._initExtensionMark({hasAnimation:t}),this.initMarkStyle(),this.initMarkState(),t&&this.initAnimation(),this._option.disableTriggerEvent||this.initInteraction(),this.afterInitMark(),this.initEvent(),this.event.emit(rt.afterInitEvent,{model:this})}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)},seriesColor:t=>{var e;return T(t)&&(t=this.getSeriesKeys()[0]),(e=this._option.globalScale.getScale("color"))===null||e===void 0?void 0:e.scale(t)},getRegion:()=>this._region}}setAttrFromSpec(){super.setAttrFromSpec(),this.setSeriesField(this._spec.seriesField),A(this._spec.invalidType)&&(this._invalidType=this._spec.invalidType)}getInvalidCheckFields(){return[this.getStackValueField()]}initInvalidDataTransform(){var t,e;this._invalidType==="zero"&&(!((t=this._rawData)===null||t===void 0)&&t.dataSet)&&(nt(this._rawData.dataSet,"invalidTravel",wz),(e=this._rawData)===null||e===void 0||e.transform({type:"invalidTravel",options:{config:()=>({invalidType:this._invalidType,checkField:this.getInvalidCheckFields()})}},!1))}initData(){var t,e,i;let s=(t=this._spec.data)!==null&&t!==void 0?t:this._option.getSeriesData(this._spec.dataId,this._spec.dataIndex);if(s&&(this._rawData=hp(s,this._dataSet,this._option.sourceDataList)),(i=(e=this._rawData)===null||e===void 0?void 0:e.target)===null||i===void 0||i.addListener("change",this.rawDataUpdate.bind(this)),this._addDataIndexAndKey(),this._rawData){this.getStack()&&(this._viewDataFilter=H_(this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewDataFilter`}));let n=H_(this.getStack()?this._viewDataFilter:this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewData`});this._data=new yi(this._option,n),this.getStack()&&this._viewDataFilter.target.removeListener("change",n.reRunAllTransform)}this.initInvalidDataTransform()}initGroups(){let t=this.getGroupFields();t&&t.length&&(this._groups={fields:t})}initStatisticalData(){this._data&&this._statisticViewData()}getRawDataStatisticsByField(t,e){var i,s,n;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]||e&&(T(this._rawStatisticsCache[t].min)||T(this._rawStatisticsCache[t].max))||!e&&T(this._rawStatisticsCache[t].values)){if(this._viewDataStatistics&&(!this._viewDataFilter||this._viewDataFilter.transformsArr.length<=1)&&this.getViewData().transformsArr.length<=1&&(!((i=this._viewDataStatistics.latestData)===null||i===void 0)&&i[t]))this._rawStatisticsCache[t]=this._viewDataStatistics.latestData[t];else if(this._rawData){let o=(s=this._rawData.getFields())===null||s===void 0?void 0:s[t];if(o&&o.lockStatisticsByDomain&&o.domain)this._rawStatisticsCache[t]={},e?(this._rawStatisticsCache[t].min=Ae(o.domain),this._rawStatisticsCache[t].max=Pe(o.domain)):this._rawStatisticsCache[t].values=o.domain;else{let a=sw(this._rawData.latestData,[{key:t,operations:e?["min","max"]:["values"]}])[t];this._rawStatisticsCache[t]=G((n=this._rawStatisticsCache[t])!==null&&n!==void 0?n:{},a)}}}return this._rawStatisticsCache[t]}_statisticViewData(){nt(this._dataSet,"dimensionStatistics",U_);let t=`${this.type}_${this.id}_viewDataStatic`;this._viewDataStatistics=new St(this._dataSet,{name:t}),this._viewDataStatistics.parse([this._data.getDataView()],{type:"dataview"}),this._viewDataStatistics.transform({type:"dimensionStatistics",options:{fields:()=>{let e=this.getStatisticFields();return this._seriesField&&ma(e,[{key:this._seriesField,operations:["values"]}]),e},target:"latest"}},!1),this._data.getDataView().target.removeListener("change",this._viewDataStatistics.reRunAllTransform),this.getStack()&&this.createdStackData()}createStatisticalData(t,e,i){nt(this._dataSet,"dimensionStatistics",U_);let s=new St(this._dataSet,{name:t});return s.parse([e],{type:"dataview"}),s.transform({type:"dimensionStatistics",options:{operations:["max","min","values"],fields:()=>{var n;let o=ma(this.getStatisticFields(),(n=i?.(e.name))!==null&&n!==void 0?n:[]);return this._seriesField&&ma(o,[{key:this._seriesField,operations:["values"]}]),o},target:"latest"}},!1),s}createdStackData(){let t=`${this.type}_${this.id}_viewStackData`;this._viewStackData=new St(this._dataSet,{name:t}),this._viewStackData.parse([this._viewDataFilter],{type:"dataview"}),this._viewStackData.transform({type:"stackSplit",options:{fields:this.getStackGroupFields()}},!1)}_noAnimationDataKey(t,e){return e}generateDefaultDataKey(t){var e;return T(t)?(i,s,n)=>{if(this._spec.animation===!1){let l=this._noAnimationDataKey(i,s);if(l!==void 0)return l}let{keyMap:o}=n,a=this._getSeriesDataKey(i);return o.get(a)===void 0?(o.set(a,0),a):(o.set(a,o.get(a)+1),`${a}_${o.get(a)}`)}:Z(t)?i=>i[t]:H(t)&&t.every(i=>Z(i))?i=>t.map(s=>i[s]).join("-"):V(t)?(i,s)=>t(i,s):((e=this._option)===null||e===void 0||e.onError(`invalid dataKey: ${t}`),(i,s)=>{})}_addDataIndexAndKey(){var t;!((t=this._rawData)===null||t===void 0)&&t.dataSet&&(nt(this._rawData.dataSet,"addVChartProperty",en),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1))}updateRawData(t){this._rawData&&this._rawData.updateRawData(t)}rawDataUpdate(t){var e;(e=this._rawDataStatistics)===null||e===void 0||e.reRunAllTransform(),this._rawStatisticsCache=null,this.event.emit(rt.rawDataUpdate,{model:this})}viewDataFilterOver(t){this.event.emit(rt.viewDataFilterOver,{model:this})}viewDataUpdate(t){var e;this.event.emit(rt.viewDataUpdate,{model:this}),(e=this._data)===null||e===void 0||e.updateData(),this._viewDataStatistics&&this._viewDataStatistics.reRunAllTransform()}viewDataStatisticsUpdate(t){this.event.emit(rt.viewDataStatisticsUpdate,{model:this})}getDatumPositionValue(t,e){return!t||T(e)?null:t[e]}getDatumPositionValues(t,e){return!t||T(e)?[]:Z(e)?[t[e]]:e.map(i=>t[i])}setValueFieldToStack(){}setValueFieldToPercent(){}setValueFieldToStackOffsetSilhouette(){}initRootMark(){var t,e,i;this._rootMark=this._createMark({type:"group",name:`seriesGroup_${this.type}_${this.id}`},{parent:(e=(t=this._region).getGroupMark)===null||e===void 0?void 0:e.call(t),dataView:!1}),this._rootMark.setMarkConfig({zIndex:(i=this._spec.zIndex)!==null&&i!==void 0?i:this.layoutZIndex})}_getExtensionMarkNamePrefix(){return`${this.type}_${this.id}_extensionMark`}_initExtensionMark(t){var e;if(!this._spec.extensionMark)return;let i=this.getMarksWithoutRoot();t.depend=i,(e=this._spec.extensionMark)===null||e===void 0||e.forEach((s,n)=>{this._createExtensionMark(s,null,this._getExtensionMarkNamePrefix(),n,t)})}_createExtensionMark(t,e,i,s,n){var o;let a=this._createMark({type:t.type,name:A(t.name)?`${t.name}`:`${i}_${s}`},{skipBeforeLayouted:!0,markSpec:t,parent:e,dataView:!1,componentType:t.componentType,depend:n.depend,key:t.dataKey},{setCustomizedShape:t?.customShape});if(a){if(A(t.id)&&a.setUserId(t.id),n.hasAnimation){let l=_t({},xt(t.type,t,this._markAttributeContext));a.setAnimationConfig(l)}if(t.type==="group")i=`${i}_${s}`,(o=t.children)===null||o===void 0||o.forEach((l,h)=>{this._createExtensionMark(l,a,i,h,n)});else if(!(e||T(t.dataId)&&T(t.dataIndex))){let l=this._option.getSeriesData(t.dataId,t.dataIndex);l===this._rawData?a.setDataView(this.getViewData(),this.getViewDataProductId()):(a.setDataView(l),l.target.addListener("change",()=>{a.getData().updateData()}))}}}_updateExtensionMarkSpec(){var t;(t=this._spec.extensionMark)===null||t===void 0||t.forEach((e,i)=>{let s=this._marks.getMarkWithInfo({name:A(e.name)?`${e.name}`:`${this._getExtensionMarkNamePrefix()}_${i}`});s&&(this.initMarkStyleWithSpec(s,e),s.updateStaticEncode(),s.updateLayoutState())})}getStackData(){var t;return(t=this._viewStackData)===null||t===void 0?void 0:t.latestData}_parseSelectorOfInteraction(t,e){if(!e||!e.length)return[];let i=[];return t.markIds?e.filter(s=>{t.markIds.includes(s.getProductId())&&i.push(`#${s.getProductId()}`)}):t.markNames?e.forEach(s=>{t.markNames.includes(s.name)&&i.push(`#${s.getProductId()}`)}):e.forEach(s=>{i.push(`#${s.getProductId()}`)}),i}_parseDefaultInteractionConfig(t){if(!t?.length)return[];let e=Bz(this._option.mode),i=Object.assign({},e?.hover),s=Object.assign({},e?.select),n=this._spec.hover;te(n)?i.enable=n:ct(n)&&(i.enable=!0,i=ot(i,n));let o=this._spec.select;te(o)?s.enable=o:ct(o)&&(s.enable=!0,s=ot(s,o));let a=[];if(i.enable){let l=this._parseSelectorOfInteraction(i,t);l.length&&a.push(this._defaultHoverConfig(l,i))}if(s.enable){let l=this._parseSelectorOfInteraction(s,t);l.length&&a.push(this._defaultSelectConfig(l,s))}return a}_defaultHoverConfig(t,e){return{seriesId:this.id,regionId:this._region.id,selector:t,type:"element-highlight",trigger:e.trigger,triggerOff:e.triggerOff,blurState:it.STATE_HOVER_REVERSE,highlightState:it.STATE_HOVER}}_defaultSelectConfig(t,e){let i=e.mode==="multiple",s=A(e.triggerOff)?e.triggerOff:i?["empty"]:["empty",e.trigger];return{type:"element-select",seriesId:this.id,regionId:this._region.id,selector:t,trigger:e.trigger,triggerOff:s,reverseState:it.STATE_SELECTED_REVERSE,state:it.STATE_SELECTED,isMultiple:i}}_parseInteractionConfig(t){let e=this.getCompiler();if(!e)return;let{interactions:i}=this._spec,s=this._parseDefaultInteractionConfig(t);s&&s.length&&s.forEach(n=>{e.addInteraction(n)}),i&&i.length&&i.forEach(n=>{let o=this._parseSelectorOfInteraction(n,this.getMarks());o.length&&e.addInteraction(Object.assign(Object.assign({},n),{selector:o,seriesId:this.id,regionId:this._region.id}))})}initInteraction(){let t=this.getMarksWithoutRoot();this._parseInteractionConfig(t)}initAnimation(){}initMarkState(){this.initSeriesStyleState()}initSeriesStyleState(){var t;let e=this._spec.seriesStyle;if(!e||!e.length)return;let i=(t=this._seriesField)!==null&&t!==void 0?t:ui;this.getMarksWithoutRoot().forEach(s=>{let n={},o={},a={};e.forEach(h=>{var d;let c=(d=h[s.name])===null||d===void 0?void 0:d.style;c&&(n[h.name]=!0,a[h.name]=a[h.name]||{},Object.keys(c).forEach(u=>{o[u]=!0,a[h.name][u]=c[u]}))}),s.state.addStateInfo({stateValue:ME,level:-1,filter:h=>Array.isArray(h)?h.length!==0&&n[h[0][i]]===!0:n[h[i]]===!0});let l={};Object.keys(o).forEach(h=>{l[h]=d=>{var c,u;let p;if(Array.isArray(d)){if(d.length===0)return;p=(c=a[d[0][i]])===null||c===void 0?void 0:c[h]}return p=(u=a[d[i]])===null||u===void 0?void 0:u[h],A(p)?p:s.getAttribute(h,d)}}),this.setMarkStyle(s,l,ME,X.User_SeriesStyle)})}afterInitMark(){this.event.emit(rt.afterInitMark,{model:this}),this.setSeriesField(this._spec.seriesField),this.getMarks().forEach(t=>{var e,i;!((i=(e=t.stateStyle)===null||e===void 0?void 0:e.normal)===null||i===void 0)&&i.lineWidth&&t.setAttribute("stroke",this.getColorAttribute(),"normal",X.Base_Series)})}getMarksWithoutRoot(){return this.getMarks().filter(t=>{var e;return!(!((e=t.name)===null||e===void 0)&&e.includes("seriesGroup"))})}getMarksInType(t){return this._marks.getMarksInType(t)}getMarkInName(t){return this._marks.get(t)}getMarkInId(t){return this.getMarks().find(e=>e.id===t)}initEvent(){var t,e,i;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.target.addListener("change",this.viewDataUpdate.bind(this)),(i=this._viewDataStatistics)===null||i===void 0||i.target.addListener("change",this.viewDataStatisticsUpdate.bind(this))}_releaseEvent(){super._releaseEvent(),this.getCompiler().removeInteraction(this.id)}initTooltip(){this._tooltipHelper=new he(this)}_compareExtensionMarksSpec(t,e,i){t.length!==e.length||e.some((s,n)=>s.type!==t[n].type||s.id!==t[n].id||s.name!==t[n].name)?i.reMake=!0:e.some((s,n)=>s.visible!==t[n].visible)&&(i.reCompile=!0)}_compareLabelSpec(t,e,i){t.length!==e.length||e.some((s,n)=>s.labelLayout!==t[n].labelLayout||s.visible!==t[n].visible)?i.reMake=!0:!i.reCompile&&e.some((s,n)=>!Bt(s,t[n]))&&(i.reCompile=!0)}_compareSpec(t,e,i){let s=super._compareSpec(t,e),n=Object.keys(e||{}).sort(),o=Object.keys(t||{}).sort();if(!Bt(n,o))return s.reMake=!0,s;let a=Object.assign(Object.assign(Object.assign(Object.assign({},Rz),hw),i),{extensionMark:!0,label:!0,totalLabel:!0});return this._compareExtensionMarksSpec(O(t.extensionMark),O(e.extensionMark),s),!s.reMake&&this._compareLabelSpec(O(t.label),O(e.label),s),!s.reMake&&this._compareLabelSpec(O(t.totalLabel),O(e.totalLabel),s),s.reMake?s:(!s.reCompile&&this._marks.getMarks().some(l=>{var h,d;return a[l.name]=!0,((h=e[l.name])===null||h===void 0?void 0:h.visible)!==((d=t[l.name])===null||d===void 0?void 0:d.visible)})&&(s.reCompile=!0),!s.reCompile&&n.some(l=>hw[l]&&!Bt(t[l],e[l]))&&(s.reCompile=!0),n.some(l=>!a[l]&&!Bt(t[l],e[l]))&&(s.reMake=!0),s)}_updateSpecData(){!this._rawData||!this._spec.data||this._spec.data instanceof St||dp(this._rawData,this._spec.data,!0)}reInit(t){super.reInit(t);let e=this.getMarksWithoutRoot();e.forEach(i=>{this._spec[i.name]&&this.initMarkStyleWithSpec(i,this._spec[i.name])}),this.initMarkStyle(),e.forEach(i=>{i.updateStaticEncode(),i.updateLayoutState(!0)}),this._updateExtensionMarkSpec(),this._updateSpecData(),this._tooltipHelper&&this._tooltipHelper.updateTooltipSpec(),iw(this)&&this.initAnimation()}onEvaluateEnd(t){this._data.updateData()}onRender(t){}release(){var t,e,i;super.release(),this._viewDataMap.clear();let s=(e=(t=this._rawData)===null||t===void 0?void 0:t.transformsArr)===null||e===void 0?void 0:e.findIndex(n=>n.type==="addVChartProperty");s>=0&&this._rawData.transformsArr.splice(s,1),(i=this._data)===null||i===void 0||i.release(),this._dataSet=this._data=this._rawData=this._rawDataStatistics=this._spec=this._region=this._viewDataStatistics=this._viewStackData=null}setLayoutStartPosition(t){K(t.x)&&(this._layoutStartPoint.x=t.x),K(t.y)&&(this._layoutStartPoint.y=t.y)}setLayoutRect({width:t,height:e},i){K(t)&&(this._layoutRect.width=t),K(e)&&(this._layoutRect.height=e)}getSeriesKeys(){var t,e;return this._seriesField?(e=(t=this.getRawDataStatisticsByField(this._seriesField))===null||t===void 0?void 0:t.values)!==null&&e!==void 0?e:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}getSeriesStyle(t){return e=>{var i,s;return(s=(i=this._seriesMark)===null||i===void 0?void 0:i.getAttribute(e,t))!==null&&s!==void 0?s:void 0}}_getSeriesInfo(t,e){let i=this.getDefaultShapeType();return e.map(s=>({key:s,originalKey:s,style:this.getSeriesStyle({[t]:s}),shapeType:i}))}getSeriesInfoInField(t){var e,i;return this._getSeriesInfo(t,(i=(e=this.getRawDataStatisticsByField(t))===null||e===void 0?void 0:e.values)!==null&&i!==void 0?i:[])}getSeriesInfoList(){var t;return this._getSeriesInfo((t=this._seriesField)!==null&&t!==void 0?t:ui,this.getSeriesKeys())}_getDefaultColorScale(){var t,e;let i=this.getDefaultColorDomain(),s=this._getDataScheme();return(e=(t=new qs().domain(i)).range)===null||e===void 0?void 0:e.call(t,s)}_getDataScheme(){return Cl(this.getColorScheme(),this.type)}getDefaultColorDomain(){var t,e;return this._seriesField?(e=(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._seriesField])===null||e===void 0?void 0:e.values:[]}getColorAttribute(){var t,e;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(e=this._seriesField)!==null&&e!==void 0?e:ui}}getDimensionField(){return[]}getMeasureField(){return[]}onMarkPositionUpdate(){this.onMarkTreePositionUpdate(this.getMarksWithoutRoot())}onMarkTreePositionUpdate(t){}_createMark(t,e={},i={}){var s,n,o,a,l,h;let{key:d,groupKey:c,skipBeforeLayouted:u,themeSpec:p={},markSpec:m,dataView:g,dataProductId:f,parent:_,isSeriesMark:v,depend:x,stateSort:y,noSeparateStyle:b=!1}=e,S=super._createMark(t,{key:d??this._getDataIdKey(),seriesId:this.id,attributeContext:this._markAttributeContext,componentType:e.componentType,noSeparateStyle:b});if(A(S)){let C=this.getSpec()||{};this._marks.addMark(S,{name:t.name}),v&&(this._seriesMark=S),T(_)?(s=this._rootMark)===null||s===void 0||s.addMark(S):_!==!1&&_.addMark(S),T(g)?(S.setDataView(this.getViewData(),this.getViewDataProductId()),S.setSkipBeforeLayouted(!0)):g!==!1&&S.setDataView(g,f),te(u)&&S.setSkipBeforeLayouted(u),A(x)&&S.setDepend(...O(x)),T(c)||S.setGroupKey(c),y&&S.setStateSortCallback(y);let k=Object.assign(Object.assign({},i),{morph:(n=i.morph)!==null&&n!==void 0&&n,support3d:uz(t.type)||((o=i.support3d)!==null&&o!==void 0?o:C.support3d||!!C.zField),morphKey:((a=C.morph)===null||a===void 0?void 0:a.morphKey)||`${this.getSpecIndex()}_${this.getMarks().length}`,morphElementKey:(h=(l=C.morph)===null||l===void 0?void 0:l.morphElementKey)!==null&&h!==void 0?h:i.morphElementKey});S.setMarkConfig(k),this.initMarkStyleWithSpec(S,ot({},p,m||C[S.name]))}return S}_getDataIdKey(){var t;return(t=super._getDataIdKey())!==null&&t!==void 0?t:ki}_getSeriesDataKey(t){let e="";if(!t)return e;let i=this.getDimensionField();e=i.map(n=>t[n]).join("_");let s=this.getSeriesField();return s&&!i.includes(s)&&(e+=`_${t[s]}`),e}addViewDataFilter(t){var e,i;(i=(e=this._viewDataFilter)!==null&&e!==void 0?e:this.getViewData())===null||i===void 0||i.transform(t,!1)}reFilterViewData(){var t,e;(e=(t=this._viewDataFilter)!==null&&t!==void 0?t:this.getViewData())===null||e===void 0||e.reRunAllTransform()}reTransformViewData(){var t,e;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}fillData(){var t;(t=this.getRawData())===null||t===void 0||t.reRunAllTransform()}compile(){this.compileData()}getDefaultShapeType(){return"circle"}getFieldAlias(t){var e;return t!==pi&&t!==Kr&&t!==zi&&t!==os||(t=this.getStackValueField()),(e=bd(this.getRawData(),t))!==null&&e!==void 0?e:t}_getInvalidConnectType(){return this._invalidType==="zero"?"zero":this._invalidType==="link"?"connect":"none"}_getInvalidDefined(t){let e=this.getInvalidCheckFields();return!e.length||e.every(i=>yn(t[i]))}_getRelatedComponentSpecInfo(t){var e;let i=this.getSpecIndex(),s=(e=this._option.getSpecInfo().component[t])===null||e===void 0?void 0:e.filter(n=>n.seriesIndexes.includes(i));return s??[]}_forEachStackGroup(t,e){var i,s;(e=e??((i=this._viewStackData)===null||i===void 0?void 0:i.latestData))&&(!((s=e.values)===null||s===void 0)&&s.length?t(e):e.nodes&&Object.values(e.nodes).forEach(n=>{this._forEachStackGroup(t,n)}))}isDatumInViewData(t){if(!t)return!1;let e=this.getViewData().latestData;return!!e&&(!!e.includes(t)||e.some(i=>Object.keys(t).every(s=>t[s]===i[s])))}getSeriesFieldValue(t,e){var i;return t[(i=e??this.getSeriesField())!==null&&i!==void 0?i:ui]}};qi.mark=Ft,qi.transformerConstructor=ye;function Lz(r){return[F.rose,F.radar,F.circularProgress].includes(r)}function g1(r,t,e){let i=r.getScale(0),s="isInverse"in r&&r.isInverse();Vt(i.type)?e.sort((n,o)=>(n[t]-o[t])*(s?-1:1)):e.sort((n,o)=>(i.index(n[t])-i.index(o[t]))*(s?-1:1))}function Er(r){return{dataIndex:t=>{var e,i;let s=r.direction==="horizontal"?r.fieldY[0]:r.fieldX[0],n=t?.[s],o=r.direction==="horizontal"?r.scaleY:r.scaleX;return((i=(e=o?.domain)===null||e===void 0?void 0:e.call(o))!==null&&i!==void 0?i:[]).indexOf(n)||0},dataCount:()=>{var t,e,i;let s=r.direction==="horizontal"?r.scaleY:r.scaleX;return(i=((e=(t=s?.domain)===null||t===void 0?void 0:t.call(s))!==null&&e!==void 0?e:[]).length)!==null&&i!==void 0?i:0}}}var ei=class extends qi{constructor(){super(...arguments),this.coordinate="cartesian",this._bandPosition=.5,this._scaleConfig={bandPosition:this._bandPosition},this._direction="vertical",this._sortDataByAxis=!1,this._getPositionXEncoder=()=>{var t;return(t=this._positionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionXEncoder=t=>{this._positionXEncoder=t.bind(this)},this._getPositionYEncoder=()=>{var t;return(t=this._positionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionYEncoder=t=>{this._positionYEncoder=t.bind(this)}}_buildScaleConfig(){this._scaleConfig={bandPosition:this._bandPosition}}get fieldX(){return this._fieldX}setFieldX(t){this._fieldX=O(t)}get fieldY(){return this._fieldY}setFieldY(t){this._fieldY=O(t)}get fieldZ(){return this._fieldZ}setFieldZ(t){this._fieldZ=t&&O(t)}get fieldX2(){return this._fieldX2}setFieldX2(t){this._fieldX2=t}get fieldY2(){return this._fieldY2}setFieldY2(t){this._fieldY2=t}get direction(){return this._direction}get scaleX(){return this._scaleX}setScaleX(t){this._scaleX=t}get scaleY(){return this._scaleY}setScaleY(t){this._scaleY=t}get scaleZ(){return this._scaleZ}setScaleZ(t){this._scaleZ=t}getXAxisHelper(){return this._xAxisHelper}setXAxisHelper(t){this._xAxisHelper=t,this.onXAxisHelperUpdate()}getYAxisHelper(){return this._yAxisHelper}setYAxisHelper(t){this._yAxisHelper=t,this.onYAxisHelperUpdate()}getZAxisHelper(){return this._zAxisHelper}setZAxisHelper(t){this._zAxisHelper=t,this.onYAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}getStatisticFields(){let t=[];return[{axisHelper:this.getXAxisHelper(),fields:this._fieldX2?[...this._fieldX,this._fieldX2]:this._fieldX},{axisHelper:this.getYAxisHelper(),fields:this._fieldY2?[...this._fieldY,this._fieldY2]:this._fieldY},{axisHelper:this.getZAxisHelper(),fields:this._fieldZ}].forEach(e=>{e.axisHelper&&e.axisHelper.getScale&&e.fields&&e.fields.forEach(i=>{let s={key:i,operations:[]},n=e.axisHelper.getScale(0);Vt(n.type)?(s.operations=["max","min"],n.type==="log"&&(s.filter=o=>o>0)):s.operations=["values"],t.push(s)})}),this.getStack()&&t.push({key:this.getStackValueField(),operations:["allValid"]}),t}getGroupFields(){return this.direction==="vertical"?this._fieldX:this._fieldY}getStackGroupFields(){return this.getGroupFields()}getStackValue(){var t,e;let i=(t=this.direction==="horizontal"?this.getXAxisHelper():this.getYAxisHelper())===null||t===void 0?void 0:t.getAxisId();return(e=this._spec.stackValue)!==null&&e!==void 0?e:`${et}_series_${this.type}_${i}`}getStackValueField(){return this.direction==="horizontal"?O(this._spec.xField)[0]:O(this._spec.yField)[0]}setValueFieldToStack(){this.direction==="horizontal"?(this.setFieldX(pi),this.setFieldX2(zi)):(this.setFieldY(pi),this.setFieldY2(zi))}setValueFieldToPercent(){this.direction==="horizontal"?(this.setFieldX(Kr),this.setFieldX2(os)):(this.setFieldY(Kr),this.setFieldY2(os))}setValueFieldToStackOffsetSilhouette(){this.direction==="horizontal"?(this.setFieldX(x_),this.setFieldX2(y_)):(this.setFieldY(x_),this.setFieldY2(y_))}onXAxisHelperUpdate(){this.onMarkPositionUpdate()}onYAxisHelperUpdate(){this.onMarkPositionUpdate()}onZAxisHelperUpdate(){this.onMarkPositionUpdate()}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setFieldX(this._spec.xField),this.setFieldY(this._spec.yField),this.setFieldZ(this._spec.zField),this._specXField=O(this._spec.xField),this._specYField=O(this._spec.yField),A(this._spec.direction)&&(this._direction=this._spec.direction),this.setFieldX2((t=this._spec)===null||t===void 0?void 0:t.x2Field),this.setFieldY2((e=this._spec)===null||e===void 0?void 0:e.y2Field),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent(),this.getStackOffsetSilhouette()&&this.setValueFieldToStackOffsetSilhouette(),A(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}dataToPosition(t,e){return t?e&&!this.isDatumInViewData(t)?null:{x:this.dataToPositionX(t),y:this.dataToPositionY(t)}:null}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToX=this.valueToPositionX.bind(this),this._markAttributeContext.valueToY=this.valueToPositionY.bind(this),this._markAttributeContext.xBandwidth=(t=0)=>{var e,i,s;return(s=(i=(e=this.getXAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&s!==void 0?s:0},this._markAttributeContext.yBandwidth=(t=0)=>{var e,i,s;return(s=(i=(e=this.getYAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&s!==void 0?s:0},this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this)}valueToPosition(t,e){return{x:this.valueToPositionX(t),y:this.valueToPositionY(e)}}_axisPosition(t,e,i){return this._scaleConfig.datum=i,t.isContinuous?t.valueToPosition(e,this._scaleConfig):t.dataToPosition(O(e),this._scaleConfig)}valueToPositionX(t,e){return this._axisPosition(this._xAxisHelper,t,e)}valueToPositionY(t,e){return this._axisPosition(this._yAxisHelper,t,e)}_dataToPosition(t,e,i,s,n,o){let a=n();if(a)return a(t);if(!e)return o(h=>Number.NaN),Number.NaN;let l=(e.getFields?e.getFields():i).slice(0,s);return l&&l.length!==0?(e.isContinuous?o(h=>(this._scaleConfig.datum=h,e.valueToPosition(this.getDatumPositionValue(h,l[0]),this._scaleConfig))):o(h=>(this._scaleConfig.datum=h,e.dataToPosition(O(this.getDatumPositionValues(h,l)),this._scaleConfig))),n()(t)):(o(h=>null),null)}dataToPositionX(t){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,void 0,this._getPositionXEncoder,this._setPositionXEncoder)}dataToPositionY(t){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,void 0,this._getPositionYEncoder,this._setPositionYEncoder)}dataToPositionZ(t){if(!this._zAxisHelper)return Number.NaN;let{dataToPosition:e}=this._zAxisHelper;return e(this.getDatumPositionValues(t,this._fieldZ),{bandPosition:this._bandPosition})}dataToPositionX1(t){return this._xAxisHelper?this._fieldX2&&this._fieldX2 in t?this.valueToPositionX(this.getDatumPositionValues(t,this._fieldX2)):this.valueToPositionX(0):Number.NaN}dataToPositionY1(t){return this._yAxisHelper?this._fieldY2&&this._fieldY2 in t?this.valueToPositionY(this.getDatumPositionValues(t,this._fieldY2)):this.valueToPositionY(0):Number.NaN}positionToData(t){return t?{x:this.positionToDataX(t.x),y:this.positionToDataY(t.y)}:null}positionToDataX(t){return this._scaleX?this._scaleX.invert(t):null}positionToDataY(t){return this._scaleY?this._scaleY.invert(t):null}getRegionRectLeft(){if(!this._xAxisHelper)return Number.NaN;let{getScale:t}=this._xAxisHelper;return t(0).range()[0]}getRegionRectRight(){if(!this._xAxisHelper)return Number.NaN;let{getScale:t}=this._xAxisHelper;return t(0).range()[1]}afterInitMark(){super.afterInitMark(),this.setFieldX(this._fieldX),this.setFieldY(this._fieldY),this._buildScaleConfig()}getDimensionField(){return this._direction==="horizontal"?this._specYField:this._specXField}getDimensionContinuousField(){return this._direction==="horizontal"?[this.fieldY[0],this.fieldY2]:[this.fieldX[0],this.fieldX2]}getMeasureField(){return this._direction==="horizontal"?this._specXField:this._specYField}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(rt.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e,i;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&(g1(this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,this._direction==="horizontal"?this._fieldY[0]:this._fieldX[0],this.getViewData().latestData),(i=this._data)===null||i===void 0||i.updateData(!0))}getInvalidCheckFields(){let t=[];return this._xAxisHelper&&this._xAxisHelper.isContinuous&&this._xAxisHelper.getAxisType()!==W.geoCoordinate&&(this._xAxisHelper.getFields?this._xAxisHelper.getFields():this._specXField).forEach(e=>{t.push(e)}),this._yAxisHelper&&this._yAxisHelper.isContinuous&&this._yAxisHelper.getAxisType()!==W.geoCoordinate&&(this._yAxisHelper.getFields?this._yAxisHelper.getFields():this._specYField).forEach(e=>{t.push(e)}),t}reInit(t){this._positionXEncoder&&(this._positionXEncoder=null),this._positionYEncoder&&(this._positionYEncoder=null),super.reInit(t)}};var bp=class extends Te{setStyle(t,e="normal",i=0,s=this.stateStyle){if(T(t))return;s[e]===void 0&&(s[e]={});let n=this._getIgnoreAttributes(),o=["strokeWidth","lineWidth","lineDash","strokeDash","lineJoin","stroke","strokeOpacity","opacity","fill","fillOpacity","texture","texturePadding","textureSize","textureColor"],a=this.isUserLevel(i),l=!1;Object.keys(t).forEach(h=>{let d=t[h];if(T(d)||n.includes(h))return;a&&o.includes(h)&&(Kf(d?.type)||d?.scale||V(d))&&(l=!0);let c=this._filterAttribute(h,d,e,i,a,s);this.setAttribute(h,c,e,i,s)}),l&&this.setMarkConfig({enableSegments:!0})}};var dw=class r extends bp{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:1})}_getIgnoreAttributes(){var t,e;return((t=this.model)===null||t===void 0?void 0:t.type)===F.radar&&((e=this.model)===null||e===void 0?void 0:e.coordinate)==="polar"?[]:["fill","fillOpacity"]}};dw.type="line";var cw=class r extends bp{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}_getIgnoreAttributes(){return[]}};cw.type="area";var Y_=class extends Te{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{size:1,symbolType:"circle",fill:void 0,lineWidth:0})}},uw=class r extends Y_{constructor(){super(...arguments),this.type=r.type}};uw.type="symbol";var f1=class extends he{constructor(){super(...arguments),this._getSeriesStyle=(t,e,i)=>{var s,n,o,a;for(let l of O(e)){let h=(s=this.series.getSeriesStyle(t))===null||s===void 0?void 0:s(l);if(h!==!1||l!=="fill"&&l!=="stroke"||(h=l==="fill"?(o=(n=this.series.getSeriesStyle(t))===null||n===void 0?void 0:n("stroke"))===null||o===void 0?void 0:o[0]:(a=this.series.getSeriesStyle(t))===null||a===void 0?void 0:a("fill")),A(h))return h}return i}}};var _1=Object.assign(Object.assign(Object.assign({},Ft),tn),{area:{name:"area",type:"area"}});var Cs=class extends ye{_transformLabelSpec(t){var e,i,s;((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1?this._addMarkLabelSpec(t,"point"):this._addMarkLabelSpec(t,"line"),this._addMarkLabelSpec(t,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}};var X_=class extends Cs{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){var e,i,s;let n=((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((s=(i=t.point)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.visible)!==!1;this._addMarkLabelSpec(t,o=>{let a=o.position==="inside-middle";return!n||a?"area":"point"}),this._addMarkLabelSpec(t,"area","areaLabel","initLineLabelMarkStyle",void 0,!0)}_transformSpecAfterMergingTheme(t,e,i){var s,n,o,a,l;super._transformSpecAfterMergingTheme(t,e,i);let{area:h={},line:d={},seriesMark:c}=t,u=h.visible!==!1&&((s=h.style)===null||s===void 0?void 0:s.visible)!==!1,p=d.visible!==!1&&((n=d.style)===null||n===void 0?void 0:n.visible)!==!1;h.support3d=!(!h.support3d&&!d.support3d),h.zIndex=A(h.zIndex)||A(d.zIndex)?Math.max((o=h.zIndex)!==null&&o!==void 0?o:0,(a=d.zIndex)!==null&&a!==void 0?a:0):void 0,h.style&&delete h.style.stroke,h.state&&Object.keys(h.state).forEach(f=>{"style"in h.state[f]?delete h.state[f].style.stroke:delete h.state[f].stroke});let m=h,g=d;(c==="line"||p&&!u)&&(m=d,g=h),h.style=ot({},g.style,m.style),h.state=ot({},g.state,m.state),h.interactive===!1&&(h.style.fillPickable=!1),d.interactive===!1&&(d.style.strokePickable=!1),h.interactive=!(!h.interactive&&(l=d.interactive)!==null&&l!==void 0&&!l),t.area=h,t.line=d}};function Iz(r){return r.length>=2&&K(r[0])&&K(It(r))&&It(r)>=r[0]}function Fz(r,t){var e;let i=It(t)-t[0],s=It(t)*t[0]<0,n=t[0]<=0?0-t[0]:0,o=It(t)>0?It(t)-0:0;i===0?t[0]<0?(n=1,o=0):t[0]>0&&(n=0,o=1):(n/=i,o/=i);let a=r.getDomainSpec(),l={total:i,negative:n,positive:o,includeZero:s,domain:t,extendable_min:!K(a.min),extendable_max:!K(a.max)};if(!((e=r._break)===null||e===void 0)&&e.scope){let h=t.findIndex(u=>u>=0),d,c;h===0?(d=r._break.scope[h],c=[t[0],t[1]],l.positive=1,l.negative=0):It(t)<=0?(l.positive=0,l.negative=1,c=[t[t.length-2],t[t.length-1]]):(d=r._break.scope[h-1],c=[t[h-1],t[h]],l.negative=d[0]+(0-c[0])/(c[1]-c[0])*(d[1]-d[0]),l.positive=1-l.negative),l.break=!0,l.extendable_max=!1,l.extendable_min=!1,l.domain=c}return l}function Oz(r,t){let{positive:e,negative:i,extendable_min:s,extendable_max:n,domain:o}=r,{positive:a,negative:l,extendable_min:h,extendable_max:d,domain:c}=t;if(a>0){if(!h)return!1;let u=i/e;n&&(u=i/Math.max(e,a),o[1]=-o[0]/u),c[0]=-c[1]*u}else if(l>0){if(!d)return!1;let u=e/i;s&&(u=e/Math.max(i,i),o[0]=-o[1]/u),c[1]=-c[0]*u}return!0}function Hz(r,t){let{extendable_min:e,extendable_max:i,domain:s}=r,{positive:n,negative:o,domain:a}=t;return(n!==0||o!==0)&&!(n>0&&!i)&&!(o>0&&!e)&&(s[0]=a[0],s[1]=a[1],!0)}function Nz(r,t){let{positive:e,negative:i,extendable_max:s,domain:n}=r,{positive:o,negative:a,extendable_min:l,domain:h}=t;if(s&&l){let d=Math.max(i,a)/Math.max(e,o);n[1]=-n[0]/d,h[0]=-h[1]*d}else if(l){let d=i/e;h[0]=-h[1]*d}else{if(!s)return!1;{let d=a/o;n[1]=-n[0]/d}}return!0}function Vz(r,t){let{extendable_min:e,domain:i}=r,{extendable_max:s,domain:n}=t;return!(!e||!s)&&(i[0]=-i[1],n[1]=-n[0],!0)}var jz=(r,t)=>{var e,i,s,n,o,a;let l=r.getScale(),h=t.getScale();if(!l||!h)return;let d=(s=(i=(e=r).getDomainAfterSpec)===null||i===void 0?void 0:i.call(e))!==null&&s!==void 0?s:[0,1],c=(a=(o=(n=t).getDomainAfterSpec)===null||o===void 0?void 0:o.call(n))!==null&&a!==void 0?a:[0,1];if(!(d&&c&&Iz(d)&&Iz(c)))return;let u=Fz(r,d),p=Fz(t,c);if(u.break===!0&&p.break===!0)return;let{positive:m,negative:g,extendable_min:f,extendable_max:_,includeZero:v}=u,{positive:x,negative:y,extendable_min:b,extendable_max:S,includeZero:C}=p;if(m===0&&g===0){if(!Hz(u,p))return}else if(x===0&&y===0){if(!Hz(p,u))return}else if(v||C)if(v&&!C){if(!Oz(u,p))return}else if(C&&!v){if(!Oz(p,u))return}else{if(g===y)return;if(g>y){if(!Nz(u,p))return}else if(!Nz(p,u))return}else{if(g===0&&x===0){if(!Vz(u,p))return}else if(y===0&&m===0&&!Vz(p,u))return;if(g===0&&y===0)if(d[0]===0&&c[0]>0){if(!b)return;c[0]=0}else{if(!(c[0]===0&&d[0]>0)||!f)return;d[0]=0}if(m===0&&x===0)if(d[1]===0&&c[1]>0){if(!S)return;c[1]=0}else{if(!(c[1]===0&&d[1]>0)||!_)return;d[1]=0}}l.domain(d),h.domain(c)};function z$(r,t,e,i,s){let n=gh(r,t),o=Math.max(Yn(e),Yn(n));return s*(Math.round(n*10**o)/Math.round(e*10**o))+i}var zz=(r,t)=>{var e,i,s,n,o;if(!r)return r;let a=(e=t?.targetAxis)===null||e===void 0?void 0:e.call(t);if(!a)return r;let l=(i=t?.currentAxis)===null||i===void 0?void 0:i.call(t);if(!l)return r;let h=(s=l.getTickData())===null||s===void 0?void 0:s.getDataView();if(!h||!h.transformsArr.find(v=>v.type.includes("ticks")))return r;let d=l.getScale();if(!d)return r;let c=(o=(n=a.getTickData())===null||n===void 0?void 0:n.getDataView())===null||o===void 0?void 0:o.latestData;if(!c?.length)return r;let u=a.getScale();if(!u)return r;let p=u.domain(),m=It(p)-p[0];if(m===0)return r;let g=d.domain(),f=It(g)-g[0];if(m===0)return r;let _=c.map(v=>z$(v.value,p[0],m,g[0],f));return ss(_)};var v1=class{constructor(t){this.id=ts(),this.name=`${t}_${this.id}`}onAdd(t){this.service=t}release(){this.service=null}};var Sp=class r extends v1{constructor(){super(r.type),this.type="AxisSyncPlugin"}_checkEnableSync(t){if(!Vt(t.getScale().type))return!1;let e=t.getSpec().sync;return!!e?.axisId&&e}_getTargetAxis(t,e){let i=t.getOption().getChart().getComponentByUserId(e.axisId);return i?.type.startsWith("cartesianAxis")?i:null}onInit(t,e){let i=this._checkEnableSync(e);if(!i||!i.zeroAlign)return;let s=this._getTargetAxis(e,i);s&&e.event.on(rt.scaleDomainUpdate,{filter:({model:n})=>n.id===e.id||n.id===s.id},()=>{jz(s,e)})}onDidCompile(t,e){let i=this._checkEnableSync(e);if(!i)return;let s=this._getTargetAxis(e,i);if(s&&i.tickAlign){nt(e.getOption().dataSet,"tickAlign",zz);let n={targetAxis:()=>s,currentAxis:()=>e};e.addTransformToTickData({type:"tickAlign",options:n,level:Number.MAX_SAFE_INTEGER},!1)}}};Sp.pluginType="component",Sp.type="AxisSyncPlugin";var Gz={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}};function Uz(r){return(r=as(r)).startSymbol=as(r.startSymbol),r.endSymbol=as(r.endSymbol),r}function Ap(r){let t=0;return ft(r,"tick.visible")&&(t+=ft(r,"tick.tickSize")),ft(r,"label.visible")&&(t+=ft(r,"label.space")),t}function jl(r,t){var e,i,s,n,o,a;return{min:(s=(e=r.min)!==null&&e!==void 0?e:(i=r.range)===null||i===void 0?void 0:i.min)!==null&&s!==void 0?s:t?.min,max:(a=(n=r.max)!==null&&n!==void 0?n:(o=r.range)===null||o===void 0?void 0:o.max)!==null&&a!==void 0?a:t?.max}}function mw(r){let t=r?.orient;return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="z"}function Wz(r){let t=r?.orient;return t==="angle"||t==="radius"}var Cp=(r,t,e)=>{var i;let s=(i=t==="band"?fr("axisBand",e):["linear","log","symlog"].includes(t)?fr("axisLinear",e):{})!==null&&i!==void 0?i:{},n=ve(r)?fr("axisX",e):ls(r)?fr("axisY",e):fr("axisZ",e);return ot({},fr("axis",e),s,n)},y1=(r,t,e)=>{var i;let s=(i=t==="band"?fr("axisBand",e):t==="linear"?fr("axisLinear",e):{})!==null&&i!==void 0?i:{},n=fr(r==="angle"?"axisAngle":"axisRadius",e);return ot({},fr("axis",e),s,n)},gw=r=>r==="band"||r==="ordinal"||r==="point";function wo(r,t){return{id:r,label:r,value:t,rawValue:r}}function qr(r,t,e){return e||!r||r.getAxisId()===t.getAxisId()}var x1=class extends gp{constructor(t){super(),this.component=t}releaseAll(){super.releaseAll(),this.component=null}};function Yz(r,t){let{x1:e,y1:i,x2:s,y2:n}=t,{x1:o,y1:a,x2:l,y2:h}=r.AABBBounds,{dx:d=0,dy:c=0}=r.attribute,u=0,p=0;o<e&&(u=e-o),a<i&&(p=i-a),l>s&&(u=s-l),h>n&&(p=n-h),u&&r.setAttribute("dx",u+d),p&&r.setAttribute("dy",p+c)}function Xz(r,t,e,i){for(let s=0,n=r.length;s<n;s++){let o=r[s];if(o){let a=o[e],l=o[i||e];if(a<=t&&l>=t)return o}}return null}var Kz=(r,t)=>{var e,i;let s=O((e=t.axes)!==null&&e!==void 0?e:[]),{bandField:n,linearField:o,xField:a,yField:l}=(i=fr(W.crosshair,r))!==null&&i!==void 0?i:{},h=s.find(p=>ve(p.orient)),d;d=A(h)?ot({},gw(h.type)?n:o,a):a;let c=s.find(p=>ls(p.orient)),u;return u=A(c)?ot({},Ke(c.type)?n:o,l):l,{xField:d,yField:u}},$z=(r,t)=>{var e,i;let s=O((e=t.axes)!==null&&e!==void 0?e:[]),{bandField:n,linearField:o,categoryField:a,valueField:l}=(i=fr(W.crosshair,r))!==null&&i!==void 0?i:{},h=s.find(p=>p.orient==="angle"),d;d=A(h)?ot({},gw(h.type)?n:o,a):a;let c=s.find(p=>p.orient==="radius"),u;return u=A(c)?ot({},Ke(c.type)?n:o,l):l,{categoryField:d,valueField:u}};function qz(r,t,e,i){switch(r){case W.cartesianBandAxis:return Cp(To(e,["z"]),"band",t);case W.cartesianLinearAxis:return Cp(To(e,["z"]),"linear",t);case W.cartesianLogAxis:return Cp(To(e,["z"]),"log",t);case W.cartesianSymlogAxis:return Cp(To(e,["z"]),"symlog",t);case W.cartesianAxis:case W.cartesianTimeAxis:return Cp(To(e),void 0,t);case W.polarBandAxis:return y1(e.orient,"band",t);case W.polarLinearAxis:return y1(e.orient,"linear",t);case W.polarAxis:return y1(e.orient,void 0,t);case W.cartesianCrosshair:return Kz(t,i);case W.polarCrosshair:return $z(t,i);case W.colorLegend:case W.sizeLegend:case W.discreteLegend:case W.dataZoom:case W.scrollBar:return G$(e,fr(r,t));default:return fr(r,t)}}var G$=(r,t)=>{var e;let i=(e=r.orient)!==null&&e!==void 0?e:t.orient,s=t[VA(i)],n=ot({},t,s);return delete n.horizontal,delete n.vertical,n};var Fn=class extends Do{getTheme(t,e){return qz(this.type,this._option.getTheme(),t,e)}_mergeThemeToSpec(t,e){let{spec:i,theme:s}=super._mergeThemeToSpec(t,e);return this._adjustPadding(i),{spec:i,theme:s}}_adjustPadding(t){let{padding:e,noOuterPadding:i=!0,orient:s}=t;i&&e&&s&&(t.padding=Object.assign(Object.assign({},Xr(e)),{[s]:0}))}};var U$=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Oe=class extends mp{static createComponent(t,e){let{spec:i}=t,s=U$(t,["spec"]);return new this(i,Object.assign(Object.assign({},e),s))}getRegions(){return this._regions}created(){super.created(),this.initLayout(),this.pluginService=new x1(this)}constructor(t,e){super(t,e),this.name="component",this.modelType="component",this.transformerConstructor=Fn,this._delegateEvent=(i,s,n,o=null,a=null)=>{var l,h;s instanceof ao||this.event.emit(n,{model:this,node:i,event:s,item:o,datum:a,source:jt.chart,chart:(h=(l=this._option)===null||l===void 0?void 0:l.globalInstance)===null||h===void 0?void 0:h.getChart()},"model")},this._option.animation&&(this.animate=new pp({getCompiler:e.getCompiler}))}initLayout(){var t;super.initLayout(),this._regions=(t=this._regions)!==null&&t!==void 0?t:this._option.getRegionsInIndex(),this._layout&&(this._layout.layoutBindRegionID=this._regions.map(e=>e?.id))}changeRegions(t){throw new Error("Method not implemented.")}_getNeedClearVRenderComponents(){throw new Error("Method not implemented.")}onRender(t){throw new Error("Method not implemented.")}getVRenderComponents(){return this._getNeedClearVRenderComponents()}callPlugin(t){this.pluginService&&this.pluginService.getAll().forEach(e=>t(e))}getContainer(){var t;return this._container||(this._container=(t=this._option)===null||t===void 0?void 0:t.globalInstance.getStage().find(e=>e.name==="root",!0)),this._container}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reMake||(i.reMake=["seriesId","seriesIndex","regionId","regionIndex"].some(s=>!Bt(e?.[s],t[s]))),e?.visible!==t.visible&&(i.reCompile=!0),i}release(){var t;super.release(),this.clear(),(t=this.pluginService)===null||t===void 0||t.releaseAll(),this.pluginService=null}clear(){var t;let e=this._getNeedClearVRenderComponents();e&&e.length&&e.forEach(i=>{var s;i&&((s=this.getContainer())===null||s===void 0||s.removeChild(i),i=null)}),this._container=null,(t=this.pluginService)===null||t===void 0||t.clearAll()}compile(){this.compileMarks(),this.reAppendComponents()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t,context:{model:this}})})}reAppendComponents(){let t=this._getNeedClearVRenderComponents();t&&t.length&&t.forEach(e=>{var i;e&&!e.stage&&((i=this.getContainer())===null||i===void 0||i.appendChild(e))})}getBoundsInRect(t,e){return{x1:0,x2:0,y1:0,y2:0}}getDatum(t){}};Oe.transformerConstructor=Fn;var K_=class extends Te{constructor(t,e){super(t,e),this.type="component",this._componentType=e.componentType,this._mode=e.mode}_initProduct(t){let e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(ht.component,t??e.rootMark,{componentType:this._componentType,mode:this._mode}).id(i),this._compiledProductId=i}};K_.type="component";var b1=()=>{I.registerMark(K_.type,K_)};var Zz=r=>r;var W$=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Rd=class extends Oe{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(t=0){return this._tickData[t]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(t,e){var i;super(t,e),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(i=t.visible)===null||i===void 0||i,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var t,e,i,s;return[(e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem(),(s=(i=this._gridMark)===null||i===void 0?void 0:i.getProduct())===null||s===void 0?void 0:s.getGroupGraphicItem()].filter(A)}created(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g,f,_,v;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){let x=this._createMark({type:"component",name:`axis-${this.getOrient()}`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=x,x.setMarkConfig({zIndex:this.layoutZIndex}),A(this._spec.id)&&x.setUserId(this._spec.id),x.setMarkConfig({interactive:(t=this._spec.interactive)!==null&&t!==void 0?t:this.getDefaultInteractive()}),this._marks.addMark(x),(e=this._spec.grid)===null||e===void 0?void 0:e.visible){let y=this._createMark({type:"component",name:`axis-${this.getOrient()}-grid`},{componentType:this.getOrient()==="angle"?Li.circleAxisGrid:Li.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});y.setMarkConfig({zIndex:(a=(n=(s=(i=this._spec.grid)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.zIndex)!==null&&n!==void 0?n:(o=this._spec.grid)===null||o===void 0?void 0:o.zIndex)!==null&&a!==void 0?a:Tt.Axis_Grid,interactive:!1}),this._marks.addMark(y),this._gridMark=y}if(this._option.animation!==!1&&ft(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){let y=_t((l=I.getAnimationInKey("axis"))===null||l===void 0?void 0:l(),{appear:(d=(h=this._spec.animationAppear)!==null&&h!==void 0?h:ft(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&d!==void 0?d:ft(this._option.getChart().getSpec(),"animationAppear"),disappear:(u=(c=this._spec.animationDisappear)!==null&&c!==void 0?c:ft(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&u!==void 0?u:ft(this._option.getChart().getSpec(),"animationDisappear"),enter:(m=(p=this._spec.animationEnter)!==null&&p!==void 0?p:ft(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&m!==void 0?m:ft(this._option.getChart().getSpec(),"animationEnter"),exit:(f=(g=this._spec.animationExit)!==null&&g!==void 0?g:ft(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&f!==void 0?f:ft(this._option.getChart().getSpec(),"animationExit"),update:(v=(_=this._spec.animationUpdate)!==null&&_!==void 0?_:ft(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&v!==void 0?v:ft(this._option.getChart().getSpec(),"animationUpdate")});y.enter&&(y.update[0].customParameters={enter:y.enter[0]}),this._marks.forEach(b=>b.setAnimationConfig(y))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){let t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new Ii(this._option,t)]}collectData(t,e){let i=[];return be(this._regions,s=>{var n;let o=this.collectSeriesField(t,s);if(o=H(o)?Vt(this._scale.type)?o:[o[0]]:[o],t||(this._dataFieldText=s.getFieldAlias(o[0])),o){let a=s.getViewData();if(e)o.forEach(l=>{i.push(s.getRawDataStatisticsByField(l,!1))});else if(a&&a.latestData&&a.latestData.length){let l=(n=s.getViewDataStatistics)===null||n===void 0?void 0:n.call(s),h=this.type===W.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;o.forEach(d=>{var c;!((c=l?.latestData)===null||c===void 0)&&c[d]&&(h?i.push(Object.assign(Object.assign({},l.latestData[d]),{values:a.latestData.map(u=>u[d])})):i.push(l.latestData[d]))})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),i}isSeriesDataEnable(){let t=!0;return be(this._regions,e=>{var i;H((i=e.getViewDataStatistics())===null||i===void 0?void 0:i.latestData)&&(t=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}setSeriesAndRegionsFromSpec(){let{seriesId:t,seriesIndex:e,regionId:i,regionIndex:s}=this._spec;A(t)&&(this._seriesUserId=O(t)),A(i)&&(this._regionUserId=O(i)),A(e)&&(this._seriesIndex=O(e)),A(s)&&(this._regionIndex=O(s)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(n=>n.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(rt.scaleUpdate,{filter:({model:e})=>e?.id===this.id},this.effect.scaleUpdate.bind(this));let t=QS(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(e=>e.getViewDataStatistics()).filter(e=>!!e);t.length>1?this._option.dataSet.multipleDataViewAddListener(t,"change",()=>{this.updateScaleDomain()}):t.length===1&&t[0].target.addListener("change",()=>{this.updateScaleDomain()}),be(this._regions,e=>{e.event.on(rt.rawDataUpdate,{filter:({model:i})=>i?.id===e.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(t){this.updateScaleRange(),this.event.emit(rt.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(t)}computeData(t){t!=="force"||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||t!=="force"&&Bt(this._scale.range(),[0,1])||this._tickData.forEach(e=>{e.getDataView().reRunAllTransform(),e.updateData()}):be(this._regions,e=>{var i;(i=e.getViewData())===null||i===void 0||i.reRunAllTransform()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];let t=[];if(be(this._regions,e=>{let i=e.getGroups();i&&t.push(i)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t.length!==0){let e=Pe(t.map(i=>i.fields.length));for(let i=1;i<e;i++){let s=this._scale.clone();this._scales.push(s)}}}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reMake?i:(i.reRender=!0,e?.type!==t?.type||e?.visible!==t?.visible?(i.reMake=!0,i):(i.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(s=>{var n,o;return((n=e?.[s])===null||n===void 0?void 0:n.visible)!==((o=t?.[s])===null||o===void 0?void 0:o.visible)}),i))}_getAxisAttributes(){let t=this._spec,e={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&t.select,hover:this._option.disableTriggerEvent!==!0&&t.hover};if(t.domainLine&&t.domainLine.visible?e.line=Uz(t.domainLine):e.line={visible:!1},t.label&&t.label.visible){let i=xr(t.label,["style","formatMethod","state"]);e.label=i,t.label.style&&(e.label.style=V(t.label.style)?(s,n,o,a)=>{var l;let h=t.label.style(s.rawValue,n,s,o,a);return gt(ot({},(l=this._theme.label)===null||l===void 0?void 0:l.style,h))}:gt(t.label.style)),(t.label.formatMethod||t.label.formatter)&&(e.label.formatMethod=this._getLabelFormatMethod()),t.label.state&&(e.label.state=vV(t.label.state))}else e.label={visible:!1};if(t.tick&&t.tick.visible?(e.tick={visible:t.tick.visible,length:t.tick.tickSize,inside:t.tick.inside,alignWithLabel:t.tick.alignWithLabel,dataFilter:t.tick.dataFilter},t.tick.style&&(e.tick.style=V(t.tick.style)?(i,s,n,o)=>{var a;let l=t.tick.style(i,s,n,o);return gt(ot({},(a=this._theme.tick)===null||a===void 0?void 0:a.style,l))}:gt(t.tick.style)),t.tick.state&&(e.tick.state=Sd(t.tick.state))):e.tick={visible:!1},t.subTick&&t.subTick.visible?(e.subTick={visible:t.subTick.visible,length:t.subTick.tickSize,inside:t.subTick.inside,count:t.subTick.tickCount},t.subTick.style&&(e.subTick.style=V(t.subTick.style)?(i,s,n,o)=>{var a;let l=t.subTick.style(i,s,n,o);return gt(ot({},(a=this._theme.subTick)===null||a===void 0?void 0:a.style,l))}:gt(t.subTick.style)),t.subTick.state&&(e.subTick.state=Sd(t.subTick.state))):e.subTick={visible:!1},t.title&&t.title.visible){let i=t.title,{autoRotate:s,angle:n,style:o={},background:a,state:l,shape:h}=i,d=W$(i,["autoRotate","angle","style","background","state","shape"]),c,u=n;t.orient!=="left"&&t.orient!=="right"||s&&T(u)&&(u=t.orient==="left"?-90:90,c=Gz[t.orient]),e.title=Object.assign(Object.assign({},d),{autoRotate:!1,angle:u?Ut(u):null,textStyle:ot({},c,gt(o)),pickable:o.pickable!==!1,childrenPickable:o.pickable!==!1,state:{}}),h&&h.visible?(e.title.shape=Object.assign(Object.assign({},h),{style:gt(h.style)}),h.state&&(e.title.state.shape=Sd(h.state))):e.title.shape={visible:!1},a&&a.visible?(e.title.background=Object.assign(Object.assign({},a),{style:gt(a.style)}),a.state&&(e.title.state.background=Sd(a.state))):e.title.background={visible:!1},l&&(e.title.state.text=Sd(l))}else e.title={visible:!1};return t.background&&t.background.visible?(e.panel={visible:!0},t.background.style&&(e.panel.style=gt(t.background.style)),t.background.state&&(e.panel.state=Sd(t.background.state))):e.panel={visible:!1},e}_getGridAttributes(){let t=this._spec;return{alternateColor:t.grid.alternateColor,alignWithLabel:t.grid.alignWithLabel,style:V(t.grid.style)?()=>(e,i)=>{var s,n;let o=t.grid.style((s=e.datum)===null||s===void 0?void 0:s.rawValue,i,e.datum);return gt(ot({},(n=this._theme.grid)===null||n===void 0?void 0:n.style,o))}:gt(t.grid.style),subGrid:t.subGrid.visible===!1?{visible:!1}:{type:"line",visible:t.subGrid.visible,alternateColor:t.subGrid.alternateColor,style:gt(t.subGrid.style)}}}_getLabelFormatMethod(){let{formatMethod:t,formatter:e}=this._spec.label,{formatFunc:i}=_r(t,e);return i?(s,n,o)=>i(n.rawValue,n,e):null}_initTickDataSet(t,e=0){hs(this._option.dataSet,"scale",Zz);let i=this.registerTicksTransform();return new St(this._option.dataSet,{name:`${this.type}_${this.id}_ticks_${e}`}).parse(this._scales[e],{type:"scale"}).transform({type:i,options:t},!1)}_tickTransformOption(){let t=this._tick||{},e=this._spec.label||{},{tickCount:i,forceTickCount:s,tickStep:n,tickMode:o}=t,{style:a,formatMethod:l,minGap:h}=e;return{sampling:this._spec.sampling!==!1,tickCount:i,forceTickCount:s,tickStep:n,tickMode:o,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:a,labelFormatter:l,labelGap:h}}addTransformToTickData(t,e){this._tickData.forEach(i=>{var s;(s=i?.getDataView())===null||s===void 0||s.transform(t,e)})}dataToPosition(t){return this._scale.scale(t)}getDatum(t){var e,i;return t&&t.name===oi.label?t.data:this._axisMark?(i=(e=this._axisMark.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem())===null||i===void 0?void 0:i.attribute.items:void 0}};Rd.specKey="axes";var On=()=>{b1(),I.registerAnimation("axis",()=>({appear:{custom:lx},update:{custom:AS},exit:{custom:hx}}))};var Jz=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Y$=[Sp],ba=class extends Rd{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(t){this._autoIndentOnce=t}getScales(){return this._scales}constructor(t,e){super(t,e),this.type=W.cartesianAxis,this.name=W.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=Tt.Axis,this.layoutLevel=Gi.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:i=>{this.computeData(i?.value),be(this._regions,s=>{let n=this.getOrient();ve(n)?qr(s.getXAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&s.setXAxisHelper(this.axisHelper()):ls(n)?qr(s.getYAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&s.setYAxisHelper(this.axisHelper()):Rn(n)&&qr(s.getZAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&s.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{let{x:s,y:n}=i;return K(s)&&(s+=+(this._orient==="left")*this.getLayoutRect().width),K(n)&&(n+=+(this._orient==="top")*this.getLayoutRect().height),{x:s,y:n}},this._transformLayoutRect=i=>{if(!this._visible)return i;let s=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===0&&(i.width=s.x1<0?-s.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===0&&(i.width=s.x2>0?s.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===0&&(i.height=s.y1<0?-s.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===0&&(i.height=s.y2>0?s.y2:0)}return i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),this._layout.setRectInSpec(this._layoutCacheProcessing(i))},this._updateAxisLayout=()=>{let i=this.getLayoutStartPoint(),s=this._getUpdateAttribute(!1),{grid:n}=s,o=Jz(s,["grid"]),a=this._axisMark.getProduct(),l=ot({x:i.x,y:i.y},this._axisStyle,o);a.encode(l),this._gridMark&&this._gridMark.getProduct().encode(ot({x:i.x,y:i.y},this._getGridAttributes(),n))},this._fixAxisOnZero=()=>{let{onZero:i,visible:s}=this._spec.domainLine;if(this.visible&&i&&s!==!1){let{onZeroAxisId:n,onZeroAxisIndex:o}=this._spec.domainLine,a=this._option.getComponentsByKey("axes"),l=ve(this.getOrient()),h=c=>{var u;return(l?!ve(c.getOrient()):ve(c.getOrient()))&&Vt(c.getScale().type)&&(c.getTickData()?(u=c.getTickData().getLatestData())===null||u===void 0?void 0:u.find(p=>p.value===0):c.getScale().domain()[0]<=0&&It(c.getScale().domain())>=0)},d=a.filter(c=>h(c));if(d.length){let c;if(A(n))c=d.find(u=>u.id===n);else if(A(o)){let u=a[o];h(u)&&(c=u)}else c=d[0];if(c){let u=this._axisMark.getProduct(),p=c.valueToPosition(0);l?u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-((c.getInverse()?c.getScale().range()[1]:c.getScale().range()[0])-p):p})}):u.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?p:-((c.getInverse()?c.getScale().range()[0]:c.getScale().range()[1])-p)})})}}}},this._orient=To(t,["z"]),Rn(this._orient)&&(this.layoutType="absolute"),this._dataSet=e.dataSet,this._coordinateType="cartesian"}static getSpecInfo(t){let e=t[this.specKey];if(!e)return null;let i=t.direction==="horizontal";if(!H(e)){if(!mw(e))return null;let{axisType:a,componentName:l}=$E(e,i);return e.type=a,[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:l}]}let s=!0;if(e.filter(a=>a.orient==="z")[0]){let a=e.filter(h=>h.orient==="bottom")[0],l=e.filter(h=>ls(h.orient))[0];s=e.length===3&&a&&l}let n=e.map((a,l)=>({spec:a,index:l}));s||(n=n.filter(({spec:a})=>a.orient!=="z"));let o=[];return n.forEach(({spec:a,index:l})=>{if(!mw(a))return;let{axisType:h,componentName:d}=$E(a,i);a.type=h,o.push({spec:a,specPath:[this.specKey,l],specInfoPath:["component",this.specKey,l],type:d})}),o}static createComponent(t,e){let{spec:i}=t,s=Jz(t,["spec"]),n=I.getComponentInKey(s.type);return n?new n(i,Object.assign(Object.assign({},e),s)):(e.onError(`Component ${s.type} not found`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(t){this.layout3dBox=t}getNewScaleRange(){let{width:t,height:e}=this.getLayoutRect(),{left:i,right:s,top:n,bottom:o}=this._innerOffset,a=[];return ve(this.getOrient())?K(t)&&(a=this._inverse?[t-s,i]:[i,t-s]):Rn(this.getOrient())?K(t)&&(a=this._inverse?[t-s,i]:[i,t-s],this._scale.range(a)):K(e)&&(a=this._inverse?[n,e-o]:[e-o,n]),a}updateScaleRange(){let t=!1,e=this.getNewScaleRange(),i=this._scale.range();return e.length===i.length&&e.every((s,n)=>s===i[n])?t=!1:(t=!0,this._scale.range(e)),t}init(t){var e;super.init(t),(e=this.pluginService)===null||e===void 0||e.load(Y$.map(i=>new i)),this.callPlugin(i=>{this.pluginService&&i.onInit&&i.onInit(this.pluginService,this)})}setAttrFromSpec(){var t;if(super.setAttrFromSpec(),this.visible){ve(this.getOrient())?He(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):He(this._spec.maxWidth)&&(this._spec.maxWidth="30%");let i=this._getAxisAttributes();i.label.formatMethod=this._getLabelFormatMethod(),i.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=i}this._tick=this._spec.tick;let e=(t=this._option.getChart())===null||t===void 0?void 0:t.getSpec();this._inverse=Gj(this._spec,e?.direction==="horizontal")}onLayoutStart(t,e,i){if(super.onLayoutStart(t,e,i),!Rn(this.getOrient())&&this._spec.innerOffset){let s=this._spec;ls(this.getOrient())?["top","bottom"].forEach(n=>{this._innerOffset[n]=We(s.innerOffset[n],e.height,e)}):["left","right"].forEach(n=>{this._innerOffset[n]=We(s.innerOffset[n],e.width,e)})}}getSeriesStatisticsField(t){let e;return e=ve(this.getOrient())?t.fieldX:Rn(this.getOrient())?t.fieldZ:t.fieldY,Vt(this._scale.type)?e:[e[0]]}_tickTransformOption(){var t,e,i,s;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,labelLastVisible:(e=this._spec.label)===null||e===void 0?void 0:e.lastVisible,labelFirstVisible:(i=this._spec.label)===null||i===void 0?void 0:i.firstVisible,labelFlush:(s=this._spec.label)===null||s===void 0?void 0:s.flush})}axisHelper(){return{isContinuous:Vt(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(t=0)=>this._scales[t],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var t;let e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct();e&&e.addEventListener(pt.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(ve(this.getOrient())?this.callPlugin(i=>{this.pluginService&&i.onDidLayoutHorizontal&&i.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(i=>{this.pluginService&&i.onDidLayoutVertical&&i.onDidLayoutVertical(this.pluginService,this)}),this._unitText)){let{x:i,y:s}=this.getLayoutStartPoint(),n=ve(this._orient)?{x:Pe(this._scale.range())+i,y:s}:{x:i,y:Ae(this._scale.range())+s};this._unitText.setAttributes(n)}}),this.callPlugin(i=>{this.pluginService&&i.onDidCompile&&i.onDidCompile(this.pluginService,this)})}onRender(t){}changeRegions(t){}update(t){}resize(t){}collectScale(){let t=[];return be(this._regions,e=>{t.push(this.getOrient()==="left"||this.getOrient()==="right"?e.scaleY:e.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}collectSeriesField(t,e){var i,s;let n;return n=t>0?(s=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||s===void 0?void 0:s[t]:ve(this.getOrient())?e.getSpec().x2Field?[...e.fieldX,e.fieldX2]:e.fieldX:Rn(this.getOrient())?e.fieldZ:e.getSpec().y2Field?[...e.fieldY,e.fieldY2]:e.fieldY,n}updateSeriesScale(){let t=this.getOrient();be(this._regions,e=>{ve(t)?qr(e.getXAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(e.setScaleX(this._scale),e.setXAxisHelper(this.axisHelper())):ls(t)?qr(e.getYAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(e.setScaleY(this._scale),e.setYAxisHelper(this.axisHelper())):Rn(t)&&qr(e.getZAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(e.setScaleZ(this._scale),e.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(t){var e;let i={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return i;this._verticalLimitSize=ve(this.getOrient())?t.height:t.width,this.setLayoutRect(t),!this.updateScaleRange()&&H((e=this.getTickData())===null||e===void 0?void 0:e.getLatestData())||this.computeData("range");let s={skipLayout:!1},n=ve(this.getOrient());this.pluginService&&(n?this.callPlugin(l=>{l.onWillLayoutHorizontal&&l.onWillLayoutHorizontal(this.pluginService,s,this)}):this.callPlugin(l=>{l.onWillLayoutVertical&&l.onWillLayoutVertical(this.pluginService,s,this)}));let o=this._axisMark.getProduct(),a=!1;if(!s.skipLayout){let l=this._getUpdateAttribute(!0),h=o.getGroupGraphicItem(),d=ot(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,l,{line:{visible:!1}}),c=h.getBoundsWithoutRender(d);c.empty()&&(c=new Ye().set(d.x,d.y,d.x,d.y)),a=!0,this._latestBounds=c,i=this._appendAxisUnit(c,n)}return a||(this._latestBounds=o.getBounds()),i}positionToData(t,e){let i=ve(this.getOrient());e&&(t-=i?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(t=i?ee(t,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):ee(t,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));let s=this._scale.range();return(t-s[0])*(t-It(s))>0?null:this._scale.invert(t)}_getTitleLimit(t){var e,i,s,n,o;let a=this._spec.title;if(a.visible&&T((e=a.style)===null||e===void 0?void 0:e.maxLineWidth)){let l=(o=(s=(i=this._axisStyle.title)===null||i===void 0?void 0:i.angle)!==null&&s!==void 0?s:(n=a.style)===null||n===void 0?void 0:n.angle)!==null&&o!==void 0?o:0;if(t){let c=this.getLayoutRect().width,u=Math.abs(Math.cos(l));return u<1e-6?1/0:c/u}let h=this.getLayoutRect().height,d=Math.abs(Math.sin(l));return d<1e-6?1/0:h/d}return null}_getUpdateAttribute(t){var e;let i=0,s=0;if(!t){let f=this.getRegions(),{x:_,y:v}=f[0].getLayoutStartPoint(),x=_+f[0].getLayoutRect().width,y=v+f[0].getLayoutRect().height;for(let b=1;b<f.length;b++){let S=f[b],{x:C,y:k}=S.getLayoutStartPoint(),{width:M,height:E}=S.getLayoutRect();_=Math.min(_,C),x=Math.max(x,M+C),v=Math.min(v,k),y=Math.max(y,E+k)}i=Math.abs(y-v),s=Math.abs(x-_)}let{width:n,height:o}=this.getLayoutRect(),a=ve(this._orient),l=ls(this._orient),h=Rn(this._orient),d=this.layout3dBox?this.layout3dBox.length:0,c={x:0,y:0},u=i,p=n;a?c={x:n,y:0}:l?(c={x:0,y:o},u=s,p=o):h&&(c={x:d,y:0});let m=this.getLabelItems(p),g={start:{x:0,y:0},end:c,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(a)},items:m};if(t||(g.grid={type:"line",start:{x:0,y:0},end:c,items:m[0],verticalFactor:this._axisStyle.verticalFactor,depth:d,length:u}),h){let f=(e=this.directionStr)!==null&&e!==void 0?e:"r2l",_=this.layout3dBox?this.layout3dBox.width:0,v=[0,0],x=-Math.PI/2,y=0;f==="l2r"&&(y=this.layout3dBox.length,v=[0,0,0],x=Math.PI/2),g.z=y,g.alpha=x,g.anchor3d=v,t||(g.grid.depth=_)}else{let f=a?this.layout.minHeight:this.layout.minWidth;(a&&this._layout.layoutRectLevelMap.height===9||l&&this._layout.layoutRectLevelMap.width===9)&&(f=this._verticalLimitSize),g.verticalLimitSize=this._verticalLimitSize,g.verticalMinSize=f,g.label={overflowLimitLength:this._getLabelOverflowLimit(a)}}return g}getLabelItems(t){var e;let i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(s=>{let n=this._getNormalizedValue([s.value],t);return wo(s.value,n)}).filter(s=>{let{value:n,rawValue:o}=s,a=this._scale.domain();return this.getSpec().type==="log"?n>=0&&n<=1:Vt(this._scale.type)?o>=a[0]&&o<=It(a):a.includes(o)})]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(rt.layoutEnd,this._updateAxisLayout),this.event.on(rt.layoutEnd,this._fixAxisOnZero),this.event.on(rt.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(t,e){return e===0?0:this.dataToPosition(t)/e}_layoutCacheProcessing(t){return["width","height"].forEach(e=>{t[e]<this._layoutCache[e]?t[e]=this._layoutCache[e]:this._layoutCache[e]=t[e]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]})),t}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(t,e){var i;if(this._spec.unit&&this._spec.unit.visible){let{text:s,style:n}=this._spec.unit,o,a,{x:l,y:h}=this.getLayoutStartPoint();e?(o={x:Pe(this._scale.range())+l,y:h},a={textAlign:"left",textBaseline:"middle"}):(o={x:l,y:Ae(this._scale.range())+h},a={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),a=Object.assign(Object.assign(Object.assign({},a),n),{x:o.x,y:o.y,text:s}),this._unitText?this._unitText.setAttributes(a):(this._unitText=zs(a),this._unitText.name="axis-unit",(i=this.getContainer())===null||i===void 0||i.add(this._unitText));let d=this._unitText.AABBBounds;e?(t.x2+=d.x2>t.x2?d.x2-t.x2:0,t.y2+=d.y2>t.y2?d.y2-t.y2:0):(t.x1+=d.x1<t.x1?d.x1-t.x1:0,t.y1+=d.y1<t.y1?d.y1-t.y1:0)}return t}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(t){var e,i;if(t&&((e=this._spec.label)===null||e===void 0?void 0:e.visible)!==!1&&((i=this._spec.label)===null||i===void 0?void 0:i.autoLimit)===!0){let s=this._option.getComponentsByKey("axes"),n=this.getRegions(),o=s.filter(c=>{let u=c.getOrient();return(u==="left"||u==="right")&&c.getRegions().some(p=>n.includes(p))}),a=0,l=0,h=this.getLayoutStartPoint().x,d=h+this.getLayoutRect().width;return o.forEach(c=>{let u=c.getLayoutStartPoint().x;if(c.getOrient()==="left"&&u===h){let p=c.getLayoutRect().width;a=Math.max(a,p)}else if(u===d){let p=c.getLayoutRect().width;l=Math.max(l,p)}}),{left:a,right:l}}}};ba.type=W.cartesianAxis,ba.specKey="axes";var X$=(r,t,e)=>e.reduce((i,s,n)=>(i.push([s,e.length===n+1?t:e[n+1]]),i),[[r,e[0]]]);function K$(r,t){let e=r[0],i=r[r.length-1],s=t.filter(n=>n>e&&n<i);return s.length===0?[[e,i]]:X$(e,i,s)}var Qz=(r,t)=>r-t,$$=(r,t)=>{let e=[{count:0,sub:[],max:t[0],min:t[0]}],i=0,s=0;for(;i<t.length;)r[s]<=t[i]?(e[i].count+=1,e[i].sub.push(r[s]),s+=1):(i+=1,e[i]={count:0,sub:[],max:t[i],min:t[i]});e.forEach(o=>{o.count&&(o.min=Math.min.apply(null,o.sub))});let n=r.slice(s);return e[i]={count:n.length,sub:n,min:t[t.length-1],max:Math.max.apply(null,n)},e};function q$(r,t,e="count"){let i=$$(r,t),s=e==="count"?r.length:i.reduce((l,h,d)=>h.count>0?l+h.max-h.min:l,0),n=[],o=0,a=0;return i.forEach((l,h)=>{if(s===0)n.push([0,h/i.length-1]);else{let d=e==="count"?l.count:l.max-l.min,c=n[a-1]?n[a-1][1]:0,u=h===i.length-1?1:Math.min((o+d)/s,1);(c!==u||c!==0&&c!==1)&&(a+=1,n.push([c,u]),o+=d)}}),n}function tG(r,t,e){return r.sort(Qz),t.sort(Qz),{domain:K$(r,t),scope:q$(r,t,e)}}var Z$=Math.sqrt(50),J$=Math.sqrt(10),Q$=Math.sqrt(2);var Po=class{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){A(this._spec.nice)&&(this._nice=this._spec.nice),A(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=jl(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var t;if(!this._nice)return!1;let e=5,i=this._spec.tick||{};if(K(i.forceTickCount))e=i.forceTickCount;else if(V(i.tickCount)){let o=this._scale.range(),a=Math.abs(It(o)-o[0]);a===1&&this._option&&(a=ve(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=i.tickCount({axisLength:a,labelStyle:this._spec.label&&this._spec.label.style})}else e=K(i.tickCount)?i.tickCount:5;this._spec.niceType==="accurateFirst"&&(e=Math.max(5,e));let{min:s,max:n}=(t=this._domain)!==null&&t!==void 0?t:{};return T(s)&&T(n)&&T(this._softMaxValue)&&T(this._softMinValue)?this._scale.nice(e):(A(s)||A(this._softMinValue))&&T(n)&&T(this._softMaxValue)?this._scale.niceMax(e):!(!T(s)||!T(this._softMinValue)||!A(n)&&!A(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){var t;if(!this._nice)return!1;let{min:e,max:i}=(t=this._domain)!==null&&t!==void 0?t:{};return T(e)&&T(i)&&T(this._softMaxValue)&&T(this._softMinValue)?this._scale.nice():(A(e)||A(this._softMinValue))&&T(i)&&T(this._softMaxValue)?this._scale.niceMax():!(!T(e)||!T(this._softMinValue)||!A(i)&&!A(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(t,e){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){let e=[];if(t.length){let i=this._spec.breaks&&this._spec.breaks.length,s,n,o=[];if(t.forEach(a=>{let{min:l,max:h}=a;s=s===void 0?l:Math.min(s,l),n=n===void 0?h:Math.max(n,h),i&&(o=o.concat(a.values))}),i){let a=[],l=[],h=T(this._domain.max)?n:this._domain.max;for(let d=0;d<this._spec.breaks.length;d++){let{range:c}=this._spec.breaks[d];c[0]<=c[1]&&c[1]<=h&&(a.push(c),l.push(this._spec.breaks[d]))}if(a.sort((d,c)=>d[0]-c[0]),a.length){let{domain:d,scope:c}=tG(o,Cf(a),this._spec.breaks[0].scopeType);e=Cf(d),this._break={domain:d,scope:c,breakDomains:a,breaks:l}}else e=[s,n]}else e=[s,n]}else e[0]=0,e[1]=0;return this.setSoftDomainMinMax(e),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this._expand)return;let e=t[0],i=It(t);e===i&&(i===0?i=1:i>0?e=0:i<0&&(i=0)),A(this._expand.min)&&(t[0]=e-(i-e)*this._expand.min),A(this._expand.max)&&(t[t.length-1]=i+(i-e)*this._expand.max)}niceDomain(t){let{min:e,max:i}=jl(this._spec);if(A(e)||A(i)||this._spec.type!=="linear")return t;if(Math.abs(Ae(t)-Pe(t))<=1e-12){let s=t[0],n=s>=0?1:-1;if(s=Math.abs(s),s<1)t[0]=0,t[t.length-1]=1;else{let o=s/5,a=Math.floor(Math.log(o)/Math.LN10),l=o/Math.pow(10,a);o=(l>=Z$?10:l>=J$?5:l>=Q$?2:1)*Math.pow(10,a),t[0]=0,t[t.length-1]=10*o}n<0&&(t.reverse(),t[0]*=-1,t[t.length-1]*=-1)}return t}includeZero(t){this._zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(It(t),0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;let i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(rt.scaleUpdate,{model:this,value:"domain"})}extendDomain(t){let e,i=t.length-1,s=t[0]-t[i]>0,n=s?i:0,o=s?0:i;for(let a in this._extend)e=this._extend[a],e>t[o]&&(t[o]=e),e<t[n]&&(t[n]=e)}getDomainSpec(){return this._domain}setDomainMinMax(t){if(!this._domain)return;let{min:e,max:i}=this._domain;A(e)&&(t[0]=e),A(i)&&(t[t.length-1]=i)}setSoftDomainMinMax(t){let{softMin:e,softMax:i}=this._spec;if(A(e)){let s=V(e)?e(t):e;T(s)&&(s=t[0]),s<=t[0]&&(t[0]=s,this._softMinValue=s)}if(A(i)){let s=V(i)?i(t):i;T(s)&&(s=It(t)),s>=It(t)&&(t[t.length-1]=s),this._softMaxValue=s}}setZero(t){this._zero!==t&&(this._zero=t,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;let t=this.collectData(),e=this.computeLinearDomain(t);this.updateScaleDomainByModel(e)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(t),this._domainAfterSpec=this._scale.domain(),this.event.emit(rt.scaleDomainUpdate,{model:this}),this.event.emit(rt.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(t){let e=Math.abs(It(t)-t[0]),i=Math.max(-Math.floor(Math.log10(e)),0)+2,s=Math.pow(10,i);this.niceLabelFormatter=n=>K(+n)?Math.round(+n*s)/s:n}};var ds=class extends ba{constructor(){super(...arguments),this.type=W.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new ir}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setExtraAttrFromSpec();let i=(e=(t=this._tickData)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.getDataView().transformsArr.find(s=>s.type===this.registerTicksTransform());i&&(i.options=this._tickTransformOption())}initScales(){var t,e;super.initScales();let i=[0,1];A((t=this._domain)===null||t===void 0?void 0:t.min)&&(i[0]=this._domain.min),A((e=this._domain)===null||e===void 0?void 0:e.max)&&(i[1]=this._domain.max),this._scale.domain(i)}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:!((t=this._spec.breaks)===null||t===void 0)&&t.length?()=>this._break:null})}_getUpdateAttribute(t){var e,i;let s=super._getUpdateAttribute(t);if(!Rn(this._orient)&&(!((i=(e=this._break)===null||e===void 0?void 0:e.breaks)===null||i===void 0)&&i.length)){let{width:n,height:o}=this.getLayoutRect(),a=ve(this._orient),l=a?n:o;s.breaks=this._break.breaks.map(h=>{let{range:d,breakSymbol:c,gap:u=6}=h,p=this.valueToPosition((d[0]+d[1])/2)/l,m;m=pr(u)?Number(u.substring(0,u.length-1))/100:u/l;let g=K(c?.angle)?c.angle:a?60:15;return{range:[p-m/2,p+m/2],breakSymbol:Object.assign(Object.assign({visible:!0},c),{angle:g*Math.PI/180}),rawRange:d}})}return s}getNewScaleRange(){var t,e;let i=super.getNewScaleRange();return!((t=this._spec.breaks)===null||t===void 0)&&t.length&&(!((e=this._break)===null||e===void 0)&&e.scope)&&(i=Cf(this._break.scope).map(s=>i[0]+(It(i)-i[0])*s)),i}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){let t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t.valueToPosition=this.valueToPosition.bind(this),t}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,Cn),t}};ds.type=W.cartesianLinearAxis,ds.specKey="axes",Ct(ds,Po);var or=()=>{_a(),va(),On(),I.registerComponent(ds.type,ds)};var Tp=class{constructor(){this._rawDomainIndex=[]}_initData(){var t;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let e=0;e<this._scales.length;e++){let i=((t=this._spec.layers)!==null&&t!==void 0?t:[])[this._scales.length-1-e]||{};if(i.visible!==!1&&i.tickCount!==0&&i.forceTickCount!==0){let s=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),i),e);s.target.addListener("change",this._forceLayout.bind(this));let n=new Ii(this._option,s);this._tickData.push(n),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[e]=n}}else{let e=this._initTickDataSet(this._tickTransformOption());e.target.addListener("change",this._forceLayout.bind(this));let i=new Ii(this._option,e);this._tickData=[i],this._tickDataMap={0:i}}}dataToPosition(t,e={}){var i,s;if(t.length===0||this._scales.length===0)return 0;let{position:n,bandScale:o}=this.getPosition(t);return n+o.bandwidth()*((s=(i=e.bandPosition)!==null&&i!==void 0?i:this._spec.bandPosition)!==null&&s!==void 0?s:this._defaultBandPosition)}valueToPosition(t){return this._scale.scale(t)}updateGroupScaleRange(){let t=this._scale;this._scales.forEach((e,i)=>{i>0&&(e.range([0,t.bandwidth()]),t=e)})}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{let s=Math.min(t.length,this._scales.length);for(let n=0;n<s;n++)e+=this._scales[n].scale(t[n]);i=this._scales[s-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,s;let{bandPadding:n,paddingInner:o,paddingOuter:a}=this._spec,l=H(n),h=H(o),d=H(a);for(let c=0;c<this._scales.length;c++){let u=l?n[c]:n,p=h?o[c]:o,m=d?a[c]:a;this._scales[c].paddingInner((i=p??u)!==null&&i!==void 0?i:t,!0).paddingOuter((s=m??u)!==null&&s!==void 0?s:e,!0)}}computeBandDomain(t){if(!t.length)return[];if(t.length===1)return t[0].values;let e=new Set;for(let i=0;i<t.length;i++)for(let s=0;s<t[i].values.length;s++)e.add(t[i].values[s]);return Array.from(e)}updateScaleDomain(){var t;if(!this.isSeriesDataEnable())return;!(!((t=this._rawDomainIndex)===null||t===void 0)&&t.length)&&this._scales.length&&this._updateRawDomain();let e=this._spec.domain;for(let i=0;i<this._scales.length;i++)if(e&&e.length&&i===0)this._scales[i].domain(e);else{let s=this.collectData(i),n=this.computeBandDomain(s);this._scales[i].domain(n.sort((o,a)=>this._rawDomainIndex[i][o]-this._rawDomainIndex[i][a]))}this.transformScaleDomain(),this.event.emit(rt.scaleDomainUpdate,{model:this}),this.event.emit(rt.scaleUpdate,{model:this,value:"domain"})}getLabelItems(t){let e=[],i=[];return this._scales.forEach((s,n)=>{var o;let a=this._tickDataMap[n],l=(o=a?.getLatestData())===null||o===void 0?void 0:o.length,h=l?a.getLatestData().map(d=>d.value):s.domain();if(h&&h.length)if(i&&i.length){let d=[],c=[];i.forEach(u=>{h.forEach(p=>{let m=O(u).concat(p);if(c.push(m),l){let g=wo(p,this._getNormalizedValue(m,t));d.push(g)}})}),l&&e.push(d.filter(u=>u.value>=0&&u.value<=1)),i=c}else h.forEach(d=>{i.push(d)}),l&&e.push(a.getLatestData().map(d=>wo(d.value,this._getNormalizedValue([d.value],t))).filter(d=>d.value>=0&&d.value<=1))}),e.reverse()}_updateRawDomain(){this._rawDomainIndex=[];let t=this._spec.domain;for(let e=0;e<this._scales.length;e++)if(t&&t.length&&e===0)this._scales[e].domain(t);else{let i=this.collectData(e,!0),s=this.computeBandDomain(i);this._rawDomainIndex[e]={},s.forEach((n,o)=>this._rawDomainIndex[e][n]=o)}}_clearRawDomain(){this._rawDomainIndex=[]}};var zl=class extends ba{constructor(){super(...arguments),this.type=W.cartesianBandAxis,this._scale=new bs}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){let t=super.updateScaleRange();return this.updateGroupScaleRange(),t}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){let t=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:t,getBandwidth:(e=0)=>t(e).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,QD),t}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){let{bandSize:t,maxBandSize:e,minBandSize:i}=this._getOuterBandSizeFromSpec();if(t&&this._scale.bandwidth(t),e&&this._scale.maxBandwidth(e),i&&this._scale.minBandwidth(i),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(t||e)){let s=Du(this._scale.domain().length,t??e,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(n=>n.setMaxWidth(s)):["left","right"].includes(this._orient)&&this._regions.forEach(n=>n.setMaxHeight(s))}}}_getOuterBandSizeFromSpec(){var t;let{bandSize:e,maxBandSize:i,minBandSize:s,bandSizeLevel:n=0}=this._spec,{gap:o,extend:a=0}=(t=this._spec.bandSizeExtend)!==null&&t!==void 0?t:{};n=Math.min(n,this._scales.length-1);for(let l=n;l>0;l--){let h=this._scales[l],d=h.domain(),c=h.paddingInner(),u=h.paddingOuter(),p=m=>{let g=l===n?a:0;return T(o)||l<n?Du(d.length,m,c,u)+g:(m+(Z(o)?m*(Number(o.substring(0,o.length-1))/100):o))*d.length/(this._scales[l-1].paddingInner()+1)+g};A(e)&&(e=p(e)),A(i)&&(i=p(i)),A(s)&&(s=p(s))}return{bandSize:e,maxBandSize:i,minBandSize:s}}};zl.type=W.cartesianBandAxis,zl.specKey="axes",Ct(zl,Tp);var vr=()=>{_a(),va(),On(),I.registerComponent(zl.type,zl)};var $_=class extends ds{constructor(){super(...arguments),this.type=W.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:t=>{this.computeData(t?.value),be(this._regions,e=>{ve(this.getOrient())?qr(e.getXAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):qr(e.getYAxisHelper(),this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._tick=ot({},this._spec.tick,(t=this._spec.layers)===null||t===void 0?void 0:t[0])}_initData(){var t;if(super._initData(),(t=this._spec.layers)===null||t===void 0?void 0:t[1]){let e=new St(this._option.dataSet,{name:`${this.type}_${this.id}_layer_1_ticks`}).parse(this._scale,{type:"scale"}).transform({type:`${this.type}-ticks`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new Ii(this._option,e)}}computeData(t){super.computeData(t),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var t,e,i,s,n,o,a,l;let h=nn.getInstance(),d=((e=(t=this._spec.layers)===null||t===void 0?void 0:t[1])===null||e===void 0?void 0:e.timeFormat)||"%Y%m%d",c=(((s=(i=this._spec.layers)===null||i===void 0?void 0:i[1])===null||s===void 0?void 0:s.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat,u=((o=(n=this._spec.layers)===null||n===void 0?void 0:n[0])===null||o===void 0?void 0:o.timeFormat)||"%Y%m%d",p=(((l=(a=this._spec.layers)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat;return(m,g,f,_,v)=>{var x;let y;return y=v===0?p(u,m):c(d,m),!((x=this._spec.label)===null||x===void 0)&&x.formatMethod?this._spec.label.formatMethod(y,g):y}}getLabelItems(t){var e,i;let s=[],n=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();n&&n.length&&s.push(n.map(a=>wo(a.value,this._getNormalizedValue([a.value],t))));let o=(i=this._layerTickData)===null||i===void 0?void 0:i.getLatestData();return o&&o.length&&s.push(o.map(a=>wo(a.value,this._getNormalizedValue([a.value],t)))),s}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,Cn),t}transformScaleDomain(){}};$_.type=W.cartesianTimeAxis,$_.specKey="axes";var kp=class extends ds{constructor(){super(...arguments),this.type=W.cartesianLogAxis,this._zero=!1,this._scale=new Bu}initScales(){var t;super.initScales(),this._scale.base((t=this._spec.base)!==null&&t!==void 0?t:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,Cn),t}transformScaleDomain(){}};kp.type=W.cartesianLogAxis,kp.specKey="axes",Ct(kp,Po);var Mp=class extends ds{constructor(){super(...arguments),this.type=W.cartesianSymlogAxis,this._zero=!1,this._scale=new Lu}initScales(){var t;super.initScales(),this._scale.constant((t=this._spec.constant)!==null&&t!==void 0?t:10)}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,Cn),t}transformScaleDomain(){}};Mp.type=W.cartesianSymlogAxis,Mp.specKey="axes",Ct(Mp,Po);var Sa=class r extends ei{constructor(){super(...arguments),this.type=F.area,this.transformerConstructor=X_,this._sortDataByAxis=!1}initMark(){var t;let e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=this._spec.area||{},s=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"area",n=this._isAreaVisible()||this._isLineVisible();this._areaMark=this._createMark(r.mark.area,{groupKey:this._seriesField,isSeriesMark:n&&s!=="point",stateSort:i.stateSort},Object.assign(Object.assign({},e),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:i.customShape})),this.initSymbolMark(e,s==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var t,e,i,s,n;let o=(i=(e=(t=this.getSpec().area)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.curveType)!==null&&i!==void 0?i:(n=(s=this.getSpec().line)===null||s===void 0?void 0:s.style)===null||n===void 0?void 0:n.curveType,a=o===u1?this._direction==="horizontal"?"monotoneY":"monotoneX":o,l=this._areaMark;if(l){let h=this._isAreaVisible(),d=this._isLineVisible();h||d?l.setVisible(!0):l.setVisible(!1),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:c=>{var u,p;return Qt(this.dataToPositionX1(c),(p=(u=this._xAxisHelper)===null||u===void 0?void 0:u.getScale)===null||p===void 0?void 0:p.call(u,0))},y:this.dataToPositionY.bind(this),y1:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",X.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:this.dataToPositionX.bind(this),y1:c=>{var u,p;return Qt(this.dataToPositionY1(c),(p=(u=this._yAxisHelper)===null||u===void 0?void 0:u.getScale)===null||p===void 0?void 0:p.call(u,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",X.Series),this.setMarkStyle(l,{fill:!!h&&this.getColorAttribute(),stroke:!!d&&this.getColorAttribute()},"normal",X.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",X.Series),this.getStack()&&this.setMarkStyle(l,{zIndex:c=>-c[pi]},"normal",X.Series),this.setMarkStyle(l,{curveType:a},"normal",X.Built_In),Object.keys(l.stateStyle).forEach(c=>{l.stateStyle[c].stroke&&l.setPostProcess("stroke",u=>[u,!1,!1,!1],c)})}}initAnimation(){var t,e,i,s;let n={direction:this.direction},o=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(_t((e=I.getAnimationInKey("line"))===null||e===void 0?void 0:e(n,o),xt("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(_t((i=I.getAnimationInKey("area"))===null||i===void 0?void 0:i(n,o),xt("area",this._spec,this._markAttributeContext))),this._symbolMark){let a=Er(this);this._symbolMark.setAnimationConfig(_t((s=I.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),xt("point",this._spec,this._markAttributeContext),a))}}_isAreaVisible(){var t;let e=this._spec.area||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}_isLineVisible(){var t;let e=this._spec.line||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}initTooltip(){this._tooltipHelper=new f1(this);let{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._areaMark&&t.add(this._areaMark),this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){return e=>{var i,s,n,o,a;let l=(i=this._spec.seriesMark)!==null&&i!==void 0?i:"area",h=(n=(s=this._seriesMark)===null||s===void 0?void 0:s.getAttribute(e,t))!==null&&n!==void 0?n:void 0;return e!=="fill"||h&&l!=="line"||(e="stroke",h=(a=(o=this._seriesMark)===null||o===void 0?void 0:o.getAttribute(e,t))!==null&&a!==void 0?a:void 0),e==="stroke"&&H(h)?h[0]:h}}};Sa.type=F.area,Sa.mark=_1,Sa.transformerConstructor=X_,Ct(Sa,Vl);var S1=class{get dataList(){return this._dataArr}constructor(t){this._dataArr=[],this._dataSet=t}parseData(t){this._dataArr=[];let e=O(t);for(let i=0;i<e.length;i++)this._dataArr.push(hp(e[i],this._dataSet,this._dataArr))}updateData(t,e=!1,i=!0){let s=O(t);return(!e||s.length===this._dataArr.length)&&(this._dataValueForEach(s,(n,o)=>{o.markRunning()}),this._dataValueForEach(s,(n,o)=>{dp(o,n,i)}),!0)}_dataValueForEach(t,e){t.forEach((i,s)=>{if(i instanceof St)return;let n=this.getSeriesData(i.id,s);n&&e(i,n,s)})}getSeriesData(t,e){if(!this._dataArr.length)return null;if(typeof t=="string"){let i=this._dataArr.filter(s=>s.name===t);if(i[0])return i[0];ji(`no data matches dataId ${t}!`)}if(typeof e=="number"){if(this._dataArr[e])return this._dataArr[e];ji(`no data matches dataIndex ${e}!`)}return this._dataArr[0]}};var A1=class{constructor(t,e){this._scaleSpecMap=new Map,this._scaleMap=new Map,this._modelScaleSpecMap=new Map,this._markAttributeScaleMap=new Map,this._spec=null,this._chart=null,this.getStatisticalFields=i=>{let s=[];return this._scaleSpecMap.forEach((n,o)=>{ra(n.domain)&&n.domain.forEach(a=>{a.dataId===i&&a.fields.forEach(l=>{ma(s,[{key:l,operations:Vt(n.type)?["max","min"]:["values"]}])})})}),this._markAttributeScaleMap.forEach((n,o)=>{let a=this.getScale(o);n.forEach(l=>{this._getSeriesBySeriesId(l.seriesId).getRawData().name===i&&l.field&&ma(s,[{key:l.field,operations:Vt(a.type)?["max","min"]:["values"]}])})}),s},this._spec=t,this._chart=e,this._setAttrFromSpec()}_createFromSpec(t){if(!t.id)return null;let e=this._scaleMap.get(t.id);return e||(e=t.type==="ordinal"&&t.id==="color"?iA("colorOrdinal"):iA(t.type)),e?(H(t.range)&&e.range(t.range),H(t.domain)&&(ra(t.domain)||e.domain(t.domain)),t.specified&&e.specified&&e.specified(t.specified),t.clamp&&e.clamp&&e.clamp(t.clamp),e):null}_setAttrFromSpec(){var t;if(!(!((t=this._spec)===null||t===void 0)&&t.length))return;let e=new Map,i=new Map;this._spec.forEach(s=>{let n=this._createFromSpec(s);n&&(e.set(s.id,n),i.set(s.id,s))}),this._modelScaleSpecMap.forEach(s=>{let n=this._createFromSpec(s);n&&(e.set(s.id,n),i.set(s.id,s))}),this._scaleSpecMap=i,this._scaleMap=e}updateSpec(t){let e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(Bt(t,this._spec))return e;e.change=!0;for(let i=0;i<t.length;i++){let s=t[i],n=this._scaleMap.get(s.id);if(!n)return e.reMake=!0,e;let o=this._spec.find(a=>a.id===s.id);if(!o.id||o.type!==s.type||!Bt(o.specified,s.specified))return e.reMake=!0,e;s.range&&!Bt(s.range,n.range())&&(n.range(s.range),e.reRender=!0),ra(s.domain)?e.reRender=!0:Bt(s.domain,n.domain())||(n.domain(s.domain),e.reRender=!0),this._scaleSpecMap.set(s.id,s)}return this._spec=t,e}registerModelScale(t){let e=this._createFromSpec(t);e&&(this._modelScaleSpecMap.set(t.id,t),this._scaleSpecMap.set(t.id,t),this._scaleMap.set(t.id,e))}removeModelScale(t){this._modelScaleSpecMap.forEach(e=>{t(e)&&(this._modelScaleSpecMap.delete(e.id),this._scaleSpecMap.delete(e.id),this._scaleMap.delete(e.id))})}getScale(t){return this._scaleMap.get(t)}getScaleSpec(t){return this._scaleSpecMap.get(t)}_getSeriesByRawDataId(t){let e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){let s=e[i];if(s.getRawData().name===t)return s}return null}_getSeriesBySeriesId(t){let e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){let s=e[i];if(s.id===t)return s}return null}updateScaleDomain(t){this._scaleSpecMap.forEach((e,i)=>{let s=this._scaleMap.get(i);if(!s)return;if(!ra(e.domain))return e.domain&&e.domain.length!==0||s.domain(t),void this._updateMarkScale(i,s,s.domain().slice());let n;n=Vt(e.type)?[null,null]:new Set,e.domain.forEach(a=>{let l=this._getSeriesByRawDataId(a.dataId);if(!l)return;let h=Vt(e.type);a.fields.forEach(d=>{let c=l.getRawDataStatisticsByField(d,h);c&&(h?(T(n[0])?n[0]=c.min:n[0]=Math.min(c.min,n[0]),T(n[1])?n[1]=c.max:n[1]=Math.max(c.max,n[1])):c.values.forEach(u=>{n.add(u)}))})});let o=n;Vt(e.type)||(n=Array.from(n)),s.domain(n),this._updateMarkScale(i,s,o)})}_updateMarkScale(t,e,i){let s=this._markAttributeScaleMap.get(t);s&&s.length!==0&&s.forEach(n=>{if(!n.field||!n.markScale||n.markScale===e)return;if(T(n.changeDomain)||n.changeDomain==="none"||T(n.seriesId))return void(Vt(e.type)?n.markScale.domain(i):e.domain(Array.from(i)));let o=this._getSeriesBySeriesId(n.seriesId),a=Vt(e.type),l=o.getRawDataStatisticsByField(n.field,a);if(!st(l))return n.changeDomain==="expand"?(a?(i[0]=Math.min(i[0],l.min),i[1]=Math.max(i[1],l.max)):(l.values.forEach(h=>{i.add(h)}),i=Array.from(i)),void n.markScale.domain(i)):void(n.changeDomain!=="replace"||(a?n.markScale.domain([l.min,l.max]):n.markScale.domain(l.values)));Vt(e.type)?n.markScale.domain(i):e.domain(Array.from(i))})}registerMarkAttributeScale(t,e){let i=this._scaleMap.get(t.scale),s=this._markAttributeScaleMap.get(t.scale);s||(s=[],this._markAttributeScaleMap.set(t.scale,s));let n=i;return(T(t.field)||!T(t.changeDomain)&&t.changeDomain!=="none"&&!T(e))&&(n=i.clone()),s.push(Object.assign(Object.assign({},t),{seriesId:e,markScale:n})),n}};var rG=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},At=class extends Mo{getSpec(){return this._spec}setSpec(t){this._spec=t}getOption(){return this._option}getLayoutRect(){return this._layoutRect}getViewRect(){return this._viewRect}getLayoutTag(){return this._layoutTag}setLayoutTag(t,e,i=!0){this._layoutTag=t;let s=this.getCompiler();return s?.getVGrammarView()&&(s.getVGrammarView().updateLayoutTag(),t&&i&&s.renderNextTick(e)),this._layoutTag}getGlobalScale(){return this._globalScale}getEvent(){return this._event}get chartData(){return this._chartData}constructor(t,e){var i,s,n;super(e),this.type="chart",this.id=ts(),this._regions=[],this._series=[],this._components=[],this._layoutRect={x:0,y:0,width:500,height:500},this._viewRect={width:500,height:500},this._viewBox={x1:0,y1:0,x2:500,y2:500},this._layoutTag=!0,this._idMap=new Map,this.state={layoutUpdateRank:1},this.padding={top:0,left:0,right:0,bottom:0},this.getAllSeries=()=>{var o;return(o=this._series)!==null&&o!==void 0?o:[]},this.getRegionsInIndex=o=>o&&o.length!==0?this._regions.filter((a,l)=>o.includes(l)):[this._regions[0]],this.getAllRegions=()=>this._regions,this.getRegionsInIds=o=>o?this._regions.filter(a=>o.includes(a.id)):[],this.getRegionsInQuerier=o=>o?this._regions.filter((a,l)=>O(o).some(h=>A(h.regionId)&&h.regionId===a.userId||h.regionIndex===l)):this._regions,this.getRegionsInUserId=o=>{if(o)return this._regions.find(a=>a.userId===o)},this.getRegionsInUserIdOrIndex=(o,a)=>this.getAllRegions().filter(l=>o?.length?l.userId&&o.includes(l.userId):!a?.length||a.includes(l.getSpecIndex())),this.getComponents=()=>this._components,this.getSeriesInIndex=o=>o&&o.length!==0?this._series.filter((a,l)=>o.includes(l)):[this._series[0]],this.getSeriesInIds=o=>o?this._series.filter(a=>o.includes(a.id)):[],this.getSeriesInUserId=o=>{if(o)return this._series.find(a=>a.userId===o)},this.getSeriesInUserIdOrIndex=(o,a)=>this.getAllSeries().filter(l=>o?.length?l.userId&&o.includes(l.userId):!a?.length||a.includes(l.getSpecIndex())),this.getComponentByIndex=(o,a)=>{let l=this._components.filter(h=>(h.specKey||h.type)===o);if(l&&l.length!==0)return l[a]},this.getComponentsByKey=o=>this._components.filter(a=>(a.specKey||a.type)===o),this.getComponentByUserId=o=>{let a=this._components.find(l=>l.userId===o);if(a)return a},this.getComponentsByType=o=>this._components.filter(a=>a.type===o),this._paddingSpec=Xr((i=t.padding)!==null&&i!==void 0?i:e.getTheme().padding),this._event=new ko(e.eventDispatcher,e.mode),this._dataSet=e.dataSet,this._chartData=new S1(this._dataSet),this._modelOption=Object.assign(Object.assign({},e),{mode:this._option.mode,map:this._idMap,getChartLayoutRect:()=>this._layoutRect,getChartViewRect:()=>this._viewRect,getChart:()=>this,globalScale:this._globalScale,onError:(s=this._option)===null||s===void 0?void 0:s.onError,disableTriggerEvent:((n=this._option)===null||n===void 0?void 0:n.disableTriggerEvent)===!0,getSeriesData:this._chartData.getSeriesData.bind(this._chartData)}),this._spec=t}created(t){this._chartData.parseData(this._spec.data),this._createGlobalScale(),this._createBackground(),this._createLayout(),t.forEachRegionInSpec(this._spec,this._createRegion.bind(this)),t.forEachSeriesInSpec(this._spec,this._createSeries.bind(this)),t.forEachComponentInSpec(this._spec,this._createComponent.bind(this),this._option.getSpecInfo())}init(){var t,e;(t=this._beforeInit)===null||t===void 0||t.call(this),this._regions.forEach(i=>i.init({})),this._series.forEach(i=>i.init({})),this._components.forEach(i=>i.init({dataSet:this._dataSet})),this._initEvent(),(e=this._initStack)===null||e===void 0||e.call(this),this.reDataFlow()}reDataFlow(){this._series.forEach(t=>{var e;return(e=t.getRawData())===null||e===void 0?void 0:e.markRunning()}),this._series.forEach(t=>t.fillData()),this.updateGlobalScaleDomain()}onResize(t,e,i=!0){let s={width:t,height:e};this._canvasRect=s,this._updateLayoutRect(this._option.viewBox),this.setLayoutTag(!0,null,i)}updateViewBox(t,e){this._option.viewBox=t,this._updateLayoutRect(t),this.setLayoutTag(!0,null,e)}_createBackground(){let t=this._spec.background;if(!t||typeof t!="object"||A(t.gradient))return;let e=xr(t,["x","y","width","height","x1","y1","image"]);e.background=t.image,this._backgroundMark=I.createMark("group","chart-background",{model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._globalScale}),this._backgroundMark.created(),this._backgroundMark.setStyle(Object.assign(Object.assign({},e),{x:()=>this._viewBox.x1,y:()=>this._viewBox.y1,width:()=>this._viewBox.x2-this._viewBox.x1,height:()=>this._viewBox.y2-this._viewBox.y1})),this._backgroundMark.setMarkConfig({zIndex:Tt.SeriesGroup-2})}_createRegion(t,e){if(!t)return;let{spec:i}=e,s=rG(e,["spec"]),n=new t(i,Object.assign(Object.assign({},this._modelOption),s));n&&(n.created(),this._regions.push(n))}_createSeries(t,e){if(!t)return;let{spec:i}=e,s=rG(e,["spec"]),n;if(A(i.regionId)?n=this.getRegionsInUserId(i.regionId):A(i.regionIndex)&&(n=this.getRegionsInIndex([i.regionIndex])[0]),!n&&!(n=this._regions[0]))return;let o=new t(i,Object.assign(Object.assign(Object.assign({},this._modelOption),s),{type:i.type,region:n,globalScale:this._globalScale,sourceDataList:this._chartData.dataList}));o&&(o.created(),this._series.push(o),n.addSeries(o))}getSeriesById(t){return this._series.find(e=>e.id===t)}_createComponent(t,e){let i=t.createComponent(e,Object.assign(Object.assign({},this._modelOption),{type:t.type,getAllRegions:this.getAllRegions,getRegionsInIndex:this.getRegionsInIndex,getRegionsInIds:this.getRegionsInIds,getRegionsInUserIdOrIndex:this.getRegionsInUserIdOrIndex,getAllSeries:this.getAllSeries,getSeriesInIndex:this.getSeriesInIndex,getSeriesInIds:this.getSeriesInIds,getSeriesInUserIdOrIndex:this.getSeriesInUserIdOrIndex,getAllComponents:this.getComponents,getComponentByIndex:this.getComponentByIndex,getComponentByUserId:this.getComponentByUserId,getComponentsByKey:this.getComponentsByKey,getComponentsByType:this.getComponentsByType}));i&&(i.created(),this._components.push(i))}getAllComponents(){return this._components}getAllModels(){return[].concat(this.getAllSeries(),this.getAllComponents(),this.getAllRegions())}getModelInFilter(t){if(Z(t))return this.getAllModels().find(i=>i.userId===t);if(V(t))return this.getAllModels().find(i=>t(i));let e=0;return this.getAllModels().find(i=>{var s;if(((s=i.specKey)!==null&&s!==void 0?s:i.type)===t.type){if(e===t.index)return!0;e++}return!1})}_createLayout(){this._updateLayoutRect(this._option.viewBox),this._initLayoutFunc()}setLayout(t){this._option.layout=t,this._initLayoutFunc()}_initLayoutFunc(){var t,e,i;if(this._layoutFunc=this._option.layout,!this._layoutFunc){let s=!1;(this._spec.zField||this._spec.series&&this._spec.series.some(o=>o.zField))&&(s=!0);let n=I.getLayoutInKey((e=(t=this._spec.layout)===null||t===void 0?void 0:t.type)!==null&&e!==void 0?e:s?"layout3d":"base");if(n){let o=new n(this._spec.layout,{onError:(i=this._option)===null||i===void 0?void 0:i.onError});this._layoutFunc=o.layoutItems.bind(o)}}}layout(t){var e,i,s,n;if((i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeLayoutWithSceneGraph)===null||i===void 0||i.call(e),this.getLayoutTag()){this._event.emit(rt.layoutStart,{chart:this,vchart:this._option.globalInstance}),this.onLayoutStart(t);let o=this.getLayoutElements();this._layoutFunc(this,o,this._layoutRect,this._viewBox),this._event.emit(rt.afterLayout,{elements:o,chart:this}),this.setLayoutTag(!1),this.onLayoutEnd(t),this._event.emit(rt.layoutEnd,{chart:this,vchart:this._option.globalInstance})}(n=(s=this._option.performanceHook)===null||s===void 0?void 0:s.afterLayoutWithSceneGraph)===null||n===void 0||n.call(s)}onLayoutStart(t){this.getAllModels().forEach(e=>e.onLayoutStart(this._layoutRect,this._viewRect,t))}onLayoutEnd(t){this.getAllModels().forEach(e=>{e.modelType!=="series"&&e.onLayoutEnd(t)})}onEvaluateEnd(t){[...this._components,...this._regions,...this._series].forEach(e=>e.onEvaluateEnd(t))}getLayoutElements(){return this.getAllModels().map(t=>t.layout).filter(t=>!!t)}getModelById(t){let e=this._idMap.get(t);if(e&&e instanceof Nl)return e}getModelByUserId(t){let e=this.getSeriesInUserId(t);if(e)return e;let i=this.getRegionsInUserId(t);return i||this.getComponentByUserId(t)||void 0}getAllMarks(){return Array.from(this._idMap.values()).filter(t=>t&&t instanceof Te)}getMarkById(t){let e=this._idMap.get(t);if(e&&e instanceof Te)return e}getMarkByUserName(t){return this.getAllMarks().filter(e=>e.name&&e.name===t)}updateData(t,e,i=!0,s){let n=this._dataSet.getDataView(t);n&&(n.markRunning(),n.parseNewData(e,s)),i&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(o=>o.onDataUpdate())}updateFullData(t,e=!0){O(t).forEach(i=>{let s=this._dataSet.getDataView(i.id);s&&s.markRunning()}),O(t).forEach(i=>{let s=this._dataSet.getDataView(i.id);s&&dp(s,i,!0)}),e&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(i=>i.onDataUpdate())}onRender(t){}setCanvasRect(t,e){this._canvasRect={width:t,height:e}}getCanvasRect(){return this._canvasRect||(this._canvasRect=$A(this._spec,this._option,{width:500,height:500})),this._canvasRect}getSeriesData(t,e){return this._chartData.getSeriesData(t,e)}_transformSpecScale(){var t;let e=this._spec.scales?[...this._spec.scales]:[],i=e.find(n=>n.id==="color"),s=this.getColorScheme();if(!i&&(i={type:"ordinal",id:"color",domain:null,range:null},e.push(i),this._spec.color)){let n=this._spec.color;if(H(n))i.range=n;else{let o=n;Object.prototype.hasOwnProperty.call(o,"type")&&(i.type=o.type),Object.prototype.hasOwnProperty.call(o,"domain")&&(i.domain=o.domain),Object.prototype.hasOwnProperty.call(o,"range")&&(i.range=o.range),Object.prototype.hasOwnProperty.call(o,"specified")&&(i.specified=o.specified),Object.prototype.hasOwnProperty.call(o,"clamp")&&(i.clamp=o.clamp)}}return!((t=i.range)===null||t===void 0)&&t.length||(i.range=Cl(s),i.rangeTheme=!0),e}_createGlobalScale(){this._globalScale=new A1(this._transformSpecScale(),this),this._modelOption.globalScale=this._globalScale}updateGlobalScaleDomain(){let t=new Set;this._series.forEach(i=>{let s=i.getSeriesKeys();s&&s.forEach(n=>t.add(n))});let e=Array.from(t);this._globalScale.updateScaleDomain(e)}updateGlobalScale(t){Fl(t,this._globalScale.updateSpec(this._transformSpecScale()))}updateGlobalScaleTheme(){let t=this._globalScale.getScaleSpec("color"),e=this.getColorScheme();t.rangeTheme&&(t.range=Cl(e),this._globalScale.getScale("color").range(t.range))}_getSpecKeys(t){let e={width:!0,height:!0};return Object.keys(t).filter(i=>!e[i]).sort()}updateSpec(t){let e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(this.setLayoutTag(!0,null,!1),t.type!==this.type)return e.reMake=!0,e;let i=this._getSpecKeys(this._spec),s=this._getSpecKeys(t);if(!Bt(i,s))return e.reMake=!0,e;for(let o=0;o<i.length;o++){let a=i[o];if(H(this._spec[a])&&this._spec[a].length!==O(t[a]).length)return e.reMake=!0,e}let n=this._spec;return this._spec=t,this.updateChartConfig(e,n),e.reMake?e:(this.updateGlobalScale(e),e.reMake?e:(this.updateRegionSpec(e),e.reMake?e:(this.updateComponentSpec(e),e.reMake||(this.updateSeriesSpec(e),e.reMake||(this.reInit(),this.updateDataSpec(),this.updateGlobalScaleDomain())),e)))}updateChartConfig(t,e){var i,s;this._paddingSpec=Xr((i=this._spec.padding)!==null&&i!==void 0?i:(s=this._option)===null||s===void 0?void 0:s.getTheme().padding),this._updateLayoutRect(this._viewBox)}updateDataSpec(){this._spec.data&&this._chartData.updateData(this._spec.data,!1,!0)}updateRegionSpec(t){var e;!((e=this._spec)===null||e===void 0)&&e.region&&(this._spec.region.length===this._regions.length?this._regions.forEach(i=>{Fl(t,i.updateSpec(this._spec.region[i.getSpecIndex()]))}):t.reMake=!0)}updateComponentSpec(t){let e={},i={[W.title]:!0,[W.brush]:!0,[W.mapLabel]:!0,[W.indicator]:!0};this._components.forEach(n=>{var o,a;if(n.type===W.label||n.type===W.totalLabel)return;i[n.type]&&(i[n.type]=!1);let l=n.specKey||n.type,h=(o=this._spec[l])!==null&&o!==void 0?o:{};H(h)?(e[l]=e[l]||{specCount:h.length,componentCount:0},e[l].componentCount++,Fl(t,n.updateSpec((a=h[n.getSpecIndex()])!==null&&a!==void 0?a:{},h))):Fl(t,n.updateSpec(h))});for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let o=e[n];o.componentCount!==o.specCount&&(t.reMake=!0)}let s=n=>n&&n.visible!==!1;Object.keys(i).forEach(n=>{if(i[n]){let o=this._spec[n];(H(o)?o.some(s):s(o))&&(t.reMake=!0)}})}updateSeriesSpec(t){this._spec.series.length===this._series.length?this._series.forEach(e=>{let i=this._spec.series[e.getSpecIndex()];Fl(t,e.updateSpec(i))}):t.reMake=!0}getCanvas(){var t,e;return(e=(t=this.getCompiler())===null||t===void 0?void 0:t.getCanvas())!==null&&e!==void 0?e:null}_updateLayoutRect(t){let e=this.getCanvasRect();if(t){this._viewBox=t;let{x1:i=0,y1:s=0,x2:n,y2:o}=t;e={width:n-i,height:o-s}}else this._viewBox={x1:0,y1:0,x2:e.width,y2:e.height};this._viewRect=e,this.padding=rA(this._paddingSpec,e,e),this._layoutRect.width=e.width-this.padding.left-this.padding.right,this._layoutRect.height=e.height-this.padding.top-this.padding.bottom,this._layoutRect.x=this.padding.left,this._layoutRect.y=this.padding.top,this._event.emit(rt.layoutRectUpdate,{chart:this})}setCurrentTheme(){this.updateChartConfig({change:!0,reMake:!1},this._spec),this.setLayoutTag(!0,null,!1),this.updateGlobalScaleTheme(),this.reInit()}reInit(){[...this._regions,...this._series,...this._components].forEach(t=>{let e=t.getSpecInfo();e&&e.spec&&t.reInit(e.spec)})}clear(){this.getAllModels().forEach(t=>{var e;return(e=t.clear)===null||e===void 0?void 0:e.call(t)})}compile(){this.compileBackground(),this.compileLayout(),this.compileRegions(),this.compileSeries(),this.compileComponents()}afterCompile(){this.getAllRegions().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllSeries().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllComponents().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)})}compileLayout(){let{width:t,height:e}=this.getCanvasRect();this.getCompiler().setSize(t,e)}compileBackground(){var t;this._backgroundMark&&(this._backgroundMark.compile({context:{model:this}}),(t=this._backgroundMark.getProduct())===null||t===void 0||t.layout(()=>{}))}compileRegions(){var t,e,i,s;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeRegionCompile)===null||e===void 0||e.call(t),this.getAllRegions().forEach(n=>{n.compile()}),(s=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterRegionCompile)===null||s===void 0||s.call(i)}compileSeries(){var t,e,i,s;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeSeriesCompile)===null||e===void 0||e.call(t),this.getAllSeries().forEach(n=>{n.compile()}),(s=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterSeriesCompile)===null||s===void 0||s.call(i)}compileComponents(){var t,e,i,s;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeComponentCompile)===null||e===void 0||e.call(t),this.getAllComponents().forEach(n=>{n.compile()}),(s=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterComponentCompile)===null||s===void 0||s.call(i)}release(){[...this._components,...this._regions,...this._series].forEach(t=>{t.beforeRelease()}),super.release(),this.clear(),[...this._components,...this._regions,...this._series].forEach(t=>{t.release()}),this._components=this._regions=this._series=[],this._spec={},this._dataSet=this._globalScale=this._layoutFunc=null,this._layoutTag=!1,this._idMap.clear()}onLayout(t){let e=t.rootMark;this.layout({group:e,srView:t})}updateState(t,e){let i=this.getAllSeries();for(let s in t){if(st(t[s]))continue;let n=t[s],o={stateValue:s};o=V(n.filter)?Object.assign({filter:n.filter},o):Object.assign(Object.assign({},n.filter),o),n.level&&(o.level=n.level),i.forEach(a=>{a.getMarks().forEach(l=>{l.stateStyle[s]&&(e&&!e(a,l,s)||(l.state.changeStateInfo(o),l.updateMarkState(s)))})})}}setSelected(t,e,i){this._setStateInDatum(it.STATE_SELECTED,!0,t,e,i)}setHovered(t,e,i){this._setStateInDatum(it.STATE_HOVER,!0,t,e,i)}clearState(t){this.getAllRegions().forEach(e=>{e.interaction.clearEventElement(t,!0),e.interaction.resetInteraction(t,null)})}clearAllStates(){this.getAllRegions().forEach(t=>{t.interaction.clearAllEventElement(),t.interaction.resetAllInteraction()})}clearSelected(){this.clearState(it.STATE_SELECTED)}clearHovered(){this.clearState(it.STATE_HOVER)}_initEvent(){[rt.dataZoomChange,rt.scrollBarChange].forEach(t=>{this._event.on(t,({value:e})=>{this._disableMarkAnimation(["exit","update"]);let i=()=>{this._enableMarkAnimation(["exit","update"]),this._event.off(pt.AFTER_MARK_RENDER_END,i)};this._event.on(pt.AFTER_MARK_RENDER_END,i)})})}_enableMarkAnimation(t){this.getAllMarks().forEach(e=>{let i=e.getProduct();i&&i.animate&&i.animate.enableAnimationState(t)})}_disableMarkAnimation(t){this.getAllMarks().forEach(e=>{let i=e.getProduct();i&&i.animate&&i.animate.disableAnimationState(t)})}_setStateInDatum(t,e,i,s,n){let o=(i=i?O(i):null)?Object.keys(i[0]):null;this.getRegionsInQuerier(n).forEach(a=>{i?(a.getSeries().forEach(l=>{l.getMarks().forEach(h=>{if(h.getProduct()&&(!s||V(s)&&s(l,h))){let d=h.getProduct().isCollectionMark(),c=h.getProduct().elements,u=[];if(d)u=c.filter(p=>{let m=p.getDatum();i.every((g,f)=>o.every(_=>g[_]==m[f][_]))});else if(i.length>1){let p=i.slice();u=c.filter(m=>{if(p.length===0)return!1;let g=m.getDatum(),f=p.findIndex(_=>o.every(v=>_[v]==g[v]));return f>=0&&(p.splice(f,1),!0)})}else{let p=c.find(m=>o.every(g=>i[0][g]==m.getDatum()[g]));p&&(u=[p])}u.forEach(p=>{a.interaction.startInteraction(t,p)})}})}),e&&a.interaction.reverseEventElement(t)):a.interaction.clearEventElement(t,!0)})}setDimensionIndex(t,e){var i,s;let n=null;Array.from(this._event.getComposedEventMap().values()).forEach(a=>{let{eventType:l,event:h}=a;if(l===As.dimensionHover||l===As.dimensionClick){let d=h.dispatch(t,e);d?.length&&(n=d)}});let o=T(t)||!n||n.every(a=>Ke(a.axis.getScale().type)&&T(a.index));if(e.tooltip!==!1){let a=this.getComponentsByType(W.tooltip)[0];if(a?.getVisible())if(o)(s=(i=a).hideTooltip)===null||s===void 0||s.call(i);else{let l={};n.forEach(h=>{let{axis:d,value:c,data:u}=h,p=d.getOrient()==="left"||d.getOrient()==="right";u.forEach(m=>{var g,f,_;let v=p?m.series.fieldY[0]:m.series.fieldX[0];l[v]=(_=(f=(g=m.datum)===null||g===void 0?void 0:g[0])===null||f===void 0?void 0:f[v])!==null&&_!==void 0?_:c})}),a.showTooltip(l,e.showTooltipOption)}}if(e.crosshair!==!1){let a=this.getComponentsByType(W.cartesianCrosshair)[0];a&&a.clearAxisValue&&a.setAxisValue&&(o?a.hideCrosshair():a.showCrosshair(n))}}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}};var fw=(r,t)=>{var e;let i=r.spec,{regionId:s,regionIndex:n}=i;if(A(s)){let o=O(s);return(e=t.region)===null||e===void 0?void 0:e.filter(({spec:a})=>o.includes(a.id))}if(A(n))return O(n).map(o=>{var a;return(a=t.region)===null||a===void 0?void 0:a[o]}).filter(A)},sG=(r,t)=>{var e;let i=r.spec,{seriesId:s,seriesIndex:n}=i;if(A(s)){let o=O(s);return(e=t.series)===null||e===void 0?void 0:e.filter(({spec:a})=>o.includes(a.id))}if(A(n))return O(n).map(o=>{var a;return(a=t.series)===null||a===void 0?void 0:a[o]}).filter(A)};var Ie=class{constructor(t){this._option=t,this.type=t.type,this.seriesType=t.seriesType}initChartSpec(t){return this.transformSpec(t),this.transformModelSpec(t)}transformSpec(t){t.region&&t.region.length!==0||(t.region=[{}]),t.tooltip===void 0&&(t.tooltip={}),A(t.stackInverse)&&t.region.forEach(e=>{!A(e.stackInverse)&&(e.stackInverse=t.stackInverse)}),A(t.stackSort)&&t.region.forEach(e=>{!A(e.stackSort)&&(e.stackSort=t.stackSort)})}generateTransform(t,e){return(i,s,n)=>{let{spec:o,specPath:a,specInfoPath:l,type:h}=s,d=new i.transformerConstructor(Object.assign(Object.assign({},this._option),{type:h})),c=d.transformSpec(o,t,n),u=Object.assign(Object.assign({},s),c);e?u.theme=d.getTheme(o,t):cA(t,a,c.spec),cA(n,l??a,u)}}transformModelSpec(t){return this.createSpecInfo(t,this.generateTransform(t,!1))}createSpecInfo(t,e){var i,s;e||(e=this.generateTransform(t,!0));let n={};return this.forEachRegionInSpec(t,e,n),this.forEachSeriesInSpec(t,e,n),(i=n.series)===null||i===void 0||i.forEach((o,a)=>{var l,h;let d=((h=(l=fw(o,n))!==null&&l!==void 0?l:n.region)!==null&&h!==void 0?h:[])[0];d&&(d.seriesIndexes||(d.seriesIndexes=[]),d.seriesIndexes.push(a),o.regionIndexes=d.regionIndexes.slice())}),this.forEachComponentInSpec(t,e,n),Object.values((s=n.component)!==null&&s!==void 0?s:{}).forEach(o=>o.forEach((a,l)=>{var h,d,c;if(a){if(!a.regionIndexes){let u=(d=(h=fw(a,n))!==null&&h!==void 0?h:n.region)!==null&&d!==void 0?d:[];a.regionIndexes=u.map(p=>p.regionIndexes[0])}if(!a.seriesIndexes){let u=sG(a,n);if(u)a.seriesIndexes=u.map(({seriesIndexes:p})=>p[0]);else{let p=new Set;((c=a.regionIndexes)!==null&&c!==void 0?c:[]).forEach(m=>{var g,f;let _=(g=n.region)===null||g===void 0?void 0:g[m];(f=_?.seriesIndexes)===null||f===void 0||f.forEach(v=>p.add(v))}),a.seriesIndexes=Array.from(p)}}}})),n}_isValidSeries(t){return!0}_getDefaultSeriesSpec(t,e,i){var s,n,o,a;let l={dataKey:t.dataKey,hover:t.hover,select:t.select,label:t.label,seriesStyle:t.seriesStyle,animation:(s=t.animation)!==null&&s!==void 0?s:this._option.animation,animationThreshold:(n=t.animationThreshold)!==null&&n!==void 0?n:(a=(o=this._option).getTheme)===null||a===void 0?void 0:a.call(o).animationThreshold,animationAppear:t.animationAppear,animationDisappear:t.animationDisappear,animationEnter:t.animationEnter,animationUpdate:t.animationUpdate,animationExit:t.animationExit,animationNormal:t.animationNormal,animationState:t.animationState,extensionMark:t.extensionMark,large:t.large,largeThreshold:t.largeThreshold,progressiveStep:t.progressiveStep,progressiveThreshold:t.progressiveThreshold,background:t.seriesBackground,invalidType:t.invalidType,seriesField:t.seriesField,morph:t.morph,interactions:t.interactions},h=this.seriesType;return h&&(l.type=h,l[h]=t[h]),e&&e.length&&e.forEach(d=>{l[d]=t[d]}),i&&i.length&&i.forEach(d=>{l[d]=t[d]}),l}forEachRegionInSpec(t,e,i){var s;return((s=t.region)!==null&&s!==void 0?s:[]).map((n,o)=>e(I.getRegionInType("region"),{spec:n,specPath:["region",o],type:"region",regionIndexes:[o]},i))}forEachSeriesInSpec(t,e,i){var s;return((s=t.series)!==null&&s!==void 0?s:[]).map((n,o)=>e(I.getSeriesInType(n.type),{spec:n,specPath:["series",o],type:n.type,seriesIndexes:[o]},i))}forEachComponentInSpec(t,e,i){var s,n,o;let a=[],l=I.getComponents(),h,d,c,u,p=[];for(let g=0;g<l.length;g++){let{cmp:f,alwaysCheck:_}=l[g];f.type.startsWith(W.cartesianAxis)?h=f:f.type.startsWith(W.polarAxis)?d=f:f.type===W.geoCoordinate?c=f:(_||t[(s=f.specKey)!==null&&s!==void 0?s:f.type])&&(f.type===W.tooltip?u=f:p.push(f))}let m=!1;if(h){let g=h.getSpecInfo(t,i);g?.length>0&&(m=!0,g.forEach(f=>{let _=I.getComponentInKey(f.type);a.push(e(_,f,i))}))}if(d&&!m){let g=d.getSpecInfo(t,i);g?.length>0&&(m=!0,g.forEach(f=>{let _=I.getComponentInKey(f.type);a.push(e(_,f,i))}))}return c&&!m&&((n=c.getSpecInfo(t,i))===null||n===void 0||n.forEach(g=>{a.push(e(c,g,i))})),p.forEach(g=>{var f;(f=g.getSpecInfo?g.getSpecInfo(t,i):Fi(t,g.specKey,g.type))===null||f===void 0||f.forEach(_=>{a.push(e(g,_,i))})}),u&&((o=Fi(t,u.specKey,u.type))===null||o===void 0||o.forEach(g=>{a.push(e(u,g,i))})),a}transformSeriesSpec(t){let e=this._getDefaultSeriesSpec(t);t.series&&t.series.length!==0?t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})}):t.series=[e]}_findBandAxisBySeries(t,e,i){let s=t?.direction==="horizontal"?["left","right"]:["top","bottom"];return i.find(n=>{if(!s.includes(n.orient))return!1;if(A(n.seriesId)){if(O(n.seriesId).includes(t?.id))return!0}else if(A(n.seriesIndex)){if(O(n.seriesIndex).includes(e))return!0}else if(n.type==="band")return!0;return!0})}_applyAxisBandSize(t,e,i){let{barMaxWidth:s,barMinWidth:n,barWidth:o,barGapInGroup:a}=i,l=!1;J(n)?(t.minBandSize=n,l=!0):J(o)?(t.minBandSize=o,l=!0):J(s)&&(t.minBandSize=s,l=!0),l&&(t.bandSizeLevel=Number.MAX_VALUE,t.bandSizeExtend={extend:e,gap:H(a)?a[a.length-1]:a})}};var ai=class extends Ie{needAxes(){return!0}_isValidSeries(t){return!this.seriesType||t===this.seriesType}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["xField","yField","zField","direction","stack","percent","stackOffsetSilhouette","totalLabel","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),super.transformSeriesSpec(t),this._transformAxisSpec(t)}_setDefaultXAxisSpec(t){return{orient:"bottom"}}_setDefaultYAxisSpec(t){return{orient:"left"}}_setDefaultZAxisSpec(t){return{orient:"z"}}_transformAxisSpec(t){if(this.needAxes()){t.axes||(t.axes=[]);let e={x:!1,y:!1,z:!1};t.axes.forEach(i=>{let{orient:s}=i,n=null;s!=="top"&&s!=="bottom"||(e.x=!0,n=this._setDefaultXAxisSpec(t)),s!=="left"&&s!=="right"||(e.y=!0,n=this._setDefaultYAxisSpec(t)),s==="z"&&(e.z=!0,n=this._setDefaultZAxisSpec(t)),n&&Object.keys(n).forEach(o=>{T(i[o])&&(i[o]=n[o])}),ft(i,"trimPadding")&&ot(i,qA(this.type,t))}),e.x||t.axes.push(this._setDefaultXAxisSpec(t)),e.y||t.axes.push(this._setDefaultYAxisSpec(t)),t.zField&&!e.z&&t.axes.push(this._setDefaultZAxisSpec(t))}}};var q_=class extends ai{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["point","line","area","seriesMark","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","areaLabel"])}transformSpec(t){super.transformSpec(t),nr(t)}};var C1=(r,t)=>{let e={nodes:{}},{fields:i}=t;if(!i?.length)return e;let s=i.length-1,n,o,a=e;return r.forEach(l=>{l.latestData&&l.latestData.forEach(h=>{a=e;for(let d=0;d<i.length;d++){let c=i[d],u=h[c];if(T(u))break;a.groupField=c,a.nodes[u]||(d===s?a.nodes[u]={values:[]}:(n={nodes:{}},a.nodes[u]=n)),d===s?(o=a.nodes[u],o.values.push(h)):a=a.nodes[u]}})}),e};var Z_=class{constructor(t,e){this.stackRegion=({model:i})=>{var s;let n=i.getSeries();if(!n.some(d=>d.getStack()))return;let o=n.some(d=>{var c,u;return(u=(c=d.getSpec())===null||c===void 0?void 0:c.totalLabel)===null||u===void 0?void 0:u.visible}),a=o||n.some(d=>d.getPercent()),l=n.some(d=>d.getStackOffsetSilhouette()),h=vA(i,!0);for(let d in h)for(let c in h[d].nodes)yA(h[d].nodes[c],i.getStackInverse(),a,o);if(l)for(let d in h)for(let c in h[d].nodes)mV(h[d].nodes[c]);o&&i.getSeries().forEach(d=>{let c=d.getStackData(),u=d.getStackValue(),p=d.getStackValueField();c&&p&&DE(h[u],p)}),!((s=this._options)===null||s===void 0)&&s.afterStackRegion&&this._options.afterStackRegion(i,h)},this._chart=t,this._options=e}init(){this._chart.getAllRegions().forEach(t=>{t.event.on(rt.regionSeriesDataFilterOver,{filter:({model:e})=>e?.id===t.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(t=>{this.stackRegion({model:t})})}},Mi=class{_beforeInit(){this._dataSet&&nt(this._dataSet,"stackSplit",C1)}_initStack(){this._stack=new Z_(this),this._stack.init()}};var Ld=class extends At{constructor(){super(...arguments),this.transformerConstructor=q_,this.type="area",this.seriesType=F.area}};Ld.type="area",Ld.seriesType=F.area,Ld.transformerConstructor=q_,Ct(Ld,Mi);function nG(r,t=!0){return(e,i,s)=>{let n=r.direction==="vertical"?r.yField:r.xField,o=e?.[n];return r.direction==="vertical"?{overall:t&&r.growFrom(),orient:o>0?"negative":"positive"}:{overall:!!t&&r.growFrom(),orient:o>0?"positive":"negative"}}}var vw=(r,t=!0)=>({type:r.direction==="horizontal"?"growWidthIn":"growHeightIn",options:nG(r,t)}),_w=(r,t=!0)=>({type:r.direction==="horizontal"?"growWidthOut":"growHeightOut",options:nG(r,t)}),eq={type:"fadeIn"},iq={type:"growCenterIn"};function rq(r,t){if(t===!1)return{};switch(t){case"fadeIn":return eq;case"scaleIn":return iq;default:return vw(r)}}var oG=()=>{I.registerAnimation("bar",(r,t)=>({appear:rq(r,t),enter:vw(r,!1),exit:_w(r,!1),disappear:_w(r)}))};var J_=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}};J_.type="rect";var Hn=()=>{I.registerMark(J_.type,J_),_j(),QE()};var Dp=Object.assign(Object.assign({},Ft),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}}),T1=Object.assign(Object.assign({},Ft),{bar3d:{name:"bar3d",type:"rect3d"}});function yw(r,t,e){var i,s;if(r.values.length>0){let n;if(r.sortDatums.length){let o=r.sortDatums;t&&(o=r.sortDatums.slice().reverse());for(let a=0;a<o.length;a++)n=aG(o[a].datum,n,o[a].series,e,(s=(i=o[a].series[e.axisHelper]).getScale)===null||s===void 0?void 0:s.call(i,0),a===0)}else{let o=r.series;t&&(o=o.slice().reverse()),o.forEach(({s:a,values:l},h)=>{var d,c;let u=(c=(d=a[e.axisHelper]).getScale)===null||c===void 0?void 0:c.call(d,0);for(let p=0;p<l.length;p++){let m=l[t?l.length-1-p:p];n=aG(m,n,a,e,u,p===0&&h===0)}})}}for(let n in r.nodes)yw(r.nodes[n],t,e)}function aG(r,t,e,i,s,n){let o=e.getSpec().barMinHeight,a=e[i.axisHelper].isInverse(),l=Qt(e[i.startMethod](r),s),h=Qt(e[i.endMethod](r),s);n&&(t=l);let d=Math.abs(l-h);d<o&&(d=o);let c=1;return h<l?c=-1:h===l&&(c=i.isVertical?a?1:-1:a?-1:1),h=t+c*d,r[i.start]=t,r[i.end]=h,h}var cs=class extends ye{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar")}};var wr=class r extends ei{constructor(){super(...arguments),this.type=F.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=cs,this._bandPosition=0,this._getBarXStart=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[nw]):this._spec.barMinHeight?this._calculateRectPosition(t,!1,i):Qt(this._dataToPosX(t),e,i),this._getBarXEnd=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[ow]):Qt(this._dataToPosX1(t),e,i),this._getBarYStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[aw]):this._spec.barMinHeight?this._calculateRectPosition(t,!0):Qt(this._dataToPosY(t),e),this._getBarYEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[lw]):Qt(this._dataToPosY1(t),e),this._getBarBackgroundXStart=t=>{let e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundXEnd=t=>{let e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundYStart=t=>{let e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundYEnd=t=>{let e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var t;return(t=this._barBackgroundPositionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionXEncoder=t=>{this._barBackgroundPositionXEncoder=t.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var t;return(t=this._barBackgroundPositionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionYEncoder=t=>{this._barBackgroundPositionYEncoder=t.bind(this)}}initMark(){var t,e;this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},r.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.bar)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:vi(this._spec,this._barMarkName),setCustomizedShape:(e=this._spec.bar)===null||e===void 0?void 0:e.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(r.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",X.Series)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();let{mark:t,group:e}=this._tooltipHelper.activeTriggerSet;this._barMark&&(t.add(this._barMark),e.add(this._barMark))}_statisticViewData(){var t,e;super._statisticViewData();let i=(t=this._spec.barBackground)!==null&&t!==void 0?t:{};if(!i.visible)return;let s=this._getRelatedComponentSpecInfo("axes").some(o=>o.type===W.cartesianBandAxis),n;if(nt(this._option.dataSet,"addVChartProperty",en),s){let o=([a],{scaleDepth:l})=>{var h,d;let c=[{}],u=this.getDimensionField(),p=T(l)?u.length:Math.min(u.length,l);for(let m=0;m<p;m++){let g=u[m],f=(h=a.latestData[g])===null||h===void 0?void 0:h.values;if(!f?.length)continue;let _=[],v=(d=this._spec.dataKey)!==null&&d!==void 0?d:ki;for(let x=0;x<f.length;x++)for(let y=0;y<c.length;y++)_.push(Object.assign(Object.assign({},c[y]),{[g]:f[x],[v]:f[x]}));c=_}return c};nt(this._option.dataSet,"dimensionItems",o),n=new St(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:T(i.fieldLevel)?void 0:i.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1),(e=this._viewDataStatistics)===null||e===void 0||e.target.addListener("change",n.reRunAllTransform)}else{let o=([l])=>{let h=[],[d,c]=this.getDimensionContinuousField(),u={};return a.latestData.forEach(p=>{let m=`${p[d]}-${p[c]}`;u[m]||(u[m]={[d]:p[d],[c]:p[c]},h.push(u[m]))}),h};nt(this._option.dataSet,"dimensionItems",o);let a=this.getViewData();n=new St(this._option.dataSet).parse([a],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1),a?.target.addListener("change",n.reRunAllTransform)}this._barBackgroundViewData=new yi(this._option,n)}init(t){var e,i;super.init(t),this.direction==="vertical"?((e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){let t=this.getRegion();return this.getStack()&&t.getSeries().filter(e=>e.type===this.type&&e.getSpec().barMinHeight).length}_calculateStackRectPosition(t){let e=this.getRegion();if(e._bar_series_position_calculated)return;let i,s,n,o,a;e._bar_series_position_calculated=!0,t?(i=lw,s=aw,n="_dataToPosY1",o="_dataToPosY",a="_yAxisHelper"):(i=ow,s=nw,n="_dataToPosX1",o="_dataToPosX",a="_xAxisHelper");let l=vA(e,!1,h=>h.type===this.type);for(let h in l)for(let d in l[h].nodes)yw(l[h].nodes[d],e.getStackInverse(),{isVertical:t,start:i,end:s,startMethod:n,endMethod:o,axisHelper:a})}_calculateRectPosition(t,e,i){var s,n;let o,a,l;e?(o="_dataToPosY1",a="_dataToPosY",l="_yAxisHelper"):(o="_dataToPosX1",a="_dataToPosX",l="_xAxisHelper");let h=(n=(s=this[l]).getScale)===null||n===void 0?void 0:n.call(s,0),d=this[l].isInverse(),c=this._spec.barMinHeight,u=Qt(this[o](t),h,i),p=Qt(this[a](t),h,i),m=Math.abs(u-p);m<c&&(m=c);let g=1;return p<u?g=-1:p===u&&(g=e?d?1:-1:d?-1:1),u+g*m}_dataToPosX(t){return this.dataToPositionX(t)}_dataToPosX1(t){return this.dataToPositionX1(t)}_dataToPosY(t){return this.dataToPositionY(t)}_dataToPosY1(t){return this.dataToPositionY1(t)}initBandRectMarkStyle(){var t,e,i,s;let n=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:a=>this._getBarXStart(a,n),x1:a=>this._getBarXEnd(a,n),y:a=>this._getPosition(this.direction,a),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",X.Series):this.setMarkStyle(this._barMark,{y:a=>this._getBarYStart(a,o),y1:a=>this._getBarYEnd(a,o),x:a=>this._getPosition(this.direction,a),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",X.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var t,e,i,s;if(!this._spec.stackCornerRadius)return;let n=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{let a=[];return this._forEachStackGroup(l=>{let h=1/0,d=-1/0,c=!1,u=1/0,p=-1/0;l.values.forEach(f=>{let _=f[zi],v=f[pi],x=f[os],y=f[Kr];h=Math.min(h,_,v),d=Math.max(d,_,v),A(x)&&A(y)&&(c=!0,u=Math.min(u,x,y),p=Math.max(p,x,y))});let m=Object.assign(Object.assign(Object.assign({},l.values[0]),{[zi]:h,[pi]:d}),c?{[os]:u,[Kr]:p}:void 0),g=this.direction==="horizontal"?{x:this._getBarXStart(m,n),x1:this._getBarXEnd(m,n),y:this._getPosition(this.direction,m),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(m,o),y1:this._getBarYEnd(m,o),x:this._getPosition(this.direction,m),width:this._getBarWidth(this._xAxisHelper)};a.push(cr(Object.assign(Object.assign({},g),{cornerRadius:V(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(g,m,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))}),a}})}initLinearRectMarkStyle(){var t,e,i,s;let n=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0);if(this.direction==="horizontal"){let a=A(this._fieldY2)?{y:l=>Qt(this._dataToPosY(l),o,!0),y1:l=>Qt(this._dataToPosY1(l),o,!0)}:{y:l=>Qt(this._dataToPosY(l)-this._getBarWidth(this._yAxisHelper)/2,o,!0),height:l=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:l=>this._getBarXStart(l,n,!0),x1:l=>this._getBarXEnd(l,n,!0)},a),"normal",X.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(n),x1:()=>this._getBarBackgroundXEnd(n)},a),"normal",X.Series)}else{let a=A(this._fieldX2)?{x:l=>Qt(this._dataToPosX(l),n,!0),x1:l=>Qt(this._dataToPosX1(l),n,!0)}:{x:l=>Qt(this._dataToPosX(l)-this._getBarWidth(this._xAxisHelper)/2,n,!0),width:l=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},a),{y:l=>this._getBarYStart(l,o),y1:l=>this._getBarYEnd(l,o)}),"normal",X.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},a),{y:()=>this._getBarBackgroundYStart(o),y1:()=>this._getBarBackgroundYEnd(o)}),"normal",X.Series)}}_initBandBarBackgroundMarkStyle(){var t,e,i,s,n;if(!this._barBackgroundMark)return;let o=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),a=(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0),l=(n=this._spec.barBackground)!==null&&n!==void 0?n:{},h=T(l.fieldLevel)?void 0:l.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(o),x1:()=>this._getBarBackgroundXEnd(o),y:d=>this._getPosition(this.direction,d,h,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,h),width:()=>{},y1:()=>{}},"normal",X.Series):this.setMarkStyle(this._barBackgroundMark,{x:d=>this._getPosition(this.direction,d,h,"barBackground"),y:()=>this._getBarBackgroundYStart(a),y1:()=>this._getBarBackgroundYEnd(a),width:()=>this._getBarWidth(this._xAxisHelper,h),x1:()=>{},height:()=>{}},"normal",X.Series)}initAnimation(){var t,e;let i={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var o,a;return this.direction==="horizontal"?(o=this._xAxisHelper)===null||o===void 0?void 0:o.getScale(0).scale(0):(a=this._yAxisHelper)===null||a===void 0?void 0:a.getScale(0).scale(0)}},s=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset,n=Er(this);this._barMark.setAnimationConfig(_t((e=I.getAnimationInKey("bar"))===null||e===void 0?void 0:e(i,s),xt(this._barMarkName,this._spec,this._markAttributeContext),n))}_getBarWidth(t,e){var i,s;let n=this._groups?this._groups.fields.length:1,o=T(e)?n:Math.min(n,e),a=(s=(i=t.getBandwidth)===null||i===void 0?void 0:i.call(t,o-1))!==null&&s!==void 0?s:6,l=A(this._spec.barWidth)&&o===n,h=A(this._spec.barMinWidth),d=A(this._spec.barMaxWidth),c=a;return l&&(c=Tl(this._spec.barWidth,a)),h&&(c=Math.max(c,Tl(this._spec.barMinWidth,a))),d&&(c=Math.min(c,Tl(this._spec.barMaxWidth,a))),c}_getPosition(t,e,i,s){var n,o,a,l,h;let d,c,u;t==="horizontal"?(d=this.getYAxisHelper(),c="height",u=s==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(d=this.getXAxisHelper(),c="width",u=s==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));let p=d.getScale(0),m=this._groups?this._groups.fields.length:1,g=T(i)?m:Math.min(m,i),f=(o=(n=d.getBandwidth)===null||n===void 0?void 0:n.call(d,g-1))!==null&&o!==void 0?o:6,_=g===m?this._barMark.getAttribute(c,e):f;if(g>1&&A(this._spec.barGapInGroup)){let x=this._groups.fields,y=O(this._spec.barGapInGroup),b=0,S=0;for(let C=x.length-1;C>=1;C--){let k=x[C],M=(l=(a=d.getScale(C))===null||a===void 0?void 0:a.domain())!==null&&l!==void 0?l:[],E=M.length,D=Tl((h=y[C-1])!==null&&h!==void 0?h:It(y),f),P=M.indexOf(e[k]);C===x.length-1?(b+=E*_+(E-1)*D,S+=P*(_+D)):(S+=P*(b+D),b+=b+(E-1)*D)}return p.scale(e[x[0]])+d.getBandwidth(0)/2-b/2+S}let v=Vt(p.type||"band");return u(e,g)+.5*(f-_)+(v?-f/2:0)}dataToBarBackgroundPositionX(t,e){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,e,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(t,e){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,e,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(t){super.onLayoutEnd(t),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){let{width:t,height:e}=this._region.getLayoutRect(),i=[],s=this._fieldY,n=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?n[0]:s[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var t;super.compileData(),(t=this._barBackgroundViewData)===null||t===void 0||t.compile()}fillData(){var t,e;super.fillData(),(e=(t=this._barBackgroundViewData)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}viewDataUpdate(t){var e,i,s;super.viewDataUpdate(t),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(s=this._barBackgroundViewData)===null||s===void 0||s.updateData()}release(){var t;super.release(),(t=this._barBackgroundViewData)===null||t===void 0||t.release(),this._barBackgroundViewData=null}};wr.type=F.bar,wr.mark=Dp,wr.transformerConstructor=cs;var k1=()=>{xj(),Hn(),oG(),vr(),or(),I.registerSeries(wr.type,wr)};var Aa=class extends ai{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barMinHeight","sampling","samplingFactor","barBackground","stackCornerRadius"])}transformSpec(t){super.transformSpec(t),nr(t)}_transformAxisSpec(t){var e,i;if(super._transformAxisSpec(t),!t.axes)return;let s=t.series.some(o=>o.direction==="horizontal"),n=(e=t.axes.find(o=>o.type==="band"))!==null&&e!==void 0?e:t.axes.find(o=>(s?["left","right"]:["top","bottom"]).includes(o.orient));if(n&&!n.bandSize&&!n.maxBandSize&&!n.minBandSize&&t.autoBandSize){let o=ct(t.autoBandSize)&&(i=t.autoBandSize.extend)!==null&&i!==void 0?i:0,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d}=t.series.find(c=>c.type==="bar");this._applyAxisBandSize(n,o,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d})}}};var Ts=class extends At{constructor(){super(...arguments),this.transformerConstructor=Aa,this.type="bar",this.seriesType=F.bar}};Ts.type="bar",Ts.seriesType=F.bar,Ts.transformerConstructor=Aa,Ct(Ts,Mi);var xw=()=>{k1(),I.registerChart(Ts.type,Ts)};var bw=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,length:3})}};bw.type="rect3d";var Q_=class extends cs{_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar3d")}};var Ep=class extends wr{constructor(){super(...arguments),this.type=F.bar3d,this._barMarkName="bar3d",this._barMarkType="rect3d",this.transformerConstructor=Q_}};Ep.type=F.bar3d,Ep.mark=T1,Ep.transformerConstructor=Q_;var t0=class extends Aa{_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.barWidth=t.barWidth,e.barMaxWidth=t.barMaxWidth,e.barMinWidth=t.barMinWidth,e.barGapInGroup=t.barGapInGroup,e}};var wp=class extends Ts{constructor(){super(...arguments),this.transformerConstructor=t0,this.type="bar3d",this.seriesType=F.bar3d}};wp.type="bar3d",wp.seriesType=F.bar3d,wp.transformerConstructor=t0;var Gl=`${et}_BOX_PLOT_OUTLIER_VALUE`,we;(function(r){r.OUTLIER="outlier",r.MAX="max",r.MIN="min",r.MEDIAN="median",r.Q1="q1",r.Q3="q3",r.SERIES_FIELD="seriesField"})(we||(we={}));var hG=(r,t)=>{let e=[],{outliersField:i,dimensionField:s}=t;return(r[0].latestData||[]).forEach(n=>{let o=n[i];H(o)||(o=[o]),e.push(...o.map(a=>{let l={[Gl]:a};return s.forEach(h=>{l[h]=n[h]}),l}))}),e};var M1=class extends he{constructor(){super(...arguments),this.getContentKey=t=>e=>{if(this.isOutlierMark(e))return t===we.OUTLIER?this.series.getOutliersField():t===we.SERIES_FIELD?this.series.getSeriesField():null;switch(t){case we.MIN:return this.series.getMinField();case we.MAX:return this.series.getMaxField();case we.MEDIAN:return this.series.getMedianField();case we.Q1:return this.series.getQ1Field();case we.Q3:return this.series.getQ3Field();case we.SERIES_FIELD:return this.series.getSeriesField()}return null},this.getContentValue=t=>e=>{if(this.isOutlierMark(e))return t===we.OUTLIER?e[Gl]:t===we.SERIES_FIELD?e[this.series.getSeriesField()]:null;switch(t){case we.MIN:return e[this.series.getMinField()];case we.MAX:return e[this.series.getMaxField()];case we.MEDIAN:return e[this.series.getMedianField()];case we.Q1:return e[this.series.getQ1Field()];case we.Q3:return e[this.series.getQ3Field()];case we.SERIES_FIELD:return e[this.series.getSeriesField()]}return null},this.shapeColorCallback=t=>this.series.getShaftShape()==="line"?this.series.getMarkInName("boxPlot").getAttribute("stroke",t):this.series.getMarkInName("boxPlot").getAttribute("fill",t),this.getOutlierFillColor=t=>{var e;let i=this.series.getOutliersStyle();return(e=i?.fill)!==null&&e!==void 0?e:this.series.getMarkInName("outlier").getAttribute("fill",t)},this.isOutlierMark=t=>A(t[Gl])}getDefaultContentList(t){return[{key:this.getContentKey(we.OUTLIER),value:this.getContentValue(we.OUTLIER),shapeType:this.shapeTypeCallback,shapeColor:this.getOutlierFillColor,shapeStroke:this.getOutlierFillColor},{key:this.getContentKey(we.MAX),value:this.getContentValue(we.MAX)},{key:this.getContentKey(we.Q3),value:this.getContentValue(we.Q3)},{key:this.getContentKey(we.MEDIAN),value:this.getContentValue(we.MEDIAN)},{key:this.getContentKey(we.Q1),value:this.getContentValue(we.Q1)},{key:this.getContentKey(we.MIN),value:this.getContentValue(we.MIN)},{key:this.getContentKey(we.SERIES_FIELD),value:this.getContentValue(we.SERIES_FIELD)}]}};var Sw=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:2,boxWidth:30,shaftWidth:20,shaftShape:"line"})}_initProduct(t){let e=this.getStyle("shaftShape"),i=this.getVGrammarView(),s=this.getProductId(),n=e==="bar"?"barBoxplot":"boxplot",o=this.getStyle("direction");this._product=i.glyph(n,t??i.rootMark).id(s).configureGlyph({direction:o}),this._compiledProductId=s}};Sw.type="boxPlot";var dG=Object.assign(Object.assign({},Ft),{boxPlot:{name:"boxPlot",type:"boxPlot"},outlier:{name:"outlier",type:"symbol"}});var i0=class r extends ei{constructor(){super(...arguments),this.type=F.boxPlot}getMinField(){return this._minField}getMaxField(){return this._maxField}getQ1Field(){return this._q1Field}getMedianField(){return this._medianField}getQ3Field(){return this._q3Field}getOutliersField(){return this._outliersField}getShaftShape(){return this._shaftShape}getBoxFillColor(){return this._boxFillColor}getStrokeColor(){return this._strokeColor}getOutliersStyle(){return this._outliersStyle}setAttrFromSpec(){var t,e,i,s,n;super.setAttrFromSpec();let o=(e=(t=this._spec.boxPlot)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this._minField=this._spec.minField,this._maxField=this._spec.maxField,this._q1Field=this._spec.q1Field,this._medianField=this._spec.medianField,this._q3Field=this._spec.q3Field,this._outliersField=this._spec.outliersField,this._lineWidth=(i=o.lineWidth)!==null&&i!==void 0?i:2,this._boxWidth=o.boxWidth,this._shaftShape=(s=o.shaftShape)!==null&&s!==void 0?s:"line",this._shaftWidth=o.shaftWidth,this._boxFillColor=o.boxFill,this._strokeColor=o.stroke,this._shaftFillOpacity=this._shaftShape==="bar"?(n=o.shaftFillOpacity)!==null&&n!==void 0?n:.5:void 0,this._outliersStyle=this._spec.outliersStyle}initMark(){let t={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._boxPlotMark=this._createMark(r.mark.boxPlot,{groupKey:this._seriesField,isSeriesMark:!0},t),this._outlierMark=this._createMark(r.mark.outlier,{key:$e,groupKey:this._seriesField,dataView:this._outlierDataView.getDataView(),dataProductId:this._outlierDataView.getProductId()},t)}initMarkStyle(){var t,e,i,s,n;let o=this._boxPlotMark;if(o){let l={direction:this._direction,lineWidth:this._lineWidth,shaftShape:this._shaftShape,fill:(t=this._boxFillColor)!==null&&t!==void 0?t:this._shaftShape==="line"?"#FFF":this.getColorAttribute(),minMaxFillOpacity:this._shaftFillOpacity,stroke:(e=this._strokeColor)!==null&&e!==void 0?e:this._shaftShape==="line"?this.getColorAttribute():"#000"},h=this._direction==="horizontal"?Object.assign(Object.assign({y:this.dataToPositionY.bind(this)},l),{boxHeight:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},ruleHeight:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()},q1q3Height:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},minMaxHeight:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()}}):Object.assign(Object.assign({x:this.dataToPositionX.bind(this)},l),{boxWidth:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},ruleWidth:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()},q1q3Width:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},minMaxWidth:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()}});this.setMarkStyle(o,h,it.STATE_NORMAL,X.Series)}let a=this._outlierMark;a&&this.setMarkStyle(a,{fill:(s=(i=this._outliersStyle)===null||i===void 0?void 0:i.fill)!==null&&s!==void 0?s:this.getColorAttribute(),size:J((n=this._outliersStyle)===null||n===void 0?void 0:n.size)?this._outliersStyle.size:10,symbolType:"circle"},it.STATE_NORMAL,X.Series)}initBoxPlotMarkStyle(){var t,e;let i=this._boxPlotMark,s=this._direction==="horizontal"?this._xAxisHelper:this._yAxisHelper;if(i&&s){let{dataToPosition:o}=s,a=(t=s?.getScale)===null||t===void 0?void 0:t.call(s,0);this.setMarkStyle(i,{min:l=>Qt(o(this.getDatumPositionValues(l,this._minField),{bandPosition:this._bandPosition}),a),q1:l=>Qt(o(this.getDatumPositionValues(l,this._q1Field),{bandPosition:this._bandPosition}),a),median:l=>Qt(o(this.getDatumPositionValues(l,this._medianField),{bandPosition:this._bandPosition}),a),q3:l=>Qt(o(this.getDatumPositionValues(l,this._q3Field),{bandPosition:this._bandPosition}),a),max:l=>Qt(o(this.getDatumPositionValues(l,this._maxField),{bandPosition:this._bandPosition}),a)},it.STATE_NORMAL,X.Series)}let n=this._outlierMark;if(n&&s){let{dataToPosition:o}=s,a=(e=s?.getScale)===null||e===void 0?void 0:e.call(s,0),l=this._direction==="horizontal"?{y:this.dataToPositionY.bind(this),x:h=>Qt(o(this.getDatumPositionValues(h,Gl),{bandPosition:this._bandPosition}),a)}:{x:this.dataToPositionX.bind(this),y:h=>Qt(o(this.getDatumPositionValues(h,Gl),{bandPosition:this._bandPosition}),a)};this.setMarkStyle(n,l,it.STATE_NORMAL,X.Series)}}initData(){if(super.initData(),!this._data)return;nt(this._dataSet,"foldOutlierData",hG),nt(this._dataSet,"addVChartProperty",en);let t=new St(this._dataSet,{name:`${this.type}_outlier_${this.id}_data`});t.parse([this.getViewData()],{type:"dataview"}),t.name=`${et}_series_${this.id}_outlierData`,t.transform({type:"foldOutlierData",options:{dimensionField:this._direction==="horizontal"?this._fieldY:this._fieldX,outliersField:this._outliersField}}),t.transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1),this._outlierDataView=new yi(this._option,t)}compileData(){var t;super.compileData(),(t=this._outlierDataView)===null||t===void 0||t.compile()}init(t){super.init(t),this.initBoxPlotMarkStyle()}_getMarkWidth(){if(this._autoBoxWidth)return this._autoBoxWidth;let t=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,e=this._direction==="horizontal"?this._fieldY:this._fieldX,i=t.getBandwidth(e.length-1)/e.length;return this._autoBoxWidth=i,this._autoBoxWidth}onLayoutEnd(t){super.onLayoutEnd(t),this._autoBoxWidth=null}_initAnimationSpec(t={}){let e=G({},t);return["appear","enter","update","exit","disappear"].forEach(i=>{e[i]&&e[i].type==="scaleIn"?e[i].type=this._shaftShape==="line"?"boxplotScaleIn":"barBoxplotScaleIn":e[i]&&e[i].type==="scaleOut"&&(e[i].type=this._shaftShape==="line"?"boxplotScaleOut":"barBoxplotScaleOut")}),e}initAnimation(){var t,e,i,s,n,o,a;let l=Er(this);if(this._boxPlotMark){let h=this._initAnimationSpec((t=I.getAnimationInKey("scaleInOut"))===null||t===void 0?void 0:t()),d=this._initAnimationSpec(xt("boxPlot",this._spec,this._markAttributeContext));this._boxPlotMark.setAnimationConfig(_t(h,d,l))}if(this._outlierMark){let h={appear:(e=this._spec.animationAppear)===null||e===void 0?void 0:e.symbol,disappear:(i=this._spec.animationDisappear)===null||i===void 0?void 0:i.symbol,enter:(s=this._spec.animationEnter)===null||s===void 0?void 0:s.symbol,exit:(n=this._spec.animationExit)===null||n===void 0?void 0:n.symbol,update:(o=this._spec.animationUpdate)===null||o===void 0?void 0:o.symbol};this._outlierMark.setAnimationConfig(_t((a=I.getAnimationInKey("scaleInOut"))===null||a===void 0?void 0:a(),h,l))}}initTooltip(){this._tooltipHelper=new M1(this),this._boxPlotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._boxPlotMark),this._outlierMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._outlierMark)}getStatisticFields(){let t=super.getStatisticFields(),e=t.find(i=>i.key===this._outliersField);return e&&(e.operations=["array-min","array-max"]),t}onEvaluateEnd(t){super.onEvaluateEnd(t),this._outlierDataView.updateData()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._boxPlotMark]}};i0.type=F.boxPlot,i0.mark=dG;var r0=class extends ai{_getDefaultSeriesSpec(t){var e;let i=[t.maxField,t.medianField,t.q1Field,t.q3Field,t.minField,t.outliersField],s=super._getDefaultSeriesSpec(t,["boxPlot","minField","maxField","q1Field","medianField","q3Field","outliersField","outliersStyle"]);return s.direction=(e=t.direction)!==null&&e!==void 0?e:"vertical",s[s.direction==="horizontal"?"xField":"yField"]=i,s}transformSpec(t){super.transformSpec(t),t.axes||(t.axes=[{orient:"bottom"},{orient:"left"}]),nr(t)}};var Pp=class extends At{constructor(){super(...arguments),this.transformerConstructor=r0,this.type="boxPlot",this.seriesType=F.boxPlot}};Pp.type="boxPlot",Pp.seriesType=F.boxPlot,Pp.transformerConstructor=r0;var Aw=(r,t=[],e)=>{let i=e?.maxDepth>=0;return r.forEach(s=>{(!i||s.depth<=e.maxDepth)&&(t.push(e?.callback?e.callback(s):s),s.children&&(i&&s.depth===e.maxDepth?(s.children=null,s.isLeaf=!0):Aw(s.children,t,e)))}),t};function cG(r,t,e,i,s,n={x0:"x0",x1:"x1",y0:"y0",y1:"y1"}){let o=r.children,a,l=-1,h=o.length,d=r.value&&(i-t)/r.value;for(;++l<h;)a=o[l],a[n.y0]=e,a[n.y1]=s,a[n.x0]=t,a[n.x1]=t+=a.value*d}var s0=(r,t,e=0,i=-1,s,n,o="value")=>{let a=0,l=i??-1,h=e;return r.forEach((d,c)=>{var u,p;let m={flattenIndex:++l,key:n?n(d):`${(u=s?.key)!==null&&u!==void 0?u:""}-${c}`,maxDepth:-1,depth:e,index:c,value:d[o],isLeaf:!0,datum:s?s.datum.concat(d):[d],parentKey:s?.key};if(!((p=d.children)===null||p===void 0)&&p.length){m.children=[],m.isLeaf=!1;let g=s0(d.children,m.children,e+1,l,m,n,o);m.value=T(d[o])?g.sum:Math.max(g.sum,Wn(d[o])),l=g.flattenIndex,h=Math.max(g.maxDepth,h)}else m.isLeaf=!0,m.value=Wn(d[o]);a+=Math.abs(m.value),t.push(m)}),{sum:a,maxDepth:h,flattenIndex:l}},Id=(r,t,e,i)=>{let s=i;return r.forEach((n,o)=>{var a;s=t(n,o,e,s),!((a=n.children)===null||a===void 0)&&a.length&&(s=Id(n.children,t,n,s))}),i},n0=(r,t,e,i)=>{let s=i;return r.forEach((n,o)=>{var a;!((a=n.children)===null||a===void 0)&&a.length&&(s=n0(n.children,t,n,s)),s=t(n,o,e,s)}),s};var oq={x0:"startAngle",x1:"endAngle",y0:"innerRadius",y1:"outerRadius"},Rp=class r{constructor(t){this._layoutNode=s=>{if(s.maxDepth=this._maxDepth,s.children){let n=this._parsedInnerRadius[s.depth+1],o=this._parsedOutterRadius[s.depth+1];cG(s,s.startAngle,Math.min(n,o),s.endAngle,Math.max(n,o),oq);let a=H(this.options.label)?this.options.label[s.depth+1]:this.options.label;s.children.forEach(l=>{if(l.x=this._parsedCenter[0],l.y=this._parsedCenter[1],a)return this._layoutLabel(l,te(a)?{align:"center",rotate:"radial"}:a)})}},this.options=t?Object.assign({},r.defaultOpionts,t):Object.assign({},r.defaultOpionts);let e=this.options.nodeKey,i=V(e)?e:e?Ur(e):null;this._getNodeKey=i,this._maxDepth=-1}_parseRadius(t,e){let i=t.x0+es(this.options.center[0],t.width),s=t.y0+es(this.options.center[1],t.height),n=Math.min(t.width/2,t.height/2),o=this.options.innerRadius,a=this.options.outerRadius,l=H(o),h=l?o.map(m=>es(m,n)):es(o,n),d=H(a),c=this.options.gapRadius,u=d?a.map(m=>es(m,n)):es(a,n),p=Gm(0,e+1);if(l)this._parsedInnerRadius=p.map((m,g)=>{let f=h[g];return T(f)?n:f}),this._parsedOutterRadius=p.map((m,g)=>{var f,_;return d?(f=u[g])!==null&&f!==void 0?f:n:g<e?this._parsedInnerRadius[g+1]-(H(c)?(_=c[g])!==null&&_!==void 0?_:0:c):u});else if(d)this._parsedOutterRadius=p.map((m,g)=>T(u[g])?n:u[g]),this._parsedInnerRadius=p.map((m,g)=>{var f;return g===0?h:this._parsedOutterRadius[g-1]-(H(c)?(f=c[g])!==null&&f!==void 0?f:0:c)});else{let m=es(o,n),g=(u-m)/(e+1);this._parsedInnerRadius=p.map((f,_)=>m+_*g),this._parsedOutterRadius=p.map((f,_)=>{var v;return this._parsedInnerRadius[_]+g-(H(c)?(v=c[_])!==null&&v!==void 0?v:0:c)})}this._parsedCenter=[i,s],this._maxRadius=n}layout(t,e){let i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];let s=[],n=s0(t,s,0,-1,null,this._getNodeKey);return this._parseRadius(i,n.maxDepth),this._maxDepth=n.maxDepth,this._layout(s,{flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:n.sum,datum:null,children:s,startAngle:this.options.startAngle,endAngle:this.options.endAngle}),s}_layout(t,e){this._layoutNode(e),t.forEach(i=>{var s;!((s=i?.children)===null||s===void 0)&&s.length?this._layout(i.children,i):this._layoutNode(i)})}_layoutLabel(t,e){var i;let s=(t.startAngle+t.endAngle)/2,n=(e.align==="start"?t.innerRadius:e.align==="end"?t.outerRadius:(t.innerRadius+t.outerRadius)/2)+((i=e.offset)!==null&&i!==void 0?i:0),o=oe({x:this._parsedCenter[0],y:this._parsedCenter[1]},n,s);if(t.label={x:o.x,y:o.y,textBaseline:"middle"},e.rotate==="tangential")t.label.angle=s-Math.PI/2,t.label.textAlign="center",t.label.maxLineWidth=Math.abs(t.endAngle-t.startAngle)*n;else{let a=s%(2*Math.PI),l=a<0?a+2*Math.PI:a;l>Math.PI/2&&l<1.5*Math.PI?(t.label.angle=l+Math.PI,t.label.textAlign=e.align==="start"?"end":e.align==="end"?"start":"center"):(t.label.angle=l,t.label.textAlign=e.align),t.label.maxLineWidth=t.isLeaf?void 0:Math.abs(t.outerRadius-t.innerRadius)}}};Rp.defaultOpionts={startAngle:Math.PI/2,endAngle:-3*Math.PI/2,center:["50%","50%"],gapRadius:0,innerRadius:0,outerRadius:"70%"};function uG(r=1){let t=r;return()=>(t=(1664525*t+1013904223)%4294967296)/4294967296}function pG(r,t){let e=0,i=_P(Array.from(r),t),s=i.length,n,o,a=[];for(;e<s;)n=i[e],o&&mG(o,n)?++e:(a=aq(a,n),o=lq(a),e=0);return o}function aq(r,t){let e,i;if(Cw(t,r))return[t];for(e=0;e<r.length;++e)if(D1(t,r[e])&&Cw(o0(r[e],t),r))return[r[e],t];for(e=0;e<r.length-1;++e)for(i=e+1;i<r.length;++i)if(D1(o0(r[e],r[i]),t)&&D1(o0(r[e],t),r[i])&&D1(o0(r[i],t),r[e])&&Cw(gG(r[e],r[i],t),r))return[r[e],r[i],t];Nt.getInstance().error("error when packEncloseRandom")}function D1(r,t){let e=r.radius-t.radius,i=t.x-r.x,s=t.y-r.y;return e<0||e*e<i*i+s*s}function mG(r,t){let e=r.radius-t.radius+1e-9*Math.max(r.radius,t.radius,1),i=t.x-r.x,s=t.y-r.y;return e>0&&e*e>i*i+s*s}function Cw(r,t){for(let e=0;e<t.length;++e)if(!mG(r,t[e]))return!1;return!0}function lq(r){switch(r.length){case 1:return hq(r[0]);case 2:return o0(r[0],r[1]);case 3:return gG(r[0],r[1],r[2])}}function hq(r){return{x:r.x,y:r.y,radius:r.radius}}function o0(r,t){let e=r.x,i=r.y,s=r.radius,n=t.x,o=t.y,a=t.radius,l=n-e,h=o-i,d=a-s,c=Math.sqrt(l*l+h*h);return{x:(e+n+l/c*d)/2,y:(i+o+h/c*d)/2,radius:(c+s+a)/2}}function gG(r,t,e){let i=r.x,s=r.y,n=r.radius,o=t.x,a=t.y,l=t.radius,h=e.x,d=e.y,c=e.radius,u=i-o,p=i-h,m=s-a,g=s-d,f=l-n,_=c-n,v=i*i+s*s-n*n,x=v-o*o-a*a+l*l,y=v-h*h-d*d+c*c,b=p*m-u*g,S=(m*y-g*x)/(2*b)-i,C=(g*f-m*_)/b,k=(p*x-u*y)/(2*b)-s,M=(u*_-p*f)/b,E=C*C+M*M-1,D=2*(n+S*C+k*M),P=S*S+k*k-n*n,B=-(Math.abs(E)>1e-6?(D+Math.sqrt(D*D-4*E*P))/(2*E):P/D);return{x:i+S+C*B,y:s+k+M*B,radius:B}}function fG(r,t,e){let i=r.x-t.x,s,n,o=r.y-t.y,a,l,h=i*i+o*o;h?(n=t.radius+e.radius,n*=n,l=r.radius+e.radius,l*=l,n>l?(s=(h+l-n)/(2*h),a=Math.sqrt(Math.max(0,l/h-s*s)),e.x=r.x-s*i-a*o,e.y=r.y-s*o+a*i):(s=(h+n-l)/(2*h),a=Math.sqrt(Math.max(0,n/h-s*s)),e.x=t.x+s*i-a*o,e.y=t.y+s*o+a*i)):(e.x=t.x+e.radius,e.y=t.y)}function _G(r,t){let e=r.radius+t.radius-1e-6,i=t.x-r.x,s=t.y-r.y;return e>0&&e*e>i*i+s*s}function vG(r){let t=r._,e=r.next._,i=t.radius+e.radius,s=(t.x*e.radius+e.x*t.radius)/i,n=(t.y*e.radius+e.y*t.radius)/i;return s*s+n*n}function E1(r){return{_:r,next:null,prev:null}}function yG(r,t){let e=(r=O(r)).length;if(!e)return 0;let i=r[0];if(i.x=0,i.y=0,e===1)return i.radius;let s=r[1];if(i.x=-s.radius,s.x=i.radius,s.y=0,e===2)return i.radius+s.radius;let n=r[2];fG(s,i,n);let o,a,l,h,d,c,u,p=E1(i),m=E1(s),g=E1(n);p.next=m,g.prev=m,m.next=g,p.prev=g,g.next=p,m.prev=p;for(let _=3;_<e;++_){u=!1,n=r[_],fG(p._,m._,n),g=E1(n),o=m.next,a=p.prev,l=m._.radius,h=p._.radius;do if(l<=h){if(_G(o._,g._)){m=o,p.next=m,m.prev=p,--_,u=!0;break}l+=o._.radius,o=o.next}else{if(_G(a._,g._)){p=a,p.next=m,m.prev=p,--_,u=!0;break}h+=a._.radius,a=a.prev}while(o!==a.next);if(!u){for(g.prev=p,g.next=m,p.next=m.prev=m=g,d=vG(p),g=g.next;g!==m;)c=vG(g),c<d&&(p=g,d=c),g=g.next;m=p.next}}let f=[m._];for(g=m.next;g!==m;)f.push(g._),g=g.next;n=pG(f,t);for(let _=0;_<e;++_)i=r[_],i.x-=n.x,i.y-=n.y;return n.radius}function xG(r){return function(t){t.children||(t.radius=Math.max(0,+r(t)||0))}}function Tw(r,t,e){return function(i){let s=i?.children;if(s){let n,o=s.length,a=r(i)*t||0;if(a)for(n=0;n<o;++n)s[n].radius+=a;let l=yG(s,e);if(a)for(n=0;n<o;++n)s[n].radius-=a;i.radius=l+a}}}function bG(r,t){return function(e,i,s){e.radius*=r,e.maxDepth=t,s&&(e.x=s.x+r*e.x,e.y=s.y+r*e.y)}}var Bp=class r{constructor(t){this.options=t;let e=t?.nodeKey,i=V(e)?e:e?Ur(e):null;this._getNodeKey=i,this._getPadding=J(t?.padding)?s=>t.padding:H(t?.padding)?s=>{var n;return(n=t.padding[s.depth+1])!==null&&n!==void 0?n:0}:()=>0,this._maxDepth=-1}layout(t,e){var i;let s="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];let n=[],o=s0(t,n,0,-1,null,this._getNodeKey);this._maxDepth=o.maxDepth;let a=uG(),l={flattenIndex:-1,maxDepth:-1,key:"root",depth:-1,index:-1,value:o.sum,datum:null,children:n,x:s.x0+s.width/2,y:s.y0+s.height/2},{nodeSort:h,setRadius:d,padding:c,includeRoot:u}=(i=this.options)!==null&&i!==void 0?i:{};if(h!==!1){let p=V(h)?this.options.nodeKey:r.defaultOpionts.nodeSort;Id([l],m=>{m.children&&m.children.length&&m.children.sort(p)})}if(d)Id([l],xG(d)),n0([l],Tw(this._getPadding,.5,a)),Id([l],bG(1,this._maxDepth));else{let p=Math.min(s.width,s.height);Id([l],xG(r.defaultOpionts.setRadius)),n0([l],Tw($M,1,a)),c&&n0([l],Tw(this._getPadding,l.radius/p,a)),Id([l],bG(p/(2*l.radius),this._maxDepth))}return u?[l]:n}};Bp.defaultOpionts={setRadius:r=>Math.sqrt(r.value),padding:0,nodeSort:(r,t)=>t.value-r.value};var SG=(r,t)=>{if(!r)return r;let e=t(),{width:i,height:s}=e;return i===0||s===0?r:new Bp(e).layout(r,{width:i,height:s})};var Ro=(r,t={})=>{if(!r)return[];let e=[];return Aw(r,e,t),e};var w1=class extends he{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>t?.[this.series.getDimensionField()[0]]}};var Ca;(function(r){r.DrillDown="drillDown",r.DrillUp="drillUp"})(Ca||(Ca={}));var AG=(r,t)=>{let e=t.info(),i=t.keyField(),s=e?.key;if(T(s))return r;if(e.type===Ca.DrillDown){let n=PE(r,s,i,"children");return O(n)}if(e.type===Ca.DrillUp){let n=RE(r,s,i,"children");if(n)return O(n)}return r};var P1=class{parserScrollEvent(t){return t&&!(t.ctrlKey||t.deltaY===0&&t.deltaX===0)&&(t.scrollX=t.deltaX,t.scrollY=t.deltaY,t)}parserZoomEvent(t){if(!t)return t;let e=Math.pow(1.0005,-t.deltaY*Math.pow(16,t.deltaMode));return t.zoomDelta=e,t.zoomX=t.canvasX,t.zoomY=t.canvasY,t}clearZoom(){}clearScroll(){}clearDrag(){}parserDragEvent(){return!0}};var R1=class{constructor(){this._lastScale=0}clearZoom(){this._lastScale=0,this.pointerId=null}parserDragEvent(t){return!0}parserZoomEvent(t){let e=t.scale;if(this._lastScale===0)return this._lastScale=e,t;t.zoomDelta=e/this._lastScale;let i=t.center;return t.zoomX=i.x,t.zoomY=i.y,this._lastScale=e,t}parserScrollEvent(t){return t}clearScroll(){}clearDrag(){}};function Nn(r){return r===ze["desktop-browser"]||r===ze["desktop-miniApp"]?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside"],zoom:"wheel",zoomEnd:"pointerup",scroll:"wheel",trigger:P1}:zr(r)||Gr(r)?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside"],zoom:"pinch",zoomEnd:"pinchend",scroll:"pan",scrollEnd:"panend",trigger:R1}:null}var Ul=class{_getDrillTriggerEvent(t){var e;let{mode:i}=this._drillParams;return(e=Nn(i))===null||e===void 0?void 0:e[t]}_hideTooltip(){let t=this.getChart().getComponentsByType(W.tooltip)[0];t&&t.hideTooltip()}initDrillable(t){this._drillParams=t}initDrillableData(t){let{getRawData:e}=this._drillParams;nt(t,"drillFilter",AG),e().transform({type:"drillFilter",options:{info:()=>this._drillInfo,keyField:()=>this._drillParams.drillField()}})}bindDrillEvent(){let{event:t,getRawData:e,drillField:i}=this._drillParams,s=i();this._getDrillTriggerEvent("start")&&t.on(this._getDrillTriggerEvent("start"),n=>{var o,a,l;if(T(n.datum)||T((o=n.datum)===null||o===void 0?void 0:o[s]))return void this.drillUp();this._hideTooltip();let h=n.datum[s],d=(l=(a=this._drillInfo)===null||a===void 0?void 0:a.path)!==null&&l!==void 0?l:[],c=fV(e().rawData,h,s,"children");d[d.length-1]===c[c.length-1]?this.drillUp():this.drillDown(c)})}drillDown(t=[]){let{getRawData:e,event:i}=this._drillParams;if(!H(t)||st(t))return t;let s=t[t.length-1];return this._drillInfo={key:s,path:t,type:Ca.DrillDown},e().reRunAllTransform(),i.emit(rt.drill,{value:{path:t,type:Ca.DrillDown},model:this}),t}drillUp(){var t,e;let{getRawData:i,event:s}=this._drillParams,n=(e=(t=this._drillInfo)===null||t===void 0?void 0:t.path)!==null&&e!==void 0?e:[];if(!H(n)||st(n))return n;let o=n.pop();return this._drillInfo={key:o,path:n,type:Ca.DrillUp},i().reRunAllTransform(),s.emit(rt.drill,{value:{path:n,type:Ca.DrillUp},model:this}),n}};var a0=class extends Te{constructor(t,e){super(t,e),this.type=Lp.type,this._unCompileChannel={centerOffset:!0,radiusOffset:!0},this.computeOuterRadius=(i,s,n="normal",o,a)=>{var l;return a+((l=this.getAttribute("radiusOffset",s,n,o))!==null&&l!==void 0?l:0)},this.computeCenter=(i,s,n="normal",o,a)=>oe({x:0,y:0},this.getAttribute("centerOffset",s,n,o),s[Mn])[i]+a,this._computeExChannel.x=this.computeCenter,this._computeExChannel.y=this.computeCenter,this._computeExChannel.outerRadius=this.computeOuterRadius,this._extensionChannel.centerOffset=["x","y"],this._extensionChannel.radiusOffset=["outerRadius"]}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{startAngle:0,endAngle:0,outerRadius:0,innerRadius:0,cornerRadius:0,lineWidth:0,innerPadding:0,outerPadding:0})}},Lp=class r extends a0{constructor(){super(...arguments),this.type=r.type}};Lp.type="arc";var Wl=()=>{mj(),tw(),I.registerMark(Lp.type,Lp)};var l0=class r extends Te{getTextType(){return this._textType}constructor(t,e){super(t,e),this.type=r.type,this._textType="text"}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{angle:0,textAlign:"center",lineWidth:0,textConfig:[]})}initStyleWithSpec(t,e){super.initStyleWithSpec(t,e),t.textType&&(this._textType=t.textType)}compileEncode(){super.compileEncode(),this._textType==="rich"&&this._product.encodeState("group",{textType:this._textType})}};l0.type="text";var CG=Object.assign(Object.assign({},Ft),{circlePacking:{name:"circlePacking",type:"arc"}});var Ip=(r,t,e)=>(r.push({key:t,operations:["values"]}),r.push({key:e,operations:["max","min"]}),r.push({key:W_,operations:["max","min","values"]}),r.push({key:rn,operations:["values"]}),r);var Fp=class r extends ei{constructor(){super(...arguments),this.type=F.circlePacking}setCategoryField(t){return this._categoryField=t,this._categoryField}getCategoryField(){return this._categoryField}setValueField(t){return this._valueField=t,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:rn),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e;return(e=this._spec.drillField)!==null&&e!==void 0?e:ki},getRawData:()=>this.getRawData()}),this._circlePacking=this._spec.circlePacking,this._label=this._spec.label,this._layoutPadding=this._spec.layoutPadding}initData(){super.initData();let t=this.getRawData();T(t)||(this._spec.drill&&this.initDrillableData(this._dataSet),nt(this._dataSet,"circlePackingLayout",SG),nt(this._dataSet,"flatten",Ro),t.transform({type:"circlePackingLayout",options:()=>({nodeKey:this._categoryField,padding:this._layoutPadding,includeRoot:!1,width:this.getLayoutRect().width||1,height:this.getLayoutRect().height||1})}),t.transform({type:"flatten",options:{callback:e=>{if(e.datum){let i=e.datum[e.depth];return Object.assign(Object.assign({},e),i)}return e}}}))}_addDataIndexAndKey(){let t=this.getRawData();T(t?.dataSet)||(nt(t.dataSet,"addVChartProperty",en),t.transform({type:"addVChartProperty",options:{beforeCall:xp.bind(this),call:Pd}}))}initMark(){this._initCirclePackingMark(),this._initLabelMark()}initMarkStyle(){this._initCirclePackingMarkStyle(),this._initLabelMarkStyle()}_initCirclePackingMark(){var t,e;if(((t=this._circlePacking)===null||t===void 0?void 0:t.visible)===!1)return;let i=this._createMark(r.mark.circlePacking,{isSeriesMark:!0},{setCustomizedShape:(e=this._spec.circlePacking)===null||e===void 0?void 0:e.customShape});this._circlePackingMark=i}_initCirclePackingMarkStyle(){T(this._circlePackingMark)||this.setMarkStyle(this._circlePackingMark,{x:t=>t.x,y:t=>t.y,outerRadius:t=>t.radius,innerRadius:0,startAngle:0,endAngle:2*Math.PI,fill:this.getColorAttribute(),zIndex:t=>t.depth},it.STATE_NORMAL,X.Series)}_initLabelMark(){var t;if(((t=this._label)===null||t===void 0?void 0:t.visible)===!1)return;let e=this._createMark(r.mark.label,{isSeriesMark:!1});this._labelMark=e}_initLabelMarkStyle(){T(this._labelMark)||this.setMarkStyle(this._labelMark,{x:t=>t.x,y:t=>t.y,text:t=>t.key,cursor:"pointer"},it.STATE_NORMAL,X.Series)}getStatisticFields(){return Ip(super.getStatisticFields(),this._categoryField,this._valueField)}initTooltip(){this._tooltipHelper=new w1(this),this._circlePackingMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._circlePackingMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var t;let e=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;this.getMarksInType("arc").forEach(i=>{var s;i.setAnimationConfig(_t((s=I.getAnimationInKey("circlePacking"))===null||s===void 0?void 0:s(void 0,e),xt(i.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(i=>{var s;i.setAnimationConfig(_t((s=I.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),xt(i.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(t){super.onLayoutEnd(t),this._rawData.reRunAllTransform()}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._circlePackingMark]}getMarkData(t){return t?.datum?t.datum[t.datum.length-1]:t}};Fp.type=F.circlePacking,Fp.mark=CG,Ct(Fp,Ul);var h0=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","layoutPadding","circlePacking","drill","drillField"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var Op=class extends At{constructor(){super(...arguments),this.transformerConstructor=h0,this.type="circlePacking",this.seriesType=F.circlePacking}};Op.type="circlePacking",Op.seriesType=F.circlePacking,Op.transformerConstructor=h0;var d0=class extends Ie{_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return delete e.data,e}_transformAxisSpec(t){t.axes&&t.autoBandSize&&t.series.forEach((e,i)=>{var s;if(e.type==="bar"){let n=this._findBandAxisBySeries(e,i,t.axes);if(n&&!n.bandSize&&!n.maxBandSize&&!n.minBandSize){let o=ct(e.autoBandSize)&&(s=e.autoBandSize.extend)!==null&&s!==void 0?s:0,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d}=e;this._applyAxisBandSize(n,o,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d})}}})}transformSpec(t){if(super.transformSpec(t),t.series&&t.series.length){let e=this._getDefaultSeriesSpec(t);t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(s=>{s in i||(i[s]=e[s])})})}t.axes&&t.axes.length&&t.axes.forEach(e=>{ft(e,"trimPadding")&&ot(e,qA(this.type,t))}),this._transformAxisSpec(t)}};var Hp=class extends At{constructor(){super(...arguments),this.transformerConstructor=d0,this.type="common"}};Hp.type="common",Hp.transformerConstructor=d0,Ct(Hp,Mi);var TG=(r,t)=>{var e,i;let s=r.map(b=>Object.assign({},b));if(!s||s.length===0)return s;let{valueField:n,asTransformRatio:o,asReachRatio:a,asHeightRatio:l,asValueRatio:h,asNextValueRatio:d,asLastValueRatio:c,asLastValue:u,asCurrentValue:p,asNextValue:m,heightVisual:g=!1,isCone:f=!0,range:_}=t,v=s.reduce((b,S)=>Math.max(b,Number.parseFloat(S[n])||-1/0),-1/0),x=s.reduce((b,S)=>Math.min(b,Number.parseFloat(S[n])||1/0),1/0),y=[(e=_?.min)!==null&&e!==void 0?e:x,(i=_?.max)!==null&&i!==void 0?i:v];return s.forEach((b,S)=>{var C,k;let M=Number.parseFloat(b[n]),E=Number.parseFloat((C=s[S-1])===null||C===void 0?void 0:C[n]),D=Number.parseFloat((k=s[S+1])===null||k===void 0?void 0:k[n]),P=K(D*M)&&M!==0?D/M:0,B=K(M*E)&&E!==0?M/E:0;u&&(b[u]=E),m&&(b[m]=D),o&&(b[o]=P),a&&(b[a]=S===0?1:B),l&&(b[l]=g===!0?P:1/s.length),h&&(b[h]=M/y[1]),d&&(b[d]=S===s.length-1?f?0:b[h]:D/y[1]),c&&(b[c]=S===0?1:E/y[1]),p&&(b[p]=M)}),s},kG=(r,t)=>{var e,i;let s=(i=(e=r[0])===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.map(n=>Object.assign({},n));return s&&s.length!==0&&(s.shift(),s.forEach(n=>{n[t.asIsTransformLevel]=!0})),s};var MG=`${et}_FUNNEL_TRANSFORM_RATIO`,c0=`${et}_FUNNEL_REACH_RATIO`,DG=`${et}_FUNNEL_HEIGHT_RATIO`,u0=`${et}_FUNNEL_VALUE_RATIO`,kw=`${et}_FUNNEL_LAST_VALUE_RATIO`,Mw=`${et}_FUNNEL_NEXT_VALUE_RATIO`,EG=`${et}_FUNNEL_LAST_VALUE`,wG=`${et}_FUNNEL_CURRENT_VALUE`,PG=`${et}_FUNNEL_NEXT_VALUE`,Dw=`${et}_FUNNEL_TRANSFORM_LEVEL`,RG=20,Yl=5,BG="80%",LG=0;var B1=class extends he{constructor(t){var e,i;super(t),this.dimensionTooltipTitleCallback=(s,n)=>{var o,a,l;let h=this.series;return((o=n?.mark)===null||o===void 0?void 0:o.name)==="transform"?this._transformRatioText:(a=this._getDimensionData(s))!==null&&a!==void 0?a:(l=s.properties)===null||l===void 0?void 0:l[`${h.getCategoryField()}`]},this.markTooltipValueCallback=(s,n)=>{var o;return((o=n?.mark)===null||o===void 0?void 0:o.name)==="transform"?`${(100*s?.[c0]).toFixed(1)}%`:this._getMeasureData(s)},this.markTooltipKeyCallback=(s,n)=>{var o;if(((o=n?.mark)===null||o===void 0?void 0:o.name)==="transform")return this._transformRatioText;let{dimensionFields:a,seriesFields:l}=this._seriesCacheInfo,h=a[a.length-1];return A(l[0])?s?.[l[0]]:s?.[h]},this._transformRatioText=(i=(e=t.getSpec())===null||e===void 0?void 0:e.transformRatioText)!==null&&i!==void 0?i:"\u8F6C\u5316\u7387"}};var Np=class extends Te{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{points:[]})}};var Ew=class r extends Np{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}};Ew.type="polygon";var ww=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x1:0,y1:0})}};ww.type="rule";var IG=Object.assign(Object.assign({},Ft),{funnel:{name:"funnel",type:"polygon"},transform:{name:"transform",type:"polygon"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}}),FG=Object.assign(Object.assign({},Ft),{funnel3d:{name:"funnel3d",type:"pyramid3d"},transform3d:{name:"transform3d",type:"pyramid3d"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}});var Fd=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"funnel"),t.isTransform&&this._addMarkLabelSpec(t,"transform","transformLabel")}};var Xl=class r extends qi{constructor(){super(...arguments),this.type=F.funnel,this._funnelMarkName="funnel",this._funnelMarkType="polygon",this._transformMarkName="transform",this._transformMarkType="polygon",this.transformerConstructor=Fd,this._funnelMark=null,this._funnelTransformMark=null,this._labelMark=null,this._transformLabelMark=null,this._funnelOuterLabelMark={}}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t,e,i,s,n;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this._funnelOrient=(t=this._spec.funnelOrient)!==null&&t!==void 0?t:"top",this._shape=(e=this._spec.shape)!==null&&e!==void 0?e:"trapezoid",this._minLabelLineWidth=(n=(s=(i=this._spec.outerLabel)===null||i===void 0?void 0:i.line)===null||s===void 0?void 0:s.minLength)!==null&&n!==void 0?n:RG,this._isHorizontal()?this._funnelAlign=["top","bottom"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center":this._funnelAlign=["left","right"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center",!this._seriesField&&this._spec.categoryField&&this.setSeriesField(this._spec.categoryField)}initData(){if(super.initData(),!this._data)return;nt(this._dataSet,"funnel",TG),nt(this._dataSet,"funnelTransform",kG);let t=new St(this._dataSet,{name:`${et}_series_${this.id}_viewDataTransform`});t.parse([this.getViewData()],{type:"dataview"}),this._viewDataTransform=new yi(this._option,t)}compileData(){var t;super.compileData(),(t=this._viewDataTransform)===null||t===void 0||t.compile()}getStatisticFields(){let t=[];return t.push({key:this._categoryField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}_statisticViewData(){var t,e,i,s,n,o,a,l,h;super._statisticViewData(),this._data.getDataView().transform({type:"funnel",options:{valueField:this.getValueField(),isCone:this._spec.isCone,asCurrentValue:wG,asTransformRatio:MG,asReachRatio:c0,asHeightRatio:DG,asValueRatio:u0,asNextValueRatio:Mw,asLastValueRatio:kw,asLastValue:EG,asNextValue:PG,range:{min:(e=(t=this._spec.range)===null||t===void 0?void 0:t.min)!==null&&e!==void 0?e:(s=(i=this.getViewDataStatistics().latestData)===null||i===void 0?void 0:i[this.getValueField()])===null||s===void 0?void 0:s.min,max:(o=(n=this._spec.range)===null||n===void 0?void 0:n.max)!==null&&o!==void 0?o:(l=(a=this.getViewDataStatistics().latestData)===null||a===void 0?void 0:a[this.getValueField()])===null||l===void 0?void 0:l.max}}}),(h=this._viewDataTransform.getDataView())===null||h===void 0||h.transform({type:"funnelTransform",options:{asIsTransformLevel:Dw}})}initMark(){var t,e,i,s,n,o,a,l,h,d,c,u;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},r.mark.funnel),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(t=this._theme)===null||t===void 0?void 0:t.funnel,groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.funnel)===null||e===void 0?void 0:e.stateSort,noSeparateStyle:!0},{setCustomizedShape:(i=this._spec.funnel)===null||i===void 0?void 0:i.customShape,morph:vi(this._spec,this._funnelMarkName),morphElementKey:this._seriesField}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},r.mark.transform),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(s=this._theme)===null||s===void 0?void 0:s.transform,skipBeforeLayouted:!0,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId(),stateSort:(n=this._spec.transform)===null||n===void 0?void 0:n.stateSort,noSeparateStyle:!0},{setCustomizedShape:(o=this._spec.transform)===null||o===void 0?void 0:o.customShape})),(l=(a=this._spec)===null||a===void 0?void 0:a.outerLabel)===null||l===void 0?void 0:l.visible){let{line:p}=(h=this._spec.outerLabel)!==null&&h!==void 0?h:{},{line:m}=(c=(d=this._theme)===null||d===void 0?void 0:d.outerLabel)!==null&&c!==void 0?c:{};this._funnelOuterLabelMark.label=this._createMark(r.mark.outerLabel,{themeSpec:(u=this._theme)===null||u===void 0?void 0:u.outerLabel,markSpec:this._spec.outerLabel,skipBeforeLayouted:!0,noSeparateStyle:!0}),this._funnelOuterLabelMark.line=this._createMark(r.mark.outerLabelLine,{themeSpec:m,markSpec:p,depend:[this._funnelOuterLabelMark.label],noSeparateStyle:!0})}}initTooltip(){this._tooltipHelper=new B1(this),this._funnelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelMark),this._funnelTransformMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelTransformMark)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return[this._valueField]}getGroupFields(){return null}initMarkStyle(){let t=this._funnelMark;t&&this.setMarkStyle(t,{points:n=>this.getPoints(n),visible:n=>A(n[this._valueField]),fill:this.getColorAttribute()},"normal",X.Series);let e=this._funnelTransformMark;e&&this.setMarkStyle(e,{points:n=>this.getPoints(n)},"normal",X.Series);let i=this._funnelOuterLabelMark.label;i&&(this.setMarkStyle(i,{text:n=>`${n[this.getCategoryField()]}`,x:n=>this._computeOuterLabelPosition(n).x,y:n=>this._computeOuterLabelPosition(n).y,textAlign:n=>this._computeOuterLabelPosition(n).align,textBaseline:n=>this._computeOuterLabelPosition(n).textBaseline,maxLineWidth:n=>this._computeOuterLabelLimit(n),width:0,height:0},"normal",X.Series),V(this._spec.outerLabel.formatMethod)&&this.setMarkStyle(i,{text:n=>this._spec.outerLabel.formatMethod(`${n[this.getCategoryField()]}`,n)},"normal",X.User_Mark));let s=this._funnelOuterLabelMark.line;s&&i&&this.setMarkStyle(s,{x:n=>this._computeOuterLabelLinePosition(n).x1,y:n=>this._computeOuterLabelLinePosition(n).y1,x1:n=>this._computeOuterLabelLinePosition(n).x2,y1:n=>this._computeOuterLabelLinePosition(n).y2},"normal",X.Series)}initLabelMarkStyle(t){var e,i;if(!t)return;let s=t.getTarget(),n=t.getComponent();s===this._funnelMark?(this._labelMark=t,this.setMarkStyle(t,{text:o=>`${o[this.getCategoryField()]} ${o[this.getValueField()]}`,x:o=>this._computeLabelPosition(o).x,y:o=>this._computeLabelPosition(o).y,maxLineWidth:o=>this._computeLabelLimit(o,this._spec.label),stroke:this.getColorAttribute()},"normal",X.Series),!((e=this._funnelOuterLabelMark)===null||e===void 0)&&e.label&&this._funnelOuterLabelMark.label.setDepend(n),!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())):this._funnelTransformMark&&s===this._funnelTransformMark&&(this._transformLabelMark=t,this.setMarkStyle(t,{text:o=>`${(100*zu(c0).bind(this)(o)).toFixed(1)}%`,x:o=>this._computeLabelPosition(o).x,y:o=>this._computeLabelPosition(o).y,maxLineWidth:o=>this._computeLabelLimit(o,this._spec.transformLabel)},"normal",X.Series))}initAnimation(){var t,e,i,s,n,o,a;let l=(i=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset)!==null&&i!==void 0?i:"clipIn";l==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(_t((s=I.getAnimationInKey("cartesianGroupClip"))===null||s===void 0?void 0:s({direction:()=>this._isHorizontal()?"x":"y",width:()=>{let h=this.getRootMark().getProduct();if(h){let{x1:d,x2:c}=h.getBounds();return Math.max(d,c)}return this.getLayoutRect().width},height:()=>{let h=this.getRootMark().getProduct();if(h){let{y1:d,y2:c}=h.getBounds();return Math.max(d,c)}return this.getLayoutRect().height},orient:()=>this._isReverse()?"negative":"positive"},l),xt("group",this._spec,this._markAttributeContext))),[(n=this._funnelOuterLabelMark)===null||n===void 0?void 0:n.label].forEach(h=>{h&&h.setAnimationConfig(_t(I.getAnimationInKey("fadeInOut")(),xt(h.name,this._spec,this._markAttributeContext)))}),[this._funnelMark,this._funnelTransformMark].forEach(h=>{h&&h.setAnimationConfig(_t(I.getAnimationInKey("funnel")({},l),xt(h.name,this._spec,this._markAttributeContext)))}),!((o=this._funnelOuterLabelMark)===null||o===void 0)&&o.line&&this._funnelOuterLabelMark.line.setAnimationConfig(_t((a=I.getAnimationInKey("fadeInOut"))===null||a===void 0?void 0:a(),xt("outerLabelLine",this._spec,this._markAttributeContext)))}initGroups(){}getStackGroupFields(){return[]}getStackValueField(){return null}initEvent(){var t;super.initEvent(),(t=this._viewDataTransform.getDataView())===null||t===void 0||t.target.addListener("change",e=>{this._viewDataTransform.updateData()})}getPoints(t){let e=this.isTransformLevel(t),i=this._getMainAxisLength(e)/2,s,n;e?(s=this._shape==="rect"?this._getSecondaryAxisLength(t[kw])/2:this._getSecondaryAxisLength(t[u0])/2,n=this._getSecondaryAxisLength(t[u0])/2):(s=this._getSecondaryAxisLength(t[u0])/2,n=this._shape==="rect"?s:this._getSecondaryAxisLength(t[Mw])/2);let{x:o,y:a}=this._getPositionByData(t),l=this._getPolygonPoints([o,a],s,n,s,n,i);return this._funnelAlign!=="center"&&this._adjustPoints(l),l}isTransformLevel(t){return!!t?.[Dw]}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getPoints=this.getPoints.bind(this),this._markAttributeContext.isTransformLevel=this.isTransformLevel.bind(this)}valueToPosition(t){var e,i,s;let n=(s=(i=(e=this.getViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.find)===null||s===void 0?void 0:s.call(i,o=>o[this._categoryField]===t);return A(n)?this._getPolygonCenter(this.getPoints(n)):null}dataToPosition(t,e){return e&&!this.isDatumInViewData(t)?null:this.valueToPosition(t[this._categoryField])}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}_getMainAxisLength(t=!1){var e;let i=this.getViewData().latestData.length,s=this._isHorizontal()?this.getLayoutRect().width:this.getLayoutRect().height,n=!!this._spec.isTransform,o=n?0:(e=this._spec.gap)!==null&&e!==void 0?e:0,a=n?Math.max(0,i-1):0,l=this._spec.heightRatio||.5,h=(s-o*Math.max(0,i-1))/(i+l*a);return t?n?h*l:0:h}_getSecondaryAxisLength(t){let e=Number.isNaN(t)||!Number.isFinite(t)?0:t,i=this._computeMaxSize(),s=this._computeMinSize();return s+(i-s)*e}_getPositionByData(t){var e;let i=(e=this.getViewData().latestData)===null||e===void 0?void 0:e.findIndex(u=>u[this._categoryField]===t[this._categoryField]&&u[ki]===t[ki]);if(!A(i)||i<0)return{};let s=this.isTransformLevel(t),n=this._isHorizontal(),o=n?this.getLayoutRect().height:this.getLayoutRect().width,a=n?this.getLayoutRect().width:this.getLayoutRect().height,l=o/2,h=0,d=this._getMainAxisLength(),c=this._getMainAxisLength(!0);return h+=i*(d+c),h+=s?-c/2:d/2,!this._spec.isTransform&&this._spec.gap&&(h+=this._spec.gap*i),this._isReverse()&&(h=a-h),this._isHorizontal()?{x:h,y:l}:{x:l,y:h}}_getPolygonPoints(t,e,i,s,n,o){let a=t[0],l=t[1];switch(this._funnelOrient){case"left":return[{x:a-o,y:l+e},{x:a-o,y:l-s},{x:a+o,y:l-n},{x:a+o,y:l+i}];case"right":return[{x:a+o,y:l-s},{x:a+o,y:l+s},{x:a-o,y:l+i},{x:a-o,y:l-i}];case"bottom":return[{x:a+e,y:l+o},{x:a-s,y:l+o},{x:a-n,y:l-o},{x:a+i,y:l-o}];default:return[{x:a-e,y:l-o},{x:a+s,y:l-o},{x:a+n,y:l+o},{x:a-i,y:l+o}]}}_getPolygonCenter(t){if(this._isHorizontal()){let s=(t[0].x+t[3].x)/2,n=(t[0].y+t[3].y)/2;return{x:(s+(t[1].x+t[2].x)/2)/2,y:(n+(t[1].y+t[2].y)/2)/2}}let e=(t[0].x+t[3].x)/2,i=(t[0].y+t[3].y)/2;return{x:(e+(t[1].x+t[2].x)/2)/2,y:(i+(t[1].y+t[2].y)/2)/2}}_adjustPoints(t){let e,i,s;return this._isHorizontal()?(s="y",this._funnelOrient==="left"?(e=this._funnelAlign==="bottom"?-t[1].y:t[1].y,i=this._funnelAlign==="bottom"?-t[2].y:t[2].y):(e=this._funnelAlign==="bottom"?-t[0].y:t[0].y,i=this._funnelAlign==="bottom"?-t[3].y:t[3].y)):(s="x",this._funnelOrient==="top"?(e=this._funnelAlign==="left"?t[0].x:-t[0].x,i=this._funnelAlign==="left"?t[3].x:-t[3].x):(e=this._funnelAlign==="left"?t[1].x:-t[1].x,i=this._funnelAlign==="left"?t[2].x:-t[2].x)),t[0][s]-=e,t[1][s]-=e,t[2][s]-=i,t[3][s]-=i,t}_computeLabelPosition(t){let e=this.getPoints(t);return this._getPolygonCenter(e)}_computeLabelLimit(t,e){let i=e?.limit;if(J(i))return i;let s=this.getPoints(t);return i==="shapeSize"?this._isHorizontal()?Math.abs(s[3].x-s[0].x):(Math.abs(s[0].x-s[1].x)+Math.abs(s[2].x-s[3].x))/2:this._isHorizontal()?Math.abs(s[3].x-s[0].x):void 0}_computeOuterLabelPosition(t){var e,i;let s,n,o=(e=this._spec.outerLabel)===null||e===void 0?void 0:e.position,a="center",l="middle";if(o=this._isHorizontal()?["top","bottom"].includes(o)?o:this._funnelAlign==="bottom"?"top":"bottom":["left","right"].includes(o)?o:this._funnelAlign==="left"?"right":"left",((i=this._spec.outerLabel)===null||i===void 0?void 0:i.alignLabel)!==!1)({x:s,y:n}=this._getPositionByData(t)),o==="left"?(s=0,a="left"):o==="right"?(s=this.getLayoutRect().width,a="right"):o==="top"?(n=0,l="top"):o==="bottom"&&(n=this.getLayoutRect().height,l="bottom");else{let{x2:h,y2:d}=this._computeOuterLabelLinePosition(t);s=h,n=d,o==="left"?(s-=Yl,a="right"):o==="right"?(s+=Yl,a="left"):o==="top"?(n-=Yl,l="bottom"):o==="bottom"&&(n+=Yl,l="top")}return{x:s,y:n,align:a,textBaseline:l}}_computeOuterLabelLimit(t){var e,i,s,n,o,a,l;if(this._isHorizontal())return this._getMainAxisLength(this.isTransformLevel(t));let h=this.getPoints(t),d=(Math.abs(h[0].x-h[1].x)+Math.abs(h[2].x-h[3].x))/2,c=this.getCategoryField(),u=(o=(n=(s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct())===null||s===void 0?void 0:s.getGroupGraphicItem())===null||n===void 0?void 0:n.find(({attribute:f,type:_})=>{var v;return _==="text"&&((v=f.data)===null||v===void 0?void 0:v[c])===t[c]},!0))===null||o===void 0?void 0:o.AABBBounds,p=u?u.x2-u.x1:0,m=this._funnelOuterLabelMark.line?this._minLabelLineWidth:0,g=this.getLayoutRect().width-Math.max(d,p);return this._funnelAlign==="center"&&(g/=2),g-m-((l=(a=this._spec.outerLabel)===null||a===void 0?void 0:a.spaceWidth)!==null&&l!==void 0?l:Yl)}_computeOuterLabelLinePosition(t){var e,i,s,n,o,a,l,h,d,c,u,p,m;let g=this.getCategoryField(),f=(o=(n=(s=(i=(e=this._funnelOuterLabelMark)===null||e===void 0?void 0:e.label)===null||i===void 0?void 0:i.getProduct())===null||s===void 0?void 0:s.elements)===null||n===void 0?void 0:n.find(D=>{var P;return((P=D.data[0])===null||P===void 0?void 0:P[g])===t[g]}))===null||o===void 0?void 0:o.getBounds(),_=(c=(d=(h=(l=(a=this._labelMark)===null||a===void 0?void 0:a.getComponent())===null||l===void 0?void 0:l.getProduct())===null||h===void 0?void 0:h.getGroupGraphicItem())===null||d===void 0?void 0:d.find(({attribute:D,type:P})=>{var B;return P==="text"&&((B=D.data)===null||B===void 0?void 0:B[g])===t[g]},!0))===null||c===void 0?void 0:c.AABBBounds,v=(u=this._spec.outerLabel)!==null&&u!==void 0?u:{},x,y,b,S;if(this._isHorizontal()){let D=(p=v.spaceWidth)!==null&&p!==void 0?p:Yl,P=this.getPoints(t),B=(Math.abs(P[0].y-P[1].y)+Math.abs(P[2].y-P[3].y))/2;return this._spec.outerLabel.position==="top"||this._funnelAlign==="bottom"?(b=this._getPolygonCenter(P).y-B/2-D,S=v.alignLabel!==!1?f?.y2+D:b-D,x=this._getPolygonCenter(P).x,b-S<this._minLabelLineWidth&&(S=b-this._minLabelLineWidth),y=x):(b=this._getPolygonCenter(P).y+B/2+D,S=v.alignLabel!==!1?f?.y1-D:b+D,x=this._getPolygonCenter(P).x,S-b<this._minLabelLineWidth&&(S=b+this._minLabelLineWidth),y=x),{x1:x,x2:y,y1:b,y2:S}}let C=this.getPoints(t),k=(Math.abs(C[0].x-C[1].x)+Math.abs(C[2].x-C[3].x))/2,M=_?.x2-_?.x1||0,E=(m=v.spaceWidth)!==null&&m!==void 0?m:Yl;return this._spec.outerLabel.position==="right"||this._funnelAlign==="left"?(x=this._getPolygonCenter(C).x+Math.max(M/2,k/2)+E,y=v.alignLabel!==!1?f?.x1-E:x+E,b=this._getPolygonCenter(C).y,y-x<this._minLabelLineWidth&&(y=x+this._minLabelLineWidth),S=b):(x=this._getPolygonCenter(C).x-Math.max(M/2,k/2)-E,y=v.alignLabel!==!1?f?.x2+E:x-E,b=this._getPolygonCenter(C).y,x-y<this._minLabelLineWidth&&(y=x-this._minLabelLineWidth),S=b),{x1:x,x2:y,y1:b,y2:S}}_computeMaxSize(){var t;let e=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,i=(t=this._spec.maxSize)!==null&&t!==void 0?t:BG;return We(i,e)}_computeMinSize(){var t;let e=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,i=(t=this._spec.minSize)!==null&&t!==void 0?t:LG;return We(i,e)}_isHorizontal(){return this._funnelOrient==="left"||this._funnelOrient==="right"}_isReverse(){return this._funnelOrient==="bottom"||this._funnelOrient==="right"}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._funnelMark]}};Xl.type=F.funnel,Xl.mark=IG,Xl.transformerConstructor=Fd;var Kl=class extends Ie{needAxes(){return!1}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","funnelAlign","funnelOrient","heightRatio","shape","funnel","transform","outerLabel","transformLabel","isTransform","maxSize","minSize","gap","isCone","range","transformRatioText"])}transformSpec(t){super.transformSpec(t),super.transformSeriesSpec(t)}};var Vp=class extends At{constructor(){super(...arguments),this.transformerConstructor=Kl,this.type="funnel",this.seriesType=F.funnel}};Vp.type="funnel",Vp.seriesType=F.funnel,Vp.transformerConstructor=Kl;var Pw=class r extends Np{constructor(){super(...arguments),this.type=r.type}};Pw.type="pyramid3d";var p0=class extends Fd{_transformLabelSpec(t){this._addMarkLabelSpec(t,"funnel3d"),t.isTransform&&this._addMarkLabelSpec(t,"transform3d","transformLabel")}};var jp=class r extends Xl{constructor(){super(...arguments),this.type=F.funnel3d,this._funnelMarkName="funnel3d",this._funnelMarkType="pyramid3d",this._transformMarkName="transform3d",this._transformMarkType="pyramid3d",this.transformerConstructor=p0}initMark(){var t,e,i,s,n,o,a,l;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},r.mark.funnel3d),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(t=this._theme)===null||t===void 0?void 0:t.funnel3d,key:this._seriesField,isSeriesMark:!0},{support3d:!0}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},r.mark.transform3d),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(e=this._theme)===null||e===void 0?void 0:e.transform3d,key:this._seriesField,skipBeforeLayouted:!1,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId()})),(s=(i=this._spec)===null||i===void 0?void 0:i.outerLabel)===null||s===void 0?void 0:s.visible){let{line:h}=(n=this._spec.outerLabel)!==null&&n!==void 0?n:{},{line:d}=(a=(o=this._theme)===null||o===void 0?void 0:o.outerLabel)!==null&&a!==void 0?a:{};this._funnelOuterLabelMark.label=this._createMark(r.mark.outerLabel,{themeSpec:(l=this._theme)===null||l===void 0?void 0:l.outerLabel,key:this._seriesField,markSpec:this._spec.outerLabel}),this._funnelOuterLabelMark.line=this._createMark(r.mark.outerLabelLine,{themeSpec:d,key:this._seriesField,markSpec:h,depend:[this._funnelOuterLabelMark.label]})}}initMarkStyle(){super.initMarkStyle();let t=this._funnelMark;t&&this.setMarkStyle(t,{z:e=>{if(this._isHorizontal())return 0;let i=this.getPoints(e),s=Math.max(Math.abs(i[0].x-i[1].x),Math.abs(i[2].x-i[3].x));return(this._computeMaxSize()-s)/2}},"normal",X.Series)}initLabelMarkStyle(t){var e,i;super.initLabelMarkStyle(t),this.setMarkStyle(t,{z:s=>{if(this._isHorizontal())return 0;let n=this.getPoints(s),o=Math.max(Math.abs(n[0].x-n[1].x),Math.abs(n[2].x-n[3].x));return(this._computeMaxSize()-o)/2}},"normal",X.Series),this._labelMark=t,!((e=this._funnelOuterLabelMark)===null||e===void 0)&&e.label&&this._funnelOuterLabelMark.label.setDepend(t.getComponent()),!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())}};jp.type=F.funnel3d,jp.mark=FG,jp.transformerConstructor=p0;var zp=class extends At{constructor(){super(...arguments),this.transformerConstructor=Kl,this.type="funnel3d",this.seriesType=F.funnel3d}};zp.type="funnel3d",zp.seriesType=F.funnel3d,zp.transformerConstructor=Kl;var ks=class extends qi{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=yd,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(t){return this._angleField=A(t)?O(t):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(t){return this._radiusField=A(t)?O(t):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(t){return this._innerRadiusField=O(t),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(t){return this._radiusScale=t,t}get angleScale(){return this._angleScale}setAngleScale(t){return this._angleScale=t,t}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(t){this._angleAxisHelper=t,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(t){this._radiusAxisHelper=t,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(t,e){if(T(t)||T(e)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};let i=this.radiusAxisHelper.dataToPosition(O(e));if(i<0){if(this._invalidType==="break"||this._invalidType==="link")return{x:Number.NaN,y:Number.NaN};if(this._invalidType==="zero")return this.angleAxisHelper.center()}let s=this.angleAxisHelper.dataToPosition(O(t));return this.angleAxisHelper.coordToPoint({angle:s,radius:i})}dataToPosition(t,e){return t&&this.angleAxisHelper&&this.radiusAxisHelper?e&&!this.isDatumInViewData(t)?null:this.valueToPosition(this.getDatumPositionValues(t,this._angleField),this.getDatumPositionValues(t,this._radiusField)):null}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}positionToData(t){}radiusToData(t){}angleToData(t){}getStatisticFields(){var t,e;let i=[];return!((t=this.radiusAxisHelper)===null||t===void 0)&&t.getScale&&this._radiusField.forEach(s=>{let n={key:s,operations:[]};Vt(this.radiusAxisHelper.getScale(0).type)?n.operations=["max","min"]:n.operations=["values"],i.push(n)}),!((e=this.angleAxisHelper)===null||e===void 0)&&e.getScale&&this._angleField.forEach(s=>{let n={key:s,operations:[]};Vt(this.angleAxisHelper.getScale(0).type)?n.operations=["max","min"]:n.operations=["values"],i.push(n)}),i}setAttrFromSpec(){super.setAttrFromSpec(),A(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),A(this._spec.radius)&&(this._outerRadius=this._spec.radius),A(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),A(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){let t=this._angleAxisHelper||this._radiusAxisHelper;if(t)return t.layoutRadius();let{width:e,height:i}=this._region.getLayoutRect();return Math.min(e/2,i/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(rt.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._angleAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&g1(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){let t=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(e=>{t.push(e)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(e=>{t.push(e)}),t}};var Gp=Object.assign(Object.assign({},Ft),{group:{name:"group",type:"group"}});var Lo=class r extends ks{constructor(){super(...arguments),this._arcGroupMark=null,this._getAngleValueStart=t=>{let e=this._getAngleAxis(),{tickMask:i}=this._spec;if(i?.forceAlign&&this._isTickMaskVisible(e)){let s=t[this.getStack()?zi:tp],n=this._getAngleAxisSubTickData(e),o=n[1].value-n[0].value,a=Ut(i.offsetAngle),l;if(A(s)){let h=Hv(n,c=>c.value-s),d=h>=n.length||s>n[h].value-o/2?Math.min(h,n.length-1):h>0?h-1:void 0;d!==void 0&&(l=this.angleAxisHelper.dataToPosition([n[d].value-o/2]))}return T(l)&&(l=this.angleAxisHelper.dataToPosition([n[0].value-o/2])),l+a}return this._getAngleValueStartWithoutMask(t)},this._getAngleValueEnd=t=>{let e=this._getAngleAxis(),{tickMask:i}=this._spec;if(i?.forceAlign&&this._isTickMaskVisible(e)){let s=t[this.getStack()?pi:this._angleField[0]],n=this._getAngleAxisSubTickData(e),o=n[1].value-n[0].value,a=Ut(i.offsetAngle),l=Hv(n,c=>c.value-s),h=l>=n.length||s>n[l].value-o/2?Math.min(l,n.length-1):l>0?l-1:void 0,d;return d=h!==void 0?this.angleAxisHelper.dataToPosition([n[h].value+o/2]):this.angleAxisHelper.dataToPosition([n[0].value-o/2]),d+a}return this._getAngleValueEndWithoutMask(t)}}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec();let s=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getSpec(),n=(e=this._spec.startAngle)!==null&&e!==void 0?e:s?.startAngle;this._startAngle=A(n)?Ut(n):kl;let o=(i=this._spec.endAngle)!==null&&i!==void 0?i:s?.endAngle;this._endAngle=A(o)?Ut(o):Uu,this.setAngleField(this._spec.valueField||this._spec.angleField),this.setRadiusField(this._spec.categoryField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice()}getStackGroupFields(){return this._radiusField}getStackValueField(){var t;return(t=this._angleField)===null||t===void 0?void 0:t[0]}getGroupFields(){return this._angleField}_convertMarkStyle(t){let e=super._convertMarkStyle(t);if(e.fill){let i=t.fill;i?.gradient!=="conical"||A(i?.startAngle)||A(i?.endAngle)||(e.fill=Object.assign(Object.assign({},i),{startAngle:this._startAngle,endAngle:this._endAngle}))}return e}_getAngleValueStartWithoutMask(t){if(this.getStack()){let e=Qt(this.angleAxisHelper.dataToPosition([t[zi]]),this.angleAxisHelper.getScale(0));if(K(e))return e}return this._startAngle}_getAngleValueEndWithoutMask(t){if(this.getStack()){let e=Qt(this.angleAxisHelper.dataToPosition([t[pi]]),this.angleAxisHelper.getScale(0));if(K(e))return e}return this.angleAxisHelper.dataToPosition([t[this._angleField[0]]])}getDimensionField(){return this._specRadiusField}getMeasureField(){return this._specAngleField}initMark(){this._initArcGroupMark()}initMarkStyle(){this._initArcGroupMarkStyle()}_initArcGroupMark(){return this._arcGroupMark=this._createMark(r.mark.group,{skipBeforeLayouted:!1}),this._arcGroupMark}_initArcGroupMarkStyle(){let t=this._arcGroupMark;t.created(),this.setMarkStyle(t,{x:0,y:0},"normal",X.Series),this._arcGroupMark.setMarkConfig({interactive:!1,zIndex:this.layoutZIndex,clip:!0,clipPath:()=>{let e=this._getAngleAxis();if(this._isTickMaskVisible(e)){let{tickMask:n}=this._spec,{angle:o,offsetAngle:a,style:l={}}=n,h=this._getAngleAxisSubTickData(e),{x:d,y:c}=this.angleAxisHelper.center(),u=this._computeLayoutRadius(),p=l;return h.map(({value:m})=>{let g=this.angleAxisHelper.dataToPosition([m])+Ut(a),f=Ut(o)/2;return ll(Object.assign(Object.assign({},p),{x:d,y:c,startAngle:g-f,endAngle:g+f,innerRadius:u*this._innerRadius,outerRadius:u*this._outerRadius,fill:!0}))})}let{width:i,height:s}=this.getLayoutRect();return[cr({width:i,height:s,fill:!0})]}})}_getAngleAxis(){if(!this.angleAxisHelper)return;let t=this.angleAxisHelper.getAxisId();return this._option.getChart().getAllComponents().find(e=>e.id===t)}_getAngleAxisTickData(t){var e;return(e=t?.getTickData())===null||e===void 0?void 0:e.getLatestData()}_isTickMaskVisible(t){let e=this._getAngleAxisTickData(t),{tickMask:i}=this._spec;return i&&i.visible!==!1&&e?.length>1}_getAngleAxisSubTickData(t){var e;let i=this._getAngleAxisTickData(t),s=[],{subTick:n={},tick:o={}}=(e=t?.getSpec())!==null&&e!==void 0?e:{},{tickCount:a=4}=n,{alignWithLabel:l}=o;if(i?.length>=2){let h=i[1].value-i[0].value;for(let d=0;d<i.length-1;d++){let c=i[d],u=i[d+1];s.push(c);for(let p=0;p<a;p++){let m=(p+1)/(a+1),g=(1-m)*c.value+m*(u?u.value:l?1:c.value+h);s.push({value:g})}}return s.push(i[i.length-1]),s}return i}};Lo.mark=Gp;var mq=r=>({type:"growAngleIn",options:{overall:r.startAngle}}),gq={type:"fadeIn"};function fq(r,t){return t==="fadeIn"?gq:mq(r)}var Rw=()=>{I.registerAnimation("circularProgress",(r,t)=>({appear:fq(r,t),enter:{type:"growAngleIn"},disappear:{type:"growAngleOut"}}))};var m0=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0,path:""})}};m0.type="path";var I1=()=>{I.registerMark(m0.type,m0),fj()};var HG=Object.assign(Object.assign({},Gp),{segment:{name:"segment",type:"arc"},track:{name:"track",type:"arc"}}),NG=Object.assign(Object.assign({},Ft),{pin:{name:"pin",type:"path"},pinBackground:{name:"pinBackground",type:"path"},pointer:{name:"pointer",type:["path","rect"]}});var _q=r=>({channel:{angle:{from:r.startAngle+Math.PI/2}}}),vq={type:"fadeIn"};function yq(r,t){return t==="fadeIn"?vq:_q(r)}var VG=()=>{I.registerAnimation("gaugePointer",(r,t)=>{let e=yq(r,t);return{appear:e,enter:e,disappear:{type:"fadeOut"}}})};var g0=class extends ye{constructor(){super(...arguments),this._supportStack=!1}};var jG=(r,t)=>{var e,i,s,n,o,a;let l=(e=r.type)!==null&&e!==void 0?e:r.orient==="angle"?"band":"linear",h=`${W.polarAxis}-${l}`,d=(i=r.startAngle)!==null&&i!==void 0?i:t.startAngle,c=(s=r.endAngle)!==null&&s!==void 0?s:t.endAngle;return{axisType:l,componentName:h,startAngle:d??Wu,endAngle:c??(A(d)?d+360:oA),center:A(t.center)?t.center:A(t?.centerX)||A(t?.centerY)?{x:t?.centerX,y:t?.centerY}:void 0,outerRadius:(a=(o=(n=r.outerRadius)!==null&&n!==void 0?n:r.radius)!==null&&o!==void 0?o:t.outerRadius)!==null&&a!==void 0?a:t.radius,layoutRadius:t.layoutRadius}},F1=(r,t,e,i)=>{let s=r();if(J(s))return s;if(V(s))return s(t(),e());let n=t();if(s==="auto"&&n.width>0&&n.height>0){let{startAngle:o=0,endAngle:a=2*Math.PI}=i();return MP(n,e(),o,a)}return Math.min(n.width/2,n.height/2)};var zG=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Ta=class extends Rd{get center(){return this._center}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}getOrient(){return this._orient}getDefaultInteractive(){return this._orient!=="angle"}getGroupScales(){return this._groupScales}static getSpecInfo(t){if(!t[this.specKey])return null;let e=H(t[this.specKey]),i=e?t[this.specKey]:[t[this.specKey]],s=[],n,o,a=[],l=[];return i.forEach((h,d)=>{if(!Wz(h))return;let{axisType:c,componentName:u,startAngle:p,endAngle:m,center:g,outerRadius:f,layoutRadius:_}=jG(h,t);h.center=g,h.startAngle=p,h.endAngle=m,h.outerRadius=f,h.type=c,h.layoutRadius=_;let v={spec:h,specPath:e?[this.specKey,d]:[this.specKey],specInfoPath:["component",this.specKey,d],type:u};s.push(v),h.orient==="radius"?(a.push(v),o=d):(l.push(v),n=d)}),a.forEach(h=>{h.angleAxisIndex=n}),l.forEach(h=>{h.radiusAxisIndex=o}),s}static createComponent(t,e){let{spec:i}=t,s=zG(t,["spec"]),n=I.getComponentInKey(s.type);return n?new n(i,Object.assign(Object.assign({},e),s)):(e.onError(`Component ${s.type} not found`),null)}constructor(t,e){super(t,e),this.type=W.polarAxis,this.name=W.polarAxis,this._defaultBandPosition=0,this._defaultBandInnerPadding=0,this._defaultBandOuterPadding=0,this.layoutType="absolute",this.layoutZIndex=Tt.Axis,this._tick=void 0,this._center=null,this._startAngle=kl,this._endAngle=Uu,this._orient="radius",this._groupScales=[],this.effect={scaleUpdate:i=>{this.computeData(i?.value),be(this._regions,s=>{this.getOrient()==="radius"?qr(s.radiusAxisHelper,this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(s.radiusAxisHelper=this.axisHelper()):qr(s.angleAxisHelper,this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(s.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{var s;let n=(s=this.getRegions())===null||s===void 0?void 0:s[0];return n?n.getLayoutStartPoint():i},this.getCenter=()=>{var i,s;let n=this.getRefLayoutRect(),{width:o,height:a}=n;return{x:We((i=this._center)===null||i===void 0?void 0:i.x,o,n,o/2),y:We((s=this._center)===null||s===void 0?void 0:s.y,a,n,a/2)}},this.getRefLayoutRect=()=>this.getRegions()[0].getLayoutRect(),this._coordinateType="polar"}setAttrFromSpec(){super.setAttrFromSpec(),this.visible&&(this._axisStyle=this._getAxisAttributes(),this._gridStyle=this._getGridAttributes()),this._tick=this._spec.tick,this._orient=this._spec.orient==="angle"?"angle":"radius",this._center=this._spec.center,this._startAngle=Ut(this._spec.startAngle),this._endAngle=Ut(this._spec.endAngle),this._inverse=this._spec.inverse}onRender(t){}changeRegions(){}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimal:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,startAngle:this.startAngle,labelOffset:Ap(this._spec),getRadius:()=>this.getOuterRadius(),inside:this._spec.inside})}updateScaleRange(){let t=this._scale.range(),e;return e=this.getOrient()==="radius"?this._inverse?[this.computeLayoutOuterRadius(),this.computeLayoutInnerRadius()]:[this.computeLayoutInnerRadius(),this.computeLayoutOuterRadius()]:this._inverse?[this._endAngle,this._startAngle]:[this._startAngle,this._endAngle],(!t||!e||t[0]!==e[0]||t[1]!==e[1])&&(this._scale.range(e),!0)}collectSeriesField(t,e){var i,s;let n;return n=t>0?(s=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||s===void 0?void 0:s[t]:this.getOrient()==="radius"?e.getRadiusField():e.getAngleField(),n}updateSeriesScale(){be(this._regions,t=>{this.getOrient()==="radius"?qr(t.radiusAxisHelper,this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(t.setRadiusScale(this._scale),t.radiusAxisHelper=this.axisHelper()):qr(t.angleAxisHelper,this.axisHelper(),A(this._seriesUserId)||A(this._seriesIndex))&&(t.setAngleScale(this._scale),t.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getSeriesStatisticsField(t){let e=this.getOrient()==="radius"?t.getRadiusField():t.getAngleField();return Vt(this._scale.type)?e:[e[0]]}initGroupScales(){}axisHelper(){return{isContinuous:Vt(this._scale.type),dataToPosition:this.dataToPosition.bind(this),coordToPoint:this.coordToPoint.bind(this),pointToCoord:this.pointToCoord.bind(this),center:this.getCenter.bind(this),layoutRadius:this._computeLayoutRadius.bind(this),getScale:(t=0)=>this._scales[t],getAxisId:()=>this.id,getSpec:()=>this._spec}}positionToData(t){let e=this.pointToCoord(t);return this.getOrient()==="radius"?this.invert(e.radius):this.invert(e.angle)}coordToPoint(t){let e=this.getCenter();return oe(e,t.radius,t.angle)}pointToCoord(t){let e=this.getCenter(),i=this._startAngle,s=this._endAngle;return kP(t,e,i,s)}getOuterRadius(){return this.computeLayoutOuterRadius()}getInnerRadius(){return this.computeLayoutInnerRadius()}updateLayoutAttribute(){this._visible&&(this.getOrient()==="radius"?this._layoutRadiusAxis():this._layoutAngleAxis()),super.updateLayoutAttribute()}_getNormalizedValue(t,e){return e===0?0:(this.dataToPosition(t)-this._getStartValue())/e}getLabelItems(t){var e;let i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(s=>wo(s.value,this._getNormalizedValue([s.value],t)))]:[]}_getStartValue(){return this.getOrient()==="radius"?this.computeLayoutInnerRadius():this._startAngle}_layoutAngleAxis(){var t,e,i;let s=this.getCenter(),n=this.computeLayoutOuterRadius(),o=this.computeLayoutInnerRadius(),a=this._endAngle-this._startAngle,l=this.getLabelItems(a),h=Object.assign(Object.assign({},this.getLayoutStartPoint()),{inside:this._spec.inside,center:s,radius:n,innerRadius:o,startAngle:this._startAngle,endAngle:this._endAngle,sides:!((i=(e=(t=this._getRelatedAxis(this._option.radiusAxisIndex))===null||t===void 0?void 0:t.getSpec())===null||e===void 0?void 0:e.grid)===null||i===void 0)&&i.smooth?void 0:this.getScale().domain().length}),d=Object.assign(Object.assign({},h),{size:this.getRefLayoutRect(),title:{text:this._spec.title.text||this._dataFieldText},items:l,orient:"angle"});this._spec.grid.visible&&(d.grid=Object.assign({type:"line",smoothLink:!0,items:l[0]},h)),this._update(d)}_layoutRadiusAxis(){var t,e,i;let s=this.getCenter(),n=this.computeLayoutOuterRadius(),o=this.computeLayoutInnerRadius(),a=this.coordToPoint({angle:this._startAngle,radius:n}),l=this.coordToPoint({angle:this._startAngle,radius:o}),h=pe.distancePP(l,a),d=this.getLabelItems(h),c=Object.assign(Object.assign({},this.getLayoutStartPoint()),{start:l,end:a,verticalFactor:-1}),u=Object.assign(Object.assign({},c),{title:{text:this._spec.title.text||this._dataFieldText},items:d,orient:"radius"});!((t=this._spec.grid)===null||t===void 0)&&t.visible&&(u.grid=Object.assign({items:d[0],type:!((e=this._spec.grid)===null||e===void 0)&&e.smooth?"circle":"polygon",center:s,closed:!0,sides:(i=this._getRelatedAxis(this._option.angleAxisIndex))===null||i===void 0?void 0:i.getScale().domain().length,startAngle:this._startAngle,endAngle:this._endAngle},c)),this._update(u)}_getRelatedAxis(t){if(A(t))return this._option.getComponentByIndex(this.specKey,t)}_computeLayoutRadius(){return F1(()=>this._spec.layoutRadius,this.getRefLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}computeLayoutOuterRadius(){var t;let e=(t=this._spec.outerRadius)!==null&&t!==void 0?t:this._spec.radius,i=e??this.getRefSeriesRadius().outerRadius;return this._computeLayoutRadius()*i}computeLayoutInnerRadius(){var t;let e=(t=this._spec.innerRadius)!==null&&t!==void 0?t:this.getRefSeriesRadius().innerRadius;return this._computeLayoutRadius()*e}getRefSeriesRadius(){let t=yd,e=0,i=this.getChart().getSpec();return be(this.getRegions(),s=>{let n=s;if(Lz(n.type)){let{outerRadius:o=i.outerRadius,innerRadius:a=i.innerRadius}=n;K(o)&&(t=o),K(a)&&(e=a)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),{outerRadius:t,innerRadius:e}}_update(t){let{grid:e}=t,i=zG(t,["grid"]);this._axisMark.getProduct().encode(ot({},this._axisStyle,i)),this._gridMark&&this._gridMark.getProduct().encode(ot({},this._gridStyle,e))}invert(t){var e;if(this.getOrient()==="angle"&&this._scale.type==="band"){let i=this._scale.range(),s=i[i.length-1]-i[0],n=((e=this.getSpec().bandPosition)!==null&&e!==void 0?e:this._defaultBandPosition)===.5?0:this._scale.bandwidth()/2;if(i[0]<0){let o=(t+n+Math.abs(i[0]))%s-Math.abs(i[0]);return this._scale.invert(o)}return this._scale.invert((t+n)%s)}return this._scale.invert(t)}};Ta.type=W.polarAxis,Ta.specKey="axes";var $l=class extends Ta{constructor(){super(...arguments),this.type=W.polarLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new ir}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec()}initScales(){super.initScales(),this.setScaleNice()}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){let t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,Cn),t}};$l.type=W.polarLinearAxis,$l.specKey="axes",Ct($l,Po);var Io=()=>{_a(),va(),L_(),F_(),On(),I.registerComponent($l.type,$l)};var ql=class extends Ta{constructor(){super(...arguments),this.type=W.polarBandAxis,this._scale=new bs}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){let t=super.updateScaleRange();return this.updateGroupScaleRange(),t}axisHelper(){let t=super.axisHelper();return Object.assign(Object.assign({},t),{getBandwidth:e=>t.getScale(e).bandwidth()})}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}registerTicksTransform(){let t=`${this.type}-ticks`;return nt(this._option.dataSet,t,tE),t}transformScaleDomain(){}};ql.type=W.polarBandAxis,ql.specKey="axes",Ct(ql,Tp);var Zl=()=>{_a(),va(),L_(),F_(),On(),I.registerComponent(ql.type,ql)};var O1=class extends he{enableByType(t){return t!=="dimension"}};var Jl=class r extends Lo{constructor(){super(...arguments),this.type=F.gaugePointer,this.transformerConstructor=g0,this._pinMark=null,this._pointerMark=null,this._pinBackgroundMark=null}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setRadiusField(this._spec.radiusField),this._pointerType=((t=this._spec.pointer)===null||t===void 0?void 0:t.type)==="rect"?"rect":"path"}initMark(){this._pinBackgroundMark=this._createMark(r.mark.pinBackground),this._pointerMark=this._createMark(Object.assign(Object.assign({},r.mark.pointer),{type:this._pointerType}),{isSeriesMark:!0}),this._pinMark=this._createMark(r.mark.pin)}initMarkStyle(){this.initPinBackgroundMarkStyle(),this.initPointerMarkStyle(),this.initPinMarkStyle()}initGroups(){}initPointerMarkStyle(){let t=this._pointerMark,e=this._spec.pointer;t&&(this.setMarkStyle(t,{x:i=>{var s,n;let{x:o}=this._getPointerAnchor(i,e);return o-this._getPointerWidth()*((n=(s=e?.center)===null||s===void 0?void 0:s[0])!==null&&n!==void 0?n:0)},y:i=>{var s,n;let{y:o}=this._getPointerAnchor(i,e);return o-this._getPointerHeight(i)*((n=(s=e?.center)===null||s===void 0?void 0:s[1])!==null&&n!==void 0?n:0)},anchor:i=>{let{x:s,y:n}=this._getPointerAnchor(i,e);return[s,n]},fill:this.getColorAttribute(),zIndex:200}),this._pointerType==="path"?this.setMarkStyle(t,{scaleX:this._getPointerWidth.bind(this),scaleY:this._getPointerHeight.bind(this),angle:i=>this._getPointerAngle(i)+Math.PI/2}):this.setMarkStyle(t,{width:this._getPointerWidth.bind(this),height:this._getPointerHeight.bind(this),angle:i=>this._getPointerAngle(i)-Math.PI/2}))}initTooltip(){this._tooltipHelper=new O1(this),this._pointerMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pointerMark)}_getPointerAnchor(t,e){var i;return(i=e.isOnCenter)===null||i===void 0||i?this.angleAxisHelper.center():this.radiusAxisHelper.coordToPoint({radius:this._innerRadius*this._computeLayoutRadius(),angle:this.angleAxisHelper.dataToPosition([t[this._angleField[0]]])})}_getPointerWidth(){return this._spec.pointer.width*this._computeLayoutRadius()}_getPointerHeight(t){var e,i;let s=this._spec.pointer,n=this._radiusField[0];return A(this.radiusAxisHelper)&&A(n)?this.radiusAxisHelper.dataToPosition([t[n]])-((e=s?.innerPadding)!==null&&e!==void 0?e:0)-((i=s?.outerPadding)!==null&&i!==void 0?i:10):s.height*this._computeLayoutRadius()}_getPointerAngle(t){let e=this.angleAxisHelper.getScale().domain(),i=Pe(e),s=Ae(e),n=ee(t[this._angleField[0]],s,i);return this.angleAxisHelper.dataToPosition([n])}_getRotatedPointerCenterOffset(t){var e,i,s,n;let o=this._spec.pointer,a=this._getPointerWidth()*((i=(e=o?.center)===null||e===void 0?void 0:e[0])!==null&&i!==void 0?i:0),l=-this._getPointerHeight(t)*((n=(s=o?.center)===null||s===void 0?void 0:s[1])!==null&&n!==void 0?n:0),h=this._getPointerAngle(t)-Math.PI/2,d=Math.cos(h),c=Math.sin(h);return{x:a*d+l*c,y:-(l*d-a*c)}}initPinBackgroundMarkStyle(){let t=this._pinBackgroundMark,e=this._spec.pinBackground;t&&this.setMarkStyle(t,{x:i=>this._getPointerAnchor(i,e).x,y:i=>this._getPointerAnchor(i,e).y,scaleX:()=>e.width*this._computeLayoutRadius(),scaleY:()=>e.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:100})}initPinMarkStyle(){let t=this._pinMark,e=this._spec.pin;t&&this.setMarkStyle(t,{x:i=>this._getPointerAnchor(i,e).x,y:i=>this._getPointerAnchor(i,e).y,scaleX:()=>e.width*this._computeLayoutRadius(),scaleY:()=>e.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:300})}initInteraction(){this._parseInteractionConfig(this._pointerMark?[this._pointerMark]:[])}initAnimation(){var t,e,i;let s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._pointerMark.setAnimationConfig(_t((i=I.getAnimationInKey("gaugePointer"))===null||i===void 0?void 0:i({startAngle:this._startAngle},s),xt("pointer",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}};Jl.type=F.gaugePointer,Jl.mark=NG,Jl.transformerConstructor=g0;var Bw=()=>{I.registerSeries(Jl.type,Jl),I1(),Hn(),VG(),Zl(),Io()};var f0=class extends ye{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){this._addMarkLabelSpec(t,"segment")}};var Ql=class r extends Lo{constructor(){super(...arguments),this.type=F.gauge,this.transformerConstructor=f0,this._segmentMark=null,this._trackMark=null,this._padAngle=0}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._padAngle=Ut((t=this._spec.padAngle)!==null&&t!==void 0?t:0)}initData(){var t;super.initData(),nt(this._option.dataSet,"spiltSegment",(e,i)=>{let s=e.slice();return s.sort((n,o)=>n[this._angleField[0]]-o[this._angleField[0]]),s.forEach((n,o)=>{n[_A]=n[this._angleField[0]],n[tp]=o>0?s[o-1][_A]:void 0}),s}),(t=this.getViewData())===null||t===void 0||t.transform({type:"spiltSegment"},!1)}initMark(){super.initMark(),this._trackMark=this._createMark(r.mark.track,{parent:this._arcGroupMark,dataView:!1}),this._segmentMark=this._createMark(r.mark.segment,{parent:this._arcGroupMark,isSeriesMark:!0})}initMarkStyle(){super.initMarkStyle(),this.initTrackMarkStyle(),this.initSegmentMarkStyle()}initSegmentMarkStyle(){var t;let e=this._segmentMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart.bind(this),endAngle:this._getAngleValueEnd.bind(this),innerRadius:()=>{var i;return this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0)},outerRadius:()=>{var i,s;return this._computeLayoutRadius()*((s=(i=this._spec.radius)!==null&&i!==void 0?i:this._spec.outerRadius)!==null&&s!==void 0?s:1)},cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0})}generateRadiusStyle(t){if(!t)return;let e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),e}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t&&t.name==="segment"){let s=this.getSpec().segment;if(s)for(let n in s.state||{})this.setMarkStyle(t,this.generateRadiusStyle(s.state[n]),n,X.User_Mark)}}initTooltip(){super.initTooltip(),this._segmentMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._segmentMark)}initTrackMarkStyle(){var t;let e=this._trackMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:()=>{var i;return this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0)},outerRadius:()=>{var i,s;return this._computeLayoutRadius()*((s=(i=this._spec.radius)!==null&&i!==void 0?i:this._spec.outerRadius)!==null&&s!==void 0?s:1)},cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,zIndex:100})}_getAngleValueStartWithoutMask(t){let e=this._getAngleValueStartWithoutPadAngle(t),i=this._getAngleValueEndWithoutPadAngle(t);return sn(e,(e+i)/2)(e+(i>e?1:-1)*Math.abs(this._padAngle/2))}_getAngleValueEndWithoutMask(t){let e=this._getAngleValueStartWithoutPadAngle(t),i=this._getAngleValueEndWithoutPadAngle(t);return sn(i,(e+i)/2)(i-(i>e?1:-1)*Math.abs(this._padAngle/2))}_getAngleValueStartWithoutPadAngle(t){return A(t[tp])?this.angleAxisHelper.dataToPosition([t[tp]]):this._startAngle}_getAngleValueEndWithoutPadAngle(t){return this.angleAxisHelper.dataToPosition([t[_A]])}initAnimation(){var t,e,i;let s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._segmentMark.setAnimationConfig(_t((i=I.getAnimationInKey("circularProgress"))===null||i===void 0?void 0:i({startAngle:this._startAngle},s),xt("segment",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}};Ql.type=F.gauge,Ql.mark=HG,Ql.transformerConstructor=f0;var Lw=()=>{I.registerSeries(Ql.type,Ql),Wl(),Rw(),Io()};var th=class extends Ie{_isValidSeries(t){return!this.seriesType||t===this.seriesType}getIndicatorSpec(t){var e,i,s;let n=O(t.indicator),o=(e=t.innerRadius)!==null&&e!==void 0?e:(s=(i=t.series)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.innerRadius;return A(o)&&n.forEach(a=>{T(a.limitRatio)&&(a.limitRatio=o)}),n}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["radius","outerRadius","innerRadius","startAngle","endAngle","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),H(t.dataZoom)&&t.dataZoom.length>0&&t.dataZoom.forEach(e=>{e.filterMode==="axis"&&(e.filterMode="filter")}),this.transformSeriesSpec(t),A(t.indicator)&&(t.indicator=this.getIndicatorSpec(t))}};var Up=class extends th{needAxes(){return!1}_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t,["startAngle","endAngle","centerX","centerY"]);return e.categoryField=t.categoryField||t.radiusField,e.valueField=t.valueField||t.angleField,e}_transformProgressAxisSpec(t,e,i,s,n){var o,a;t.axes||(t.axes=[]);let l=((o=t.axes)!==null&&o!==void 0?o:[]).find(c=>c.orient==="radius"),h=((a=t.axes)!==null&&a!==void 0?a:[]).find(c=>c.orient==="angle");h||(h=e,t.axes.push(h)),l||(l=i,t.axes.push(l)),T(h.type)&&(h.type="linear"),T(l.type)&&(l.type="band");let d=jl(h,{min:0,max:1});T(h.min)&&(h.min=d.min),T(h.max)&&(h.max=d.max),s&&Object.assign(h,ot({},s,h)),n&&Object.assign(l,ot({},n,l))}};var Wp=class extends th{needAxes(){return!0}_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.categoryField=t.categoryField||t.angleField,e.valueField=t.valueField||t.radiusField,e}transformSpec(t){var e;if(super.transformSpec(t),this.needAxes()){t.axes||(t.axes=[]);let i={radius:!1,angle:!1};((e=t.axes)!==null&&e!==void 0?e:[]).forEach(s=>{let{orient:n}=s;n==="radius"&&(i.radius=!0),n==="angle"&&(i.angle=!0)}),i.angle||t.axes.push({orient:"angle"}),i.radius||t.axes.push({orient:"radius"})}}};var _0=class extends Up{_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.radiusField=t.radiusField,e.pin=t.pin,e.pinBackground=t.pinBackground,e.pointer=t.pointer,e}_getDefaultCircularProgressSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.type=F.circularProgress,e}transformSpec(t){var e,i,s,n,o;super.transformSpec(t);let a=(e=t.series)===null||e===void 0?void 0:e.find(l=>l.type===F.gauge||l.type===F.circularProgress);T(a)&&(a=(i=t.gauge)!==null&&i!==void 0?i:this._getDefaultCircularProgressSeriesSpec(t),a.type==="circularProgress"&&(T(a.radiusField)&&T(a.categoryField)&&(a.radiusField=(n=(s=t.radiusField)!==null&&s!==void 0?s:t.categoryField)!==null&&n!==void 0?n:t.seriesField),T(a.valueField)&&T(a.angleField)&&(a.valueField=(o=t.valueField)!==null&&o!==void 0?o:t.angleField)),t.series.length===1?t.series.push(a):t.series.forEach(l=>{l.type===a.type&&Object.keys(a).forEach(h=>{h in l||(l[h]=a[h])})})),a.type===F.circularProgress?this._transformProgressAxisSpec(t,{orient:"angle",visible:!0,domainLine:{visible:!1},grid:{visible:!1}},{orient:"radius",visible:!1},{zIndex:Tt.Region+50}):this._transformGaugeAxisSpec(t)}_transformGaugeAxisSpec(t){var e;t.axes||(t.axes=[]);let i={radius:null,angle:null};((e=t.axes)!==null&&e!==void 0?e:[]).forEach(s=>{let{orient:n}=s;n==="radius"&&(i.radius=s),n==="angle"&&(i.angle=s)}),i.angle||(i.angle={orient:"angle",visible:!0},t.axes.push(i.angle)),i.radius||(i.radius={orient:"radius",visible:!1},t.axes.push(i.radius)),T(i.angle.type)&&(i.angle.type="linear"),T(i.radius.type)&&(i.radius.type="linear"),T(i.angle.zIndex)&&(i.angle.zIndex=Tt.Region+50)}};var eh=class extends At{constructor(){super(...arguments),this.transformerConstructor=_0,this.type="gauge",this.seriesType=F.gaugePointer}};eh.type="gauge",eh.seriesType=F.gaugePointer,eh.transformerConstructor=_0;var Iw=()=>{Bw(),Lw(),I.registerChart(eh.type,eh)};var Fw=class r extends Y_{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{padding:0})}};Fw.type="cell";var H1=class extends he{enableByType(t){return t!=="dimension"}};var GG=Object.assign(Object.assign({},Ft),{cell:{name:"cell",type:"cell"},cellBackground:{name:"cellBackground",type:"cell"}});var v0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"cell")}};var Yp=class r extends ei{constructor(){super(...arguments),this.type=F.heatmap,this.transformerConstructor=v0}getFieldValue(){return this._fieldValue}setFieldValue(t){this._fieldValue=O(t)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFieldValue(this._spec.valueField)}initMark(){var t,e,i,s;let n={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._cellMark=this._createMark(r.mark.cell,{isSeriesMark:!0,stateSort:(t=this._spec.cell)===null||t===void 0?void 0:t.stateSort},Object.assign(Object.assign({},n),{setCustomizedShape:(e=this._spec.cell)===null||e===void 0?void 0:e.customShape,morph:vi(this._spec,r.mark.cell.name),morphElementKey:this.getDimensionField()[0]})),this._backgroundMark=this._createMark(r.mark.cellBackground,{stateSort:(i=this._spec.cellBackground)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},n),{setCustomizedShape:(s=this._spec.cellBackground)===null||s===void 0?void 0:s.customShape}))}initMarkStyle(){this.initCellMarkStyle(),this.initCellBackgroundMarkStyle()}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getMeasureField()[0]]})}initCellMarkStyle(){this.setMarkStyle(this._cellMark,{x:t=>this.dataToPositionX(t),y:t=>this.dataToPositionY(t),size:()=>[this.getCellSize(this._xAxisHelper),this.getCellSize(this._yAxisHelper)],fill:this.getColorAttribute()},"normal",X.Series)}initCellBackgroundMarkStyle(){var t,e,i;let s=Ni((i=(e=(t=this._spec.cellBackground)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.padding)!==null&&i!==void 0?i:0);this.setMarkStyle(this._backgroundMark,{x:n=>{let o=this.getCellSize(this._xAxisHelper);return this.dataToPositionX(n)-o/2+s[3]},y:n=>{let o=this.getCellSize(this._yAxisHelper);return this.dataToPositionY(n)-o/2+s[0]},width:()=>this.getCellSize(this._xAxisHelper)-s[1]-s[3],height:()=>this.getCellSize(this._yAxisHelper)-s[0]-s[2]},"normal",X.Series)}getColorAttribute(){var t;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:this.getFieldValue[0]}}initInteraction(){this._parseInteractionConfig(this._cellMark?[this._cellMark]:[])}initAnimation(){var t,e,i;let s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset,n=Er(this);this._cellMark.setAnimationConfig(_t((i=I.getAnimationInKey("heatmap"))===null||i===void 0?void 0:i(s),xt("cell",this._spec,this._markAttributeContext),n))}getCellSize(t){var e,i;return(i=(e=t.getBandwidth)===null||e===void 0?void 0:e.call(t,0))!==null&&i!==void 0?i:6}initTooltip(){this._tooltipHelper=new H1(this),this._cellMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._cellMark)}getDefaultShapeType(){return"square"}getDimensionField(){return[].concat(this.fieldX,this.fieldY)}getMeasureField(){return this.getFieldValue()}getActiveMarks(){return[this._cellMark]}};Yp.type=F.heatmap,Yp.mark=GG,Yp.transformerConstructor=v0;var y0=class extends ai{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["valueField","cell"])}};var Xp=class extends At{constructor(){super(...arguments),this.transformerConstructor=y0,this.type="heatmap",this.seriesType=F.heatmap}};Xp.type="heatmap",Xp.seriesType=F.heatmap,Xp.transformerConstructor=y0;var Od=class extends ai{transformSpec(t){super.transformSpec(t),t.axes.forEach(e=>e.type="linear")}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["x2Field","y2Field","barMinHeight","barBackground"])}};var ih=class extends At{constructor(){super(...arguments),this.transformerConstructor=Od}};ih.transformerConstructor=Od,Ct(ih,Mi);var rh=class extends Od{transformSpec(t){super.transformSpec(t),nr(t)}};var Kp=class extends ih{constructor(){super(...arguments),this.transformerConstructor=rh,this.type="histogram",this.seriesType=F.bar}};Kp.type="histogram",Kp.seriesType=F.bar,Kp.transformerConstructor=rh;var $p=class extends ih{constructor(){super(...arguments),this.transformerConstructor=rh,this.type="histogram3d",this.seriesType=F.bar3d}};$p.type="histogram3d",$p.seriesType=F.bar3d,$p.transformerConstructor=rh;var UG=Object.assign(Object.assign({},Ft),tn);var Hd=class extends ei{constructor(){super(...arguments),this.type=F.line,this.transformerConstructor=Cs,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var t;let e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"line";this.initLineMark(e,i==="line"),this.initSymbolMark(e,i==="point")}initTooltip(){super.initTooltip();let{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var t,e,i,s;let n={direction:this.direction},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark.setAnimationConfig(_t((i=I.getAnimationInKey("line"))===null||i===void 0?void 0:i(n,o),xt("line",this._spec,this._markAttributeContext))),this._symbolMark){let a=Er(this);this._symbolMark.setAnimationConfig(_t((s=I.getAnimationInKey("scaleInOut"))===null||s===void 0?void 0:s(),xt("point",this._spec,this._markAttributeContext),a))}}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){var e;let i=((e=this._spec)===null||e===void 0?void 0:e.seriesMark)!=="point";return s=>{var n,o;return i&&s==="fill"&&(s="stroke"),(o=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(s,t))!==null&&o!==void 0?o:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}};Hd.type=F.line,Hd.mark=UG,Hd.transformerConstructor=Cs,Ct(Hd,Vl);var x0=class extends ai{_getDefaultSeriesSpec(t){var e;let i=super._getDefaultSeriesSpec(t,["point","line","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","lineLabel"]);return i.seriesMark=(e=t.seriesMark)!==null&&e!==void 0?e:"line",i}transformSpec(t){super.transformSpec(t),nr(t)}};var Nd=class extends At{constructor(){super(...arguments),this.transformerConstructor=x0,this.type="line",this.seriesType=F.line}};Nd.type="line",Nd.seriesType=F.line,Nd.transformerConstructor=x0,Ct(Nd,Mi);var PCe=_y();var WG={},XG=["clipAngle","clipExtent","scale","translate","center","rotate","precision","reflectX","reflectY","parallels","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Sq(r,t){return function e(){let i=t();return i.type=r,i.path=_y().projection(i),i.copy=i.copy||function(){let s=e();return XG.forEach(n=>{i[n]&&s[n](i[n]())}),s.path.pointRadius(i.path.pointRadius()),s},i}}function N1(r,t){r&&Z(r)||td("Projection type must be a name string.");let e=r.toLowerCase();return arguments.length>1&&(WG[e]=Sq(e,t)),WG[e]||null}var YG={albers:hg,albersusa:vT,azimuthalequalarea:xT,azimuthalequidistant:ST,conicconformal:TT,conicequalarea:Va,conicequidistant:MT,equalEarth:ET,equirectangular:kT,gnomonic:PT,identity:RT,mercator:AT,naturalEarth1:LT,orthographic:FT,stereographic:HT,transversemercator:VT};Object.keys(YG).forEach(r=>{N1(r,YG[r])});var V1=(r,t)=>{if(!t.from||!t.from())return r;let e=t.fields,i=t.key,s=t.values,n=t.default,o=t.as||[e],a=t.from().reduce(function(h,d){return d[e]&&h.set(d[e],d),h},new Map),l;if(V(t.set))l=function(h){let d=a.get(h[i]);t.set(h,d)};else if(s){let h=s.length;l=function(d){let c=a.get(d[i]);if(T(c))for(let u=0;u<h;++u)d[o[u]]=n;else for(let u=0;u<h;++u)d[o[u]]=c[s[u]]}}else l=function(h){let d=a.get(h[i]);h[o[0]]=A(d)?d:n};return r.length===0?[]:r.map(h=>(l(h),h))};var qp=class extends qi{constructor(){super(...arguments),this.type=F.geo,this.coordinate="geo",this._nameProperty="name"}getMapViewData(){var t;return(t=this._mapViewData)===null||t===void 0?void 0:t.getDataView()}get nameField(){return this._nameField}set nameField(t){this._nameField=t}get valueField(){return this._valueField}set valueField(t){this._valueField=t}getNameProperty(){return this._nameProperty}getCentroidProperty(){return this._centroidProperty}getCoordinateHelper(){return this._coordinateHelper}setCoordinateHelper(t){this._coordinateHelper=t}getStatisticFields(){let t=[];return t.push({key:this._nameField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}getGroupFields(){return null}dataToPosition(t,e){var i;let s=null;if(!t||e&&!this.isDatumInViewData(t))return s;let{dataToPosition:n,latitudeField:o,longitudeField:a}=this._coordinateHelper;if(s=this.nameToPosition(t),s===null){let l=a?t?.[a]:Number.NaN,h=o?t?.[o]:Number.NaN;s=(i=n?.([l,h]))!==null&&i!==void 0?i:null}return s}nameToPosition(t){let e=this.getDatumName(t);return T(e)?null:this.nameValueToPosition(e)}nameValueToPosition(t){var e,i;let s=(i=(e=this.getMapViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.filter(l=>this.getDatumName(l)===t)[0];if(T(s))return null;let{dataToPosition:n}=this._coordinateHelper,o=this.getDatumCenter(s),a=n?.(o);return T(a)||isNaN(a.x)||isNaN(a.y)?null:a}dataToLatitude(t){if(!this._coordinateHelper)return Number.NaN;let{dataToLatitude:e}=this._coordinateHelper;return e(t)}dataToLongitude(t){if(!this._coordinateHelper)return Number.NaN;let{dataToLatitude:e}=this._coordinateHelper;return e(t)}valueToPosition(t,e){return{x:this.dataToLongitude(t),y:this.dataToLatitude(e)}}positionToData(t){}latitudeToData(t){}longitudeToData(t){}dataToPositionX(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionY(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionZ(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}release(){super.release(),this._mapViewData.release(),this._mapViewData=this._mapViewDataStatistics=null}getStackGroupFields(){return[this._nameField]}getStackValueField(){return this._spec.valueField}compileData(){var t;(t=this._mapViewData)===null||t===void 0||t.compile()}initStatisticalData(){if(super.initStatisticalData(),this._mapViewData){let t=`${et}_series_${this.id}_mapViewDataStatic`;this._mapViewDataStatistics=this.createStatisticalData(t,this._mapViewData.getDataView()),this._mapViewData.getDataView().target.removeListener("change",this._mapViewDataStatistics.reRunAllTransform)}}getSeriesKeys(){var t,e,i,s,n;return this._seriesField?(n=(e=(t=this.getRawDataStatisticsByField(this._seriesField))===null||t===void 0?void 0:t.values)!==null&&e!==void 0?e:(s=(i=this._mapViewDataStatistics)===null||i===void 0?void 0:i.latestData[this._seriesField])===null||s===void 0?void 0:s.values)!==null&&n!==void 0?n:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}fillData(){var t,e;super.fillData(),(t=this._mapViewData.getDataView())===null||t===void 0||t.reRunAllTransform(),(e=this._mapViewDataStatistics)===null||e===void 0||e.reRunAllTransform()}getActiveMarks(){return[]}};var Zp=`${et}_MAP_LOOK_UP_KEY`,KG=(r,t)=>(r.features&&r.features.forEach((e,i)=>{var s;e[$e]=i;let n=(s=e.properties)===null||s===void 0?void 0:s[t.nameProperty];t.nameMap&&t.nameMap[n]?e[Zp]=t.nameMap[n]:e[Zp]=n}),r.features);var j1=class extends he{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=t=>{var e;let i=this.series;return(e=this._getDimensionData(t))!==null&&e!==void 0?e:i.getDatumName(t)}}};var $G=Object.assign(Object.assign({},Ft),{area:{name:"area",type:"path"}});var z1=class{constructor(t){this.projection=N1(t.type)()}fit(t,e,i){let s={type:"FeatureCollection",features:i};this.projection.fitExtent([t,e],s)}center(t){var e,i;(i=(e=this.projection)===null||e===void 0?void 0:e.center)===null||i===void 0||i.call(e,t)}project(t){var e;return(e=this.projection)===null||e===void 0?void 0:e.call(this,t)}shape(t){var e,i;return(i=(e=this.projection)===null||e===void 0?void 0:e.path)===null||i===void 0?void 0:i.call(e,t)}invert(t){var e,i;return(i=(e=this.projection)===null||e===void 0?void 0:e.invert)===null||i===void 0?void 0:i.call(e,t)}scale(t){var e;if(!((e=this.projection)===null||e===void 0)&&e.scale){if(t===void 0)return this.projection.scale();this.projection.scale(t)}}translate(t){var e;if(!((e=this.projection)===null||e===void 0)&&e.scale){if(t===void 0)return this.projection.translate();this.projection.translate(t)}}evaluate(t,e,i){let s=this.projection.copy();return s?.fitExtent([t,e],{type:"FeatureCollection",features:i})}};var Jp={debounce:Zi,throttle:Hi},sh=class{constructor(){this._isGestureListener=!1}initZoomable(t,e=ze["desktop-browser"]){this._eventObj=t,this._renderMode=e,this._gestureController=this._option.getChart().getVGrammarView().renderer._gestureController,this._isGestureListener=zr(this._renderMode)||Gr(this._renderMode),Nn(this._renderMode)&&(this._clickEnable=!0,this._zoomableTrigger=new(this._getZoomTriggerEvent("trigger")))}_getZoomTriggerEvent(t){return Nn(this._renderMode)[t]}_zoomEventDispatch(t,e,i,s){if(!this._isGestureListener&&!t.event)return;let n=this._isGestureListener?t:t.event.clone();this._zoomableTrigger.parserZoomEvent(n);let{zoomDelta:o,zoomX:a,zoomY:l,path:h}=n;if(!s&&!h.some(c=>c.name&&c.name.includes("region"))||T(o)||!ac({x:a,y:l},this._getRegionOrSeriesLayout(e),!1))return;let d={};i&&(d=i({zoomDelta:o,zoomX:a,zoomY:l},n)),this._eventObj.emit("zoom",Object.assign(Object.assign({scale:n.zoomDelta,scaleCenter:{x:n.zoomX,y:n.zoomY}},d),{model:this}))}_getRegionOrSeriesLayout(t){t.type!=="region"&&(t=t.getRegion());let{x:e,y:i,width:s,height:n}=t.layout.getLayout();return{x1:e,y1:i,x2:e+s,y2:i+n}}_bindZoomEventAsRegion(t,e,i,s){var n,o;let a=(n=s?.delayType)!==null&&n!==void 0?n:"throttle",l=(o=s?.delayTime)!==null&&o!==void 0?o:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("zoom")]:[this._getZoomTriggerEvent("zoom"),{level:Se.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("zoomEnd")]:[this._getZoomTriggerEvent("zoomEnd"),{level:Se.chart,consume:!1}];h.on(...c,Jp[a](u=>{this._zoomableTrigger.clearZoom()},l)),h.on(...d,Jp[a](u=>{var p;this._zoomEventDispatch(u,e,i,(p=s?.allowComponentZoom)!==null&&p!==void 0&&p)},l))}initZoomEventOfSeries(t,e,i){this._option.disableTriggerEvent||Nn(this._renderMode)&&this._bindZoomEventAsRegion(t.event,t,e,i)}initZoomEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Nn(this._renderMode)&&t.forEach(n=>{e?n.getSeries().forEach(o=>{e(o)&&this._bindZoomEventAsRegion(o.event,o,i,s)}):this._bindZoomEventAsRegion(this._eventObj,n,i,s)})}_scrollEventDispatch(t,e,i){let s=!1;if(!this._isGestureListener&&(!t.event||this._option.disableTriggerEvent))return s;let n=this._isGestureListener?t:t.event;this._zoomableTrigger.parserScrollEvent(n);let{scrollX:o,scrollY:a,canvasX:l,canvasY:h}=n;return T(o)&&T(a)||ac({x:l,y:h},this._getRegionOrSeriesLayout(e),!1)&&(i&&(s=i({scrollX:o,scrollY:a},n)),this._eventObj.emit("scroll",{scrollX:o,scrollY:a,model:this})),s}_bindScrollEventAsRegion(t,e,i,s){var n,o;let a=(n=s?.delayType)!==null&&n!==void 0?n:"throttle",l=(o=s?.delayTime)!==null&&o!==void 0?o:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("scroll")]:[this._getZoomTriggerEvent("scroll"),{level:Se.chart,consume:!0}],c=this._isGestureListener?[this._getZoomTriggerEvent("scrollEnd")]:[this._getZoomTriggerEvent("scrollEnd"),{level:Se.chart,consume:!1}];h.on(...c,Jp[a](u=>{this._zoomableTrigger.clearScroll()},l)),h.on(...d,Jp[a](u=>this._scrollEventDispatch(u,e,i),l))}initScrollEventOfSeries(t,e,i){Nn(this._renderMode)&&this._bindScrollEventAsRegion(t.event,t,e,i)}initScrollEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Nn(this._renderMode)&&t.forEach(n=>{e?n.getSeries().forEach(o=>{e(o)&&this._bindScrollEventAsRegion(o.event,o,i,s)}):this._bindScrollEventAsRegion(this._eventObj,n,i,s)})}_bindDragEventAsRegion(t,e,i,s){t.on(this._getZoomTriggerEvent("start"),{level:Se.chart},n=>{if(!n.event)return;let{event:o}=n;ac({x:o.canvasX,y:o.canvasY},this._getRegionOrSeriesLayout(e),!1)&&this._handleDrag(n,i,s)}),t.on("click",{level:Se.chart},()=>!this._clickEnable)}initDragEventOfSeries(t,e,i){this._option.disableTriggerEvent||Nn(this._renderMode)&&t.event.on(this._getZoomTriggerEvent("start"),{level:Se.model,filter:({model:s})=>s?.id===t.id},s=>{this._handleDrag(s,e,i)})}initDragEventOfRegions(t,e,i,s){this._option.disableTriggerEvent||Nn(this._renderMode)&&t.forEach(n=>{e?n.getSeries().forEach(o=>{e(o)&&(o.event.on(this._getZoomTriggerEvent("start"),{level:Se.model,filter:({model:a})=>a?.id===o.id},a=>{this._handleDrag(a,i)}),o.event.on("click",{level:Se.model,filter:({model:a})=>a?.id===o.id},()=>!this._clickEnable))}):this._bindDragEventAsRegion(this._eventObj,n,i,s)})}_handleDrag(t,e,i){var s,n,o;if(this._option.disableTriggerEvent||(this._clickEnable=!1,!this._zoomableTrigger.parserDragEvent(t.event)))return;let a=(s=i?.delayType)!==null&&s!==void 0?s:"throttle",l=(n=i?.delayTime)!==null&&n!==void 0?n:0,h=(o=i?.realTime)===null||o===void 0||o,d=this._getZoomTriggerEvent("move"),c=this._getZoomTriggerEvent("end"),u=t.event,p=u.canvasX,m=u.canvasY,g=u.canvasX,f=u.canvasY,_=Jp[a](x=>{this._clickEnable=!0;let y=x.event,b=[y.canvasX-g,y.canvasY-f];g=y.canvasX,f=y.canvasY,!h&&e&&e(b,x.event),this._eventObj.emit("panend",{delta:b,model:this}),this._zoomableTrigger.pointerId=null,this._eventObj.off(d,{level:Se.chart,source:jt.chart},v),c.forEach(S=>{this._eventObj.off(S,{level:Se.chart,source:jt.chart},_),this._eventObj.allow(S)})},l),v=Jp[a](x=>{if(!this._zoomableTrigger.parserDragEvent(x.event))return;this._clickEnable=!1,c.forEach(S=>this._eventObj.prevent(S,_));let y=x.event,b=[y.canvasX-p,y.canvasY-m];p=y.canvasX,m=y.canvasY,h&&e&&e(b,x.event),this._eventObj.emit("panmove",{delta:b,model:this})},l);this._eventObj.on(d,{level:Se.chart,source:jt.chart},v),c.forEach(x=>{this._eventObj.on(x,{level:Se.chart,source:jt.chart},_)})}};function Aq(r,t){return`${et}_${t}_${r}`}var b0=class extends Oe{constructor(){super(...arguments),this.type=W.geoCoordinate,this.name=W.geoCoordinate,this.layoutType="none",this.layoutZIndex=Tt.Mark,this._projectionSpec={name:Aq(this.type,this.id),type:"mercator"},this._actualScale=1,this._initialScale=1,this.effect={scaleUpdate:()=>{this.coordinateHelper()}},this._handleChartZoom=(t,e)=>{var i,s,n,o,a,l;let h=t.zoomDelta,d=this._actualScale;return this._actualScale*=h,this._actualScale<((i=this._spec.zoomLimit)===null||i===void 0?void 0:i.min)?(this._actualScale=(s=this._spec.zoomLimit)===null||s===void 0?void 0:s.min,h=((n=this._spec.zoomLimit)===null||n===void 0?void 0:n.min)/d):this._actualScale>((o=this._spec.zoomLimit)===null||o===void 0?void 0:o.max)&&(this._actualScale=(a=this._spec.zoomLimit)===null||a===void 0?void 0:a.max,h=((l=this._spec.zoomLimit)===null||l===void 0?void 0:l.max)/d),this.zoom(h,[t.zoomX,t.zoomY]),{scale:h,totalScale:this._actualScale}},this.pan=(t=[0,0])=>{var e,i,s;let n=(i=(e=this._projection)===null||e===void 0?void 0:e.translate())!==null&&i!==void 0?i:[0,0],o=n[0],a=n[1];o+=t[0],a+=t[1],(s=this._projection)===null||s===void 0||s.translate([o,a])}}get longitudeField(){return this._longitudeField}get latitudeField(){return this._latitudeField}get projectionSpec(){return this._projectionSpec}setProjection(t){this._projectionSpec=Object.assign(Object.assign({},t),{name:this._projectionSpec.name})}getZoom(){return this._actualScale}static getSpecInfo(t){if(T(t))return null;let e=[];return t.region.forEach((i,s)=>{if(i.coordinate==="geo"){let n=Object.assign(Object.assign({},i),{padding:0});e.push({spec:n,regionIndex:s,type:W.geoCoordinate,specInfoPath:["component","geoCoordinate",s]})}}),e}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec(),this._spec.roam&&this.initZoomable(this.event,this._option.mode),this._projectionSpec=ot(this._projectionSpec,this._spec.projection),this._projectionSpec.zoom>((t=this._spec.zoomLimit)===null||t===void 0?void 0:t.max)&&(this._projectionSpec.zoom=this._spec.zoomLimit.max),this._projectionSpec.zoom<((e=this._spec.zoomLimit)===null||e===void 0?void 0:e.min)&&(this._projectionSpec.zoom=this._spec.zoomLimit.min),this._actualScale=(i=this._projectionSpec.zoom)!==null&&i!==void 0?i:1,this._initialScale=this._actualScale,this._longitudeField=this._spec.longitudeField,this._latitudeField=this._spec.latitudeField}created(){super.created(),this._regions=this._option.getRegionsInIndex([this._option.regionIndex]),this.initProjection(),this.coordinateHelper(),this.initEvent(),this._initCenterCache()}dispatchZoom(t,e){let i=e||{x:this.getLayoutStartPoint().x+this.getLayoutRect().width/2,y:this.getLayoutStartPoint().y+this.getLayoutRect().height/2},{scale:s,totalScale:n}=this._handleChartZoom({zoomDelta:t,zoomX:i.x,zoomY:i.y});s!==1&&this.event.emit("zoom",{scale:s,scaleCenter:i,totalScale:n,model:this})}initEvent(){this.event.on(rt.scaleUpdate,{filter:({model:e})=>e?.id===this.id},this.effect.scaleUpdate.bind(this));let{roam:t}=this._spec;t&&(this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom),this.initDragEventOfRegions(this._regions,t.blank?null:()=>!0,this.pan),this._regions.forEach(e=>{e.getSeries().forEach(i=>{i.event.on("zoom",s=>(i.handleZoom(s),!0)),i.event.on("panmove",s=>(i.handlePan(s),!0))})}))}initProjection(){var t;this._projection=new z1(this._projectionSpec),this._projection.projection!==null||(t=this._option)===null||t===void 0||t.onError("unsupported projection type!")}coordinateHelper(){let t={longitudeField:this._longitudeField,latitudeField:this._latitudeField,dataToPosition:this.dataToPosition.bind(this),dataToLongitude:this.dataToLongitude.bind(this),dataToLatitude:this.dataToLatitude.bind(this),shape:this.shape.bind(this),getCoordinateId:()=>this.id};this._regions.forEach(e=>{e.getSeries().forEach(i=>{i.type===F.map||i.type===F.pictogram?i.setCoordinateHelper(t):(i.setXAxisHelper(Object.assign(Object.assign({},t),{isContinuous:!0,dataToPosition:(s,n)=>{var o;let a=s[0];if(T(a)&&n?.datum){let l=n.datum[i.getDimensionField()[0]];a=(o=this._centerCache.get(l))===null||o===void 0?void 0:o.x}return this.dataToLongitude(a)},valueToPosition:(s,n)=>{var o;if(T(s)&&n?.datum){let a=n.datum[i.getDimensionField()[0]];s=(o=this._centerCache.get(a))===null||o===void 0?void 0:o.x}return this.dataToLongitude(s)},getFields:()=>[this._longitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})),i.setYAxisHelper(Object.assign(Object.assign({},t),{isContinuous:!0,dataToPosition:(s,n)=>{var o;let a=s[0];if(T(a)&&n?.datum){let l=n.datum[i.getDimensionField()[0]];a=(o=this._centerCache.get(l))===null||o===void 0?void 0:o.y}return this.dataToLatitude(a)},valueToPosition:(s,n)=>{var o;if(T(s)&&n?.datum){let a=n.datum[i.getDimensionField()[0]];s=(o=this._centerCache.get(a))===null||o===void 0?void 0:o.y}return this.dataToLatitude(s)},getFields:()=>[this._latitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})))})})}onLayoutEnd(t){this.setLayoutRect(this._regions[0].getLayoutRect()),this.setLayoutStartPosition(this._regions[0].getLayoutStartPoint());let{width:e,height:i}=this.getLayoutRect(),{translate:s,scale:n,center:o}=this.evaluateProjection([0,0],[e,i]);s&&this._projection.translate(s),n&&this._projection.scale(n),o&&this._projection.center(o),be(this._regions,a=>{var l,h;if(a.type===F.map||a.type===F.pictogram){(l=a.areaPath)===null||l===void 0||l.clear();let d=(h=a.getRootMark().getProduct())===null||h===void 0?void 0:h.getGroupGraphicItem();d&&d.attribute.postMatrix&&d.setAttributes({postMatrix:new Kt})}}),this._actualScale=this._initialScale,super.onLayoutEnd(t)}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}collectFeatures(){let t=[];return this._regions.forEach(e=>{e.getSeries().forEach(i=>{var s,n;i.type!==F.map&&i.type!==F.pictogram||t.push(...(n=(s=i.getMapViewData())===null||s===void 0?void 0:s.latestData)!==null&&n!==void 0?n:[])})}),t}dataToPosition(t=[]){var e;let i=(e=this._projection)===null||e===void 0?void 0:e.project([t[0],t[1]]);return{x:i?.[0],y:i?.[1]}}dataToLatitude(t){var e;let i=(e=this._projection)===null||e===void 0?void 0:e.project([0,t]);return i?.[1]}dataToLongitude(t){var e;let i=(e=this._projection)===null||e===void 0?void 0:e.project([t,0]);return i?.[0]}zoom(t,e=[0,0]){var i,s,n,o,a,l;let h=(s=(i=this._projection)===null||i===void 0?void 0:i.scale())!==null&&s!==void 0?s:0,d=(o=(n=this._projection)===null||n===void 0?void 0:n.translate())!==null&&o!==void 0?o:[0,0],c=d[0],u=d[1];h*=t,c-=(e[0]-c)*(t-1),u-=(e[1]-u)*(t-1),(a=this._projection)===null||a===void 0||a.scale(h),(l=this._projection)===null||l===void 0||l.translate([c,u])}shape(t){return this._projection.shape(t)}invert(t){return this._projection.invert(t)}evaluateProjection(t,e){var i;let s=this._projection.evaluate(t,e,this.collectFeatures()),n=s.translate(),o=s.scale()*this._initialScale,a=(i=this._projectionSpec.center)!==null&&i!==void 0?i:s.invert([e[0]/2,e[1]/2]);return a&&(n=[e[0]/2,e[1]/2]),{translate:n,scale:o,center:a}}_initCenterCache(){this._centerCache||(this._centerCache=new Map),this._regions.forEach(t=>{t.getSeries().forEach(e=>{var i,s;e.type==="map"&&((s=(i=e.getMapViewData())===null||i===void 0?void 0:i.latestData)!==null&&s!==void 0?s:[]).forEach((n={})=>{let o=n[e.getDimensionField()[0]]||n[Zp],a=e.getDatumCenter(n);o&&A(a)&&this._centerCache.set(o,{x:a[0],y:a[1]})})})})}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reMake||(i.reMake=["roam","longitudeField","latitudeField","projection","zoomLimit"].some(s=>!Bt(e?.[s],t[s]))),i}release(){super.release(),this._centerCache&&this._centerCache.clear(),this._centerCache=null}};b0.type=W.geoCoordinate,Ct(b0,sh);var S0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"area",void 0,void 0,!1)}};var Qp=class r extends qp{constructor(){super(...arguments),this.type=F.map,this.transformerConstructor=S0,this._areaCache=new Map}getNameMap(){return this._nameMap}get areaPath(){return this._areaCache}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.map=this._spec.map,this._nameMap=this._spec.nameMap,this._nameField=this._spec.nameField,this._valueField=this._spec.valueField,this._spec.nameProperty&&(this._nameProperty=this._spec.nameProperty),this._spec.centroidProperty&&(this._centroidProperty=this._spec.centroidProperty),this.map||(t=this._option)===null||t===void 0||t.onError(`map type '${this.map}' is not specified !`),XA.get(this.map)||(e=this._option)===null||e===void 0||e.onError(`'${this.map}' data is not registered !`)}initData(){var t,e;super.initData(),nt(this._dataSet,"copyDataView",Il),nt(this._dataSet,"map",KG),nt(this._dataSet,"lookup",V1);let i=XA.get(this.map);i||(t=this._option)===null||t===void 0||t.onError("no valid map data found!");let s=new St(this._dataSet,{name:`map_${this.id}_data`});s.parse([i],{type:"dataview"}).transform({type:"copyDataView",options:{deep:!0},level:Ki.copyDataView}).transform({type:"map",options:{nameMap:this._nameMap,nameProperty:this._nameProperty}}).transform({type:"lookup",options:{from:()=>{var n;return(n=this._data)===null||n===void 0?void 0:n.getLatestData()},key:Zp,fields:this._nameField,set:(n,o)=>{o&&Object.keys(o).forEach(a=>{a in n||(n[a]=o[a])})}}}),(e=this._data)===null||e===void 0||e.getDataView().target.addListener("change",s.reRunAllTransform),this._mapViewData=new yi(this._option,s)}compileData(){var t;super.compileData(),(t=this._mapViewData)===null||t===void 0||t.compile()}initMark(){this._pathMark=this._createMark(r.mark.area,{groupKey:this.getDimensionField()[0],isSeriesMark:!0,skipBeforeLayouted:!0,dataView:this._mapViewData.getDataView(),dataProductId:this._mapViewData.getProductId()},{morph:vi(this._spec,r.mark.area.name),morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){let t=this._pathMark;t&&(this.setMarkStyle(t,{fill:e=>{var i,s,n,o;return A(e[(i=this._seriesField)!==null&&i!==void 0?i:ui])?((s=this._option.globalScale.getScale("color"))!==null&&s!==void 0?s:this._getDefaultColorScale()).scale(e[(n=this._seriesField)!==null&&n!==void 0?n:ui]):(o=this._spec)===null||o===void 0?void 0:o.defaultFillColor},path:this.getPath.bind(this)},"normal",X.Series),t.setPostProcess("fill",e=>A(e)?e:this._spec.defaultFillColor),this.setMarkStyle(t,{smoothScale:!0},"normal",X.Built_In))}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{text:e=>this.getDatumName(e),x:e=>{var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.x},y:e=>{var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.y}}))}initAnimation(){var t;this._pathMark.setAnimationConfig(_t((t=I.getAnimationInKey("fadeInOut"))===null||t===void 0?void 0:t(),xt("area",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new j1(this),this._pathMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pathMark)}getPath(t){var e;let i=this._areaCache.get(t[$e]);if(i)return i.shape;let s=(e=this._coordinateHelper)===null||e===void 0?void 0:e.shape(t);return this._areaCache.set(t[$e],{shape:s}),s}onEvaluateEnd(){this._mapViewData.updateData()}getDimensionField(){return[this.nameField]}getMeasureField(){return[this.valueField]}release(){super.release(),this._areaCache.clear(),this._nameMap={},this._mapViewData=null}handleZoom(t){var e,i,s;let{scale:n,scaleCenter:o}=t;if(n===1)return;let a=(e=this.getRootMark().getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem();a&&(a.attribute.postMatrix||a.setAttributes({postMatrix:new Kt}),a.scale(n,n,o));let l=(s=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||s===void 0?void 0:s.getProduct();l&&l.evaluate(null,null)}handlePan(t){var e,i,s;let{delta:n}=t;if(n[0]===0&&n[1]===0)return;let o=(e=this.getRootMark().getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem();o&&(o.attribute.postMatrix||o.setAttributes({postMatrix:new Kt}),o.translate(n[0],n[1]));let a=(s=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||s===void 0?void 0:s.getProduct();a&&a.evaluate(null,null)}getDatumCenter(t){var e,i,s,n;return this._centroidProperty&&(!((e=t.properties)===null||e===void 0)&&e[this._centroidProperty])?(i=t.properties)===null||i===void 0?void 0:i[this._centroidProperty]:K(t.centroidX*t.centroidY)?[t.centroidX,t.centroidY]:!((s=t.properties)===null||s===void 0)&&s.center?t.properties.center:!((n=t.properties)===null||n===void 0)&&n.centroid?t.properties.centroid:[Number.NaN,Number.NaN]}getDatumName(t){var e;if(t[this.nameField])return t[this.nameField];let i=(e=t.properties)===null||e===void 0?void 0:e[this._nameProperty];if(i){if(this._spec.nameMap&&this._spec.nameMap[i])return this._spec.nameMap[i];if(this._spec.showDefaultName||!this._spec.nameMap)return i}return""}dataToPositionX(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionY(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}viewDataUpdate(t){var e,i,s;super.viewDataUpdate(t),(i=(e=this._mapViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(s=this._mapViewData)===null||s===void 0||s.updateData()}_getDataIdKey(){return $e}getActiveMarks(){return[this._pathMark]}};Qp.type=F.map,Qp.mark=$G,Qp.transformerConstructor=S0;var tm=`${et}_waterfall_default_seriesField`;var qG=(r,t)=>{if(!r||r.length===0)return r;let{indexField:e,total:i,groupData:s}=t,n=[],{dimensionValues:o,dimensionData:a}=s().latestData,l=Array.from(o[e]),h={start:0,end:0,positive:0,negative:0,lastIndex:null};return l.forEach((d,c)=>{let u={start:h.end,end:h.end,lastIndex:h.lastIndex,lastEnd:h.end,index:d,isTotal:!1,positive:h.end,negative:h.end},p=t.stackInverse===!0?a[d].reverse():a[d];if(p?.forEach((m,g)=>{g===p.length-1?m[pa]=!0:delete m[pa]}),p.length>1){let m=g=>{if(i&&i.type!=="end"){if(i.type==="field"||i.type==="custom")return!!g[i.tagField]}else if(c===l.length-1)return!0;return!1};if(p.some(g=>m(g)))return h=Tq(p,d,u,n,h,l,c,t,m),void n.push(u)}h=ZG(p,d,u,n,h,l,c,t),n.push(u)}),n};function Tq(r,t,e,i,s,n,o,a,l){e.isTotal=!0;let{valueField:h,startAs:d,endAs:c,total:u}=a,p=[],m=[];if(r.forEach(b=>{l(b)?m.push(b):p.push(b)}),m.length===r.length){let b=ZG([r[0]],t,e,i,s,n,o,a);return m.forEach(S=>{S[d]=r[0][d],S[c]=r[0][c],S[h]=r[0][h]}),b}let g=m[0],{start:f,end:_}=JG(g,e,i,s,u);e.start=f,e.end=_;let v=f,x=f,y=_-f;return p.forEach(b=>{let S=+b[h];S>=0?(b[d]=+v,v=Rs(v,S)):(b[d]=+x,x=Rs(x,S)),b[c]=Rs(b[d],S),f=Rs(f,S),y=gh(y,S)}),m.forEach(b=>{b[d]=+f,b[c]=Rs(b[d],y),b[h]=y}),Object.assign(Object.assign({},e),{lastIndex:t})}function ZG(r,t,e,i,s,n,o,a){let{valueField:l,startAs:h,endAs:d,total:c,seriesField:u,seriesFieldName:p}=a;return r.forEach(m=>{let g=!1;if(c&&c.type!=="end"){if((c.type==="field"||c.type==="custom")&&m[c.tagField]){g=!0;let{start:f,end:_}=JG(m,e,i,s,c);m[h]=f,m[d]=_,m[l]=_-f,e.start=f,e.end=_}}else o===n.length-1&&(e.start=0,m[h]=e.start,m[d]=e.end,g=!0);if(!g){let f=+m[l];f>=0?(m[h]=+e.positive,e.positive=Rs(e.positive,f)):(m[h]=+e.negative,e.negative=Rs(e.negative,f)),m[d]=Rs(m[h],f),e.end=Rs(e.end,f)}e.isTotal=g,(T(u)||u===tm)&&(m[tm]=g?p.total:+m[l]>=0?p.increase:p.decrease)}),Object.assign(Object.assign({},e),{lastIndex:t})}function JG(r,t,e,i,s){return s&&s.type!=="end"?s.type==="field"||s.type==="custom"?s.type==="custom"?Mq(r,i,s):s.collectCountField&&!T(r[s.collectCountField])?Dq(r,e,t,s):Eq(r,t,s):{start:0,end:0}:kq(t)}function kq(r){return{start:0,end:r.end}}function Mq(r,t,e){return e.product(r,t)}function Dq(r,t,e,i){let s=0,n=e.end,o=t.length-+r[i.collectCountField],a=t.length-1;return o<0?ji("total.collectCountField error"):s=t[o].start,a<0?ji("total.collectCountField error"):n=t[a].end,{start:s,end:n}}function Eq(r,t,e){let i=0,s=t.end;return e.startField&&!T(r[e.startField])&&(i=+r[e.startField]),e.valueField&&!T(r[e.valueField])&&(s=Rs(i,+r[e.valueField])),{start:i,end:s}}var QG=(r,t)=>{if(!r)return r;let{indexField:e,valueField:i,total:s,seriesField:n}=t,o={[e]:s?.text||"total",[i]:r.reduce((a,l)=>Rs(a,+l[i]),0)};return n&&(o[n]="total"),r.push(o),r};var tU=Object.assign(Object.assign({},Dp),{leaderLine:{name:"leaderLine",type:"rule"},stackLabel:{name:"stackLabel",type:"text"}});var eU=(r,t)=>{if(!t.fields)return r;let e={};return{dimensionValues:e,dimensionData:iU(r.map(i=>i.latestData).flat(),t.fields,e)}};function iU(r,t,e){if(t.length===0)return r;let i=t[0],s=t.slice(1);e[i]=new Set;let n=wq(r,i,e[i]);return s.length?Pq(n,(o,a)=>iU(o,s,e)):n}function wq(r,t,e){let i={};return r.forEach(s=>{let n=s[t];i[n]||(i[n]=[],e.add(n)),i[n].push(s)}),i}function Pq(r,t){return Object.keys(r).reduce((e,i)=>(e[i]=t(r[i],i),e),{})}var G1=class{get fields(){return this._fields}get groupData(){return this._groupData}constructor(t){this._fields=[],this._fields=t}initData(t,e){let i=t.name,s=new St(e instanceof Ar?e:t.dataSet);s.name=i,s.parse([t],{type:"dataview"}),nt(e,"dimensionTree",eU),s.transform({type:"dimensionTree",options:{fields:this._fields}},!1),s.target.addListener("change",this.groupDataUpdate.bind(this)),this._groupData=s}groupDataUpdate(){}getGroupValueInField(t){var e,i,s;let n=(s=(i=(e=this.groupData)===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.dimensionValues)===null||s===void 0?void 0:s[t];return n?Array.from(n):[]}};var A0=class extends cs{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar"),this._addMarkLabelSpec(t,"bar","stackLabel","initStackLabelMarkStyle")}};var rU={rect:sU,symbol:lU,arc:nU,point:Iq,"line-data":Rq,stackLabel:Ow,line:oU,area:oU,rect3d:sU,arc3d:nU,treemap:Hq,venn:Nq};function aU(r,t){var e;let{labelSpec:i}=t;i.overlap&&!ct(i.overlap)&&(i.overlap={});let s=(e=rU[r])!==null&&e!==void 0?e:rU.point;return t.series.type===F.sankey?Vq(t):s(t)}function C0(r,t,e,i){var s;let{labelMark:n,series:o}=r,a={text:t[o.getMeasureField()[0]],data:t,textType:(s=r.labelSpec.textType)!==null&&s!==void 0?s:"text"},l=Object.keys(n.stateStyle.normal);for(let h of l){let d=n.getAttribute(h,t);a[h]=d}if(o.type!==F.sankey){let{formatFunc:h,args:d}=_r(e,i,a.text,t);h&&(a._originText=a.text,a.text=h(...d,{series:o}))}return a}function U1(r){return V(r)?t=>r(t.data):r}function lU(r){var t,e,i;let{series:s,labelSpec:n}=r,o=s.direction==="horizontal"?"right":"top",a=(t=U1(n.position))!==null&&t!==void 0?t:o,l;return l=n.overlap!==!1&&{strategy:(i=(e=n.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:Bq(),avoidBaseMark:a!=="center"},{position:a,overlap:l}}function Rq(r){let t=lU(r);return te(t.overlap)||(t.overlap.avoidBaseMark=!1),t}function Bq(){return[{type:"position",position:["top","bottom","right","left","top-right","top-left","bottom-left","bottom-right"]}]}function sU(r){var t,e,i,s,n,o;let{series:a,labelSpec:l={}}=r,h=(t=U1(l.position))!==null&&t!==void 0?t:"outside",d=(e=a.direction)!==null&&e!==void 0?e:"vertical",c=a.direction==="horizontal"?(i=a.getXAxisHelper())===null||i===void 0?void 0:i.isInverse():(s=a.getYAxisHelper())===null||s===void 0?void 0:s.isInverse(),u,p=h;p=g=>{var f;let{data:_}=g,v=(f=typeof l.position=="function"?l.position(_):l.position)!==null&&f!==void 0?f:"outside";if(v==="outside"){let x=a.getMeasureField()[0],y={vertical:["top","bottom"],horizontal:["right","left"]},b=_?.[x]>=0&&c||_?.[x]<0&&!c?1:0;return y[d][b]}return v},u=l.overlap!==!1&&{strategy:(o=(n=l.overlap)===null||n===void 0?void 0:n.strategy)!==null&&o!==void 0?o:Lq(a)};let m=!1;return Z(h)&&h.includes("inside")&&(m=!0),{position:p,overlap:u,smartInvert:m}}function Lq(r){return[{type:"position",position:t=>{var e,i;let{data:s}=t,n=r.getMeasureField()[0];return(r.direction==="horizontal"?!((e=r.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=r.getYAxisHelper())===null||i===void 0)&&i.isInverse())?s?.[n]>=0?r.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]:r.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:s?.[n]>=0?r.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:r.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]}}]}function Iq(r){let{labelSpec:t}=r,e;return e=t.overlap!==!1&&{avoidBaseMark:!1},{position:"center",overlap:e}}function nU(r){var t;let{labelSpec:e}=r,i=(t=U1(e.position))!==null&&t!==void 0?t:"outside",s=i,n;return n=e.smartInvert?e.smartInvert:Z(i)&&i.includes("inside"),{position:s,smartInvert:n}}function Fq(r,t,e,i){return t.direction==="horizontal"?e==="middle"?.5*(t.totalPositionX(r,"end")+t.totalPositionY(r,"start")):e==="max"?t.totalPositionX(r,r.end>=r.start?"end":"start")+i:e==="min"?t.totalPositionX(r,r.end>=r.start?"start":"end")-i:t.totalPositionX(r,"end")+(r.end>=r.start?i:-i):t.totalPositionX(r,"index",.5)}function Oq(r,t,e,i){return t.direction==="horizontal"?t.totalPositionY(r,"index",.5):e==="middle"?.5*(t.totalPositionY(r,"end")+t.totalPositionY(r,"start")):e==="max"?t.totalPositionY(r,r.end>=r.start?"end":"start")-i:e==="min"?t.totalPositionY(r,r.end>=r.start?"start":"end")+i:t.totalPositionY(r,"end")+(r.end>=r.start?-i:i)}function Ow(r,t,e){let i=r.series,s=r.labelSpec||{},n=i.getTotalData();return{customLayoutFunc:o=>o.map(a=>{let l=s.position||"withChange",h=s.offset||0,d=t?t(a.data):a.data,c=C0(r,d,s.formatMethod);return c.x=Fq(d,i,l,h),c.y=Oq(d,i,l,h),i.direction==="horizontal"?c.textAlign=l==="middle"?"center":l==="withChange"&&d.end-d.start>=0||l==="max"?"left":"right":c.textBaseline=l==="middle"?l:l==="withChange"&&d.end-d.start>=0||l==="max"?"bottom":"top",e?.(a,d,c),zs(Object.assign(Object.assign({},c),{id:a.id}))}),dataFilter:o=>{let a=[];return n.forEach(l=>{let h=o.find(d=>{var c;return l.index===((c=d.data)===null||c===void 0?void 0:c[i.getDimensionField()[0]])});h&&(h.data=l,a.push(h))}),a},overlap:{strategy:[]}}}function Hq(r){return{customLayoutFunc:(t,e)=>e,overlap:!1}}function Nq(r){return{customLayoutFunc:(t,e)=>e,smartInvert:!0}}function oU(r){var t,e,i,s;let{labelSpec:n,series:o}=r,a=(i=(e=(t=o.getViewDataStatistics)===null||t===void 0?void 0:t.call(o).latestData)===null||e===void 0?void 0:e[o.getSeriesField()])===null||i===void 0?void 0:i.values,l=a?a.map((h,d)=>({[o.getSeriesField()]:h,index:d})):[{index:0,[ui]:o.getSeriesKeys()[0]}];return{position:(s=n.position)!==null&&s!==void 0?s:"end",data:l}}function Vq(r){var t,e,i;let{series:s,labelSpec:n={}}=r,o=(t=U1(n.position))!==null&&t!==void 0?t:"outside",a=s.direction,l,h=o;return Z(o)&&(a==="vertical"?h=o==="inside-start"?d=>"inside-left":o==="inside-middle"?d=>"center":o==="inside-end"?d=>"inside-right":d=>"bottom":o==="inside-start"?h=d=>"inside-left":o==="inside-middle"?h=d=>"center":o==="inside-end"?h=d=>"inside-right":o==="outside"&&(h=d=>"right")),l=n.overlap!==!1&&(!Z(o)||!o.includes("inside"))&&{strategy:(i=(e=n.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:jq(s)},{position:h,overlap:l,smartInvert:!1,offset:0,syncState:!0}}function jq(r){return[{type:"position",position:t=>r.direction==="horizontal"?["right","left"]:["bottom","top"]}]}var em=class r extends wr{constructor(){super(...arguments),this.type=F.waterfall,this.transformerConstructor=A0,this._leaderLineMark=null,this._stackLabelMark=null,this._labelMark=null}getTotalData(){var t;return(t=this._totalData)===null||t===void 0?void 0:t.getLatestData()}initGroups(){let t=this.getGroupFields();t&&t.length&&(this._groups=new G1(t),this._data&&this._groups.initData(this._data.getDataView(),this._dataSet))}setAttrFromSpec(){super.setAttrFromSpec(),this.setValueFieldToStack(),this._fieldX=[this._fieldX[0]],this._fieldY=[this._fieldY[0]],T(this._seriesField)&&(this._seriesField=tm)}getSeriesKeys(){return this._seriesField===tm?[this._theme.seriesFieldName.increase,this._theme.seriesFieldName.decrease,this._theme.seriesFieldName.total]:super.getSeriesKeys()}initData(){var t;super.initData(),nt(this._dataSet,"waterfallFillTotal",QG),nt(this._dataSet,"waterfall",qG),(T(this._spec.total)||this._spec.total.type==="end")&&((t=this._rawData)===null||t===void 0||t.transform({type:"waterfallFillTotal",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,total:this._spec.total,stackInverse:this.getRegion().getStackInverse()}},!1));let e=H_(this.getViewData(),this._dataSet,{name:`${et}_series_${this.id}_totalData`});this.getViewData().target.removeListener("change",e.reRunAllTransform),this._totalData=new yi(this._option,e),e.transform({type:"waterfall",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,startAs:zi,endAs:pi,total:this._spec.total,groupData:()=>this.getGroups().groupData,stackInverse:this.getRegion().getStackInverse()}},!1)}compileData(){var t;super.compileData(),(t=this._totalData)===null||t===void 0||t.compile()}initAnimation(){var t,e,i,s;let n={yField:this.direction==="horizontal"?this._fieldY[0]:this.getStackValueField(),xField:this.direction==="horizontal"?this.getStackValueField():this._fieldX[0],direction:this.direction,growFrom:()=>{var l,h;return this.direction==="horizontal"?(l=this._xAxisHelper)===null||l===void 0?void 0:l.getScale(0).scale(0):(h=this._yAxisHelper)===null||h===void 0?void 0:h.getScale(0).scale(0)}},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset,a=Er(this);this._barMark.setAnimationConfig(_t((i=I.getAnimationInKey("waterfall"))===null||i===void 0?void 0:i(n,o),xt("bar",this._spec,this._markAttributeContext),a)),this._leaderLineMark&&this._leaderLineMark.setAnimationConfig(_t((s=I.getAnimationInKey("fadeInOut"))===null||s===void 0?void 0:s(),xt("leaderLine",this._spec,this._markAttributeContext)))}viewDataUpdate(t){this._totalData.getDataView().reRunAllTransform(),this._totalData.updateData(),super.viewDataUpdate(t)}addViewDataFilter(t){}reFilterViewData(){}onEvaluateEnd(t){super.onEvaluateEnd(t),this._totalData.updateData()}initMark(){var t,e;super.initMark();let i=this._createMark(r.mark.leaderLine,{key:"index",stateSort:(t=this._spec.leaderLine)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.leaderLine)===null||e===void 0?void 0:e.customShape});i&&(this._leaderLineMark=i,i.setDataView(this._totalData.getDataView(),this._totalData.getProductId()))}initLabelMarkStyle(t){var e;if(t)return!this._labelMark&&(!((e=this._spec.label)===null||e===void 0)&&e.visible)?(super.initLabelMarkStyle(t),void(this._labelMark=t)):void 0}initStackLabelMarkStyle(t){t&&(this._stackLabelMark=t,t.skipEncode=!0,t.setRule("stackLabel"),t.setDataView(this._totalData.getDataView(),this._totalData.getProductId()),this.setMarkStyle(t,{text:e=>{var i;return((i=this._spec.stackLabel)===null||i===void 0?void 0:i.valueType)==="absolute"?e.end:gh(e.end,e.start)}}))}initTotalLabelMarkStyle(t){this.setMarkStyle(t,{text:e=>{var i;return"end"in e?((i=this._spec.totalLabel)===null||i===void 0?void 0:i.valueType)==="absolute"?e.end:gh(e.end,e.start):this.direction==="horizontal"?e[this._fieldX[0]]:e[this._fieldY[0]]}})}getTotalLabelComponentStyle(t){return Ow(Object.assign(Object.assign({},t),{series:this,labelSpec:this._spec.totalLabel}),e=>{let i=this.direction==="vertical"?e[this._fieldX[0]]:e[this._fieldY[0]];return this._totalData.getLatestData().find(s=>s.index===i)})}totalPositionX(t,e,i=.5){let{dataToPosition:s,getBandwidth:n}=this._xAxisHelper;return this._direction==="horizontal"?Qt(s([t[e]],{bandPosition:this._bandPosition})):s([t[e]],{bandPosition:this._bandPosition})+.5*n(0)-this._barMark.getAttribute("width",t)*(.5-i)}totalPositionY(t,e,i=.5){let{dataToPosition:s,getBandwidth:n}=this._yAxisHelper;return this._direction==="horizontal"?s([t[e]],{bandPosition:this._bandPosition})+.5*n(0)-this._barMark.getAttribute("height",t)*(.5-i):Qt(s([t[e]],{bandPosition:this._bandPosition}))}initMarkStyle(){super.initMarkStyle(),this._leaderLineMark&&(this._direction==="horizontal"?this.setMarkStyle(this._leaderLineMark,{visible:t=>this.isVisibleLeaderLine(t),x:t=>this.totalPositionX(t,"lastEnd",0),x1:t=>this.totalPositionX(t,t.isTotal?"end":"start",0),y:t=>t.lastIndex?this.totalPositionY(t,"lastIndex",1):0,y1:t=>this.totalPositionY(t,"index",0)},"normal",X.Series):this.setMarkStyle(this._leaderLineMark,{visible:t=>this.isVisibleLeaderLine(t),x:t=>t.lastIndex?this.totalPositionX(t,"lastIndex",1):0,x1:t=>this.totalPositionX(t,"index",0),y:t=>this.totalPositionY(t,"lastEnd",0),y1:t=>this.totalPositionY(t,t.isTotal?"end":"start",0)},"normal",X.Series))}isVisibleLeaderLine(t){return!T(t.lastIndex)&&OH([t.lastEnd,t[t.isTotal?"end":"start"]],this.direction==="horizontal"?this._xAxisHelper.getScale(0):this._yAxisHelper.getScale(0))}};em.type=F.waterfall,em.mark=tU,em.transformerConstructor=A0;function hU(r,t,e,i,s,n,o,a,l){r.setMarkStyle(t,{textAlign:h=>{if(l()==="vertical")return"center";let d=s(h),c=n(h);if(e==="middle")return"center";if(d>=c){if(e==="start")return"left";if(e==="end")return"right";if(e==="outside")return"left"}else{if(e==="start")return"right";if(e==="end")return"left";if(e==="outside")return"right"}return"center"},textBaseline:h=>{if(l()==="horizontal")return"middle";let d=o(h),c=a(h);if(e==="middle")return"middle";if(c>=d){if(e==="start")return"bottom";if(e==="end")return"top";if(e==="outside")return"bottom"}else{if(e==="start")return"top";if(e==="end")return"bottom";if(e==="outside")return"top"}return"middle"}}),r.setMarkStyle(t,{x:h=>{let d=l(),c=s(h),u=n(h);if(d==="vertical"||e==="middle")return(c+u)/2;if(c>=u){if(e==="start")return u+i;if(e==="end")return c-i;if(e==="outside")return c+i}else{if(e==="start")return u-i;if(e==="end")return c+i;if(e==="outside")return c-i}return(c+u)/2},y:h=>{let d=l(),c=o(h),u=a(h);if(d==="horizontal"||e==="middle")return(c+u)/2;if(c>=u){if(e==="start")return u+i;if(e==="end")return c-i;if(e==="outside")return c+i}else{if(e==="start")return u-i;if(e==="end")return c+i;if(e==="outside")return c-i}return(c+u)/2}},"normal",X.Series)}var W1=class extends he{constructor(){super(...arguments),this._getMeasureData=t=>this.series.getSpec().direction==="horizontal"?t[this.series.getSpec().xField[0]]+"-"+t[this.series.getSpec().xField[1]]:t[this.series.getSpec().yField[0]]+"-"+t[this.series.getSpec().yField[1]]}};var dU=Object.assign(Object.assign({},Dp),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}}),cU=Object.assign(Object.assign({},T1),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}});var T0=class extends cs{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){var e;((e=t.label)===null||e===void 0?void 0:e.position)!=="bothEnd"&&this._addMarkLabelSpec(t,"bar")}};var nh=class r extends wr{constructor(){super(...arguments),this.type=F.rangeColumn,this._barMarkType="rect",this._barName=F.bar,this.transformerConstructor=T0}initMark(){var t,e,i,s,n,o,a,l,h,d;this._initBarBackgroundMark();let c=(t=this._spec.label)===null||t===void 0?void 0:t.position;this._barMark=this._createMark(r.mark.bar,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.bar)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.bar)===null||i===void 0?void 0:i.customShape,morph:vi(this._spec,r.mark.bar.name),morphElementKey:this.getDimensionField()[0]}),((s=this._spec.label)===null||s===void 0?void 0:s.visible)!==!1&&c==="bothEnd"&&(((o=(n=this._spec.label)===null||n===void 0?void 0:n.minLabel)===null||o===void 0?void 0:o.visible)!==!1&&(this._minLabelMark=this._createMark(r.mark.minLabel,{markSpec:(a=this._spec.label)===null||a===void 0?void 0:a.minLabel})),((h=(l=this._spec.label)===null||l===void 0?void 0:l.maxLabel)===null||h===void 0?void 0:h.visible)!==!1&&(this._maxLabelMark=this._createMark(r.mark.maxLabel,{markSpec:(d=this._spec.label)===null||d===void 0?void 0:d.maxLabel})))}initMarkStyle(){var t,e;super.initMarkStyle(),this._initLabelMarkPos(this._minLabelMark,(t=this._spec.label)===null||t===void 0?void 0:t.minLabel,0,"end"),this._initLabelMarkPos(this._maxLabelMark,(e=this._spec.label)===null||e===void 0?void 0:e.maxLabel,1,"start")}_initLabelMarkPos(t,e,i,s){var n,o,a,l;if(t){this.setMarkStyle(t,{fill:(o=(n=e?.style)===null||n===void 0?void 0:n.fill)!==null&&o!==void 0?o:this.getColorAttribute(),text:c=>{let u=this._spec.direction==="horizontal"?c[this._spec.xField[i]]:c[this._spec.yField[i]];return e?.formatMethod?e.formatMethod(u,c):u}});let h=(a=e?.position)!==null&&a!==void 0?a:s,d=(l=e?.offset)!==null&&l!==void 0?l:this._direction==="vertical"?-20:-25;hU(this,t,h,d,c=>this._barMark.getAttribute("x",c),c=>this._direction==="vertical"?this._barMark.getAttribute("x",c)+this._barMark.getAttribute("width",c):this._barMark.getAttribute("x1",c),c=>this._barMark.getAttribute("y",c),c=>this._direction==="vertical"?this._barMark.getAttribute("y1",c):this._barMark.getAttribute("y",c)+this._barMark.getAttribute("height",c),()=>this._direction)}}initLabelMarkStyle(t){t&&(this.setMarkStyle(t,{text:e=>{let i,s;return this._spec.direction==="horizontal"?(i=e[this._spec.xField[0]],s=e[this._spec.xField[1]]):(i=e[this._spec.yField[0]],s=e[this._spec.yField[1]]),i+"-"+s},z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._labelMark=t)}_dataToPosX(t){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.xField[0]),{bandPosition:this._bandPosition})}_dataToPosX1(t){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.xField[1]),{bandPosition:this._bandPosition})}_dataToPosY(t){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.yField[0]),{bandPosition:this._bandPosition})}_dataToPosY1(t){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.yField[1]),{bandPosition:this._bandPosition})}initAnimation(){var t,e,i,s,n;let o=Er(this),a=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._barMark.setAnimationConfig(_t((i=I.getAnimationInKey("rangeColumn"))===null||i===void 0?void 0:i({direction:this.direction},a),xt("bar",this._spec,this._markAttributeContext),o)),this._minLabelMark&&this._minLabelMark.setAnimationConfig(_t((s=I.getAnimationInKey("fadeInOut"))===null||s===void 0?void 0:s(),xt("label",this._spec,this._markAttributeContext),o)),this._maxLabelMark&&this._maxLabelMark.setAnimationConfig(_t((n=I.getAnimationInKey("fadeInOut"))===null||n===void 0?void 0:n(),xt("label",this._spec,this._markAttributeContext),o))}initTooltip(){this._tooltipHelper=new W1(this),this._barMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._barMark),this._minLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._minLabelMark),this._maxLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._maxLabelMark),this._labelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._labelMark)}};nh.type=F.rangeColumn,nh.mark=dU,nh.transformerConstructor=T0;var k0=class extends nh{constructor(){super(...arguments),this.type=F.rangeColumn3d,this._barMarkType="rect3d",this._barName=F.bar3d}};k0.type=F.rangeColumn3d,k0.mark=cU;var Y1=class extends he{constructor(){super(...arguments),this._getMeasureData=t=>this.series.getSpec().direction==="horizontal"?t[this.series.getSpec().xField[0]]+"-"+t[this.series.getSpec().xField[1]]:t[this.series.getSpec().yField[0]]+"-"+t[this.series.getSpec().yField[1]]}};var uU=Object.assign({},_1);var M0=class r extends Sa{constructor(){super(...arguments),this.type=F.rangeArea}initMark(){var t;let{customShape:e,stateSort:i}=(t=this._spec.area)!==null&&t!==void 0?t:{};this._areaMark=this._createMark(r.mark.area,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:i},{setCustomizedShape:e,morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){this.initAreaMarkStyle()}initAreaMarkStyle(){let t=this._areaMark;t&&(super.initAreaMarkStyle(),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x1:e=>{if(!this._xAxisHelper)return Number.NaN;let{dataToPosition:i}=this._xAxisHelper;return i(this.getDatumPositionValues(e,this._spec.xField[1]),{bandPosition:this._bandPosition})}},"normal",X.Series):this.setMarkStyle(this._areaMark,{y1:e=>{if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:i}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._spec.yField[1]),{bandPosition:this._bandPosition})}},"normal",X.Series),this.setMarkStyle(t,{stroke:!1},"normal",X.Series))}initTooltip(){this._tooltipHelper=new Y1(this)}_isFieldAllValid(){let t=this.getViewDataStatistics(),e=this.fieldY;return!!(t&&t.latestData&&e.length)&&e.every(i=>t.latestData[i]&&t.latestData[i].allValid)}};M0.type=F.rangeArea,M0.mark=uU;function X1(r){return yn(r)?Number.parseFloat(r):0}var pU=(r,t)=>{let{asStartAngle:e,asEndAngle:i,asMiddleAngle:s,asRadian:n,asRatio:o,asQuadrant:a,asK:l,showAllZero:h,supportNegative:d,showEmptyCircle:c}=t,u=t.angleField(),p=t.startAngle(),m=t.endAngle(),g=t.minAngle(),f=r.map(D=>Object.assign({},D));if(!f||f.length===0||!h&&c&&Hw(f,u,d))return f;let _=(D,P,B)=>{D[e]=P,D[i]=P+B,D[s]=P+B/2,D[n]=B,D[a]=zv(P+B/2)},v=0,x=-1/0,y=!0;for(let D=0;D<f.length;D++){let P=d?Math.abs(X1(f[D][u])):X1(f[D][u]);v+=P,x=Math.max(P,x),y&&P!==0&&(y=!1),f[D][nA]=P}let b=f.map(D=>Number(D[u])),S=m-p,C=p,k=S,M=0,E=EH(b);if(f.forEach((D,P)=>{let B=D[nA],L=v?B/v:0,w=L*S;w<g?(w=g,k-=g):M+=B;let R=C,N=C+w;D[o]=L,D[l]=x?B/x:0,D._percent_=E[P],_(D,R,w),C=N}),k<S)if(k<=.001){let D=S/f.length;f.forEach((P,B)=>{_(P,p+B*D,D)})}else{let D=k/M;C=p,f.forEach(P=>{let B=P[n]===g?g:P[nA]*D;_(P,C,B),C+=B})}if(v!==0&&(f[f.length-1][i]=m),y&&h){let D=S/f.length;f.forEach((P,B)=>{_(P,p+B*D,D)})}return f},Hw=(r,t,e)=>!!T(r)||r.length===0||!!r.every(i=>X1(i[t])===0)||!e&&r.reduce((i,s)=>i+X1(s[t]),0)===0;function mU(r,t){var e,i,s,n;let o=(i=(e=t.options)===null||e===void 0?void 0:e.distance)!==null&&i!==void 0?i:10,a=K(t.duration)?t.duration/2:1e3,l=(s=t.options.easing)!==null&&s!==void 0?s:"cubicOut";return{oneByOne:t.oneByOne,loop:(n=t.loop)!==null&&n!==void 0&&n,timeSlices:[{duration:a,effects:{easing:l,channel:{x:{from:h=>r.getAttribute("x",h),to:h=>r.getAttribute("x",h)+oe({x:0,y:0},o,h[Mn]).x},y:{from:h=>r.getAttribute("y",h),to:h=>r.getAttribute("y",h)+oe({x:0,y:0},o,h[Mn]).y}}}},{duration:a,effects:{easing:l,channel:{x:{to:h=>r.getAttribute("x",h),from:h=>r.getAttribute("x",h)+oe({x:0,y:0},o,h[Mn]).x},y:{to:h=>r.getAttribute("y",h),from:h=>r.getAttribute("y",h)+oe({x:0,y:0},o,h[Mn]).y}}}}]}}var gU=Object.assign(Object.assign({},Ft),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}}),fU=Object.assign(Object.assign({},Ft),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});var Vd=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie")}_mergeThemeToSpec(t,e){let i=this._theme,s=t;if(this._shouldMergeThemeToSpec()){let n=this._getDefaultSpecFromChart(e);s=ot({},this._theme,n,t);let o=(a,l)=>ot({},a==="inside"||a==="inside-center"?this._theme.innerLabel:this._theme.outerLabel,l);H(s.label)?s.label=s.label.map(a=>o(a.position,a)):s.label=o(s.label.position,s.label)}return{spec:s,theme:i}}_getDefaultSpecFromChart(t){var e;let i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{centerX:s,centerY:n}=t;return A(s)&&(i.centerX=s),A(n)&&(i.centerY=n),Object.keys(i).length>0?i:void 0}};var tDe=`${et}_LABEL_LIMIT`,eDe=`${et}_LABEL_ALIGN`,iDe=`${et}_LABEL_TEXT`,_U=`${et}_LABEL_VISIBLE`,rDe=`${et}_LABEL_X`,sDe=`${et}_LABEL_Y`;var jd=class r extends ks{constructor(){super(...arguments),this.transformerConstructor=Vd,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var t,e;let i=this._region.getLayoutRect();return{x:We((t=this._spec)===null||t===void 0?void 0:t.centerX,i.width,i,i.width/2),y:We((e=this._spec)===null||e===void 0?void 0:e.centerY,i.height,i,i.height/2)}},this._startAngle=kl,this._endAngle=Uu,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=t=>{let e=t[Mn];if(T(e))return null;let i=this.computeDatumRadius(t),s=this.computeDatumInnerRadius(t),n=this.computeCenter(t);return oe(n,(i+s)/2,e)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}setAttrFromSpec(){var t,e,i,s,n,o;super.setAttrFromSpec(),this._centerOffset=(t=this._spec.centerOffset)!==null&&t!==void 0?t:0,this._cornerRadius=(e=this._spec.cornerRadius)!==null&&e!==void 0?e:0;let a=AH(A(this._spec.startAngle)?Ut(this._spec.startAngle):this._startAngle,A(this._spec.endAngle)?Ut(this._spec.endAngle):this._endAngle);this._startAngle=a.startAngle,this._endAngle=a.endAngle,this._padAngle=A(this._spec.padAngle)?Ut(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(s=(i=this._spec.emptyPlaceholder)===null||i===void 0?void 0:i.showEmptyCircle)!==null&&s!==void 0&&s,this._showAllZero=(n=this._spec.showAllZero)!==null&&n!==void 0&&n,this._supportNegative=(o=this._spec.supportNegative)!==null&&o!==void 0&&o}initData(){super.initData();let t=this.getViewData();if(!t)return;nt(this._dataSet,"pie",pU),t.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>A(this._spec.minAngle)?Ut(this._spec.minAngle):0,asStartAngle:yE,asEndAngle:xE,asRatio:hN,asMiddleAngle:Mn,asRadian:uN,asQuadrant:cN,asK:dN,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);let e=new St(this._dataSet,{name:`${et}_series_${this.id}_viewDataLabel`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new yi(this._option,e)}compileData(){var t;super.compileData(),(t=this._viewDataLabel)===null||t===void 0||t.compile()}initMark(){var t,e;this._pieMark=this._createMark(Object.assign(Object.assign({},r.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:ki,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:(t=this._spec.pie)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.pie)===null||e===void 0?void 0:e.customShape,morph:vi(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1}))}startAngleScale(t){return zu(yE)(t)}endAngleScale(t){return zu(xE)(t)}_computeLayoutRadius(){return F1(()=>this._spec.layoutRadius,this.getLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}initMarkStyle(){let t={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:_E(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:_E(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:s=>this.startAngleScale(s),endAngle:s=>this.endAngleScale(s),padAngle:this._padAngle,centerOffset:this._centerOffset},e=this._pieMark;e&&this.setMarkStyle(e,t,"normal",X.Series);let i=this._emptyArcMark;i&&this.setMarkStyle(i,Object.assign(Object.assign({},t),{visible:()=>{let s=this.getAngleField()[0];return Hw(this.getViewData().latestData,s,this._supportNegative)}}),"normal",X.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t.name===this._pieMarkName){let s=this.getSpec()[t.name];if(s)for(let n in s.state||{})this.setMarkStyle(t,this.generateRadiusStyle(s.state[n]),n,X.User_Mark)}t.name==="emptyCircle"&&this.setMarkStyle(t,this.generateRadiusStyle(e.style),"normal",X.User_Mark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{visible:zu(_U).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var t;super.initEvent(),(t=this._viewDataLabel.getDataView())===null||t===void 0||t.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(t){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(t)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(rt.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(t){if(!t)return;let e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),t.cornerRadius&&(e.cornerRadius=()=>this._computeLayoutRadius()*t.cornerRadius),e}computeCenter(t){return{x:this._pieMark.getAttribute("x",t,"normal"),y:this._pieMark.getAttribute("y",t,"normal")}}getRadius(t="normal"){var e,i,s,n,o,a,l;let h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.outerRadius:(l=(a=(o=this.getSpec()[((n=this._pieMark)===null||n===void 0?void 0:n.name)||"pie"])===null||o===void 0?void 0:o.state)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l.outerRadius;return h??this._outerRadius}getInnerRadius(t="normal"){var e,i,s,n,o,a,l;let h=t==="normal"?(s=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.innerRadius:(l=(a=(o=this.getSpec()[((n=this._pieMark)===null||n===void 0?void 0:n.name)||"pie"])===null||o===void 0?void 0:o.state)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l.innerRadius;return h??this._innerRadius}computeRadius(t,e){return this._computeLayoutRadius()*t*(T(e)?1:e)+this._centerOffset}computeDatumRadius(t,e){return this._computeLayoutRadius()*this.getRadius(e)+this._centerOffset}_compareSpec(t,e,i){i=i??{data:!0};let s=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];s.forEach(o=>{i[o]=!0});let n=super._compareSpec(t,e,i);return t=t??{},s.some(o=>t[o]!==e[o])&&(n.reRender=!0,n.change=!0),n}computeDatumInnerRadius(t,e){return this._computeLayoutRadius()*this.getInnerRadius(e)+this._centerOffset}dataToPosition(t,e){let i=t[Mn];if(T(i)||e&&!this.isDatumInViewData(t))return null;let s=this.computeDatumRadius(t),n=this.computeCenter(t);return oe(n,s,i)}initAnimation(){var t,e,i;let s={growFrom:(o,a,l)=>{var h;if(l===_i.appear)return this._startAngle;if(l===_i.disappear)return this._endAngle;let d=[_i.disappear,_i.exit],c=a.mark.elements,u=o,p=u?.[$e];if(c.find(g=>{var f;return((f=g.data[0])===null||f===void 0?void 0:f[$e])<p})===void 0)return this._startAngle;if(c.find(g=>{var f;return((f=g.data[0])===null||f===void 0?void 0:f[$e])>p})===void 0)return this._endAngle;let m=[...c].reverse().find(g=>{var f;return((f=g.data[0])===null||f===void 0?void 0:f[$e])<p});return d.includes(l)?(h=m?.getNextGraphicAttributes())===null||h===void 0?void 0:h.endAngle:m?.getGraphicAttribute("endAngle",!0)}},n=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._pieMark){let o=_t((e=I.getAnimationInKey("pie"))===null||e===void 0?void 0:e(s,n),xt("pie",this._spec,this._markAttributeContext));o.normal&&o.normal.type&&(o.normal=mU(this._pieMark,o.normal)),this._pieMark.setAnimationConfig(o)}if(this._emptyArcMark){let o=_t((i=I.getAnimationInKey("emptyCircle"))===null||i===void 0?void 0:i(s,n??"fadeIn"));this._emptyArcMark.setAnimationConfig(o)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){return e}getActiveMarks(){return[this._pieMark]}};jd.transformerConstructor=Vd,jd.mark=gU;var K1=class extends jd{constructor(){super(...arguments),this.type=F.pie}};K1.type=F.pie;var Nw=class r extends a0{constructor(){super(...arguments),this.type=r.type,this._support3d=!0}};Nw.type="arc3d";var D0=class extends Vd{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie3d")}};var im=class extends jd{constructor(){super(...arguments),this.type=F.pie3d,this._pieMarkName="pie3d",this._pieMarkType="arc3d",this.transformerConstructor=D0}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this._angle3d=(e=(t=this._spec)===null||t===void 0?void 0:t.angle3d)!==null&&e!==void 0?e:-Math.PI/3}initMarkStyle(){super.initMarkStyle();let t=this._pieMark;t&&this.setMarkStyle(t,{beta:()=>this._angle3d},"normal",X.Series)}initLabelMarkStyle(t,e={}){t&&(super.initLabelMarkStyle(t),this.setMarkStyle(t,{support3d:!0},void 0,X.Mark))}};im.type=F.pie3d,im.mark=fU,im.transformerConstructor=D0;var Vw=10,vU=[10,20],yU=Ue.Linear,jw="circle",xU=Ue.Ordinal,bU=["circle","square","triangle","diamond","star"];var SU=Object.assign(Object.assign({},Ft),{point:{name:"point",type:"symbol"}});var E0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"point")}};var rm=class r extends ei{constructor(){super(...arguments),this.type=F.scatter,this.transformerConstructor=E0,this._invalidType="zero"}setAttrFromSpec(){super.setAttrFromSpec(),this._size=this._spec.size,this._sizeField=this._spec.sizeField,this._shape=this._spec.shape,this._shapeField=this._spec.shapeField}_getSeriesAttribute(t,e,{defaultScaleType:i,defaultRange:s},n){var o,a,l,h;if(V(e))return e;if(H(e)){if(T(t))return(o=this._option)===null||o===void 0||o.onError(`${n}Field is required.`),e;if(i!=="ordinal"&&e.length>2)return(a=this._option)===null||a===void 0||a.onError(`${n} length is invalid, specify up to 2 ${n}s.`),e;let d=`${et}_series_scatter_${this.id}_scale_${n}`;return this._option.globalScale.registerModelScale({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:e}),{scale:d,field:t}}if(ct(e)){if(T(t))return(l=this._option)===null||l===void 0||l.onError(`${n}Field is required.`),e;let d=`${et}_series_scatter_${this.id}_scale_${n}`,c=Object.assign({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:s},e);return this._option.globalScale.registerModelScale(c),{scale:c.id,field:t}}return(h=this._option)===null||h===void 0||h.onError(`${n} attribute is invalid.`),e}getSizeAttribute(t,e){return T(e)?Vw:J(e)?e:Z(e)&&EC(e)?parseFloat(e):this._getSeriesAttribute(t,e,{defaultScaleType:yU,defaultRange:vU},"size")}getShapeAttribute(t,e){return T(e)?jw:Z(e)?e:this._getSeriesAttribute(t,e,{defaultScaleType:xU,defaultRange:bU},"shape")}initMark(){var t,e;this._symbolMark=this._createMark(r.mark.point,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.point)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morph:vi(this._spec,r.mark.point.name),morphElementKey:this.getDimensionField()[0],setCustomizedShape:(e=this._spec.point)===null||e===void 0?void 0:e.customShape})}initMarkStyle(){this.initSymbolMarkStyle()}initAnimation(){var t,e,i;let s=Er(this),n=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._symbolMark.setAnimationConfig(_t((i=I.getAnimationInKey("scatter"))===null||i===void 0?void 0:i({},n),xt("point",this._spec,this._markAttributeContext),s))}initSymbolMarkStyle(){let t=this._symbolMark;t&&(this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,fill:this.getColorAttribute(),size:J(this._size)||V(this._size)?this._size:Vw,symbolType:Z(this._shape)||V(this._shape)?this._shape:jw},it.STATE_NORMAL,X.Series),(A(this._sizeField)||A(this._size))&&this.setMarkStyle(t,{size:this.getSizeAttribute(this._sizeField,this._size)},it.STATE_NORMAL,X.User_Mark),(A(this._shapeField)||A(this._shape))&&this.setMarkStyle(t,{symbolType:this.getShapeAttribute(this._shapeField,this._shape)},it.STATE_NORMAL,X.User_Mark))}initTooltip(){super.initTooltip(),this._symbolMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._symbolMark)}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t);let e=[this.getDimensionField()[0],this.getStackValueField()].every(i=>{var s,n,o;return i&&((o=(n=(s=this.getViewDataStatistics())===null||s===void 0?void 0:s.latestData)===null||n===void 0?void 0:n[i])===null||o===void 0?void 0:o.allValid)});this._invalidType==="zero"||e?this.setMarkStyle(this._symbolMark,{visible:!0},"normal",X.Series):this.setMarkStyle(this._symbolMark,{visible:this._getInvalidDefined.bind(this)},"normal",X.Series),this._symbolMark.getProduct()&&this._symbolMark.compileEncode()}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null},it.STATE_NORMAL,X.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},it.STATE_NORMAL,X.Series))}handleZoom(t){var e,i;this.getMarksWithoutRoot().forEach(n=>{let o=n.getProduct();!o||!o.elements||!o.elements.length||o.elements.forEach((a,l)=>{let h=a.getGraphicItem(),d=a.getDatum(),c=this.dataToPosition(d);c&&h&&h.translateTo(c.x,c.y)})});let s=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();s&&s.evaluate(null,null)}handlePan(t){this.handleZoom(t)}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._symbolMark]}};rm.type=F.scatter,rm.mark=SU,rm.transformerConstructor=E0;var zd=class extends ks{getStackGroupFields(){return this._angleField}getStackValueField(){return O(this._spec.valueField)[0]||O(this._spec.radiusField)[0]}getGroupFields(){return this._angleField}setAttrFromSpec(){super.setAttrFromSpec(),this.setAngleField(this._spec.categoryField||this._spec.angleField),this.setRadiusField(this._spec.valueField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice(),this.setInnerRadiusField(this._spec.valueField||this._spec.radiusField),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent()}setValueFieldToStack(){this.setRadiusField(pi),this.setInnerRadiusField(zi)}setValueFieldToPercent(){this.setRadiusField(Kr),this.setInnerRadiusField(os)}getDimensionField(){return this._specAngleField}getMeasureField(){return this._specRadiusField}getDefaultShapeType(){return"square"}};var AU=Object.assign(Object.assign({},Ft),{rose:{name:"rose",type:"arc"}});var w0=class extends ye{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"rose")}};var sm=class r extends zd{constructor(){super(...arguments),this.type=F.rose,this.transformerConstructor=w0,this._roseMark=null,this._labelMark=null}initMark(){this.initRoseMark()}initMarkStyle(){this.initRoseMarkStyle()}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}initRoseMark(){var t,e;this._roseMark=this._createMark(r.mark.rose,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.rose)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.rose)===null||e===void 0?void 0:e.customShape,morph:vi(this._spec,r.mark.rose.name),morphElementKey:this.getDimensionField()[0]})}getRoseAngle(){var t,e,i;return(i=(e=(t=this.angleAxisHelper).getBandwidth)===null||e===void 0?void 0:e.call(t,this._groups?this._groups.fields.length-1:0))!==null&&i!==void 0?i:.5}startAngleScale(t){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}endAngleScale(t){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))+this.getRoseAngle()-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}initRoseMarkStyle(){let t=this._roseMark;t&&this.setMarkStyle(t,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:e=>this.startAngleScale(e),endAngle:e=>this.endAngleScale(e),fill:this.getColorAttribute(),outerRadius:e=>Qt(this.radiusAxisHelper.dataToPosition([e[this._radiusField[0]]]),this.radiusAxisHelper.getScale(0)),innerRadius:e=>{var i;if(!this.getStack())return 0;let s=Qt(this.radiusAxisHelper.dataToPosition([e[this._innerRadiusField[0]]]),this.radiusAxisHelper.getScale(0));return s<=Number.MIN_VALUE?this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0):s}})}initTooltip(){super.initTooltip(),this._roseMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._roseMark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:0})}initAnimation(){var t,e,i;let s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._roseMark){let n={innerRadius:()=>{var o;return this._computeLayoutRadius()*((o=this._spec.innerRadius)!==null&&o!==void 0?o:0)}};this._roseMark.setAnimationConfig(_t((i=I.getAnimationInKey("rose"))===null||i===void 0?void 0:i(n,s),xt("rose",this._spec,this._markAttributeContext)))}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._roseMark]}};sm.type=F.rose,sm.mark=AU,sm.transformerConstructor=w0;var CU=Object.assign(Object.assign(Object.assign({},Ft),tn),{area:{name:"area",type:"area"}});var Gd=class r extends zd{constructor(){super(...arguments),this.type=F.radar,this.transformerConstructor=Cs,this._sortDataByAxis=!1}initGroups(){}compile(){super.compile(),this.addOverlapCompile()}initMark(){var t,e,i,s;let n={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},o=((t=this._spec.area)===null||t===void 0?void 0:t.visible)!==!1&&((i=(e=this._spec.area)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.visible)!==!1,a=(s=this._spec.seriesMark)!==null&&s!==void 0?s:"area";this.initAreaMark(n,o&&a==="area"),this.initLineMark(n,a==="line"||a==="area"&&!o),this.initSymbolMark(n,a==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initLineMarkStyle(),this.initSymbolMarkStyle(),[this._lineMark,this._symbolMark,this._areaMark].forEach(t=>{t&&this.setMarkStyle(t,{center:()=>{var e;return(e=this.angleAxisHelper)===null||e===void 0?void 0:e.center()}})})}initAreaMark(t,e){var i,s;this._areaMark=this._createMark(r.mark.area,{groupKey:this._seriesField,isSeriesMark:e,stateSort:(i=this._spec.area)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(s=this._spec.area)===null||s===void 0?void 0:s.customShape}))}initAreaMarkStyle(){let t=this._areaMark;t&&(this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),x1:e=>e&&this.angleAxisHelper&&this.radiusAxisHelper?this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getStack()?this.getDatumPositionValues(e,this._innerRadiusField):this.radiusScale.domain()[0]).x:Number.NaN,y1:e=>!e||!this.angleAxisHelper||!this.radiusAxisHelper?Number.NaN:this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getStack()?this.getDatumPositionValues(e,this._innerRadiusField):this.radiusScale.domain()[0]).y,fill:this.getColorAttribute(),curveType:p1,closePath:!0},"normal",X.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",X.Series),this.event.on(rt.viewDataStatisticsUpdate,{filter:e=>e.model===this},()=>{this.encodeDefined(t,"defined")}))}initTooltip(){super.initTooltip();let{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._areaMark&&t.add(this._areaMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initAnimation(){var t,e,i,s;let n={center:()=>{var a;return(a=this.angleAxisHelper)===null||a===void 0?void 0:a.center()},radius:()=>{let a=this.getLayoutRect();return Math.min(a.width,a.height)},startAngle:A(this._spec.startAngle)?Ut(this._spec.startAngle):kl},o=(i=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset)!==null&&i!==void 0?i:"clipIn";o==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(_t((s=I.getAnimationInKey("radarGroup"))===null||s===void 0?void 0:s(n,o),xt("group",this._spec,this._markAttributeContext))),[[this._areaMark,"radar"],[this._lineMark,"radar"],[this._symbolMark,"radarSymbol"]].forEach(([a,l])=>{if(A(a)){let h=I.getAnimationInKey(l);a.setAnimationConfig(_t(h?.(n,o),xt(a.name,this._spec,this._markAttributeContext)))}})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}getSeriesStyle(t){return e=>{var i,s,n,o;let a=(s=(i=this._seriesMark)===null||i===void 0?void 0:i.getAttribute(e,t))!==null&&s!==void 0?s:void 0;return e!=="fill"||a||(e="stroke",a=(o=(n=this._seriesMark)===null||n===void 0?void 0:n.getAttribute(e,t))!==null&&o!==void 0?o:void 0),e==="stroke"&&H(a)?a[0]:a}}};Gd.type=F.radar,Gd.mark=CU,Gd.transformerConstructor=Cs,Ct(Gd,Vl);var $1=class extends he{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(t){return t==="mark"}getDefaultTitlePattern(t){return{key:"event info",value:"event info"}}getDefaultContentList(){return[{key:t=>t.type,value:t=>t.id},{key:"event_time",value:t=>nn.getInstance().timeFormat("%Y%m%d",t.event_time)},{key:"action_type",value:t=>t.action_type},{key:"children",value:t=>t.children}]}getTooltipData(t,e,i,s,n){var o,a,l,h;let d=super.getTooltipData(t,e,i,s,n),c=(l=(a=(o=this.spec)===null||o===void 0?void 0:o[t])===null||a===void 0?void 0:a.updateContent)!==null&&l!==void 0?l:(h=e?.[t])===null||h===void 0?void 0:h.updateContent;return d&&!c&&(d.updateContent=(u,p,m)=>{let g=[],f=u.filter(_=>_.key==="children");return f.length>0&&f[0].value.forEach(_=>{let v=!0;for(let x in _)g.push(Object.assign(Object.assign({},f[0]),{shapeType:"circle",hasShape:v,key:x,value:_[x]+""})),v=!1}),u.concat(g)}),d}};var TU=(r,t)=>{var e;let i=!((e=r[0])===null||e===void 0)&&e.latestData?r[0].latestData:r||[],s=[];return i.forEach(n=>{let o={};for(let l in n)l!==t&&(o[l]=n[l]);let a=n[t];a?.forEach(l=>{s.push(Object.assign({},o,l))})}),s};var kU={fill:"#bbb",fillOpacity:.2};var MU=Object.assign(Object.assign({},Ft),{group:{name:"group",type:"group"},grid:{name:"grid",type:"rule"},gridBackground:{name:"gridBackground",type:"rect"},dot:{name:"dot",type:"symbol"},title:{name:"title",type:"text"},subTitle:{name:"subTitle",type:"text"},symbol:{name:"symbol",type:"symbol"}});var P0=class r extends ei{constructor(){super(...arguments),this.type=F.dot}getSeriesGroupField(){return this._seriesField}setSeriesGroupField(t){A(t)&&(this._seriesGroupField=t)}getTitleField(){return this._titleField}setTitleField(t){A(t)&&(this._titleField=t)}getSubTitleField(){return this._subTitleField}setSubTitleField(t){A(t)&&(this._subTitleField=t)}getDotTypeField(){return this._dotTypeField}setDotTypeField(t){A(t)&&(this._dotTypeField=t)}getHighLightSeriesGroup(){return this._highLightSeriesGroup}setHighLightSeriesGroup(t){A(t)&&(this._highLightSeriesGroup=t)}setGridBackground(t){A(t)&&(this._gridBackground=t)}initData(){var t;super.initData(),this._xDimensionStatisticsDomain=this.getRawData().latestData.map(e=>e[this._fieldY[0]]),nt(this._option.dataSet,"objFlat",TU),nt(this._option.dataSet,"copyDataView",Il),hs(this._option.dataSet,"dataview",zo),(t=this.getViewData())===null||t===void 0||t.transform({type:"objFlat",options:"dots",level:Ki.dotObjFlat},!1)}getStatisticFields(){return[{key:this._fieldY[0],operations:["values"],customize:this._xDimensionStatisticsDomain}]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setSeriesGroupField(this._spec.seriesGroupField),this.setTitleField(this._spec.titleField),this.setSubTitleField(this._spec.subTitleField),this.setDotTypeField(this._spec.dotTypeField),this.setHighLightSeriesGroup(this._spec.highLightSeriesGroup),this.setGridBackground(ot(kU,((t=this._spec.grid)===null||t===void 0?void 0:t.background)||{}))}initMark(){this._clipMark=this._createMark(r.mark.group),this._containerMark=this._createMark(r.mark.group,{parent:this._clipMark,dataView:this.getRawData()}),this._gridBackgroundMark=this._createMark(r.mark.gridBackground,{parent:this._containerMark,dataView:this.getRawData()}),this._gridMark=this._createMark(r.mark.grid,{parent:this._containerMark,dataView:this.getRawData()}),this._dotMark=this._createMark(r.mark.dot,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark}),this._titleMark=this._createMark(r.mark.title,{parent:this._containerMark,dataView:this.getRawData()}),this._subTitleMark=this._createMark(r.mark.subTitle,{parent:this._containerMark,dataView:this.getRawData()}),this._symbolMark=this._createMark(r.mark.symbol,{parent:this._containerMark,dataView:this.getRawData()})}initMarkStyle(){let t=this._clipMark;t&&(this.setMarkStyle(t,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",X.Series),t.setMarkConfig({interactive:!1,clip:!0}));let e=this._containerMark;e&&(this.setMarkStyle(e,{x:this._spec.leftAppendPadding},"normal",X.Series),e.setMarkConfig({interactive:!1}));let i=this._gridBackgroundMark;i&&this.setMarkStyle(i,{x:this.getRegionRectLeft.bind(this),x1:this.getRegionRectRight.bind(this),y:this.dataToGridBackgroundPositionY.bind(this),y1:this.dataToGridBackgroundPositionY1.bind(this),fill:this._gridBackground.fill,fillOpacity:this.dataToGridBackgroundOpacity.bind(this)},"normal",X.Series);let s=this._gridMark;s&&this.setMarkStyle(s,{stroke:this.getColorAttribute(),x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),x1:this.getRegionRectRight.bind(this),y1:this.dataToPositionY.bind(this)},"normal",X.Series);let n=this._dotMark;n&&this.setMarkStyle(n,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),fill:this.getDotColorAttribute(),fillOpacity:this.dataToOpacity.bind(this)},"normal",X.Series);let o=this._titleMark;o&&this.setMarkStyle(o,{fill:this.getColorAttribute(),text:h=>h[this.getTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",X.Series);let a=this._subTitleMark;a&&this.setMarkStyle(a,{fill:this.getColorAttribute(),text:h=>h[this.getSubTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",X.Series);let l=this._symbolMark;l&&this.setMarkStyle(l,{x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),fill:this.getColorAttribute()},"normal",X.Series)}dataToGridBackgroundPositionY(t){if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:e,getBandwidth:i}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fieldY),{bandPosition:this._bandPosition})-i(0)/2}dataToGridBackgroundPositionY1(t){if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:e,getBandwidth:i}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fieldY),{bandPosition:this._bandPosition})+i(0)/2}dataToOpacity(t){var e,i,s,n;if(!this._xAxisHelper)return Number.NaN;let{dataToPosition:o,getScale:a}=this._xAxisHelper;return o(this.getDatumPositionValues(t,this._fieldX),{bandPosition:this._bandPosition})<a(0).range()[0]||o(this.getDatumPositionValues(t,this._fieldX),{bandPosition:this._bandPosition})>a(0).range()[1]?0:(n=(s=(i=(e=this._theme)===null||e===void 0?void 0:e.dot)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.fillOpacity)!==null&&n!==void 0?n:1}dataToGridBackgroundOpacity(t){return t[this._seriesGroupField]===this._highLightSeriesGroup?this._gridBackground.fillOpacity:0}onLayoutEnd(t){var e,i;super.onLayoutEnd(t);let s=(i=(e=this._spec)===null||e===void 0?void 0:e.leftAppendPadding)!==null&&i!==void 0?i:0;this.setMarkStyle(this._clipMark,{width:this.getLayoutRect().width+s},"normal",X.Series)}getDefaultColorDomain(){var t,e;return this._seriesGroupField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._seriesGroupField].values:this._seriesField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesField].values:[]}getColorAttribute(){var t,e,i;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(i=(e=this._seriesGroupField)!==null&&e!==void 0?e:this._seriesField)!==null&&i!==void 0?i:ui}}getDotColorScale(){var t,e,i;let s=this._dotTypeField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._dotTypeField].values:this._seriesGroupField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesGroupField].values:this._seriesField?(i=this.getViewDataStatistics())===null||i===void 0?void 0:i.latestData[this._seriesField].values:[],n=this._getDataScheme();return new qs().domain(s).range(n)}getDotColorAttribute(){var t,e,i,s;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this.getDotColorScale(),field:(s=(i=(e=this._dotTypeField)!==null&&e!==void 0?e:this._seriesGroupField)!==null&&i!==void 0?i:this._seriesField)!==null&&s!==void 0?s:ui}}initTooltip(){this._tooltipHelper=new $1(this),this._dotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._dotMark)}onEvaluateEnd(t){super.onEvaluateEnd(t)}onMarkTreePositionUpdate(t){t.forEach(e=>{e.type==="group"?this.onMarkTreePositionUpdate(e.getMarks()):e.updateLayoutState()})}getDotData(){var t;return(t=this._dotMark)===null||t===void 0?void 0:t.getData()}_getDataIdKey(){}getStackValueField(){return null}getActiveMarks(){return[this._dotMark]}};P0.type=F.dot,P0.mark=MU;var q1=class extends he{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(t){return t==="mark"}getDefaultTitlePattern(t){return{key:"link info",value:"link info"}}getDefaultContentList(){return[{key:"time",value:t=>nn.getInstance().timeFormat("%Y%m%d %H:%M",t.from.split("_")[1])},{key:"type",value:t=>t.action_type},{key:"from",value:t=>t.from},{key:"to",value:t=>t.to}]}};var DU=Object.assign(Object.assign({},Ft),{group:{name:"group",type:"group"},link:{name:"link",type:"rule"},arrow:{name:"arrow",type:"symbol"}});var EU=(r,t)=>{let{infoKey:e,fields:i,linkData:s,dotData:n}=t,{fromField:o,toField:a,xField:l,yField:h}=i(),d=s(),c=n(),u={};return c.forEach(p=>{let m={};for(let f in p)f!==e&&(m[f]=p[f]);let g=p[e];g?.forEach(f=>{u[f.node_name]=Object.assign({},m,f)})}),d.forEach(p=>{var m,g,f,_;p[o+"_xField"]=(m=u?.[p[o]])===null||m===void 0?void 0:m[l],p[o+"_yField"]=(g=u?.[p[o]])===null||g===void 0?void 0:g[h],p[a+"_xField"]=(f=u?.[p[a]])===null||f===void 0?void 0:f[l],p[a+"_yField"]=(_=u?.[p[a]])===null||_===void 0?void 0:_[h]}),d};var R0=class r extends ei{constructor(){super(...arguments),this.type=F.link}getFromField(){return this._fromField}setFromField(t){A(t)&&(this._fromField=t)}getToField(){return this._toField}setToField(t){A(t)&&(this._toField=t)}getDotTypeField(){return this._dotTypeField}setDotTypeField(t){A(t)&&(this._dotTypeField=t)}getDotSeriesSpec(){return this._dotSeriesSpec}setDotSeriesSpec(t){A(t)&&(this._dotSeriesSpec=t)}_getDotData(){let t=this._option.getChart().getSeriesInIndex([this._spec.dotSeriesIndex])[0];return t?t.getRawData().latestData:[]}initData(){var t;super.initData(),nt(this._option.dataSet,"linkDotInfo",EU),(t=this.getViewData())===null||t===void 0||t.transform({type:"linkDotInfo",options:{infoKey:"dots",fields:()=>({fromField:this._fromField,toField:this._toField,xField:this._dotSeriesSpec.xField,yField:this._dotSeriesSpec.yField}),linkData:()=>this._rawData.latestData,dotData:()=>this._getDotData()},level:Ki.linkDotInfo},!1)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFromField(this._spec.fromField),this.setToField(this._spec.toField),this.setDotTypeField(this._spec.dotTypeField),this.setDotSeriesSpec(this._spec.dotSeriesSpec)}initMark(){this._clipMark=this._createMark(r.mark.group),this._containerMark=this._createMark(r.mark.group,{parent:this._clipMark}),this._linkMark=this._createMark(r.mark.link,{skipBeforeLayouted:!1,parent:this._containerMark}),this._arrowMark=this._createMark(r.mark.arrow,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark})}initMarkStyle(){var t,e,i,s;let n=this._clipMark;n&&(this.setMarkStyle(n,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",X.Series),n.setMarkConfig({interactive:!1,clip:!0}));let o=this._containerMark;o&&(this.setMarkStyle(o,{x:this._spec.leftAppendPadding,width:this.getLayoutRect().width},"normal",X.Series),o.setMarkConfig({interactive:!1}));let a=this._linkMark;a&&this.setMarkStyle(a,{stroke:this.getColorAttribute(),strokeOpacity:this.dataToOpacity.bind(this),x:this.dataToPositionXFrom.bind(this),y:this.dataToPositionYFrom.bind(this),x1:this.dataToPositionXTo.bind(this),y1:this.dataToPositionYTo.bind(this)},"normal",X.Series);let l=this._arrowMark;if(l){let h=(s=(i=(e=(t=this._theme)===null||t===void 0?void 0:t.arrow)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:10;this.setMarkStyle(l,{x:this.dataToPositionXTo.bind(this),y:d=>this.dataToPositionArrowYTo(d,h),fill:this.getColorAttribute(),fillOpacity:this.dataToOpacity.bind(this),size:h,symbolType:d=>this.isPositionYFromHigher(d)?"triangleDown":"triangleUp"},"normal",X.Series)}}afterInitMark(){super.afterInitMark()}dataToPositionXFrom(t){if(!this._xAxisHelper)return Number.NaN;let{dataToPosition:e}=this._xAxisHelper;return e(this.getDatumPositionValues(t,this._fromField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYFrom(t){if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:e}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fromField+"_yField"))}dataToPositionXTo(t){if(!this._xAxisHelper)return Number.NaN;let{dataToPosition:e}=this._xAxisHelper;return e(this.getDatumPositionValues(t,this._toField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYTo(t){if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:e}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._toField+"_yField"),{bandPosition:this._bandPosition})}dataToPositionArrowYTo(t,e){if(!this._yAxisHelper)return Number.NaN;let{dataToPosition:i}=this._yAxisHelper,s=this.isPositionYFromHigher(t)?-e/2:e/2;return i(this.getDatumPositionValues(t,this._toField+"_yField"),{bandPosition:this._bandPosition})+s}dataToOpacity(t){return this.isPositionXOuterRange(t,this._fromField+"_xField")||this.isPositionXOuterRange(t,this._toField+"_xField")||t[this._fromField]===t[this._toField]?0:1}isPositionYFromHigher(t){return this.dataToPositionYFrom(t)<this.dataToPositionYTo(t)}isPositionXOuterRange(t,e){if(!this._xAxisHelper)return!1;let{dataToPosition:i,getScale:s}=this._xAxisHelper;return i(this.getDatumPositionValues(t,e),{bandPosition:this._bandPosition})<s(0).range()[0]||i(this.getDatumPositionValues(t,e),{bandPosition:this._bandPosition})>s(0).range()[1]}getDefaultColorDomain(){var t,e;return this._dotTypeField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._dotTypeField].values:this._seriesField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesField].values:[]}getColorAttribute(){var t,e,i;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(i=(e=this._dotTypeField)!==null&&e!==void 0?e:this._seriesField)!==null&&i!==void 0?i:ui}}initInteraction(){let t=[];this._linkMark&&t.push(this._linkMark),this._arrowMark&&t.push(this._arrowMark),this._parseInteractionConfig(t)}initTooltip(){this._tooltipHelper=new q1(this),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark),this._arrowMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._arrowMark)}onMarkTreePositionUpdate(t){t.forEach(e=>{e.type==="group"?this.onMarkTreePositionUpdate(e.getMarks()):e.updateLayoutState()})}getDotInfoData(){var t,e;return(e=(t=this._linkMark)!==null&&t!==void 0?t:this._arrowMark)===null||e===void 0?void 0:e.getData()}getActiveMarks(){return[this._linkMark,this._arrowMark]}};R0.type=F.link,R0.mark=DU;var wU=Object.assign(Object.assign({},Gp),{track:{name:"track",type:"arc"},progress:{name:"progress",type:"arc"}});var B0=class extends ye{constructor(){super(...arguments),this._supportStack=!0}};var nm=class r extends Lo{constructor(){super(...arguments),this.type=F.circularProgress,this.transformerConstructor=B0,this._progressMark=null,this._trackMark=null,this._getRadiusValueStart=t=>{if(this.getGroupFields().length>1){let e=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()));if(K(e))return e}return this.radiusAxisHelper.dataToPosition([t[this._radiusField[0]]])},this._getRadiusValueEnd=t=>{var e,i;if(this.getGroupFields().length>1){let s=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))+((i=(e=this.radiusAxisHelper).getBandwidth)===null||i===void 0?void 0:i.call(e,this._groups?this._groups.fields.length-1:0));if(K(s))return s}return this.radiusAxisHelper.dataToPosition([t[this._radiusField[0]]])+this.radiusAxisHelper.getScale(0).step()}}getStackGroupFields(){return this.getGroupFields()}getGroupFields(){return this._radiusField}initMark(){super.initMark(),this._initTrackMark(),this._initProgressMark()}initMarkStyle(){super.initMarkStyle(),this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var t,e;return this._progressMark=this._createMark(r.mark.progress,{parent:this._arcGroupMark,isSeriesMark:!0,stateSort:(t=this._spec.progress)===null||t===void 0?void 0:t.stateSort},{morph:vi(this._spec,"progress"),setCustomizedShape:(e=this._spec.progress)===null||e===void 0?void 0:e.customShape}),this._progressMark}_initProgressMarkStyle(){var t;let e=this._progressMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart,endAngle:this._getAngleValueEnd,innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0},"normal",X.Series)}initInteraction(){let t=[];this._trackMark&&t.push(this._trackMark),this._progressMark&&t.push(this._progressMark),this._parseInteractionConfig(t)}initTooltip(){super.initTooltip(),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark)}_initTrackMark(){var t,e;return this._trackMark=this._createMark(r.mark.track,{parent:this._arcGroupMark,stateSort:(t=this._spec.track)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.track)===null||e===void 0?void 0:e.customShape}),this._trackMark.setMarkConfig({morph:!1,morphKey:null,morphElementKey:null}),this._trackMark}_initTrackMarkStyle(){let t=this._trackMark;t&&this.setMarkStyle(t,{visible:e=>{let i=this.angleAxisHelper.getScale(0).range(),s=Math.min(i[0],i[i.length-1]),n=this._getAngleValueStartWithoutMask(e);return Math.abs(n-s)<=1e-14},x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:()=>{let e=this.getStack()?zi:this._angleField[0],i=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueStart({[e]:i[0]})},endAngle:()=>{let e=this.getStack()?pi:this._angleField[0],i=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueEnd({[e]:i[i.length-1]})},innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:100},"normal",X.Series)}initAnimation(){var t,e,i,s;let n=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._progressMark.setAnimationConfig(_t((i=I.getAnimationInKey("circularProgress"))===null||i===void 0?void 0:i({startAngle:this._startAngle},n),xt("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(_t((s=I.getAnimationInKey("fadeInOut"))===null||s===void 0?void 0:s(),xt("track",this._spec,this._markAttributeContext)))}getActiveMarks(){return[this._progressMark]}};nm.type=F.circularProgress,nm.mark=wU,nm.transformerConstructor=B0;var Z1=class extends he{enableByType(t){return t!=="dimension"}};var PU=Object.assign(Object.assign({},Ft),{track:{name:"track",type:"rect"},progress:{name:"progress",type:"rect"},group:{name:"group",type:"group"}});var L0=class r extends ei{constructor(){super(...arguments),this.type=F.linearProgress,this._progressMark=null,this._trackMark=null,this._defaultProgressCustomShape=(t,e,i)=>{var s,n;let o=(s=this._spec)===null||s===void 0?void 0:s.cornerRadius,a=A(e.width)?e.width:e.x1-e.x,l=A(e.height)?e.height:e.y1-e.y,h=Math.min(0,a),d=Math.max(0,a),c=Math.min(0,l),u=Math.max(0,l);if(o>0){let p=o;if(((n=this._spec)===null||n===void 0?void 0:n.direction)==="vertical"){if(p=Math.min(Math.abs(a/2),o),2*p>Math.abs(l)){let m=Math.acos((p-Math.abs(l)/2)/p);return i.moveTo(h+p,c),i.arc(h+p,c+p,p,1.5*Math.PI,1.5*Math.PI-m,!0),i.arc(h+p,u-p,p,m+Math.PI/2,Math.PI/2,!0),i.lineTo(d-o,u),i.arc(d-p,u-p,p,Math.PI/2,Math.PI/2-m,!0),i.arc(d-p,c+p,p,-Math.PI/2+m,-Math.PI/2,!0),i.lineTo(h+p,c),i.closePath(),i}}else if(p=Math.min(Math.abs(l/2),o),2*p>Math.abs(a)){let m=Math.acos((p-Math.abs(a)/2)/p);return i.moveTo(h,c+p),i.arc(h+p,c+p,p,Math.PI,Math.PI+m),i.arc(d-p,c+p,p,-m,0),i.lineTo(d,u-p),i.arc(d-p,u-p,p,0,m),i.arc(h+p,u-p,p,Math.PI-m,Math.PI),i.closePath(),i}i.moveTo(h,c+p),i.arc(h+p,c+p,p,Math.PI,1.5*Math.PI),i.lineTo(d-p,c),i.arc(d-p,c+p,p,-Math.PI/2,0),i.lineTo(d,u-p),i.arc(d-p,u-p,p,0,Math.PI/2),i.lineTo(h+p,u),i.arc(h+p,u-p,p,Math.PI/2,Math.PI),i.closePath()}else i.moveTo(h,c),i.lineTo(d,c),i.lineTo(d,u),i.lineTo(h,u),i.closePath();return i}}initMark(){this._initTrackMark(),this._initProgressMark()}initMarkStyle(){this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var t,e,i;return this._progressMark=this._createMark(r.mark.progress,{isSeriesMark:!0,stateSort:(t=this._spec.progress)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(i=(e=this._spec.progress)===null||e===void 0?void 0:e.customShape)!==null&&i!==void 0?i:this._defaultProgressCustomShape}),this._progressMark}_initProgressMarkStyle(){var t,e,i,s;let n=this._progressMark;if(n)if(this._spec.direction==="vertical"){let o=this._spec.progress||{},a=(t=o.leftPadding)!==null&&t!==void 0?t:0,l=(e=o.rightPadding)!==null&&e!==void 0?e:0;this.setMarkStyle(n,{x:h=>{var d,c;return Qt(this.dataToPositionX(h),(c=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0),!0)-this._spec.bandWidth/2+a},y1:h=>{var d,c;return Qt(this.dataToPositionY(h),(c=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:()=>{var h;return(h=this._yAxisHelper)===null||h===void 0?void 0:h.dataToPosition([0],{bandPosition:this._bandPosition})},width:this._spec.bandWidth-a-l,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",X.Series)}else{let o=this._spec.progress||{},a=(i=o.topPadding)!==null&&i!==void 0?i:0,l=(s=o.bottomPadding)!==null&&s!==void 0?s:0;this.setMarkStyle(n,{x1:h=>{var d,c;return Qt(this.dataToPositionX(h),(c=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0))},y:h=>{var d,c;return Qt(this.dataToPositionY(h),(c=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||c===void 0?void 0:c.call(d,0),!0)-this._spec.bandWidth/2+a},height:this._spec.bandWidth-a-l,x:()=>{var h;return(h=this._xAxisHelper)===null||h===void 0?void 0:h.dataToPosition([0],{bandPosition:this._bandPosition})},cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",X.Series)}}_initTrackMark(){var t,e;return this._trackMark=this._createMark(r.mark.track,{stateSort:(t=this._spec.track)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.track)===null||e===void 0?void 0:e.customShape}),this._trackMark}_initTrackMarkStyle(){let t=this._trackMark;t&&(this._spec.direction==="vertical"?this.setMarkStyle(t,{x:e=>{var i,s;return Qt(this.dataToPositionX(e),(s=(i=this._xAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0),!0)-this._spec.bandWidth/2},y:0,width:this._spec.bandWidth,height:()=>this._scaleY.range()[0],cornerRadius:this._spec.cornerRadius},"normal",X.Series):this.setMarkStyle(t,{x:0,y:e=>{var i,s;return Qt(this.dataToPositionY(e),(s=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||s===void 0?void 0:s.call(i,0),!0)-this._spec.bandWidth/2},height:this._spec.bandWidth,width:()=>this._scaleX.range()[1],cornerRadius:this._spec.cornerRadius},"normal",X.Series))}initInteraction(){let t=[];this._trackMark&&t.push(this._trackMark),this._progressMark&&t.push(this._progressMark),this._parseInteractionConfig(t)}initAnimation(){var t,e,i,s;let n={direction:this.direction},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._progressMark.setAnimationConfig(_t((i=I.getAnimationInKey("linearProgress"))===null||i===void 0?void 0:i(n,o),xt("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(_t((s=I.getAnimationInKey("fadeInOut"))===null||s===void 0?void 0:s(),xt("track",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new Z1(this),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark),this._trackMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._trackMark)}getActiveMarks(){return[this._progressMark]}};L0.type=F.linearProgress,L0.mark=PU;var zw=[0],RU="hidden",Gw=20,BU=[20,40],LU=[200,500],IU="circle",FU={shrink:!1,enlarge:!1,fontSizeLimitMin:0},OU=!0,Uw=1;var HU=["triangleForward","triangle","diamond","square","star","cardioid","circle","pentagon","rect"];var cRe=`${et}_WORD_CLOUD_ANGLE`,uRe=`${et}_WORD_CLOUD_FILLING_ANGLE`,pRe=`${et}_WORD_CLOUD_WEIGHT`,mRe=`${et}_WORDCLOUD_COLOR`,gRe=`${et}_WORDCLOUD_DATA_TOTAL`,NU=`${et}_WORD_CLOUD_TEXT`,fRe=`${et}_WORDCLOUD_SHAPE_DATA_TOTAL`;var VU=Object.assign(Object.assign({},Ft),{word:{name:"word",type:"text"},fillingWord:{name:"fillingWord",type:"text"},wordMask:{name:"wordMask",type:"rect"}});var oh=class r extends qi{constructor(){super(...arguments),this._fontSizeRange=[Gw,Gw],this._isWordCloudShape=!1,this._dataChange=!0,this.handleMaskCanvasUpdate=(t,e)=>{this._maskCanvas=t},this.getWordColor=t=>t.isFillingWord?(this._fillingColorCallback&&!this._dataChange||(this._fillingColorCallback=this._wordCloudShapeConfig.fillingColorHexField?e=>e[this._wordCloudShapeConfig.fillingColorHexField]:this.initColorCallback(this._wordCloudShapeConfig.fillingSeriesField,!0)),this._fillingColorCallback(t)):(this._keyWordColorCallback&&!this._dataChange||(this._keyWordColorCallback=this._spec.colorHexField?e=>e[this._spec.colorHexField]:this.initColorCallback(this._seriesField,!1)),this._keyWordColorCallback(t)),this._calculateFontWeight=t=>{let e=this.getRawDataStatisticsByField(this._valueField,!0);return e.min===e.max?this._fontWeightRange[0]:this._fontWeightRange[0]+(this._fontWeightRange[this._fontWeightRange.length-1]-this._fontWeightRange[0])*(t[this._valueField]-e.min)/(e.max-e.min)}}setValueField(t){A(t)&&(this._valueField=t)}setFontSizeRange(t){A(t)?this._fontSizeRange=t:this._fontSizeRange=BU}setAttrFromSpec(){var t,e,i,s,n;super.setAttrFromSpec(),this._padding=this._option.getChart().padding,this._nameField=this._spec.nameField,this._colorMode=(t=this._spec.colorMode)!==null&&t!==void 0?t:"ordinal",this._colorList=this._spec.colorList,this.setValueField(this._spec.valueField),this._fontWeightRange=(e=this._spec.fontWeightRange)!==null&&e!==void 0?e:LU,this._rotateAngles=(i=this._spec.rotateAngles)!==null&&i!==void 0?i:zw,this.setFontSizeRange(this._spec.fontSizeRange),this._maskShape=(s=this._spec.maskShape)!==null&&s!==void 0?s:IU,this._textField=!((n=this._spec.word)===null||n===void 0)&&n.formatMethod?NU:this._nameField;let o=this._spec.wordCloudConfig;this._wordCloudConfig=Object.assign({drawOutOfBound:RU,layoutMode:"default",zoomToFit:FU},this._spec.wordCloudConfig),o&&!T(o.layoutMode)||jr(this._option.mode)||(this._wordCloudConfig.layoutMode="fast"),this._wordCloudShapeConfig=Object.assign({fillingSeriesField:this.getSeriesField(),fillingRotateAngles:zw,layoutMode:"default"},this._spec.wordCloudShapeConfig),this._isWordCloudShape=!HU.includes(this._maskShape)&&!["fast","grid","cloud"].includes(this._wordCloudConfig.layoutMode),this._defaultFontFamily=this._option.getTheme().fontFamily}initData(){var t,e;super.initData(),(e=(t=this.getViewData())===null||t===void 0?void 0:t.target)===null||e===void 0||e.addListener("change",()=>{this._dataChange=!0,this.compile()})}initMark(){var t;!((t=this._spec.wordMask)===null||t===void 0)&&t.visible&&(this._maskMark=this._createMark(r.mark.wordMask,{dataView:!1})),this._wordMark=this._createMark(r.mark.word,{key:ki,groupKey:this._seriesField,isSeriesMark:!0},{morphElementKey:this._seriesField})}initMarkStyle(){this.initMarkStyleOfWord(this._wordMark,this._spec.word,this._spec.colorHexField,this._seriesField),this._maskMark&&this.setMarkStyle(this._maskMark,{width:()=>this._region.getLayoutRect().width,height:()=>this._region.getLayoutRect().height,background:()=>this._maskCanvas},"normal",X.Series)}initMarkStyleOfWord(t,e,i,s,n){var o,a;t&&(this.setMarkStyle(t,{text:e?.formatMethod?l=>e.formatMethod(l):l=>l[this._textField],x:l=>l.x,y:l=>l.y,fontSize:l=>l.fontSize,fontStyle:l=>l.fontStyle,angle:l=>l.angle,visible:l=>l.visible},"normal",X.Series),this.setMarkStyle(t,{fill:(a=(o=e?.style)===null||o===void 0?void 0:o.fill)!==null&&a!==void 0?a:this.getWordColor,fontWeight:l=>l.fontWeight,fontFamily:l=>l.fontFamily},"normal",X.User_Mark))}initTooltip(){super.initTooltip(),this._wordMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._wordMark)}initAnimation(){[this._wordMark].forEach(t=>{var e,i;if(t){let s=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset,n={animationConfig:()=>{var o,a;return(a=(o=t.getAnimationConfig())===null||o===void 0?void 0:o.appear)===null||a===void 0?void 0:a[0]}};t.setAnimationConfig(_t(I.getAnimationInKey("wordCloud")(n,s),xt("word",this._spec,this._markAttributeContext)))}})}getWordOrdinalColorScale(t,e){var i,s,n,o,a;let l=e?this._wordCloudShapeConfig.fillingColorList:this._colorList,h=t?(i=this.getViewData())===null||i===void 0?void 0:i.latestData.map(c=>c[t]):[],d=(n=l??((s=this._option.globalScale.getScale("color"))===null||s===void 0?void 0:s.range()))!==null&&n!==void 0?n:this._getDataScheme();return(a=(o=new qs().domain(h)).range)===null||a===void 0?void 0:a.call(o,d)}initColorCallback(t,e){var i,s,n,o;if(this._colorMode==="ordinal"){let h=this.getWordOrdinalColorScale(t,e);return d=>h.scale(d[t??ui])}let a=(i=e?this._colorList:this._wordCloudShapeConfig.fillingColorList)!==null&&i!==void 0?i:this._option.globalScale.getScale("color").range();if(a.length===1)return h=>a[0];if(this._valueField){let h=this.getRawDataStatisticsByField(this._valueField,!0);if(h.min===h.max)return a[0];let d=new ir().domain([h.min,h.max]).range(a);return c=>d.scale(c[this._valueField])}let l=new ir().domain([0,(o=(n=(s=this.getViewData())===null||s===void 0?void 0:s.latestData)===null||n===void 0?void 0:n.length)!==null&&o!==void 0?o:1]).range(a);return h=>l.scale(h[$e])}compile(){super.compile();let{width:t,height:e}=this._region.getLayoutRect();if(!K(t)||!K(e)||!(e>0&&t>0))return;let i=this._wordMark.getProduct();if(i){let s=[];this._isWordCloudShape?s.push(Object.assign({type:"wordcloudShape"},this._wordCloudShapeTransformOption())):s.push(Object.assign({type:"wordcloud"},this._wordCloudTransformOption())),i.transform(s)}}_getCommonTransformOptions(){var t,e,i,s,n,o;let{width:a,height:l}=this._region.getLayoutRect(),h=(t=this._spec.word)!==null&&t!==void 0?t:{},d=(e=h.style)!==null&&e!==void 0?e:{};return{size:[a,l],shape:ct(this._maskShape)&&this._maskShape.type==="text"&&T(this._maskShape.fontFamily)?Object.assign({fontFamily:(i=this._option.getTheme())===null||i===void 0?void 0:i.fontFamily},this._maskShape):this._maskShape,onUpdateMaskCanvas:this.handleMaskCanvasUpdate,dataIndexKey:ki,text:h.formatMethod?c=>h.formatMethod(c):{field:this._textField},fontSize:this._valueField?{field:this._valueField}:this._fontSizeRange[0],fontSizeRange:this._fontSizeRange==="auto"?null:this._fontSizeRange,padding:(n=(s=this._spec.word)===null||s===void 0?void 0:s.padding)!==null&&n!==void 0?n:Uw,fontFamily:A(this._spec.fontFamilyField)?{field:this._spec.fontFamilyField}:(o=d.fontFamily)!==null&&o!==void 0?o:this._defaultFontFamily,fontWeight:A(this._spec.fontWeightField)?{field:this._spec.fontWeightField}:A(d.fontWeight)?d.fontWeight:A(this._valueField)?this._calculateFontWeight:"normal",fontStyle:A(this._spec.fontStyleField)?{field:this._spec.fontStyleField}:d.fontStyle}}_wordCloudTransformOption(){var t,e;let i=(t=this._wordCloudConfig)!==null&&t!==void 0?t:{};return Object.assign(Object.assign(Object.assign({},i),this._getCommonTransformOptions()),{layoutType:this._wordCloudConfig.layoutMode,rotate:this._rotateAngles,randomVisible:(e=this._spec.random)!==null&&e!==void 0?e:OU,clip:this._wordCloudConfig.drawOutOfBound==="clip",shrink:this._wordCloudConfig.zoomToFit.shrink,enlarge:this._wordCloudConfig.zoomToFit.enlarge,minFontSize:this._wordCloudConfig.zoomToFit.fontSizeLimitMin,progressiveTime:this._wordCloudConfig.progressiveTime,progressiveStep:this._wordCloudConfig.progressiveStep,repeatFill:this._wordCloudConfig.zoomToFit.repeat})}_wordCloudShapeTransformOption(){var t,e,i,s,n,o;let a=(e=(t=this._spec.fillingWord)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{},l=(i=this._wordCloudShapeConfig)!==null&&i!==void 0?i:{};return Object.assign(Object.assign(Object.assign({},l),this._getCommonTransformOptions()),{rotateList:this._rotateAngles,fillingRotateList:l.fillingRotateAngles,fillingFontFamily:A(l.fillingFontFamilyField)?{field:l.fillingFontFamilyField}:(s=a.fontFamily)!==null&&s!==void 0?s:this._defaultFontFamily,fillingPadding:(o=(n=this._spec.fillingWord)===null||n===void 0?void 0:n.padding)!==null&&o!==void 0?o:Uw,fillingFontStyle:A(l.fillingFontStyleField)?{field:l.fillingFontStyleField}:a.fontStyle,fillingFontWeight:A(l.fillingFontWeightField)?{field:l.fillingFontWeightField}:a.fontWeight})}getStatisticFields(){let t=[];return t.push({key:this._nameField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}dataToPosition(t){return null}dataToPositionX(t){return null}dataToPositionY(t){return null}dataToPositionZ(t){return null}valueToPosition(t,e){return null}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}onLayoutEnd(t){super.onLayoutEnd(t),this.compile(),this._dataChange=!1}getActiveMarks(){return[this._wordMark]}reInit(){super.reInit(),this._keyWordColorCallback&&(this._keyWordColorCallback=null),this._fillingColorCallback&&(this._fillingColorCallback=null)}};oh.mark=VU;var J1=class extends oh{constructor(){super(...arguments),this.type=F.wordCloud}};J1.type=F.wordCloud;var Q1=class extends oh{constructor(){super(...arguments),this.type=F.wordCloud3d}_wordCloudTransformOption(){var t;return Object.assign(Object.assign({},super._wordCloudTransformOption()),{postProjection:(t=this._spec.postProjection)!==null&&t!==void 0?t:"StereographicProjection",depth_3d:this._spec.depth_3d})}_wordCloudShapeTransformOption(){var t;return Object.assign(Object.assign({},super._wordCloudShapeTransformOption()),{postProjection:(t=this._spec.postProjection)!==null&&t!==void 0?t:"StereographicProjection",depth_3d:this._spec.depth_3d})}initMark(){this._wordMark=this._createMark(oh.mark.word,{groupKey:this._seriesField,isSeriesMark:!0},{support3d:!0})}initMarkStyle(){super.initMarkStyle();let t=this._wordMark;t&&this.setMarkStyle(t,{z:e=>{var i;return(i=e.z)!==null&&i!==void 0?i:0}},"normal",X.Series)}initAnimation(){var t,e;let i=(t=this._padding)!==null&&t!==void 0?t:{};this._wordMark&&this._wordMark.setAnimationConfig(_t((e=I.getAnimationInKey("wordCloud3d"))===null||e===void 0?void 0:e(()=>{var s;let n=this.getCompiler().getVGrammarView(),o=n.width()-i.left||0-i.right||0,a=n.height()-i.top||0-i.bottom||0,l=Math.max(o,a)/2;return{center:{x:l,y:l,z:(s=this._spec.depth_3d)!==null&&s!==void 0?s:l},r:l}}),xt("word",this._spec,this._markAttributeContext)))}};Q1.type=F.wordCloud3d;var jU=(r,t)=>{if(!r)return r;let e=t(),{width:i,height:s}=e;return new Rp(e).layout(r,{width:i,height:s})};var tC=class extends he{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>t?.[this.series.getDimensionField()[0]]}};var zU=Object.assign(Object.assign({},Ft),{sunburst:{name:"sunburst",type:"arc"}});var om=class r extends ks{constructor(){super(...arguments),this.type=F.sunburst}setCategoryField(t){return this._categoryField=t,this._categoryField}getCategoryField(){return this._categoryField}setValueField(t){return this._valueField=t,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:rn),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e;return(e=this._spec.drillField)!==null&&e!==void 0?e:ki},getRawData:()=>this.getRawData()}),this._startAngle=Ut(this._spec.startAngle),this._endAngle=Ut(this._spec.endAngle),this._centerX=this._spec.centerX,this._centerY=this._spec.centerY,this._offsetX=this._spec.offsetX,this._offsetY=this._spec.offsetY,this.__innerRadius=this._spec.innerRadius,this.__outerRadius=this._spec.outerRadius,this._gap=this._spec.gap,this._labelLayout=this._spec.labelLayout,this._sunburst=this._spec.sunburst,this._label=this._spec.label,this._labelAutoVisible=this._spec.labelAutoVisible}initData(){super.initData();let t=this.getRawData();t&&(this._spec.drill&&this.initDrillableData(this._dataSet),nt(this._dataSet,"sunburstLayout",jU),nt(this._dataSet,"flatten",Ro),t.transform({type:"sunburstLayout",options:()=>{let{innerRadius:e,outerRadius:i,gap:s,label:n}=this._computeLevel();return{nodeKey:this._categoryField,width:this.getLayoutRect().width,height:this.getLayoutRect().height,center:[A(this._centerX)?this._centerX:this.getLayoutRect().width/2,A(this._centerY)?this._centerY:this.getLayoutRect().height/2],startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:e,outerRadius:i,gapRadius:s,label:n}}}),t.transform({type:"flatten",options:{callback:e=>{if(e.datum){let i=e.datum[e.depth];return Object.assign(Object.assign({},e),i)}return e}}}))}getStatisticFields(){return Ip(super.getStatisticFields(),this._categoryField,this._valueField)}_addDataIndexAndKey(){let t=this.getRawData();T(t?.dataSet)||(nt(t.dataSet,"addVChartProperty",en),t.transform({type:"addVChartProperty",options:{beforeCall:xp.bind(this),call:Pd}}))}initMark(){this._initArcMark(),this._initLabelMark()}initMarkStyle(){this._initArcMarkStyle(),this._initLabelMarkStyle()}_initArcMark(){var t,e;if(this._sunburst.visible===!1)return;let i=this._createMark(r.mark.sunburst,{isSeriesMark:!0,stateSort:(t=this._spec.sunburst)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.sunburst)===null||e===void 0?void 0:e.customShape});this._sunburstMark=i}_initArcMarkStyle(){T(this._sunburstMark)||this.setMarkStyle(this._sunburstMark,{x:t=>t.x+(A(this._offsetX)?this._offsetX:0),y:t=>t.y+(A(this._offsetY)?this._offsetY:0),outerRadius:t=>t.outerRadius,innerRadius:t=>t.innerRadius,startAngle:t=>t.startAngle,endAngle:t=>t.endAngle,fill:this.getColorAttribute()},it.STATE_NORMAL,X.Series)}_initLabelMark(){if(this._label.visible!==!0)return;let t=this._createMark(r.mark.label,{isSeriesMark:!1});this._labelMark=t}_initLabelMarkStyle(){T(this._labelMark)||this.setMarkStyle(this._labelMark,{visible:t=>{var e;let i=this._labelAutoVisible;return ct(i)&&i.enable===!0?(t.endAngle-t.startAngle)*(t.outerRadius-t.innerRadius)>((e=i?.circumference)!==null&&e!==void 0?e:10):this._spec.label.visible},x:t=>{var e;return((e=t.label)===null||e===void 0?void 0:e.x)+(A(this._offsetX)?this._offsetX:0)},y:t=>{var e;return((e=t.label)===null||e===void 0?void 0:e.y)+(A(this._offsetY)?this._offsetY:0)},textBaseline:t=>{var e;return(e=t.label)===null||e===void 0?void 0:e.textBaseline},textAlign:t=>{var e;return(e=t.label)===null||e===void 0?void 0:e.textAlign},angle:t=>{var e,i;return(i=(e=t.label)===null||e===void 0?void 0:e.angle)!==null&&i!==void 0?i:0},fontSize:10,text:t=>t.name},it.STATE_NORMAL,X.Series)}initTooltip(){this._tooltipHelper=new tC(this),this._sunburstMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._sunburstMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var t,e;let i={animationInfo:()=>({innerRadius:this._computeRadius(O(this.__innerRadius))[0],outerRadius:this._computeRadius(O(this.__outerRadius))[0],startAngle:O(this._startAngle)[0],endAngle:O(this._endAngle)[0]})},s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this.getMarksInType("arc").forEach(n=>{var o;n.setAnimationConfig(_t((o=I.getAnimationInKey("sunburst"))===null||o===void 0?void 0:o(i,s),xt(n.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(n=>{var o;n.setAnimationConfig(_t((o=I.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),xt(n.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(t){super.onLayoutEnd(t),this._rawData.reRunAllTransform()}_computeRadius(t){return H(t)?t.map(e=>this._computeLayoutRadius()*e):this._computeLayoutRadius()*t}_computeLevel(){return{innerRadius:this._computeRadius(this.__innerRadius),outerRadius:this._computeRadius(this.__outerRadius),gap:this._gap,label:this._labelLayout}}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._sunburstMark]}getMarkData(t){return t?.datum?t.datum[t.datum.length-1]:t}};om.type=F.sunburst,om.mark=zU,Ct(om,Ul);var Ww=r=>{let t=0;return r.forEach((e,i)=>{var s;T(e.value)&&(!((s=e.children)===null||s===void 0)&&s.length?e.value=Ww(e.children):e.value=0),t+=Math.abs(e.value)}),t};function GU(r){return r.depth}function UU(r,t){return t-1-r.endDepth}function Yq(r,t){return r.sourceLinks.length?r.depth:t-1}function Xq(r,t,e){return r.targetLinks.length?r.depth:r.sourceLinks.length?Ae(r.sourceLinks.map(i=>e[i.target].depth))-1:0}var eC=(r,t)=>r?.y0-t?.y0,WU=(r,t)=>{if(T(r.value))return null;let e=(t?r.targetLinks:r.sourceLinks).reduce((i,s)=>(T(s.value)?i.count+=1:i.sum+=s.value,i),{sum:0,count:0});return e.count>0?(r.value-e.sum)/e.count:null},Kq={left:GU,right:UU,justify:Yq,center:Xq,start:GU,end:UU},$q=sn(0,1),am=class r{constructor(t){this._ascendingSourceBreadth=(s,n)=>eC(this._nodeMap[s.source],this._nodeMap[n.source])||s.index-n.index,this._ascendingTargetBreadth=(s,n)=>eC(this._nodeMap[s.target],this._nodeMap[n.target])||s.index-n.index,this.options=Object.assign({},r.defaultOptions,t);let e=this.options.nodeKey,i=V(e)?e:e?Ur(e):null;this._getNodeKey=i,this._logger=Nt.getInstance(),this._alignFunc=V(this.options.setNodeLayer)?s=>this.options.setNodeLayer(s.datum):Kq[this.options.nodeAlign]}layout(t,e){if(!t)return null;let i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};ZM(this.options.direction)?this._viewBox={x0:i.y0,x1:i.y1,y0:i.x0,y1:i.x1,width:i.height,height:i.width}:this._viewBox=i;let s=this.computeNodeLinks(t),n=s.nodes,o=s.links;if(this._nodeMap=s.nodeMap,this.computeNodeValues(n),this.computeNodeDepths(n),["right","end","justify"].includes(this.options.nodeAlign)&&this.computeNodeEndDepths(n),this._maxDepth<=0)return null;let a=this.computeNodeBreadths(n);if(this.computeLinkBreadths(n),n.forEach(l=>{l.sourceLinks=l.sourceLinks.filter(h=>!T(h.source)&&!T(h.target)),l.targetLinks=l.targetLinks.filter(h=>!T(h.source)&&!T(h.target))}),o=o.filter(l=>!T(l.source)&&!T(l.target)),ZM(this.options.direction))if(this.options.inverse){let l=this._viewBox.x1;n.forEach(h=>{let{y0:d,y1:c,x0:u,x1:p}=h;h.y0=l-p,h.y1=l-u,h.x0=d,h.x1=c}),o.forEach(h=>{h.vertical=!0;let{x0:d,x1:c,y0:u,y1:p}=h;h.x0=u,h.x1=p,h.y0=l-d,h.y1=l-c})}else n.forEach(l=>{let{y0:h,y1:d}=l;l.y0=l.x0,l.y1=l.x1,l.x0=h,l.x1=d}),o.forEach(l=>{l.vertical=!0;let h=l.x0,d=l.x1;l.x0=l.y0,l.x1=l.y1,l.y0=h,l.y1=d});else this.options.inverse&&(n.forEach(l=>{let{x0:h,x1:d}=l;l.x0=i.x1-d,l.x1=i.x1-h}),o.forEach(l=>{l.x0=i.x1-l.x0,l.x1=i.x1-l.x1}));return o.forEach(l=>{let h=this._nodeMap[l.source],d=this._nodeMap[l.target];l.sourceRect={x0:h.x0,x1:h.x1,y0:h.y0,y1:h.y1},l.targetRect={x0:d.x0,x1:d.x1,y1:d.y1,y0:d.y0}}),{nodes:n,links:o,columns:a}}computeHierarchicNodeLinks(t){let e=[],i=[],s={},n={},o=[];Ww(t);let a=(l,h,d)=>{l.forEach((c,u)=>{let p=this._getNodeKey?this._getNodeKey(c):d?`${d[d.length-1].key}-${u}`:`${h}-${u}`,m=T(c.value)?0:Wn(c.value);if(s[p])s[p].value=void 0;else{let g={depth:h,datum:c,index:u,key:p,value:m,sourceLinks:[],targetLinks:[]};s[p]=g,e.push(g)}d&&o.push({source:d[d.length-1].key,target:p,value:m,parents:d}),c.children&&c.children.length&&a(c.children,h+1,d?d.concat([s[p]]):[s[p]])})};return a(t,0,null),o.forEach((l,h)=>{let d=`${l.source}-${l.target}`,c=xr(l,["parents"]);if(c.parents=l.parents.map(p=>xr(p,["sourceLinks","targetLinks"])),n[d])return n[d].value+=Wn(l.value),void n[d].datum.push(c);let u={index:h,key:`${l.source}-${l.target}`,source:l.source,target:l.target,datum:[c],value:l.value,parents:l.parents.map(p=>p.key)};i.push(u),s[l.source].sourceLinks.push(u),s[l.target].targetLinks.push(u),n[d]=u}),{nodes:e,links:i,nodeMap:s}}computeSourceTargetNodeLinks(t){let e=[],i=[],s={};t.nodes&&t.nodes.forEach((o,a)=>{let l={depth:-1,datum:o,index:a,key:this._getNodeKey?this._getNodeKey(o):a,value:o.value,sourceLinks:[],targetLinks:[]};s[l.key]=l,e.push(l)});let n=[];return t.links.forEach((o,a)=>{let l=!T(o.source),h=!T(o.target);if(t.nodes&&(!s[o.source]||!s[o.target]))return;t.nodes||!l||s[o.source]||(s[o.source]={value:void 0,depth:-1,index:e.length,key:o.source,datum:null,sourceLinks:[],targetLinks:[]},e.push(s[o.source])),t.nodes||!h||s[o.target]||(s[o.target]={value:void 0,depth:-1,index:e.length,key:o.target,datum:null,sourceLinks:[],targetLinks:[]},e.push(s[o.target]));let d={index:a,source:o.source,target:o.target,datum:o,value:o.value};this.options.divideNodeValueToLink&&T(o.value)&&n.push(d),i.push(d),l&&s[o.source].sourceLinks.push(d),h&&s[o.target].targetLinks.push(d)}),this.options.divideNodeValueToLink&&n.length&&n.forEach(o=>{let a=[WU(s[o.source]),WU(s[o.target],!0)].filter(l=>!T(l));a.length&&(o.value=Ae(a))}),{nodeMap:s,nodes:e,links:i}}computeNodeLinks(t){let e;"links"in t?e=this.computeSourceTargetNodeLinks(t):(this._isHierarchic=!0,e=this.computeHierarchicNodeLinks(t.nodes));let i=e.nodes,s=e.links;if(this.options.linkSortBy)for(let n=0,o=i.length;n<o;n++)i[n].sourceLinks.sort(this.options.linkSortBy),i[n].targetLinks.sort(this.options.linkSortBy);return this.options.dropIsolatedNode&&(i=i.filter(n=>n.targetLinks.length||n.sourceLinks.length)),{nodes:i,links:s,nodeMap:e.nodeMap}}computeNodeValues(t){for(let e=0,i=t.length;e<i;e++){let s=t[e];s.value=Math.max(T(s.value)?0:Wn(s.value),s.sourceLinks.reduce((n,o)=>{var a;return n+((a=Wn(o.value))!==null&&a!==void 0?a:0)},0),s.targetLinks.reduce((n,o)=>{var a;return n+((a=Wn(o.value))!==null&&a!==void 0?a:0)},0))}}computeNodeDepths(t){var e;let i=t.length,s,n,o=t,a=0,l=-1,h=V(this.options.setNodeLayer)?this.options.setNodeLayer:null;for(;o.length&&a<i;){s=[],n={};for(let d=0,c=o.length;d<c;d++){let u=o[d];if(u&&(u.depth=h&&(e=h(u.datum))!==null&&e!==void 0?e:a,h&&(l=Math.max(u.depth,l)),u.sourceLinks&&u.sourceLinks.length))for(let p=0,m=u.sourceLinks.length;p<m;p++){let g=u.sourceLinks[p];n[g.target]||(s.push(this._nodeMap[g.target]),n[g.target]=!0)}}o=s,a+=1}a>i&&this._logger.warn("Error: there is a circular link"),this._maxDepth=h?l+1:a}computeNodeEndDepths(t){let e=t.length,i,s,n=t,o=0;for(;n.length&&o<e;){i=[],s={};for(let a=0,l=n.length;a<l;a++){let h=n[a];if(h){h.endDepth=o;for(let d=0,c=h.targetLinks.length;d<c;d++){let u=h.targetLinks[d];s[u.source]||(i.push(this._nodeMap[u.source]),s[u.source]=!0)}}}n=i,o+=1}o>e&&this._logger.warn("Error: there is a circular link")}computeNodeLayers(t){let e=this.options.nodeWidth,i=this.options.linkWidth,s=this.options.minStepWidth,n=this._viewBox.width,o=null,a=null,l=!1;if(Z(e)){let d=ee(parseFloat(e.replace("%",""))/100,0,1),c=n/(this._maxDepth-1+d);s>0&&(c=Math.max(s,c)),o=c*d,a=c*(1-d),l=!0}else if(J(e)){if(o=e,J(i))a=i;else if(T(i)){let d=(n-e)/(this._maxDepth-1);s>0&&(d=Math.max(s,d)),a=d-e}l=!0}else V(e)&&J(i)&&(a=i);let h=[];for(let d=0,c=t.length;d<c;d++){let u=t[d];u.layer=this._isHierarchic?u.depth:ee(Math.floor(this._alignFunc(u,this._maxDepth,this._nodeMap)),0,this._maxDepth-1);let p=u.layer;p===this._maxDepth-1&&(u.isLastLayer=!0),l&&(u.x0=this._viewBox.x0+p*(o+a),u.x1=u.x0+o),h[p]?h[p].push(u):h[p]=[u]}if(this.options.nodeSortBy)for(let d=0,c=h.length;d<c;d++)h[d].sort(this.options.nodeSortBy);if(!l&&V(e)){let d=this._viewBox.x0;for(let c=0;c<this._maxDepth;c++){let u=h[c],p=0,m=0;for(let g=0,f=u&&u.length;g<f;g++){let _=u[g],v=e(_);_.x0=d,_.x1=d+v,p=Math.max(o,v);let x=_.sourceLinks;for(let y=0,b=x.length;y<b;y++){let S=x[y],C=V(i)?i(S,this._viewBox):a;m=Math.max(m,C)}}d+=p+m}}return h}initializeNodeBreadths(t){var e,i,s;let n=(e=this.options.minLinkHeight)!==null&&e!==void 0?e:0,o=(i=this.options.minNodeHeight)!==null&&i!==void 0?i:0,a=(s=this.options.maxNodeHeight)!==null&&s!==void 0?s:1/0,l=this.options.maxLinkHeight;(T(o)||o<n)&&(o=n),(T(l)||l>a)&&(l=a);let h=0,d=null,c=null;if(V(this.options.nodeGap))d=this.options.nodeGap,h=t.reduce((f,_)=>{let v=_.reduce((y,b)=>y+b.value,0),x=_.reduce((y,b)=>y+this.options.nodeGap(b),0);return Math.min(f,(this._viewBox.height-x)/v)},1/0);else{let f=t.reduce((x,y)=>Math.max(x,y.length),0),_=this._viewBox.height/f,v=Math.min(this.options.nodeGap,_);if(o+v>_&&(v=o>=_?_/2:(_-o)/2,o=Math.min(_-v,o)),d=()=>v,this._gapY=v,this.options.equalNodeHeight)c=this._viewBox.height/f-v;else{let x=o>0?Math.max(v,o):v;h=t.reduce((y,b)=>{let S=b.reduce((C,k)=>C+k.value,0);return Math.min(y,(this._viewBox.height-((b.length-1)*x+o))/S)},1/0)}}let u=this.options.gapPosition==="start",p=!u&&this.options.gapPosition!=="end",m=J(this.options.nodeHeight)?f=>this.options.nodeHeight:V(this.options.nodeHeight)?this.options.nodeHeight:c>0?f=>c:f=>Math.max(f.value*h,0),g=J(this.options.linkHeight)?()=>this.options.linkHeight:V(this.options.linkHeight)?this.options.linkHeight:(f,_,v)=>Math.min(Math.max(_.value?v*$q(f.value/_.value):0,n,0),l);for(let f=0,_=t.length;f<_;f++){let v=t[f];if(!v||!v.length)continue;let x=this._viewBox.y0,y=0,b=0,S=0;for(let k=0,M=v.length;k<M;k++){let E=v[k];y=d(E),u&&(x+=y),S=m(E),b=Math.min(Math.max(S,o),a),E.y0=x,E.y1=x+b,x=u?E.y1:E.y1+y;for(let D=0,P=E.sourceLinks.length;D<P;D++){let B=E.sourceLinks[D];B.thickness=g(B,E,S)}}let C=this._viewBox.y1-x+(p?y:0);if(C>0){if(this.options.crossNodeAlign!=="start")if(this.options.crossNodeAlign==="end")for(let k=0,M=v.length;k<M;++k){let E=v[k];E.y0+=C,E.y1+=C}else if(this.options.crossNodeAlign==="parent"){let k=v.reduce((M,E)=>(E.targetLinks&&E.targetLinks.length&&E.targetLinks.forEach(D=>{M[D.source]=!0}),M),{});if(Object.keys(k).length&&t[f-1]&&t[f-1].length){let M=t[f-1].filter(E=>k[E.key]);if(M&&M.length&&M[0].y0!==v[0].y0){let E=M[0].y0-v[0].y0;for(let D=0,P=v.length;D<P;++D){let B=v[D];B.y0+=E,B.y1+=E}}}}else{C/=v.length+1;for(let k=0,M=v.length;k<M;++k){let E=v[k];E.y0+=C*(k+1),E.y1+=C*(k+1)}}}else if(C<0&&v.length>1&&(C/=v.length-1,y+C>=0)){y+=C,this._gapY=Math.min(y);for(let k=1,M=v.length;k<M;++k){let E=v[k];E.y0+=C*k,E.y1+=C*k}}this.reorderLinks(v)}}computeNodeBreadths(t){let e=this.computeNodeLayers(t);this.initializeNodeBreadths(e);let i=this.options.iterations;if(!this._isHierarchic&&!V(this.options.setNodeLayer)&&!V(this.options.nodeGap))for(let s=0;s<i;++s){let n=Math.pow(.99,s),o=Math.max(1-n,(s+1)/i);this.relaxRightToLeft(e,n,o),this.relaxLeftToRight(e,n,o)}return e}relaxLeftToRight(t,e,i){for(let s=1,n=t.length;s<n;++s){let o=t[s];for(let a=0,l=o.length;a<l;a++){let h=o[a],d=0,c=0;for(let p=0,m=h.targetLinks.length;p<m;p++){let g=h.targetLinks[p],f=g.value*(h.layer-this._nodeMap[g.source].layer);d+=this.targetTop(this._nodeMap[g.source],h)*f,c+=f}if(!(c>0))continue;let u=(d/c-h.y0)*e;h.y0+=u,h.y1+=u,this.reorderNodeLinks(h)}T(this.options.nodeSortBy)&&o.sort(eC),this.resolveCollisions(o,i)}}relaxRightToLeft(t,e,i){for(let s=t.length-2;s>=0;--s){let n=t[s];for(let o=0,a=n.length;o<a;o++){let l=n[o],h=0,d=0;for(let u=0,p=l.sourceLinks.length;u<p;u++){let m=l.sourceLinks[u],g=m.value*(this._nodeMap[m.target].layer-l.layer);h+=this.sourceTop(l,this._nodeMap[m.target])*g,d+=g}if(!(d>0))continue;let c=(h/d-l.y0)*e;l.y0+=c,l.y1+=c,this.reorderNodeLinks(l)}this.options.nodeSortBy===void 0&&n.sort(eC),this.resolveCollisions(n,i)}}resolveCollisions(t,e){let i=t.length>>1,s=t[i];this.resolveCollisionsBottomToTop(t,s.y0-this._gapY,i-1,e),this.resolveCollisionsTopToBottom(t,s.y1+this._gapY,i+1,e),this.resolveCollisionsBottomToTop(t,this._viewBox.y1,t.length-1,e),this.resolveCollisionsTopToBottom(t,this._viewBox.y0,0,e)}resolveCollisionsTopToBottom(t,e,i,s){for(;i<t.length;++i){let n=t[i],o=(e-n.y0)*s;o>1e-6&&(n.y0+=o,n.y1+=o),e=n.y1+this._gapY}}resolveCollisionsBottomToTop(t,e,i,s){for(;i>=0;--i){let n=t[i],o=(n.y1-e)*s;o>1e-6&&(n.y0-=o,n.y1-=o),e=n.y0-this._gapY}}targetTop(t,e){let i,s,n,o=t.y0-(t.sourceLinks.length-1)*this._gapY/2;for(i=0,s=t.sourceLinks.length;i<s&&(n=t.sourceLinks[i],n.target!==e.key);i++)o+=n.thickness+this._gapY;for(i=0,s=e.targetLinks.length;i<s&&(n=e.targetLinks[i],n.source!==t.key);i++)o-=n.thickness;return o}sourceTop(t,e){let i,s,n,o=e.y0-(e.targetLinks.length-1)*this._gapY/2;for(i=0,s=e.targetLinks.length;i<s&&(n=e.targetLinks[i],n.source!==t.key);i++)o+=n.thickness+this._gapY;for(i=0,s=t.sourceLinks.length;i<s&&(n=t.sourceLinks[i],n.target!==e.key);i++)o-=n.thickness;return o}computeLinkBreadthsNoOverlap(t){for(let e=0,i=t.length;e<i;e++){let s=t[e],n=s.y0,o=!1;for(let l=0,h=s.sourceLinks.length;l<h;l++){let d=s.sourceLinks[l];o||(d.y0=n+d.thickness/2),d.x0=s.x1,n+d.thickness>s.y1||o?(d.y0=s.y1-d.thickness/2,o=!0):n+=d.thickness}let a=s.y0;o=!1;for(let l=0,h=s.targetLinks.length;l<h;l++){let d=s.targetLinks[l];o||(d.y1=a+d.thickness/2),d.x1=s.x0,a+d.thickness>s.y1||o?(d.y1=s.y1-d.thickness/2,o=!0):a+=d.thickness}}}computeLinkBreadthsOverlap(t){let e=this.options.linkOverlap;for(let i=0,s=t.length;i<s;i++){let n=t[i],o=e==="start"?n.y0:e==="end"?n.y1:(n.y0+n.y1)/2,a=e==="start"?.5:e==="end"?-.5:0;for(let l=0,h=n.sourceLinks.length;l<h;l++){let d=n.sourceLinks[l];d.y0=o+a*d.thickness,d.x0=n.x1}for(let l=0,h=n.targetLinks.length;l<h;l++){let d=n.targetLinks[l];d.y1=o+a*d.thickness,d.x1=n.x0}}}computeLinkBreadths(t){this.options.linkOverlap?this.computeLinkBreadthsOverlap(t):this.computeLinkBreadthsNoOverlap(t)}reorderNodeLinks(t){if(T(this.options.linkSortBy)){let e=t.targetLinks,i=t.sourceLinks;for(let s=0,n=e.length;s<n;s++){let o=e[s];this._nodeMap[o.source].sourceLinks.sort(this._ascendingTargetBreadth)}for(let s=0,n=i.length;s<n;s++){let o=i[s];this._nodeMap[o.target].targetLinks.sort(this._ascendingSourceBreadth)}}}reorderLinks(t){if(T(this.options.linkSortBy))for(let e=0,i=t.length;e<i;e++){let s=t[e];s.sourceLinks.sort(this._ascendingTargetBreadth),s.targetLinks.sort(this._ascendingSourceBreadth)}}};am.defaultOptions={iterations:6,nodeAlign:"justify",direction:"horizontal",nodeWidth:24,nodeGap:8,crossNodeAlign:"middle",dropIsolatedNode:!0};var Yw=(r,t,e)=>{t.forEach(i=>{T(i[e])||r.add(i[e]),i.children&&i.children.length>0&&Yw(r,i.children,e)})},YU=r=>{var t;if(!r||!H(r))return[];if(r.length>1){let e={links:[],nodes:[]};return r.forEach(i=>{i.id!=="links"&&i.id!=="nodes"||(e[i.id]=i.values)}),[e]}return!((t=r[0])===null||t===void 0)&&t.latestData?r[0].latestData:r},XU=(r,t)=>{if(!r||!t?.view||!r.length)return[];let e=t.view();if(e.x1-e.x0==0||e.y1-e.y0==0||e.x1-e.x0==-1/0||e.x1-e.x0==1/0||e.y1-e.y0==-1/0||e.y1-e.y0==1/0)return[];let i=r[0];if((t.sourceField!=="source"||t.targetField!=="target"||t.valueField!=="value")&&i.links){let o=[];i.links.forEach(a=>{let l={};for(let h in a)h===t.sourceField?l.source=a[t.sourceField]:h===t.targetField?l.target=a[t.targetField]:h===t.valueField?l.value=a[t.valueField]:l[h]=a[h];o.push(l)}),i.links=o}let s=new am(t),n=[];return n.push(s.layout(i,e)),n};var KU=r=>{var t,e;return r&&H(r)&&(!((t=r[0])===null||t===void 0)&&t.latestData)&&r[0].latestData.length&&r[0].latestData[0]&&(e=r[0].latestData[0].nodes)!==null&&e!==void 0?e:[]};var $U=r=>{var t,e;return r&&H(r)&&(!((t=r[0])===null||t===void 0)&&t.latestData)&&r[0].latestData.length&&r[0].latestData[0]&&(e=r[0].latestData[0].links)!==null&&e!==void 0?e:[]};var iC=class extends he{constructor(){super(...arguments),this._getDimensionData=t=>{if(t.source){if(J(t.source)){let e=this.series.getSeriesKeys();return e[t.source]+" => "+e[t.target]}return t.source+" => "+t.target}return t.datum?t.datum[this.series.getSpec().categoryField]:t.key},this.markTooltipValueCallback=t=>t.value}};var Xw=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,x0:0,y0:0,x1:100,y1:100,thickness:1,round:!0})}_initProduct(t){let e=this.getVGrammarView(),i=this.getProductId(),s=this.getStyle("direction");this._product=e.glyph("linkPath",t??e.rootMark).id(i).configureGlyph({direction:s}),this._compiledProductId=i}};Xw.type="linkPath";var qU=Object.assign(Object.assign({},Ft),{node:{name:"node",type:"rect"},link:{name:"link",type:"linkPath"}});var I0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"node")}};var lm=class r extends ei{constructor(){super(...arguments),this.type=F.sankey,this.transformerConstructor=I0,this._nodeLayoutZIndex=Tt.Node,this._labelLayoutZIndex=Tt.Label,this._viewBox=new Ye,this._fillByNode=t=>{var e,i,s,n,o;if(t&&t.sourceRect&&t.targetRect)return this._fillByLink(t);let a=(i=(e=this._spec.node)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.fill;if(A(a))return a;if(A(this._spec.seriesField)){let l=(n=(s=this._option)===null||s===void 0?void 0:s.globalScale)===null||n===void 0?void 0:n.getScale("color"),h=t?.datum?t.datum:t;return l?.scale(h?.[this._spec.seriesField])}return(o=this._colorScale)===null||o===void 0?void 0:o.scale(this._getNodeNameFromData(t))},this._fillByLink=t=>{var e,i,s,n,o,a,l;let h=(i=(e=this._spec.link)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.fill;if(h)return h;if(A(this._spec.seriesField)){let c=(n=(s=this._nodesSeriesData)===null||s===void 0?void 0:s.getLatestData())===null||n===void 0?void 0:n.find(m=>t.source===m.key),u=c?.datum,p=(a=(o=this._option)===null||o===void 0?void 0:o.globalScale)===null||a===void 0?void 0:a.getScale("color");return p?.scale(u?.[this._spec.seriesField])}let d=J(t.source)?this.getNodeList()[t.source]:t.source;return(l=this._colorScale)===null||l===void 0?void 0:l.scale(d)},this._handleEmphasisElement=t=>{var e,i,s,n,o;let a=(e=this._spec.emphasis)!==null&&e!==void 0?e:{},l=t.item;a.effect==="adjacency"?l&&l.mark===((i=this._nodeMark)===null||i===void 0?void 0:i.getProduct())?this._handleNodeAdjacencyClick(l):l&&l.mark===((s=this._linkMark)===null||s===void 0?void 0:s.getProduct())?this._handleLinkAdjacencyClick(l):this._handleClearEmpty():a.effect==="related"&&(l&&l.mark===((n=this._nodeMark)===null||n===void 0?void 0:n.getProduct())?this._handleNodeRelatedClick(l):l&&l.mark===((o=this._linkMark)===null||o===void 0?void 0:o.getProduct())?this._handleLinkRelatedClick(l):this._handleClearEmpty())},this._handleClearEmpty=()=>{var t,e;if(!this._needClear)return;let i=(t=this._nodeMark)===null||t===void 0?void 0:t.getProductElements();if(!i||!i.length)return;let s=(e=this._linkMark)===null||e===void 0?void 0:e.getProductElements();if(!s||!s.length)return;let n=[it.STATE_SANKEY_EMPHASIS,it.STATE_SANKEY_EMPHASIS_REVERSE];i.forEach(o=>{o.removeState(n)}),s.forEach(o=>{o.removeState(n)}),this._needClear=!1},this._handleNodeAdjacencyClick=t=>{let e=t.getDatum(),i=[e.key];if(this._linkMark){let s=this._linkMark.getProductElements();if(!s||!s.length)return;s.forEach((n,o)=>{let a=n.getDatum();a.source===e.key?(i.includes(a.target)||i.push(a.target),n.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),n.addState(it.STATE_SANKEY_EMPHASIS)):a.target===e.key?(i.includes(a.source)||i.push(a.source),n.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),n.addState(it.STATE_SANKEY_EMPHASIS)):(n.removeState(it.STATE_SANKEY_EMPHASIS),n.addState(it.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),i),this._needClear=!0},this._handleLinkAdjacencyClick=t=>{let e=t.getDatum(),i=[e.source,e.target];if(this._linkMark){let s=this._linkMark.getProductElements();if(!s||!s.length)return;s.forEach(n=>{n===t?(n.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),n.addState(it.STATE_SANKEY_EMPHASIS,{ratio:1})):(n.removeState(it.STATE_SANKEY_EMPHASIS),n.addState(it.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),i),this._needClear=!0},this._handleNodeRelatedClick=t=>{var e;let i=t.getDatum(),s=this._nodeMark.getProductElements();if(!s||!s.length)return;let n=this._linkMark.getProductElements();if(!n||!n.length)return;let o=!((e=n[0].getDatum())===null||e===void 0)&&e.parents?"parents":"source";if(o==="source"){let a=[i.key],l=[];if(n.forEach((h,d)=>{var c,u,p,m;let g=h.getDatum(),f=g?.parents?"parents":"source";if(O(g[f]).includes(i.key)){if(l.includes((c=g.key)!==null&&c!==void 0?c:g.index)||l.push((u=g.key)!==null&&u!==void 0?u:g.index),a.includes(g.source)||a.push(g.source),!a.includes(g.target)){a.push(g.target);let _=s.find(v=>v.data[0].key===g.target).data[0].sourceLinks;for(;_?.length>0;){let v=[];return _.forEach(x=>{var y,b;if(!l.includes((y=x.key)!==null&&y!==void 0?y:x.index)&&(l.push((b=x.key)!==null&&b!==void 0?b:x.index),!a.includes(x.target))){a.push(x.target);let S=s.find(C=>C.data[0].key===x.target);v.push(S.data[0].targetLinks)}}),void(_=v)}}}else if(g.target===i.key&&(l.includes((p=g.key)!==null&&p!==void 0?p:g.index)||l.push((m=g.key)!==null&&m!==void 0?m:g.index),!a.includes(g.source))){a.push(g.source);let _=s.find(v=>v.data[0].key===g.source).data[0].targetLinks;for(;_?.length>0;){let v=[];return _.forEach(x=>{var y,b;if(!l.includes((y=x.key)!==null&&y!==void 0?y:x.index)&&(l.push((b=x.key)!==null&&b!==void 0?b:x.index),!a.includes(x.source))){a.push(x.source);let S=s.find(C=>C.data[0].key===x.source);v.push(S.data[0].targetLinks)}}),void(_=v)}}}),this._linkMark){let h=this._linkMark.getProductElements();if(!h||!h.length)return;h.forEach((d,c)=>{var u;l.includes((u=d.getDatum().key)!==null&&u!==void 0?u:d.getDatum().index)?(d.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),d.addState(it.STATE_SANKEY_EMPHASIS)):(d.removeState(it.STATE_SANKEY_EMPHASIS),d.addState(it.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),a)}else{let a=[i.key],l=i.targetLinks.reduce((h,d)=>(O(d.datum).forEach(c=>{let u=c.parents,p=u.length;for(let m=0;m<p;m++){let g=u[m].key,f=u[m+1]?u[m+1].key:i.key,_=c.value,v=h.find(x=>x.source===g&&x.target===f);v?v.value+=_:h.push({source:g,target:f,value:_})}}),h),[]);n.forEach((h,d)=>{let c=h.getDatum(),u=c.datum,p=u?u.filter(g=>g[o].some(f=>f.key===i.key)):null,m=l.find(g=>g.source===c.source&&g.target===c.target);if(p&&p.length){a.includes(c.source)||a.push(c.source),a.includes(c.target)||a.push(c.target);let g=p.reduce((f,_)=>f+_.value,0)/c.value;return h.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),void h.addState(it.STATE_SANKEY_EMPHASIS,{ratio:g})}if(m)return a.includes(c.source)||a.push(c.source),a.includes(c.target)||a.push(c.target),h.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),void h.addState(it.STATE_SANKEY_EMPHASIS,{ratio:m.value/c.value});h.removeState(it.STATE_SANKEY_EMPHASIS),h.addState(it.STATE_SANKEY_EMPHASIS_REVERSE)}),this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),a)}this._needClear=!0},this._handleLinkRelatedClick=t=>{var e;let i=this._nodeMark.getProductElements();if(!i||!i.length)return;let s=this._linkMark.getProductElements();if(!(!s||!s.length)){if((!((e=t.getDatum())===null||e===void 0)&&e.parents?"parents":"source")=="source"){let n=[it.STATE_SANKEY_EMPHASIS,it.STATE_SANKEY_EMPHASIS_REVERSE];this._linkMark&&s.forEach(o=>{o.removeState(n)}),this._nodeMark&&i.forEach(o=>{o.removeState(n)})}else{let n=t.getDatum(),o=[n.source,n.target],a=[];O(n.datum).forEach(l=>{let h=l.parents,d=h.length;for(let c=0;c<d-1;c++){let u=h[c].key,p=h[c+1].key,m=l.value,g=a.find(f=>f.source===u&&f.target===p);a.push({source:h[c].key,target:h[c+1].key,value:l.value}),g?g.value+=m:a.push({source:u,target:p,value:m})}}),s.forEach(l=>{let h=l.getDatum(),d=h.datum;if(h.source===n.source&&h.target===n.target)return l.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(it.STATE_SANKEY_EMPHASIS,{ratio:1});let c=d?d.filter(p=>{let m=p.parents.map(g=>g.key);return m.includes(n.source)&&m.includes(n.target)}):null;if(c&&c.length){o.includes(h.source)||o.push(h.source),o.includes(h.target)||o.push(h.target);let p=c.filter(g=>g.parents.some((f,_)=>{var v;return f.key===n.source&&((v=g.parents[_+1])===null||v===void 0?void 0:v.key)===n.target})).reduce((g,f)=>g+f.value,0),m=p/h.value;return l.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(it.STATE_SANKEY_EMPHASIS,{ratio:m})}let u=a.find(p=>p.source===h.source&&p.target===h.target);if(u)return o.includes(h.source)||o.push(h.source),o.includes(h.target)||o.push(h.target),l.removeState(it.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(it.STATE_SANKEY_EMPHASIS,{ratio:u.value/h.value});l.removeState(it.STATE_SANKEY_EMPHASIS),l.addState(it.STATE_SANKEY_EMPHASIS_REVERSE)}),this._highLightElements(i,o)}this._needClear=!0}}}get direction(){var t;return(t=this._spec.direction)!==null&&t!==void 0?t:"horizontal"}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:this._spec.categoryField)}initData(){var t,e,i,s;super.initData();let n=this.getViewData(),o=this.getRawData();if(o&&n){nt(this._dataSet,"sankeyLayout",XU),nt(this._dataSet,"sankeyFormat",YU),o.transform({type:"sankeyFormat"},!1),n.transform({type:"sankeyLayout",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),sourceField:this._spec.sourceField,targetField:this._spec.targetField,valueField:this._spec.valueField,direction:this.direction,crossNodeAlign:this._spec.crossNodeAlign,nodeAlign:(t=this._spec.nodeAlign)!==null&&t!==void 0?t:"justify",nodeGap:(e=this._spec.nodeGap)!==null&&e!==void 0?e:8,nodeWidth:(i=this._spec.nodeWidth)!==null&&i!==void 0?i:10,linkWidth:this._spec.linkWidth,minStepWidth:this._spec.minStepWidth,minNodeHeight:(s=this._spec.minNodeHeight)!==null&&s!==void 0?s:4,maxNodeHeight:this._spec.maxNodeHeight,minLinkHeight:this._spec.minLinkHeight,maxLinkHeight:this._spec.maxLinkHeight,iterations:this._spec.iterations,nodeKey:this._spec.nodeKey,linkSortBy:this._spec.linkSortBy,nodeSortBy:this._spec.nodeSortBy,setNodeLayer:this._spec.setNodeLayer,dropIsolatedNode:this._spec.dropIsolatedNode,nodeHeight:this._spec.nodeHeight,linkHeight:this._spec.linkHeight,equalNodeHeight:this._spec.equalNodeHeight,linkOverlap:this._spec.linkOverlap,inverse:this._spec.inverse},level:Ki.sankeyLayout});let{dataSet:a}=this._option;nt(a,"sankeyNodes",KU),nt(a,"flatten",Ro);let l=new St(a,{name:`sankey-node-${this.id}-data`});l.parse([this.getViewData()],{type:"dataview"}),l.transform({type:"sankeyNodes"}),l.transform({type:"flatten",options:{callback:d=>{if(d.datum){let c=d.datum[d.depth];return Object.assign(Object.assign({},d),c)}return d}}},!1),l.transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1),this._nodesSeriesData=new yi(this._option,l),nt(a,"sankeyLinks",$U);let h=new St(a,{name:`sankey-link-${this.id}-data`});h.parse([this.getViewData()],{type:"dataview"}),h.transform({type:"sankeyLinks"}),h.transform({type:"addVChartProperty",options:{beforeCall:Eo.bind(this),call:In}},!1),this._linksSeriesData=new yi(this._option,h)}}compileData(){var t,e;super.compileData(),(t=this._linksSeriesData)===null||t===void 0||t.compile(),(e=this._nodesSeriesData)===null||e===void 0||e.compile()}initMark(){var t,e,i,s;this._rootMark.setMarkConfig({overflow:this._spec.overflow,interactive:!!this._spec.overflow});let n=this._createMark(r.mark.node,{isSeriesMark:!0,dataView:this._nodesSeriesData.getDataView(),dataProductId:this._nodesSeriesData.getProductId(),stateSort:(t=this._spec.node)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.node)===null||e===void 0?void 0:e.customShape});n&&(n.setMarkConfig({zIndex:this._nodeLayoutZIndex}),this._nodeMark=n);let o=this._createMark(r.mark.link,{dataView:this._linksSeriesData.getDataView(),dataProductId:this._linksSeriesData.getProductId(),stateSort:(i=this._spec.link)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(s=this._spec.link)===null||s===void 0?void 0:s.customShape});o&&(this._linkMark=o)}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToNode=this.valueToNode.bind(this),this._markAttributeContext.valueToLink=this.valueToLink.bind(this)}valueToNode(t){let e=this._nodesSeriesData.getLatestData(),i=O(t)[0];return e&&e.find(s=>s.key===i)}valueToLink(t){let e=this._linksSeriesData.getLatestData(),i=O(t);return e&&e.find(s=>s&&s.source===i[0]&&s.target===i[1])}valueToPositionX(t){let e=this.valueToNode(t);return e?.x0}valueToPositionY(t){let e=this.valueToNode(t);return e?.y0}initMarkStyle(){this._initNodeMarkStyle(),this._initLinkMarkStyle()}_initNodeMarkStyle(){var t,e;let i=this._nodeMark;i&&(this.setMarkStyle(i,{x:s=>s.x0,x1:s=>s.x1,y:s=>s.y0,y1:s=>s.y1},it.STATE_NORMAL,X.Mark),this.setMarkStyle(i,{fill:(e=(t=this._spec.node.style)===null||t===void 0?void 0:t.fill)!==null&&e!==void 0?e:this._fillByNode},"normal",X.User_Mark))}_initLinkMarkStyle(){var t,e;let i=this._linkMark;i&&(this.setMarkStyle(i,{x0:s=>s.x0,x1:s=>s.x1,y0:s=>s.y0,y1:s=>s.y1,thickness:s=>s.thickness,direction:this.direction},it.STATE_NORMAL,X.Series),this.setMarkStyle(i,{fill:(e=(t=this._spec.link.style)===null||t===void 0?void 0:t.fill)!==null&&e!==void 0?e:this._fillByLink},"normal",X.User_Mark))}initLabelMarkStyle(t,e){if(!t)return;let i=e.position;i&&i.includes("inside")?this.setMarkStyle(t,{fill:"#ffffff",text:s=>this._createText(s,e),maxLineWidth:s=>{var n;return(n=e.limit)!==null&&n!==void 0?n:s.x1-s.x0}}):this.setMarkStyle(t,{fill:this._fillByNode,text:s=>this._createText(s,e),maxLineWidth:e.limit}),t.setMarkConfig({zIndex:this._labelLayoutZIndex})}_createText(t,e){if(T(t)||T(t.datum))return"";let i=t.datum[this._spec.categoryField]||"",{formatMethod:s,formatter:n}=e||{},{formatFunc:o,args:a}=_r(s,n,i,t.datum);return o&&(i=o(...a,{series:this})),i}initAnimation(){var t,e,i,s;let n={direction:this.direction,growFrom:()=>{var a,l;return this.direction==="horizontal"?(a=this._xAxisHelper)===null||a===void 0?void 0:a.getScale(0).scale(0):(l=this._yAxisHelper)===null||l===void 0?void 0:l.getScale(0).scale(0)}},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._nodeMark&&this._nodeMark.setAnimationConfig(_t((i=I.getAnimationInKey("sankeyNode"))===null||i===void 0?void 0:i(n,o),xt("node",this._spec,this._markAttributeContext))),this._linkMark&&this._linkMark.setAnimationConfig(_t((s=I.getAnimationInKey("sankeyLinkPath"))===null||s===void 0?void 0:s(n,o),xt("link",this._spec,this._markAttributeContext)))}initEvent(){var t,e,i;super.initEvent(),(t=this._nodesSeriesData.getDataView())===null||t===void 0||t.target.addListener("change",this.nodesSeriesDataUpdate.bind(this)),(e=this._linksSeriesData.getDataView())===null||e===void 0||e.target.addListener("change",this.linksSeriesDataUpdate.bind(this));let s=(i=this._spec.emphasis)!==null&&i!==void 0?i:{};if(this._option.disableTriggerEvent!==!0&&s.enable&&(s.effect==="adjacency"||s.effect==="related")){let n=s.trigger==="hover"?"pointerover":"pointerdown";this.event.on(n,{level:Se.chart},this._handleEmphasisElement)}}nodesSeriesDataUpdate(){this._nodesSeriesData.updateData(),this._nodeList=null,this._setNodeOrdinalColorScale()}linksSeriesDataUpdate(){this._linksSeriesData.updateData()}_highLightElements(t,e){t&&t.length&&t.forEach(i=>{i.removeState([it.STATE_SANKEY_EMPHASIS_REVERSE,it.STATE_SANKEY_EMPHASIS]),e.includes(i.getDatum().key)?i.addState(it.STATE_SANKEY_EMPHASIS):i.addState(it.STATE_SANKEY_EMPHASIS_REVERSE)})}initTooltip(){this._tooltipHelper=new iC(this),this._nodeMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodeMark),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark)}_setNodeOrdinalColorScale(){var t,e,i,s,n;let o=(e=(t=this._option)===null||t===void 0?void 0:t.globalScale)===null||e===void 0?void 0:e.getScale("color");if(o?._specified)return void(this._colorScale=o);let a,l;o&&(a=o.domain(),l=o.range()),l||(l=this._getDataScheme()),a&&!T(a[0])||(a=this.getNodeList(),a.length>10&&(l=(i=this._getDataScheme()[1])===null||i===void 0?void 0:i.scheme));let h=new qs;(n=(s=h.domain(a)).range)===null||n===void 0||n.call(s,l),this._colorScale=h}getNodeList(){var t,e;if(this._nodeList)return this._nodeList;let i=this._rawData.latestData[0],s=i?.nodes?!((t=i.nodes[0])===null||t===void 0)&&t.children?Array.from(this.extractNamesFromTree(i.nodes,this._spec.categoryField)):i.nodes.map((n,o)=>n[this._spec.categoryField]):i?.links?Array.from(this.extractNamesFromLink(i.links)):(e=i?.values)===null||e===void 0?void 0:e.map((n,o)=>n[this._spec.categoryField]);return this._nodeList=s,s}_getNodeNameFromData(t){var e;return t?.datum?t.datum[this._spec.categoryField]:(e=t.key)!==null&&e!==void 0?e:t[this._spec.categoryField]}extractNamesFromTree(t,e){let i=new Set;return t.forEach(s=>{i.add(s[e]),s.children&&this.extractNamesFromTree(s.children,e).forEach(n=>i.add(n))}),i}extractNamesFromLink(t){let e=new Set,{sourceField:i,targetField:s}=this._spec;return t.forEach(n=>{A(n[i])&&e.add(n[i]),A(n[s])&&e.add(n[s])}),e}getDimensionField(){return[this._spec.categoryField]}getMeasureField(){return[this._valueField]}getRawDataStatisticsByField(t,e){var i;return this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]&&(this._viewDataStatistics&&this.getViewData().transformsArr.length<=1&&(!((i=this._viewDataStatistics.latestData)===null||i===void 0)&&i[t])?this._rawStatisticsCache[t]=this._viewDataStatistics.latestData[t]:this._rawData&&(this._rawStatisticsCache[t]={values:this._collectByField(t)})),this._rawStatisticsCache[t]}_collectByField(t){var e,i,s;let n=[],o=(i=(e=this.getRawData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i[0];if(!o)return[];if(o.links)!((s=o.nodes)===null||s===void 0)&&s.length&&o.nodes.forEach(a=>{a[this._seriesField]&&n.push(a[this._seriesField])});else if(o.nodes){let a=new Set;return Yw(a,o.nodes,this._seriesField),Array.from(a)}return n}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this.getViewData().reRunAllTransform()}getDefaultShapeType(){return"square"}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._nodeMark,this._linkMark]}getMarkData(t){return t.datum?H(t.datum)?t.datum[t.datum.length-1]:t.datum:t}};lm.type=F.sankey,lm.transformerConstructor=I0,lm.mark=qU;var Kw=(r,t)=>{let e={},i=t.fields;if(V(i)&&(i=i()),!i?.length||!r?.length||!r[0].latestData)return e;let s=r[0].latestData,n=Ro(s);return e=U_([{latestData:n}],t),e};var rC=class extends he{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>{var e,i;return(i=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t))===null||i===void 0?void 0:i[this.series.getDimensionField()[0]]},this.markTooltipValueCallback=t=>{var e,i;let{measureFields:s}=this._seriesCacheInfo,n=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t);if(s[0]&&n)return(i=n[s[0]])!==null&&i!==void 0?i:t.value},this.dimensionTooltipTitleCallback=t=>{var e;let{dimensionFields:i}=this._seriesCacheInfo,s=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t);if(i[0]&&s)return s[i[0]]}}get defaultShapeType(){return"square"}};var ZU=Object.assign(Object.assign({},Ft),{nonLeaf:{name:"nonLeaf",type:"rect"},leaf:{name:"leaf",type:"rect"},nonLeafLabel:{name:"nonLeafLabel",type:"text"}});var F0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"nonLeaf","nonLeafLabel","initNonLeafLabelMarkStyle"),this._addMarkLabelSpec(t,"leaf")}};var ah=class r extends ei{constructor(){super(...arguments),this.type=F.treemap,this.transformerConstructor=F0,this._categoryField="name",this._valueField="value",this._viewBox=new Ye,this._enableAnimationHook=this.enableMarkAnimation.bind(this),this.isHierarchyData=()=>!0}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:rn),this._spec.roam&&(this.initZoomable(this.event,this._option.mode),this._matrix=new Kt),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e,i;return(i=(e=this._spec.drillField)!==null&&e!==void 0?e:this._categoryField)!==null&&i!==void 0?i:ki},getRawData:()=>this.getRawData()}),K(this._spec.maxDepth)&&(this._maxDepth=this._spec.maxDepth-1)}initData(){super.initData(),this.getViewData()&&this._spec.drill&&this.initDrillableData(this._dataSet)}compile(){super.compile(),this._runTreemapTransform()}_runTreemapTransform(t=!1){var e,i,s,n;let o=this._data.getProduct();o&&o.transform([{type:"treemap",nameField:this._categoryField,valueField:this._valueField,x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2,maxDepth:this._maxDepth,gapWidth:this._spec.gapWidth,padding:this._spec.nodePadding,splitType:this._spec.splitType,aspectRatio:this._spec.aspectRatio,labelPadding:!((e=this._spec.nonLeafLabel)===null||e===void 0)&&e.visible?(i=this._spec.nonLeafLabel)===null||i===void 0?void 0:i.padding:0,labelPosition:(s=this._spec.nonLeafLabel)===null||s===void 0?void 0:s.position,minVisibleArea:(n=this._spec.minVisibleArea)!==null&&n!==void 0?n:10,minChildrenVisibleArea:this._spec.minChildrenVisibleArea,minChildrenVisibleSize:this._spec.minChildrenVisibleSize,flatten:!0},{type:"map",callback:a=>(a&&[rn,"name"].forEach(l=>{a[l]=a.datum[a.depth][this._categoryField]}),a)}]),t&&this.getCompiler().renderNextTick()}_addDataIndexAndKey(){var t;!((t=this._rawData)===null||t===void 0)&&t.dataSet&&(nt(this._rawData.dataSet,"addVChartProperty",en),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:xp.bind(this),call:Pd}}))}getRawDataStatisticsByField(t,e){var i;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]&&this._rawData){let s=Kw([this._rawData],{fields:[{key:t,operations:e?["min","max"]:["values"]}]})[t];this._rawStatisticsCache[t]=G((i=this._rawStatisticsCache[t])!==null&&i!==void 0?i:{},s)}return this._rawStatisticsCache[t]}_createHierarchyDataStatistics(t,e){nt(this._dataSet,"hierarchyDimensionStatistics",Kw),nt(this._dataSet,"flatten",Ro);let i=new St(this._dataSet,{name:t});return i.parse(e,{type:"dataview"}),i.transform({type:"hierarchyDimensionStatistics",options:{fields:()=>{let s=this.getStatisticFields();return this._seriesField&&this._seriesField!==this._categoryField&&s.push({key:this._seriesField,operations:["values"]}),s}}},!1),i}getStatisticFields(){return Ip(super.getStatisticFields(),this._categoryField,this._valueField)}initMark(){var t,e,i,s;let n=this._createMark(r.mark.nonLeaf,{isSeriesMark:!0,stateSort:(t=this._spec.nonLeaf)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.nonLeaf)===null||e===void 0?void 0:e.customShape});n&&(n.setTransform([{type:"filter",callback:a=>!this._shouldFilterElement(a,"nonLeaf")}]),this._nonLeafMark=n);let o=this._createMark(r.mark.leaf,{isSeriesMark:!0,stateSort:(i=this._spec.leaf)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(s=this._spec.leaf)===null||s===void 0?void 0:s.customShape});o&&(o.setTransform([{type:"filter",callback:a=>!this._shouldFilterElement(a,"leaf")}]),this._leafMark=o)}initMarkStyle(){this._initLeafMarkStyle(),this._initNonLeafMarkStyle()}_initLeafMarkStyle(){this._leafMark&&this.setMarkStyle(this._leafMark,{x:t=>t.x0,y:t=>t.y0,x1:t=>t.x1,y1:t=>t.y1,fill:this.getColorAttribute()},it.STATE_NORMAL,X.Series)}_initNonLeafMarkStyle(){this._nonLeafMark&&this.setMarkStyle(this._nonLeafMark,{x:t=>t.x0,y:t=>t.y0,x1:t=>t.x1,y1:t=>t.y1,fill:this.getColorAttribute()},it.STATE_NORMAL,X.Series)}_initRichStyleOfLabelMark(t){t.getTextType()==="rich"&&this.setMarkStyle(t,{maxWidth:e=>Math.abs(e.x0-e.x1),maxHeight:e=>Math.abs(e.y0-e.y1),ellipsis:!0},it.STATE_NORMAL,X.Series)}initLabelMarkStyle(t){t&&(this._labelMark=t,t.setRule("treemap"),this.setMarkStyle(t,{x:e=>(e.x0+e.x1)/2,y:e=>(e.y0+e.y1)/2,text:e=>{var i;return(i=e.datum[e.depth])===null||i===void 0?void 0:i[this.getDimensionField()[0]]},maxLineWidth:e=>e.x1===e.x0?Number.MIN_VALUE:e.x1-e.x0},it.STATE_NORMAL,X.Series),this._initRichStyleOfLabelMark(t))}initNonLeafLabelMarkStyle(t){t&&(this._nonLeafLabelMark=t,t.setRule("treemap"),this.setMarkStyle(t,{x:e=>e.labelRect?(e.labelRect.x0+e.labelRect.x1)/2:(e.x0+e.x1)/2,y:e=>e.labelRect?(e.labelRect.y0+e.labelRect.y1)/2:(e.y0+e.y1)/2,text:e=>{var i;return(i=e.datum[e.depth])===null||i===void 0?void 0:i[this.getDimensionField()[0]]},maxLineWidth:e=>e.x1===e.x0?Number.MIN_VALUE:e.x1-e.x0},it.STATE_NORMAL,X.Series),this._initRichStyleOfLabelMark(t))}initAnimation(){this.getMarksInType("rect").forEach(t=>{var e;t.setAnimationConfig(_t((e=I.getAnimationInKey("treemap"))===null||e===void 0?void 0:e(),xt(t.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.roam&&(this.initDragEventOfSeries(this),this.event.on("panmove",t=>{this.handlePan(t)}),this.initZoomEventOfSeries(this),this.event.on("zoom",t=>{this.handleZoom(t)})),this._spec.drill&&this.bindDrillEvent()}_getDataIdKey(){return"key"}initTooltip(){this._tooltipHelper=new rC(this),this._leafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._leafMark),this._nonLeafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nonLeafMark)}_shouldFilterElement(t,e){let i=t.isLeaf;return e==="leaf"?!i:i}handlePan(t){let{delta:e}=t;if(e[0]===0&&e[1]===0)return;this._matrix.reset(),this._matrix.translate(e[0],e[1]);let{a:i,b:s,c:n,d:o,e:a,f:l}=this._matrix;this._matrix.multiply(i,s,n,o,a,l),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}handleZoom(t){let{scale:e,scaleCenter:i}=t;if(e===1)return;this._matrix.reset();let{x:s,y:n}=i;this._matrix.translate(s,n),this._matrix.scale(e,e),this._matrix.translate(-s,-n);let{a:o,b:a,c:l,d:h,e:d,f:c}=this._matrix;this._matrix.multiply(o,a,l,h,d,c),this.disableMarkAnimation(),this.event.on(pt.AFTER_DO_RENDER,this._enableAnimationHook),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this.getLayoutRect().width,this.getLayoutRect().height),this._runTreemapTransform()}enableMarkAnimation(){this.getMarks().forEach(t=>{var e;(e=t.getProduct().animate)===null||e===void 0||e.enable()}),[this._labelMark,this._nonLeafLabelMark].forEach(t=>{t&&t.getComponent()&&t.getComponent().getProduct().getGroupGraphicItem().enableAnimation()}),this.event.off(pt.AFTER_DO_RENDER,this._enableAnimationHook)}disableMarkAnimation(){this.getMarks().forEach(t=>{var e;(e=t.getProduct().animate)===null||e===void 0||e.disable()}),[this._labelMark,this._nonLeafLabelMark].forEach(t=>{t&&t.getComponent()&&t.getComponent().getProduct().getGroupGraphicItem().disableAnimation()})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._nonLeafMark,this._leafMark]}getMarkData(t){return t?.datum?t.datum[t.datum.length-1]:t}};ah.type=F.treemap,ah.mark=ZU,ah.transformerConstructor=F0,Ct(ah,Ul),Ct(ah,sh);var JU=Object.assign(Object.assign({},Ft),{nodePoint:{name:"nodePoint",type:"symbol"},ripplePoint:{name:"ripplePoint",type:"ripple"},centerPoint:{name:"centerPoint",type:"symbol"},centerLabel:{name:"centerLabel",type:"text"}});var sC=`${et}_CORRELATION_X`,nC=`${et}_CORRELATION_Y`,oC=`${et}_CORRELATION_SIZE`;var QU=(r,t)=>{var e,i,s,n,o,a,l,h,d,c,u,p,m,g,f;if(!r||!t?.view||!H(r))return r;let _=t.view();if(_.x1-_.x0==0||_.y1-_.y0==0||_.x1-_.x0==-1/0||_.x1-_.x0==1/0||_.y1-_.y0==-1/0||_.y1-_.y0==1/0)return r;let v=Ut((e=t.startAngle)!==null&&e!==void 0?e:-90),x=Ut((i=t.endAngle)!==null&&i!==void 0?i:270),y=Math.max((_.x1-_.x0)/2,(_.y1-_.y0)/2),b=es((s=t.innerRadius)!==null&&s!==void 0?s:0,y),S=es(t.outerRadius,y),C=[J((n=t.center)===null||n===void 0?void 0:n[0])?t.center[0]:_.x0+es((a=(o=t.center)===null||o===void 0?void 0:o[0])!==null&&a!==void 0?a:"50%",_.x1-_.x0),J((l=t.center)===null||l===void 0?void 0:l[1])?t.center[1]:_.y0+es((d=(h=t.center)===null||h===void 0?void 0:h[1])!==null&&d!==void 0?d:"50%",_.y1-_.y0)],k=Ur(t.field),M=r.map(k),[E,D]=cb(M),P=E===D?$=>(b+S)/2:$=>b+(S-b)*($-E)/(D-E),B=T(t.radiusField)?k:Ur(t.radiusField),L=(u=(c=t?.radiusRange)===null||c===void 0?void 0:c[1])!==null&&u!==void 0?u:5,w=$=>L;if(B){let[$,ut]=B!==k?cb(r.map(B)):[E,D],mt=(m=(p=t.radiusRange)===null||p===void 0?void 0:p[0])!==null&&m!==void 0?m:5,bt=(f=(g=t.radiusRange)===null||g===void 0?void 0:g[1])!==null&&f!==void 0?f:5;$!==ut&&(w=Ot=>mt+(bt-mt)*(B(Ot)-$)/(ut-$))}let R=Math.min(v,x),N=Math.max(v,x),z=qq(R,N,r.length),Y=[],U=(N-R)/60;return r.forEach(($,ut)=>{let mt=P(M[ut]),bt=w($),Ot,me,Lt=z[ut];for(let Ht=0;Ht<60&&(Ot=C[0]+mt*Math.cos(Lt),me=C[1]+mt*Math.sin(Lt),Zq({x:Ot,y:me,size:bt},Y)||Ot-bt<_.x0||Ot+bt>_.x1||me-bt<_.y0||me+bt>_.y1);Ht++)Ht<59&&(Lt+=U,Lt>N?Lt=R:Lt<R&&(Lt=N));Y.push(Object.assign({[sC]:Ot,[nC]:me,[oC]:bt},$))}),Y},qq=(r,t,e)=>{let i=0,s=Math.max(Math.ceil(2*(t-r)/Math.PI),2),n=(t-r)/s,o=0,a=1,l=0,h=0,d=[],c=r;for(;l<e;)h<s&&(d.push(c+(h%2?Math.floor(h/2)+Math.floor(s/2):h/2)*n*a),h++),l++,h===s&&(h=0,o+=1,a*=-1,i===0?i=n/2:i/=2,c=a===-1?t-i:r+i,o>=2&&(n/=2,s*=2));return d},Zq=(r,t)=>!(!t||!t.length)&&t.some(e=>Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)<Math.pow(r.size+e.size,2));var t5=(r,t)=>{if(!r||!H(r))return[];let{keyword:e,categoryField:i}=t,s=r[0].latestData[0];return{[i]:e,[$e]:s?.[$e],[ui]:s?.[ui]}};var $w=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,ripple:0})}_initProduct(t){let e=this.getVGrammarView(),i=this.getProductId();this._product=e.glyph("ripplePoint",t??e.rootMark).id(i),this._compiledProductId=i}};$w.type="ripple";var O0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"nodePoint"),this._addMarkLabelSpec(t,"centerPoint","centerLabel")}};var hm=class r extends ks{constructor(){super(...arguments),this.type=F.correlation,this.transformerConstructor=O0,this._viewBox=new Ye}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}getSeriesField(){return this._seriesField}setSeriesField(t){A(t)&&(this._seriesField=t)}getSizeField(){return this._sizeField}setSizeField(t){A(t)&&(this._sizeField=t)}getSizeRange(){return this._sizeRange}setSizeRange(t){A(t)&&(this._sizeRange=t)}setAttrFromSpec(){super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField(this._spec.seriesField),this.setSizeField(this._spec.sizeField),this.setSizeRange(this._spec.sizeRange)}initData(){var t,e,i;if(super.initData(),!this._data)return;nt(this._dataSet,"correlation",QU);let s=new Ar;hs(s,"dataview",zo),nt(s,"correlationCenter",t5);let n=new St(s,{name:`${this.type}_${this.id}_center`});n.parse([this.getViewData()],{type:"dataview"}),n.transform({type:"correlationCenter",options:{keyword:(i=(e=(t=this._spec.centerLabel)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.text)!==null&&i!==void 0?i:"",categoryField:this._spec.categoryField}}),this._centerSeriesData=new yi(this._option,n)}compileData(){var t;super.compileData(),(t=this._centerSeriesData)===null||t===void 0||t.compile()}_statisticViewData(){super._statisticViewData(),this._data.getDataView().transform({type:"correlation",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),field:this._spec.valueField,radiusRange:this._spec.sizeRange,radiusField:this._spec.sizeField,center:[this._spec.centerX,this._spec.centerY],innerRadius:this._spec.innerRadius,outerRadius:this._spec.outerRadius,startAngle:this._spec.startAngle,endAngle:this._spec.endAngle}})}initMark(){var t,e,i,s;let n=this._createMark(r.mark.nodePoint,{groupKey:this._seriesField,isSeriesMark:!0,key:$e,stateSort:(t=this._spec.nodePoint)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.nodePoint)===null||e===void 0?void 0:e.customShape});n&&(n.setMarkConfig({zIndex:Tt.Node}),this._nodePointMark=n);let o=this._createMark(r.mark.ripplePoint,{key:$e,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId()});o&&(this._ripplePointMark=o);let a=this._createMark(r.mark.centerPoint,{key:$e,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId(),stateSort:(i=this._spec.centerPoint)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(s=this._spec.centerPoint)===null||s===void 0?void 0:s.customShape});a&&(a.setMarkConfig({zIndex:Tt.Node}),this._centerPointMark=a)}initMarkStyle(){this._initNodePointMarkStyle(),this._initRipplePointMarkStyle(),this._initCenterPointMarkStyle()}_initNodePointMarkStyle(){var t,e,i,s;let n=this._nodePointMark;if(!n)return;let o=(e=(t=this._spec.nodePoint)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this.setMarkStyle(n,{x:a=>a[sC],y:a=>a[nC],size:a=>a[oC],fill:(i=o.fill)!==null&&i!==void 0?i:this.getColorAttribute(),fillOpacity:(s=o.fillOpacity)!==null&&s!==void 0?s:1,lineWidth:0},it.STATE_NORMAL,X.Series)}_initRipplePointMarkStyle(){var t,e,i,s,n;let o=this._ripplePointMark;if(!o)return;let a=(e=(t=this._spec.ripplePoint)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this.setMarkStyle(o,{x:()=>{var l;return(l=this._spec.centerX)!==null&&l!==void 0?l:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var l;return(l=this._spec.centerY)!==null&&l!==void 0?l:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(i=a.fill)!==null&&i!==void 0?i:this.getColorAttribute(),opacity:(s=a.fillOpacity)!==null&&s!==void 0?s:.2,ripple:(n=a.ripple)!==null&&n!==void 0?n:0},it.STATE_NORMAL,X.Series)}_initCenterPointMarkStyle(){var t,e,i,s,n,o;let a=this._centerPointMark;a&&this.setMarkStyle(a,{x:()=>{var l;return(l=this._spec.centerX)!==null&&l!==void 0?l:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var l;return(l=this._spec.centerY)!==null&&l!==void 0?l:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>.2*Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(i=(e=(t=this._spec.centerPoint)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.fill)!==null&&i!==void 0?i:this.getColorAttribute(),fillOpacity:(o=(n=(s=this._spec.centerPoint)===null||s===void 0?void 0:s.style)===null||n===void 0?void 0:n.fillOpacity)!==null&&o!==void 0?o:1},it.STATE_NORMAL,X.Series)}initTooltip(){super.initTooltip(),this._nodePointMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodePointMark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this._categoryField],z:this.dataToPositionZ.bind(this)},it.STATE_NORMAL,X.Series)}initAnimation(){var t,e;let i=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;this._nodePointMark.setAnimationConfig(_t((e=I.getAnimationInKey("correlation"))===null||e===void 0?void 0:e({},i),xt("nodePoint",this._spec,this._markAttributeContext)))}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}getActiveMarks(){return[this._nodePointMark,this._centerPointMark]}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this._rawData.reRunAllTransform(),this.getViewData().reRunAllTransform()}};hm.type=F.correlation,hm.mark=JU,hm.transformerConstructor=O0;var e5=Object.assign(Object.assign({},Ft),{liquidGroup:{name:"liquidGroup",type:"group"},liquid:{name:"liquid",type:"liquid"},liquidBackground:{name:"liquidBackground",type:"group"},liquidOutline:{name:"liquidOutline",type:"group"}});var qw=class r extends Te{constructor(){super(...arguments),this.type=r.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{wave:0})}_initProduct(t){let e=this.getVGrammarView(),i=this.getProductId();this._product=e.glyph("wave",t??e.rootMark).id(i),this._compiledProductId=i}};qw.type="liquid";var i5=(r,t)=>r==="drop"?Jq(0,0,t):r;function Jq(r,t,e){let i=4*e/3,s=Math.max(i,2*e),n=i/2,o=r,a=n+t-s/2,l=Math.asin(n/(.85*(s-n))),h=Math.sin(l)*n,d=Math.cos(l)*n,c=o-d,u=a+h,p=r,m=a+n/Math.sin(l);return`
      M ${c} ${u}
      A ${n} ${n} 0 1 1 ${c+2*d} ${u}
      Q ${p} ${m} ${r} ${t+s/2}
      Q ${p} ${m} ${c} ${u}
      Z 
    `}var aC=class extends he{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>this.series.getValueField(),this.markTooltipValueCallback=t=>t[this.series.getValueField()],this.shapeStrokeCallback=t=>this.series.getMarkInName("liquid").getAttribute("fill",t)}};var dm=class r extends qi{constructor(){super(...arguments),this.type=F.liquid,this.transformerConstructor=Cs,this._liquidBackgroundMark=null,this._liquidOutlineMark=null,this._getLiquidPosY=()=>{let t=0,{height:e,startY:i}=this._getLiquidBackPosAndSize();return t=this._reverse?e*this._heightRatio:e*(1-this._heightRatio),t+i},this._getLiquidHeight=()=>{let{height:t}=this._getLiquidBackPosAndSize();return t*this._heightRatio},this._getLiquidBackPosAndSize=(t=!1)=>{var e,i;let{top:s=0,bottom:n=0,left:o=0,right:a=0}=this._marginSpec,{top:l=0,bottom:h=0,left:d=0,right:c=0}=t?{}:this._paddingSpec;this._maskShape==="triangle"&&(n/=Math.sqrt(3),s=s/Math.sqrt(3)*2,h/=Math.sqrt(3),l=l/Math.sqrt(3)*2);let{width:u,height:p}=(i=(e=this._region)===null||e===void 0?void 0:e.getLayoutRect())!==null&&i!==void 0?i:{width:0,height:0},m=u/2+(o+d-(a+c))/2,g=p/2+(s+l-(n+h))/2,f=u-(o+a+d+c),_=p-(s+n+l+h),v=Math.min(f,_);return this._maskShape!=="rect"&&(f=v,_=v),{x:m,y:g,size:v,width:f,height:_,startX:m-f/2,startY:g-_/2,endX:m+f/2,endY:g+_/2}},this._getLiquidBackPath=(t=!1)=>{var e;let i;if(this._maskShape==="rect"){let{x:s,y:n,width:o,height:a}=this._getLiquidBackPosAndSize(t);i=cr({x:s-o/2,y:n-a/2,width:o,height:a,fill:!0})}else{let{x:s,y:n,size:o}=this._getLiquidBackPosAndSize(t);i=_n({x:s,y:n,size:o,symbolType:i5((e=this._spec.maskShape)!==null&&e!==void 0?e:"circle",o),fill:!0})}return[i]}}setValueField(t){A(t)&&(this._valueField=t)}getValueField(){return this._valueField}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this._marginSpec=Xr(this._spec.outlineMargin),this._paddingSpec=Xr(this._spec.outlinePadding),this.setValueField(this._spec.valueField),this._reverse=(t=this._spec.reverse)!==null&&t!==void 0&&t,this._maskShape=(e=this._spec.maskShape)!==null&&e!==void 0?e:"circle"}viewDataUpdate(t){super.viewDataUpdate(t),this._heightRatio=ri(...this._data.getLatestData().map(e=>e[this._valueField]))}initMark(){this._initLiquidOutlineMark(),this._initLiquidBackgroundMark(),this._initLiquidMark()}initMarkStyle(){this._initLiquidOutlineMarkStyle(),this._initLiquidBackgroundMarkStyle(),this._initLiquidMarkStyle()}_initLiquidOutlineMark(){return this._liquidOutlineMark=this._createMark(r.mark.liquidOutline,{isSeriesMark:!0,skipBeforeLayouted:!1}),this._liquidOutlineMark}_initLiquidBackgroundMark(){return this._liquidBackgroundMark=this._createMark(r.mark.liquidBackground,{isSeriesMark:!0,skipBeforeLayouted:!1}),this._liquidBackgroundMark}_initLiquidMark(){return this._liquidGroupMark=this._createMark(r.mark.liquidGroup,{parent:this._liquidBackgroundMark,isSeriesMark:!0,skipBeforeLayouted:!1}),this._liquidMark=this._createMark(r.mark.liquid,{parent:this._liquidGroupMark,isSeriesMark:!0,skipBeforeLayouted:!1}),this._liquidMark}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getLiquidBackPosAndSize=this._getLiquidBackPosAndSize,this._markAttributeContext.getLiquidPosY=this._getLiquidPosY,this._markAttributeContext.getLiquidHeight=this._getLiquidHeight}_initLiquidOutlineMarkStyle(){let t=this._liquidOutlineMark;t.created(),this.setMarkStyle(t,{stroke:this.getColorAttribute(),width:()=>this._region.getLayoutRect().width,height:()=>this._region.getLayoutRect().height,path:()=>this._getLiquidBackPath(!0)},"normal",X.Series),this._liquidOutlineMark.setMarkConfig({interactive:!1,zIndex:this.layoutZIndex})}_initLiquidBackgroundMarkStyle(){let t=this._liquidBackgroundMark;t.created(),this.setMarkStyle(t,{width:()=>this._region.getLayoutRect().width,height:()=>this._region.getLayoutRect().height,path:()=>this._getLiquidBackPath()},"normal",X.Series),this._liquidBackgroundMark.setMarkConfig({interactive:!1,zIndex:this.layoutZIndex,clip:!0})}_initLiquidMarkStyle(){let t=this._liquidMark,e=this._liquidGroupMark;e&&this.setMarkStyle(e,{x:()=>this._region.getLayoutStartPoint().x+this._region.getLayoutRect().width/2,angle:this._reverse?-Math.PI:0,y:0,dy:this._getLiquidPosY}),t&&this.setMarkStyle(t,{y:0,dy:0,height:this._getLiquidHeight,fill:this.getColorAttribute(),wave:0},"normal",X.Series)}initTooltip(){this._tooltipHelper=new aC(this),this._liquidMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._liquidMark)}initInteraction(){this._parseInteractionConfig(this._liquidMark?[this._liquidMark]:[])}initAnimation(){var t,e,i,s;let n={height:{from:0,to:()=>this._getLiquidHeight()},dy:{from:()=>{let a=0,{height:l,startY:h}=this._getLiquidBackPosAndSize();return a=this._reverse?0:l,a+h}}},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._liquidMark.setAnimationConfig(_t((i=I.getAnimationInKey("liquid"))===null||i===void 0?void 0:i(n,o),xt("liquid",this._spec,this._markAttributeContext))),this._liquidGroupMark.setAnimationConfig(_t((s=I.getAnimationInKey("liquidGroup"))===null||s===void 0?void 0:s(n,o),xt("liquidGroup",this._spec,this._markAttributeContext)))}initEvent(){super.initEvent(),this._spec.indicatorSmartInvert&&this._option.getChart().getComponentsByKey("indicator")&&this.event.on(rt.renderFinished,()=>{this._option.getChart().getComponentsByKey("indicator").forEach(t=>{var e,i;let s=this._liquidMark.getProduct().elements[0].glyphGraphicItems.wave1,{y1:n,y2:o}=s.globalAABBBounds;n+=this._region.getLayoutStartPoint().y,o+=this._region.getLayoutStartPoint().y,(i=(e=t?.getIndicatorComponent())===null||e===void 0?void 0:e.getChildren()[0])===null||i===void 0||i.getChildren().forEach(a=>{let{y1:l,y2:h}=a.globalAABBBounds;if(n<l&&o>h){let d=a.attribute.fill,c=s.attribute.fill,u=Ff(d,c);a.setAttribute("fill",u)}})})})}dataToPosition(t){return null}dataToPositionX(t){return null}dataToPositionY(t){return null}valueToPosition(t,e){return null}getStatisticFields(){return[]}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}getActiveMarks(){return[this._liquidMark]}};dm.type=F.liquid,dm.mark=e5,dm.transformerConstructor=Cs;var Fo=r=>O(r).join(",");var lC=class extends he{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=t=>Fo(t?.[this.series.getDimensionField()[0]]),this.markTooltipKeyCallback=t=>Fo(t?.[this.series.getDimensionField()[0]])}};var r5=Object.assign(Object.assign({},Ft),{circle:{name:"circle",type:"arc"},overlap:{name:"overlap",type:"path"},overlapLabel:{name:"overlapLabel",type:"text"}});var H0=class extends ye{_transformLabelSpec(t){this._addMarkLabelSpec(t,"circle"),this._addMarkLabelSpec(t,"overlap","overlapLabel","initOverlapLabelMarkStyle")}};var cm=class r extends qi{constructor(){super(...arguments),this.type=F.venn,this.transformerConstructor=H0,this._viewBox=new Ye}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec(),this.setCategoryField((t=this._spec.categoryField)!==null&&t!==void 0?t:"sets"),this.setValueField((e=this._spec.valueField)!==null&&e!==void 0?e:"size"),this.setSeriesField((i=this._spec.seriesField)!==null&&i!==void 0?i:ki)}compile(){super.compile(),this._runVennTransform()}_runVennTransform(t=!1){let e=this._data.getProduct();e&&e.transform([{type:"venn",x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2,setField:this._categoryField,valueField:this._valueField}]),t&&this.getCompiler().renderNextTick()}initMark(){let t=this._createMark(r.mark.circle,{isSeriesMark:!0});t&&(t.setTransform([{type:"vennMark",datumType:"circle"}]),this._circleMark=t);let e=this._createMark(r.mark.overlap,{isSeriesMark:!0});e&&(e.setTransform([{type:"vennMark",datumType:"overlap"}]),this._overlapMark=e)}initMarkStyle(){this._initCircleMarkStyle(),this._initOverlapMarkStyle()}_initCircleMarkStyle(){this._circleMark&&this.setMarkStyle(this._circleMark,{x:t=>t.x,y:t=>t.y,innerRadius:0,outerRadius:t=>t.radius,startAngle:0,endAngle:2*Math.PI,fill:this.getColorAttribute(),stroke:this.getColorAttribute()},it.STATE_NORMAL,X.Series)}_initOverlapMarkStyle(){this._overlapMark&&(this.setMarkStyle(this._overlapMark,{x:t=>t.x,y:t=>t.y,path:t=>t.path,arcs:t=>t.arcs,fill:this.getColorAttribute(),stroke:this.getColorAttribute(),zIndex:t=>100*t.sets.length},it.STATE_NORMAL,X.Series),this.setMarkStyle(this._overlapMark,{zIndex:t=>100*t.sets.length+1},it.STATE_HOVER,X.Series))}initLabelMarkStyle(t){t&&(this._labelMark=t,t.setRule("venn"),this.setMarkStyle(t,{x:e=>e.labelX,y:e=>e.labelY,text:e=>Fo(e.sets),maxLineWidth:e=>{let{x:i,radius:s,labelX:n}=e,o=i-s,a=i+s;return Math.min(n-o,a-n)}},it.STATE_NORMAL,X.Series))}initOverlapLabelMarkStyle(t){t&&(this._labelMark=t,t.setRule("venn"),this.setMarkStyle(t,{x:e=>e.labelX,y:e=>e.labelY,text:e=>Fo(e.sets)},it.STATE_NORMAL,X.Series))}initTooltip(){this._tooltipHelper=new lC(this),this._circleMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._circleMark),this._overlapMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._overlapMark)}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this.getLayoutRect().width,this.getLayoutRect().height),this._runVennTransform()}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._circleMark,this._overlapMark]}getStatisticFields(){let t=[];return t.push({key:this._categoryField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}getGroupFields(){return null}dataToPosition(t,e){return{x:t.x,y:t.y}}dataToPositionX(t){return t.x}dataToPositionY(t){return t.y}valueToPosition(t,e){throw new Error("Method not implemented.")}getStackGroupFields(){return[]}getStackValueField(){return null}_getSeriesInfo(t,e){let i=this.getDefaultShapeType();return e.map(s=>({key:Fo(s),originalKey:s,style:this.getSeriesStyle({[t]:s}),shapeType:i}))}getSeriesFieldValue(t,e){let i=super.getSeriesFieldValue(t,e);return Fo(i)}legendSelectedFilter(t,e){if(t.type===W.discreteLegend){let i=t.getLegendDefaultData(!0);if(e.length===0&&i.length)return[];if(e.length===i.length)return e;let s={};e.forEach(a=>{s[a]=!0});let n=i.filter(a=>!s[Fo(a)]),o=i.filter(a=>!n.includes(a)&&n.some(l=>O(l).every(h=>a.includes(h))));e=e.slice(),o.forEach(a=>{e.splice(e.indexOf(Fo(a)),1)})}return e}initAnimation(){this.getMarksInType("arc").forEach(t=>{var e;t.setAnimationConfig(_t((e=I.getAnimationInKey("vennCircle"))===null||e===void 0?void 0:e(),xt(t.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("path").forEach(t=>{var e;t.setAnimationConfig(_t((e=I.getAnimationInKey("vennOverlap"))===null||e===void 0?void 0:e(),xt(t.name,this._spec,this._markAttributeContext)))})}};cm.type=F.venn,cm.mark=r5,cm.transformerConstructor=H0;var N0=class extends wr{constructor(){super(...arguments),this.type=F.mosaic,this.transformerConstructor=cs}getStack(){return!0}getPercent(){return!!this.getSeriesField()}getGroupFields(){return this.direction==="vertical"?this._specXField:this._specYField}setAttrFromSpec(){super.setAttrFromSpec();let t=this.getPercent();this.direction==="horizontal"?(t&&(this.setFieldX(Zu),this.setFieldX2(qu)),this.setFieldY(Qu),this.setFieldY2(Ju)):(t&&(this.setFieldY(Zu),this.setFieldY2(qu)),this.setFieldX(Qu),this.setFieldX2(Ju))}parseLabelStyle(t,e){if(e?.filterByGroup&&T(t.dataFilter)){let i=this.getGroupFields(),{field:s,type:n="max",filter:o}=e.filterByGroup;delete t.filterField;let a=i.indexOf(s);if(a<0)return;let l=a%2?n==="min"?this.direction==="horizontal"?this._fieldY2:this._fieldX2:this.direction==="horizontal"?this._fieldY:this._fieldX:n==="min"?this.direction==="horizontal"?this._fieldX2:this._fieldY2:this.direction==="horizontal"?this._fieldX:this._fieldY,h=n==="min"?(d,c)=>{var u,p;return((u=d.data)===null||u===void 0?void 0:u[l])<((p=c.data)===null||p===void 0?void 0:p[l])}:(d,c)=>{var u,p;return((u=d.data)===null||u===void 0?void 0:u[l])>((p=c.data)===null||p===void 0?void 0:p[l])};t.dataFilter=d=>{let c={};return d.forEach(u=>{let p=u.data,m=p?.[s];T(m)||o&&!o(u)||c[m]&&!h(u,c[m])||(c[m]=u)}),d.filter(u=>{var p;let m=(p=u.data)===null||p===void 0?void 0:p[s];return c[m]&&c[m]===u})}}return t}};N0.type=F.mosaic,N0.transformerConstructor=cs;var s5=Object.assign(Object.assign({},Ft),{pictogram:{name:"pictogram",type:"group"}});var hC=class extends ye{_getDefaultSpecFromChart(t){var e,i,s;let n=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},o=t.svg,a=(s=(i=G_.get(o))===null||i===void 0?void 0:i.latestData)===null||s===void 0?void 0:s.elements;return a&&a.length&&a.map(l=>l.name).filter(l=>A(l)).forEach(l=>{t[l]&&(n[l]=t[l])}),n}};var dC=class extends he{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=t=>{var e;let i=this.series;return(e=this._getDimensionData(t))!==null&&e!==void 0?e:i.getDatumName(t)},this.markTooltipValueCallback=(t,e)=>{let{measureFields:i}=this._seriesCacheInfo;if(i[0]&&t.data)return t.data[i[0]]},this.markTooltipKeyCallback=t=>{var e;return(e=t.data)===null||e===void 0?void 0:e[this.series.getDimensionField()[0]]}}};function Zw(r){var t;return A(r)&&r!=="none"&&!(!((t=r.includes)===null||t===void 0)&&t.call(r,"url"))}var Qq=r=>{let t=parseFloat(r.strokeWidth);if(!isNaN(t))return t;let e=r.stroke;return e&&Zw(e)?1:0},V0=(r,t)=>{var e;let i=(e=r.fill)!==null&&e!==void 0?e:t;return i&&Zw(i)?i:void 0},tZ=(r,t)=>{var e;let i=(e=r.stroke)!==null&&e!==void 0?e:t;return!(!i||!Zw(i))&&i},lh=r=>Object.assign(Object.assign({},r),{x:parseFloat(r.x)||void 0,y:parseFloat(r.y)||void 0,fillStrokeOrder:!1,fill:V0(r),lineWidth:Qq(r),stroke:tZ(r)}),cC={group:r=>{let t=lh(r);return Object.assign(Object.assign({},t),{visibleAll:t.visible!==!1})},rule:r=>Object.assign(Object.assign({},lh(r)),{x:parseFloat(r.x1),y:parseFloat(r.y1),x1:parseFloat(r.x2),y1:parseFloat(r.y2)}),rect:r=>Object.assign(Object.assign({},lh(r)),{fill:V0(r,"#000"),width:parseFloat(r.width),height:parseFloat(r.height)}),polygon:r=>Object.assign(Object.assign({},lh(r)),{fill:V0(r,"#000"),points:r.points.trim().split(/\s+/).map(t=>{let[e,i]=t.split(",").map(Number);return{x:e,y:i}})}),line:r=>Object.assign(Object.assign({},lh(r)),{points:r.points.trim().split(/\s+/).map(t=>{let[e,i]=t.split(",").map(Number);return{x:e,y:i}})}),path:r=>Object.assign(Object.assign({},lh(r)),{path:r.d,fillStrokeOrder:!1}),arc:r=>{var t;return Object.assign(Object.assign({},lh(r)),{outerRadius:(t=r.r)!==null&&t!==void 0?t:r.ry,x:parseFloat(r.cx),y:parseFloat(r.cy),startAngle:0,endAngle:2*Math.PI,scaleX:parseFloat(r.rx)/parseFloat(r.ry)||1,fill:V0(r,"#000")})},text:(r,t)=>{var e,i;return Object.assign(Object.assign({},lh(r)),{text:t,textAlign:(e=r.textAlign)!==null&&e!==void 0?e:"left",textBaseLine:(i=r.textAnchor)!==null&&i!==void 0?i:"middle",anchor:[0,0],fill:V0(r,"#000")})}},n5=r=>{var t,e;if(!r||!r[0])return{};let{elements:i}=r[0].latestData;if(i&&i.length){i.forEach((n,o)=>{var a;n[$e]=o,n._uniqueId=`${n.id}-${o}`,n.data=void 0;let{graphicType:l,transform:h}=n,d={visible:n.attributes.visibility!=="hidden"&&n.attributes.visibility!=="collapse"};n.graphicType==="text"?G(d,n._inheritStyle,(a=n.parent)===null||a===void 0?void 0:a._textGroupStyle,n.attributes):n.graphicType!=="group"&&G(d,n._inheritStyle,n.attributes),cC[l]?n._finalAttributes=cC[l](d,n.value):n._finalAttributes=d,h&&(n._finalAttributes.postMatrix=Object.assign({},h))});let s=i.filter(n=>n.tagName==="text");for(let n=0;n<s.length;n++){let o=s[n]._uniqueId,a=i.filter(l=>{let h=!1,d=l.parent;for(;d;){if(d._uniqueId===o){h=!0;break}d=d.parent}return h});if(a&&a.length){let l=(e=(t=s[n]._textGroupStyle)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:0,h=l;for(let d=0;d<a.length;d++){let c=a[d];if(c.graphicType==="group")h=l;else if(c.value&&c.parent._textGroupStyle.x===void 0){let u=a.slice(0,d).reverse().find(p=>p.graphicType==="text"&&p.value);u&&(h+=gA(u.value,u._finalAttributes).width),c._finalAttributes.x=h}}}}}return i};var um=class r extends qp{constructor(){super(...arguments),this.type=F.pictogram,this._idToMark=new Map}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec(),this.svg=this._spec.svg,this._nameField=this._spec.nameField,this._valueField=this._spec.valueField,this.svg||(t=this._option)===null||t===void 0||t.onError("svg source is not specified !"),this._parsedSvgResult=(e=c1(this.svg))===null||e===void 0?void 0:e.latestData,this._parsedSvgResult||(i=this._option)===null||i===void 0||i.onError(`'${this.svg}' is not registered !`)}getDatumCenter(t){return[Number.NaN,Number.NaN]}getDatumName(t){return t.name||t._nameFromParent}getMarksWithoutRoot(){return this.getMarks().filter(t=>t.name&&!t.name.includes("seriesGroup")&&!t.name.includes("root")&&t!==this._pictogramMark)}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getTransformMatrix=this.getRootMatrix.bind(this),this._markAttributeContext.coordToPosition=this.coordToPosition.bind(this),this._markAttributeContext.dataToPosition=this.dataToPosition.bind(this)}_defaultHoverConfig(t,e){return{seriesId:this.id,regionId:this._region.id,selector:t,type:"element-highlight-by-graphic-name",trigger:e.trigger,triggerOff:"pointerout",blurState:it.STATE_HOVER_REVERSE,highlightState:it.STATE_HOVER}}_defaultSelectConfig(t,e){let i=e.mode==="multiple",s=A(e.triggerOff)?e.triggerOff:i?["empty","self"]:["empty",e.trigger];return{type:"element-select-by-graphic-name",seriesId:this.id,regionId:this._region.id,selector:t,trigger:e.trigger,triggerOff:s,reverseState:it.STATE_SELECTED_REVERSE,state:it.STATE_SELECTED,isMultiple:i}}initMark(){var t;if(this._pictogramMark=this._createMark(r.mark.pictogram,{groupKey:this.getDimensionField()[0],isSeriesMark:!0,skipBeforeLayouted:!0,dataView:this._mapViewData.getDataView(),dataProductId:this._mapViewData.getProductId()},{morph:vi(this._spec,r.mark.pictogram.name)}),this._pictogramMark){this._pictogramMark.setUserId(r.mark.pictogram.name);for(let e of this._mapViewData.getDataView().latestData){let{graphicType:i,name:s,parent:n,id:o,_nameFromParent:a,_uniqueId:l}=e,h=this._createMark({type:i,name:s??a},{groupKey:l,isSeriesMark:!1,skipBeforeLayouted:!0,dataView:this._mapViewData.getDataView(),dataProductId:this._mapViewData.getProductId(),parent:(t=this._idToMark.get(n?._uniqueId))!==null&&t!==void 0?t:this._pictogramMark},{morph:vi(this._spec,r.mark.pictogram.name)});h&&(h.setUserId(l),this._idToMark.set(l,h),h.type!=="group"&&h.setMarkConfig({graphicName:h.name}),h.setTransform([{type:"filter",callback:d=>d._uniqueId===l}]))}this._initLabelMark()}}_initLabelMark(){if(this._spec.label.visible!==!0)return;let t=this._createMark(r.mark.label,{isSeriesMark:!1,parent:this._pictogramMark,groupKey:"_uniqueId",skipBeforeLayouted:!0,depend:this.getMarksWithoutRoot()});t&&(this._labelMark=t,this._labelMark.setDataView(this._mapViewData.getDataView()))}initLabelMarkStyle(){this._labelMark&&this.setMarkStyle(this._labelMark,{visible:t=>!!this._validElement(t),x:t=>{var e;return(e=this.dataToPosition(t,!0))===null||e===void 0?void 0:e.x},y:t=>{var e;return(e=this.dataToPosition(t,!0))===null||e===void 0?void 0:e.y},text:t=>t[this.nameField],textAlign:"center",textBaseline:"middle"},it.STATE_NORMAL,X.Series)}initMarkStyle(){let{root:t,viewBoxRect:e}=this._parsedSvgResult,i=this._mapViewData.getDataView().latestData;t&&(this.setMarkStyle(this._pictogramMark,cC.group(t.attributes),"normal",X.Built_In),t.transform&&this.setMarkStyle(this._pictogramMark,{postMatrix:()=>t.transform},"normal",X.Built_In),e&&this._pictogramMark.setMarkConfig({clip:!0,clipPath:[cr(Object.assign(Object.assign({},e),{fill:!0}))]}));for(let s of i){let{_uniqueId:n,_finalAttributes:o}=s,a=this._idToMark.get(n),l=this._validElement(s);a&&(this.setMarkStyle(a,{keepStrokeScale:!0},"normal",X.Built_In),l?(this.initMarkStyleWithSpec(a,G({},this._spec.pictogram,this._spec[a.name])),this.setMarkStyle(a,o,"normal",X.Series),a.setPostProcess("fill",(h,d)=>A(h)?h:this._spec.defaultFillColor)):(a.setMarkConfig({interactive:!1}),this.setMarkStyle(a,o,"normal",X.Built_In)))}this.initLabelMarkStyle()}_validElement(t){return t.name||t._nameFromParent}initTooltip(){this._tooltipHelper=new dC(this),this.getMarksWithoutRoot().forEach(t=>{t&&t.name&&this._tooltipHelper.activeTriggerSet.mark.add(t)})}dataToPosition(t,e=!1){if(!t)return null;let i=t[this.nameField];if(!i)return null;let s=this.getMarksWithoutRoot().filter(a=>a.name===i);if(!s||s.length===0)return null;let n=new Ye;e?s.forEach(a=>{n=n.union(a.getProduct().getGroupGraphicItem().globalAABBBounds)}):s.forEach(a=>{n=n.union(a.getProduct().getBounds())});let o={x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2};if(e){let{x:a,y:l}=this.getLayoutStartPoint();o.x-=a,o.y-=l}return o}coordToPosition(t){if(!t)return null;let{x:e,y:i}=t,s=this.getRootMatrix();if(!s)return null;let n={};return s.getInverse().transformPoint({x:e,y:i},n),n}getRootMatrix(){var t;return(t=this.getPictogramRootGraphic())===null||t===void 0?void 0:t.transMatrix}getPictogramRootGraphic(){var t;return(t=this._pictogramMark.getProduct())===null||t===void 0?void 0:t.getGroupGraphicItem()}initData(){var t,e;super.initData();let i=G_.get(this.svg);i||(t=this._option)===null||t===void 0||t.onError("no valid svg found!");let s=new St(this._dataSet,{name:`pictogram_${this.id}_data`});nt(this._dataSet,"pictogram",n5),nt(this._dataSet,"lookup",V1),s.parse([i],{type:"dataview"}).transform({type:"pictogram"}).transform({type:"lookup",options:{from:()=>this.getViewData().latestData,key:"name",fields:this._nameField,set:(n,o)=>{o&&(n.data=o)}}}).transform({type:"lookup",options:{from:()=>this.getViewData().latestData,key:"_nameFromParent",fields:this._nameField,set:(n,o)=>{o&&(n.data=o)}}}),(e=this._data)===null||e===void 0||e.getDataView().target.addListener("change",s.reRunAllTransform),this._mapViewData=new yi(this._option,s)}mapViewDataUpdate(){this._mapViewData.updateData()}onLayoutEnd(t){var e;super.onLayoutEnd(t),(e=this._mapViewData)===null||e===void 0||e.getDataView().reRunAllTransform()}updateSVGSize(){let{width:t,height:e}=this.getLayoutRect(),i=t/2,s=e/2,n=this.getPictogramRootGraphic();if(n){let o=n.AABBBounds,{x1:a,x2:l,y1:h,y2:d}=n.AABBBounds,c=(a+l)/2,u=(h+d)/2,p=t/o.width(),m=e/o.height(),g=Math.min(p,m);n.scale(g,g,{x:c,y:u}),n.translate(i-c,s-u)}}initEvent(){var t;super.initEvent(),(t=this._mapViewData.getDataView())===null||t===void 0||t.target.addListener("change",this.mapViewDataUpdate.bind(this)),this.event.on(pt.AFTER_MARK_LAYOUT_END,this.updateSVGSize.bind(this))}handleZoom(t){let{scale:e,scaleCenter:i}=t;if(e===1)return;let s=this.getPictogramRootGraphic();s&&(s.attribute.postMatrix||s.setAttributes({postMatrix:new Kt}),s.scale(e,e,i))}handlePan(t){let{delta:e}=t;if(e[0]===0&&e[1]===0)return;let i=this.getPictogramRootGraphic();i&&(i.attribute.postMatrix||i.setAttributes({postMatrix:new Kt}),i.translate(e[0],e[1]))}getMarkData(t){var e;return(e=t.data)!==null&&e!==void 0?e:{}}getMeasureField(){return[this.valueField]}getDimensionField(){return[this.nameField]}_getSeriesInfo(t,e){let i=this.getDefaultShapeType();return e.map(s=>({key:s,originalKey:s,style:this.getSeriesStyle({data:{[t]:s}}),shapeType:i}))}release(){this._parsedSvgResult=null,this._idToMark.clear(),this._idToMark=null}};um.type=F.pictogram,um.mark=s5,um.transformerConstructor=hC;var j0=class extends Ie{_isValidSeries(t){return t===F.map}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["type","nameField","valueField","map","nameProperty","centroidProperty","nameMap","area","defaultFillColor","showDefaultName"])}transformSpec(t){super.transformSpec(t),t.region.forEach(e=>{e.coordinate="geo"}),super.transformSeriesSpec(t)}};var pm=class extends At{constructor(){super(...arguments),this.transformerConstructor=j0,this.type="map",this.seriesType=F.map}};pm.type="map",pm.seriesType=F.map,pm.transformerConstructor=j0;var Oo=class extends th{needAxes(){return!1}_getDefaultSeriesSpec(t){var e;let i=super._getDefaultSeriesSpec(t,["center","centerOffset","cornerRadius","padAngle","minAngle","emptyPlaceholder","showAllZero","supportNegative","layoutRadius"]);return i.categoryField=t.categoryField||t.seriesField,i.valueField=t.valueField||t.angleField,i.emptyCircle=(e=t.emptyPlaceholder)===null||e===void 0?void 0:e.emptyCircle,i}};var Ud=class extends At{constructor(){super(...arguments),this.transformerConstructor=Oo}};Ud.transformerConstructor=Oo;var mm=class extends Ud{constructor(){super(...arguments),this.transformerConstructor=Oo,this.type="pie",this.seriesType=F.pie}};mm.type="pie",mm.seriesType=F.pie,mm.transformerConstructor=Oo;var uC=class extends Oo{transformSpec(t){super.transformSpec(t),t.series.forEach(e=>{e.type==="pie3d"&&(e.angle3d=t.angle3d)})}},gm=class extends Ud{constructor(){super(...arguments),this.transformerConstructor=uC,this.type="pie3d",this.seriesType=F.pie3d}};gm.type="pie3d",gm.seriesType=F.pie3d,gm.transformerConstructor=uC;var z0=class extends Up{_getDefaultSeriesSpec(t){var e,i;let s=super._getDefaultSeriesSpec(t);return s.progress=t.progress,s.track=t.track,s.tickMask=t.tickMask,s.cornerRadius=(e=t.cornerRadius)!==null&&e!==void 0?e:0,s.roundCap=(i=t.roundCap)!==null&&i!==void 0&&i,s}transformSpec(t){super.transformSpec(t),this._transformProgressAxisSpec(t,{orient:"angle",visible:!1},{orient:"radius",visible:!1},{forceInitTick:t.tickMask&&t.tickMask.visible!==!1})}};var Wd=class extends At{constructor(){super(...arguments),this.transformerConstructor=z0,this.type="circularProgress",this.seriesType=F.circularProgress}};Wd.type="circularProgress",Wd.seriesType=F.circularProgress,Wd.transformerConstructor=z0,Ct(Wd,Mi);var G0=class extends ai{needAxes(){return!1}_getDefaultSeriesSpec(t){var e,i;let s=super._getDefaultSeriesSpec(t,["bandWidth","progress","track"]);return s.direction=(e=t.direction)!==null&&e!==void 0?e:"horizontal",s.cornerRadius=(i=t.cornerRadius)!==null&&i!==void 0?i:0,s}transformSpec(t){var e,i;if(super.transformSpec(t),t.axes||(t.axes=[]),t.direction==="vertical"){let s=null,n=null;((e=t.axes)!==null&&e!==void 0?e:[]).forEach(a=>{let{orient:l}=a;l==="left"&&(s=a),l==="bottom"&&(n=a)}),s||(s={orient:"left",visible:!1},t.axes.push(s)),n||(n={orient:"bottom",visible:!1},t.axes.push(n)),T(n.type)&&(n.type="band"),T(s.type)&&(s.type="linear");let o=jl(s,{min:0,max:1});T(s.min)&&(s.min=o.min),T(s.max)&&(s.max=o.max)}else{let s=null,n=null;((i=t.axes)!==null&&i!==void 0?i:[]).forEach(a=>{let{orient:l}=a;l==="left"&&(s=a),l==="bottom"&&(n=a)}),s||(s={type:"band",orient:"left",visible:!1},t.axes.push(s)),n||(n={orient:"bottom",visible:!1},t.axes.push(n)),T(n.type)&&(n.type="linear"),T(s.type)&&(s.type="band");let o=jl(n,{min:0,max:1});T(n.min)&&(n.min=o.min),T(n.max)&&(n.max=o.max)}}};var Yd=class extends At{constructor(){super(...arguments),this.transformerConstructor=G0,this.type="linearProgress",this.seriesType=F.linearProgress}};Yd.type="linearProgress",Yd.seriesType=F.linearProgress,Yd.transformerConstructor=G0,Ct(Yd,Mi);var U0=class extends Wp{_getDefaultSeriesSpec(t){var e;let i=super._getDefaultSeriesSpec(t);return i.line=t.line,i.point=t.point,i.stack=t.stack,i.percent=t.percent,i.area=ot({visible:!1},t.area),i.seriesMark=(e=t.seriesMark)!==null&&e!==void 0?e:"area",i.activePoint=t.activePoint,i.pointDis=t.pointDis,i.pointDisMul=t.pointDisMul,i.markOverlap=t.markOverlap,i}transformSpec(t){var e;super.transformSpec(t),((e=t.axes)!==null&&e!==void 0?e:[]).forEach(i=>{i.orient==="radius"&&(["domainLine","label","tick"].forEach(s=>{i[s]||(i[s]={visible:!1})}),i.grid||(i.grid={visible:!0}))}),t.crosshair=O(t.crosshair||{}).map(i=>ot({categoryField:{visible:!0,line:{visible:!0,type:"line"}}},i))}};var Xd=class extends At{constructor(){super(...arguments),this.transformerConstructor=U0,this.type="radar",this.seriesType=F.radar}};Xd.type="radar",Xd.seriesType=F.radar,Xd.transformerConstructor=U0,Ct(Xd,Mi);var W0=class extends ai{_getDefaultSeriesSpec(t){var e,i;let s=super._getDefaultSeriesSpec(t);return s.area=t.area,t.direction==="horizontal"?s.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:s.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],s.stack=!1,s}transformSpec(t){super.transformSpec(t),nr(t)}};var fm=class extends At{constructor(){super(...arguments),this.transformerConstructor=W0,this.type="rangeArea",this.seriesType=F.rangeArea}};fm.type="rangeArea",fm.seriesType=F.rangeArea,fm.transformerConstructor=W0;var Y0=class extends ai{_getDefaultSeriesSpec(t){var e,i;let s=super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barBackground","barMinHeight","stackCornerRadius","bar"]);return t.direction==="horizontal"?s.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:s.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],s}transformSpec(t){super.transformSpec(t),nr(t)}};var _m=class extends At{constructor(){super(...arguments),this.transformerConstructor=Y0,this.type="rangeColumn",this.seriesType=F.rangeColumn}};_m.type="rangeColumn",_m.seriesType=F.rangeColumn,_m.transformerConstructor=Y0;var X0=class extends ai{_getDefaultSeriesSpec(t){var e,i;let s=super._getDefaultSeriesSpec(t,["bar3d","barGapInGroup"]);return t.direction==="horizontal"?s.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:s.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],s}};var vm=class extends At{constructor(){super(...arguments),this.transformerConstructor=X0,this.type="rangeColumn3d",this.seriesType=F.rangeColumn3d}};vm.type="rangeColumn3d",vm.seriesType=F.rangeColumn3d,vm.transformerConstructor=X0;var K0=class extends Wp{_getDefaultSeriesSpec(t){var e,i,s;let n=super._getDefaultSeriesSpec(t);return n.radius=(e=t.radius)!==null&&e!==void 0?e:yd,n.outerRadius=(i=t.outerRadius)!==null&&i!==void 0?i:yd,n.innerRadius=(s=t.innerRadius)!==null&&s!==void 0?s:0,n.stack=t.stack,n.percent=t.percent,n}transformSpec(t){var e;super.transformSpec(t),((e=t.axes)!==null&&e!==void 0?e:[]).forEach(i=>{["domainLine","grid","label","tick"].forEach(s=>{i[s]||(i[s]={visible:!1})}),i.orient==="angle"&&T(i.bandPosition)&&(i.bandPosition=.5)}),t.crosshair=O(t.crosshair||{}).map(i=>ot({categoryField:{visible:!0,line:{visible:!0,type:"rect"}}},i))}};var Kd=class extends At{constructor(){super(...arguments),this.transformerConstructor=K0,this.type="rose",this.seriesType=F.rose}};Kd.type="rose",Kd.seriesType=F.rose,Kd.transformerConstructor=K0,Ct(Kd,Mi);var $0=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","sourceField","targetField","direction","nodeAlign","crossNodeAlign","nodeGap","nodeWidth","linkWidth","minStepWidth","minNodeHeight","maxNodeHeight","minLinkHeight","maxLinkHeight","dropIsolatedNode","nodeHeight","linkHeight","equalNodeHeight","linkOverlap","iterations","nodeKey","linkSortBy","nodeSortBy","setNodeLayer","node","link","emphasis","inverse","overflow"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var ym=class extends At{constructor(){super(...arguments),this.transformerConstructor=$0,this.type="sankey",this.seriesType=F.sankey}_setStateInDatum(t,e,i,s,n){let o=H(i)?i[0]:i,a=o?Object.keys(o):null;this.getRegionsInQuerier(n).forEach(l=>{if(!o)return void l.interaction.clearEventElement(t,!0);let h=!1;l.getSeries().forEach(d=>{var c,u;let p=null;d.getMarksWithoutRoot().forEach(m=>{if(m.type==="text")return;let g=null,f=m.getProduct();f&&((!s||V(s)&&s(d,m))&&(g=f.elements.find(_=>a.every(v=>{var x;let y=(x=_.getDatum())===null||x===void 0?void 0:x.datum;return H(y)&&(y=y[0]),o[v]==y?.[v]}))),g&&(h=!0,l.interaction.startInteraction(t,g),(f.id().includes("node")||f.id().includes("link"))&&(p=g)))}),p&&((u=(c=d)._handleEmphasisElement)===null||u===void 0||u.call(c,{item:p}))}),e&&h&&l.interaction.reverseEventElement(t)})}};ym.type="sankey",ym.seriesType=F.sankey,ym.transformerConstructor=$0;var q0=class extends ai{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["point","size","shape","shapeField","sizeField"])}};var $d=class extends At{constructor(){super(...arguments),this.transformerConstructor=q0,this.type="scatter",this.seriesType=F.scatter}};$d.type="scatter",$d.seriesType=F.scatter,$d.transformerConstructor=q0,Ct($d,Mi);var Z0=class extends Ie{_getSeriesDataLength(t,e){var i,s;if(e.data){let o=O(e.data)[0];return o instanceof St?(i=o.latestData)===null||i===void 0?void 0:i.length:(s=o.values)===null||s===void 0?void 0:s.length}let n=O(t.data).find((o,a)=>e.dataId?o instanceof St?o.name===e.dataId:o.id===e.dataId:e.dataIndex===a);return n?n instanceof St?n.latestData.length:n.values.length:0}addAttrToComponentSpec(t,e,i){return Array.isArray(t)?t[0][e]=i:t[e]=i,t}addPaddingRow(t,e,i){t.push({index:e,size:i})}addOrientAxes(t,e,i,s){t.push({id:`regionAxesRow${i}`}),e.push({modelId:`axesRow${i}`,col:1,row:i}),s.axes[0].id=`axesRow${i}`,s.axes[0].regionIndex=Array.from(Array(s.series.length),(n,o)=>s.axes[0].orient==="top"?o+1:o)}transformSpec(t){var e,i,s,n,o,a,l,h,d,c,u,p,m,g,f;super.transformSpec(t);let _=0,v=[],x=[],y=[],b=[],S=[],C=(this._option.getCompiler().getVGrammarView().width(),this._option.getCompiler().getVGrammarView().height()),k=0;if(t?.legends){v.push({modelId:`legendRow${_}`,col:1,row:_}),this.addAttrToComponentSpec(t.legends,"id",`legendRow${_}`);let L=O(t.legends),w=(e=L[0].height)!==null&&e!==void 0?e:40;if(L[0].padding){let R=Xr(L[0].padding);w+=Number((i=R?.bottom)!==null&&i!==void 0?i:0),w+=Number((s=R?.top)!==null&&s!==void 0?s:0),L[0].offsetY=Number((o=(n=L[0])===null||n===void 0?void 0:n.offsetY)!==null&&o!==void 0?o:0)+Number((a=R?.top)!==null&&a!==void 0?a:0)}S.push({index:_,size:w}),k+=w,_++}t?.dataZoom&&(v.push({modelId:`dataZoomRow${_}`,col:1,row:_}),this.addAttrToComponentSpec(t.dataZoom,"id",`dataZoomRow${_}`),k+=60,_++,this.addPaddingRow(S,_,10),k+=10,_++),k+=60,t.axes!==null&&((h=(l=t?.axes)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h.orient)!=="top"||(this.addOrientAxes(x,v,_,t),_++);let M=t.series.filter(L=>L.type!==F.link).length,E=(C-k-20*M)/M,D=((d=t?.appendPadding)===null||d===void 0?void 0:d.left)||0,P=((c=t?.appendPadding)===null||c===void 0?void 0:c.right)||0;(u=t?.series)===null||u===void 0||u.forEach(L=>{var w,R;if([F.bar,F.line,F.area,F.dot].includes(L.type)){if(v.push({modelId:`${L.type}Row${_}`,col:1,row:_}),v.push({modelId:`axesLeftRow${_}`,col:0,row:_}),x.push({id:`${L.type}Row${_}`,clip:!1}),S.push({index:_,size:L?.height||E}),y.push({orient:"left",id:`axesLeftRow${_}`,type:L.type===F.dot?"band":"linear",visible:L.type!==F.dot,title:{visible:!0,autoRotate:!1,style:{text:L?.barTitle,dx:-20,textBaseline:"middle",textAlign:"end"}},grid:{visible:typeof((w=L?.grid)===null||w===void 0?void 0:w.visible)!="boolean"||((R=L?.grid)===null||R===void 0?void 0:R.visible),style:(N,z)=>{var Y,U,$,ut,mt;let bt=0;if(z===0){let Ot=(Y=L?.grid)===null||Y===void 0?void 0:Y.style;bt=($=(U=Ot?.lineWidth)!==null&&U!==void 0?U:Ot?.strokeWidth)!==null&&$!==void 0?$:1}return{lineWidth:bt,stroke:((mt=(ut=L?.grid)===null||ut===void 0?void 0:ut.style)===null||mt===void 0?void 0:mt.stroke)||"#dfdfdf",lineDash:[0,0]}}},domainLine:{visible:!1},tick:{visible:!1},label:{visible:!1},regionIndex:x.length-1}),L.type===F.dot){v.push({modelId:`scrollBarRightRow${_}`,col:2,row:_});let N=this._getSeriesDataLength(t,L),z=0;N&&(z=(L?.height||E)/(30*N)),b.push(Object.assign({orient:"right",visible:L.type===F.dot&&z<1,id:`scrollBarRightRow${_}`,start:0,end:Math.min(z,1),filterMode:"axis",regionIndex:x.length-1,axisId:`axesLeftRow${_}`},O(t?.scrollBar)[0]))}L.regionIndex=x.length-1,_++,this.addPaddingRow(S,_,L?.padding||20),_++,L.leftAppendPadding=D,L.type===F.dot&&(L.title.style.dx=-D,L.subTitle.style.dx=-D)}}),this.addPaddingRow(S,_,20),_++,(p=t?.series)===null||p===void 0||p.forEach(L=>{if(L.type===F.link){let w=L.dotSeriesIndex+1;v.push({modelId:`${L.type}Row${w}`,col:1,row:w-1}),L.regionIndex=t.series[L.dotSeriesIndex].regionIndex,L.leftAppendPadding=D,L.height=t.series[L.dotSeriesIndex].height,L.clipHeight=t.series[L.dotSeriesIndex].clipHeight}}),t?.legends&&this.addAttrToComponentSpec(t.legends,"regionIndex",[x.length-1]),((g=(m=t?.axes)===null||m===void 0?void 0:m[0])===null||g===void 0?void 0:g.orient)==="bottom"&&(this.addOrientAxes(x,v,_,t),_++);let B={type:"grid",col:4,row:_,colWidth:[{index:0,size:D},{index:2,size:12},{index:3,size:P}],rowHeight:S,elements:v};t.layout=B,t.region=x,(f=t.axes)===null||f===void 0||f.push(...y),t.scrollBar=b}};var CZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},J0=class extends At{constructor(){super(...arguments),this.transformerConstructor=Z0,this.type="sequence"}_createSeries(t,e){if(!t)return;let{spec:i}=e,s=CZ(e,["spec"]),n;if(i.type===F.link&&(i.dotSeriesSpec=this._spec.series[i.dotSeriesIndex]),i.regionId&&(n=this.getRegionsInUserId(i.regionId)),n||(n=this.getRegionsInIndex(i.regionIndex?[i.regionIndex]:void 0)[0]),!n)return;let o=new t(i,Object.assign(Object.assign(Object.assign({},this._modelOption),s),{region:n,specKey:"series",globalScale:this._globalScale}));o&&(o.created(),this._series.push(o),n.addSeries(o))}};J0.type="sequence",J0.transformerConstructor=Z0;var Q0=class extends Ie{_getDefaultSeriesSpec(t){let e=A(t.startAngle)?t.startAngle:Wu,i=A(t.endAngle)?t.endAngle:e+Xn(2*Math.PI),s=super._getDefaultSeriesSpec(t,["categoryField","valueField","centerX","centerY","offsetX","offsetY","innerRadius","outerRadius","gap","labelLayout","label","labelAutoVisible","drill","drillField"]);return s.startAngle=e,s.endAngle=i,s}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var xm=class extends At{constructor(){super(...arguments),this.transformerConstructor=Q0,this.type="sunburst",this.seriesType=F.sunburst}};xm.type="sunburst",xm.seriesType=F.sunburst,xm.transformerConstructor=Q0;var tv=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","aspectRatio","splitType","maxDepth","gapWidth","nodePadding","minVisibleArea","minChildrenVisibleArea","minChildrenVisibleSize","roam","drill","drillField","leaf","nonLeaf","nonLeafLabel"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var bm=class extends At{constructor(){super(...arguments),this.transformerConstructor=tv,this.type="treemap",this.seriesType=F.treemap}};bm.type="treemap",bm.seriesType=F.treemap,bm.transformerConstructor=tv;var ev=class extends Aa{transformSpec(t){super.transformSpec(t),t.legends&&O(t.legends).forEach(e=>{e.select=!1,e.hover=!1,e.filter=!1}),nr(t)}_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.bar=t.bar,e.stackLabel=t.stackLabel,e.leaderLine=t.leaderLine,e.total=t.total,e}};var Sm=class extends Ts{constructor(){super(...arguments),this.transformerConstructor=ev,this.type="waterfall",this.seriesType=F.waterfall}};Sm.type="waterfall",Sm.seriesType=F.waterfall,Sm.transformerConstructor=ev;var iv=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","sizeField","sizeRange","centerX","centerY","innerRadius","outerRadius","startAngle","endAngle","ripplePoint","centerPoint","centerLabel","nodePoint"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var Am=class extends At{constructor(){super(...arguments),this.transformerConstructor=iv,this.type="correlation",this.seriesType=F.correlation}};Am.type="correlation",Am.seriesType=F.correlation,Am.transformerConstructor=iv;var rv=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["valueField","maskShape","reverse","outlineMargin","outlinePadding","indicatorSmartInvert","liquidBackground","liquidOutline"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var Cm=class extends At{constructor(){super(...arguments),this.transformerConstructor=rv,this.type="liquid",this.seriesType=F.liquid}};Cm.type="liquid",Cm.seriesType=F.liquid,Cm.transformerConstructor=rv;var Ho=class extends Ie{transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["nameField","valueField","fontFamilyField","fontWeightField","fontStyleField","colorHexField","colorMode","colorList","rotateAngles","fontWeightRange","fontSizeRange","maskShape","keepAspect","random","wordCloudConfig","wordCloudShapeConfig","word","fillingWord","wordMask"])}};var qd=class extends At{constructor(){super(...arguments),this.transformerConstructor=Ho,this.type="wordCloud",this.seriesType=F.wordCloud}};qd.transformerConstructor=Ho;var Tm=class extends qd{constructor(){super(...arguments),this.transformerConstructor=Ho,this.type="wordCloud",this.seriesType=F.wordCloud}};Tm.type="wordCloud",Tm.seriesType=F.wordCloud,Tm.transformerConstructor=Ho;var sv=class extends Ho{_getDefaultSeriesSpec(t){let e=super._getDefaultSeriesSpec(t);return e.depth_3d=t.depth_3d,e}};var km=class extends qd{constructor(){super(...arguments),this.transformerConstructor=sv,this.type="wordCloud3d",this.seriesType=F.wordCloud3d}};km.type="wordCloud3d",km.seriesType=F.wordCloud3d,km.transformerConstructor=sv;var nv=class extends Ie{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","circle","overlap","overlapLabel"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}};var Mm=class extends At{constructor(){super(...arguments),this.transformerConstructor=nv,this.type="venn",this.seriesType=F.venn}};Mm.type="venn",Mm.seriesType=F.venn,Mm.transformerConstructor=nv;var ov=class extends ai{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barBackground","barMinHeight","stackCornerRadius","bar"])}transformSpec(t){super.transformSpec(t),nr(t)}_setDefaultXAxisSpec(t){return{orient:"bottom",type:"linear",label:{visible:!1}}}_setDefaultYAxisSpec(t){return{orient:"left",type:"linear"}}};var Dm=class extends At{constructor(){super(...arguments),this.transformerConstructor=ov,this.type="mosaic",this.seriesType=F.mosaic,this.handleAfterStackRegion=(t,e)=>{t.getSeries().forEach(i=>{let s=i.getStackData(),n=i.getStackValue(),o=i.getStackValueField();s&&o&&(EE(e[n],o),wE(i,e[n]))})}}_beforeInit(){this._dataSet&&nt(this._dataSet,"stackSplit",C1)}_initStack(){this._stack=new Z_(this,{afterStackRegion:this.handleAfterStackRegion}),this._stack.init()}};Dm.type="mosaic",Dm.seriesType=F.mosaic,Dm.transformerConstructor=ov;var av=class extends Ie{_isValidSeries(t){return t===F.pictogram}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["type","nameField","valueField","svg","pictogram","defaultFillColor"])}transformSpec(t){super.transformSpec(t),t.region.forEach(e=>{e.coordinate="geo"}),super.transformSeriesSpec(t)}};var Em=class extends At{constructor(){super(...arguments),this.transformerConstructor=av,this.type="pictogram",this.seriesType=F.pictogram}};Em.type="pictogram",Em.seriesType=F.pictogram,Em.transformerConstructor=av;var o5=(r,t)=>{let{getNewDomain:e,isContinuous:i,field:s,originalFields:n}=t,o=s(),a=e();if(T(a)||T(o))return r;let l=n(),h=H(o)?o[0]:o;return r[h]&&l&&l[h]&&l[h].lockStatisticsByDomain&&!i()&&(r[h].values=a),r},a5=(r,t)=>{let{getNewDomain:e,isContinuous:i,field:s}=t,n=s(),o=e();if(T(o)||T(n))return r;if(o.length===0)return[];let a={};o.forEach(h=>{a[h]||(a[h]=1)});let l=null;return l=i()?h=>{let d=!1;return O(n).every(c=>{h[c]>=o[0]&&h[c]<=It(o)&&(d=!0)}),d}:h=>{let d=!1;return O(n).every(c=>{(a[h[c]+""]||a[h[c]])&&(d=!0)}),d},r.filter(l)},l5=(r,t)=>{let{stateFields:e,valueFields:i,dataCollection:s}=t.input,{stateField:n,valueField:o}=t.output,a={},l=[];return s.forEach((h,d)=>{var c;if(T(e[d]))return;let u=(c=h.getFields())===null||c===void 0?void 0:c[e[d]];u&&u.lockStatisticsByDomain&&u.domain.forEach(p=>{a[p]=0}),h.latestData.forEach(p=>{O(e[d]).forEach(m=>{T(p[m])||(T(a[p[m]])&&(a[p[m]]=0),T(i[d])||(a[p[m]]+=isNaN(parseFloat(p[i[d]]))?1:parseFloat(p[i[d]])))})})}),Object.keys(a).forEach((h,d)=>{let c={[n]:h};o&&(c[o]=a[h]),l.push(c)}),l};var Zd=class extends Oe{get relatedAxisComponent(){return this._relatedAxisComponent}setStartAndEnd(t,e,i=["percent","percent"]){let[s="percent",n="percent"]=i,o=s==="percent"?t:this.dataToStatePoint(t),a=n==="percent"?e:this.dataToStatePoint(e);this._handleChange(o,a,!0)}enableInteraction(){this._activeRoam=!0}disableInteraction(){this._activeRoam=!1}zoomIn(t){this._handleChartZoom({zoomDelta:1.2,zoomX:t?.x,zoomY:t?.y})}zoomOut(t){this._handleChartZoom({zoomDelta:.8,zoomX:t?.x,zoomY:t?.y})}_handleChange(t,e,i){var s,n;(n=(s=this._spec)===null||s===void 0?void 0:s.zoomLock)!==null&&n!==void 0&&n||e-t!==this._spanCache&&(e-t<this._minSpan||e-t>this._maxSpan)?this._shouldChange=!1:(this._shouldChange=!0,this._spanCache=e-t)}_isReverse(){let t=this._relatedAxisComponent;if(!t)return!1;let e=t.getScale();return e.range()[0]>e.range()[1]&&(!t.getInverse()||this._isHorizontal)}_updateRangeFactor(t){let e=this._relatedAxisComponent.getScale(),i=this._isReverse(),s=i?[1-this._end,1-this._start]:[this._start,this._end];if(i)switch(t){case"startHandler":e.rangeFactorEnd(s[1]);break;case"endHandler":e.rangeFactorStart(s[0]);break;default:e.rangeFactorStart(s[0],!0),e.rangeFactorEnd(s[1])}else switch(t){case"startHandler":e.rangeFactorStart(s[0]);break;case"endHandler":e.rangeFactorEnd(s[1]);break;default:e.rangeFactorEnd(s[1],!0),e.rangeFactorStart(s[0])}let n=e.rangeFactor();n?(this._start=i?1-n[1]:n[0],this._end=i?1-n[0]:n[1]):(this._start=0,this._end=1)}get visible(){return this._visible}constructor(t,e){super(t,e),this.layoutType="none",this._orient="left",this._cacheVisibility=void 0,this._dataUpdating=!1,this._shouldChange=!0,this._stateField="x",this._activeRoam=!0,this._zoomAttr={enable:!0,rate:1,focus:!0},this._dragAttr={enable:!0,rate:1,reverse:!0},this._scrollAttr={enable:!0,rate:1,reverse:!0},this.effect={onZoomChange:i=>{var s,n;let o=this._relatedAxisComponent;if(o&&this._filterMode==="axis"){let a=o.getScale(),l=o.getSpec();this._auto&&this._getAxisBandSize(l)&&this._spec.ignoreBandSize&&(a.bandwidth("auto"),a.maxBandwidth("auto"),a.minBandwidth("auto")),this._updateRangeFactor(i),this._auto&&((n=(s=this._component)===null||s===void 0?void 0:s.setStartAndEnd)===null||n===void 0||n.call(s,this._start,this._end)),o.effect.scaleUpdate({value:"force"})}else be(this._regions,a=>{var l;(l=a.getViewData())===null||l===void 0||l.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),be(this._regions,a=>{a.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._visible=!0,this._handleStateChange=(i,s,n)=>{var o,a;return this._startValue=i,this._endValue=s,this._newDomain=this._parseDomainFromState(this._startValue,this._endValue),(a=(o=this.effect).onZoomChange)===null||a===void 0||a.call(o,n),!0},this._handleChartZoom=(i,s)=>{var n,o;if(!this._activeRoam||this._zoomAttr.filter&&!this._zoomAttr.filter(i,s))return;let{zoomDelta:a,zoomX:l,zoomY:h}=i,{x:d,y:c}=this._regions[0].getLayoutStartPoint(),{width:u,height:p}=this._regions[0].getLayoutRect(),m=Math.abs(this._start-this._end),g=(o=(n=this._spec.roamZoom)===null||n===void 0?void 0:n.rate)!==null&&o!==void 0?o:1;if(m>=1&&a<1||m<=.01&&a>1)return;let f=this._isHorizontal?l:h,_=m*(a-1)*g,v=_/2,x=_/2;if(f){let S=this._isHorizontal?d:c,C=this._isHorizontal?u:p;v=Math.abs(S-f)/Math.abs(C-S)*_,x=Math.abs(C-f)/Math.abs(C-S)*_}let y=ee(this._start+v,0,1),b=ee(this._end-x,0,1);this._handleChange(Math.min(y,b),Math.max(y,b),!0)},this._handleChartScroll=(i,s)=>{var n;if(!this._activeRoam||this._scrollAttr.filter&&!this._scrollAttr.filter(i,s))return!1;let{scrollX:o,scrollY:a}=i,l=this._isHorizontal?o:a,h=this._isHorizontal?Dt(o/a)>=.5:Dt(a/o)>=.5;this._scrollAttr.reverse||(l=-l),h&&this._handleChartMove(l,(n=this._scrollAttr.rate)!==null&&n!==void 0?n:1);let d=this._start!==0&&this._end!==1;return h&&d},this._handleChartDrag=(i,s)=>{var n;if(!this._activeRoam||this._dragAttr.filter&&!this._dragAttr.filter(i,s))return;let[o,a]=i,l=this._isHorizontal?o:a;this._dragAttr.reverse&&(l=-l),this._handleChartMove(l,(n=this._dragAttr.rate)!==null&&n!==void 0?n:1)},this._handleChartMove=(i,s)=>{let n=this._isHorizontal?this.getLayoutRect().width:this.getLayoutRect().height;if(Math.abs(i)>=1e-6){if(i>0&&this._end<1){let o=Math.min(1-this._end,i/n)*s;this._handleChange(this._start+o,this._end+o,!0)}else if(i<0&&this._start>0){let o=Math.max(-this._start,i/n)*s;this._handleChange(this._start+o,this._end+o,!0)}}return!1},this._orient=To(t),this._isHorizontal=VA(this._orient)==="horizontal"}created(){super.created(),this._setAxisFromSpec(),this._setRegionsFromSpec(),this._initEvent(),this._initData(),this._initStateScale(),this._setStateFromSpec()}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}_setAxisFromSpec(){if(A(this._spec.axisId)?this._relatedAxisComponent=this._option.getComponentByUserId(this._spec.axisId):A(this._spec.axisIndex)&&(this._relatedAxisComponent=this._option.getComponentByIndex("axes",this._spec.axisIndex)),T(this._spec.field)&&!this._relatedAxisComponent){let t=this._option.getComponentsByKey("axes"),e=t.find(i=>i._orient===this._orient);if(e)this._relatedAxisComponent=e;else{let i=t.find(s=>!Vt(s.getScale().type));this._relatedAxisComponent=i}}this._relatedAxisComponent&&this._filterMode==="axis"&&(this._relatedAxisComponent.autoIndentOnce=!0)}_setRegionsFromSpec(){var t,e;this._regions=this._relatedAxisComponent?this._relatedAxisComponent.getRegions():this._option.getAllRegions();let i=this._relatedAxisComponent?(e=(t=this._relatedAxisComponent).getBindSeriesFilter)===null||e===void 0?void 0:e.call(t):null;if(A(i)&&(A(i.userId)&&(this._seriesUserId=O(i.userId)),A(i.specIndex)&&(this._seriesIndex=O(i.specIndex))),A(this._spec.seriesId)){let s=O(this._spec.seriesId);this._seriesUserId?this._seriesUserId=this._seriesUserId.filter(n=>s.includes(n)):this._seriesUserId=s}if(A(this._spec.seriesIndex)){let s=O(this._spec.seriesIndex);this._seriesIndex?this._seriesIndex=this._seriesIndex.filter(n=>s.includes(n)):this._seriesIndex=s}if(A(this._spec.regionIndex)){let s=this._option.getRegionsInIndex(O(this._spec.regionIndex));this._regions=this._regions.filter(n=>s.includes(n))}else if(A(this._spec.regionId)){let s=O(this._spec.regionId);this._regions=s.length?this._regions.filter(n=>s.includes(n.id)):[]}}onDataUpdate(){var t;let e=this._computeDomainOfStateScale(Vt(this._stateScale.type));this._stateScale.domain(e,!1),this._handleChange(this._start,this._end,!0),this._spec.auto&&!Bt(this._domainCache,e)&&(this._domainCache=e,this._dataUpdating=!0,(t=this.getChart())===null||t===void 0||t.setLayoutTag(!0,null,!1))}_computeDomainOfStateScale(t){if(this._spec.customDomain)return this._spec.customDomain;let e=this._data.getLatestData().map(i=>i[this._stateField]);if(t){let i=e.map(s=>1*s);return e.length?[Ae(i),Pe(i)]:[-1/0,1/0]}return e}_initEvent(){this._initCommonEvent()}_initData(){let t=[],e=[],i=[];if(this._relatedAxisComponent){let o={};be(this._regions,a=>{var l,h;let d=a.coordinate==="cartesian"?a.getXAxisHelper():a.coordinate==="polar"?a.angleAxisHelper:null,c=a.coordinate==="cartesian"?a.getYAxisHelper():a.coordinate==="polar"?a.radiusAxisHelper:null;if(!d||!c)return;let u=d.getAxisId()===this._relatedAxisComponent.id?d:c.getAxisId()===this._relatedAxisComponent.id?c:this._isHorizontal?d:c,p=u===d?c:d,m=Vt(p.getScale(0).type),g=Vt(u.getScale(0).type);t.push(a.getRawData());let f=a.getSpec(),_=a.coordinate==="cartesian"?O(f.xField):O((l=f.angleField)!==null&&l!==void 0?l:f.categoryField),v=a.coordinate==="cartesian"?O(f.yField):O((h=f.radiusField)!==null&&h!==void 0?h:f.valueField);if(o[a.id]=a.type==="link"?["from_xField"]:u===d?_:v,g?e.push(o[a.id]):e.push(o[a.id][0]),this._valueField){let x=a.type==="link"?["from_yField"]:p===d?_:v;m&&i.push(...x)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._originalStateFields=o}else be(this._regions,o=>{t.push(o.getRawData()),e.push(this._field),this._valueField&&i.push(this._spec.valueField)},{userId:this._seriesUserId,specIndex:this._seriesIndex});let{dataSet:s}=this._option;hs(s,"dataview",zo),nt(s,"dataFilterComputeDomain",l5);let n=new St(s,{name:`${this.type}_${this.id}_data`});n.transform({type:"dataFilterComputeDomain",options:{input:{dataCollection:t,stateFields:e,valueFields:i},output:{stateField:this._stateField,valueField:this._valueField}}},!1),this._data=new Ii(this._option,n),n.reRunAllTransform(),s.multipleDataViewAddListener(t,"change",this._handleDataCollectionChange.bind(this))}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._spec.roamZoom===!0||this._spec.roamZoom?this._zoomAttr=G({},this._zoomAttr,this._spec.roamZoom):this._zoomAttr.enable=!1,this._spec.roamDrag===!0||this._spec.roamDrag?this._dragAttr=G({},this._dragAttr,this._spec.roamDrag):this._dragAttr.enable=!1,this._spec.roamScroll===!0||this._spec.roamScroll?this._scrollAttr=G({},this._scrollAttr,this._spec.roamScroll):this._scrollAttr.enable=!1,this._field=this._spec.field,this._width=this._computeWidth(),this._height=this._computeHeight(),this._visible=(t=this._spec.visible)===null||t===void 0||t}statePointToData(t){let e=this._stateScale,i=e.domain();if(Vt(e.type))return this._isReverse()?i[0]+(It(i)-i[0])*(1-t):i[0]+(It(i)-i[0])*t;let s=e.range();this._isReverse()&&(s=s.slice().reverse());let n=s[0]+(It(s)-s[0])*t;return e.invert(n)}dataToStatePoint(t){let e=this._stateScale,i=e.scale(t),s=e.range();return!this._isHorizontal&&Vt(e.type)&&(s=s.slice().reverse()),(i-s[0])/(It(s)-s[0])}_modeCheck(t,e){return t==="start"?e==="percent"&&A(this._spec.start)||e==="value"&&A(this._spec.startValue):e==="percent"&&A(this._spec.end)||e==="value"&&A(this._spec.endValue)}_setStateFromSpec(){var t,e;let i,s;if(this._auto=!!this._spec.auto,this._spec.rangeMode){let[n,o]=this._spec.rangeMode;this._modeCheck("start",n)&&this._modeCheck("end",o)&&(i=n==="percent"?this._spec.start:this.dataToStatePoint(this._spec.startValue),s=o==="percent"?this._spec.end:this.dataToStatePoint(this._spec.endValue))}else i=this._spec.start?this._spec.start:this._spec.startValue?this.dataToStatePoint(this._spec.startValue):0,s=this._spec.end?this._spec.end:this._spec.endValue?this.dataToStatePoint(this._spec.endValue):1;this._startValue=this.statePointToData(i),this._endValue=this.statePointToData(s),this._start=i,this._end=s,this._minSpan=(t=this._spec.minSpan)!==null&&t!==void 0?t:0,this._maxSpan=(e=this._spec.maxSpan)!==null&&e!==void 0?e:1,Vt(this._stateScale.type)&&this._stateScale.domain()[0]!==It(this._stateScale.domain())&&(this._spec.minValueSpan&&(this._minSpan=this._spec.minValueSpan/(It(this._stateScale.domain())-this._stateScale.domain()[0])),this._spec.maxValueSpan&&(this._maxSpan=this._spec.maxValueSpan/(It(this._stateScale.domain())-this._stateScale.domain()[0]))),this._minSpan=Math.max(0,this._minSpan),this._maxSpan=Math.min(this._maxSpan,1),this._relatedAxisComponent&&this._filterMode==="axis"||this._start===0&&this._end===1||(this._newDomain=this._parseDomainFromState(this._startValue,this._endValue))}_parseFieldOfSeries(t){var e;return(e=this._originalStateFields)===null||e===void 0?void 0:e[t.id]}_initStateScale(){let t=[0,1];if(this._relatedAxisComponent){let e=this._relatedAxisComponent.getScale(),i=Vt(e.type),s=this._computeDomainOfStateScale(i);if(this._stateScale=e.clone(),i){let n=s.map(o=>1*o);this._stateScale.domain(s.length?[Ae(n),Pe(n)]:[0,1],!0).range(t)}else this._stateScale.domain(s,!0).range(t)}else this._stateScale=new bs,this._stateScale.domain(this._computeDomainOfStateScale(),!0).range(t)}init(t){super.init(t),this._addTransformToSeries(),this._start===0&&this._end===1||this.effect.onZoomChange()}_addTransformToSeries(){this._relatedAxisComponent&&this._filterMode==="axis"||(nt(this._option.dataSet,"dataFilterWithNewDomain",a5),nt(this._option.dataSet,"lockStatisticsFilter",o5),be(this._regions,t=>{t.getViewDataStatistics().transform({type:"lockStatisticsFilter",options:{originalFields:()=>t.getViewDataStatistics().getFields(),getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>Vt(this._stateScale.type)},level:1},!1),t.addViewDataFilter({type:"dataFilterWithNewDomain",options:{getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>Vt(this._stateScale.type)},level:Ki.dataZoomFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex}))}onRender(t){}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reMake||Bt(e,t)||(i.reRender=!0,i.reMake=!0),i}reInit(t){super.reInit(t),this._marks.forEach(e=>{e.getMarks().forEach(i=>{this.initMarkStyleWithSpec(i,this._spec[i.name])})})}changeRegions(){}update(t){}resize(t){}_parseDomainFromState(t,e){if(Vt(this._stateScale.type))return[Math.min(e,t),Math.max(e,t)];let i=this._stateScale.domain(),s=i.indexOf(t),n=i.indexOf(e);return i.slice(Math.min(s,n),Math.max(s,n)+1)}_initCommonEvent(){var t,e,i,s,n,o,a;let l={delayType:(e=(t=this._spec)===null||t===void 0?void 0:t.delayType)!==null&&e!==void 0?e:"throttle",delayTime:A((i=this._spec)===null||i===void 0?void 0:i.delayType)?(n=(s=this._spec)===null||s===void 0?void 0:s.delayTime)!==null&&n!==void 0?n:30:0,realTime:(a=(o=this._spec)===null||o===void 0?void 0:o.realTime)===null||a===void 0||a,allowComponentZoom:!0};this._zoomAttr.enable&&this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom,l),this._scrollAttr.enable&&this.initScrollEventOfRegions(this._regions,null,this._handleChartScroll,l),this._dragAttr.enable&&this.initDragEventOfRegions(this._regions,null,this._handleChartDrag,l)}updateLayoutAttribute(){this._visible&&this._createOrUpdateComponent(),super.updateLayoutAttribute()}_autoVisible(t){if(!this._auto)return;t?this.show():this.hide();let e=this._isHorizontal?"height":"width";this.layout.setLayoutRect({[e]:t?this[`_${e}`]:0},{[e]:X.Built_In})}onLayoutStart(t,e,i){super.onLayoutStart(t,e,i);let s=this._autoUpdate(t);this._autoVisible(s),this._dataUpdating=!1}onLayoutEnd(t){let e=!(this._start===0&&this._end===1);this._autoVisible(e),super.onLayoutEnd(t)}getBoundsInRect(t){let e={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0};return this._isHorizontal?(e.y2=e.y1+this._height,e.x2=e.x1+t.width):(e.x2=e.x1+this._width,e.y2=e.y1+t.height),e}hide(){var t;(t=this._component)===null||t===void 0||t.hideAll()}show(){var t;(t=this._component)===null||t===void 0||t.showAll()}_getAxisBandSize(t){let e=t?.bandSize,i=t?.maxBandSize,s=t?.minBandSize;if(e||s||i)return{bandSize:e,maxBandSize:i,minBandSize:s}}_autoUpdate(t){var e,i,s,n,o,a;if(!this._auto)return this._cacheVisibility=void 0,!0;let l=this._relatedAxisComponent,h=l?.getSpec(),d=l?.getScale(),c=this._getAxisBandSize(h);if(!this._dataUpdating&&Ke(d.type)&&t?.height===((e=this._cacheRect)===null||e===void 0?void 0:e.height)&&t?.width===((i=this._cacheRect)===null||i===void 0?void 0:i.width)&&this._fixedBandSize===c?.bandSize)return this._cacheVisibility;let u=!0;if(this._isHorizontal&&t?.width!==((s=this._cacheRect)===null||s===void 0?void 0:s.width)?d.range(l.getInverse()?[t.width,0]:[0,t.width]):t?.height!==((n=this._cacheRect)===null||n===void 0?void 0:n.height)&&d.range(l.getInverse()?[0,t.height]:[t.height,0]),this._cacheRect={width:t?.width,height:t?.height},this._fixedBandSize=c?.bandSize,Ke(d.type)){c&&(this._start||this._end)&&(this.type===W.scrollBar&&(this._start=0,this._end=1),this._updateRangeFactor());let[p,m]=(o=d.rangeFactor())!==null&&o!==void 0?o:[];u=(!T(p)||!T(m))&&!(p===0&&m===1)}else{let[p,m]=(a=d.rangeFactor())!==null&&a!==void 0?a:[this._start,this._end];u=!(p===0&&m===1)}return this.setStartAndEnd(this._start,this._end),this._cacheVisibility=u,u}_getNeedClearVRenderComponents(){return[this._component]}};Ct(Zd,sh);var lv=class extends Zd{constructor(t,e){var i;super(t,e),this.type=W.scrollBar,this.name=W.scrollBar,this.specKey="scrollBar",this.layoutZIndex=Tt.DataZoom,this.layoutLevel=Gi.DataZoom,this.layoutType="region-relative",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"axis"}setAttrFromSpec(){super.setAttrFromSpec(),te(this._spec.roam)&&(this._zoomAttr.enable=!1,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode)}onLayoutEnd(t){var e,i;this._updateScaleRange(),(i=(e=this.effect).onZoomChange)===null||i===void 0||i.call(e),super.onLayoutEnd(t)}_updateScaleRange(){this._component&&this._component.setAttributes({x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height})}_computeWidth(){return J(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:12}_computeHeight(){return J(this._spec.height)?this._spec.height:this._isHorizontal?12:this.getLayoutRect().height}_getAttrs(){var t,e,i,s,n,o;return Object.assign({zIndex:this.layoutZIndex,x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height,range:[this._start,this._end],direction:this._isHorizontal?"horizontal":"vertical",delayType:(t=this._spec)===null||t===void 0?void 0:t.delayType,delayTime:A((e=this._spec)===null||e===void 0?void 0:e.delayType)?(s=(i=this._spec)===null||i===void 0?void 0:i.delayTime)!==null&&s!==void 0?s:30:0,realTime:(o=(n=this._spec)===null||n===void 0?void 0:n.realTime)===null||o===void 0||o},this._getComponentAttrs())}_createOrUpdateComponent(){let t=this._getAttrs();if(this._component)this._component.setAttributes(t);else{let e=this.getContainer();this._component=new fl(t),this._component.addEventListener("scrollDrag",i=>{let s=i.detail.value;this._handleChange(s[0],s[1])}),this._component.addEventListener("scrollUp",i=>{let s=i.detail.value;this._handleChange(s[0],s[1])}),e.add(this._component)}}_handleChange(t,e,i){super._handleChange(t,e,i);let s=JS(this._start,t)&&JS(this._end,e);if(this._shouldChange&&(!s||this._spec.realTime===!1)){i&&this._component&&this._component.setAttribute("range",[t,e]),this._start=t,this._end=e;let n=this.statePointToData(t),o=this.statePointToData(e);(V(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,n,o):this._handleStateChange(this.statePointToData(t),this.statePointToData(e)))&&this.event.emit(rt.scrollBarChange,{model:this,value:{filterData:this._filterMode!=="axis",start:this._start,end:this._end,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){this._spec.auto&&this._data.getDataView().reRunAllTransform()}_getComponentAttrs(){let{rail:t,slider:e,innerPadding:i}=this._spec,s={};return T(i)||(s.padding=i),st(t?.style)||(s.railStyle=gt(t.style)),st(e?.style)||(s.sliderStyle=gt(e.style)),s.disableTriggerEvent=this._option.disableTriggerEvent,s}_getNeedClearVRenderComponents(){return[this._component]}};lv.type=W.scrollBar,lv.specKey="scrollBar";var hv=class extends Fn{_mergeThemeToSpec(t,e){let i=this._theme,s=t;if(this._shouldMergeThemeToSpec()){let n=a=>{let l=ot({selectedBackgroundChart:{line:{},area:{}}},this._theme,a),{selectedBackgroundChart:h={}}=a,{line:d,area:c}=h;return d&&d.visible!==!1&&(l.selectedBackgroundChart.line.style=Object.assign(Object.assign({},l.selectedBackgroundChart.line.style),{visible:!0})),c&&c.visible!==!1&&(l.selectedBackgroundChart.area.style=Object.assign(Object.assign({},l.selectedBackgroundChart.area.style),{visible:!0})),l},o=t;s=H(o)?o.map(a=>n(a)):n(o)}return this._adjustPadding(s),{spec:s,theme:i}}};var wm=class extends Zd{constructor(t,e){var i;super(t,e),this.type=W.dataZoom,this.name=W.dataZoom,this.transformerConstructor=hv,this.specKey="dataZoom",this.layoutZIndex=Tt.DataZoom,this.layoutLevel=Gi.DataZoom,this.layoutType="region-relative",this._isReverseCache=!1,this._dataToPositionX=s=>{let n=this._orient==="left"?this._middleHandlerSize:0,o=this._isHorizontal?this._startHandlerSize/2:0,a=this._isHorizontal?this._stateScale:this._valueScale,l=this._isHorizontal?this._stateField:this._valueField;return a.scale(s[l])+this.getLayoutStartPoint().x+n+o},this._dataToPositionX2=s=>{let n=this._orient==="left"?this._middleHandlerSize:0,o=this._isHorizontal?this._startHandlerSize/2:0,a=this._isHorizontal?this._stateScale:this._valueScale,l=a.domain()[0];return a.scale(l)+this.getLayoutStartPoint().x+n+o},this._dataToPositionY=s=>{let n=this._isHorizontal?this._middleHandlerSize:0,o=this._isHorizontal?0:this._startHandlerSize/2,a=this._isHorizontal?this._valueScale:this._stateScale,l=this._isHorizontal?this._valueField:this._stateField;return a.scale(s[l])+this.getLayoutStartPoint().y+n+o},this._dataToPositionY2=s=>{let n=this._isHorizontal?this._middleHandlerSize:0,o=this._isHorizontal?0:this._startHandlerSize/2,a=this._isHorizontal?this._valueScale:this._stateScale,l=a.domain()[0];return a.scale(l)+this.getLayoutStartPoint().y+n+o},this._valueField="y",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"filter"}created(){super.created(),this._initValueScale()}setAttrFromSpec(){var t,e,i,s,n,o,a,l,h,d;super.setAttrFromSpec(),te(this._spec.roam)&&(this._zoomAttr.enable=this._spec.roam,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode),this._backgroundSize=(e=(t=this._spec.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:30,this._middleHandlerSize=this._computeMiddleHandlerSize(),this._width=this._computeWidth(),this._height=this._computeHeight(),T((n=(s=(i=this._spec)===null||i===void 0?void 0:i.startHandler)===null||s===void 0?void 0:s.style)===null||n===void 0?void 0:n.size)&&(this._spec.startHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize),T((l=(a=(o=this._spec)===null||o===void 0?void 0:o.endHandler)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.size)&&(this._spec.endHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize);let c=(h=this._spec.startHandler.style.visible)===null||h===void 0||h,u=(d=this._spec.endHandler.style.visible)===null||d===void 0||d;this._startHandlerSize=c?this._spec.startHandler.style.size:0,this._endHandlerSize=u?this._spec.endHandler.style.size:0}onLayoutEnd(t){this._updateScaleRange(),this._isReverse()&&!this._isReverseCache&&(this._isReverseCache=this._isReverse(),this.effect.onZoomChange()),this._cacheVisibility!==!1&&super.onLayoutEnd(t)}_initValueScale(){let t=this._computeDomainOfValueScale();if(t){let e=new ir;e.domain(t),this._valueScale=e}}_updateScaleRange(){var t,e;let i=this._startHandlerSize+this._endHandlerSize;if(!this._stateScale||!this._valueScale)return;let s,n=this._isHorizontal?this.getLayoutRect().width-i:this.getLayoutRect().height-i,o=(e=(t=this._relatedAxisComponent)===null||t===void 0?void 0:t.getScale().range())!==null&&e!==void 0?e:[this._startHandlerSize/2,n+this._startHandlerSize/2],a=this._computeWidth(),l=this._computeHeight();this._isHorizontal?(s=this._visible?[this._startHandlerSize/2,a-i+this._startHandlerSize/2]:o,this._stateScale.range(s),this._valueScale.range([l-this._middleHandlerSize,0])):(s=this._visible?[this._startHandlerSize/2,l-i+this._startHandlerSize/2]:o,this._stateScale.range(s),this.layoutOrient==="left"?this._valueScale.range([a-this._middleHandlerSize,0]):this._valueScale.range([0,a-this._middleHandlerSize])),this._component&&this._cacheVisibility!==!1&&this._component.setAttributes({size:{width:a,height:l},position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y}})}_computeDomainOfValueScale(){let t=this._data.getLatestData().map(i=>i[this._valueField]),e=t.map(i=>1*i);return t.length?[Ae(e),Pe(e)]:null}_computeMiddleHandlerSize(){var t,e,i,s;let n=0;if(!((e=(t=this._spec)===null||t===void 0?void 0:t.middleHandler)===null||e===void 0)&&e.visible){let o=(i=this._spec.middleHandler.icon.style.size)!==null&&i!==void 0?i:8,a=(s=this._spec.middleHandler.background.size)!==null&&s!==void 0?s:40;n+=Math.max(o,a)}return n}_computeWidth(){return this._visible===!1?0:J(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:this._backgroundSize+this._middleHandlerSize}_computeHeight(){return this._visible===!1?0:J(this._spec.height)?this._spec.height:this._isHorizontal?this._backgroundSize+this._middleHandlerSize:this.getLayoutRect().height}_isScaleValid(t){if(!t||!t.domain())return!1;let e=t.domain();return(!Vt(t.type)||e[0]!==It(e))&&(!Ke(t.type)||fP(e).length!==1)}_getAttrs(t){var e,i,s,n,o;let a=(e=this._spec)!==null&&e!==void 0?e:{};return Object.assign({zIndex:this.layoutZIndex,start:this._start,end:this._end,position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y},orient:this._orient,size:{width:this._computeWidth(),height:this._computeHeight()},showDetail:a.showDetail,brushSelect:(i=a.brushSelect)!==null&&i!==void 0&&i,zoomLock:(s=a.zoomLock)!==null&&s!==void 0&&s,minSpan:this._minSpan,maxSpan:this._maxSpan,delayType:a.delayType,delayTime:A(a.delayType)?(n=a.delayTime)!==null&&n!==void 0?n:30:0,realTime:(o=a.realTime)===null||o===void 0||o,previewData:t&&this._data.getLatestData(),previewPointsX:t&&this._dataToPositionX,previewPointsY:t&&this._dataToPositionY,tolerance:this._spec.tolerance},this._getComponentAttrs(t))}_createOrUpdateComponent(){if(this._visible){let t=this._isHorizontal?this._stateScale:this._valueScale,e=this._isHorizontal?this._valueScale:this._stateScale,i=this._isScaleValid(t)&&this._isScaleValid(e)&&this._spec.showBackgroundChart!==!1,s=this._getAttrs(i);if(this._component)this._component.setAttributes(s);else{let n=this.getContainer();this._component=new e_(s),this._isHorizontal?i&&this._component.setPreviewPointsY1(this._dataToPositionY2):i&&this._component.setPreviewPointsX1(this._dataToPositionX2),this._component.setStatePointToData(o=>this.statePointToData(o)),this._component.addEventListener("change",o=>{let{start:a,end:l,tag:h}=o.detail;this._handleChange(a,l,void 0,h)}),n.add(this._component),this._updateScaleRange()}}}_handleChange(t,e,i,s){if(super._handleChange(t,e,i),this._shouldChange){i&&this._component&&this._component.setStartAndEnd(t,e),this._start=t,this._end=e;let n=this.statePointToData(t),o=this.statePointToData(e);(V(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,n,o):this._handleStateChange(n,o,s))&&this.event.emit(rt.dataZoomChange,{model:this,value:{filterData:this._filterMode!=="axis",start:t,end:e,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){var t;let e=this._data.getDataView();if(e.reRunAllTransform(),(t=this._component)===null||t===void 0||t.setPreviewData(e.latestData),this._valueScale){let i=this._computeDomainOfValueScale();i&&this._valueScale.domain(i)}}_getComponentAttrs(t){var e,i,s,n,o,a,l,h,d,c,u;let{middleHandler:p={},startText:m={},endText:g={},backgroundChart:f={},selectedBackgroundChart:_={}}=this._spec;return{backgroundStyle:gt((e=this._spec.background)===null||e===void 0?void 0:e.style),startHandlerStyle:gt((i=this._spec.startHandler)===null||i===void 0?void 0:i.style),middleHandlerStyle:p.visible?{visible:!0,icon:gt((s=p.icon)===null||s===void 0?void 0:s.style),background:{size:(n=p.background)===null||n===void 0?void 0:n.size,style:gt((o=p.background)===null||o===void 0?void 0:o.style)}}:{visible:!1},endHandlerStyle:gt((a=this._spec.endHandler)===null||a===void 0?void 0:a.style),startTextStyle:{padding:m.padding,formatMethod:this._getHandlerTextFormatMethod(m),textStyle:gt(m.style)},endTextStyle:{padding:g.padding,formatMethod:this._getHandlerTextFormatMethod(g),textStyle:gt(g.style)},selectedBackgroundStyle:gt(this._spec.selectedBackground.style),dragMaskStyle:gt((l=this._spec.dragMask)===null||l===void 0?void 0:l.style),backgroundChartStyle:t?{line:ot(gt((h=f.line)===null||h===void 0?void 0:h.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},gt((d=f.area)===null||d===void 0?void 0:d.style))}:{line:{visible:!1},area:{visible:!1}},selectedBackgroundChartStyle:t?{line:ot(gt((c=_.line)===null||c===void 0?void 0:c.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},gt((u=_.area)===null||u===void 0?void 0:u.style))}:{line:{visible:!1},area:{visible:!1}},disableTriggerEvent:this._option.disableTriggerEvent}}_getHandlerTextFormatMethod(t){let{formatMethod:e,formatter:i}=t,{formatFunc:s}=_r(e,i);return s?n=>s(n,{label:n},i):void 0}_getNeedClearVRenderComponents(){return[this._component]}clear(){if(this._component){let t=this.getContainer();this._component.removeAllChild(),t&&t.removeChild(this._component),this._component=null}super.clear()}};wm.type=W.dataZoom,wm.transformerConstructor=hv,wm.specKey="dataZoom";var dv=class extends Oe{constructor(){super(...arguments),this.type=W.customMark,this.specKey="customMark",this.layoutType="none",this.layoutZIndex=Tt.CustomMark,this.layoutLevel=Gi.CustomMark}created(){super.created(),this.initMarks(),this.initEvent()}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)}}}initMarks(){if(!this._spec)return;let t=this._option&&this._option.getAllSeries(),e=this._option.animation!==!1,i=[];t&&t.length&&t.forEach(n=>{let o=n&&n.getMarksWithoutRoot();o&&o.length&&o.forEach(a=>{i.push(a)})});let s=null;if(this._spec.parent){let n=this.getChart().getAllMarks().find(o=>o.getUserId()===this._spec.parent);n.type==="group"&&(s=n)}this._createExtensionMark(this._spec,s,`${et}_series_${this.id}_extensionMark`,0,{depend:i,hasAnimation:e})}_createExtensionMark(t,e,i,s=0,n){var o;let a=this._createMark({type:t.type,name:A(t.name)?`${t.name}`:`${i}_${s}`},{skipBeforeLayouted:!0,attributeContext:this._getMarkAttributeContext(),componentType:t.componentType,key:t.dataKey});if(a){if(A(t.id)&&a.setUserId(t.id),n.hasAnimation&&t.animation){let l=_t({},xt(t.type,t,this._markAttributeContext));a.setAnimationConfig(l)}if(n.depend&&n.depend.length&&a.setDepend(...n.depend),T(e)?this._marks.addMark(a):e&&e.addMark(a),this.initMarkStyleWithSpec(a,t),t.type==="group"&&(i=`${i}_${s}`,(o=t.children)===null||o===void 0||o.forEach((l,h)=>{this._createExtensionMark(l,a,i,h,n)})),A(t.dataId)||K(t.dataIndex)){let l=this.getChart().getSeriesData(t.dataId,t.dataIndex);l&&(l.target.addListener("change",()=>{a.getData().updateData()}),a.setDataView(l))}}}initEvent(){}_compareSpec(t,e){let i=super._compareSpec(t,e);return Bt(e,t)||(i.reMake=!0),i.change=!0,i.reRender=!0,i}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}onRender(t){}_getMarkAttributeContext(){return{vchart:this._option.globalInstance,chart:this.getChart(),globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)},getLayoutBounds:()=>{let{x:t,y:e}=this.getLayoutStartPoint(),{width:i,height:s}=this.getLayoutRect();return new Ye().set(t,e,t+i,e+s)}}}_getLayoutRect(){let t=new Ye;return this.getMarks().forEach(e=>{let i=e.getProduct();i&&t.union(i.getBounds())}),t.empty()?{width:0,height:0}:{width:t.width(),height:t.height()}}getBoundsInRect(t){this.setLayoutRect(t);let e=this._getLayoutRect(),{x:i,y:s}=this.getLayoutStartPoint();return{x1:i,y1:s,x2:i+e.width,y2:s+e.height}}getVRenderComponents(){let t=[],e=i=>{var s;if(i&&i.type==="group")i.getMarks().forEach(n=>{e(n)});else if(i.type==="component"){let n=(s=i?.getProduct())===null||s===void 0?void 0:s.getGroupGraphicItem();n&&t.push(n)}};return this.getMarks().forEach(i=>{e(i)}),t}};dv.type=W.customMark,dv.specKey="customMark";var cv=class extends Oe{constructor(){super(...arguments),this.layoutType="none",this.type=W.brush,this.name=W.brush,this.specKey="brush",this.layoutZIndex=Tt.Brush,this._linkedSeries=[],this._itemMap={},this._linkedItemMap={},this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._needInitOutState=!0,this._cacheInteractiveRangeAttrs=[],this._needDisablePickable=!1,this._releatedAxes=[],this._regionAxisMap={},this._axisDataZoomMap={},this._zoomRecord=[]}init(){let t=this._transformBrushedMarkAttr(this._spec.inBrush),e=this._transformBrushedMarkAttr(this._spec.outOfBrush);this._option.getAllSeries().forEach(i=>{i.getActiveMarks().forEach(s=>{s&&(i.setMarkStyle(s,Object.assign({},t),"inBrush",X.Series),i.setMarkStyle(s,Object.assign({},e),"outOfBrush",X.Series))})})}static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e.visible!==!1)}created(){super.created(),this.initEvent(),this._bindRegions(),this._bindLinkedSeries(),this._initRegionAxisMap(),this._initAxisDataZoomMap(),this._initNeedOperatedItem()}_extendDataInBrush(t){var e,i;let s=[];for(let n in t)for(let o in t[n])s.push(Object.assign({},(i=(e=t[n][o])===null||e===void 0?void 0:e.data)===null||i===void 0?void 0:i[0]));return s}_extendDatumOutOfBrush(t){var e;let i=[];for(let s in t)i.push((e=t[s].data)===null||e===void 0?void 0:e[0]);return i}_getBrushInteractiveAttr(t){let e=t.getLayoutStartPoint(),i=t.getLayoutRect(),s=e.x,n=s+i.width,o=e.y,a=o+i.height;return{interactiveRange:{minY:o,maxY:a,minX:s,maxX:n},xRange:[s,n],yRange:[o,a]}}_updateBrushComponent(t,e){let i=this._getBrushInteractiveAttr(t),s=this._brushComponents[e];s.setAttributes(i),this._initMarkBrushState(e,""),s.children[0].removeAllChild(),this._needInitOutState=!0}_createBrushComponent(t,e){var i,s;let n=this._getBrushInteractiveAttr(t),o=new c_(Object.assign(Object.assign(Object.assign({zIndex:this.layoutZIndex,brushStyle:gt((i=this._spec)===null||i===void 0?void 0:i.style)},n),this._spec),{disableTriggerEvent:this._option.disableTriggerEvent}));o.id=(s=this._spec.id)!==null&&s!==void 0?s:`brush-${this.id}`,this.getContainer().add(o);let{brushMode:a="single"}=this._spec;this._brushComponents.push(o),this._cacheInteractiveRangeAttrs.push(n),o.addEventListener(Xi.drawStart,l=>{this._emitEvent(rt.brushStart,t)}),o.addEventListener(Xi.moveStart,l=>{this._emitEvent(rt.brushStart,t)}),o.addEventListener(Xi.drawing,l=>{this._needInitOutState&&a==="single"&&this._initMarkBrushState(e,"outOfBrush"),this._needInitOutState=!1,this._needDisablePickable=!0,this._handleBrushChange(rt.brushChange,t,l),this._emitEvent(rt.brushChange,t)}),o.addEventListener(Xi.moving,l=>{this._handleBrushChange(rt.brushChange,t,l),this._emitEvent(rt.brushChange,t)}),o.addEventListener(Xi.brushClear,l=>{this._initMarkBrushState(e,""),this._needInitOutState=!0,this._needDisablePickable=!1,this._handleBrushChange(rt.brushChange,t,l),this._handleBrushChange(rt.brushClear,t,l),this._emitEvent(rt.brushChange,t),this._emitEvent(rt.brushClear,t)}),o.addEventListener(Xi.drawEnd,l=>{this._needInitOutState=!0,this._needDisablePickable=!1;let{operateMask:h}=l.detail;this._handleBrushChange(rt.brushEnd,t,l);let d=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&d.length>0&&this._setAxisAndDataZoom(h,t),this._emitEvent(rt.brushEnd,t)}),o.addEventListener(Xi.moveEnd,l=>{let{operateMask:h}=l.detail;this._handleBrushChange(rt.brushEnd,t,l);let d=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&d.length>0&&this._setAxisAndDataZoom(h,t),this._emitEvent(rt.brushEnd,t)})}_handleBrushChange(t,e,i){let{operateMask:s}=i.detail;this._reconfigItem(s,e),this._reconfigLinkedItem(s,e)}_emitEvent(t,e){this.event.emit(t,{model:this,value:{operateType:t,operateRegion:e,inBrushData:this._extendDataInBrush(this._inBrushElementsMap),outOfBrushData:this._extendDatumOutOfBrush(this._outOfBrushElementsMap),linkInBrushData:this._extendDataInBrush(this._linkedInBrushElementsMap),linkOutOfBrushData:this._extendDatumOutOfBrush(this._linkedOutOfBrushElementsMap),inBrushElementsMap:this._inBrushElementsMap,outOfBrushElementsMap:this._outOfBrushElementsMap,linkedInBrushElementsMap:this._linkedInBrushElementsMap,linkedOutOfBrushElementsMap:this._linkedOutOfBrushElementsMap,zoomRecord:this._zoomRecord}})}_transformBrushedMarkAttr(t){let e={};return t?.symbol&&(e.symbolType=t.symbol),t?.symbolSize&&(e.size=t.symbolSize),t?.color&&(e.fill=t.color),t?.colorAlpha&&(e.fillOpacity=t.colorAlpha),Object.assign(Object.assign({},gt(t)),e)}_reconfigItem(t,e){this._itemMap[e.id].forEach(i=>{let s=i.getProduct();!s||!s.elements||!s.elements.length||s.elements.forEach(n=>{var o,a,l;let h=n.getGraphicItem(),d=i.id+"_"+n.key;!((o=this._outOfBrushElementsMap)===null||o===void 0)&&o[d]&&this._isBrushContainItem(t,h)?(n.addState("inBrush"),this._inBrushElementsMap[t?.name]||(this._inBrushElementsMap[t?.name]={}),this._inBrushElementsMap[t?.name][d]=n,delete this._outOfBrushElementsMap[d]):!((l=(a=this._inBrushElementsMap)===null||a===void 0?void 0:a[t?.name])===null||l===void 0)&&l[d]&&!this._isBrushContainItem(t,h)&&(n.removeState("inBrush"),n.addState("outOfBrush"),this._outOfBrushElementsMap[d]=n,delete this._inBrushElementsMap[t.name][d]),h.setAttribute("pickable",!this._needDisablePickable)})})}_reconfigLinkedItem(t,e){let i=e.getLayoutStartPoint(),s=e.getSeries().map(n=>n.id);this._linkedSeries.forEach(n=>{if(!s.includes(n.id)){let o=n.getRegion().getLayoutStartPoint(),a=o.x-i.x,l=o.y-i.y;this._linkedItemMap[n.id].forEach(h=>{let d=h.getProduct();!d||!d.elements||!d.elements.length||d.elements.forEach(c=>{var u,p,m;let g=c.getGraphicItem(),f=h.id+"_"+c.key;!((u=this._linkedOutOfBrushElementsMap)===null||u===void 0)&&u[f]&&this._isBrushContainItem(t,g,{dx:a,dy:l})?(c.addState("inBrush"),this._linkedInBrushElementsMap[t?.name]||(this._linkedInBrushElementsMap[t?.name]={}),this._linkedInBrushElementsMap[t?.name][f]=c,delete this._linkedOutOfBrushElementsMap[f]):!((m=(p=this._linkedInBrushElementsMap)===null||p===void 0?void 0:p[t?.name])===null||m===void 0)&&m[f]&&!this._isBrushContainItem(t,g,{dx:a,dy:l})&&(c.removeState("inBrush"),c.addState("outOfBrush"),this._linkedOutOfBrushElementsMap[f]=c),g.setAttribute("pickable",!this._needDisablePickable)})})}})}_isBrushContainItem(t,e,i){var s,n,o;if(!t?.globalTransMatrix||!(!((s=t?.attribute)===null||s===void 0)&&s.points))return!1;let a=(o=(n=t?.attribute)===null||n===void 0?void 0:n.points)!==null&&o!==void 0?o:[],{a:l,b:h,c:d,d:c,e:u,f:p}=t.globalTransMatrix,m=i?.dx||0,g=i?.dy||0,f=a.map(y=>({x:l*y.x+d*y.y+u+m,y:h*y.x+c*y.y+p+g}));t.globalAABBBounds.clone().set(t.globalAABBBounds.x1+m,t.globalAABBBounds.y1+g,t.globalAABBBounds.x2+m,t.globalAABBBounds.y2+g);let _=e.globalTransMatrix.e,v=e.globalTransMatrix.f,x=[];if(e.type==="symbol"){let{size:y=0}=e?.attribute,b=O(y)[0]/2;return x=[{x:_-b,y:v-b},{x:_+b,y:v-b},{x:_+b,y:v+b},{x:_-b,y:v+b}],jC(f,x)}if(e.type==="rect"){let{x1:y,x2:b,y1:S,y2:C}=e?.AABBBounds,k=Math.abs(y-b),M=Math.abs(S-C);return x=[{x:_,y:v},{x:_+k,y:v},{x:_+k,y:v+M},{x:_,y:v+M}],jC(f,x)}return t.globalAABBBounds.intersects(e.globalAABBBounds)}_stateClamp(t){return Math.min(Math.max(0,t),1)}_setAxisAndDataZoom(t,e){var i;if(this._zoomRecord=[],this._spec.zoomAfterBrush){let s=t.AABBBounds;(i=this._regionAxisMap["region_"+e.id])===null||i===void 0||i.forEach(n=>{var o,a;let l=n.layoutOrient==="bottom"||n.layoutOrient==="top",h=(o=this._spec.axisRangeExpand)!==null&&o!==void 0?o:0,{x1:d,x2:c,y1:u,y2:p}=s,m=l?"x":"y",g=l?d:u,f=l?c:p;if(this._axisDataZoomMap[n.id]){let _=this._axisDataZoomMap[n.id],v=_.relatedAxisComponent,x=v.getScale().invert(g-e.getLayoutStartPoint()[m]),y=v.getScale().invert(f-e.getLayoutStartPoint()[m]),b=_.dataToStatePoint(x),S=_.dataToStatePoint(y),C=this._stateClamp(b-h),k=this._stateClamp(S+h);_.setStartAndEnd(Math.min(C,k),Math.max(C,k),["percent","percent"]),this._zoomRecord.push({operateComponent:_,start:C,end:k,startValue:_.statePointToData(C),endValue:_.statePointToData(k)})}else{let _=n.getScale().range(),v=(a=n.getScale().rangeFactor())!==null&&a!==void 0?a:[0,1],x=It(_)<_[0],y=g-e.getLayoutStartPoint()[m],b=f-e.getLayoutStartPoint()[m],S=x?Math.min(y,b):Math.max(y,b),C=x?Math.max(y,b):Math.min(y,b),k=(C-_[0])/(It(_)-_[0])*(v[1]-v[0])+v[0],M=(S-_[0])/(It(_)-_[0])*(v[1]-v[0])+v[0],E=this._stateClamp(k-h),D=this._stateClamp(M+h);n.getScale().rangeFactor([E,D]),n.effect.scaleUpdate(),this._zoomRecord.push({operateComponent:n,start:E,end:D,startValue:n.getScale().invert(C),endValue:n.getScale().invert(S)})}})}}_bindRegions(){A(this._spec.regionId)&&A(this._spec.regionIndex)&&(this._relativeRegions=this._option.getAllRegions()),this._relativeRegions=this._option.getRegionsInUserIdOrIndex(O(this._spec.regionId),O(this._spec.regionIndex))}_bindLinkedSeries(){A(this._spec.brushLinkSeriesId)&&A(this._spec.brushLinkSeriesIndex)||(this._linkedSeries=this._option.getSeriesInUserIdOrIndex(O(this._spec.brushLinkSeriesId),O(this._spec.brushLinkSeriesIndex)))}_initRegionAxisMap(){A(this._spec.axisId)?O(this._spec.axisId).forEach(t=>{this._releatedAxes.push(this._option.getComponentByUserId(t))}):A(this._spec.axisIndex)?O(this._spec.axisIndex).forEach(t=>{this._releatedAxes.push(this._option.getComponentByIndex("axes",t))}):this._releatedAxes=this._option.getComponentsByKey("axes"),this._releatedAxes.forEach(t=>{t?.getRegions().forEach(e=>{this._regionAxisMap["region_"+e.id]?this._regionAxisMap["region_"+e.id].push(t):this._regionAxisMap["region_"+e.id]=[t]})})}_initAxisDataZoomMap(){this._option.getComponentsByKey("dataZoom").forEach(t=>{t.relatedAxisComponent&&(this._axisDataZoomMap[t.relatedAxisComponent.id]=t)})}_initNeedOperatedItem(){let t=this._spec.seriesId,e=this._spec.seriesIndex;this._relativeRegions.forEach(i=>{let s=[];i.getSeries().forEach(n=>{(t&&O(t).includes(n.userId.toString())||e&&O(e).includes(n.getSpecIndex())||!e&&!t)&&s.push(...n.getMarksWithoutRoot()),this._itemMap[i.id]=s})}),this._linkedSeries.forEach(i=>{this._linkedItemMap[i.id]=i.getMarksWithoutRoot()})}_initMarkBrushState(t,e){this._brushComponents.forEach((i,s)=>{s!==t&&i.children[0].removeAllChild()}),this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._option.getAllSeries().forEach(i=>{i.getMarksWithoutRoot().forEach(s=>{let n=s.getProduct();!n||!n.elements||!n.elements.length||n.elements.forEach(o=>{let a=s.id+"_"+o.key;o.removeState("inBrush"),o.removeState("outOfBrush"),o.addState(e),this._outOfBrushElementsMap[a]=o,this._linkedOutOfBrushElementsMap[a]=o})})})}initEvent(){}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return this._brushComponents}_compareSpec(t,e){this._brushComponents&&this._relativeRegions.forEach((s,n)=>{this._updateBrushComponent(s,n)});let i=super._compareSpec(t,e);return Bt(e,t)||(i.reRender=!0,i.reMake=!0),i}onLayoutEnd(t){var e;super.onLayoutEnd(t),!this._option.disableTriggerEvent&&((e=this._spec.visible)===null||e===void 0||e)&&(this._brushComponents?this._relativeRegions.forEach((i,s)=>{this._updateBrushComponent(i,s)}):(this._brushComponents=[],this._relativeRegions.forEach((i,s)=>{this._createBrushComponent(i,s)})))}clearGraphic(){this._brushComponents&&this._brushComponents.forEach(t=>{t._container.incrementalClearChild()})}clear(){if(this._brushComponents){let t=this.getContainer();this._brushComponents.forEach(e=>{e.removeAllChild(),e.releaseBrushEvents(),t&&t.removeChild(e)}),this._brushComponents=null}}};cv.type=W.brush,cv.specKey="brush";function h5(r,t,e=0){return e>Math.max(t.x1-r.x2,r.x1-t.x2,t.y1-r.y2,r.y1-t.y2)}function TZ(r){return{x1:r.x,x2:r.x+r.width,y1:r.y,y2:r.y+r.height}}function kZ(r){return{x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1}}function Jw(r){var t;if(!r||r.length===0)return[];if(r.length===1)return[r[0].rect];let e=r.map(s=>{var n;return Object.assign(Object.assign({},s),{bound:TZ(s.rect),anchorCandidates:DZ((n=s.anchors)!==null&&n!==void 0?n:[],s.point,s.rect,s.offset)})}),i=[];i.push(e[0].bound);for(let s=1;s<=e.length-1;s++){let n=e[s],o=n.bound,a=i.some(l=>h5(l,o));if(n.anchorCandidates)if(a&&((t=n.anchorCandidates)===null||t===void 0?void 0:t.length)>0){for(let l=0;l<n.anchorCandidates.length;l++){let h=n.anchorCandidates[l],d={x1:h.x,y1:h.y,x2:h.x+o.x2-o.x1,y2:h.y+o.y2-o.y1,anchor:h};if(!i.some(c=>h5(c,d))){i.push(d),a=!1;break}}a&&i.push(n.bound)}else i.push(n.bound)}return i.map(s=>kZ(s))}function u5(r,t,e){let i=r.map(h=>h.pointCoord),{x1:s,x2:n,y1:o,y2:a}=BP(i),l=e([(s+n)/2,(o+a)/2]);return l?Jw(r.map(h=>{let d=h.rect,c=p5(t,h.pointCoord)?e(MZ(t,[h.pointCoord.x,h.pointCoord.y],d5(c5(h.point,l)))):h.point;c&&(d.x=c.x,d.y=c.y);let u=d5(c5(h.point,l)),p,m=[];return u>=-45&&u<45?(p="top",m.push("left","right")):u>=45&&u<135?p="right":u>=-135&&u<-45?(p="left",m.push("left")):(p="bottom",m.push("left","right")),h.anchors=m,h.offset=20,h.rect=mC(h.rect,p,0),h})):[]}function d5(r){return r>180?r-360:r}function c5(r,t){return 180*Math.atan2(r.y-t.y,r.x-t.x)/Math.PI+90}function MZ(r,t,e,i=200){let s=5621/i,n=t;for(let o=1;o<=s;o++){let a=GP(n,i,e);if(!p5(r,a))return[a.x,a.y];n=[a.x,a.y]}return t}function p5(r,t){for(let e=0;e<r.length;e++)if(zP(t,r[e]))return!0;return!1}function mC(r,t,e=0){let i=Object.assign({},r);return t==="top"?(i.x-=r.width/2,i.y-=e+r.height/2):t==="bottom"?(i.x-=r.width/2,i.y+=e-r.height/2):t==="left"?(i.x-=e+r.width,i.y-=r.height/2):t==="right"&&(i.x+=e,i.y-=r.height/2),i}function DZ(r,t,e,i=0){let s=[];return r.forEach(n=>{let{x:o,y:a}=mC(Object.assign(Object.assign({},t),{width:e.width,height:e.height}),n,i);s.push({x:o,y:a})}),s}var uv=class extends Oe{constructor(){super(...arguments),this.type=W.mapLabel,this.name=W.mapLabel,this.specKey="mapLabel",this.layoutType="none",this.layoutZIndex=Tt.MarkPoint,this._activeDatum=[]}static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e.visible&&A(e.seriesId))}setAttrFromSpec(){var t,e,i,s;this.nameField=(t=this._spec.nameField)!==null&&t!==void 0?t:(e=this._series)===null||e===void 0?void 0:e.getDimensionField()[0],this.valueField=(i=this._spec.valueField)!==null&&i!==void 0?i:(s=this._series)===null||s===void 0?void 0:s.getMeasureField()[0]}created(){super.created(),this._spec.visible&&(this.initRelatedInfo(),this.initData(),this.initEvent())}initRelatedInfo(){var t,e,i,s,n,o,a,l;this._series=this._option.getSeriesInUserIdOrIndex([this._spec.seriesId])[0],this._spec.position==="outer"&&(this._map=(e=(t=this._regions[0].getSeriesInType("map")[0])===null||t===void 0?void 0:t.getMapViewData())===null||e===void 0?void 0:e.latestData,this._longitudeField=(n=(s=(i=this._regions[0]).getSpec)===null||s===void 0?void 0:s.call(i))===null||n===void 0?void 0:n.longitudeField,this._latitudeField=(l=(a=(o=this._regions[0]).getSpec)===null||a===void 0?void 0:a.call(o))===null||l===void 0?void 0:l.latitudeField)}initData(){let t=this._series;if(!t)return;let e=t.getViewData();if(e){let i=new St(this._option.dataSet,{name:`${this.name}_data`});i.parse([e],{type:"dataview"}),i.transform({type:"copyDataView",level:Ki.copyDataView},!1),this._data=new Ii(this._option,i),i.target.addListener("change",()=>{this._spec.trigger!=="hover"&&this._spec.trigger!=="click"&&(this._activeDatum=this._data.getLatestData())})}}initEvent(){var t;this.event.on("zoom",{filter:s=>this._isRelativeModel(s.model)},s=>(this.handleZoom(s),!0)),this.event.on("panmove",{filter:s=>this._isRelativeModel(s.model)},s=>(this.handlePan(s),!0));let e=this._spec.trigger;if(e==="none")return;let i=(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView();i&&(e==="hover"?(i.addEventListener("element-highlight:start",s=>{this._isRelativeSeries(s.options.seriesId)&&this._updateDatum(s.elements[0].getDatum())}),i.addEventListener("element-highlight:reset",s=>{this._isRelativeSeries(s.options.seriesId)&&this._updateDatum(null)})):e==="click"&&(i.addEventListener("element-select:start",s=>{this._isRelativeSeries(s.options.seriesId)&&this._updateDatum(s.elements[0].getDatum())}),i.addEventListener("elementSelectReset",s=>{this._isRelativeSeries(s.options.seriesId)&&this._updateDatum([])})))}handlePan(t){let{delta:e}=t;this._markerComponents.forEach(i=>{i.translate(e[0],e[1])})}handleZoom(t){this._updateMarkerLayoutAttribute()}_updateDatum(t){this._activeDatum=t,this._markerComponents.forEach((e,i)=>{var s;let n=(s=this._data)===null||s===void 0?void 0:s.getLatestData()[i];this._activeDatum.includes(n)?e.setAttribute("visible",!0):e.setAttribute("visible",!1)})}dataToPosition(t){return this._series.dataToPosition(t)}updateLayoutAttribute(){var t;let e=(t=this._data)===null||t===void 0?void 0:t.getLatestData();e&&e.length!==0&&(super.updateLayoutAttribute(),this._updateMarkerLayoutAttribute())}_updateMarkerLayoutAttribute(){var t;let e=[],i=[];this._markerComponents||(this._markerComponents=(t=this._data)===null||t===void 0?void 0:t.getLatestData().map((n,o)=>{var a;let l=new gd({position:void 0,animation:!1});return l&&(l.name=`${this.name}_marker_${o}`,l.id=(a=this._spec.id)!==null&&a!==void 0?a:`${this.name}_marker_${this.id}`,l.setAttribute("zIndex",this.layoutZIndex)),l})),this._markerComponents.forEach((n,o)=>{n.removeAllChild();let{pairInfo:a,contentMarks:l}=this._evaluateMarker(this._data.getLatestData()[o],o);a&&e.push(a),l&&i.push(l)});let s=this._layoutLabels(e);this._layoutMarkers(s,i),this._renderMarkers()}_evaluateMarker(t,e){var i,s,n,o,a,l,h,d,c,u,p,m;let g=0,f=0,_=0,v=0,x=0,y=this._spec.position||"top",b=this._spec.offset,S=Xr((i=this._spec.background)===null||i===void 0?void 0:i.padding),C=this._spec.space||0;f+=(S?.left||0)+(S?.right||0),_+=(S?.top||0)+(S?.bottom||0);let k={},M=this.dataToPosition(t),E=qo({});if(E.name=`${this.name}_marker_itemContainer_${e}`,k.container=E,(s=this._spec.background)===null||s===void 0?void 0:s.visible){let w=cr(gt(Object.assign({},this._spec.background.style)));w.setAttributes(M),k.labelBackground=w,E.appendChild(w)}if(!((n=this._spec.icon)===null||n===void 0)&&n.visible){let w=_n(gt(Object.assign({},this._spec.icon.style)));w.setAttributes(M),w.setAttribute("symbolType",(o=this._spec.icon.style)===null||o===void 0?void 0:o.shape);let R=w.AABBBounds,N=(a=R?.y2-R?.y1)!==null&&a!==void 0?a:0,z=(l=R?.x2-R?.x1)!==null&&l!==void 0?l:0;k.icon=w,E.appendChild(w),x=N,v+=z,g++}if(!((h=this._spec.nameLabel)===null||h===void 0)&&h.visible){let w=zs(gt(Object.assign({},this._spec.nameLabel.style)));w.setAttributes(M),w.setAttribute("text",t[this.nameField]);let R=w.AABBBounds,N=(d=R?.y2-R?.y1)!==null&&d!==void 0?d:0,z=(c=R?.x2-R?.x1)!==null&&c!==void 0?c:0;k.nameLabel=w,E.appendChild(w),x=Math.max(x,N),v+=z,g++}if(!((u=this._spec.valueLabel)===null||u===void 0)&&u.visible&&A(t[this.valueField])){let w=zs(gt(Object.assign({},this._spec.valueLabel.style)));w.setAttributes(M),w.setAttribute("text",t[this.valueField]);let R=w.AABBBounds,N=(p=R?.y2-R?.y1)!==null&&p!==void 0?p:0,z=(m=R?.x2-R?.x1)!==null&&m!==void 0?m:0;k.valueLabel=w,E.appendChild(w),x=Math.max(x,N),v+=z,g++}let D=Object.values(k).find(w=>!!w&&w.type!=="group"),P={x:D?.getComputedAttribute("x"),y:D?.getComputedAttribute("y")},B={x:P.x,y:P.y,width:0,height:0};B.width=f+v+(g-1)*C,B.height=_+x;let L={rect:B,point:P,index:e};if(y!=="outer"){let w=["top","right","left","bottom"].filter(R=>R!==y);L.rect=mC(B,y,b),L.anchors=w,L.offset=b}else L.pointCoord={x:+t?.[this._longitudeField],y:+t?.[this._latitudeField]};return{pairInfo:L,contentMarks:k}}_layoutMarkers(t,e){var i,s,n;for(let o=0;o<e.length;o++){if(!t[o]||!e[o])return;let{icon:a,nameLabel:l,valueLabel:h,labelBackground:d,container:c}=e[o],u=t[o],p=Xr((i=this._spec.background)===null||i===void 0?void 0:i.padding),m=this._spec.space||0,g=u.height/2,f=p?.left||0;[a,l,h].forEach((b,S)=>{var C,k;if(b){let M=b.AABBBounds,E=0;b.type==="symbol"&&(E+=((C=M.x2-M.x1)!==null&&C!==void 0?C:0)/2),b.setAttributes({x:f+E,y:g}),f+=(k=M.x2-M.x1)!==null&&k!==void 0?k:0,S!==2&&(f+=m)}}),d?.setAttributes({x:0,y:0,width:u.width,height:u.height}),c?.setAttributes({dx:-u.width/2,dy:-u.height/2});let _=this._data.getLatestData()[o],v=this.dataToPosition(_),x=this.getRegions()[0].getLayoutStartPoint(),y=!(!(!((s=this._spec.leader)===null||s===void 0)&&s.visible)||!(a||l||h));this._markerComponents[o].setAttributes({x:x.x,y:x.y,position:v,visible:this._activeDatum.includes(_),itemContent:{refX:0,type:"custom",renderCustomCallback:()=>c,autoRotate:!1,offsetX:u.x+u.width/2-v.x,offsetY:u.y+u.height/2-v.y},itemLine:{visible:y,type:"type-po",lineStyle:gt(Object.assign({},(n=this._spec.leader)===null||n===void 0?void 0:n.style)),startSymbol:{visible:!1}}})}}_renderMarkers(){if(this._markerComponents&&this._markerComponents.length)for(let t=0;t<this._markerComponents.length;t++)this.getContainer().add(this._markerComponents[t])}_layoutLabels(t){return this._spec.position==="outer"&&this._map?u5(t,this._map,e=>this._series.dataToPosition({[this._longitudeField]:e[0],[this._latitudeField]:e[1]})):Jw(t)}_isRelativeModel(t){var e,i,s;let n=(i=(e=this._series.getXAxisHelper())===null||e===void 0?void 0:e.getAxisId())!==null&&i!==void 0?i:(s=this._series.getCoordinateHelper())===null||s===void 0?void 0:s.getCoordinateId();return t?.id===n}_isRelativeSeries(t){return t?.id===this._series.id}onRender(t){}changeRegions(){}_getNeedClearVRenderComponents(){return this._markerComponents}};uv.type=W.mapLabel,uv.specKey="mapLabel";function gC(r){var t,e;let i=Object.assign({},r);return st(r.style)||(i.textStyle=gt(r.style)),st(r.textStyle)||ot(i.textStyle,gt(r.textStyle)),!((t=r.shape)===null||t===void 0)&&t.style&&gt(i.shape.style),!((e=r.background)===null||e===void 0)&&e.style&&gt(i.background.style),i}var EZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};function m5(r,t){let{title:e={},item:i={},pager:s={},background:n={},type:o,id:a,visible:l,orient:h,position:d,data:c,filter:u,regionId:p,regionIndex:m,seriesIndex:g,seriesId:f,padding:_}=r,v=EZ(r,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return e.visible&&(v.title=gC(e)),st(i.focusIconStyle)||gt(i.focusIconStyle),i.shape&&(i.shape=as(i.shape)),i.label&&(i.label=as(i.label)),i.value&&(i.value=as(i.value)),i.background&&(i.background=as(i.background)),pr(i.maxWidth)&&(i.maxWidth=Number(i.maxWidth.substring(0,i.maxWidth.length-1))*t.width/100),pr(i.width)&&(i.width=Number(i.width.substring(0,i.width.length-1))*t.width/100),pr(i.height)&&(i.height=Number(i.height.substring(0,i.height.length-1))*t.width/100),v.item=i,s.type==="scrollbar"?(st(s.railStyle)||gt(s.railStyle),st(s.sliderStyle)||gt(s.sliderStyle)):(st(s.textStyle)||gt(s.textStyle),s.handler&&as(s.handler)),v.pager=s,n.visible&&!st(n.style)&&(ot(v,n.style),A(n.padding)&&(v.padding=n.padding)),v}var g5=(r,t)=>{let e=[],i={},{series:s,seriesField:n}=t;return s().forEach(o=>{let a=n(o),l;l=a===o.getSeriesField()?o.getSeriesInfoList():o.getSeriesInfoInField(a),l.forEach(h=>{i[h.key]||(i[h.key]=!0,e.push(h))})}),e},f5=(r,t)=>{var e,i,s;let{series:n,selected:o,field:a,data:l,customFilter:h}=t,d=o(),c=l();if(d.length===0&&c.length)return[];if(d.length===c.length)return r;let u={};d.forEach(m=>{u[m]=!0});let p=(e=a())!==null&&e!==void 0?e:ui;return h?h(r,d,p):(H(r)&&(!((i=r[0])===null||i===void 0)&&i.nodes)?(r[0].nodes=r[0].nodes.filter(m=>u[m.key]===!0),!((s=r[0])===null||s===void 0)&&s.links&&(r[0].links=r[0].links.filter(m=>u[m.source]===!0&&u[m.target]===!0))):A(p)&&(r=r.filter(m=>u[n.getSeriesFieldValue(m,p)]===!0)),r)};var Jd=class extends Oe{constructor(){super(...arguments),this.layoutType="normal",this.layoutZIndex=Tt.Legend,this.layoutLevel=Gi.Legend,this.specKey="legends",this._orient="left",this._visible=!0,this._position="middle",this._preSelectedData=[],this._selectedData=[],this.effect={onSelectedDataChange:()=>{be(this._regions,t=>{var e;(e=t.getViewData())===null||e===void 0||e.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),be(this._regions,t=>{t.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}get orient(){return this._orient}get visible(){return this._visible}get position(){return this._position}getLegendData(){return this._legendData.getLatestData()}getSelectedData(){return this._selectedData}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._orient=Gu(this._spec.orient)?this._spec.orient:"left",this._position=(t=this._spec.position)!==null&&t!==void 0?t:"middle",this._visible=this._spec.visible!==!1;let{regionId:e,regionIndex:i,seriesId:s,seriesIndex:n}=this._spec;A(s)&&(this._seriesUserId=O(s)),A(e)&&(this._regionUserId=O(e)),A(n)&&(this._seriesIndex=O(n)),A(i)&&(this._regionUserIndex=O(i)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionUserIndex)}created(){super.created(),this.initData()}onRender(t){}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reRender=!0,t?.orient!==e?.orient?(i.reMake=!0,i):(Bt(e,t)||(i.reCompile=!0),i)}changeRegions(t){}_bindLegendDataChange(){this._preSelectedData=this._selectedData.slice(),this._initSelectedData()}initData(){let t=this._initLegendData();t.target.addListener("change",this._bindLegendDataChange.bind(this)),this._legendData=new Ii(this._option,t),this._initSelectedData(),be(this._regions,e=>{e.event.on(rt.rawDataUpdate,{filter:({model:i})=>i?.id===e.id},()=>{this._legendData.getDataView().reRunAllTransform()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}setSelectedData(t){var e,i,s;let n=this._selectedData;T(t)||JSON.stringify(n)===JSON.stringify(t)||(be(this._regions,o=>{o.legendSelectedFilter&&(t=o.legendSelectedFilter(this,t))},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._selectedData=[...t],(i=(e=this.effect).onSelectedDataChange)===null||i===void 0||i.call(e),this.event.emit(rt.legendSelectedDataChange,{model:this}),(s=this._legendComponent)===null||s===void 0||s.setSelected(this._selectedData))}afterSetLayoutStartPoint(t){if(super.afterSetLayoutStartPoint(t),this._legendComponent){let{x:e,y:i}=t;K(e*i)&&this._legendComponent.setAttributes({x:e,y:i})}}getBoundsInRect(t,e){if(!this._visible)return this._legendComponent&&this._legendComponent.parent&&(this._legendComponent.parent.removeChild(this._legendComponent),this._legendComponent=null),{x1:0,y1:0,x2:0,y2:0};let i={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0},s=this._getLegendAttributes(t);if(s.disableTriggerEvent=this._option.disableTriggerEvent,this._legendComponent)Bt(s,this._cacheAttrs)||this._legendComponent.setAttributes(ot({},s,{defaultSelected:this._selectedData}));else{let a=new(this._getLegendConstructor())(ot({},s,{defaultSelected:this._selectedData}));a.name="legend",this._legendComponent=a,this.getContainer().add(a),this._option.disableTriggerEvent||this._initEvent(),a.on("*",(l,h)=>this._delegateEvent(this._legendComponent,l,h))}this._cacheAttrs=s;let n=isFinite(this._legendComponent.AABBBounds.width())?this._legendComponent.AABBBounds.width():0,o=isFinite(this._legendComponent.AABBBounds.height())?this._legendComponent.AABBBounds.height():0;if(this.layoutType!=="normal-inline"){let a=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",l=this._position,{width:h,height:d}=e,c=0,u=0;a==="horizontal"?l==="middle"?c=(h-n)/2:l==="end"&&(c=h-n):l==="middle"?u=(d-o)/2:l==="end"&&(u=d-o),this._legendComponent.setAttributes({dx:c,dy:u})}return i.x2=i.x1+n,i.y2=i.y1+o,i}onDataUpdate(){var t,e,i;if(JSON.stringify(this._preSelectedData)!==JSON.stringify(this._selectedData)){if(this._legendComponent){let s=this._getLegendAttributes(this.getLayoutRect());Bt(s,this._cacheAttrs)||this._legendComponent.setAttributes(ot({},s,{defaultSelected:this._selectedData}))}(e=(t=this.effect).onSelectedDataChange)===null||e===void 0||e.call(t),(i=this.getChart())===null||i===void 0||i.setLayoutTag(!0,null,!1),this.event.emit(rt.legendSelectedDataChange,{model:this})}}_getNeedClearVRenderComponents(){return[this._legendComponent]}clear(){super.clear(),this._cacheAttrs=null,this._preSelectedData=null}};Jd.specKey="legends";var pv=class extends Jd{constructor(){super(...arguments),this.type=W.discreteLegend,this.name=W.discreteLegend}static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>!e.type||e.type==="discrete")}init(t){super.init(t),be(this._regions,e=>{e.addViewDataFilter({type:"discreteLegendFilter",options:{series:e,selected:()=>this._selectedData,field:()=>this._getSeriesLegendField(e),data:()=>this.getLegendDefaultData(),customFilter:this._spec.customFilter},level:Ki.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_initLegendData(){nt(this._option.dataSet,"discreteLegendFilter",f5),nt(this._option.dataSet,"discreteLegendDataMake",g5);let t=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return t.transform({type:"discreteLegendDataMake",options:{series:()=>{let e=[];return be(this._regions,i=>{e.push(i)},{specIndex:this._spec.seriesIndex,userId:this._spec.seriesId}),e},seriesField:e=>this._getSeriesLegendField(e)}}),t}_getSeriesLegendField(t){var e,i,s;let n=t.getSeriesField(),o=(e=this._spec.scaleName)!==null&&e!==void 0?e:this._spec.scale;if(T(o)||!t.getRawData())return n;let a=this._option.globalScale.getScaleSpec(o);if(!a)return n;if(this._spec.field)return this._spec.field;if(!ra(a.domain))return n;let l=a.domain.find(h=>h.dataId===t.getRawData().name);return l&&(s=(i=l.fields)===null||i===void 0?void 0:i[0])!==null&&s!==void 0?s:n}_initSelectedData(){let t=this.getLegendDefaultData();if(this._unselectedData){let e=[],i=[];t.forEach(s=>{this._unselectedData.includes(s)?i.push(s):e.push(s)}),this._selectedData=e,this._unselectedData=i}else this._spec.defaultSelected?this._selectedData=[...this._spec.defaultSelected]:this._selectedData=t}getLegendDefaultData(t){return V(this._spec.data)?this._getLegendItems().map(e=>e.label):this._legendData.getLatestData().map(t?e=>e.originalKey:e=>e.key)}_addDefaultTitleText(t){var e,i,s,n;if(!((e=t.title)===null||e===void 0)&&e.visible&&T(t.title.text)&&T((i=t.title.style)===null||i===void 0?void 0:i.text)){let o=(n=(s=this._regions)===null||s===void 0?void 0:s[0])===null||n===void 0?void 0:n.getSeries()[0];if(!o)return;t.title.text=bd(o.getRawData(),o.getSeriesField())}}_getLegendAttributes(t){let e=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",i=Object.assign(Object.assign({layout:e,items:this._getLegendItems(),zIndex:this.layoutZIndex},m5(this._spec,t)),{maxWidth:t.width,maxHeight:t.height});return this._addDefaultTitleText(i),this._addLegendItemFormatMethods(i),i}_getLegendConstructor(){return n_}setSelectedData(t){t&&(this._unselectedData=this.getLegendDefaultData().filter(e=>!t.includes(e))),super.setSelectedData(t)}_initEvent(){if(this._legendComponent){let t=this._spec.filter!==!1;this._legendComponent.addEventListener(ns.legendItemClick,e=>{let i=ft(e,"detail.currentSelected");t&&this.setSelectedData(i),this.event.emit(rt.legendItemClick,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(ns.legendItemHover,e=>{let i=ft(e,"detail");this.event.emit(rt.legendItemHover,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(ns.legendItemUnHover,e=>{let i=ft(e,"detail");this.event.emit(rt.legendItemUnHover,{model:this,value:i,event:e})})}}_getLegendItems(){let t=(this._legendData.getLatestData()||[]).map(e=>{var i,s;let n=e.style("fillOpacity"),o=e.style("strokeOpacity"),a=e.style("opacity"),l=e.style("texture");return{label:e.key,shape:{symbolType:(s=(i=e.style("symbolType"))!==null&&i!==void 0?i:e.shapeType)!==null&&s!==void 0?s:"circle",fillOpacity:K(n)?n:1,strokeOpacity:K(o)?o:1,opacity:K(a)?a:1,texturePadding:l?1:null,textureSize:l?4:null,texture:l,fill:e.style("fill"),stroke:e.style("stroke"),textureColor:e.style("textureColor"),innerBorder:e.style("innerBorder"),outerBorder:e.style("outerBorder"),lineDash:e.style("lineDash"),lineDashOffset:e.style("lineDashOffset"),lineWidth:e.style("lineWidth")}}});return V(this._spec.data)?this._spec.data(t,this._option.globalScale.getScale("color"),this._option.globalScale):t}_addLegendItemFormatMethods(t){var e,i,s,n;let{formatMethod:o,formatter:a}=(i=(e=this._spec.item)===null||e===void 0?void 0:e.label)!==null&&i!==void 0?i:{},{formatMethod:l,formatter:h}=(n=(s=this._spec.item)===null||s===void 0?void 0:s.value)!==null&&n!==void 0?n:{},{formatFunc:d}=_r(o,a);a&&!o&&d&&(t.item.label.formatMethod=(u,p)=>d(u,p,a));let{formatFunc:c}=_r(l,h);h&&!l&&c&&(t.item.value.formatMethod=(u,p)=>c(h,u,p,a))}};pv.specKey="legends",pv.type=W.discreteLegend;var _5=(r,t)=>{let{series:e,field:i,scale:s}=t,n=i();if(i&&n){let o=1/0,a=-1/0;return e().forEach(l=>{let h=l.getRawDataStatisticsByField(n,!0),d=h?.min,c=h?.max;K(d)&&(o=Math.min(d,o)),K(c)&&(a=Math.max(c,a))}),[o,a]}if(s){let o=s();return o?o.domain():[]}return[]},v5=(r,t)=>{let{selected:e,field:i,data:s,isHierarchyData:n,customFilter:o}=t,a=e(),l=i(),h=n||(d=>d&&d.some(c=>c&&_V(c)));if(a===s())return r;if(l&&!st(a)){let[d,c]=a;return o?o(r,a,l):h(r)?BE(r,+d,+c,l):r.filter(u=>u[l]>=d&&u[l]<=c)}return r};var wZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};function y5(r){let t=ot({},r),{title:e={},handler:i={},rail:s={},track:n={},startText:o,endText:a,handlerText:l,sizeBackground:h,background:d={},type:c,id:u,visible:p,orient:m,position:g,data:f,defaultSelected:_,field:v,filter:x,regionId:y,regionIndex:b,seriesIndex:S,seriesId:C,padding:k}=t,M=wZ(t,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return e.visible&&(M.title=gC(e)),M.showHandler=i.visible!==!1,st(i.style)||(M.handlerStyle=gt(i.style)),A(s.width)&&(M.railWidth=s.width),A(s.height)&&(M.railHeight=s.height),st(s.style)||(M.railStyle=gt(s.style)),st(n.style)||(M.trackStyle=gt(n.style)),M.startText=as(o),M.endText=as(a),M.handlerText=as(l),st(h)||(M.sizeBackground=gt(h)),d.visible&&!st(d.style)&&(ot(M,d.style),A(d.padding)&&(M.padding=d.padding)),M}function x5(r){return r==="color"||r==="size"}var b5={color:a_,size:l_};var PZ=["#C4E7FF","#98CAFF","#75ACFF","#518FF9","#2775DC","#005CBE","#00429F","#00287E"],RZ=[2,10],mv=class extends Jd{static getSpecInfo(t){let e=Fi(t,this.specKey,this.type,i=>x5(i.type));return e&&e.forEach(i=>{i.type=i.spec.type==="color"?W.colorLegend:W.sizeLegend}),e}constructor(t,e){super(t,e),this.type=W.colorLegend,this.name=W.colorLegend;let i=this._spec.type==="color"?W.colorLegend:W.sizeLegend;this.type=i,this.name=i}setAttrFromSpec(){super.setAttrFromSpec(),this._field=this._spec.field,this._legendType=this._spec.type}init(t){super.init(t),be(this._regions,e=>{e.addViewDataFilter({type:"continuousLegendFilter",options:{selected:()=>this._selectedData,field:()=>this._field,data:()=>this._legendData.getLatestData(),isHierarchyData:e.isHierarchyData,customFilter:this._spec.customFilter},level:Ki.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_getScaleInGlobal(){let t=this._option.globalScale,e=this._spec.scale;return e||(e=this._legendType),t.getScale(e)}_initLegendData(){nt(this._option.dataSet,"continuousLegendFilter",v5),nt(this._option.dataSet,"continuousLegendDataMake",_5);let t=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return t.transform({type:"continuousLegendDataMake",options:{series:()=>QS(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}),field:()=>this._field,scale:this._getScaleInGlobal.bind(this)}}),t}_initSelectedData(){this._spec.defaultSelected?this._selectedData=this._spec.defaultSelected.slice():this._selectedData=this._legendData.getLatestData()}_addDefaultTitleText(t){var e,i,s,n;if(!((e=t.title)===null||e===void 0)&&e.visible&&T(t.title.text)&&T((i=t.title.style)===null||i===void 0?void 0:i.text)){let o=this._field;if(o){let d=(n=(s=this._regions)===null||s===void 0?void 0:s[0])===null||n===void 0?void 0:n.getSeries()[0];return d?void(t.title.text=bd(d.getRawData(),o)):void 0}let a=this._spec.scale;a||(a=this._legendType);let l=this._option.globalScale.getScaleSpec(a);if(!ra(l?.domain))return;let h=l.domain[0];if(h.fields.length===0)return;t.title.text=bd(this._option.dataSet.getDataView(h.dataId),h.fields[0])}}_getLegendAttributes(t){var e,i;let s=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",n=s==="horizontal"?"bottom":this.layoutOrient,o=[],a=this._getScaleInGlobal();a&&a.type==="linear"&&(o=a.range()),st(o)&&(o=this._legendType==="color"?PZ:RZ);let l=(e=this._legendData.getLatestData()[0])!==null&&e!==void 0?e:0,h=(i=this._legendData.getLatestData()[1])!==null&&i!==void 0?i:1;this._legendData.getLatestData()[0]===this._legendData.getLatestData()[1]&&(l=Math.min(0,this._legendData.getLatestData()[0]),h=this._legendData.getLatestData()[0]===0?1:Math.max(0,this._legendData.getLatestData()[0]));let d=Object.assign({layout:s,align:n,zIndex:this.layoutZIndex,min:l,max:h,value:this._spec.defaultSelected,[this._legendType==="color"?"colors":"sizeRange"]:o},y5(this._spec));return this._addDefaultTitleText(d),d}_getLegendConstructor(){return b5[this._legendType]}_initEvent(){if(this._legendComponent){let t=this._spec.filter!==!1;this._legendComponent.addEventListener("change",Zi(e=>{let i=ft(e,"detail.value");t&&this.setSelectedData(i),this.event.emit(rt.legendFilter,{model:this,value:i,event:e})},30))}}};mv.specKey="legends",mv.type=W.continuousLegend;var S5=(r,t)=>{let{datum:e,title:i,content:s}=t,n=[],o=e.call(null);return i.visible&&n.push({type:"title",index:0,datum:o,spec:i}),O(s).forEach((a,l)=>{a.visible&&n.push({type:"content",index:l,datum:o,spec:a})}),n};var BZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},gv=class extends Oe{constructor(){super(...arguments),this.type=W.indicator,this.name=W.indicator,this.specKey="indicator",this.layoutType="none",this.layoutZIndex=Tt.Indicator,this.layoutLevel=Gi.Indicator,this._gap=0,this._activeDatum=null}static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e&&e.visible!==!1)}created(){super.created(),this.initData(),this.initEvent()}setAttrFromSpec(){super.setAttrFromSpec(),this._gap=this._spec.gap||0,this._title=this._spec.title,this._content=O(this._spec.content),this._regions=this._option.getRegionsInUserIdOrIndex(O(this._spec.regionId),O(this._spec.regionIndex))}onRender(t){}changeRegions(t){}initEvent(){var t;if(this._option.disableTriggerEvent||this._spec.trigger==="none")return;let e=(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView();e&&(this._spec.trigger==="hover"?(e.addEventListener("element-highlight:start",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(i.elements[0].getDatum())}),e.addEventListener("element-highlight:reset",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(null)})):(e.addEventListener("element-select:start",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(i.elements[0].getDatum())}),e.addEventListener("element-select:reset",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(null)})))}updateDatum(t){this._activeDatum=t,this._displayData.updateData();let e=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(e)}initData(){nt(this._option.dataSet,"indicatorFilter",S5);let t=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});t.transform({type:"indicatorFilter",options:{title:this._title,content:this._content,datum:()=>this._activeDatum}}),t.target.addListener("change",this.updateDatum.bind(this)),this._displayData=new Ii(this._option,t)}updateLayoutAttribute(){let t=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(t),super.updateLayoutAttribute()}_getIndicatorAttrs(){if(this._spec.visible===!1||this._spec.fixed===!1&&this._activeDatum===null)return{visible:!1};let t=this._regions[0],{width:e,height:i}=t.getLayoutRect(),{x:s,y:n}=t.getLayoutStartPoint(),o=this._spec,{content:a,offsetX:l,offsetY:h,limitRatio:d,title:c}=o,u=BZ(o,["content","offsetX","offsetY","limitRatio","title"]),p=[];return O(a).forEach(m=>{let g=ot({},this._theme.content,m);p.push({visible:g.visible!==!1&&(!g.field||this._activeDatum!==null),space:g.space||this._gap,autoLimit:g.autoLimit,autoFit:g.autoFit,fitPercent:g.fitPercent,fitStrategy:g.fitStrategy,style:Object.assign(Object.assign({},LE(xr(g.style,["text"]),this._activeDatum)),{text:this._createText(g.field,g.style.text)})})}),Object.assign({visible:!0,size:{width:e,height:i},zIndex:this.layoutZIndex,x:s,y:n,dx:l?Tl(l,this._computeLayoutRadius()):0,dy:h?Tl(h,this._computeLayoutRadius()):0,limitRatio:d||1/0,title:{visible:c.visible!==!1&&(!A(c.field)||this._activeDatum!==null),space:c.space||this._gap,autoLimit:c.autoLimit,autoFit:c.autoFit,fitPercent:c.fitPercent,fitStrategy:c.fitStrategy,style:Object.assign(Object.assign({},LE(xr(c.style,["text"]),this._activeDatum)),{text:this._createText(c.field,c.style.text)})},content:p},u)}_createOrUpdateIndicatorComponent(t){if(t.visible===!1)return this._indicatorComponent&&this._indicatorComponent.parent&&this._indicatorComponent.parent.removeChild(this._indicatorComponent),void(this._indicatorComponent=null);if(this._indicatorComponent)Bt(t,this._cacheAttrs)||this._indicatorComponent.setAttributes(t);else{let e=this.getContainer(),i=new KS(t);i.name="indicator",e.add(i),this._indicatorComponent=i,this._indicatorComponent.on("*",(s,n)=>this._delegateEvent(this._indicatorComponent,s,n))}this._cacheAttrs=t}_createText(t,e){var i;return t?this._activeDatum?this._activeDatum[t]:"":V(e)?(i=e(this._activeDatum,void 0))!==null&&i!==void 0?i:"":e??""}_computeLayoutRadius(){let t=this._regions[0],{width:e,height:i}=t.getLayoutRect();return Math.min(e/2,i/2)}isRelativeModel(t){return this._regions.some(e=>e.id===t)}_getNeedClearVRenderComponents(){return[this._indicatorComponent]}clear(){this._cacheAttrs=null,super.clear()}getIndicatorComponent(){return this._indicatorComponent}};gv.type=W.indicator,gv.specKey="indicator";var fv=class extends Oe{get orient(){return this._orient}constructor(t,e){super(t,e),this.type=W.title,this.specKey=W.title,this.layoutType="normal",this.layoutZIndex=Tt.Title,this.layoutLevel=Gi.Title,this._orient="top",this._orient=Gu(t.orient)?t.orient:"top"}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}static getSpecInfo(t){return Fi(t,this.specKey,W.title,e=>e.visible!==!1)}onRender(t){}_compareSpec(t,e){let i=super._compareSpec(t,e);return e?.orient===t?.orient&&e?.visible===t.visible||(i.reMake=!0),i.change=!0,i.reRender=!0,i}changeRegions(t){}update(t){}resize(t){}afterSetLayoutStartPoint(t){K(t.x)&&this._titleComponent&&this._titleComponent.setAttribute("x",t.x),K(t.y)&&this._titleComponent&&this._titleComponent.setAttribute("y",t.y),super.afterSetLayoutStartPoint(t)}getBoundsInRect(t){let e={};this.setLayoutRect(t);let i=this._getTitleAttrs();this._createOrUpdateTitleComponent(i),e=this._getTitleLayoutRect();let{x:s,y:n}=this.getLayoutStartPoint();return{x1:s,y1:n,x2:s+e.width,y2:n+e.height}}_getTitleLayoutRect(){let t=this._titleComponent.AABBBounds;return{width:this._spec.width?this._spec.width:K(t.width())?t.width():0,height:this._spec.height?this._spec.height:K(t.height())?t.height():0}}_getTitleAttrs(){var t,e,i,s,n,o,a,l;if(this._spec.visible===!1)return{visible:!1};let h=this.getLayoutRect(),d=We(this._spec.width,h.width,null,h.width),c=We(this._spec.maxWidth,h.width,null,h.width),u=Math.max(Math.min(d,c,h.width),0),p=Object.assign(Object.assign({},xr(this._spec,["padding"])),{textType:(t=this._spec.textType)!==null&&t!==void 0?t:"text",text:(e=this._spec.text)!==null&&e!==void 0?e:"",subtextType:(i=this._spec.subtextType)!==null&&i!==void 0?i:"text",subtext:(s=this._spec.subtext)!==null&&s!==void 0?s:"",x:(n=this._spec.x)!==null&&n!==void 0?n:0,y:(o=this._spec.y)!==null&&o!==void 0?o:0,height:this._spec.height,minWidth:this._spec.minWidth,maxWidth:u,minHeight:this._spec.minHeight,maxHeight:this._spec.maxHeight,padding:this._spec.innerPadding,align:(a=this._spec.align)!==null&&a!==void 0?a:"left",verticalAlign:(l=this._spec.verticalAlign)!==null&&l!==void 0?l:"top",textStyle:Object.assign({width:u,maxLineWidth:u},this._spec.textStyle),subtextStyle:Object.assign({maxLineWidth:u},this._spec.subtextStyle)});return A(this._spec.width)&&(p.textStyle.width=Math.max(d,h.width),p.subtextStyle.width=p.textStyle.width),p}_createOrUpdateTitleComponent(t){if(this._titleComponent)Bt(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{let e=this.getContainer(),i=new h_(t);i.name="title",e.add(i),this._titleComponent=i,i.on("*",(s,n)=>this._delegateEvent(i,s,n))}return this._cacheAttrs=t,this._titleComponent}_getNeedClearVRenderComponents(){return[this._titleComponent]}clear(){super.clear(),this._cacheAttrs=null}};fv.type=W.title,fv.specKey=W.title;function C5(r){return r===ze["desktop-browser"]||r===ze["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:zr(r)||Gr(r)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}var A5;(function(r){r[r.ALL=3]="ALL",r[r.HORIZONTAL=2]="HORIZONTAL",r[r.VERTICAL=1]="VERTICAL"})(A5||(A5={}));var T5=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},LZ={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]},Qd=class extends Oe{get enableRemain(){return this.triggerOff==="none"}constructor(t,e){super(t,e),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=Tt.CrossHair_Grid,this.labelZIndex=Tt.CrossHair,this.trigger="hover",this._handleIn=i=>{if(!this._option)return;let{x:s,y:n}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(s,n);let o=this._getNeedClearVRenderComponents();this._hasActive=o.some(a=>a&&a.attribute.visible!==!1)},this._handleClickInEvent=i=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(i),J(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=Hi(i=>{this._clickLock||this._handleIn(i)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=i=>{let s=i.tooltipData;if(i.isEmptyTooltip||!s||!s.length)return void this._handleTooltipHideOrRelease();if(ct(this._spec.followTooltip)&&this._spec.followTooltip[i.activeType]===!1)return void this._handleTooltipHideOrRelease();let{x:n,y:o}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(n,o,s,i.activeType);let a=this._getNeedClearVRenderComponents();this._hasActive=a.some(l=>l&&l.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_setAllAxisValues(t,e,i){let s=!1;if(t.forEach(o=>{Ke(o.axis.getScale().type)&&(s?this.enable=!1:s=!0)}),!this.enable)return!1;let{currentValue:n}=this._stateByField[i];return t.forEach((o,a)=>{let l=o.axis;n.set(a,{datum:this._getDatumAtPoint(l,e),axis:l})}),!0}clearAxisValue(){Object.keys(this._stateByField).forEach(t=>{this._stateByField[t].currentValue.clear()})}hideCrosshair(){this.clearAxisValue(),this.hide()}showCrosshair(t){t&&t.length&&(this.showDefault=!1,this.clearAxisValue(),t.forEach(e=>{let{axis:i,value:s}=e;this.setAxisValue(s,i)}),this.layoutByValue())}_getLimitBounds(){var t,e;if(!this._limitBounds){let{width:i,height:s}=(e=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getViewRect())!==null&&e!==void 0?e:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:i,y2:s}}return this._limitBounds}_showDefaultCrosshairBySpec(){Object.keys(this._stateByField).forEach(t=>{let e=this._spec[t];if(e&&e.visible&&e.defaultSelect){let{axisIndex:i,datum:s}=e.defaultSelect,n=this._option.getComponentsByKey("axes").find(o=>o.getSpecIndex()===i);n&&(this._stateByField[t].currentValue.clear(),this._stateByField[t].currentValue.set(i,{axis:n,datum:s}))}})}_updateVisibleCrosshair(){let t=!1;Object.keys(this._stateByField).forEach(e=>{let i=this._spec[e];i&&i.visible&&this._stateByField[e].currentValue.size?t=!0:this._hideByField(e)}),t&&this.layoutByValue()}_showDefaultCrosshair(){this.showDefault?(this._showDefaultCrosshairBySpec(),this.layoutByValue()):this._updateVisibleCrosshair()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reMake||Bt(e,t)||(i.reRender=!0,i.reMake=!0),i}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{let t=this._getTriggerEvent();t&&t.forEach(e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)})}}_registerEvent(t,e,i){let s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent,n=e?{level:Se.chart}:{source:jt.chart};H(t)?t.forEach(o=>{this.event.on(o,n,s)}):this.event.on(t,n,s)}_eventOff(t,e,i){let s=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent;H(t)?t.forEach(n=>{this.event.off(n,s)}):this.event.off(t,s)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(t){let{event:e}=t,i=this._option.getCompiler().getStage().getLayer(void 0),s={x:e.viewX,y:e.viewY};return i.globalTransMatrix.transformPoint({x:e.viewX,y:e.viewY},s),{x:s.x-this.getLayoutStartPoint().x,y:s.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){let{mode:t=ze["desktop-browser"]}=this._option,e=C5(t);if(e){let i=O(this.trigger||"hover"),s=o=>o==="click"?this.triggerOff==="none"?null:e.clickOut:e.hoverOut;this._spec.lockAfterClick&&!i.includes("click")?(i.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;let n=[];return i.forEach(o=>{n.push({click:o==="click",in:e[o],out:s(o)})}),n}return null}_registerTooltipEvent(){this.event.on(rt.tooltipHide,{source:jt.chart},this._handleTooltipHideOrRelease),this.event.on(rt.tooltipShow,{source:jt.chart},this._handleTooltipShow),this.event.on(rt.tooltipRelease,{source:jt.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(t){var e,i;let s=(i=(e=this._option).getComponentsByKey)===null||i===void 0?void 0:i.call(e,"axes");if(!s?.length)return null;let n=ft(this._spec,`${t}Field.bindingAxesIndex`);if(n||(n=[],s.forEach((p,m)=>{LZ[t].includes(p.getOrient())&&n.push(m)})),!n.length)return null;let o=new Map,a=1/0,l=1/0,h=-1/0,d=-1/0,{x:c,y:u}=this.getLayoutStartPoint();return n.forEach(p=>{a=1/0,l=1/0,h=-1/0,d=-1/0;let m=s.find(g=>g.getSpecIndex()===p);m&&(m.getRegions().forEach(g=>{let{x:f,y:_}=g.getLayoutStartPoint();a=Math.min(a,f-c),l=Math.min(l,_-u),h=Math.max(h,f+g.getLayoutRect().width-c),d=Math.max(d,_+g.getLayoutRect().height-u)}),o.set(p,{x1:a,y1:l,x2:h,y2:d,axis:m}))}),o}changeRegions(t){}onLayoutEnd(t){let e=this._regions[0];this.setLayoutRect(e.getLayoutRect()),this.setLayoutStartPosition(e.getLayoutStartPoint()),super.onLayoutEnd(t)}onRender(t){}_releaseEvent(){this.clearOutEvent();let t=this._getTriggerEvent();t&&t.forEach(e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)})}_parseFieldInfo(){Object.keys(this._stateByField).forEach(t=>{let e=this._spec[t],{crosshairComp:i}=this._stateByField[t];if(e&&e.visible){if(this._stateByField[t].attributes=this._parseField(e,t),i){let{style:s,type:n}=this._stateByField[t].attributes,o=n==="rect"?"rectStyle":"lineStyle";i.setAttributes({[o]:s})}}else i&&i.parent&&i.parent.removeChild(i)})}_parseCrosshairSpec(){this._parseFieldInfo();let{trigger:t,triggerOff:e,labelZIndex:i,gridZIndex:s}=this._spec;t&&(this.trigger=t),(e==="none"||J(e)&&e>0)&&(this.triggerOff=e),i!==void 0&&(this.labelZIndex=i),s!==void 0&&(this.gridZIndex=s)}_parseField(t,e){var i,s;let n={},{line:o={},label:a={},visible:l}=t;if(n.visible=l,n.type=o.type||"line",o.visible===!1)n.style={visible:!1};else{let h=o.style||{},{stroke:d,fill:c,lineWidth:u}=h,p=h,{strokeOpacity:m,fillOpacity:g,opacity:f}=p,_=T5(p,["strokeOpacity","fillOpacity","opacity"]),v=n.type==="line",x=v?m:g;if(J(f)&&(x=(x??1)*f),n.style=Object.assign({opacity:x,pickable:!1,visible:!0},_),v)n.style.stroke=d||c,n.style.lineWidth=ft(o,"width",u||2);else{n.style.fill=c||d,!((s=(i=t?.line)===null||i===void 0?void 0:i.style)===null||s===void 0)&&s.stroke&&(n.style.stroke=t.line.style.stroke);let y=ft(o,"width");if(typeof y=="string"){let b=parseInt(y.substring(0,y.length-1),10)/100;n.style.sizePercent=b}else typeof y!="number"&&typeof y!="function"||(n.style.size=y)}}if(a.visible){let h=a.labelBackground||{},d=a.style||{},c=h.style||{},{fill:u="rgba(47, 59, 82, 0.9)",stroke:p,outerBorder:m}=c,g=T5(c,["fill","stroke","outerBorder"]);n.label={visible:!0,formatMethod:a.formatMethod,formatter:a.formatter,minWidth:h.minWidth,maxWidth:h.maxWidth,padding:h.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},d),{fill:d.fill||"#fff",stroke:ft(d,"stroke")}),panel:(te(h.visible)?h.visible:h)?Object.assign({visible:!0,pickable:!1,fill:u,stroke:p,outerBorder:Object.assign({stroke:u,distance:0,lineWidth:3},m)},g):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else n.label={visible:!1};return n}_filterAxisByPoint(t,e,i){return t&&t.forEach(s=>{let n=s.axis;if(CH(s,e,i)&&t.delete(n.getSpecIndex()),n.type.startsWith("polarAxis")){let o=n.getCenter(),a=n.getInnerRadius(),l=n.getOuterRadius(),h=pe.distancePP({x:e,y:i},o);(h>l||h<a)&&t.delete(n.getSpecIndex())}}),t}_updateCrosshairLabel(t,e,i){let s=this.getContainer();t?t.setAttributes(e):(t=new Wi(e),s?.add(t),i(t)),Yz(t,this._getLimitBounds())}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}_hideByField(t){let{crosshairComp:e,labelsComp:i}=this._stateByField[t];e&&e.hideAll(),i&&Object.keys(i).forEach(s=>{i[s]&&i[s].hideAll()})}hide(){Object.keys(this._stateByField).forEach(t=>{this._hideByField(t)})}_getNeedClearVRenderComponents(){return Object.keys(this._stateByField).reduce((t,e)=>{let{crosshairComp:i,labelsComp:s}=this._stateByField[e];return i&&t.push(i),s&&Object.keys(s).forEach(n=>{s[n]&&t.push(s[n])}),t},[])}};Qd.specKey="crosshair";var k5=(r,t,e,i=!1)=>(e||(e={x:0,y:0}),Object.keys(r).forEach(s=>{let{currentValue:n,cacheInfo:o,labelsComp:a,attributes:l,coordKey:h}=r[s],d=null,c=0;if(n.size){let _=Array.from(n.values())[0];c=_.axis.getScale().scale(_.datum)+_.axis.getLayoutStartPoint()[h]-e[h],d=_.axis}let u=!!n.size&&Number.isFinite(c),p=i&&!u&&A(o),m=p?o:{coordRange:[0,0],sizeRange:[0,0],coord:c,labelsTextStyle:{},labels:a?Object.keys(a).reduce((_,v)=>(_[v]={visible:!1,text:"",dx:0,dy:0},_),{}):null,visible:u,axis:d},g;m&&(m._isCache=p);let f=0;if(l&&n.forEach(({axis:_,datum:v=""})=>{var x;let y=null,b=_.getScale();if(Ke(b.type))g=b.bandwidth(),g===0&&b.step&&(f=b.step());else if(Vt(b.type)){let S=s==="xField"?t.fieldX[0]:t.fieldY[0],C=s==="xField"?t.fieldX2:t.fieldY2,k=Xz(t.getViewData().latestData,+v,S,C);if(k){let M=s==="xField"?t.dataToPositionX(k):t.dataToPositionY(k);C?(g=Math.abs(M-(s==="xField"?t.dataToPositionX1(k):t.dataToPositionY1(k))),v=`${k[S]} ~ ${k[C]}`):g=1,c=M}y=_.niceLabelFormatter}if(m&&(!((x=l.label)===null||x===void 0)&&x.visible)&&!p){let S=Ap(_.getSpec()),C=_.getOrient();m.labels[C]&&(m.labels[C].visible=!0,m.labels[C].text=v,C==="left"?(m.labels[C].dx=-S,m.labelsTextStyle[C]={textAlign:"right",textBaseline:"middle"}):C==="right"?(m.labels[C].dx=S,m.labelsTextStyle[C]={textAlign:"left",textBaseline:"middle"}):C==="top"?(m.labels[C].y=0,m.labels[C].dy=-S,m.labelsTextStyle[C]={textAlign:"center",textBaseline:"bottom"}):C==="bottom"&&(m.labels[C].dy=S,m.labelsTextStyle[C]={textAlign:"center",textBaseline:"top"}),m.labels[C].defaultFormatter=y)}}),m&&!p){let _={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};FZ(_,n),s==="xField"?(m.coordRange=[_.x1,_.x2],m.sizeRange=[_.y1,_.y2],m.coord=c+e.x,m.labels&&(m.labels.top.y=_.y1,m.labels.bottom.y=_.y2)):(m.coordRange=[_.y1,_.y2],m.sizeRange=[_.x1,_.x2],m.coord=c+e.y,m.labels&&(m.labels.left.x=_.x1,m.labels.right.x=_.x2)),(m.coord<m.coordRange[0]||m.coord>m.coordRange[1])&&(m.visible=!1),l&&l.label&&Object.keys(m.labels).forEach(v=>{m.labels[v].visible&&IZ(m.labels[v],v,l.label)})}r[s].bandSize=g??0,r[s].offsetSize=f,r[s].cacheInfo=m}),r),IZ=(r,t,e)=>{let{formatMethod:i,formatter:s}=e,{formatFunc:n,args:o}=_r(i,s,r.text,{label:r.text,position:t});n?r.text=n(...o):r.defaultFormatter&&(r.text=r.defaultFormatter(r.text))},FZ=(r,t)=>{t.forEach(({axis:e})=>{e.getRegions().forEach(i=>{let{x:s,y:n}=i.getLayoutStartPoint(),{width:o,height:a}=i.getLayoutRect();r.x1=Math.min(r.x1,s),r.y1=Math.min(r.y1,n),r.x2=Math.max(r.x2,s+o),r.y2=Math.max(r.y2,n+a)})})},M5=r=>{let{cacheInfo:t,attributes:e,bandSize:i,offsetSize:s,coordKey:n,anotherAxisKey:o}=r,{coord:a,sizeRange:l}=t,h=e.type,d;if(h==="line"){let c=a+i/2;d={visible:!0,start:{[n]:c,[o]:l[0]},end:{[n]:c,[o]:l[1]}}}else if(h==="rect"){let c=OZ(e,i,t.axis),{coordRange:u}=t;d={visible:!0,start:{[n]:Math.max(a-c/2-s/2,u[0]),[o]:l[0]},end:{[n]:Math.min(a+i+c/2+s/2,u[1]),[o]:l[1]}}}return d},OZ=(r,t,e)=>{var i,s,n;let o=0;if(!((i=r.style)===null||i===void 0)&&i.sizePercent)o=(r.style.sizePercent-1)*t;else if(typeof((s=r.style)===null||s===void 0?void 0:s.size)=="number")o=r.style.size-t;else if(typeof((n=r.style)===null||n===void 0?void 0:n.size)=="function"){let a=e.getLayoutRect();o=r.style.size(a,e)-t}return o};var _v=class extends Qd{static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e.xField&&e.xField.visible!==!1||e.yField&&e.yField.visible!==!1)}constructor(t,e){super(t,e),this.type=W.cartesianCrosshair,this.name=W.cartesianCrosshair,this._stateByField={xField:{coordKey:"x",anotherAxisKey:"y",currentValue:new Map,labelsComp:{top:null,bottom:null}},yField:{coordKey:"y",anotherAxisKey:"x",currentValue:new Map,labelsComp:{left:null,right:null}}}}_findAllAxisContains(t,e){let i=this._getAxisInfoByField("x"),s=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(i,t,e),yAxisMap:this._filterAxisByPoint(s,t,e)}}_getDatumAtPoint(t,e){let i=ve(t.getOrient())?"x":"y",s=e[i]-(t.getLayoutStartPoint()[i]-this.getLayoutStartPoint()[i]);return t.getScale().invert(s)}setAxisValue(t,e){ve(e.getOrient())?this._stateByField.xField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e}):this._stateByField.yField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e})}_layoutCrosshair(t,e,i,s){var n;let o=t,a=e;if(i&&i.length){if(s==="dimension"){let d=i[0],c=d.data.findIndex(p=>p.datum.length>0),u;if(c>-1){let p=d.data[c];u=p.series.dataToPosition(p.datum[0])}(A(d.dimType)?d.dimType==="y":ls((n=d?.axis)===null||n===void 0?void 0:n.getOrient()))?a=u?.y:o=u?.x}else if(s==="mark"){let d=i[0],c=d.series.dataToPosition(d.datum[0]);o=c?.x,a=c?.y}}this.clearAxisValue();let{xAxisMap:l,yAxisMap:h}=this._findAllAxisContains(o,a);if(l&&l.size===0||h&&h.size===0){if(this.enableRemain)return;this.hide()}else l&&l.size&&this._setAllAxisValues(l,{x:o,y:a},"xField"),h&&h.size&&this._setAllAxisValues(h,{x:o,y:a},"yField"),this.layoutByValue(3)}layoutByValue(t=3){if(!this.enable)return;let e=ju(this._regions,"cartesian");e&&(k5(this._stateByField,e,this.getLayoutStartPoint(),this.enableRemain),Object.keys(this._stateByField).forEach(i=>{this._layoutByField(i)}))}_layoutByField(t){let{cacheInfo:e,attributes:i,labelsComp:s,bandSize:n,coordKey:o}=this._stateByField[t];if(!i||!e||e._isCache&&this.enableRemain)return;let{coord:a,labels:l,visible:h,labelsTextStyle:d}=e;if(h){let c=M5(this._stateByField[t]);this._updateCrosshairByField(t,c),Object.keys(l).forEach(u=>{var p;if(l[u].visible){let m=Object.assign(Object.assign(Object.assign({[o]:a+n/2},l[u]),i.label),{textStyle:Object.assign(Object.assign({},(p=i.label)===null||p===void 0?void 0:p.textStyle),d[u]),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(s[u],m,g=>{g.name=`crosshair-${t.replace("Field","")}-${u}-label`,s[u]=g})}else s[u]&&s[u].hideAll()})}else this._hideByField(t)}_updateCrosshairByField(t,e){let i=this.getContainer(),{attributes:s}=this._stateByField[t],{crosshairComp:n}=this._stateByField[t];if(n)n.setAttributes(e);else{let o=s.style;s.type==="line"?n=new hd(Object.assign(Object.assign({},e),{lineStyle:o,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):s.type==="rect"&&(n=new Hf(Object.assign(Object.assign({},e),{rectStyle:o,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),i?.add(n),this._stateByField[t].crosshairComp=n}}};_v.specKey="crosshair",_v.type=W.cartesianCrosshair;var D5=(r,t,e=!1)=>{Object.keys(r).forEach(i=>{let{attributes:s,currentValue:n,cacheInfo:o,coordKey:a}=r[i];if(s){let l=!!n.size,h=e&&!l&&A(o),d=h?o:{coord:0,axis:null,visible:l,coordRange:[0,0],sizeRange:[0,0],labels:{all:{visible:!1,text:"",offset:0}}};if(o&&(o._isCache=h),i==="valueField"&&(d.sides=t.angleAxisHelper.getScale(0).domain().length),n.forEach(({axis:c,datum:u=""})=>{var p;let m=c.niceLabelFormatter;if(!((p=s.label)===null||p===void 0)&&p.visible&&(d.labels.all.visible=!0,d.labels.all.defaultFormatter=m,d.labels.all.text=u,d.labels.all.offset=Ap(c.getSpec())),i==="categoryField"){let g=t.angleAxisHelper.dataToPosition([u]),f=t.angleAxisHelper.getBandwidth(0),_=c.getOuterRadius();d.coord=g,d.coordRange=[g-f/2,g+f/2],d.sizeRange=[_,_]}else{let g=c.startAngle,f=t.radiusAxisHelper.dataToPosition([u]);d.coord=f,d.coordRange=[f,f],d.sizeRange=[g,g]}d.axis=c}),d&&!h&&d.labels.all.visible&&s&&s.label){let c=d.labels.all,{formatMethod:u,formatter:p}=s.label,{formatFunc:m,args:g}=_r(u,p,c.text,{label:c.text,orient:a});m?c.text=m(...g):c.defaultFormatter&&(c.text=c.defaultFormatter(c.text))}r[i].cacheInfo=d}})},E5=(r,t,e)=>{let{cacheInfo:i,coordKey:s,attributes:n}=r,{axis:o,coord:a,sizeRange:l,coordRange:h}=i,d=o.getCenter(),c={x:d.x+t.x,y:d.y+t.y};if(s==="angle")return(n.type==="rect"?"sector":"line")=="sector"?{center:c,innerRadius:o.getInnerRadius(),radius:o.getOuterRadius(),startAngle:h[0],endAngle:h[1]}:{start:oe(c,o.getInnerRadius(),a),end:oe(c,o.getOuterRadius(),a)};let u=o.startAngle,p=o.endAngle,m=i.sides,g=a;if(!e){let f=o.getCenter(),_=o.coordToPoint({angle:l[0],radius:a}),v=jv(f,_),x=(p-u)/m,y=Math.floor((v-u)/x),b=y*x+u,S=Math.min((y+1)*x+u,p),C=oe(f,a,b),k=oe(f,a,S),M=wP([k.x,k.y],[C.x,C.y],[f.x,f.y],[_.x,_.y]);M&&(g=ee(pe.distancePN(_,M[0],M[1])+a,o.getInnerRadius(),o.getOuterRadius()))}return{center:c,startAngle:u,endAngle:p,radius:g,sides:m}};var vv=class extends Qd{static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e.categoryField&&e.categoryField.visible!==!1||e.valueField&&e.valueField.visible!==!1)}constructor(t,e){super(t,e),this.type=W.polarCrosshair,this.name=W.polarCrosshair,this._stateByField={categoryField:{coordKey:"angle",anotherAxisKey:"radius",currentValue:new Map,labelsComp:{all:null}},valueField:{coordKey:"radius",anotherAxisKey:"angle",currentValue:new Map,labelsComp:{all:null}}}}setAxisValue(t,e){e.getOrient()==="radius"?this._stateByField.valueField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e}):this._stateByField.categoryField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e})}_findAllAxisContains(t,e){let i=this._getAxisInfoByField("category"),s=this._getAxisInfoByField("value");return{angleAxisMap:this._filterAxisByPoint(i,t,e),radiusAxisMap:this._filterAxisByPoint(s,t,e)}}_getDatumAtPoint(t,e){let{x:i,y:s}=t.getLayoutStartPoint(),{x:n,y:o}=this.getLayoutStartPoint();return t.positionToData({x:e.x-(i-n),y:e.y-(s-o)})}_layoutCrosshair(t,e,i,s){let n=t,o=e;if(i&&i.length){if(s==="dimension"){let h=i[0];if(h.axis){let d=h.axis.pointToCoord({x:n,y:o}),c=h.axis.getOrient()==="radius"?{radius:h.position,angle:d.angle}:{radius:d.radius,angle:h.position},u=h.axis.coordToPoint(c);n=u.x,o=u.y}}else if(s==="mark"){let h=i[0],d=h.series.dataToPosition(h.datum[0]);n=d.x,o=d.y}}this.clearAxisValue();let{angleAxisMap:a,radiusAxisMap:l}=this._findAllAxisContains(n,o);if(a.size!==0||l.size!==0)a&&this._setAllAxisValues(a,{x:n,y:o},"categoryField"),l&&this._setAllAxisValues(l,{x:n,y:o},"valueField"),this.layoutByValue(3);else{if(this.enableRemain)return;this.hide()}}layoutByValue(t=3){if(!this.enable)return;let e=ju(this._regions,"polar");e&&(D5(this._stateByField,e,this.enableRemain),Object.keys(this._stateByField).forEach(i=>{this._layoutByField(i)}))}_layoutByField(t){var e,i,s;let{cacheInfo:n,attributes:o,crosshairComp:a,labelsComp:l,coordKey:h}=this._stateByField[t];if(!n||n._isCache&&this.enableRemain)return;let d=this.getContainer(),{visible:c,labels:u,coord:p,sizeRange:m,axis:g}=n;if(c){let f=this.getLayoutStartPoint(),_=(i=(e=this._spec.valueField)===null||e===void 0?void 0:e.line)===null||i===void 0?void 0:i.smooth,v=E5(this._stateByField[t],f,_);if(a)a.setAttributes(v);else{let y;if(h==="angle"){let b=o.type==="rect"?"sector":"line";b==="line"?y=new hd(Object.assign(Object.assign({},v),{lineStyle:o.style,zIndex:this.gridZIndex,pickable:!1})):b==="sector"&&(y=new Vf(Object.assign(Object.assign({},v),{sectorStyle:o.style,zIndex:this.gridZIndex,pickable:!1})))}else y=(_?"circle":"polygon")=="polygon"?new jf(Object.assign(Object.assign({},v),{lineStyle:o.style,zIndex:this.gridZIndex+1})):new Nf(Object.assign(Object.assign({},v),{lineStyle:o.style,zIndex:this.gridZIndex}));this._stateByField[t].crosshairComp=y,d.add(y)}let x=u.all;if(x.visible){let y=g.getCenter(),b={x:y.x+f.x,y:y.y+f.y},S=h==="angle"?ID(p):DH(g.startAngle),C=h==="angle"?oe(b,m[1]+x.offset,p):oe(b,v.radius,g.startAngle),k=Object.assign(Object.assign(Object.assign(Object.assign({},C),o.label),x),{textStyle:Object.assign(Object.assign({},(s=o.label)===null||s===void 0?void 0:s.textStyle),{textAlign:S.align,textBaseline:S.baseline}),zIndex:this.labelZIndex});this._updateCrosshairLabel(l.all,k,M=>{M.name=`crosshair-${h}-label`,l.all=M})}else l.all&&l.all.hideAll()}}};vv.specKey="crosshair",vv.type=W.polarCrosshair;var w5=r=>{let t=Object.assign({},r);return gt(t)},HZ=r=>{let t=Object.assign({},r);return gt(t)},fC=r=>Object.assign(Object.assign({},r),{style:Object.assign({},gt(r.style))}),P5=r=>{var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g;let f=w5((e=(t=r?.slider)===null||t===void 0?void 0:t.trackStyle)!==null&&e!==void 0?e:{}),_=w5((s=(i=r?.slider)===null||i===void 0?void 0:i.railStyle)!==null&&s!==void 0?s:{}),v=HZ((o=(n=r?.slider)===null||n===void 0?void 0:n.handlerStyle)!==null&&o!==void 0?o:{}),x=fC((l=(a=r?.controller)===null||a===void 0?void 0:a.start)!==null&&l!==void 0?l:{}),y=fC((d=(h=r?.controller)===null||h===void 0?void 0:h.pause)!==null&&d!==void 0?d:{}),b=fC((u=(c=r?.controller)===null||c===void 0?void 0:c.backward)!==null&&u!==void 0?u:{}),S=fC((m=(p=r?.controller)===null||p===void 0?void 0:p.forward)!==null&&m!==void 0?m:{}),C=Object.assign(Object.assign({},r),{direction:r.direction,interval:r.interval,visible:r.visible,orient:(g=r.orient)!==null&&g!==void 0?g:"bottom",slider:Object.assign(Object.assign({},r.slider),{trackStyle:f,railStyle:_,handlerStyle:v}),controller:Object.assign(Object.assign({},r.controller),{start:x,pause:y,backward:b,forward:S})});return r.visible||(C.controller.visible=!1,C.slider.visible=!1),C},R5=(r,t)=>Object.assign(Object.assign({},P5(r)),{data:t,type:"continuous"}),B5=(r,t)=>Object.assign(Object.assign({},P5(r)),{data:t,type:"discrete"});var Pm=r=>r==="left"||r==="right",_C=r=>r==="top"||r==="bottom";var yv=class extends Oe{constructor(){super(...arguments),this.layoutZIndex=Tt.Player,this.layoutLevel=Gi.Player,this.specKey="player",this.type=W.player,this._orient="bottom",this._getPlayerAttrs=()=>{var t,e,i,s,n,o;let a=this._spec.type,l={size:{width:this._width,height:this._height},dx:(t=this._spec.dx)!==null&&t!==void 0?t:0+this._dx,dy:(e=this._spec.dy)!==null&&e!==void 0?e:0+this._dy};return a==="discrete"?Object.assign(Object.assign(Object.assign({},B5(this._spec,this._specs)),l),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(s=(i=this._spec)===null||i===void 0?void 0:i.loop)===null||s===void 0||s}):Object.assign(Object.assign(Object.assign({},R5(this._spec,this._specs)),l),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(o=(n=this._spec)===null||n===void 0?void 0:n.loop)===null||o===void 0||o})},this._createOrUpdatePlayerComponent=()=>{let t=Object.assign({},this._getPlayerAttrs()),e=this.getContainer();this._playerComponent?Bt(t,this._cacheAttrs)||(this._cacheAttrs=t,this._playerComponent.setAttributes(t),this._playerComponent._initAttributes(),this._playerComponent.render()):(t.type==="discrete"?this._playerComponent=new qS(t):this._playerComponent=new ZS(t),this._cacheAttrs=t,this._playerComponent.name="player",e.add(this._playerComponent),this._initEvent())},this._maxSize=()=>{var t,e,i,s,n,o,a,l,h;return Math.max(...O((e=(t=this._spec.controller.start)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.size),...O((s=(i=this._spec.controller.pause)===null||i===void 0?void 0:i.style)===null||s===void 0?void 0:s.size),...O((o=(n=this._spec.controller.backward)===null||n===void 0?void 0:n.style)===null||o===void 0?void 0:o.size),...O((l=(a=this._spec.controller.forward)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.size),(h=Pm(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&h!==void 0?h:10)},this._sliderExceededSize=()=>{var t,e,i,s,n,o,a,l,h;let d=(t=Pm(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&t!==void 0?t:10,c=Math.max(...O((i=(e=this._spec.controller.start)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.size),...O((n=(s=this._spec.controller.pause)===null||s===void 0?void 0:s.style)===null||n===void 0?void 0:n.size),...O((a=(o=this._spec.controller.backward)===null||o===void 0?void 0:o.style)===null||a===void 0?void 0:a.size),...O((h=(l=this._spec.controller.forward)===null||l===void 0?void 0:l.style)===null||h===void 0?void 0:h.size));return d>=c?d-c:0},this._initEvent=()=>{this._option.disableTriggerEvent||(this._option.globalInstance.on(rt.rendered,()=>{var t;!((t=this._spec)===null||t===void 0)&&t.auto&&this._playerComponent.play()}),this._playerComponent.addEventListener(ti.end,()=>{var t;this.event.emit(rt.playerEnd,{model:this}),this._alternate&&this._spec.type==="discrete"&&(this._direction=this._direction==="default"?"reverse":"default",this._playerComponent.setAttributes({direction:this._direction,dataIndex:this._direction==="reverse"?this._specs.length-2:1})),!((t=this._spec)===null||t===void 0)&&t.loop&&this._playerComponent.play()}),this._playerComponent.addEventListener(ti.change,t=>{let{index:e}=t.detail;this.changePlayerIndex(e)}),this._playerComponent.addEventListener(ti.backward,t=>{let{index:e}=t.detail,i=this._specs[e];this.event.emit(rt.playerBackward,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(ti.forward,t=>{let{index:e}=t.detail,i=this._specs[e];this.event.emit(rt.playerForward,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(ti.play,t=>{let{index:e}=t.detail,i=this._specs[e];this.event.emit(rt.playerPlay,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(ti.pause,t=>{let{index:e}=t.detail,i=this._specs[e];this.event.emit(rt.playerPause,{model:this,value:{spec:i,index:e,specs:this._specs}})}))}}get orient(){return this._orient}set layoutOrient(t){this._orient=t}setAttrFromSpec(){var t,e,i,s,n,o,a,l;super.setAttrFromSpec(),this._orient=(t=this._spec.orient)!==null&&t!==void 0?t:"bottom",this._specs=(e=this._spec.specs)!==null&&e!==void 0?e:[],this._direction=(i=this._spec.direction)!==null&&i!==void 0?i:"default",this._alternate=(s=this._spec.alternate)!==null&&s!==void 0&&s,this._dx=(n=this._spec.dx)!==null&&n!==void 0?n:0,this._dy=(o=this._spec.dy)!==null&&o!==void 0?o:0,this._position=(a=this._spec.position)!==null&&a!==void 0?a:"middle",this._visible=(l=this._spec.visible)===null||l===void 0||l}afterSetLayoutStartPoint(t){if(super.afterSetLayoutStartPoint(t),K(t.x)){let e=Pm(this._orient)?t.x+this._sliderExceededSize()/2:t.x;this._playerComponent&&this._playerComponent.setAttribute("x",e)}if(K(t.y)){let e=_C(this._orient)?t.y+this._sliderExceededSize()/2:t.y;this._playerComponent&&this._playerComponent.setAttribute("y",e)}}getBoundsInRect(t,e){this._width=this._computeWidth(t),this._height=this._computeHeight(t),this._dx=this._computeDx(e),this._dy=this._computeDy(e);let i=this._computeLayoutRect(t,this._width,this._height);return this._createOrUpdatePlayerComponent(),i}changeRegions(t){}onRender(t){}_getNeedClearVRenderComponents(){return[this._playerComponent]}_computeLayoutRect(t,e,i){if(this._visible===!1)return{x1:0,x2:0,y1:0,y2:0};switch(this._orient){case"top":case"left":return{x1:0,y1:0,x2:e,y2:i};case"right":return{x1:t.width-e,y1:0,x2:t.width,y2:t.height};default:return{x1:0,y1:t.height-i,x2:t.width,y2:t.height}}}_computeWidth(t){return J(this._spec.width)?Math.min(t.width,Number(this._spec.width)):Pm(this._orient)?this._maxSize():t.width}_computeHeight(t){return J(this._spec.height)?(this._height=this._spec.height,Math.min(t.height,Number(this._spec.height))):_C(this._orient)?this._maxSize():t.height}_computeDx(t){return Pm(this._orient)||this._position==="start"?0:this._position==="middle"?(t.width-this._width)/2:t.width-this._width}_computeDy(t){return _C(this._orient)||this._position==="start"?0:this._position==="middle"?(t.height-this._height)/2:t.height-this._height}changePlayerIndex(t){let e=this._specs[t];O(e.data).forEach(i=>{var s,n;(n=(s=this._option)===null||s===void 0?void 0:s.globalInstance)===null||n===void 0||n.updateData(i.id,i.values)}),this.event.emit(rt.playerChange,{model:this,value:{spec:e,index:t,specs:this._specs}})}};yv.specKey="player",yv.type=W.player;var L5=["sum","average","min","max","variance","standardDeviation","median"];var NZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e};function hh(r,t,e){if(!e)return!1;let i=r.map(o=>1*o),s=Ae(i),n=Pe(i);return t<s||t>n}function I5(r,t,e,i,s,n){var o,a;let{relativeSeries:l}=i,h;return J(r.x)&&hh(t,r.x,e)&&((a=l==null?void 0:(o=l.getXAxisHelper()).setExtendDomain)===null||a===void 0||a.call(o,"marker_xAxis_extend",r.x)),h=pr(r.x)?vC(r.x,s)+n.x:l.getXAxisHelper().dataToPosition([r.x])+n.x,h}function F5(r,t,e,i,s,n){var o,a;let{relativeSeries:l}=i,h;return J(r.y)&&hh(t,r.y,e)&&((a=(o=l.getYAxisHelper())===null||o===void 0?void 0:o.setExtendDomain)===null||a===void 0||a.call(o,"marker_yAxis_extend",r.y)),h=pr(r.y)?vC(r.y,s)+n.y:l.getYAxisHelper().dataToPosition([r.y])+n.y,h}function O5(r,t,e,i){var s,n;let{relativeSeries:o}=i;return J(r.angle)&&hh(t,r.angle,e)&&((n=(s=o.angleAxisHelper)===null||s===void 0?void 0:s.setExtendDomain)===null||n===void 0||n.call(s,"marker_angleAxis_extend",r.angle)),o.angleAxisHelper.dataToPosition([r.angle])}function H5(r,t,e,i){var s,n;let{relativeSeries:o}=i;return J(r.radius)&&hh(t,r.radius,e)&&((n=(s=o.radiusAxisHelper)===null||s===void 0?void 0:s.setExtendDomain)===null||n===void 0||n.call(s,"marker_radiusAxis_extend",r.radius)),o.radiusAxisHelper.dataToPosition([r.radius])}function vC(r,t){return Number(r.substring(0,r.length-1))*t/100}function tc(r){return L5.includes(r)}function ec(r,t,e,i,s){let n=t.getRegion(),o=n.getLayoutStartPoint(),a=e.getRegion(),l=a.getLayoutStartPoint(),h=Math.abs(Math.min(o.x,l.x)-Math.max(o.x+n.getLayoutRect().width,l.x+a.getLayoutRect().width)),d=Math.abs(Math.min(o.y,l.y)-Math.max(o.y+n.getLayoutRect().height,l.y+a.getLayoutRect().height)),c={relativeSeries:i,startRelativeSeries:t,endRelativeSeries:e},u=[],p=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,m=i.getXAxisHelper().getScale(0).domain(),g=i.getYAxisHelper().getScale(0).domain();return p.forEach(f=>{let _=A(f.x),v=A(f.y);if(_&&v){let x=I5(f,m,s,c,h,o),y=F5(f,g,s,c,d,o);u.push([{x,y}])}else if(_){let x=I5(f,m,s,c,h,o),y=Math.max(o.y+n.getLayoutRect().height,l.y+a.getLayoutRect().height),b=Math.min(o.y,l.y);u.push([{x,y},{x,y:b}])}else if(v){let x=Math.min(o.x,l.x),y=F5(f,g,s,c,d,o),b=Math.max(o.x+n.getLayoutRect().width,l.x+a.getLayoutRect().width);u.push([{x,y},{x:b,y}])}}),u}function Rm(r,t,e,i,s){let n={relativeSeries:i,startRelativeSeries:t,endRelativeSeries:e},o=[],a=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,l=i.angleAxisHelper.getScale(0).domain(),h=i.radiusAxisHelper.getScale(0).domain(),d=Math.min(i.getRegion().getLayoutRect().width/2,i.getRegion().getLayoutRect().height/2);return a.forEach(c=>{let u=A(c.angle),p=A(c.radius);if(u&&p){let m=O5(c,l,s,n),g=H5(c,h,s,n);o.push([{angle:m,radius:g}])}else if(u){let m=O5(c,l,s,n);o.push([{angle:m,radius:-d},{angle:m,radius:d}])}else if(p){let m=H5(c,h,s,n);o.push([{radius:m,angle:0},{radius:m,angle:2*Math.PI}])}}),o}function V5(r,t){let e=[];return(r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData).forEach(i=>{A(i.areaName)&&e.push([{x:t.nameValueToPosition(i.areaName).x+t.getRegion().getLayoutStartPoint().x,y:t.nameValueToPosition(i.areaName).y+t.getRegion().getLayoutStartPoint().y}])}),e}function Bm(r,t,e,i){let s=[],n=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData,o=H(i);return n.forEach((a,l)=>{var h,d,c,u;let p=a?.getRefRelativeSeries?a.getRefRelativeSeries():t,m=p.getRegion(),g=m.getLayoutStartPoint(),{width:f,height:_}=m.getLayoutRect(),v=0,x=0;if(i){let k=o?i[l]:i,M=k.x,E=k.y;M&&(v=pr(M)?Number(M.substring(0,M.length-1))*f/100:M),E&&(x=pr(E)?Number(E.substring(0,E.length-1))*_/100:E)}let y=p.getXAxisHelper().getScale(0).domain(),b=p.getYAxisHelper().getScale(0).domain(),S=O(a.x),C=O(a.y);S.length===1&&J(S[0])&&hh(y,S[0],e)&&((d=(h=p.getXAxisHelper())===null||h===void 0?void 0:h.setExtendDomain)===null||d===void 0||d.call(h,"marker_xAxis_extend",S[0])),C.length===1&&J(C[0])&&hh(b,C[0],e)&&((u=(c=p.getYAxisHelper())===null||c===void 0?void 0:c.setExtendDomain)===null||u===void 0||u.call(c,"marker_yAxis_extend",C[0])),s.push({x:p.getXAxisHelper().dataToPosition(S)+g.x+v,y:p.getYAxisHelper().dataToPosition(C)+g.y+x})}),s}function yC(r,t,e){let i=[];return(r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData).forEach(s=>{var n,o,a,l;let h=s?.getRefRelativeSeries?s.getRefRelativeSeries():t,d=h.angleAxisHelper.getScale(0).domain(),c=h.radiusAxisHelper.getScale(0).domain(),u=O(s.angle),p=O(s.radius);u.length===1&&J(u[0])&&hh(d,u[0],e)&&((o=(n=h.angleAxisHelper)===null||n===void 0?void 0:n.setExtendDomain)===null||o===void 0||o.call(n,"marker_xAxis_extend",u[0])),p.length===1&&J(p[0])&&hh(c,p[0],e)&&((l=(a=h.radiusAxisHelper)===null||a===void 0?void 0:a.setExtendDomain)===null||l===void 0||l.call(a,"marker_yAxis_extend",p[0])),i.push({angle:h.angleAxisHelper.dataToPosition(u),radius:h.radiusAxisHelper.dataToPosition(p)})}),i}function N5(r,t,e){let{x:i,y:s}=r;return pr(i)&&(i=vC(i,t)),pr(s)&&(s=vC(s,e)),{x:i,y:s}}function Lm(r,t,e){let i;if(i=V(r)?O(r(t.getData().getLatestData(),t)):O(r),e){let o=t.getRegion(),{x:a,y:l}=o.getLayoutStartPoint(),{width:h,height:d}=o.getLayoutRect();return i.map(c=>{let{x:u,y:p}=N5(c,h,d);return u+=a,p+=l,{x:u,y:p}})}let{width:s,height:n}=t.getOption().getChart().getViewRect();return i.map(o=>N5(o,s,n))}function Im(r){let t=1/0,e=-1/0,i=1/0,s=-1/0;return r.forEach(n=>{let o=n.getLayoutStartPoint(),a=n.getLayoutRect();o.x<t&&(t=o.x),o.x+a.width>e&&(e=o.x+a.width),o.y<i&&(i=o.y),o.y+a.height>s&&(s=o.y+a.height)}),{minX:t,maxX:e,minY:i,maxY:s}}function Fm(r,t,e){let{labelBackground:i={},style:s,shape:n}=r,o=NZ(r,["labelBackground","style","shape"]);if(r.visible!==!1){let a=o;return n?.visible?a.shape=Object.assign({visible:!0},gt(n.style)):a.shape={visible:!1},i.visible!==!1?(a.panel=Object.assign({visible:!0,customShape:i.customShape},Ms(gt(i.style),t,e)),A(i.padding)&&(a.padding=Ni(i.padding))):(a.panel={visible:!1},a.padding=0),s&&(a.textStyle=Ms(gt(s),t,e)),a}return{visible:!1}}function Oi(r,t,e){for(let i in r)V(r[i])&&(r[i]=r[i](t,e));return r}function Ms(r,t,e){return V(r)?r(t,e):r}function Qw(r,t){return V(r)?r(t):r}function tP(r,t,e){return A(r)?t==="regionLeft"?e.getLayoutStartPoint().x-r.x:t==="regionRight"?e.getLayoutStartPoint().x+e.getLayoutRect().width-r.x:t==="regionTop"?e.getLayoutStartPoint().y-r.y:t==="regionBottom"?e.getLayoutStartPoint().y+e.getLayoutRect().height-r.y:t:t}function No(r){let t="x"in r,e="y"in r,i="x1"in r,s="y1"in r,n="angle"in r,o="radius"in r,a="angle1"in r,l="radius1"in r;return{doXProcess:t&&!e&&!s,doXYY1Process:t&&e&&s,doYProcess:e&&!t&&!i,doYXX1Process:e&&t&&i,doXYProcess:t&&e&&i&&s,doAngleProcess:n&&!a&&!o&&!l,doRadiusProcess:o&&!l&&!n&&!a,doAngRadRad1Process:n&&!a&&o&&l,doRadAngAng1Process:o&&n&&a&&!l,doRadAngProcess:n&&o&&a&&l,doCoordinatesProcess:"coordinates"in r&&(!("process"in r)||"process"in r&&"xy"in r.process)}}function Vo(r){let t="x"in r,e="x1"in r,i="y"in r,s="y1"in r,n="angle"in r,o="radius"in r,a="angle1"in r,l="radius1"in r;return{doXProcess:t&&e&&!i&&!s,doYProcess:i&&s&&!t&&!e,doXYProcess:t&&e&&i&&s,doAngleProcess:n&&a&&!o&&!l,doRadiusProcess:o&&l&&!n&&!a,doRadAngProcess:n&&o&&a&&l,doCoordinatesProcess:"coordinates"in r}}function xv(r){return{doXYProcess:A(r.x)&&A(r.y),doPolarProcess:A(r.angle)&&A(r.radius),doGeoProcess:A(r.areaName)}}function j5(r,t,e,i=0){let s=[],n=r.y-t.y,o=r.x-t.x;switch(e){case"top":s.push(r),s.push({x:r.x,y:n>0?r.y-i-Math.abs(n):r.y-i}),s.push({x:t.x,y:n>0?t.y-i:t.y-i-Math.abs(n)}),s.push(t);break;case"bottom":s.push(r),s.push({x:r.x,y:n<0?r.y+i+Math.abs(n):r.y+i}),s.push({x:t.x,y:n<0?t.y+i:t.y+i+Math.abs(n)}),s.push(t);break;case"left":s.push(r),s.push({x:o>0?r.x-i-Math.abs(o):r.x-i,y:r.y}),s.push({x:o>0?t.x-i:t.x-i-Math.abs(o),y:t.y}),s.push(t);break;case"right":s.push(r),s.push({x:o>0?r.x+i:r.x+i+Math.abs(o),y:r.y}),s.push({x:o>0?t.x+i+Math.abs(o):t.x+i,y:t.y}),s.push(t)}return s}function z5(r,t,e,i=0){let s=r.y-t.y,n=r.x-t.x;return e==="bottom"?{dx:n>0?-n/2:Math.abs(n/2),dy:s>0?i:Math.abs(s)+i}:e==="top"?{dx:n>0?-Math.abs(n/2):+Math.abs(n/2),dy:s>0?-(Math.abs(s)+i):-i}:e==="left"?{dx:n>0?-n-i:-i,dy:s>0?-s/2:Math.abs(s/2)}:e==="right"?{dx:n>0?i:Math.abs(n)+i,dy:s>0?-s/2:Math.abs(s/2)}:{}}var VZ=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},jZ=(r,t)=>{let e=r[0].latestData;return uE(e,t.field)},zZ=(r,t)=>{let e=r[0].latestData;return p_(e,t.field)};function GZ(r,t){let e=r[0].latestData;return Vu(e,t.field)}function UZ(r,t){let e=r[0].latestData;return pE(e,t.field)}function WZ(r,t){let e=r[0].latestData;return mE(e,t.field)}function YZ(r,t){let e=r[0].latestData;return TH(e,t.field)}function XZ(r,t){let e=r[0].latestData;return kH(e,t.field)}function xC(r,t){let e;if(t.coordinates){let s=t,{coordinates:n,coordinateType:o,getSeriesByIdOrIndex:a}=s,l=VZ(s,["coordinates","coordinateType","getSeriesByIdOrIndex"]),h,d;if(V(n)){let c=t.getRelativeSeries();h=n(c.getData().getLatestData(),c)}else h=n;h=O(h),e=h.map(c=>{let u=a(c.refRelativeSeriesId,c.refRelativeSeriesIndex);if(o==="cartesian"){let{xField:p,yField:m}=u.getSpec(),{xFieldDim:g,xFieldIndex:f,yFieldDim:_,yFieldIndex:v}=c,x=p;A(f)&&(x=O(p)[f]),g&&O(p).includes(g)&&(x=g);let y=m;A(v)&&(y=O(m)[v]),_&&O(m).includes(_)&&(y=_),d=Object.assign({x:void 0,y:void 0},l),Z(c[x])&&tc(c[x])?d.x={field:x,aggrType:c[x]}:d.x=O(x).map(b=>c[b]),Z(c[y])&&tc(c[y])?d.y={field:y,aggrType:c[y]}:d.y=O(y).map(b=>c[b])}else if(o==="polar"){let{valueField:p,categoryField:m}=u.getSpec(),{angleFieldDim:g,angleFieldIndex:f}=c,_=m;A(f)&&(_=O(m)[f]),g&&O(m).includes(g)&&(_=g);let v=p;d=Object.assign({angle:void 0,radius:void 0},l),Z(c[_])&&tc(c[_])?d.angle={field:_,aggrType:c[_]}:d.angle=O(_).map(x=>c[x]),Z(c[v])&&tc(c[v])?d.radius={field:v,aggrType:c[v]}:d.radius=O(v).map(x=>c[x])}return d.getRefRelativeSeries=()=>u,d})}else e=t;let i=[];return e.forEach(s=>{let n={x:null,y:null,angle:null,radius:null,areaName:null};if(A(s.x)){let o=s.x;H(o)?n.x=o.map(a=>ka(a,r,s)):n.x=ka(o,r,s)}if(A(s.y)){let o=s.y;H(o)?n.y=o.map(a=>ka(a,r,s)):n.y=ka(o,r,s)}if(A(s.angle)){let o=s.angle;H(o)?n.angle=o.map(a=>ka(a,r,s)):n.angle=ka(o,r,s)}if(A(s.radius)){let o=s.radius;H(o)?n.radius=o.map(a=>ka(a,r,s)):n.radius=ka(o,r,s)}if(A(s.areaName)){let o=s.areaName;n.areaName=ka(o,r,s)}s.getRefRelativeSeries&&(n.getRefRelativeSeries=s.getRefRelativeSeries),i.push(n)}),i}var KZ={min:jZ,max:zZ,sum:GZ,average:UZ,variance:WZ,standardDeviation:YZ,median:XZ};function ka(r,t,e){let i=e.getRelativeSeries(),s=e.getStartRelativeSeries(),n=e.getEndRelativeSeries(),o=i.getData().getLatestData(),a=s.getData().getLatestData(),l=n.getData().getLatestData();if(V(r))return r(o,a,l,i,s,n);if(xi(r)){let{aggrType:h,field:d}=r;return KZ[h](t,{field:d})}return r}function bC(r,t){if(t&&t.getRelativeSeries){let e=t.getRelativeSeries();if(e){let i=e.getViewData();return i&&i.latestData&&i.latestData.length?r:[]}}return r}var dh=class extends Oe{constructor(){super(...arguments),this.layoutType="none",this._layoutOffsetX=0,this._layoutOffsetY=0}getRelativeSeries(){return this._relativeSeries}getMarkerData(){return this._markerData}static _getMarkerCoordinateType(t){return"cartesian"}static getSpecInfo(t){return Fi(t,this.specKey,this.type,e=>e.visible!==!1&&this._getMarkerCoordinateType(e)===this.coordinateType)}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkerAttributeContext(){this._markAttributeContext={relativeSeries:this._relativeSeries,startRelativeSeries:this._startRelativeSeries,endRelativeSeries:this._endRelativeSeries,vchart:this._option.globalInstance}}created(){super.created(),this._bindSeries(),this._initDataView(),this.initEvent(),this._buildMarkerAttributeContext()}_getAllRelativeSeries(){return{getRelativeSeries:()=>this._relativeSeries,getStartRelativeSeries:()=>this._startRelativeSeries,getEndRelativeSeries:()=>this._endRelativeSeries}}_getFieldInfoFromSpec(t,e,i){let s={x:"xField",y:"yField",radius:"valueField",angle:"categoryField",areaName:"nameField"};return Z(e)&&tc(e)?{field:i.getSpec()[s[t]],aggrType:e}:e}_processSpecByDims(t){let e=this._relativeSeries,i={};return t.forEach(s=>i[s.dim]=this._getFieldInfoFromSpec(s.dim,s.specValue,e)),Object.assign(Object.assign({},i),this._getAllRelativeSeries())}_processSpecCoo(t){return Object.assign(Object.assign({coordinates:t.coordinates||t.coordinate},this._getAllRelativeSeries()),{getSeriesByIdOrIndex:(e,i)=>this._getSeriesByIdOrIndex(e,i),coordinateType:this.coordinateType})}_getRelativeDataView(){if(this._specifiedDataSeries){let t=[];O(this._specifiedDataSeries).forEach(i=>{t=t.concat(i.getViewData().latestData)});let e=new Ar;return e.registerParser("array",Bv),new St(e).parse(t,{type:"array"})}return this._relativeSeries.getViewData()}updateLayoutAttribute(){var t,e,i;if((t=this._spec.visible)===null||t===void 0||t){if(!this._markerComponent){let s=this._createMarkerComponent();s.name=(e=this._spec.name)!==null&&e!==void 0?e:this.type,s.id=(i=this._spec.id)!==null&&i!==void 0?i:`${this.type}-${this.id}`,this._markerComponent=s,this.getContainer().add(this._markerComponent),this._markerComponent.on("*",(n,o)=>{this._delegateEvent(this._markerComponent,n,o,null,this.getMarkerData.bind(this))})}this._markerLayout()}super.updateLayoutAttribute()}_getSeriesByIdOrIndex(t,e){var i,s;let n;return n=(i=this._option.getSeriesInUserIdOrIndex(A(t)?[t]:[],[e]))===null||i===void 0?void 0:i[0],n||(n=(s=this._relativeSeries)!==null&&s!==void 0?s:this._getFirstSeries()),n}_bindSeries(){let t=this._spec;this._relativeSeries=this._getSeriesByIdOrIndex(t.relativeSeriesId,t.relativeSeriesIndex),this._startRelativeSeries=this._getSeriesByIdOrIndex(t.startRelativeSeriesId,t.startRelativeSeriesIndex),this._endRelativeSeries=this._getSeriesByIdOrIndex(t.endRelativeSeriesId,t.endRelativeSeriesIndex),t.specifiedDataSeriesIndex&&t.specifiedDataSeriesIndex==="all"||t.specifiedDataSeriesId&&t.specifiedDataSeriesId==="all"?this._specifiedDataSeries=this._option.getAllSeries():(t.specifiedDataSeriesIndex||t.specifiedDataSeriesId)&&(this._specifiedDataSeries=this._getSeriesByIdOrIndex(t.specifiedDataSeriesId,t.specifiedDataSeriesIndex))}initEvent(){this._relativeSeries.coordinate!=="cartesian"&&(this._relativeSeries.event.on("zoom",this._markerLayout.bind(this)),this._relativeSeries.event.on("panmove",this._markerLayout.bind(this)),this._relativeSeries.event.on("scroll",this._markerLayout.bind(this)))}onRender(t){}changeRegions(t){}clear(){super.clear(),this._firstSeries=null}_getFirstSeries(){var t;if(this._firstSeries)return this._firstSeries;let e=ju(this._regions);return e?(this._firstSeries=e,e):((t=this._option)===null||t===void 0||t.onError("need at least one series"),null)}_getNeedClearVRenderComponents(){return[this._markerComponent]}onLayoutStart(t,e,i){T(this._spec.offsetX)||(this._layoutOffsetX=We(this._spec.offsetX,e.width,e)),T(this._spec.offsetY)||(this._layoutOffsetY=We(this._spec.offsetY,e.height,e)),super.onLayoutStart(t,e,i)}_compareSpec(t,e){let i=super._compareSpec(t,e);return Bt(e,t)||(i.reRender=!0,i.reMake=!0,i.change=!0),i}_initCommonDataView(){let{options:t}=this._computeOptions(),e=this._getRelativeDataView();nt(this._option.dataSet,"markerAggregation",xC),nt(this._option.dataSet,"markerFilter",bC);let i=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`});i.parse([e],{type:"dataview"}),i.transform({type:"markerAggregation",options:t}),i.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),i.target.on("change",()=>{this._markerLayout()}),this._markerData=i}};function G5(r,t){let e=r[0].latestData;return MH(e,t.fieldX,t.fieldY)}var ic=class extends dh{constructor(){super(...arguments),this.specKey="markLine",this.layoutZIndex=Tt.MarkLine}static _getMarkerCoordinateType(t){let{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:s,doRadAngAng1Process:n,doRadAngProcess:o}=No(t);return t.coordinateType==="polar"||e||i||s||n||o?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g,f,_,v,x;let{label:y={},startSymbol:b={},endSymbol:S={}}=this._spec,C={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,points:[{x:0,y:0},{x:0,y:0}],center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,lineStyle:Ms(gt((s=this._spec.line)===null||s===void 0?void 0:s.style),this._markerData,this._markAttributeContext),clipInRange:(n=this._spec.clip)!==null&&n!==void 0&&n,label:Fm(y,this._markerData,this._markAttributeContext),state:{line:Oi((a=(o=this._spec.line)===null||o===void 0?void 0:o.state)!==null&&a!==void 0?a:{},this._markerData,this._markAttributeContext),lineStartSymbol:Oi((h=(l=this._spec.startSymbol)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData,this._markAttributeContext),lineEndSymbol:Oi((c=(d=this._spec.endSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData,this._markAttributeContext),label:Oi((m=(p=(u=this._spec)===null||u===void 0?void 0:u.label)===null||p===void 0?void 0:p.state)!==null&&m!==void 0?m:{},this._markerData,this._markAttributeContext),labelBackground:Oi((v=(_=(f=(g=this._spec)===null||g===void 0?void 0:g.label)===null||f===void 0?void 0:f.labelBackground)===null||_===void 0?void 0:_.state)!==null&&v!==void 0?v:{},this._markerData,this._markAttributeContext)},animation:(x=this._spec.animation)!==null&&x!==void 0&&x,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return b.visible?C.startSymbol=Object.assign(Object.assign({},b),{visible:!0,style:Ms(gt(b.style),this._markerData,this._markAttributeContext)}):C.startSymbol={visible:!1},S.visible?C.endSymbol=Object.assign(Object.assign({},S),{visible:!0,style:Ms(gt(S.style),this._markerData,this._markAttributeContext)}):C.endSymbol={visible:!1},this._newMarkLineComponent(C)}_getUpdateMarkerAttrs(){var t,e,i,s;let n=this._spec,o=this._markerData,a=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=h.getViewData().latestData,u=o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData,p;if(n.clip||!((t=n.label)===null||t===void 0)&&t.confine){let{minX:f,maxX:_,minY:v,maxY:x}=Im([a.getRegion(),l.getRegion(),h.getRegion()]);p={x:f,y:v,width:_-f,height:x-v}}let m=(i=(e=this._markerComponent)===null||e===void 0?void 0:e.attribute)!==null&&i!==void 0?i:{},g=Object.assign(Object.assign({},m.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=m.label)===null||s===void 0?void 0:s.text});return Object.assign(Object.assign({},d),{label:g,limitRect:p,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}_markerLayout(){var t;let e=this._getUpdateMarkerAttrs();(t=this._markerComponent)===null||t===void 0||t.setAttributes(e)}_initDataView(){let t=this._spec,e="coordinates"in t,{doXProcess:i,doYProcess:s,doXYY1Process:n,doYXX1Process:o,doXYProcess:a,doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:c,doRadAngProcess:u}=No(t);if(this._markerData=this._getRelativeDataView(),!(i||s||n||o||a||l||h||d||c||u||e))return;nt(this._option.dataSet,"markerAggregation",xC),nt(this._option.dataSet,"markerRegression",G5),nt(this._option.dataSet,"markerFilter",bC);let{options:p,needAggr:m,needRegr:g,processData:f}=this._computeOptions(),_=new St(this._option.dataSet);_.parse([f],{type:"dataview"}),m&&_.transform({type:"markerAggregation",options:p}),g&&_.transform({type:"markerRegression",options:p}),_.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),_.target.on("change",()=>{this._markerLayout()}),this._markerData=_}};ic.specKey="markLine";var bv=class extends ic{constructor(){super(...arguments),this.type=W.markLine,this.name=W.markLine,this.coordinateType="cartesian"}_newMarkLineComponent(t){return new pd(t)}_computePointsAttr(){var t;let e=this._spec,i=this._markerData,s=this._startRelativeSeries,n=this._endRelativeSeries,o=this._relativeSeries,a=A(e.coordinates),l=A(e.process),h=l&&A(e.process.x),d=l&&A(e.process.y),c=A(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t,{doXProcess:p,doYProcess:m,doXYY1Process:g,doYXX1Process:f,doXYProcess:_,doCoordinatesProcess:v}=No(e),x=[];if(p||g||m||f||_||a&&h||a&&d){let y=ec(i,s,n,o,u);x=y.length===1?y[0]:y.map(b=>b[0])}else v?x=Bm(i,o,u,e.coordinatesOffset):c&&(x=Lm(e.positions,o,e.regionRelative));return{points:x}}_markerLayout(){var t,e,i,s,n,o,a,l;let h=this._getUpdateMarkerAttrs();if(this._spec.type==="type-step"){let d=this._startRelativeSeries,c=this._endRelativeSeries,{multiSegment:u,mainSegmentIndex:p}=this._spec.line||{},{connectDirection:m,expandDistance:g=0}=this._spec,f;if(pr(g)){let C=d.getRegion(),k=C.getLayoutStartPoint(),M=c.getRegion(),E=M.getLayoutStartPoint();if(m==="bottom"||m==="top"){let D=Math.abs(Math.min(k.y,E.y)-Math.max(k.y+C.getLayoutRect().height,E.y+M.getLayoutRect().height));f=Number(g.substring(0,g.length-1))*D/100}else{let D=Math.abs(Math.min(k.x,E.x)-Math.max(k.x+C.getLayoutRect().width,E.x+M.getLayoutRect().width));f=Number(g.substring(0,g.length-1))*D/100}}else f=g;let{points:_,label:v,limitRect:x}=h,y=j5(_[0],_[1],m,f),b;b=u&&A(p)?{position:"middle",autoRotate:!1,refX:0,refY:0}:Object.assign(Object.assign({position:"start",autoRotate:!1},z5(_[0],_[1],m,f)),{refX:0,refY:0}),K((t=this._spec.label)===null||t===void 0?void 0:t.refX)&&(b.refX+=this._spec.label.refX),K((e=this._spec.label)===null||e===void 0?void 0:e.refY)&&(b.refY+=this._spec.label.refY),K((i=this._spec.label)===null||i===void 0?void 0:i.dx)&&(b.dx=(b.dx||0)+this._spec.label.dx),K((s=this._spec.label)===null||s===void 0?void 0:s.dy)&&(b.dy=(b.dy||0)+this._spec.label.dy);let S=(o=(n=this._markerComponent)===null||n===void 0?void 0:n.attribute)!==null&&o!==void 0?o:{};(a=this._markerComponent)===null||a===void 0||a.setAttributes({points:u?[[y[0],y[1]],[y[1],y[2]],[y[2],y[3]]]:y,label:Object.assign(Object.assign(Object.assign({},v),b),{textStyle:Object.assign(Object.assign({},S.label.textStyle),{textAlign:"center",textBaseline:"middle"})}),limitRect:x,multiSegment:u,mainSegmentIndex:p,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}else(l=this._markerComponent)===null||l===void 0||l.setAttributes(h)}_computeOptions(){let t,e=this._getRelativeDataView(),i=!0,s=!1,n=this._spec,o=this._relativeSeries,{doXProcess:a,doYProcess:l,doXYY1Process:h,doYXX1Process:d,doXYProcess:c,doCoordinatesProcess:u}=No(n);if(c)t=[this._processSpecByDims([{dim:"x",specValue:n.x},{dim:"y",specValue:n.y}]),this._processSpecByDims([{dim:"x",specValue:n.x1},{dim:"y",specValue:n.y1}])];else if(a)t=[this._processSpecByDims([{dim:"x",specValue:n.x}])];else if(l)t=[this._processSpecByDims([{dim:"y",specValue:n.y}])];else if(h)t=[this._processSpecByDims([{dim:"x",specValue:n.x},{dim:"y",specValue:n.y}]),this._processSpecByDims([{dim:"x",specValue:n.x},{dim:"y",specValue:n.y1}])];else if(d)t=[this._processSpecByDims([{dim:"x",specValue:n.x},{dim:"y",specValue:n.y}]),this._processSpecByDims([{dim:"x",specValue:n.x1},{dim:"y",specValue:n.y}])];else if(u){if(t=this._processSpecCoo(n),i=!1,e=new St(this._option.dataSet,{name:`${this.type}_${this.id}_data`}).parse([o.getViewData()],{type:"dataview"}).transform({type:"markerAggregation",options:t}),n.process&&"x"in n.process&&(t=[this._processSpecByDims([{dim:"x",specValue:n.process.x}])],i=!0),n.process&&"y"in n.process&&(t=t=[this._processSpecByDims([{dim:"y",specValue:n.process.y}])],i=!0),n.process&&"xy"in n.process){let{xField:p,yField:m}=o.getSpec();t={fieldX:p,fieldY:m},s=!0}}else i=!1;return{options:t,needAggr:i,needRegr:s,processData:e}}};bv.type=W.markLine,bv.coordinateType="cartesian";var Sv=class extends ic{constructor(){super(...arguments),this.type=W.polarMarkLine,this.name=W.polarMarkLine,this.coordinateType="polar"}_newMarkLineComponent(t){let{doRadiusProcess:e,doRadAngAng1Process:i}=No(this._spec);return e||i?new r_(t):new pd(t)}_computePointsAttr(){var t;let e=this._spec,i=this._markerData,s=this._startRelativeSeries,n=this._endRelativeSeries,o=this._relativeSeries,a=(t=e.autoRange)!==null&&t!==void 0&&t,{doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:c,doRadAngProcess:u,doCoordinatesProcess:p}=No(e),m=[],g={},f={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(l||h||d||c||u){let _=Rm(i,s,n,o,a);m=_.length===1?_[0]:_.map(v=>v[0]),g=m[0].radius===m[1].radius?{radius:m[0].radius,startAngle:m[0].angle,endAngle:m[1].angle,center:f}:{points:m.map(v=>oe(f,v.radius,v.angle))}}else p&&(m=yC(i,o,a),g={points:m.map(_=>oe(f,_.radius,_.angle))});return g}_computeOptions(){let t=this._spec,{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:s,doRadAngAng1Process:n,doRadAngProcess:o,doCoordinatesProcess:a}=No(t),l,h=this._getRelativeDataView();return o?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius1}])]:e?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle}])]:i?l=[this._processSpecByDims([{dim:"radius",specValue:t.radius}])]:s?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius1}])]:n?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius}])]:a&&(l=this._processSpecCoo(t)),{options:l,needAggr:!0,needRegr:!1,processData:h}}};Sv.type=W.polarMarkLine,Sv.coordinateType="polar";var rc=class extends dh{constructor(){super(...arguments),this.specKey="markArea",this.layoutZIndex=Tt.MarkArea}static _getMarkerCoordinateType(t){let{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:s}=Vo(t);return t.coordinateType==="polar"||e||i||s?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,s,n,o,a,l,h,d,c,u;let p=(t=this._spec.label)!==null&&t!==void 0?t:{},m={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(s=this._spec.interactive)===null||s===void 0||s,points:[{x:0,y:0}],center:{x:0,y:0},innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,areaStyle:Ms(gt((n=this._spec.area)===null||n===void 0?void 0:n.style),this._markerData,this._markAttributeContext),clipInRange:(o=this._spec.clip)!==null&&o!==void 0&&o,label:Fm(p,this._markerData,this._markAttributeContext),state:{area:Oi((a=this._spec.area)===null||a===void 0?void 0:a.state,this._markerData,this._markAttributeContext),label:Oi((l=this._spec.label)===null||l===void 0?void 0:l.state,this._markerData,this._markAttributeContext),labelBackground:Oi((c=(d=(h=this._spec)===null||h===void 0?void 0:h.label)===null||d===void 0?void 0:d.labelBackground)===null||c===void 0?void 0:c.state,this._markerData,this._markAttributeContext)},animation:(u=this._spec.animation)!==null&&u!==void 0&&u,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return this._newMarkAreaComponent(m)}_markerLayout(){var t,e,i,s;let n=this._spec,o=this._markerData,a=this._startRelativeSeries,l=this._endRelativeSeries,h=this._relativeSeries,d=this._computePointsAttr(),c=this._getRelativeDataView().latestData,u=o?o.latestData[0]&&o.latestData[0].latestData?o.latestData[0].latestData:o.latestData:c,p;if(n.clip||!((t=n.label)===null||t===void 0)&&t.confine){let{minX:m,maxX:g,minY:f,maxY:_}=Im([a.getRegion(),l.getRegion(),h.getRegion()]);p={x:m,y:f,width:g-m,height:_-f}}this._markerComponent&&this._markerComponent.setAttributes(Object.assign(Object.assign({},d),{label:Object.assign(Object.assign({},(e=this._markerComponent.attribute)===null||e===void 0?void 0:e.label),{text:this._spec.label.formatMethod?this._spec.label.formatMethod(u,c):(s=(i=this._markerComponent.attribute)===null||i===void 0?void 0:i.label)===null||s===void 0?void 0:s.text}),limitRect:p,dx:this._layoutOffsetX,dy:this._layoutOffsetY}))}_initDataView(){let t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doAngleProcess:n,doRadiusProcess:o,doRadAngProcess:a,doCoordinatesProcess:l}=Vo(t);if(!(e||i||s||n||o||a||l))return null;this._initCommonDataView()}};rc.specKey="markArea";var Av=class extends rc{constructor(){super(...arguments),this.type=W.markArea,this.name=W.markArea,this.coordinateType="cartesian"}_newMarkAreaComponent(t){return new md(t)}_computePointsAttr(){var t;let e=this._spec,i=this._markerData,s=this._startRelativeSeries,n=this._endRelativeSeries,o=this._relativeSeries,{doXProcess:a,doYProcess:l,doXYProcess:h,doCoordinatesProcess:d}=Vo(e),c=A(e.positions),u=(t=e.autoRange)!==null&&t!==void 0&&t,p=[],m=[];if(h){m=ec(i,s,n,o,u);let[g,f]=m;g&&g.length&&f&&f.length&&(p=[{x:g[0].x,y:f[0].y},g[0],{x:f[0].x,y:g[0].y},f[0]])}else if(a||l){m=ec(i,s,n,o,u);let[g,f]=m;g&&g.length&&f&&f.length&&(p=[...g,f[1],f[0]])}else d?p=Bm(i,o,u,e.coordinatesOffset):c&&(p=Lm(e.positions,o,e.regionRelative));return{points:p}}_computeOptions(){let t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:s,doCoordinatesProcess:n}=Vo(t),o;return s?o=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"x",specValue:t.x1},{dim:"y",specValue:t.y1}])]:e?o=[this._processSpecByDims([{dim:"x",specValue:t.x}]),this._processSpecByDims([{dim:"x",specValue:t.x1}])]:i?o=[this._processSpecByDims([{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"y",specValue:t.y1}])]:n&&(o=this._processSpecCoo(t)),{options:o}}};Av.type=W.markArea,Av.coordinateType="cartesian";var Cv=class extends rc{constructor(){super(...arguments),this.type=W.polarMarkArea,this.name=W.polarMarkArea,this.coordinateType="polar"}_newMarkAreaComponent(t){let{doRadiusProcess:e,doAngleProcess:i,doRadAngProcess:s}=Vo(this._spec);return i||e||s?new s_(t):new md(t)}_computePointsAttr(){var t;let e=this._spec,i=this._markerData,s=this._startRelativeSeries,n=this._endRelativeSeries,o=this._relativeSeries,{doAngleProcess:a,doRadiusProcess:l,doRadAngProcess:h,doCoordinatesProcess:d}=Vo(e),c=(t=e.autoRange)!==null&&t!==void 0&&t,u,p={},m={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(a||l||h){let g=Rm(i,s,n,o,c);h?p={innerRadius:g[0][0].radius,outerRadius:g[1][0].radius,startAngle:g[0][0].angle,endAngle:g[1][0].angle,center:m}:a?p={innerRadius:0,outerRadius:Math.abs(g[0][0].radius),startAngle:g[0][1].angle,endAngle:g[1][1].angle,center:m}:l&&(p={innerRadius:g[0][0].radius,outerRadius:g[1][0].radius,startAngle:g[0][0].angle,endAngle:g[1][1].angle,center:m})}else d&&(u=yC(i,o,c),p={points:u.map(g=>oe(m,g.radius,g.angle))});return p}_computeOptions(){let t=this._spec,{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:s,doCoordinatesProcess:n}=Vo(t),o;return s?o=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius1}])]:e?o=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius}])]:i?o=[this._processSpecByDims([{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"radius",specValue:t.radius1}])]:n&&(o=this._processSpecCoo(t)),{options:o}}};Cv.type=W.polarMarkArea,Cv.coordinateType="polar";var U5=function(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(r);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(e[i[s]]=r[i[s]])}return e},Ma=class extends dh{constructor(){super(...arguments),this.specKey="markPoint",this.layoutZIndex=Tt.MarkPoint}static _getMarkerCoordinateType(t){let{doPolarProcess:e,doGeoProcess:i}=xv(t);return t.coordinateType==="polar"||e?"polar":t.coordinateType==="geo"||i?"geo":"cartesian"}_createMarkerComponent(){var t,e,i,s,n,o,a,l,h,d,c,u,p,m,g,f,_,v,x,y,b,S,C,k,M,E,D,P;let{itemContent:B={},itemLine:L={},targetSymbol:w={}}=this._spec,{text:R={},symbol:N,image:z,richText:Y}=B,U=U5(B,["text","symbol","image","richText"]),$={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,position:{x:0,y:0},clipInRange:(s=this._spec.clip)!==null&&s!==void 0&&s,itemContent:Object.assign({offsetX:Qw(B.offsetX,this._relativeSeries.getRegion()),offsetY:Qw(B.offsetX,this._relativeSeries.getRegion())},U),targetSymbol:{offset:(n=w.offset)!==null&&n!==void 0?n:0,visible:(o=w.visible)!==null&&o!==void 0&&o,size:(a=w.size)!==null&&a!==void 0?a:20,style:Ms(w.style,this._markerData,this._markAttributeContext)},state:{line:Oi((h=(l=this._spec.itemLine.line)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData,this._markAttributeContext),lineStartSymbol:Oi((c=(d=this._spec.itemLine.startSymbol)===null||d===void 0?void 0:d.state)!==null&&c!==void 0?c:{},this._markerData,this._markAttributeContext),lineEndSymbol:Oi((p=(u=this._spec.itemLine.endSymbol)===null||u===void 0?void 0:u.state)!==null&&p!==void 0?p:{},this._markerData,this._markAttributeContext),symbol:Oi((g=(m=this._spec.itemContent.symbol)===null||m===void 0?void 0:m.state)!==null&&g!==void 0?g:{},this._markerData,this._markAttributeContext),image:Oi((_=(f=this._spec.itemContent.image)===null||f===void 0?void 0:f.state)!==null&&_!==void 0?_:{},this._markerData,this._markAttributeContext),text:Oi((x=(v=this._spec.itemContent.text)===null||v===void 0?void 0:v.state)!==null&&x!==void 0?x:{},this._markerData,this._markAttributeContext),textBackground:Oi((b=(y=this._spec.itemContent.text)===null||y===void 0?void 0:y.labelBackground)===null||b===void 0?void 0:b.state,this._markerData,this._markAttributeContext),richText:Oi((C=(S=this._spec.itemContent.richText)===null||S===void 0?void 0:S.state)!==null&&C!==void 0?C:{},this._markerData,this._markAttributeContext),customMark:Oi((M=(k=this._spec.itemContent.customMark)===null||k===void 0?void 0:k.state)!==null&&M!==void 0?M:{},this._markerData,this._markAttributeContext),targetItem:Oi((D=(E=this._spec.targetSymbol)===null||E===void 0?void 0:E.state)!==null&&D!==void 0?D:{},this._markerData,this._markAttributeContext)},animation:(P=this._spec.animation)!==null&&P!==void 0&&P,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};N?.style&&($.itemContent.symbolStyle=gt(Ms(N.style,this._markerData,this._markAttributeContext))),z?.style&&($.itemContent.imageStyle=Ms(z.style,this._markerData,this._markAttributeContext)),R&&($.itemContent.textStyle=Fm(R,this._markerData,this._markAttributeContext)),Y?.style&&($.itemContent.richTextStyle=Ms(Y.style,this._markerData,this._markAttributeContext));let{visible:ut,line:mt={}}=L,bt=U5(L,["visible","line"]);return $.itemLine=ut!==!1?Object.assign(Object.assign({},bt),{visible:!0,lineStyle:gt(mt.style)}):{visible:!1},new gd($)}_markerLayout(){var t,e,i,s,n;let o=this._spec,a=this._markerData,l=this._relativeSeries,{point:h}=this._computePointsAttr(),d=this._getRelativeDataView().latestData,c=a?a.latestData[0]&&a.latestData[0].latestData?a.latestData[0].latestData:a.latestData:d,u;if(o.clip||!((t=o.itemContent)===null||t===void 0)&&t.confine){let{minX:p,maxX:m,minY:g,maxY:f}=Im([l.getRegion()]);u={x:p,y:g,width:m-p,height:f-g}}if(this._markerComponent){let p=(e=this._markerComponent.attribute)!==null&&e!==void 0?e:{},m=(s=(i=p.itemContent)===null||i===void 0?void 0:i.textStyle)!==null&&s!==void 0?s:{};this._markerComponent.setAttributes({position:h===void 0?{x:null,y:null}:h,itemContent:Object.assign(Object.assign({},p.itemContent),{textStyle:Object.assign(Object.assign({},m),{text:!((n=this._spec.itemContent.text)===null||n===void 0)&&n.formatMethod?this._spec.itemContent.text.formatMethod(c,d):m.text}),offsetX:tP(h,p.itemContent.offsetX,this._relativeSeries.getRegion()),offsetY:tP(h,p.itemContent.offsetY,this._relativeSeries.getRegion())}),limitRect:u,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}}_initDataView(){let t=this._spec,{doXYProcess:e,doPolarProcess:i,doGeoProcess:s}=xv(t);(A(t.coordinate)||e||i||s)&&this._initCommonDataView()}};Ma.specKey="markPoint";var Tv=class extends Ma{constructor(){super(...arguments),this.type=W.markPoint,this.name=W.markPoint,this.coordinateType="cartesian"}_computePointsAttr(){var t;let e=this._spec,i=this._markerData,s=this._relativeSeries,n="x"in e&&"y"in e,o="coordinate"in e,a="position"in e,l=(t=e?.autoRange)!==null&&t!==void 0&&t,h;return n?h=ec(i,s,s,s,l)[0][0]:o?h=Bm(i,s,l,e.coordinatesOffset)[0]:a&&(h=Lm(e.position,s,e.regionRelative)[0]),{point:h}}_computeOptions(){let t=this._spec,{doXYProcess:e}=xv(t),i=A(t.coordinate),s;return e?s=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}])]:i&&(s=this._processSpecCoo(t)),{options:s}}};Tv.type=W.markPoint,Tv.coordinateType="cartesian";var kv=class extends Ma{constructor(){super(...arguments),this.type=W.polarMarkPoint,this.name=W.polarMarkPoint,this.coordinateType="polar"}_computePointsAttr(){var t,e;let i=this._markerData,s=this._relativeSeries,n=(e=(t=this._spec)===null||t===void 0?void 0:t.autoRange)!==null&&e!==void 0&&e,o=Rm(i,s,s,s,n)[0][0],a={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};return{point:oe(a,o.radius,o.angle)}}_computeOptions(){let t=this._spec;return{options:[this._processSpecByDims([{dim:"radius",specValue:t.radius},{dim:"angle",specValue:t.angle}])]}}};kv.type=W.polarMarkPoint,kv.coordinateType="polar";var Mv=class extends Ma{constructor(){super(...arguments),this.type=W.geoMarkPoint,this.name=W.geoMarkPoint,this.coordinateType="geo"}_computePointsAttr(){let t=this._markerData,e=this._relativeSeries;return{point:V5(t,e)[0][0]}}_computeOptions(){let t=this._spec;return{options:[this._processSpecByDims([{dim:"areaName",specValue:t.areaName}])]}}};Mv.type=W.geoMarkPoint,Mv.coordinateType="geo";var Om=(r,t)=>A(t)?r.map(e=>t[e]):void 0,sc=(r,t)=>e=>r.every((i,s)=>e[i]===t?.[s]),Dv=r=>!T(r)&&(H(r)?r.length>0&&r.every(A):Object.keys(r).length>0);function W5(r,t,e){var i,s,n;let o=Object.assign({regionIndex:0},t),a=e.getOption(),l=a.getRegionsInUserIdOrIndex(A(o.regionId)?[o.regionId]:void 0,A(o.regionIndex)?[o.regionIndex]:void 0)[0];if(!l)return"none";let h=ZZ(r,l),d=(i=o.activeType)!==null&&i!==void 0?i:h.length>1?"dimension":"mark",c=l.getLayoutStartPoint(),u=l.getLayoutRect(),p=a.globalInstance.getContainer(),m=Object.assign({x:0,y:0},p?VP(p):{}),g=_=>{var v;let{dimensionFields:x,dimensionData:y,measureFields:b,measureData:S,groupField:C,groupData:k}=_.data;return(v=_.series.getViewData())===null||v===void 0?void 0:v.latestData.find(E=>sc(x,y)(E)&&sc(b,S)(E)&&(T(C)||sc([C],[k])(E)))},f=_=>{var v,x;let y=(C=>({x:Math.min(Math.max(C.x,0),u.width),y:Math.min(Math.max(C.y,0),u.height)}))(_),b=(v=o.x)!==null&&v!==void 0?v:c.x+y.x,S=(x=o.y)!==null&&x!==void 0?x:c.y+y.y;return{canvasX:b,canvasY:S,clientX:m.x+b,clientY:m.y+S}};if(d==="dimension"){let _=h[0];if(!_)return"none";let v=new Map;h.forEach(S=>{var C;v.has(S.series)||v.set(S.series,[]),(C=v.get(S.series))===null||C===void 0||C.push(S)});let x=[{value:r[_.data.dimensionFields[0]],data:[...v.keys()].map(S=>{var C,k;return{series:S,datum:(k=(C=v.get(S))===null||C===void 0?void 0:C.map(M=>g(M)))!==null&&k!==void 0?k:[]}})}];A(_.dimType)&&(x[0].position=_.pos[_.dimType],x[0].dimType=_.dimType);let y={changePositionOnly:!1,action:"enter",tooltip:null,dimensionInfo:x,chart:(s=a.globalInstance.getChart())!==null&&s!==void 0?s:void 0,datum:void 0,model:void 0,source:jt.chart,event:f({x:h.reduce((S,C)=>S+C.pos.x,0)/h.length,y:h.reduce((S,C)=>S+C.pos.y,0)/h.length}),item:void 0,itemMap:new Map};e.processor.dimension.showTooltip(x,y,!1);let b=a.globalInstance;return $i.globalConfig.uniqueTooltip&&$i.hideTooltip(b.id),d}if(d==="mark"){let _=h[0];if(!_)return"none";let v=Object.assign(Object.assign({},g(_)),r),x=[{datum:[v],series:_.series}],y={changePositionOnly:!1,tooltip:null,dimensionInfo:[{value:v[_.data.dimensionFields[0]],data:x}],chart:(n=a.globalInstance.getChart())!==null&&n!==void 0?n:void 0,datum:v,model:_.series,source:jt.chart,event:f(_.pos),item:void 0,itemMap:new Map};e.processor.mark.showTooltip({datum:v,mark:null,series:_.series},y,!1);let b=a.globalInstance;return $i.globalConfig.uniqueTooltip&&$i.hideTooltip(b.id),d}return"none"}var ZZ=(r,t)=>{let e=t.getSeries(),i=[];return e.forEach(s=>{var n,o,a,l,h,d,c;let u=s.getDimensionField(),p=s.getMeasureField(),m=s.getSeriesField(),g=A(m)?r[m]:void 0,f=A(m)&&(l=(a=(o=(n=s.getViewDataStatistics)===null||n===void 0?void 0:n.call(s))===null||o===void 0?void 0:o.latestData[m])===null||a===void 0?void 0:a.values)!==null&&l!==void 0?l:[],_=Om(u,r),v=Om(p,r),x=Dv(v),y=!x&&A(m)&&T(g)&&f.length>0,b=()=>{var S;let C=(S=s.getViewData())===null||S===void 0?void 0:S.latestData.find(sc(u,_));if(!x&&(v=Om(p,C),!Dv(v)))return;let k=s.type===F.pie?s.dataToCentralPosition(C):s.dataToPosition(C);T(k)||isNaN(k.x)||isNaN(k.y)||i.push({pos:k,data:{dimensionFields:u,dimensionData:_,measureFields:p,measureData:v,hasMeasureData:x,groupField:m,groupData:g},series:s})};if(s.coordinate==="cartesian"){let S=s,C=Ke((d=(h=s.getYAxisHelper())===null||h===void 0?void 0:h.getScale(0))===null||d===void 0?void 0:d.type)?"y":"x",k=u.map((E,D)=>[E,D]).filter(([,E])=>T(_?.[E])),M=[_??[]];k.length>0&&k.forEach(([E,D])=>{var P,B,L,w;let R=(w=(L=(B=(P=s.getViewDataStatistics)===null||P===void 0?void 0:P.call(s))===null||B===void 0?void 0:B.latestData[E])===null||L===void 0?void 0:L.values)!==null&&w!==void 0?w:[],N=[];M.forEach(z=>{R.forEach(Y=>{var U;let $=(U=z?.slice())!==null&&U!==void 0?U:[];$[D]=Y,N.push($)})}),M=N}),M.forEach(E=>{var D,P;if(y){let B=(D=S.getViewData())===null||D===void 0?void 0:D.latestData.filter(sc(u,E));f.forEach(L=>{let w=B.find(N=>N[m]===L);if(v=Om(p,w),!Dv(v))return;let R=S.dataToPosition(w);T(R)||isNaN(R.x)||isNaN(R.y)||i.push({pos:R,data:{dimensionFields:u,dimensionData:E,measureFields:p,measureData:v,hasMeasureData:x,groupField:m,groupData:L},series:s,dimType:C})})}else{let B=(P=S.getViewData())===null||P===void 0?void 0:P.latestData.find(sc(u,E));if(!x&&(v=Om(p,B),!Dv(v)))return;let L=S.dataToPosition(B);if(T(L)||isNaN(L.x)||isNaN(L.y))return;i.push({pos:L,data:{dimensionFields:u,dimensionData:E,measureFields:p,measureData:v,hasMeasureData:x,groupField:m,groupData:g},dimType:C,series:s})}})}else if(s.coordinate==="polar")if(s.type===F.pie)b();else{let S=s;if(y){let C=((c=S.getViewData())===null||c===void 0?void 0:c.latestData.filter(sc(u,_))).find(k=>k[m]===g);f.forEach(k=>{if(v=Om(p,C),!Dv(v))return;let M=S.dataToPosition(C);T(M)||isNaN(M.x)||isNaN(M.y)||i.push({pos:M,data:{dimensionFields:u,dimensionData:_,measureFields:p,measureData:v,hasMeasureData:x,groupField:m,groupData:k},series:s})})}else b()}else s.coordinate==="geo"&&b()}),i};var JZ=["updateTitle","updateContent","updatePosition","maxLineCount","othersLine"],Y5=(r,t,e,i,s)=>{var n,o,a;let l={activeType:r};switch(r){case"mark":case"group":if(e){let h=(n=e.getSpec())===null||n===void 0?void 0:n.tooltip;return l.visible=!0,h?.handler&&(l.handler=h.handler),!((o=l.handler)===null||o===void 0)&&o.showTooltip?l:(h?.[r]&&JZ.forEach(d=>{A(h[r][d])&&(l[d]=h[r][d])}),Object.assign(Object.assign({},l),e.tooltipHelper.getTooltipData(r,t,i,i[0].datum,s)))}break;case"dimension":if(i?.length){if(QZ(i).every(d=>{var c;return!yp("dimension",(c=d.tooltipHelper)===null||c===void 0?void 0:c.spec)})?l.visible=!1:l.visible=!0,l.handler=t.handler,(a=l.handler)===null||a===void 0?void 0:a.showTooltip)return l;let h=[];return i.forEach(d=>d.data.forEach(c=>{let{series:u}=c,p=u.tooltipHelper.getTooltipData(r,t,i,c.datum,s);p&&h.push(p)})),Ez(h)}}return null},QZ=r=>{let t=[];return r.forEach(e=>{e.data.forEach(i=>{A(i.series)&&t.push(i.series)})}),t};var eP={dom:`${et}_TOOLTIP_HANDLER_DOM`,canvas:`${et}_TOOLTIP_HANDLER_CANVAS`},X5="vchart-tooltip-element",K5=20,iP={key:"\u5176\u4ED6",value:"..."},rP=["group","mark","dimension"],SC=50;var ch=class{constructor(t){this._showTooltipByHandler=(e,i)=>{var s,n,o;if(T(e))return 1;i.changePositionOnly||this.clearCache(),this._updateViewSpec(e,i);let a=this._cacheActiveSpec;if(T(a)||a.visible===!1)return 1;i.tooltipSpec=this.component.getSpec(),i.activeTooltipSpec=a;let{title:l,content:h}=a,d=T(l?.key)&&T(l?.value)&&!h?.length;if(this.component.event.emit(rt.tooltipShow,Object.assign(Object.assign({},i),{isEmptyTooltip:d,tooltipData:e,activeType:this.activeType,tooltip:this.component})),d)return 1;let c;return!((s=a.handler)===null||s===void 0)&&s.showTooltip?c=a.handler.showTooltip.bind(a.handler):!((n=this.component.tooltipHandler)===null||n===void 0)&&n.showTooltip&&(c=this.component.tooltipHandler.showTooltip.bind(this.component.tooltipHandler)),c?(o=c(this.activeType,e,i))!==null&&o!==void 0?o:0:1},this.component=t}_preprocessDimensionInfo(t){let e=[];if(t?.forEach(i=>{let s=Object.assign(Object.assign({},i),{data:i.data.filter(({series:n})=>{var o,a;return((a=(o=n.getSpec())===null||o===void 0?void 0:o.tooltip)===null||a===void 0?void 0:a.visible)!==!1})});s.data.length>0&&e.push(s)}),e.length>0)return e}_updateViewSpec(t,e){var i,s,n,o,a,l,h,d,c;let{changePositionOnly:u,model:p}=e;if(!u||!this._cacheActiveSpec){let m=this.component.getSpec();if(this._cacheActiveSpec=Y5(this.activeType,this.component.getSpec(),p,t,e),this._cacheActiveSpec){T(this._cacheActiveSpec.handler)&&A(m.handler)&&(this._cacheActiveSpec.handler=m.handler);let g=(i=m[this.activeType])!==null&&i!==void 0?i:{},f=(s=this._cacheActiveSpec.updateTitle)!==null&&s!==void 0?s:g.updateTitle,_=(n=this._cacheActiveSpec.updateContent)!==null&&n!==void 0?n:g.updateContent,v=(a=(o=this._cacheActiveSpec.maxLineCount)!==null&&o!==void 0?o:g.maxLineCount)!==null&&a!==void 0?a:K5;if(f&&(this._cacheActiveSpec.title=(l=f(this._cacheActiveSpec.title,t,e))!==null&&l!==void 0?l:this._cacheActiveSpec.title),_)this._cacheActiveSpec.content=(h=_(this._cacheActiveSpec.content,t,e))!==null&&h!==void 0?h:this._cacheActiveSpec.content;else if(v>=1&&((d=this._cacheActiveSpec.content)===null||d===void 0?void 0:d.length)>v){let x=(c=this._cacheActiveSpec.othersLine)!==null&&c!==void 0?c:g.othersLine,y=x?Object.assign(Object.assign({},iP),x):iP;this._cacheActiveSpec.content=[...this._cacheActiveSpec.content.slice(0,v-1),Object.assign(Object.assign({},this._cacheActiveSpec.content[v-1]),y)]}}}}shouldHandleTooltip(t,e){var i,s;return!T(e)&&yp(this.activeType,(s=(i=t.model)===null||i===void 0?void 0:i.tooltipHelper)===null||s===void 0?void 0:s.spec)}clearCache(){this._cacheActiveSpec=void 0}};var AC=class extends ch{constructor(){super(...arguments),this.activeType="dimension"}showTooltip(t,e,i){let s=Object.assign(Object.assign({},e),{dimensionInfo:this._preprocessDimensionInfo(t),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(t,s)}_getDimensionInfo(t){var e,i;let s,n=this.component.getChart(),o=n.getCompiler().getStage().getLayer(void 0),a={x:t.event.viewX,y:t.event.viewY};if(o.globalTransMatrix.transformPoint({x:t.event.viewX,y:t.event.viewY},a),s=[...(e=jA(n,a,!0))!==null&&e!==void 0?e:[],...(i=NA(n,a))!==null&&i!==void 0?i:[]],s.length===0)s=void 0;else if(s.length>1){let l=s.filter(h=>{var d;let c=h.axis;if(c.getSpec().hasDimensionTooltip)return!0;if(!Ke(c.getScale().type))return!1;let u;for(let p of(d=c?.getRegions())!==null&&d!==void 0?d:[]){for(let m of p.getSeries())if(m.coordinate==="cartesian"){u=m;break}if(A(u))break}return A(u)&&u.getDimensionField()[0]===u.fieldY[0]?c.getOrient()==="left"||c.getOrient()==="right":c.getOrient()==="bottom"||c.getOrient()==="top"});if(s=l.length?l:s.slice(0,1),s.length>1){let h=new Set;s.forEach(d=>{d.data=d.data.filter(({key:c})=>!h.has(c)&&(h.add(c),!0))})}}return s}getMouseEventData(t){return{tooltipInfo:this._getDimensionInfo(t),ignore:!1}}};var CC=class extends ch{constructor(){super(...arguments),this.activeType="mark"}showTooltip(t,e,i){var s,n,o;let{datum:a,series:l}=t,h=this.component.getSpec(),d=[{datum:[a],series:l}],c=l.tooltipHelper,u=(s=l.getSpec())===null||s===void 0?void 0:s.tooltip,p=(n=u?.mark)===null||n===void 0?void 0:n.checkOverlap,m=!1;if(p===!0||((o=h.mark)===null||o===void 0?void 0:o.checkOverlap)===!0&&p!==!1){let f=c?.activeTriggerSet.mark;if(f){m=!0;let _=this.component.getChart().getCompiler().getStage().getLayer(void 0),v={x:e.event.viewX,y:e.event.viewY};_.globalTransMatrix.transformPoint({x:e.event.viewX,y:e.event.viewY},v),f.forEach(x=>{x.getProductElements().forEach(y=>{let b=y.getGraphicItem();y!==e.item&&b&&b.containsPoint(v.x,v.y,io.GLOBAL,b.stage.getPickerService())&&d[0].datum.push(y.getDatum())})})}}let g=Object.assign(Object.assign({},e),{model:l,changePositionOnly:i,tooltip:this.component});if(i&&m){let f=this._cacheActiveSpec&&this._cacheActiveSpec.data;f&&f[0].series===d[0].series&&f[0].datum.length===d[0].datum.length&&!f[0].datum.some((_,v)=>_!==d[0].datum[v])||(g.changePositionOnly=!1)}return this._showTooltipByHandler(d,g)}getMouseEventData(t){var e;let i,s,n=(e=t.model)===null||e===void 0?void 0:e.modelType;if(n==="series"){let o=t.model,a=o.tooltipHelper,l=a?.activeTriggerSet.mark,h=a?.ignoreTriggerSet.mark;l?.has(t.mark)?i={mark:t.mark,datum:t.datum,series:o}:h?.has(t.mark)&&(s=!0)}else if(n==="component"){let o=t.model,a=t.node;if(o.name==="label"&&a){let l=o.getLabelInfoByTextGraphic(a),{baseMark:h,series:d,labelMark:c}=l??{},u=d.tooltipHelper,p=u?.activeTriggerSet.mark,m=u?.ignoreTriggerSet.mark;p?.has(c)?i={mark:h,datum:a.attribute.data,series:d}:m?.has(c)&&(s=!0)}}return{tooltipInfo:i,ignore:s}}};var TC=class extends ch{constructor(){super(...arguments),this.activeType="group"}showTooltip(t,e,i){let{datum:s,series:n}=t,o=[{datum:O(s),series:n}],a=Object.assign(Object.assign({},e),{groupDatum:this._getGroupDatum(e),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(o,a)}getMouseEventData(t){var e,i;let s;if(((e=t.model)===null||e===void 0?void 0:e.modelType)==="series"){let n=t.model,o=n.tooltipHelper,a=o?.activeTriggerSet.group;if(a?.has(t.mark)){let l=this.component.getSpec()[this.activeType];(l?.triggerMark?O(l.triggerMark):[]).includes((i=t.mark)===null||i===void 0?void 0:i.name)&&(s={mark:t.mark,datum:t.datum,series:n})}}return{tooltipInfo:s,ignore:!1}}_getGroupDatum(t){let{model:e,mark:i,datum:s}=t,n=e;if(["line","area"].includes(i.type))return O(s);let o=n.getViewData().latestData,a=n.getSeriesField();if(!a)return o;let l=O(s)[0][a];return o.filter(h=>h[a]===l)}};var sP=r=>A(r)&&!H(r),nP=r=>A(r)&&H(r);var Ev=class extends Fn{_shouldMergeThemeToSpec(){return!1}_initTheme(t,e){var i;let{spec:s,theme:n}=super._initTheme(t,e);return s.style=ot({},this._theme,s.style),s.offset=ot({},n.offset,t.offset),s.transitionDuration=(i=t.transitionDuration)!==null&&i!==void 0?i:n.transitionDuration,{spec:s,theme:n}}_transformSpecAfterMergingTheme(t,e,i){var s,n,o,a,l,h,d;super._transformSpecAfterMergingTheme(t,e,i),t.visible=(s=t.visible)===null||s===void 0||s,t.activeType=kz(t),t.renderMode=(n=t.renderMode)!==null&&n!==void 0?n:Gr(this._option.mode)||!jr(this._option.mode)?"canvas":"html",t.trigger=(o=t.trigger)!==null&&o!==void 0?o:"hover",t.className=(a=t.className)!==null&&a!==void 0?a:X5,t.enterable=(l=t.enterable)!==null&&l!==void 0&&l,t.transitionDuration=(h=t.transitionDuration)!==null&&h!==void 0?h:150,t.confine=(d=t.confine)!==null&&d!==void 0?d:t.renderMode==="canvas",A(t.parentElement)?Z(t.parentElement)&&(t.parentElement=kt.getElementById(t.parentElement)):jr(this._option.mode)&&(t.parentElement=YM==null?void 0:YM.body)}};var Hm=class extends Oe{constructor(){super(...arguments),this.layoutZIndex=1,this.type=W.tooltip,this.name=W.tooltip,this.transformerConstructor=Ev,this.specKey="tooltip",this.layoutType="none",this._isReleased=!1,this._alwaysShow=!1,this._eventList=[],this._isTooltipShown=!1,this._clickLock=!1,this._mountEvent=(t,e,i)=>{this.event.on(t,e,i),this._eventList.push({eventType:t,handler:i})},this._handleClickToLock=t=>{this._clickLock?(this._handleChartMouseOut(t),this._clickLock=!1):this._clickLock=!0},this._getMouseOutHandler=t=>e=>{var i,s,n,o,a;if(this._isReleased||this._alwaysShow||this._clickLock||!this._isTooltipShown&&!(!((s=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||s===void 0)&&s.call(i)))return;let l=jr((n=this._option)===null||n===void 0?void 0:n.mode),{clientX:h,clientY:d}=e.event;l&&t&&this._isPointerInChart({x:h,y:d})||(this._enterable?this._outTimer=setTimeout(()=>{this._handleChartMouseOut(e)},(a=(o=this._spec)===null||o===void 0?void 0:o.showDelay)!==null&&a!==void 0?a:SC):this._handleChartMouseOut(e))},this._handleChartMouseOut=t=>{this._alwaysShow||this._isReleased||this._isEnterTooltip||this._spec.triggerOff!=="none"&&(this._hideTooltipByHandler(Object.assign(Object.assign({},t),{tooltip:this})),this._handleMouseMove&&this._handleMouseMove.cancel&&this._handleMouseMove.cancel(),this._cacheEnterableRect=null,this._cacheInfo=void 0,this._cacheParams=void 0,this._cacheActiveType=void 0)},this._getMouseMoveHandler=t=>e=>{var i,s,n,o;this._isReleased||this._isEnterTooltip||(this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),this._alwaysShow||(this._clickLock?t&&(this._handleChartMouseOut(e),this._clickLock=!1):!t&&this._enterable&&(!((s=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||s===void 0)&&s.call(i))?(this._showTimer&&clearTimeout(this._showTimer),this._showTimer=setTimeout(()=>{this._handleChartMouseMove(e,t)},(o=(n=this._spec)===null||n===void 0?void 0:n.showDelay)!==null&&o!==void 0?o:SC)):this._handleChartMouseMove(e,t)))},this._handleChartMouseMove=(t,e)=>{if(this._isReleased)return;let i=this._getMouseEventData(t),{tooltipInfo:{dimension:s},ignore:{mark:n}}=i,o={mark:!1,dimension:!1,group:!1};for(let a=0,l=rP.length;a<l;a++){let h=rP[a];if(this.processor[h]&&this._showTooltipByMouseEvent(h,i,t,e)){o[h]=!0;break}}Object.values(o).every(a=>!a)&&!Mz(t)&&(n&&sP(this._cacheInfo)?o.mark=this._showTooltipByMouseEvent("mark",i,t,e,!0):A(s)&&(o.dimension=this._showTooltipByMouseEvent("dimension",i,t,e))),o.mark||o.group||o.dimension&&!T(s)?this._initEventOfTooltipContent():this._handleChartMouseOut(t)},this._showTooltipByMouseEvent=(t,e,i,s,n)=>{var o;let a=this.processor[t];if(!a.shouldHandleTooltip(i,e.tooltipInfo[t]))return!1;let l;if(this._hideTimer&&clearTimeout(this._hideTimer),n)l=!a.showTooltip(this._cacheInfo,i,!0);else{let d=e.tooltipInfo[t],c=this._isSameAsCache(d,i,t);l=!a.showTooltip(d,i,c),l&&(this._cacheInfo=d,this._cacheParams=i,this._cacheActiveType=t)}l&&(this._isTooltipShown=!0,s&&this._spec.lockAfterClick&&!this._clickLock?this._clickLock=!0:Number.isFinite(this._spec.hideTimer)&&(this._hideTimer=setTimeout(()=>{this._handleChartMouseOut()},this._spec.hideTimer)));let h=(o=this._option)===null||o===void 0?void 0:o.globalInstance;return l&&$i.globalConfig.uniqueTooltip&&h&&$i.hideTooltip(h.id),l},this._getMouseEventData=t=>{let e={tooltipInfo:{},ignore:{}};return Object.keys(this.processor).forEach(i=>{let{tooltipInfo:s,ignore:n}=this.processor[i].getMouseEventData(t);e.tooltipInfo[i]=s,e.ignore[i]=n}),e},this._hideTooltipByHandler=t=>{var e,i,s;if(!this._isTooltipShown&&!(!((i=(e=this.tooltipHandler)===null||e===void 0?void 0:e.isTooltipShown)===null||i===void 0)&&i.call(e)))return 0;this.event.emit(rt.tooltipHide,Object.assign(Object.assign({},t),{source:jt.chart,tooltip:this})),Object.values(this.processor).forEach(o=>{o.clearCache()});let n=(s=this._spec.handler)!==null&&s!==void 0?s:this.tooltipHandler;if(n.hideTooltip){let o=n.hideTooltip.call(n,t);return o||(this._isTooltipShown=!1),o}return 1},this.hideTooltip=()=>{if(this._isReleased)return!1;let t={changePositionOnly:!1,tooltip:this,item:void 0,datum:void 0,source:jt.chart};return this._alwaysShow=!1,!this._hideTooltipByHandler(t)}}isTooltipShown(){return this._isTooltipShown}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}_registerEvent(){}_releaseEvent(){}onLayout(t){}onLayoutEnd(t){}onRender(t){}created(){super.created(),this._regions=this._option.getAllRegions(),this._initEvent()}release(){var t,e;super.release(),this._isReleased=!0,this._hideTimer&&clearTimeout(this._hideTimer),this._eventList.forEach(({eventType:i,handler:s})=>{this.event.off(i,s)}),this._eventList=[],(e=(t=this.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),this._isTooltipShown=!1}beforeRelease(){this.event.emit(rt.tooltipHide,{tooltip:this,chart:this.getChart()}),this.event.emit(rt.tooltipRelease,{tooltip:this,chart:this.getChart()})}_initHandler(){var t,e,i;let s=(t=this._spec.renderMode)!==null&&t!==void 0?t:"html",n=this._option.globalInstance.getTooltipHandlerByUser();if(n)this.tooltipHandler=n,this._enterable=!1;else{let o=s==="canvas"?eP.canvas:eP.dom,a=I.getComponentPluginInType(o);a||ia("Can not find tooltip handler: "+o);let l=new a;l.name=`${this._spec.className}-${(e=this._option.globalInstance.id)!==null&&e!==void 0?e:0}-${this.getSpecIndex()}`,(i=this.pluginService)===null||i===void 0||i.load([l]),this.tooltipHandler=l,this._spec.enterable&&s==="html"&&this.tooltipHandler?(this._enterable=!0,this._needInitEventOfTooltip=!0):this._enterable=!1}}_initEventOfTooltipContent(){var t,e;if(!this._needInitEventOfTooltip)return;let i=(e=(t=this.tooltipHandler).getTooltipContainer)===null||e===void 0?void 0:e.call(t),s=i?.firstChild;s&&(s.addEventListener("pointerenter",()=>{var n;if(!this._enterable)return;this._isEnterTooltip=!0;let o=(n=s.getBoundingClientRect)===null||n===void 0?void 0:n.call(s);o&&(this._cacheEnterableRect={x:o.x,y:o.y,width:o.width,height:o.height}),this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this._showTimer&&(clearTimeout(this._showTimer),this._showTimer=null)}),s.addEventListener("pointerleave",()=>{var n,o,a;if(this._enterable&&(this._isEnterTooltip=!1,this._cacheEnterableRect)){let l=(n=s.getBoundingClientRect)===null||n===void 0?void 0:n.call(s);l&&Object.keys(this._cacheEnterableRect).every(h=>this._cacheEnterableRect[h]===l[h])&&(this._cacheEnterableRect=null,this._outTimer=setTimeout(this.hideTooltip,(a=(o=this._spec)===null||o===void 0?void 0:o.showDelay)!==null&&a!==void 0?a:SC))}}),this._needInitEventOfTooltip=!1)}_initProcessor(){let t=this._spec.activeType;this.processor={},t.includes("dimension")&&(this.processor.dimension=new AC(this)),t.includes("group")&&(this.processor.group=new TC(this)),t.includes("mark")&&(this.processor.mark=new CC(this))}_initEvent(){var t;if(this._option.disableTriggerEvent)return;let e=O((t=this._spec.trigger)!==null&&t!==void 0?t:"hover"),i=O(this._spec.triggerOff),s=this._option.mode;e.forEach(n=>{var o;n==="hover"?(this._handleMouseMove=this._throttle(this._getMouseMoveHandler(!1)),this._mountEvent("pointermove",{source:"chart"},this._handleMouseMove),(zr(s)||Gr(s))&&(this._mountEvent("pointerdown",{source:"chart"},this._getMouseMoveHandler(!1)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))),this._mountEvent("pointerleave",{source:"chart"},this._getMouseOutHandler(!1))):n==="click"?(this._mountEvent("pointertap",{source:"chart"},this._getMouseMoveHandler(!0)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))):ct(n)&&this._mountEvent(n.eventType,{source:(o=n.source)!==null&&o!==void 0?o:"chart",consume:n.consume},this._getMouseMoveHandler(!0))}),i.filter(n=>ct(n)).forEach(n=>{var o,a;this._mountEvent(n.eventType,{source:(o=n.source)!==null&&o!==void 0?o:"chart",consume:n.consume},this._getMouseOutHandler((a=n.checkOutside)!==null&&a!==void 0&&a))}),!e.includes("click")&&this._spec.lockAfterClick&&this._mountEvent("pointertap",{source:"chart"},this._handleClickToLock)}_throttle(t){let e;return e=J(this._spec.throttleInterval)?this._spec.throttleInterval:this._spec.renderMode==="html"&&this._spec.transitionDuration?50:10,Hi(t,e)}reInit(t){var e,i,s;if(super.reInit(t),this.tooltipHandler){let n=(e=this._spec.renderMode)!==null&&e!==void 0?e:"html",o=this._spec.enterable&&n==="html";o&&!this._enterable&&(this._needInitEventOfTooltip=!0),this._enterable=o,(s=(i=this.tooltipHandler).reInit)===null||s===void 0||s.call(i)}else this._initHandler()}showTooltip(t,e){var i;if(this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),!(!((i=this.tooltipHandler)===null||i===void 0)&&i.showTooltip))return!1;let s=W5(t,e,this);return s!=="none"&&(this._alwaysShow=!!e?.alwaysShow),s}_isSameAsCache(t,e,i){if(i!==this._cacheActiveType)return!1;if(t===this._cacheInfo)return!0;if(T(this._cacheInfo)||T(t))return!1;if(nP(t)){if(sP(this._cacheInfo))return!1;let o=this._cacheInfo;return o.length===t.length&&t.every((a,l)=>HA(a,o[l]))}if(nP(this._cacheInfo))return!1;let s=this._cacheInfo;if(!(t?.datum===s.datum&&t?.mark===s.mark&&t?.series===s.series))return!1;let n=this._cacheParams;return!T(n)&&!T(e)&&n.mark===e.mark&&n.model===e.model&&n.datum===e.datum}_isPointerInChart(t){var e;let i=(e=this._option)===null||e===void 0?void 0:e.globalInstance;if(!i||!i.getChart())return!1;let{x:s,y:n}=t,o=i.getCanvas(),{x:a,y:l,width:h,height:d}=o.getBoundingClientRect();return s>=a&&s<=a+h&&n>=l&&n<=l+d}getVisible(){return this._spec.visible!==!1}};Hm.type=W.tooltip,Hm.transformerConstructor=Ev,Hm.specKey="tooltip";var $5;(function(r){r[r.success=0]="success",r[r.failed=1]="failed"})($5||($5={}));var nc=class extends Oe{constructor(t,e){super(t,e),this.type=W.label,this.name=W.label,this.layoutType="none",this.layoutZIndex=Tt.Label,this._regions=e.getRegionsInIndex(e.regionIndexes)}_interactiveConfig(t){let{interactive:e}=t,i={hover:!1,select:!1,state:t.state};if(e!==!0)return i;let{hover:s,select:n}=this._option.getChart().getSpec();return s===!1&&s.enable===!1||(i.hover=!0),n===!1&&n.enable===!1||(i.select=!0),i}_compareSpec(t,e){let i=super._compareSpec(t,e);return i.reRender=!0,Bt(e,t)||(i.reMake=!0),i}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}};nc.type=W.label;var kC=class extends l0{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(t){this._rule=t}getTarget(){return this._target}setTarget(t){this._target=t,this._rule||this.setRule(t.type)}getComponent(){return this._component}setComponent(t){this._component=t}};kC.type="text",kC.constructorType="label";var wv=class extends Fn{_initTheme(t,e){return{spec:t,theme:this._theme}}};var Nm=class extends nc{constructor(t,e){super(t,e),this.type=W.label,this.name=W.label,this.specKey="label",this.transformerConstructor=wv,this.layoutZIndex=Tt.Label,this._layoutRule=t.labelLayout||"series"}static getSpecInfo(t,e){let i=[];return(e?.region||[]).forEach((n,o)=>{(n.seriesIndexes||[]).some(a=>{let l=e.series[a],{markLabelSpec:h={}}=l;return Object.values(h).some(d=>Array.isArray(d)&&(c=>c.some(u=>u.visible))(d))})&&i.push({spec:t,type:W.label,specInfoPath:["component",this.specKey,o],regionIndexes:[o]})}),i}init(t){super.init(t),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(t){super.reInit(t),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(rt.dataZoomChange,()=>{this._labelComponentMap.forEach((e,i)=>{let s=i.getProduct().getGroupGraphicItem();s&&s.disableAnimation()}),this.event.on(pt.AFTER_MARK_RENDER_END,t)});let t=()=>{this._labelComponentMap.forEach((e,i)=>{let s=i.getProduct().getGroupGraphicItem();s&&s.enableAnimation()}),this.event.off(pt.AFTER_MARK_RENDER_END,t)}}_initTextMark(){this._labelInfoMap||(this._labelInfoMap=new Map),this._labelComponentMap||(this._labelComponentMap=new Map),be(this._regions,t=>{let{markLabelSpec:e={}}=t.getSpecInfo(),i=Object.keys(e),s=t.getRegion();this._labelInfoMap.get(s)||this._labelInfoMap.set(s,[]);for(let n=0;n<i.length;n++){let o=i[n],a=t.getMarkInName(o);a&&e[o].forEach((l,h)=>{var d,c;if(l.visible){let u=this._labelInfoMap.get(s),p=this._createMark({type:"label",name:`${o}-label-${h}`},{noSeparateStyle:!0,attributeContext:t.getMarkAttributeContext()});l.showRelatedMarkTooltip&&((c=(d=t.tooltipHelper)===null||d===void 0?void 0:d.activeTriggerSet.mark)===null||c===void 0||c.add(p)),p.setTarget(a),u.push({labelMark:p,baseMark:a,series:t,labelSpec:l})}})}})}_initLabelComponent(){this._labelInfoMap.forEach((t,e)=>{if(this._layoutRule==="region"){let i=this._createMark({type:"component",name:`${e.getGroupMark().name}-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});i&&(i.setSkipBeforeLayouted(!0),t[0]&&A(t[0].labelSpec.zIndex)&&i.setMarkConfig({zIndex:t[0].labelSpec.zIndex}),this._marks.addMark(i),this._labelComponentMap.set(i,()=>this._labelInfoMap.get(e)))}else t.forEach((i,s)=>{let n=this._createMark({type:"component",name:`${i.labelMark.name}-component`},{componentType:"label",noSeparateStyle:!0},{support3d:i.baseMark.getMarkConfig().support3d});n&&(A(i.labelSpec.zIndex)&&n.setMarkConfig({zIndex:i.labelSpec.zIndex}),n.setSkipBeforeLayouted(!0),this._marks.addMark(n),this._labelComponentMap.set(n,()=>this._labelInfoMap.get(e)[s]))})})}_initTextMarkStyle(){this._labelComponentMap.forEach((t,e)=>{O(t()).forEach(({labelMark:i})=>{i.setComponent(e)})}),this._labelInfoMap.forEach(t=>{t.forEach(e=>{var i,s;let{labelMark:n,labelSpec:o,series:a}=e;if(this.initMarkStyleWithSpec(n,o,void 0),V(o?.getStyleHandler)){let l=o.getStyleHandler(a);l?.call(a,n,o)}!((s=(i=n.stateStyle)===null||i===void 0?void 0:i.normal)===null||s===void 0)&&s.lineWidth&&n.setAttribute("stroke",a.getColorAttribute(),"normal",X.Base_Series)})})}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach((t,e)=>{let i=t();H(i)?this._updateMultiLabelAttribute(i,e):this._updateSingleLabelAttribute(i,e)})}_updateMultiLabelAttribute(t,e){this._updateLabelComponentAttribute(e.getProduct(),t.map(({baseMark:i})=>i.getProduct()),t)}_updateSingleLabelAttribute(t,e){let{baseMark:i}=t;this._updateLabelComponentAttribute(e.getProduct(),i.getProduct(),[t])}_updateLabelComponentAttribute(t,e,i){let s=this._option.getComponentsByType("totalLabel");t.target(e).configure({interactive:!1}).depend(s.map(n=>n.getMarks()[0].getProduct())).labelStyle((n,o)=>{var a,l;let h=i[o.labelIndex];if(h){let{labelSpec:d,labelMark:c,series:u}=h,p=c.getRule(),m=this._interactiveConfig(d),g=(l=(a=this._spec)===null||a===void 0?void 0:a.centerOffset)!==null&&l!==void 0?l:0,f=ot({textStyle:Object.assign({pickable:d.interactive===!0},d.style),overlap:{avoidMarks:s.map(_=>_.getMarks()[0].getProductId())}},aU(p,h),Object.assign(Object.assign(Object.assign({},xr(d,["position","style","state","type","stackDataFilterType","getStyleHandler"])),m),{centerOffset:g}),d.stackDataFilterType?{dataFilter:d.stackDataFilterType==="min"?_=>_.filter(v=>v.data[fA]):_=>_.filter(v=>v.data[pa])}:{});return u&&u.parseLabelStyle&&(f=u.parseLabelStyle(f,d,c)),p!=="line"&&p!=="area"||(f.type=p),f}}).encode((n,o,a)=>{if(i[a.labelIndex]){let{labelSpec:l,labelMark:h}=i[a.labelIndex];return h.skipEncode?{data:n}:C0(i[a.labelIndex],n,l.formatMethod,l.formatter)}}).size(()=>i[0].series.getRegion().getLayoutRect())}compileMarks(){this.getMarks().forEach(t=>{let e=this._labelComponentMap.get(t)(),i;i=H(e)?e[0].series.getRegion().getGroupMark().getProduct():e.series.getRegion().getGroupMark().getProduct(),t.compile({group:i,context:{model:this,labelInfo:e}})})}getVRenderComponents(){let t=[];return this._labelComponentMap.forEach((e,i)=>{let s=i.getProduct().getGroupGraphicItem();s&&t.push(s)}),t}getLabelInfoByTextGraphic(t){let e,i=t?.parent,s=i?.parent;if(s){let n=s.getChildren().indexOf(i);this._labelComponentMap.forEach((o,a)=>{a.getProduct().getGroupGraphicItem()===s&&(e=O(o())[n])})}return e}};Nm.type=W.label,Nm.specKey="label",Nm.transformerConstructor=wv;var Pv=class extends nc{constructor(){super(...arguments),this.type=W.totalLabel,this.name=W.totalLabel,this.specKey="totalLabel",this.layoutZIndex=Tt.Label}static getSpecInfo(t,e){var i;let s=[];return(i=e?.region)===null||i===void 0||i.forEach((n,o)=>{var a;(a=n.seriesIndexes)===null||a===void 0||a.forEach(l=>{let{spec:h}=e.series[l],d=h[this.specKey];d?.visible&&s.push({spec:d,type:W.totalLabel,specPath:["series",l,this.specKey],specInfoPath:["component",this.specKey,l],regionIndexes:[o],seriesIndexes:[l]})})}),s}init(t){super.init(t),this._initTextMark(),this._initLabelComponent()}reInit(t){super.reInit(t),this._initTextMark()}_initTextMark(){var t;let e=this._getSeries();if(!((t=e.getSpec().totalLabel)===null||t===void 0)&&t.visible){let i=e.getSeriesMark();if(i){let s=this._createMark({type:"label",name:`${i.name}-total-label`});this._baseMark=i,this._textMark=s,this._initTextMarkStyle()}}}_initTextMarkStyle(){var t;super.initMarkStyleWithSpec(this._textMark,this._spec),this.setMarkStyle(this._textMark,{text:i=>i[$u]},"normal",X.Default);let e=this._getSeries();(t=e.initTotalLabelMarkStyle)===null||t===void 0||t.call(e,this._textMark)}_initLabelComponent(){let t=this._getSeries(),e=this._createMark({type:"component",name:`${t.name}-total-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});e&&this._marks.addMark(e)}updateLayoutAttribute(){super.updateLayoutAttribute();let t=this._getSeries();this._marks.forEach((e,i)=>{e.getProduct().target(this._baseMark.getProduct()).configure({interactive:!1}).labelStyle(()=>{var s,n;if(this._baseMark){let{offset:o,animation:a,overlap:l}=this._spec,h=this._interactiveConfig(this._spec);return ot({textStyle:{pickable:this._spec.interactive===!0},position:eJ(t,this._baseMark.type),x:0,y:0},(n=(s=t.getTotalLabelComponentStyle)===null||s===void 0?void 0:s.call(t,{baseMark:this._baseMark,labelMark:this._textMark}))!==null&&n!==void 0?n:{},Object.assign({offset:o,animation:a,overlap:l,dataFilter:d=>d.filter(c=>c.data[pa])},h))}}).encode(s=>C0({baseMark:this._baseMark,labelMark:this._textMark,series:t,labelSpec:t.getSpec().totalLabel},s,this._spec.formatMethod)).size(()=>this._regions[0].getLayoutRect())})}compileMarks(){this.getMarks().forEach(t=>{let e=this._regions[0].getGroupMark().getProduct();t.compile({group:e,context:{model:this}})})}getVRenderComponents(){let t=[];return this.getMarks().forEach(e=>{let i=e.getProduct().getGroupGraphicItem();i&&t.push(i)}),t}_getSeries(){return this._option.getSeriesInIndex([this.getSpecPath()[1]])[0]}};Pv.type=W.totalLabel,Pv.specKey="totalLabel";function eJ(r,t){var e,i;let s,{direction:n}=r,o={vertical:["top","bottom"],horizontal:["right","left"]},a=(n==="horizontal"?!((e=r.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=r.getYAxisHelper())===null||i===void 0)&&i.isInverse())?1:0;switch(t){case"rect":case"symbol":s=o[n][a];break;default:s="top"}return s}xw();Iw();vr();or();Zl();Io();vz();
